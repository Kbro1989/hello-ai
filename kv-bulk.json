[
  {
    "key": "animation/animationDemo.js",
    "value": "aW1wb3J0IHsgdXBkYXRlQW5pbWF0aW9ucywgY3ViaWNFYXNlSW5PdXQsIGNyZWF0ZU11bHRpUGhhc2VFYXNpbmdBcnJheSB9IGZyb20gJy4vbG9hZGVyLmpzJzsKCi8vIC0tLSBNaW5pbWFsIG1lc2ggcGxhY2Vob2xkZXIgLS0tCmNvbnN0IG1lc2ggPSB7CglnZW9tZXRyeTogeyBhdHRyaWJ1dGVzOiB7IHBvc2l0aW9uOiB7IGFycmF5OiBuZXcgRmxvYXQzMkFycmF5KDYpLCBuZWVkc1VwZGF0ZTogZmFsc2UgfSB9IH0sCgl1c2VyRGF0YTogeyBmcmFtZTogMCwgYWNjdW1UaW1lOiAwLCBibGVuZFByb2dyZXNzOiAwLCBibGVuZFNwZWVkOiAwLjA1LCBhY3RpdmVBbmltYXRpb246IG51bGwgfSwKfTsKCi8vIC0tLSBNaW5pbWFsIGZyYW1lIGhlbHBlciAtLS0KY29uc3QgY3JlYXRlRnJhbWUgPSAob2Zmc2V0KSA9PiAoeyB2ZXJ0aWNlczogbnVsbCwgb2Zmc2V0IH0pOwoKLy8gLS0tIFdhbGsgYW5pbWF0aW9uICgyIGZyYW1lcykgLS0tCmNvbnN0IHdhbGsgPSB7CglmcmFtZXM6IFtjcmVhdGVGcmFtZSgwKSwgY3JlYXRlRnJhbWUoMSldLAoJZnJhbWVUaW1lOiAwLjAzMywKCWVhc2luZ0N1cnZlOiBjdWJpY0Vhc2VJbk91dCwKfTsKCi8vIC0tLSBDaW5lbWF0aWMgYW5pbWF0aW9uICgyIGZyYW1lcywgNS1zdGVwIGVhc2luZyBhcnJheSkgLS0tCmNvbnN0IGNpbmVtYXRpY0RhdGEgPSBjcmVhdGVNdWx0aVBoYXNlRWFzaW5nQXJyYXkoCglbCgkJeyBkdXJhdGlvbjogMC40LCBlYXNpbmc6ICh0KSA9PiB0ICogdCB9LAoJCXsgZHVyYXRpb246IDAuMiwgZWFzaW5nOiAodCkgPT4gMyAqIHQgKiB0IC0gMiAqIHQgKiB0ICogdCB9LAoJCXsgZHVyYXRpb246IDAuNCwgZWFzaW5nOiAodCkgPT4gMSAtICgxIC0gdCkgKiAoMSAtIHQpIH0sCgldLAoJNQopOwoKY29uc3QgY2luZW1hdGljID0gewoJZnJhbWVzOiBbY3JlYXRlRnJhbWUoMiksIGNyZWF0ZUZyYW1lKDMpXSwKCWZyYW1lVGltZTogMC4wMzMsCgllYXNpbmdDdXJ2ZTogY2luZW1hdGljRGF0YS5lYXNpbmdBcnJheSwKfTsKCi8vIC0tLSBTdGFydCB3aXRoIHdhbGsgLS0tCm1lc2gudXNlckRhdGEuYWN0aXZlQW5pbWF0aW9uID0gd2FsazsKCi8vIC0tLSBBbmltYXRpb24gbG9vcCB3aXRoIHBlci1mcmFtZSBlYXNpbmcgbG9ncyAtLS0KZnVuY3Rpb24gYW5pbWF0ZShkZWx0YVRpbWUpIHsKCXVwZGF0ZUFuaW1hdGlvbnMobWVzaCwgZGVsdGFUaW1lKTsKCgljb25zdCB1YSA9IG1lc2gudXNlckRhdGE7Cgljb25zdCBhY3RpdmVBbmltID0gdWEuYWN0aXZlQW5pbWF0aW9uOwoKCWxldCBlYXNpbmdWYWx1ZSA9IDA7CglpZiAoQXJyYXkuaXNBcnJheShhY3RpdmVBbmltLmVhc2luZ0N1cnZlKSkgewoJCWVhc2luZ1ZhbHVlID0gYWN0aXZlQW5pbS5lYXNpbmdDdXJ2ZVt1YS5mcmFtZV0gPz8gMDsKCX0gZWxzZSBpZiAodHlwZW9mIGFjdGl2ZUFuaW0uZWFzaW5nQ3VydmUgPT09ICdmdW5jdGlvbicpIHsKCQljb25zdCB0ID0gdWEuZnJhbWUgLyAoYWN0aXZlQW5pbS5mcmFtZXMubGVuZ3RoIC0gMSk7CgkJZWFzaW5nVmFsdWUgPSBhY3RpdmVBbmltLmVhc2luZ0N1cnZlKHQpOwoJfQoKCS8vIExvZyBldmVyeSBmcmFtZSAoc21hbGwgZGVtbykKCWNvbnNvbGUubG9nKGBGcmFtZTogJHt1YS5mcmFtZX0sIEVhc2luZzogJHtlYXNpbmdWYWx1ZS50b0ZpeGVkKDMpfSwgQWN0aXZlOiAke2FjdGl2ZUFuaW0gPT09IGNpbmVtYXRpYyA/ICdDaW5lbWF0aWMnIDogJ1dhbGsnfWApOwoKCS8vIFRyaWdnZXIgY2luZW1hdGljIGFmdGVyIGZpcnN0IHdhbGsgY3ljbGUKCWlmICh1YS5mcmFtZSA9PT0gMSAmJiB1YS5hY3RpdmVBbmltYXRpb24gPT09IHdhbGspIHsKCQl1YS5hY3RpdmVBbmltYXRpb24gPSBjaW5lbWF0aWM7CgkJdWEuZnJhbWUgPSAwOwoJCXVhLmFjY3VtVGltZSA9IDA7CgkJdWEuYmxlbmRQcm9ncmVzcyA9IDA7Cgl9CgoJcmVxdWVzdEFuaW1hdGlvbkZyYW1lKChkdCkgPT4gYW5pbWF0ZShkdCAqIDAuMDAxKSk7Cn0KCi8vIC0tLSBTdGFydCBsb29wIC0tLQphbmltYXRlKDAuMDE2KTsK",
    "base64": true
  },
  {
    "key": "animation/loader.js",
    "value": "ZXhwb3J0IGZ1bmN0aW9uIHVwZGF0ZUFuaW1hdGlvbnMobWVzaCwgZGVsdGFUaW1lKSB7CgkvLyBQbGFjZWhvbGRlciBmb3IgYW5pbWF0aW9uIHVwZGF0ZSBsb2dpYwoJY29uc3QgdWEgPSBtZXNoLnVzZXJEYXRhOwoJaWYgKCF1YS5hY3RpdmVBbmltYXRpb24pIHJldHVybjsKCgl1YS5hY2N1bVRpbWUgKz0gZGVsdGFUaW1lOwoJY29uc3QgZnJhbWVEdXJhdGlvbiA9IHVhLmFjdGl2ZUFuaW1hdGlvbi5mcmFtZVRpbWU7Cgljb25zdCB0b3RhbEZyYW1lcyA9IHVhLmEuZnJhbWVzLmxlbmd0aDsKCglpZiAodWEuYWNjdW1UaW1lID49IGZyYW1lRHVyYXRpb24pIHsKCQl1YS5hY2N1bVRpbWUgLT0gZnJhbWVEdXJhdGlvbjsKCQl1YS5mcmFtZSA9ICh1YS5mcmFtZSArIDEpICUgdG90YWxGcmFtZXM7CgkJLy8gSW4gYSByZWFsIHNjZW5hcmlvLCB5b3UnZCB1cGRhdGUgbWVzaCBnZW9tZXRyeSBoZXJlIGJhc2VkIG9uIHVhLmZyYW1lCgl9Cn0KCmV4cG9ydCBmdW5jdGlvbiBjdWJpY0Vhc2VJbk91dCh0KSB7CglyZXR1cm4gdCA8IDAuNSA/IDQgKiB0ICogdCAqIHQgOiAxIC0gTWF0aC5wb3coLTIgKiB0ICsgMiwgMykgLyAyOwp9CgpleHBvcnQgZnVuY3Rpb24gY3JlYXRlTXVsdGlQaGFzZUVhc2luZ0FycmF5KHBoYXNlcywgc3RlcHMpIHsKCWNvbnN0IGVhc2luZ0FycmF5ID0gbmV3IEFycmF5KHN0ZXBzKTsKCWxldCB0b3RhbER1cmF0aW9uID0gMDsKCWZvciAoY29uc3QgcGhhc2Ugb2YgcGhhc2VzKSB7CgkJdG90YWxEdXJhdGlvbiArPSBwaGFzZS5kdXJhdGlvbjsKCX0KCglsZXQgY3VycmVudFN0ZXAgPSAwOwoJZm9yIChjb25zdCBwaGFzZSBvZiBwaGFzZXMpIHsKCQljb25zdCBwaGFzZVN0ZXBzID0gTWF0aC5yb3VuZCgocGhhc2UuZHVyYXRpb24gLyB0b3RhbER1cmF0aW9uKSAqIHN0ZXBzKTsKCQlmb3IgKGxldCBpID0gMDsgaSA8IHBoYXNlU3RlcHM7IGkrKykgewoJCQljb25zdCB0ID0gaSAvIChwaGFzZVN0ZXBzIC0gMSk7CgkJCWVhc2luZ0FycmF5W2N1cnJlbnRTdGVwKytdID0gcGhhc2UuZWFzaW5nKHQpOwoJCX0KCX0KCS8vIEZpbGwgYW55IHJlbWFpbmluZyBzdGVwcyBkdWUgdG8gcm91bmRpbmcKCXdoaWxlIChjdXJyZW50U3RlcCA8IHN0ZXBzKSB7CgkJZWFzaW5nQXJyYXlbY3VycmVudFN0ZXArK10gPSBwaGFzZXNbcGhhc2VzLmxlbmd0aCAtIDFdLmVhc2luZygxKTsKCX0KCXJldHVybiB7IGVhc2luZ0FycmF5IH07Cn0K",
    "base64": true
  },
  {
    "key": "favicon.ico",
    "value": "",
    "base64": true
  },
  {
    "key": "index.html",
    "value": "PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgPG1ldGEgY2hhcnNldD0iVVRGLTgiPgogIDx0aXRsZT5BSS1Bc3Npc3RlZCAzRCBNb2RlbCBEYXNoYm9hcmQ8L3RpdGxlPgogIDxzdHlsZT4KICAgIGJvZHkgeyBtYXJnaW46IDA7IGRpc3BsYXk6IGZsZXg7IGhlaWdodDogMTAwdmg7IGZvbnQtZmFtaWx5OiBzYW5zLXNlcmlmOyB9CiAgICAjc2lkZWJhciB7IHdpZHRoOiAzMDBweDsgcGFkZGluZzogMXJlbTsgYmFja2dyb3VuZDogIzIyMjsgY29sb3I6ICNlZWU7IG92ZXJmbG93LXk6IGF1dG87IH0KICAgICNjYW52YXMtY29udGFpbmVyIHsgZmxleDogMTsgfQogICAgYnV0dG9uIHsgbWFyZ2luOiAwLjI1cmVtIDA7IHdpZHRoOiAxMDAlOyBwYWRkaW5nOiAwLjVyZW07IH0KICAgIHByZSB7IGJhY2tncm91bmQ6ICMxMTE7IGNvbG9yOiAjMGYwOyBwYWRkaW5nOiAwLjVyZW07IG92ZXJmbG93LXg6IGF1dG87IH0KICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5PgogIDxkaXYgaWQ9InNpZGViYXIiPgogICAgPGgyPkF2YWlsYWJsZSBNb2RlbHM8L2gyPgogICAgPGRpdiBpZD0ibW9kZWxzIj48L2Rpdj4KICAgIDxoMz5UeXBlZGVmIEpTT048L2gzPgogICAgPHByZSBpZD0idHlwZWRlZiI+TG9hZGluZy4uLjwvcHJlPgogIDwvZGl2PgogIDxkaXYgaWQ9ImNhbnZhcy1jb250YWluZXIiPjwvZGl2PgoKICA8c2NyaXB0IHR5cGU9Im1vZHVsZSI+CiAgICBpbXBvcnQgKiBhcyBUSFJFRSBmcm9tICdodHRwczovL3VucGtnLmNvbS90aHJlZUAwLjE1OC4wL2J1aWxkL3RocmVlLm1vZHVsZS5qcyc7CiAgICBpbXBvcnQgeyBPcmJpdENvbnRyb2xzIH0gZnJvbSAnaHR0cHM6Ly91bnBrZy5jb20vdGhyZWVAMC4xNTguMC9leGFtcGxlcy9qc20vY29udHJvbHMvT3JiaXRDb250cm9scy5qcyc7CiAgICBpbXBvcnQgeyBjcmVhdGVUaHJlZU1lc2hGcm9tUnNtdk1vZGVsIH0gZnJvbSAnLi9qcy9yc212VGhyZWVMb2FkZXIuanMnOwoKICAgIC8vIC0tLSBGZXRjaCB0eXBlZGVmIEpTT04gZnJvbSBLViAtLS0KICAgIGFzeW5jIGZ1bmN0aW9uIGxvYWRUeXBlZGVmKCkgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKCcvdHlwZWRlZicpOwogICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCByZXMuanNvbigpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0eXBlZGVmJykudGV4dENvbnRlbnQgPSBKU09OLnN0cmluZ2lmeShkYXRhLCBudWxsLCAyKTsKICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgfSBjYXRjaCAoZXJyKSB7CiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGxvYWQgdHlwZWRlZjonLCBlcnIpOwogICAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd0eXBlZGVmJykudGV4dENvbnRlbnQgPSAnRXJyb3IgbG9hZGluZyB0eXBlZGVmJzsKICAgICAgICByZXR1cm4ge307CiAgICAgIH0KICAgIH0KCiAgICBjb25zdCB0eXBlZGVmID0gYXdhaXQgbG9hZFR5cGVkZWYoKTsKCiAgICAvLyAtLS0gU2FtcGxlIG1vZGVscyBsaXN0IC0tLQogICAgY29uc3QgbW9kZWxzTGlzdCA9IFsnTW9kZWwgMCcsICdNb2RlbCAxJywgJ01vZGVsIDInXTsKICAgIGNvbnN0IG1vZGVsc0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RlbHMnKTsKICAgIG1vZGVsc0xpc3QuZm9yRWFjaCgobmFtZSwgaSkgPT4gewogICAgICBjb25zdCBidG4gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdidXR0b24nKTsKICAgICAgYnRuLnRleHRDb250ZW50ID0gbmFtZTsKICAgICAgYnRuLm9uY2xpY2sgPSAoKSA9PiBsb2FkTW9kZWwoaSk7CiAgICAgIG1vZGVsc0Rpdi5hcHBlbmRDaGlsZChidG4pOwogICAgfSk7CgogICAgLy8gLS0tIFRocmVlLmpzIFNjZW5lIFNldHVwIC0tLQogICAgY29uc3QgY29udGFpbmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NhbnZhcy1jb250YWluZXInKTsKICAgIGNvbnN0IHNjZW5lID0gbmV3IFRIUkVFLlNjZW5lKCk7CiAgICBjb25zdCBjYW1lcmEgPSBuZXcgVEhSRUUuUGVyc3BlY3RpdmVDYW1lcmEoNjAsIGNvbnRhaW5lci5jbGllbnRXaWR0aCAvIGNvbnRhaW5lci5jbGllbnRIZWlnaHQsIDAuMSwgMTAwMCk7CiAgICBjYW1lcmEucG9zaXRpb24ueiA9IDU7CgogICAgY29uc3QgcmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlcih7IGFudGlhbGlhczogdHJ1ZSB9KTsKICAgIHJlbmRlcmVyLnNldFNpemUoY29udGFpbmVyLmNsaWVudFdpZHRoLCBjb250YWluZXIuY2xpZW50SGVpZ2h0KTsKICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZChyZW5kZXJlci5kb21FbGVtZW50KTsKCiAgICBjb25zdCBjb250cm9scyA9IG5ldyBPcmJpdENvbnRyb2xzKGNhbWVyYSwgcmVuZGVyZXIuZG9tRWxlbWVudCk7CiAgICBjb250cm9scy5lbmFibGVEYW1waW5nID0gdHJ1ZTsKCiAgICBjb25zdCBsaWdodCA9IG5ldyBUSFJFRS5EaXJlY3Rpb25hbExpZ2h0KDB4ZmZmZmZmLCAxKTsKICAgIGxpZ2h0LnBvc2l0aW9uLnNldCg1LCAxMCwgNyk7CiAgICBzY2VuZS5hZGQobGlnaHQpOwoKICAgIC8vIC0tLSBQbGFjZWhvbGRlciBmb3IgbW9kZWwgbG9hZGVyIC0tLQogICAgbGV0IGN1cnJlbnRNb2RlbDsKICAgIGFzeW5jIGZ1bmN0aW9uIGxvYWRNb2RlbChpbmRleCkgewogICAgICBpZiAoY3VycmVudE1vZGVsKSBzY2VuZS5yZW1vdmUoY3VycmVudE1vZGVsKTsKCiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goYC9hcGkvbW9kZWwvJHtpbmRleH0ub2IzYCk7IC8vIEFzc3VtaW5nIG1vZGVsIElEcyBhcmUgbGlrZSAwLm9iMywgMS5vYjMgZXRjLgogICAgICAgIGlmICghcmVzLm9rKSB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBsb2FkIG1vZGVsOiAke3Jlcy5zdGF0dXNUZXh0fWApOwogICAgICAgIGNvbnN0IG1vZGVsRGF0YSA9IGF3YWl0IHJlcy5qc29uKCk7CiAgICAgICAgY29uc29sZS5sb2coJ0xvYWRlZCBtb2RlbCBkYXRhOicsIG1vZGVsRGF0YSk7CgogICAgICAgIGN1cnJlbnRNb2RlbCA9IGNyZWF0ZVRocmVlTWVzaEZyb21Sc212TW9kZWwobW9kZWxEYXRhKTsKICAgICAgICBzY2VuZS5hZGQoY3VycmVudE1vZGVsKTsKCiAgICAgIH0gY2F0Y2ggKGVycikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvYWRpbmcgbW9kZWw6JywgZXJyKTsKICAgICAgfQogICAgfQoKICAgIGZ1bmN0aW9uIGFuaW1hdGUoKSB7CiAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZShhbmltYXRlKTsKICAgICAgY29udHJvbHMudXBkYXRlKCk7CiAgICAgIHJlbmRlcmVyLnJlbmRlcihzY2VuZSwgY2FtZXJhKTsKICAgIH0KICAgIGFuaW1hdGUoKTsKCiAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgKCkgPT4gewogICAgICBjYW1lcmEuYXNwZWN0ID0gY29udGFpbmVyLmNsaWVudFdpZHRoIC8gY29udGFpbmVyLmNsaWVudEhlaWdodDsKICAgICAgY2FtZXJhLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKICAgICAgcmVuZGVyZXIuc2V0U2l6ZShjb250YWluZXIuY2xpZW50V2lkdGgsIGNvbnRhaW5lci5jbGllbnRIZWlnaHQpOwogICAgfSk7CiAgPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPg==",
    "base64": true
  },
  {
    "key": "js/OrbitControls.js",
    "value": "aW1wb3J0IHsKCUV2ZW50RGlzcGF0Y2hlciwKCU1PVVNFLAoJUXVhdGVybmlvbiwKCVNwaGVyaWNhbCwKCVRPVUNILAoJVmVjdG9yMiwKCVZlY3RvcjMsCglQbGFuZSwKCVJheSwKCU1hdGhVdGlscwp9IGZyb20gJ3RocmVlJzsKCi8vIE9yYml0Q29udHJvbHMgcGVyZm9ybXMgb3JiaXRpbmcsIGRvbGx5aW5nICh6b29taW5nKSwgYW5kIHBhbm5pbmcuCi8vIFVubGlrZSBUcmFja2JhbGxDb250cm9scywgaXQgbWFpbnRhaW5zIHRoZSAidXAiIGRpcmVjdGlvbiBvYmplY3QudXAgKCtZIGJ5IGRlZmF1bHQpLgovLwovLyAgICBPcmJpdCAtIGxlZnQgbW91c2UgLyB0b3VjaDogb25lLWZpbmdlciBtb3ZlCi8vICAgIFpvb20gLSBtaWRkbGUgbW91c2UsIG9yIG1vdXNld2hlZWwgLyB0b3VjaDogdHdvLWZpbmdlciBzcHJlYWQgb3Igc3F1aXNoCi8vICAgIFBhbiAtIHJpZ2h0IG1vdXNlLCBvciBsZWZ0IG1vdXNlICsgY3RybC9tZXRhL3NoaWZ0S2V5LCBvciBhcnJvdyBrZXlzIC8gdG91Y2g6IHR3by1maW5nZXIgbW92ZQoKY29uc3QgX2NoYW5nZUV2ZW50ID0geyB0eXBlOiAnY2hhbmdlJyB9Owpjb25zdCBfc3RhcnRFdmVudCA9IHsgdHlwZTogJ3N0YXJ0JyB9Owpjb25zdCBfZW5kRXZlbnQgPSB7IHR5cGU6ICdlbmQnIH07CmNvbnN0IF9yYXkgPSBuZXcgUmF5KCk7CmNvbnN0IF9wbGFuZSA9IG5ldyBQbGFuZSgpOwpjb25zdCBUSUxUX0xJTUlUID0gTWF0aC5jb3MoIDcwICogTWF0aFV0aWxzLkRFRzJSQUQgKTsKCmNsYXNzIE9yYml0Q29udHJvbHMgZXh0ZW5kcyBFdmVudERpc3BhdGNoZXIgewoKCWNvbnN0cnVjdG9yKCBvYmplY3QsIGRvbUVsZW1lbnQgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMub2JqZWN0ID0gb2JqZWN0OwoJCXRoaXMuZG9tRWxlbWVudCA9IGRvbUVsZW1lbnQ7CgkJdGhpcy5kb21FbGVtZW50LnN0eWxlLnRvdWNoQWN0aW9uID0gJ25vbmUnOyAvLyBkaXNhYmxlIHRvdWNoIHNjcm9sbAoKCQkvLyBTZXQgdG8gZmFsc2UgdG8gZGlzYWJsZSB0aGlzIGNvbnRyb2wKCQl0aGlzLmVuYWJsZWQgPSB0cnVlOwoKCQkvLyAidGFyZ2V0IiBzZXRzIHRoZSBsb2NhdGlvbiBvZiBmb2N1cywgd2hlcmUgdGhlIG9iamVjdCBvcmJpdHMgYXJvdW5kCgkJdGhpcy50YXJnZXQgPSBuZXcgVmVjdG9yMygpOwoKCQkvLyBIb3cgZmFyIHlvdSBjYW4gZG9sbHkgaW4gYW5kIG91dCAoIFBlcnNwZWN0aXZlQ2FtZXJhIG9ubHkgKQoJCXRoaXMubWluRGlzdGFuY2UgPSAwOwoJCXRoaXMubWF4RGlzdGFuY2UgPSBJbmZpbml0eTsKCgkJLy8gSG93IGZhciB5b3UgY2FuIHpvb20gaW4gYW5kIG91dCAoIE9ydGhvZ3JhcGhpY0NhbWVyYSBvbmx5ICkKCQl0aGlzLm1pblpvb20gPSAwOwoJCXRoaXMubWF4Wm9vbSA9IEluZmluaXR5OwoKCQkvLyBIb3cgZmFyIHlvdSBjYW4gb3JiaXQgdmVydGljYWxseSwgdXBwZXIgYW5kIGxvd2VyIGxpbWl0cy4KCQkvLyBSYW5nZSBpcyAwIHRvIE1hdGguUEkgcmFkaWFucy4KCQl0aGlzLm1pblBvbGFyQW5nbGUgPSAwOyAvLyByYWRpYW5zCgkJdGhpcy5tYXhQb2xhckFuZ2xlID0gTWF0aC5QSTsgLy8gcmFkaWFucwoKCQkvLyBIb3cgZmFyIHlvdSBjYW4gb3JiaXQgaG9yaXpvbnRhbGx5LCB1cHBlciBhbmQgbG93ZXIgbGltaXRzLgoJCS8vIElmIHNldCwgdGhlIGludGVydmFsIFsgbWluLCBtYXggXSBtdXN0IGJlIGEgc3ViLWludGVydmFsIG9mIFsgLSAyIFBJLCAyIFBJIF0sIHdpdGggKCBtYXggLSBtaW4gPCAyIFBJICkKCQl0aGlzLm1pbkF6aW11dGhBbmdsZSA9IC0gSW5maW5pdHk7IC8vIHJhZGlhbnMKCQl0aGlzLm1heEF6aW11dGhBbmdsZSA9IEluZmluaXR5OyAvLyByYWRpYW5zCgoJCS8vIFNldCB0byB0cnVlIHRvIGVuYWJsZSBkYW1waW5nIChpbmVydGlhKQoJCS8vIElmIGRhbXBpbmcgaXMgZW5hYmxlZCwgeW91IG11c3QgY2FsbCBjb250cm9scy51cGRhdGUoKSBpbiB5b3VyIGFuaW1hdGlvbiBsb29wCgkJdGhpcy5lbmFibGVEYW1waW5nID0gZmFsc2U7CgkJdGhpcy5kYW1waW5nRmFjdG9yID0gMC4wNTsKCgkJLy8gVGhpcyBvcHRpb24gYWN0dWFsbHkgZW5hYmxlcyBkb2xseWluZyBpbiBhbmQgb3V0OyBsZWZ0IGFzICJ6b29tIiBmb3IgYmFja3dhcmRzIGNvbXBhdGliaWxpdHkuCgkJLy8gU2V0IHRvIGZhbHNlIHRvIGRpc2FibGUgem9vbWluZwoJCXRoaXMuZW5hYmxlWm9vbSA9IHRydWU7CgkJdGhpcy56b29tU3BlZWQgPSAxLjA7CgoJCS8vIFNldCB0byBmYWxzZSB0byBkaXNhYmxlIHJvdGF0aW5nCgkJdGhpcy5lbmFibGVSb3RhdGUgPSB0cnVlOwoJCXRoaXMucm90YXRlU3BlZWQgPSAxLjA7CgoJCS8vIFNldCB0byBmYWxzZSB0byBkaXNhYmxlIHBhbm5pbmcKCQl0aGlzLmVuYWJsZVBhbiA9IHRydWU7CgkJdGhpcy5wYW5TcGVlZCA9IDEuMDsKCQl0aGlzLnNjcmVlblNwYWNlUGFubmluZyA9IHRydWU7IC8vIGlmIGZhbHNlLCBwYW4gb3J0aG9nb25hbCB0byB3b3JsZC1zcGFjZSBkaXJlY3Rpb24gY2FtZXJhLnVwCgkJdGhpcy5rZXlQYW5TcGVlZCA9IDcuMDsJLy8gcGl4ZWxzIG1vdmVkIHBlciBhcnJvdyBrZXkgcHVzaAoJCXRoaXMuem9vbVRvQ3Vyc29yID0gZmFsc2U7CgoJCS8vIFNldCB0byB0cnVlIHRvIGF1dG9tYXRpY2FsbHkgcm90YXRlIGFyb3VuZCB0aGUgdGFyZ2V0CgkJLy8gSWYgYXV0by1yb3RhdGUgaXMgZW5hYmxlZCwgeW91IG11c3QgY2FsbCBjb250cm9scy51cGRhdGUoKSBpbiB5b3VyIGFuaW1hdGlvbiBsb29wCgkJdGhpcy5hdXRvUm90YXRlID0gZmFsc2U7CgkJdGhpcy5hdXRvUm90YXRlU3BlZWQgPSAyLjA7IC8vIDMwIHNlY29uZHMgcGVyIG9yYml0IHdoZW4gZnBzIGlzIDYwCgoJCS8vIFRoZSBmb3VyIGFycm93IGtleXMKCQl0aGlzLmtleXMgPSB7IExFRlQ6ICdBcnJvd0xlZnQnLCBVUDogJ0Fycm93VXAnLCBSSUdIVDogJ0Fycm93UmlnaHQnLCBCT1RUT006ICdBcnJvd0Rvd24nIH07CgoJCS8vIE1vdXNlIGJ1dHRvbnMKCQl0aGlzLm1vdXNlQnV0dG9ucyA9IHsgTEVGVDogTU9VU0UuUk9UQVRFLCBNSURETEU6IE1PVVNFLkRPTExZLCBSSUdIVDogTU9VU0UuUEFOIH07CgoJCS8vIFRvdWNoIGZpbmdlcnMKCQl0aGlzLnRvdWNoZXMgPSB7IE9ORTogVE9VQ0guUk9UQVRFLCBUV086IFRPVUNILkRPTExZX1BBTiB9OwoKCQkvLyBmb3IgcmVzZXQKCQl0aGlzLnRhcmdldDAgPSB0aGlzLnRhcmdldC5jbG9uZSgpOwoJCXRoaXMucG9zaXRpb24wID0gdGhpcy5vYmplY3QucG9zaXRpb24uY2xvbmUoKTsKCQl0aGlzLnpvb20wID0gdGhpcy5vYmplY3Quem9vbTsKCgkJLy8gdGhlIHRhcmdldCBET00gZWxlbWVudCBmb3Iga2V5IGV2ZW50cwoJCXRoaXMuX2RvbUVsZW1lbnRLZXlFdmVudHMgPSBudWxsOwoKCQkvLwoJCS8vIHB1YmxpYyBtZXRob2RzCgkJLy8KCgkJdGhpcy5nZXRQb2xhckFuZ2xlID0gZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIHNwaGVyaWNhbC5waGk7CgoJCX07CgoJCXRoaXMuZ2V0QXppbXV0aGFsQW5nbGUgPSBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gc3BoZXJpY2FsLnRoZXRhOwoKCQl9OwoKCQl0aGlzLmdldERpc3RhbmNlID0gZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIHRoaXMub2JqZWN0LnBvc2l0aW9uLmRpc3RhbmNlVG8oIHRoaXMudGFyZ2V0ICk7CgoJCX07CgoJCXRoaXMubGlzdGVuVG9LZXlFdmVudHMgPSBmdW5jdGlvbiAoIGRvbUVsZW1lbnQgKSB7CgoJCQlkb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoICdrZXlkb3duJywgb25LZXlEb3duICk7CgkJCXRoaXMuX2RvbUVsZW1lbnRLZXlFdmVudHMgPSBkb21FbGVtZW50OwoKCQl9OwoKCQl0aGlzLnN0b3BMaXN0ZW5Ub0tleUV2ZW50cyA9IGZ1bmN0aW9uICgpIHsKCgkJCXRoaXMuX2RvbUVsZW1lbnRLZXlFdmVudHMucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2tleWRvd24nLCBvbktleURvd24gKTsKCQkJdGhpcy5fZG9tRWxlbWVudEtleUV2ZW50cyA9IG51bGw7CgoJCX07CgoJCXRoaXMuc2F2ZVN0YXRlID0gZnVuY3Rpb24gKCkgewoKCQkJc2NvcGUudGFyZ2V0MC5jb3B5KCBzY29wZS50YXJnZXQgKTsKCQkJc2NvcGUucG9zaXRpb24wLmNvcHkoIHNjb3BlLm9iamVjdC5wb3NpdGlvbiApOwoJCQlzY29wZS56b29tMCA9IHNjb3BlLm9iamVjdC56b29tOwoKCQl9OwoKCQl0aGlzLnJlc2V0ID0gZnVuY3Rpb24gKCkgewoKCQkJc2NvcGUudGFyZ2V0LmNvcHkoIHNjb3BlLnRhcmdldDAgKTsKCQkJc2NvcGUub2JqZWN0LnBvc2l0aW9uLmNvcHkoIHNjb3BlLnBvc2l0aW9uMCApOwoJCQlzY29wZS5vYmplY3Quem9vbSA9IHNjb3BlLnpvb20wOwoKCQkJc2NvcGUub2JqZWN0LnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCQkJc2NvcGUuZGlzcGF0Y2hFdmVudCggX2NoYW5nZUV2ZW50ICk7CgoJCQlzY29wZS51cGRhdGUoKTsKCgkJCXN0YXRlID0gU1RBVEUuTk9ORTsKCgkJfTsKCgkJLy8gdGhpcyBtZXRob2QgaXMgZXhwb3NlZCwgYnV0IHBlcmhhcHMgaXQgd291bGQgYmUgYmV0dGVyIGlmIHdlIGNhbiBtYWtlIGl0IHByaXZhdGUuLi4KCQl0aGlzLnVwZGF0ZSA9IGZ1bmN0aW9uICgpIHsKCgkJCWNvbnN0IG9mZnNldCA9IG5ldyBWZWN0b3IzKCk7CgoJCQkvLyBzbyBjYW1lcmEudXAgaXMgdGhlIG9yYml0IGF4aXMKCQkJY29uc3QgcXVhdCA9IG5ldyBRdWF0ZXJuaW9uKCkuc2V0RnJvbVVuaXRWZWN0b3JzKCBvYmplY3QudXAsIG5ldyBWZWN0b3IzKCAwLCAxLCAwICkgKTsKCQkJY29uc3QgcXVhdEludmVyc2UgPSBxdWF0LmNsb25lKCkuaW52ZXJ0KCk7CgoJCQljb25zdCBsYXN0UG9zaXRpb24gPSBuZXcgVmVjdG9yMygpOwoJCQljb25zdCBsYXN0UXVhdGVybmlvbiA9IG5ldyBRdWF0ZXJuaW9uKCk7CgkJCWNvbnN0IGxhc3RUYXJnZXRQb3NpdGlvbiA9IG5ldyBWZWN0b3IzKCk7CgoJCQljb25zdCB0d29QSSA9IDIgKiBNYXRoLlBJOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIHVwZGF0ZSggZGVsdGFUaW1lID0gbnVsbCApIHsKCgkJCQljb25zdCBwb3NpdGlvbiA9IHNjb3BlLm9iamVjdC5wb3NpdGlvbjsKCgkJCQlvZmZzZXQuY29weSggcG9zaXRpb24gKS5zdWIoIHNjb3BlLnRhcmdldCApOwoKCQkJCS8vIHJvdGF0ZSBvZmZzZXQgdG8gInktYXhpcy1pcy11cCIgc3BhY2UKCQkJCW9mZnNldC5hcHBseVF1YXRlcm5pb24oIHF1YXQgKTsKCgkJCQkvLyBhbmdsZSBmcm9tIHotYXhpcyBhcm91bmQgeS1heGlzCgkJCQlzcGhlcmljYWwuc2V0RnJvbVZlY3RvcjMoIG9mZnNldCApOwoKCQkJCWlmICggc2NvcGUuYXV0b1JvdGF0ZSAmJiBzdGF0ZSA9PT0gU1RBVEUuTk9ORSApIHsKCgkJCQkJcm90YXRlTGVmdCggZ2V0QXV0b1JvdGF0aW9uQW5nbGUoIGRlbHRhVGltZSApICk7CgoJCQkJfQoKCQkJCWlmICggc2NvcGUuZW5hYmxlRGFtcGluZyApIHsKCgkJCQkJc3BoZXJpY2FsLnRoZXRhICs9IHNwaGVyaWNhbERlbHRhLnRoZXRhICogc2NvcGUuZGFtcGluZ0ZhY3RvcjsKCQkJCQlzcGhlcmljYWwucGhpICs9IHNwaGVyaWNhbERlbHRhLnBoaSAqIHNjb3BlLmRhbXBpbmdGYWN0b3I7CgoJCQkJfSBlbHNlIHsKCgkJCQkJc3BoZXJpY2FsLnRoZXRhICs9IHNwaGVyaWNhbERlbHRhLnRoZXRhOwoJCQkJCXNwaGVyaWNhbC5waGkgKz0gc3BoZXJpY2FsRGVsdGEucGhpOwoKCQkJCX0KCgkJCQkvLyByZXN0cmljdCB0aGV0YSB0byBiZSBiZXR3ZWVuIGRlc2lyZWQgbGltaXRzCgoJCQkJbGV0IG1pbiA9IHNjb3BlLm1pbkF6aW11dGhBbmdsZTsKCQkJCWxldCBtYXggPSBzY29wZS5tYXhBemltdXRoQW5nbGU7CgoJCQkJaWYgKCBpc0Zpbml0ZSggbWluICkgJiYgaXNGaW5pdGUoIG1heCApICkgewoKCQkJCQlpZiAoIG1pbiA8IC0gTWF0aC5QSSApIG1pbiArPSB0d29QSTsgZWxzZSBpZiAoIG1pbiA+IE1hdGguUEkgKSBtaW4gLT0gdHdvUEk7CgoJCQkJCWlmICggbWF4IDwgLSBNYXRoLlBJICkgbWF4ICs9IHR3b1BJOyBlbHNlIGlmICggbWF4ID4gTWF0aC5QSSApIG1heCAtPSB0d29QSTsKCgkJCQkJaWYgKCBtaW4gPD0gbWF4ICkgewoKCQkJCQkJc3BoZXJpY2FsLnRoZXRhID0gTWF0aC5tYXgoIG1pbiwgTWF0aC5taW4oIG1heCwgc3BoZXJpY2FsLnRoZXRhICkgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXNwaGVyaWNhbC50aGV0YSA9ICggc3BoZXJpY2FsLnRoZXRhID4gKCBtaW4gKyBtYXggKSAvIDIgKSA/CgkJCQkJCQlNYXRoLm1heCggbWluLCBzcGhlcmljYWwudGhldGEgKSA6CgkJCQkJCQlNYXRoLm1pbiggbWF4LCBzcGhlcmljYWwudGhldGEgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQkvLyByZXN0cmljdCBwaGkgdG8gYmUgYmV0d2VlbiBkZXNpcmVkIGxpbWl0cwoJCQkJc3BoZXJpY2FsLnBoaSA9IE1hdGgubWF4KCBzY29wZS5taW5Qb2xhckFuZ2xlLCBNYXRoLm1pbiggc2NvcGUubWF4UG9sYXJBbmdsZSwgc3BoZXJpY2FsLnBoaSApICk7CgoJCQkJc3BoZXJpY2FsLm1ha2VTYWZlKCk7CgoKCQkJCS8vIG1vdmUgdGFyZ2V0IHRvIHBhbm5lZCBsb2NhdGlvbgoKCQkJCWlmICggc2NvcGUuZW5hYmxlRGFtcGluZyA9PT0gdHJ1ZSApIHsKCgkJCQkJc2NvcGUudGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggcGFuT2Zmc2V0LCBzY29wZS5kYW1waW5nRmFjdG9yICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJc2NvcGUudGFyZ2V0LmFkZCggcGFuT2Zmc2V0ICk7CgoJCQkJfQoKCQkJCS8vIGFkanVzdCB0aGUgY2FtZXJhIHBvc2l0aW9uIGJhc2VkIG9uIHpvb20gb25seSBpZiB3ZSdyZSBub3Qgem9vbWluZyB0byB0aGUgY3Vyc29yIG9yIGlmIGl0J3MgYW4gb3J0aG8gY2FtZXJhCgkJCQkvLyB3ZSBhZGp1c3Qgem9vbSBsYXRlciBpbiB0aGVzZSBjYXNlcwoJCQkJaWYgKCBzY29wZS56b29tVG9DdXJzb3IgJiYgcGVyZm9ybUN1cnNvclpvb20gfHwgc2NvcGUub2JqZWN0LmlzT3J0aG9ncmFwaGljQ2FtZXJhICkgewoKCQkJCQlzcGhlcmljYWwucmFkaXVzID0gY2xhbXBEaXN0YW5jZSggc3BoZXJpY2FsLnJhZGl1cyApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXNwaGVyaWNhbC5yYWRpdXMgPSBjbGFtcERpc3RhbmNlKCBzcGhlcmljYWwucmFkaXVzICogc2NhbGUgKTsKCgkJCQl9CgoKCQkJCW9mZnNldC5zZXRGcm9tU3BoZXJpY2FsKCBzcGhlcmljYWwgKTsKCgkJCQkvLyByb3RhdGUgb2Zmc2V0IGJhY2sgdG8gImNhbWVyYS11cC12ZWN0b3ItaXMtdXAiIHNwYWNlCgkJCQlvZmZzZXQuYXBwbHlRdWF0ZXJuaW9uKCBxdWF0SW52ZXJzZSApOwoKCQkJCXBvc2l0aW9uLmNvcHkoIHNjb3BlLnRhcmdldCApLmFkZCggb2Zmc2V0ICk7CgoJCQkJc2NvcGUub2JqZWN0Lmxvb2tBdCggc2NvcGUudGFyZ2V0ICk7CgoJCQkJaWYgKCBzY29wZS5lbmFibGVEYW1waW5nID09PSB0cnVlICkgewoKCQkJCQlzcGhlcmljYWxEZWx0YS50aGV0YSAqPSAoIDEgLSBzY29wZS5kYW1waW5nRmFjdG9yICk7CgkJCQkJc3BoZXJpY2FsRGVsdGEucGhpICo9ICggMSAtIHNjb3BlLmRhbXBpbmdGYWN0b3IgKTsKCgkJCQkJcGFuT2Zmc2V0Lm11bHRpcGx5U2NhbGFyKCAxIC0gc2NvcGUuZGFtcGluZ0ZhY3RvciApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXNwaGVyaWNhbERlbHRhLnNldCggMCwgMCwgMCApOwoKCQkJCQlwYW5PZmZzZXQuc2V0KCAwLCAwLCAwICk7CgoJCQkJfQoKCQkJCS8vIGFkanVzdCBjYW1lcmEgcG9zaXRpb24KCQkJCWxldCB6b29tQ2hhbmdlZCA9IGZhbHNlOwoJCQkJaWYgKCBzY29wZS56b29tVG9DdXJzb3IgJiYgcGVyZm9ybUN1cnNvclpvb20gKSB7CgoJCQkJCWxldCBuZXdSYWRpdXMgPSBudWxsOwoJCQkJCWlmICggc2NvcGUub2JqZWN0LmlzUGVyc3BlY3RpdmVDYW1lcmEgKSB7CgoJCQkJCQkvLyBtb3ZlIHRoZSBjYW1lcmEgZG93biB0aGUgcG9pbnRlciByYXkKCQkJCQkJLy8gdGhpcyBtZXRob2QgYXZvaWRzIGZsb2F0aW5nIHBvaW50IGVycm9yCgkJCQkJCWNvbnN0IHByZXZSYWRpdXMgPSBvZmZzZXQubGVuZ3RoKCk7CgkJCQkJCW5ld1JhZGl1cyA9IGNsYW1wRGlzdGFuY2UoIHByZXZSYWRpdXMgKiBzY2FsZSApOwoKCQkJCQkJY29uc3QgcmFkaXVzRGVsdGEgPSBwcmV2UmFkaXVzIC0gbmV3UmFkaXVzOwoJCQkJCQlzY29wZS5vYmplY3QucG9zaXRpb24uYWRkU2NhbGVkVmVjdG9yKCBkb2xseURpcmVjdGlvbiwgcmFkaXVzRGVsdGEgKTsKCQkJCQkJc2NvcGUub2JqZWN0LnVwZGF0ZU1hdHJpeFdvcmxkKCk7CgoJCQkJCX0gZWxzZSBpZiAoIHNjb3BlLm9iamVjdC5pc09ydGhvZ3JhcGhpY0NhbWVyYSApIHsKCgkJCQkJCS8vIGFkanVzdCB0aGUgb3J0aG8gY2FtZXJhIHBvc2l0aW9uIGJhc2VkIG9uIHpvb20gY2hhbmdlcwoJCQkJCQljb25zdCBtb3VzZUJlZm9yZSA9IG5ldyBWZWN0b3IzKCBtb3VzZS54LCBtb3VzZS55LCAwICk7CgkJCQkJCW1vdXNlQmVmb3JlLnVucHJvamVjdCggc2NvcGUub2JqZWN0ICk7CgoJCQkJCQlzY29wZS5vYmplY3Quem9vbSA9IE1hdGgubWF4KCBzY29wZS5taW5ab29tLCBNYXRoLm1pbiggc2NvcGUubWF4Wm9vbSwgc2NvcGUub2JqZWN0Lnpvb20gLyBzY2FsZSApICk7CgkJCQkJCXNjb3BlLm9iamVjdC51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CgkJCQkJCXpvb21DaGFuZ2VkID0gdHJ1ZTsKCgkJCQkJCWNvbnN0IG1vdXNlQWZ0ZXIgPSBuZXcgVmVjdG9yMyggbW91c2UueCwgbW91c2UueSwgMCApOwoJCQkJCQltb3VzZUFmdGVyLnVucHJvamVjdCggc2NvcGUub2JqZWN0ICk7CgoJCQkJCQlzY29wZS5vYmplY3QucG9zaXRpb24uc3ViKCBtb3VzZUFmdGVyICkuYWRkKCBtb3VzZUJlZm9yZSApOwoJCQkJCQlzY29wZS5vYmplY3QudXBkYXRlTWF0cml4V29ybGQoKTsKCgkJCQkJCW5ld1JhZGl1cyA9IG9mZnNldC5sZW5ndGgoKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWNvbnNvbGUud2FybiggJ1dBUk5JTkc6IE9yYml0Q29udHJvbHMuanMgZW5jb3VudGVyZWQgYW4gdW5rbm93biBjYW1lcmEgdHlwZSAtIHpvb20gdG8gY3Vyc29yIGRpc2FibGVkLicgKTsKCQkJCQkJc2NvcGUuem9vbVRvQ3Vyc29yID0gZmFsc2U7CgoJCQkJCX0KCgkJCQkJLy8gaGFuZGxlIHRoZSBwbGFjZW1lbnQgb2YgdGhlIHRhcmdldAoJCQkJCWlmICggbmV3UmFkaXVzICE9PSBudWxsICkgewoKCQkJCQkJaWYgKCB0aGlzLnNjcmVlblNwYWNlUGFubmluZyApIHsKCgkJCQkJCQkvLyBwb3NpdGlvbiB0aGUgb3JiaXQgdGFyZ2V0IGluIGZyb250IG9mIHRoZSBuZXcgY2FtZXJhIHBvc2l0aW9uCgkJCQkJCQlzY29wZS50YXJnZXQuc2V0KCAwLCAwLCAtIDEgKQoJCQkJCQkJCS50cmFuc2Zvcm1EaXJlY3Rpb24oIHNjb3BlLm9iamVjdC5tYXRyaXggKQoJCQkJCQkJCS5tdWx0aXBseVNjYWxhciggbmV3UmFkaXVzICkKCQkJCQkJCQkuYWRkKCBzY29wZS5vYmplY3QucG9zaXRpb24gKTsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJLy8gZ2V0IHRoZSByYXkgYW5kIHRyYW5zbGF0aW9uIHBsYW5lIHRvIGNvbXB1dGUgdGFyZ2V0CgkJCQkJCQlfcmF5Lm9yaWdpbi5jb3B5KCBzY29wZS5vYmplY3QucG9zaXRpb24gKTsKCQkJCQkJCV9yYXkuZGlyZWN0aW9uLnNldCggMCwgMCwgLSAxICkudHJhbnNmb3JtRGlyZWN0aW9uKCBzY29wZS5vYmplY3QubWF0cml4ICk7CgoJCQkJCQkJLy8gaWYgdGhlIGNhbWVyYSBpcyAyMCBkZWdyZWVzIGFib3ZlIHRoZSBob3Jpem9uIHRoZW4gZG9uJ3QgYWRqdXN0IHRoZSBmb2N1cyB0YXJnZXQgdG8gYXZvaWQKCQkJCQkJCS8vIGV4dHJlbWVseSBsYXJnZSB2YWx1ZXMKCQkJCQkJCWlmICggTWF0aC5hYnMoIHNjb3BlLm9iamVjdC51cC5kb3QoIF9yYXkuZGlyZWN0aW9uICkgKSA8IFRJTFRfTElNSVQgKSB7CgoJCQkJCQkJCW9iamVjdC5sb29rQXQoIHNjb3BlLnRhcmdldCApOwoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCV9wbGFuZS5zZXRGcm9tTm9ybWFsQW5kQ29wbGFuYXJQb2ludCggc2NvcGUub2JqZWN0LnVwLCBzY29wZS50YXJnZXQgKTsKCQkJCQkJCQlfcmF5LmludGVyc2VjdFBsYW5lKCBfcGxhbmUsIHNjb3BlLnRhcmdldCApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0gZWxzZSBpZiAoIHNjb3BlLm9iamVjdC5pc09ydGhvZ3JhcGhpY0NhbWVyYSApIHsKCgkJCQkJc2NvcGUub2JqZWN0Lnpvb20gPSBNYXRoLm1heCggc2NvcGUubWluWm9vbSwgTWF0aC5taW4oIHNjb3BlLm1heFpvb20sIHNjb3BlLm9iamVjdC56b29tIC8gc2NhbGUgKSApOwoJCQkJCXNjb3BlLm9iamVjdC51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CgkJCQkJem9vbUNoYW5nZWQgPSB0cnVlOwoKCQkJCX0KCgkJCQlzY2FsZSA9IDE7CgkJCQlwZXJmb3JtQ3Vyc29yWm9vbSA9IGZhbHNlOwoKCQkJCS8vIHVwZGF0ZSBjb25kaXRpb24gaXM6CgkJCQkvLyBtaW4oY2FtZXJhIGRpc3BsYWNlbWVudCwgY2FtZXJhIHJvdGF0aW9uIGluIHJhZGlhbnMpXjIgPiBFUFMKCQkJCS8vIHVzaW5nIHNtYWxsLWFuZ2xlIGFwcHJveGltYXRpb24gY29zKHgvMikgPSAxIC0geF4yIC8gOAoKCQkJCWlmICggem9vbUNoYW5nZWQgfHwKCQkJCQlsYXN0UG9zaXRpb24uZGlzdGFuY2VUb1NxdWFyZWQoIHNjb3BlLm9iamVjdC5wb3NpdGlvbiApID4gRVBTIHx8CgkJCQkJOCAqICggMSAtIGxhc3RRdWF0ZXJuaW9uLmRvdCggc2NvcGUub2JqZWN0LnF1YXRlcm5pb24gKSApID4gRVBTIHx8CgkJCQkJbGFzdFRhcmdldFBvc2l0aW9uLmRpc3RhbmNlVG9TcXVhcmVkKCBzY29wZS50YXJnZXQgKSA+IDAgKSB7CgoJCQkJCXNjb3BlLmRpc3BhdGNoRXZlbnQoIF9jaGFuZ2VFdmVudCApOwoKCQkJCQlsYXN0UG9zaXRpb24uY29weSggc2NvcGUub2JqZWN0LnBvc2l0aW9uICk7CgkJCQkJbGFzdFF1YXRlcm5pb24uY29weSggc2NvcGUub2JqZWN0LnF1YXRlcm5pb24gKTsKCQkJCQlsYXN0VGFyZ2V0UG9zaXRpb24uY29weSggc2NvcGUudGFyZ2V0ICk7CgoJCQkJCXpvb21DaGFuZ2VkID0gZmFsc2U7CgoJCQkJCXJldHVybiB0cnVlOwoKCQkJCX0KCgkJCQlyZXR1cm4gZmFsc2U7CgoJCQl9OwoKCQl9KCk7CgoJCXRoaXMuZGlzcG9zZSA9IGZ1bmN0aW9uICgpIHsKCgkJCXNjb3BlLmRvbUVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2NvbnRleHRtZW51Jywgb25Db250ZXh0TWVudSApOwoKCQkJc2NvcGUuZG9tRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCAncG9pbnRlcmRvd24nLCBvblBvaW50ZXJEb3duICk7CgkJCXNjb3BlLmRvbUVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3BvaW50ZXJjYW5jZWwnLCBvblBvaW50ZXJVcCApOwoJCQlzY29wZS5kb21FbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoICd3aGVlbCcsIG9uTW91c2VXaGVlbCApOwoKCQkJc2NvcGUuZG9tRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCAncG9pbnRlcm1vdmUnLCBvblBvaW50ZXJNb3ZlICk7CgkJCXNjb3BlLmRvbUVsZW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3BvaW50ZXJ1cCcsIG9uUG9pbnRlclVwICk7CgoKCQkJaWYgKCBzY29wZS5fZG9tRWxlbWVudEtleUV2ZW50cyAhPT0gbnVsbCApIHsKCgkJCQlzY29wZS5fZG9tRWxlbWVudEtleUV2ZW50cy5yZW1vdmVFdmVudExpc3RlbmVyKCAna2V5ZG93bicsIG9uS2V5RG93biApOwoJCQkJc2NvcGUuX2RvbUVsZW1lbnRLZXlFdmVudHMgPSBudWxsOwoKCQkJfQoKCQkJLy9zY29wZS5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdkaXNwb3NlJyB9ICk7IC8vIHNob3VsZCB0aGlzIGJlIGFkZGVkIGhlcmU/CgoJCX07CgoJCS8vCgkJLy8gaW50ZXJuYWxzCgkJLy8KCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQljb25zdCBTVEFURSA9IHsKCQkJTk9ORTogLSAxLAoJCQlST1RBVEU6IDAsCgkJCURPTExZOiAxLAoJCQlQQU46IDIsCgkJCVRPVUNIX1JPVEFURTogMywKCQkJVE9VQ0hfUEFOOiA0LAoJCQlUT1VDSF9ET0xMWV9QQU46IDUsCgkJCVRPVUNIX0RPTExZX1JPVEFURTogNgoJCX07CgoJCWxldCBzdGF0ZSA9IFNUQVRFLk5PTkU7CgoJCWNvbnN0IEVQUyA9IDAuMDAwMDAxOwoKCQkvLyBjdXJyZW50IHBvc2l0aW9uIGluIHNwaGVyaWNhbCBjb29yZGluYXRlcwoJCWNvbnN0IHNwaGVyaWNhbCA9IG5ldyBTcGhlcmljYWwoKTsKCQljb25zdCBzcGhlcmljYWxEZWx0YSA9IG5ldyBTcGhlcmljYWwoKTsKCgkJbGV0IHNjYWxlID0gMTsKCQljb25zdCBwYW5PZmZzZXQgPSBuZXcgVmVjdG9yMygpOwoKCQljb25zdCByb3RhdGVTdGFydCA9IG5ldyBWZWN0b3IyKCk7CgkJY29uc3Qgcm90YXRlRW5kID0gbmV3IFZlY3RvcjIoKTsKCQljb25zdCByb3RhdGVEZWx0YSA9IG5ldyBWZWN0b3IyKCk7CgoJCWNvbnN0IHBhblN0YXJ0ID0gbmV3IFZlY3RvcjIoKTsKCQljb25zdCBwYW5FbmQgPSBuZXcgVmVjdG9yMigpOwoJCWNvbnN0IHBhbkRlbHRhID0gbmV3IFZlY3RvcjIoKTsKCgkJY29uc3QgZG9sbHlTdGFydCA9IG5ldyBWZWN0b3IyKCk7CgkJY29uc3QgZG9sbHlFbmQgPSBuZXcgVmVjdG9yMigpOwoJCWNvbnN0IGRvbGx5RGVsdGEgPSBuZXcgVmVjdG9yMigpOwoKCQljb25zdCBkb2xseURpcmVjdGlvbiA9IG5ldyBWZWN0b3IzKCk7CgkJY29uc3QgbW91c2UgPSBuZXcgVmVjdG9yMigpOwoJCWxldCBwZXJmb3JtQ3Vyc29yWm9vbSA9IGZhbHNlOwoKCQljb25zdCBwb2ludGVycyA9IFtdOwoJCWNvbnN0IHBvaW50ZXJQb3NpdGlvbnMgPSB7fTsKCgkJZnVuY3Rpb24gZ2V0QXV0b1JvdGF0aW9uQW5nbGUoIGRlbHRhVGltZSApIHsKCgkJCWlmICggZGVsdGFUaW1lICE9PSBudWxsICkgewoKCQkJCXJldHVybiAoIDIgKiBNYXRoLlBJIC8gNjAgKiBzY29wZS5hdXRvUm90YXRlU3BlZWQgKSAqIGRlbHRhVGltZTsKCgkJCX0gZWxzZSB7CgoJCQkJcmV0dXJuIDIgKiBNYXRoLlBJIC8gNjAgLyA2MCAqIHNjb3BlLmF1dG9Sb3RhdGVTcGVlZDsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBnZXRab29tU2NhbGUoKSB7CgoJCQlyZXR1cm4gTWF0aC5wb3coIDAuOTUsIHNjb3BlLnpvb21TcGVlZCApOwoKCQl9CgoJCWZ1bmN0aW9uIHJvdGF0ZUxlZnQoIGFuZ2xlICkgewoKCQkJc3BoZXJpY2FsRGVsdGEudGhldGEgLT0gYW5nbGU7CgoJCX0KCgkJZnVuY3Rpb24gcm90YXRlVXAoIGFuZ2xlICkgewoKCQkJc3BoZXJpY2FsRGVsdGEucGhpIC09IGFuZ2xlOwoKCQl9CgoJCWNvbnN0IHBhbkxlZnQgPSBmdW5jdGlvbiAoKSB7CgoJCQljb25zdCB2ID0gbmV3IFZlY3RvcjMoKTsKCgkJCXJldHVybiBmdW5jdGlvbiBwYW5MZWZ0KCBkaXN0YW5jZSwgb2JqZWN0TWF0cml4ICkgewoKCQkJCXYuc2V0RnJvbU1hdHJpeENvbHVtbiggb2JqZWN0TWF0cml4LCAwICk7IC8vIGdldCBYIGNvbHVtbiBvZiBvYmplY3RNYXRyaXgKCQkJCXYubXVsdGlwbHlTY2FsYXIoIC0gZGlzdGFuY2UgKTsKCgkJCQlwYW5PZmZzZXQuYWRkKCB2ICk7CgoJCQl9OwoKCQl9KCk7CgoJCWNvbnN0IHBhblVwID0gZnVuY3Rpb24gKCkgewoKCQkJY29uc3QgdiA9IG5ldyBWZWN0b3IzKCk7CgoJCQlyZXR1cm4gZnVuY3Rpb24gcGFuVXAoIGRpc3RhbmNlLCBvYmplY3RNYXRyaXggKSB7CgoJCQkJaWYgKCBzY29wZS5zY3JlZW5TcGFjZVBhbm5pbmcgPT09IHRydWUgKSB7CgoJCQkJCXYuc2V0RnJvbU1hdHJpeENvbHVtbiggb2JqZWN0TWF0cml4LCAxICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJdi5zZXRGcm9tTWF0cml4Q29sdW1uKCBvYmplY3RNYXRyaXgsIDAgKTsKCQkJCQl2LmNyb3NzVmVjdG9ycyggc2NvcGUub2JqZWN0LnVwLCB2ICk7CgoJCQkJfQoKCQkJCXYubXVsdGlwbHlTY2FsYXIoIGRpc3RhbmNlICk7CgoJCQkJcGFuT2Zmc2V0LmFkZCggdiApOwoKCQkJfTsKCgkJfSgpOwoKCQkvLyBkZWx0YVggYW5kIGRlbHRhWSBhcmUgaW4gcGl4ZWxzOyByaWdodCBhbmQgZG93biBhcmUgcG9zaXRpdmUKCQljb25zdCBwYW4gPSBmdW5jdGlvbiAoKSB7CgoJCQljb25zdCBvZmZzZXQgPSBuZXcgVmVjdG9yMygpOwoKCQkJcmV0dXJuIGZ1bmN0aW9uIHBhbiggZGVsdGFYLCBkZWx0YVkgKSB7CgoJCQkJY29uc3QgZWxlbWVudCA9IHNjb3BlLmRvbUVsZW1lbnQ7CgoJCQkJaWYgKCBzY29wZS5vYmplY3QuaXNQZXJzcGVjdGl2ZUNhbWVyYSApIHsKCgkJCQkJLy8gcGVyc3BlY3RpdmUKCQkJCQljb25zdCBwb3NpdGlvbiA9IHNjb3BlLm9iamVjdC5wb3NpdGlvbjsKCQkJCQlvZmZzZXQuY29weSggcG9zaXRpb24gKS5zdWIoIHNjb3BlLnRhcmdldCApOwoJCQkJCWxldCB0YXJnZXREaXN0YW5jZSA9IG9mZnNldC5sZW5ndGgoKTsKCgkJCQkJLy8gaGFsZiBvZiB0aGUgZm92IGlzIGNlbnRlciB0byB0b3Agb2Ygc2NyZWVuCgkJCQkJdGFyZ2V0RGlzdGFuY2UgKj0gTWF0aC50YW4oICggc2NvcGUub2JqZWN0LmZvdiAvIDIgKSAqIE1hdGguUEkgLyAxODAuMCApOwoKCQkJCQkvLyB3ZSB1c2Ugb25seSBjbGllbnRIZWlnaHQgaGVyZSBzbyBhc3BlY3QgcmF0aW8gZG9lcyBub3QgZGlzdG9ydCBzcGVlZAoJCQkJCXBhbkxlZnQoIDIgKiBkZWx0YVggKiB0YXJnZXREaXN0YW5jZSAvIGVsZW1lbnQuY2xpZW50SGVpZ2h0LCBzY29wZS5vYmplY3QubWF0cml4ICk7CgkJCQkJcGFuVXAoIDIgKiBkZWx0YVkgKiB0YXJnZXREaXN0YW5jZSAvIGVsZW1lbnQuY2xpZW50SGVpZ2h0LCBzY29wZS5vYmplY3QubWF0cml4ICk7CgoJCQkJfSBlbHNlIGlmICggc2NvcGUub2JqZWN0LmlzT3J0aG9ncmFwaGljQ2FtZXJhICkgewoKCQkJCQkvLyBvcnRob2dyYXBoaWMKCQkJCQlwYW5MZWZ0KCBkZWx0YVggKiAoIHNjb3BlLm9iamVjdC5yaWdodCAtIHNjb3BlLm9iamVjdC5sZWZ0ICkgLyBzY29wZS5vYmplY3Quem9vbSAvIGVsZW1lbnQuY2xpZW50V2lkdGgsIHNjb3BlLm9iamVjdC5tYXRyaXggKTsKCQkJCQlwYW5VcCggZGVsdGFZICogKCBzY29wZS5vYmplY3QudG9wIC0gc2NvcGUub2JqZWN0LmJvdHRvbSApIC8gc2NvcGUub2JqZWN0Lnpvb20gLyBlbGVtZW50LmNsaWVudEhlaWdodCwgc2NvcGUub2JqZWN0Lm1hdHJpeCApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCS8vIGNhbWVyYSBuZWl0aGVyIG9ydGhvZ3JhcGhpYyBub3IgcGVyc3BlY3RpdmUKCQkJCQljb25zb2xlLndhcm4oICdXQVJOSU5HOiBPcmJpdENvbnRyb2xzLmpzIGVuY291bnRlcmVkIGFuIHVua25vd24gY2FtZXJhIHR5cGUgLSBwYW4gZGlzYWJsZWQuJyApOwoJCQkJCXNjb3BlLmVuYWJsZVBhbiA9IGZhbHNlOwoKCQkJCX0KCgkJCX07CgoJCX0oKTsKCgkJZnVuY3Rpb24gZG9sbHlPdXQoIGRvbGx5U2NhbGUgKSB7CgoJCQlpZiAoIHNjb3BlLm9iamVjdC5pc1BlcnNwZWN0aXZlQ2FtZXJhIHx8IHNjb3BlLm9iamVjdC5pc09ydGhvZ3JhcGhpY0NhbWVyYSApIHsKCgkJCQlzY2FsZSAvPSBkb2xseVNjYWxlOwoKCQkJfSBlbHNlIHsKCgkJCQljb25zb2xlLndhcm4oICdXQVJOSU5HOiBPcmJpdENvbnRyb2xzLmpzIGVuY291bnRlcmVkIGFuIHVua25vd24gY2FtZXJhIHR5cGUgLSBkb2xseS96b29tIGRpc2FibGVkLicgKTsKCQkJCXNjb3BlLmVuYWJsZVpvb20gPSBmYWxzZTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBkb2xseUluKCBkb2xseVNjYWxlICkgewoKCQkJaWYgKCBzY29wZS5vYmplY3QuaXNQZXJzcGVjdGl2ZUNhbWVyYSB8fCBzY29wZS5vYmplY3QuaXNPcnRob2dyYXBoaWNDYW1lcmEgKSB7CgoJCQkJc2NhbGUgKj0gZG9sbHlTY2FsZTsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc29sZS53YXJuKCAnV0FSTklORzogT3JiaXRDb250cm9scy5qcyBlbmNvdW50ZXJlZCBhbiB1bmtub3duIGNhbWVyYSB0eXBlIC0gZG9sbHkvem9vbSBkaXNhYmxlZC4nICk7CgkJCQlzY29wZS5lbmFibGVab29tID0gZmFsc2U7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gdXBkYXRlTW91c2VQYXJhbWV0ZXJzKCBldmVudCApIHsKCgkJCWlmICggISBzY29wZS56b29tVG9DdXJzb3IgKSB7CgoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJcGVyZm9ybUN1cnNvclpvb20gPSB0cnVlOwoKCQkJY29uc3QgcmVjdCA9IHNjb3BlLmRvbUVsZW1lbnQuZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7CgkJCWNvbnN0IHggPSBldmVudC5jbGllbnRYIC0gcmVjdC5sZWZ0OwoJCQljb25zdCB5ID0gZXZlbnQuY2xpZW50WSAtIHJlY3QudG9wOwoJCQljb25zdCB3ID0gcmVjdC53aWR0aDsKCQkJY29uc3QgaCA9IHJlY3QuaGVpZ2h0OwoKCQkJbW91c2UueCA9ICggeCAvIHcgKSAqIDIgLSAxOwoJCQltb3VzZS55ID0gLSAoIHkgLyBoICkgKiAyICsgMTsKCgkJCWRvbGx5RGlyZWN0aW9uLnNldCggbW91c2UueCwgbW91c2UueSwgMSApLnVucHJvamVjdCggc2NvcGUub2JqZWN0ICkuc3ViKCBzY29wZS5vYmplY3QucG9zaXRpb24gKS5ub3JtYWxpemUoKTsKCgkJfQoKCQlmdW5jdGlvbiBjbGFtcERpc3RhbmNlKCBkaXN0ICkgewoKCQkJcmV0dXJuIE1hdGgubWF4KCBzY29wZS5taW5EaXN0YW5jZSwgTWF0aC5taW4oIHNjb3BlLm1heERpc3RhbmNlLCBkaXN0ICkgKTsKCgkJfQoKCQkvLwoJCS8vIGV2ZW50IGNhbGxiYWNrcyAtIHVwZGF0ZSB0aGUgb2JqZWN0IHN0YXRlCgkJLy8KCgkJZnVuY3Rpb24gaGFuZGxlTW91c2VEb3duUm90YXRlKCBldmVudCApIHsKCgkJCXJvdGF0ZVN0YXJ0LnNldCggZXZlbnQuY2xpZW50WCwgZXZlbnQuY2xpZW50WSApOwoKCQl9CgoJCWZ1bmN0aW9uIGhhbmRsZU1vdXNlRG93bkRvbGx5KCBldmVudCApIHsKCgkJCXVwZGF0ZU1vdXNlUGFyYW1ldGVycyggZXZlbnQgKTsKCQkJZG9sbHlTdGFydC5zZXQoIGV2ZW50LmNsaWVudFgsIGV2ZW50LmNsaWVudFkgKTsKCgkJfQoKCQlmdW5jdGlvbiBoYW5kbGVNb3VzZURvd25QYW4oIGV2ZW50ICkgewoKCQkJcGFuU3RhcnQuc2V0KCBldmVudC5jbGllbnRYLCBldmVudC5jbGllbnRZICk7CgoJCX0KCgkJZnVuY3Rpb24gaGFuZGxlTW91c2VNb3ZlUm90YXRlKCBldmVudCApIHsKCgkJCXJvdGF0ZUVuZC5zZXQoIGV2ZW50LmNsaWVudFgsIGV2ZW50LmNsaWVudFkgKTsKCgkJCXJvdGF0ZURlbHRhLnN1YlZlY3RvcnMoIHJvdGF0ZUVuZCwgcm90YXRlU3RhcnQgKS5tdWx0aXBseVNjYWxhciggc2NvcGUucm90YXRlU3BlZWQgKTsKCgkJCWNvbnN0IGVsZW1lbnQgPSBzY29wZS5kb21FbGVtZW50OwoKCQkJcm90YXRlTGVmdCggMiAqIE1hdGguUEkgKiByb3RhdGVEZWx0YS54IC8gZWxlbWVudC5jbGllbnRIZWlnaHQgKTsgLy8geWVzLCBoZWlnaHQKCgkJCXJvdGF0ZVVwKCAyICogTWF0aC5QSSAqIHJvdGF0ZURlbHRhLnkgLyBlbGVtZW50LmNsaWVudEhlaWdodCApOwoKCQkJcm90YXRlU3RhcnQuY29weSggcm90YXRlRW5kICk7CgoJCQlzY29wZS51cGRhdGUoKTsKCgkJfQoKCQlmdW5jdGlvbiBoYW5kbGVNb3VzZU1vdmVEb2xseSggZXZlbnQgKSB7CgoJCQlkb2xseUVuZC5zZXQoIGV2ZW50LmNsaWVudFgsIGV2ZW50LmNsaWVudFkgKTsKCgkJCWRvbGx5RGVsdGEuc3ViVmVjdG9ycyggZG9sbHlFbmQsIGRvbGx5U3RhcnQgKTsKCgkJCWlmICggZG9sbHlEZWx0YS55ID4gMCApIHsKCgkJCQlkb2xseU91dCggZ2V0Wm9vbVNjYWxlKCkgKTsKCgkJCX0gZWxzZSBpZiAoIGRvbGx5RGVsdGEueSA8IDAgKSB7CgoJCQkJZG9sbHlJbiggZ2V0Wm9vbVNjYWxlKCkgKTsKCgkJCX0KCgkJCWRvbGx5U3RhcnQuY29weSggZG9sbHlFbmQgKTsKCgkJCXNjb3BlLnVwZGF0ZSgpOwoKCQl9CgoJCWZ1bmN0aW9uIGhhbmRsZU1vdXNlTW92ZVBhbiggZXZlbnQgKSB7CgoJCQlwYW5FbmQuc2V0KCBldmVudC5jbGllbnRYLCBldmVudC5jbGllbnRZICk7CgoJCQlwYW5EZWx0YS5zdWJWZWN0b3JzKCBwYW5FbmQsIHBhblN0YXJ0ICkubXVsdGlwbHlTY2FsYXIoIHNjb3BlLnBhblNwZWVkICk7CgoJCQlwYW4oIHBhbkRlbHRhLngsIHBhbkRlbHRhLnkgKTsKCgkJCXBhblN0YXJ0LmNvcHkoIHBhbkVuZCApOwoKCQkJc2NvcGUudXBkYXRlKCk7CgoJCX0KCgkJZnVuY3Rpb24gaGFuZGxlTW91c2VXaGVlbCggZXZlbnQgKSB7CgoJCQl1cGRhdGVNb3VzZVBhcmFtZXRlcnMoIGV2ZW50ICk7CgoJCQlpZiAoIGV2ZW50LmRlbHRhWSA8IDAgKSB7CgoJCQkJZG9sbHlJbiggZ2V0Wm9vbVNjYWxlKCkgKTsKCgkJCX0gZWxzZSBpZiAoIGV2ZW50LmRlbHRhWSA+IDAgKSB7CgoJCQkJZG9sbHlPdXQoIGdldFpvb21TY2FsZSgpICk7CgoJCQl9CgoJCQlzY29wZS51cGRhdGUoKTsKCgkJfQoKCQlmdW5jdGlvbiBoYW5kbGVLZXlEb3duKCBldmVudCApIHsKCgkJCWxldCBuZWVkc1VwZGF0ZSA9IGZhbHNlOwoKCQkJc3dpdGNoICggZXZlbnQuY29kZSApIHsKCgkJCQljYXNlIHNjb3BlLmtleXMuVVA6CgoJCQkJCWlmICggZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5IHx8IGV2ZW50LnNoaWZ0S2V5ICkgewoKCQkJCQkJcm90YXRlVXAoIDIgKiBNYXRoLlBJICogc2NvcGUucm90YXRlU3BlZWQgLyBzY29wZS5kb21FbGVtZW50LmNsaWVudEhlaWdodCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJcGFuKCAwLCBzY29wZS5rZXlQYW5TcGVlZCApOwoKCQkJCQl9CgoJCQkJCW5lZWRzVXBkYXRlID0gdHJ1ZTsKCQkJCQlicmVhazsKCgkJCQljYXNlIHNjb3BlLmtleXMuQk9UVE9NOgoKCQkJCQlpZiAoIGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleSB8fCBldmVudC5zaGlmdEtleSApIHsKCgkJCQkJCXJvdGF0ZVVwKCAtIDIgKiBNYXRoLlBJICogc2NvcGUucm90YXRlU3BlZWQgLyBzY29wZS5kb21FbGVtZW50LmNsaWVudEhlaWdodCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJcGFuKCAwLCAtIHNjb3BlLmtleVBhblNwZWVkICk7CgoJCQkJCX0KCgkJCQkJbmVlZHNVcGRhdGUgPSB0cnVlOwoJCQkJCWJyZWFrOwoKCQkJCWNhc2Ugc2NvcGUua2V5cy5MRUZUOgoKCQkJCQlpZiAoIGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleSB8fCBldmVudC5zaGlmdEtleSApIHsKCgkJCQkJCXJvdGF0ZUxlZnQoIDIgKiBNYXRoLlBJICogc2NvcGUucm90YXRlU3BlZWQgLyBzY29wZS5kb21FbGVtZW50LmNsaWVudEhlaWdodCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJcGFuKCBzY29wZS5rZXlQYW5TcGVlZCwgMCApOwoKCQkJCQl9CgoJCQkJCW5lZWRzVXBkYXRlID0gdHJ1ZTsKCQkJCQlicmVhazsKCgkJCQljYXNlIHNjb3BlLmtleXMuUklHSFQ6CgoJCQkJCWlmICggZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5IHx8IGV2ZW50LnNoaWZ0S2V5ICkgewoKCQkJCQkJcm90YXRlTGVmdCggLSAyICogTWF0aC5QSSAqIHNjb3BlLnJvdGF0ZVNwZWVkIC8gc2NvcGUuZG9tRWxlbWVudC5jbGllbnRIZWlnaHQgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXBhbiggLSBzY29wZS5rZXlQYW5TcGVlZCwgMCApOwoKCQkJCQl9CgoJCQkJCW5lZWRzVXBkYXRlID0gdHJ1ZTsKCQkJCQlicmVhazsKCgkJCX0KCgkJCWlmICggbmVlZHNVcGRhdGUgKSB7CgoJCQkJLy8gcHJldmVudCB0aGUgYnJvd3NlciBmcm9tIHNjcm9sbGluZyBvbiBjdXJzb3Iga2V5cwoJCQkJZXZlbnQucHJldmVudERlZmF1bHQoKTsKCgkJCQlzY29wZS51cGRhdGUoKTsKCgkJCX0KCgoJCX0KCgkJZnVuY3Rpb24gaGFuZGxlVG91Y2hTdGFydFJvdGF0ZSgpIHsKCgkJCWlmICggcG9pbnRlcnMubGVuZ3RoID09PSAxICkgewoKCQkJCXJvdGF0ZVN0YXJ0LnNldCggcG9pbnRlcnNbIDAgXS5wYWdlWCwgcG9pbnRlcnNbIDAgXS5wYWdlWSApOwoKCQkJfSBlbHNlIHsKCgkJCQljb25zdCB4ID0gMC41ICogKCBwb2ludGVyc1sgMCBdLnBhZ2VYICsgcG9pbnRlcnNbIDEgXS5wYWdlWCApOwoJCQkJY29uc3QgeSA9IDAuNSAqICggcG9pbnRlcnNbIDAgXS5wYWdlWSArIHBvaW50ZXJzWyAxIF0ucGFnZVkgKTsKCgkJCQlyb3RhdGVTdGFydC5zZXQoIHgsIHkgKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBoYW5kbGVUb3VjaFN0YXJ0UGFuKCkgewoKCQkJaWYgKCBwb2ludGVycy5sZW5ndGggPT09IDEgKSB7CgoJCQkJcGFuU3RhcnQuc2V0KCBwb2ludGVyc1sgMCBdLnBhZ2VYLCBwb2ludGVyc1sgMCBdLnBhZ2VZICk7CgoJCQl9IGVsc2UgewoKCQkJCWNvbnN0IHggPSAwLjUgKiAoIHBvaW50ZXJzWyAwIF0ucGFnZVggKyBwb2ludGVyc1sgMSBdLnBhZ2VYICk7CgkJCQljb25zdCB5ID0gMC41ICogKCBwb2ludGVyc1sgMCBdLnBhZ2VZICsgcG9pbnRlcnNbIDEgXS5wYWdlWSApOwoKCQkJCXBhblN0YXJ0LnNldCggeCwgeSApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIGhhbmRsZVRvdWNoU3RhcnREb2xseSgpIHsKCgkJCWNvbnN0IGR4ID0gcG9pbnRlcnNbIDAgXS5wYWdlWCAtIHBvaW50ZXJzWyAxIF0ucGFnZVg7CgkJCWNvbnN0IGR5ID0gcG9pbnRlcnNbIDAgXS5wYWdlWSAtIHBvaW50ZXJzWyAxIF0ucGFnZVk7CgoJCQljb25zdCBkaXN0YW5jZSA9IE1hdGguc3FydCggZHggKiBkeCArIGR5ICogZHkgKTsKCgkJCWRvbGx5U3RhcnQuc2V0KCAwLCBkaXN0YW5jZSApOwoKCQl9CgoJCWZ1bmN0aW9uIGhhbmRsZVRvdWNoU3RhcnREb2xseVBhbigpIHsKCgkJCWlmICggc2NvcGUuZW5hYmxlWm9vbSApIGhhbmRsZVRvdWNoU3RhcnREb2xseSgpOwoKCQkJaWYgKCBzY29wZS5lbmFibGVQYW4gKSBoYW5kbGVUb3VjaFN0YXJ0UGFuKCk7CgoJCX0KCgkJZnVuY3Rpb24gaGFuZGxlVG91Y2hTdGFydERvbGx5Um90YXRlKCkgewoKCQkJaWYgKCBzY29wZS5lbmFibGVab29tICkgaGFuZGxlVG91Y2hTdGFydERvbGx5KCk7CgoJCQlpZiAoIHNjb3BlLmVuYWJsZVJvdGF0ZSApIGhhbmRsZVRvdWNoU3RhcnRSb3RhdGUoKTsKCgkJfQoKCQlmdW5jdGlvbiBoYW5kbGVUb3VjaE1vdmVSb3RhdGUoIGV2ZW50ICkgewoKCQkJaWYgKCBwb2ludGVycy5sZW5ndGggPT0gMSApIHsKCgkJCQlyb3RhdGVFbmQuc2V0KCBldmVudC5wYWdlWCwgZXZlbnQucGFnZVkgKTsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc3QgcG9zaXRpb24gPSBnZXRTZWNvbmRQb2ludGVyUG9zaXRpb24oIGV2ZW50ICk7CgoJCQkJY29uc3QgeCA9IDAuNSAqICggZXZlbnQucGFnZVggKyBwb3NpdGlvbi54ICk7CgkJCQljb25zdCB5ID0gMC41ICogKCBldmVudC5wYWdlWSArIHBvc2l0aW9uLnkgKTsKCgkJCQlyb3RhdGVFbmQuc2V0KCB4LCB5ICk7CgoJCQl9CgoJCQlyb3RhdGVEZWx0YS5zdWJWZWN0b3JzKCByb3RhdGVFbmQsIHJvdGF0ZVN0YXJ0ICkubXVsdGlwbHlTY2FsYXIoIHNjb3BlLnJvdGF0ZVNwZWVkICk7CgoJCQljb25zdCBlbGVtZW50ID0gc2NvcGUuZG9tRWxlbWVudDsKCgkJCXJvdGF0ZUxlZnQoIDIgKiBNYXRoLlBJICogcm90YXRlRGVsdGEueCAvIGVsZW1lbnQuY2xpZW50SGVpZ2h0ICk7IC8vIHllcywgaGVpZ2h0CgoJCQlyb3RhdGVVcCggMiAqIE1hdGguUEkgKiByb3RhdGVEZWx0YS55IC8gZWxlbWVudC5jbGllbnRIZWlnaHQgKTsKCgkJCXJvdGF0ZVN0YXJ0LmNvcHkoIHJvdGF0ZUVuZCApOwoKCQl9CgoJCWZ1bmN0aW9uIGhhbmRsZVRvdWNoTW92ZVBhbiggZXZlbnQgKSB7CgoJCQlpZiAoIHBvaW50ZXJzLmxlbmd0aCA9PT0gMSApIHsKCgkJCQlwYW5FbmQuc2V0KCBldmVudC5wYWdlWCwgZXZlbnQucGFnZVkgKTsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc3QgcG9zaXRpb24gPSBnZXRTZWNvbmRQb2ludGVyUG9zaXRpb24oIGV2ZW50ICk7CgoJCQkJY29uc3QgeCA9IDAuNSAqICggZXZlbnQucGFnZVggKyBwb3NpdGlvbi54ICk7CgkJCQljb25zdCB5ID0gMC41ICogKCBldmVudC5wYWdlWSArIHBvc2l0aW9uLnkgKTsKCgkJCQlwYW5FbmQuc2V0KCB4LCB5ICk7CgoJCQl9CgoJCQlwYW5EZWx0YS5zdWJWZWN0b3JzKCBwYW5FbmQsIHBhblN0YXJ0ICkubXVsdGlwbHlTY2FsYXIoIHNjb3BlLnBhblNwZWVkICk7CgoJCQlwYW4oIHBhbkRlbHRhLngsIHBhbkRlbHRhLnkgKTsKCgkJCXBhblN0YXJ0LmNvcHkoIHBhbkVuZCApOwoKCQl9CgoJCWZ1bmN0aW9uIGhhbmRsZVRvdWNoTW92ZURvbGx5KCBldmVudCApIHsKCgkJCWNvbnN0IHBvc2l0aW9uID0gZ2V0U2Vjb25kUG9pbnRlclBvc2l0aW9uKCBldmVudCApOwoKCQkJY29uc3QgZHggPSBldmVudC5wYWdlWCAtIHBvc2l0aW9uLng7CgkJCWNvbnN0IGR5ID0gZXZlbnQucGFnZVkgLSBwb3NpdGlvbi55OwoKCQkJY29uc3QgZGlzdGFuY2UgPSBNYXRoLnNxcnQoIGR4ICogZHggKyBkeSAqIGR5ICk7CgoJCQlkb2xseUVuZC5zZXQoIDAsIGRpc3RhbmNlICk7CgoJCQlkb2xseURlbHRhLnNldCggMCwgTWF0aC5wb3coIGRvbGx5RW5kLnkgLyBkb2xseVN0YXJ0LnksIHNjb3BlLnpvb21TcGVlZCApICk7CgoJCQlkb2xseU91dCggZG9sbHlEZWx0YS55ICk7CgoJCQlkb2xseVN0YXJ0LmNvcHkoIGRvbGx5RW5kICk7CgoJCX0KCgkJZnVuY3Rpb24gaGFuZGxlVG91Y2hNb3ZlRG9sbHlQYW4oIGV2ZW50ICkgewoKCQkJaWYgKCBzY29wZS5lbmFibGVab29tICkgaGFuZGxlVG91Y2hNb3ZlRG9sbHkoIGV2ZW50ICk7CgoJCQlpZiAoIHNjb3BlLmVuYWJsZVBhbiApIGhhbmRsZVRvdWNoTW92ZVBhbiggZXZlbnQgKTsKCgkJfQoKCQlmdW5jdGlvbiBoYW5kbGVUb3VjaE1vdmVEb2xseVJvdGF0ZSggZXZlbnQgKSB7CgoJCQlpZiAoIHNjb3BlLmVuYWJsZVpvb20gKSBoYW5kbGVUb3VjaE1vdmVEb2xseSggZXZlbnQgKTsKCgkJCWlmICggc2NvcGUuZW5hYmxlUm90YXRlICkgaGFuZGxlVG91Y2hNb3ZlUm90YXRlKCBldmVudCApOwoKCQl9CgoJCS8vCgkJLy8gZXZlbnQgaGFuZGxlcnMgLSBGU006IGxpc3RlbiBmb3IgZXZlbnRzIGFuZCByZXNldCBzdGF0ZQoJCS8vCgoJCWZ1bmN0aW9uIG9uUG9pbnRlckRvd24oIGV2ZW50ICkgewoKCQkJaWYgKCBzY29wZS5lbmFibGVkID09PSBmYWxzZSApIHJldHVybjsKCgkJCWlmICggcG9pbnRlcnMubGVuZ3RoID09PSAwICkgewoKCQkJCXNjb3BlLmRvbUVsZW1lbnQuc2V0UG9pbnRlckNhcHR1cmUoIGV2ZW50LnBvaW50ZXJJZCApOwoKCQkJCXNjb3BlLmRvbUVsZW1lbnQuYWRkRXZlbnRMaXN0ZW5lciggJ3BvaW50ZXJtb3ZlJywgb25Qb2ludGVyTW92ZSApOwoJCQkJc2NvcGUuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCAncG9pbnRlcnVwJywgb25Qb2ludGVyVXAgKTsKCgkJCX0KCgkJCS8vCgoJCQlhZGRQb2ludGVyKCBldmVudCApOwoKCQkJaWYgKCBldmVudC5wb2ludGVyVHlwZSA9PT0gJ3RvdWNoJyApIHsKCgkJCQlvblRvdWNoU3RhcnQoIGV2ZW50ICk7CgoJCQl9IGVsc2UgewoKCQkJCW9uTW91c2VEb3duKCBldmVudCApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIG9uUG9pbnRlck1vdmUoIGV2ZW50ICkgewoKCQkJaWYgKCBzY29wZS5lbmFibGVkID09PSBmYWxzZSApIHJldHVybjsKCgkJCWlmICggZXZlbnQucG9pbnRlclR5cGUgPT09ICd0b3VjaCcgKSB7CgoJCQkJb25Ub3VjaE1vdmUoIGV2ZW50ICk7CgoJCQl9IGVsc2UgewoKCQkJCW9uTW91c2VNb3ZlKCBldmVudCApOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIG9uUG9pbnRlclVwKCBldmVudCApIHsKCgkJCXJlbW92ZVBvaW50ZXIoIGV2ZW50ICk7CgoJCQlpZiAoIHBvaW50ZXJzLmxlbmd0aCA9PT0gMCApIHsKCgkJCQlzY29wZS5kb21FbGVtZW50LnJlbGVhc2VQb2ludGVyQ2FwdHVyZSggZXZlbnQucG9pbnRlcklkICk7CgoJCQkJc2NvcGUuZG9tRWxlbWVudC5yZW1vdmVFdmVudExpc3RlbmVyKCAncG9pbnRlcm1vdmUnLCBvblBvaW50ZXJNb3ZlICk7CgkJCQlzY29wZS5kb21FbGVtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoICdwb2ludGVydXAnLCBvblBvaW50ZXJVcCApOwoKCQkJfQoKCQkJc2NvcGUuZGlzcGF0Y2hFdmVudCggX2VuZEV2ZW50ICk7CgoJCQlzdGF0ZSA9IFNUQVRFLk5PTkU7CgoJCX0KCgkJZnVuY3Rpb24gb25Nb3VzZURvd24oIGV2ZW50ICkgewoKCQkJbGV0IG1vdXNlQWN0aW9uOwoKCQkJc3dpdGNoICggZXZlbnQuYnV0dG9uICkgewoKCQkJCWNhc2UgMDoKCgkJCQkJbW91c2VBY3Rpb24gPSBzY29wZS5tb3VzZUJ1dHRvbnMuTEVGVDsKCQkJCQlicmVhazsKCgkJCQljYXNlIDE6CgoJCQkJCW1vdXNlQWN0aW9uID0gc2NvcGUubW91c2VCdXR0b25zLk1JRERMRTsKCQkJCQlicmVhazsKCgkJCQljYXNlIDI6CgoJCQkJCW1vdXNlQWN0aW9uID0gc2NvcGUubW91c2VCdXR0b25zLlJJR0hUOwoJCQkJCWJyZWFrOwoKCQkJCWRlZmF1bHQ6CgoJCQkJCW1vdXNlQWN0aW9uID0gLSAxOwoKCQkJfQoKCQkJc3dpdGNoICggbW91c2VBY3Rpb24gKSB7CgoJCQkJY2FzZSBNT1VTRS5ET0xMWToKCgkJCQkJaWYgKCBzY29wZS5lbmFibGVab29tID09PSBmYWxzZSApIHJldHVybjsKCgkJCQkJaGFuZGxlTW91c2VEb3duRG9sbHkoIGV2ZW50ICk7CgoJCQkJCXN0YXRlID0gU1RBVEUuRE9MTFk7CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgTU9VU0UuUk9UQVRFOgoKCQkJCQlpZiAoIGV2ZW50LmN0cmxLZXkgfHwgZXZlbnQubWV0YUtleSB8fCBldmVudC5zaGlmdEtleSApIHsKCgkJCQkJCWlmICggc2NvcGUuZW5hYmxlUGFuID09PSBmYWxzZSApIHJldHVybjsKCgkJCQkJCWhhbmRsZU1vdXNlRG93blBhbiggZXZlbnQgKTsKCgkJCQkJCXN0YXRlID0gU1RBVEUuUEFOOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJaWYgKCBzY29wZS5lbmFibGVSb3RhdGUgPT09IGZhbHNlICkgcmV0dXJuOwoKCQkJCQkJaGFuZGxlTW91c2VEb3duUm90YXRlKCBldmVudCApOwoKCQkJCQkJc3RhdGUgPSBTVEFURS5ST1RBVEU7CgoJCQkJCX0KCgkJCQkJYnJlYWs7CgoJCQkJY2FzZSBNT1VTRS5QQU46CgoJCQkJCWlmICggZXZlbnQuY3RybEtleSB8fCBldmVudC5tZXRhS2V5IHx8IGV2ZW50LnNoaWZ0S2V5ICkgewoKCQkJCQkJaWYgKCBzY29wZS5lbmFibGVSb3RhdGUgPT09IGZhbHNlICkgcmV0dXJuOwoKCQkJCQkJaGFuZGxlTW91c2VEb3duUm90YXRlKCBldmVudCApOwoKCQkJCQkJc3RhdGUgPSBTVEFURS5ST1RBVEU7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlpZiAoIHNjb3BlLmVuYWJsZVBhbiA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQkJCQloYW5kbGVNb3VzZURvd25QYW4oIGV2ZW50ICk7CgoJCQkJCQlzdGF0ZSA9IFNUQVRFLlBBTjsKCgkJCQkJfQoKCQkJCQlicmVhazsKCgkJCQlkZWZhdWx0OgoKCQkJCQlzdGF0ZSA9IFNUQVRFLk5PTkU7CgoJCQl9CgoJCQlpZiAoIHN0YXRlICE9PSBTVEFURS5OT05FICkgewoKCQkJCXNjb3BlLmRpc3BhdGNoRXZlbnQoIF9zdGFydEV2ZW50ICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gb25Nb3VzZU1vdmUoIGV2ZW50ICkgewoKCQkJc3dpdGNoICggc3RhdGUgKSB7CgoJCQkJY2FzZSBTVEFURS5ST1RBVEU6CgoJCQkJCWlmICggc2NvcGUuZW5hYmxlUm90YXRlID09PSBmYWxzZSApIHJldHVybjsKCgkJCQkJaGFuZGxlTW91c2VNb3ZlUm90YXRlKCBldmVudCApOwoKCQkJCQlicmVhazsKCgkJCQljYXNlIFNUQVRFLkRPTExZOgoKCQkJCQlpZiAoIHNjb3BlLmVuYWJsZVpvb20gPT09IGZhbHNlICkgcmV0dXJuOwoKCQkJCQloYW5kbGVNb3VzZU1vdmVEb2xseSggZXZlbnQgKTsKCgkJCQkJYnJlYWs7CgoJCQkJY2FzZSBTVEFURS5QQU46CgoJCQkJCWlmICggc2NvcGUuZW5hYmxlUGFuID09PSBmYWxzZSApIHJldHVybjsKCgkJCQkJaGFuZGxlTW91c2VNb3ZlUGFuKCBldmVudCApOwoKCQkJCQlicmVhazsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBvbk1vdXNlV2hlZWwoIGV2ZW50ICkgewoKCQkJaWYgKCBzY29wZS5lbmFibGVkID09PSBmYWxzZSB8fCBzY29wZS5lbmFibGVab29tID09PSBmYWxzZSB8fCBzdGF0ZSAhPT0gU1RBVEUuTk9ORSApIHJldHVybjsKCgkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgoJCQlzY29wZS5kaXNwYXRjaEV2ZW50KCBfc3RhcnRFdmVudCApOwoKCQkJaGFuZGxlTW91c2VXaGVlbCggZXZlbnQgKTsKCgkJCXNjb3BlLmRpc3BhdGNoRXZlbnQoIF9lbmRFdmVudCApOwoKCQl9CgoJCWZ1bmN0aW9uIG9uS2V5RG93biggZXZlbnQgKSB7CgoJCQlpZiAoIHNjb3BlLmVuYWJsZWQgPT09IGZhbHNlIHx8IHNjb3BlLmVuYWJsZVBhbiA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQloYW5kbGVLZXlEb3duKCBldmVudCApOwoKCQl9CgoJCWZ1bmN0aW9uIG9uVG91Y2hTdGFydCggZXZlbnQgKSB7CgoJCQl0cmFja1BvaW50ZXIoIGV2ZW50ICk7CgoJCQlzd2l0Y2ggKCBwb2ludGVycy5sZW5ndGggKSB7CgoJCQkJY2FzZSAxOgoKCQkJCQlzd2l0Y2ggKCBzY29wZS50b3VjaGVzLk9ORSApIHsKCgkJCQkJCWNhc2UgVE9VQ0guUk9UQVRFOgoKCQkJCQkJCWlmICggc2NvcGUuZW5hYmxlUm90YXRlID09PSBmYWxzZSApIHJldHVybjsKCgkJCQkJCQloYW5kbGVUb3VjaFN0YXJ0Um90YXRlKCk7CgoJCQkJCQkJc3RhdGUgPSBTVEFURS5UT1VDSF9ST1RBVEU7CgoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIFRPVUNILlBBTjoKCgkJCQkJCQlpZiAoIHNjb3BlLmVuYWJsZVBhbiA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQkJCQkJaGFuZGxlVG91Y2hTdGFydFBhbigpOwoKCQkJCQkJCXN0YXRlID0gU1RBVEUuVE9VQ0hfUEFOOwoKCQkJCQkJCWJyZWFrOwoKCQkJCQkJZGVmYXVsdDoKCgkJCQkJCQlzdGF0ZSA9IFNUQVRFLk5PTkU7CgoJCQkJCX0KCgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAyOgoKCQkJCQlzd2l0Y2ggKCBzY29wZS50b3VjaGVzLlRXTyApIHsKCgkJCQkJCWNhc2UgVE9VQ0guRE9MTFlfUEFOOgoKCQkJCQkJCWlmICggc2NvcGUuZW5hYmxlWm9vbSA9PT0gZmFsc2UgJiYgc2NvcGUuZW5hYmxlUGFuID09PSBmYWxzZSApIHJldHVybjsKCgkJCQkJCQloYW5kbGVUb3VjaFN0YXJ0RG9sbHlQYW4oKTsKCgkJCQkJCQlzdGF0ZSA9IFNUQVRFLlRPVUNIX0RPTExZX1BBTjsKCgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgVE9VQ0guRE9MTFlfUk9UQVRFOgoKCQkJCQkJCWlmICggc2NvcGUuZW5hYmxlWm9vbSA9PT0gZmFsc2UgJiYgc2NvcGUuZW5hYmxlUm90YXRlID09PSBmYWxzZSApIHJldHVybjsKCgkJCQkJCQloYW5kbGVUb3VjaFN0YXJ0RG9sbHlSb3RhdGUoKTsKCgkJCQkJCQlzdGF0ZSA9IFNUQVRFLlRPVUNIX0RPTExZX1JPVEFURTsKCgkJCQkJCQlicmVhazsKCgkJCQkJCWRlZmF1bHQ6CgoJCQkJCQkJc3RhdGUgPSBTVEFURS5OT05FOwoKCQkJCQl9CgoJCQkJCWJyZWFrOwoKCQkJCWRlZmF1bHQ6CgoJCQkJCXN0YXRlID0gU1RBVEUuTk9ORTsKCgkJCX0KCgkJCWlmICggc3RhdGUgIT09IFNUQVRFLk5PTkUgKSB7CgoJCQkJc2NvcGUuZGlzcGF0Y2hFdmVudCggX3N0YXJ0RXZlbnQgKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBvblRvdWNoTW92ZSggZXZlbnQgKSB7CgoJCQl0cmFja1BvaW50ZXIoIGV2ZW50ICk7CgoJCQlzd2l0Y2ggKCBzdGF0ZSApIHsKCgkJCQljYXNlIFNUQVRFLlRPVUNIX1JPVEFURToKCgkJCQkJaWYgKCBzY29wZS5lbmFibGVSb3RhdGUgPT09IGZhbHNlICkgcmV0dXJuOwoKCQkJCQloYW5kbGVUb3VjaE1vdmVSb3RhdGUoIGV2ZW50ICk7CgoJCQkJCXNjb3BlLnVwZGF0ZSgpOwoKCQkJCQlicmVhazsKCgkJCQljYXNlIFNUQVRFLlRPVUNIX1BBTjoKCgkJCQkJaWYgKCBzY29wZS5lbmFibGVQYW4gPT09IGZhbHNlICkgcmV0dXJuOwoKCQkJCQloYW5kbGVUb3VjaE1vdmVQYW4oIGV2ZW50ICk7CgoJCQkJCXNjb3BlLnVwZGF0ZSgpOwoKCQkJCQlicmVhazsKCgkJCQljYXNlIFNUQVRFLlRPVUNIX0RPTExZX1BBTjoKCgkJCQkJaWYgKCBzY29wZS5lbmFibGVab29tID09PSBmYWxzZSAmJiBzY29wZS5lbmFibGVQYW4gPT09IGZhbHNlICkgcmV0dXJuOwoKCQkJCQloYW5kbGVUb3VjaE1vdmVEb2xseVBhbiggZXZlbnQgKTsKCgkJCQkJc2NvcGUudXBkYXRlKCk7CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgU1RBVEUuVE9VQ0hfRE9MTFlfUk9UQVRFOgoKCQkJCQlpZiAoIHNjb3BlLmVuYWJsZVpvb20gPT09IGZhbHNlICYmIHNjb3BlLmVuYWJsZVJvdGF0ZSA9PT0gZmFsc2UgKSByZXR1cm47CgoJCQkJCWhhbmRsZVRvdWNoTW92ZURvbGx5Um90YXRlKCBldmVudCApOwoKCQkJCQlzY29wZS51cGRhdGUoKTsKCgkJCQkJYnJlYWs7CgoJCQkJZGVmYXVsdDoKCgkJCQkJc3RhdGUgPSBTVEFURS5OT05FOwoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIG9uQ29udGV4dE1lbnUoIGV2ZW50ICkgewoKCQkJaWYgKCBzY29wZS5lbmFibGVkID09PSBmYWxzZSApIHJldHVybjsKCgkJCWV2ZW50LnByZXZlbnREZWZhdWx0KCk7CgoJCX0KCgkJZnVuY3Rpb24gYWRkUG9pbnRlciggZXZlbnQgKSB7CgoJCQlwb2ludGVycy5wdXNoKCBldmVudCApOwoKCQl9CgoJCWZ1bmN0aW9uIHJlbW92ZVBvaW50ZXIoIGV2ZW50ICkgewoKCQkJZGVsZXRlIHBvaW50ZXJQb3NpdGlvbnNbIGV2ZW50LnBvaW50ZXJJZCBdOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgcG9pbnRlcnMubGVuZ3RoOyBpICsrICkgewoKCQkJCWlmICggcG9pbnRlcnNbIGkgXS5wb2ludGVySWQgPT0gZXZlbnQucG9pbnRlcklkICkgewoKCQkJCQlwb2ludGVycy5zcGxpY2UoIGksIDEgKTsKCQkJCQlyZXR1cm47CgoJCQkJfQoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHRyYWNrUG9pbnRlciggZXZlbnQgKSB7CgoJCQlsZXQgcG9zaXRpb24gPSBwb2ludGVyUG9zaXRpb25zWyBldmVudC5wb2ludGVySWQgXTsKCgkJCWlmICggcG9zaXRpb24gPT09IHVuZGVmaW5lZCApIHsKCgkJCQlwb3NpdGlvbiA9IG5ldyBWZWN0b3IyKCk7CgkJCQlwb2ludGVyUG9zaXRpb25zWyBldmVudC5wb2ludGVySWQgXSA9IHBvc2l0aW9uOwoKCQkJfQoKCQkJcG9zaXRpb24uc2V0KCBldmVudC5wYWdlWCwgZXZlbnQucGFnZVkgKTsKCgkJfQoKCQlmdW5jdGlvbiBnZXRTZWNvbmRQb2ludGVyUG9zaXRpb24oIGV2ZW50ICkgewoKCQkJY29uc3QgcG9pbnRlciA9ICggZXZlbnQucG9pbnRlcklkID09PSBwb2ludGVyc1sgMCBdLnBvaW50ZXJJZCApID8gcG9pbnRlcnNbIDEgXSA6IHBvaW50ZXJzWyAwIF07CgoJCQlyZXR1cm4gcG9pbnRlclBvc2l0aW9uc1sgcG9pbnRlci5wb2ludGVySWQgXTsKCgkJfQoKCQkvLwoKCQlzY29wZS5kb21FbGVtZW50LmFkZEV2ZW50TGlzdGVuZXIoICdjb250ZXh0bWVudScsIG9uQ29udGV4dE1lbnUgKTsKCgkJc2NvcGUuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCAncG9pbnRlcmRvd24nLCBvblBvaW50ZXJEb3duICk7CgkJc2NvcGUuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCAncG9pbnRlcmNhbmNlbCcsIG9uUG9pbnRlclVwICk7CgkJc2NvcGUuZG9tRWxlbWVudC5hZGRFdmVudExpc3RlbmVyKCAnd2hlZWwnLCBvbk1vdXNlV2hlZWwsIHsgcGFzc2l2ZTogZmFsc2UgfSApOwoKCQkvLyBmb3JjZSBhbiB1cGRhdGUgYXQgc3RhcnQKCgkJdGhpcy51cGRhdGUoKTsKCgl9Cgp9CgpleHBvcnQgeyBPcmJpdENvbnRyb2xzIH07Cg==",
    "base64": true
  },
  {
    "key": "js/rsmvThreeLoader.js",
    "value": "aW1wb3J0ICogYXMgVEhSRUUgZnJvbSAnaHR0cHM6Ly91bnBrZy5jb20vdGhyZWVAMC4xNTguMC9idWlsZC90aHJlZS5tb2R1bGUuanMnOwoKZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVRocmVlTWVzaEZyb21Sc212TW9kZWwobW9kZWxEYXRhKSB7CiAgICBjb25zb2xlLmxvZygnQ29udmVydGluZyBtb2RlbERhdGEgdG8gVGhyZWUuanMgbWVzaDonLCBtb2RlbERhdGEpOwoKICAgIGNvbnN0IGdlb21ldHJ5ID0gbmV3IFRIUkVFLkJ1ZmZlckdlb21ldHJ5KCk7CgogICAgLy8gQXNzdW1pbmcgbW9kZWxEYXRhLnZlcnRpY2VzIGlzIGFuIGFycmF5IG9mIG51bWJlcnMgW3gxLCB5MSwgejEsIHgyLCB5MiwgejIsIC4uLl0KICAgIGlmIChtb2RlbERhdGEudmVydGljZXMpIHsKICAgICAgICBnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoJ3Bvc2l0aW9uJywgbmV3IFRIUkVFLkZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUobW9kZWxEYXRhLnZlcnRpY2VzLCAzKSk7CiAgICB9CgogICAgLy8gQXNzdW1pbmcgbW9kZWxEYXRhLmZhY2VzIGlzIGFuIGFycmF5IG9mIG51bWJlcnMgW3YxX2lkeCwgdjJfaWR4LCB2M19pZHgsIC4uLl0KICAgIGlmIChtb2RlbERhdGEuZmFjZXMpIHsKICAgICAgICBnZW9tZXRyeS5zZXRJbmRleChtb2RlbERhdGEuZmFjZXMpOwogICAgfQoKICAgIC8vIENhbGN1bGF0ZSBub3JtYWxzIGZvciBwcm9wZXIgbGlnaHRpbmcKICAgIGdlb21ldHJ5LmNvbXB1dGVWZXJ0ZXhOb3JtYWxzKCk7CgogICAgbGV0IG1hdGVyaWFsOwogICAgLy8gQXNzdW1pbmcgbW9kZWxEYXRhLmNvbG9ycyBpcyBhbiBhcnJheSBvZiBudW1iZXJzIFtyMSwgZzEsIGIxLCAuLi5dCiAgICBpZiAobW9kZWxEYXRhLmNvbG9ycyAmJiBtb2RlbERhdGEuY29sb3JzLmxlbmd0aCA+IDApIHsKICAgICAgICAvLyBJZiBwZXItdmVydGV4IGNvbG9ycyBhcmUgcHJvdmlkZWQKICAgICAgICBnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoJ2NvbG9yJywgbmV3IFRIUkVFLkZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUobW9kZWxEYXRhLmNvbG9ycywgMykpOwogICAgICAgIG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hTdGFuZGFyZE1hdGVyaWFsKHsgdmVydGV4Q29sb3JzOiB0cnVlLCBmbGF0U2hhZGluZzogdHJ1ZSB9KTsKICAgIH0gZWxzZSB7CiAgICAgICAgLy8gRGVmYXVsdCBtYXRlcmlhbCBpZiBubyBjb2xvcnMgYXJlIHByb3ZpZGVkCiAgICAgICAgbWF0ZXJpYWwgPSBuZXcgVEhSRUUuTWVzaFN0YW5kYXJkTWF0ZXJpYWwoeyBjb2xvcjogMHhjY2NjY2MsIGZsYXRTaGFkaW5nOiB0cnVlIH0pOwogICAgfQoKICAgIGNvbnN0IG1lc2ggPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgbWF0ZXJpYWwpOwogICAgcmV0dXJuIG1lc2g7Cn0K",
    "base64": true
  },
  {
    "key": "js/three.module.js",
    "value": "LyoqCiAqIEBsaWNlbnNlCiAqIENvcHlyaWdodCAyMDEwLTIwMjMgVGhyZWUuanMgQXV0aG9ycwogKiBTUERYLUxpY2Vuc2UtSWRlbnRpZmllcjogTUlUCiAqLwpjb25zdCBSRVZJU0lPTiA9ICcxNTcnOwoKY29uc3QgTU9VU0UgPSB7IExFRlQ6IDAsIE1JRERMRTogMSwgUklHSFQ6IDIsIFJPVEFURTogMCwgRE9MTFk6IDEsIFBBTjogMiB9Owpjb25zdCBUT1VDSCA9IHsgUk9UQVRFOiAwLCBQQU46IDEsIERPTExZX1BBTjogMiwgRE9MTFlfUk9UQVRFOiAzIH07CmNvbnN0IEN1bGxGYWNlTm9uZSA9IDA7CmNvbnN0IEN1bGxGYWNlQmFjayA9IDE7CmNvbnN0IEN1bGxGYWNlRnJvbnQgPSAyOwpjb25zdCBDdWxsRmFjZUZyb250QmFjayA9IDM7CmNvbnN0IEJhc2ljU2hhZG93TWFwID0gMDsKY29uc3QgUENGU2hhZG93TWFwID0gMTsKY29uc3QgUENGU29mdFNoYWRvd01hcCA9IDI7CmNvbnN0IFZTTVNoYWRvd01hcCA9IDM7CmNvbnN0IEZyb250U2lkZSA9IDA7CmNvbnN0IEJhY2tTaWRlID0gMTsKY29uc3QgRG91YmxlU2lkZSA9IDI7CmNvbnN0IFR3b1Bhc3NEb3VibGVTaWRlID0gMjsgLy8gcjE0OQpjb25zdCBOb0JsZW5kaW5nID0gMDsKY29uc3QgTm9ybWFsQmxlbmRpbmcgPSAxOwpjb25zdCBBZGRpdGl2ZUJsZW5kaW5nID0gMjsKY29uc3QgU3VidHJhY3RpdmVCbGVuZGluZyA9IDM7CmNvbnN0IE11bHRpcGx5QmxlbmRpbmcgPSA0Owpjb25zdCBDdXN0b21CbGVuZGluZyA9IDU7CmNvbnN0IEFkZEVxdWF0aW9uID0gMTAwOwpjb25zdCBTdWJ0cmFjdEVxdWF0aW9uID0gMTAxOwpjb25zdCBSZXZlcnNlU3VidHJhY3RFcXVhdGlvbiA9IDEwMjsKY29uc3QgTWluRXF1YXRpb24gPSAxMDM7CmNvbnN0IE1heEVxdWF0aW9uID0gMTA0Owpjb25zdCBaZXJvRmFjdG9yID0gMjAwOwpjb25zdCBPbmVGYWN0b3IgPSAyMDE7CmNvbnN0IFNyY0NvbG9yRmFjdG9yID0gMjAyOwpjb25zdCBPbmVNaW51c1NyY0NvbG9yRmFjdG9yID0gMjAzOwpjb25zdCBTcmNBbHBoYUZhY3RvciA9IDIwNDsKY29uc3QgT25lTWludXNTcmNBbHBoYUZhY3RvciA9IDIwNTsKY29uc3QgRHN0QWxwaGFGYWN0b3IgPSAyMDY7CmNvbnN0IE9uZU1pbnVzRHN0QWxwaGFGYWN0b3IgPSAyMDc7CmNvbnN0IERzdENvbG9yRmFjdG9yID0gMjA4Owpjb25zdCBPbmVNaW51c0RzdENvbG9yRmFjdG9yID0gMjA5Owpjb25zdCBTcmNBbHBoYVNhdHVyYXRlRmFjdG9yID0gMjEwOwpjb25zdCBOZXZlckRlcHRoID0gMDsKY29uc3QgQWx3YXlzRGVwdGggPSAxOwpjb25zdCBMZXNzRGVwdGggPSAyOwpjb25zdCBMZXNzRXF1YWxEZXB0aCA9IDM7CmNvbnN0IEVxdWFsRGVwdGggPSA0Owpjb25zdCBHcmVhdGVyRXF1YWxEZXB0aCA9IDU7CmNvbnN0IEdyZWF0ZXJEZXB0aCA9IDY7CmNvbnN0IE5vdEVxdWFsRGVwdGggPSA3Owpjb25zdCBNdWx0aXBseU9wZXJhdGlvbiA9IDA7CmNvbnN0IE1peE9wZXJhdGlvbiA9IDE7CmNvbnN0IEFkZE9wZXJhdGlvbiA9IDI7CmNvbnN0IE5vVG9uZU1hcHBpbmcgPSAwOwpjb25zdCBMaW5lYXJUb25lTWFwcGluZyA9IDE7CmNvbnN0IFJlaW5oYXJkVG9uZU1hcHBpbmcgPSAyOwpjb25zdCBDaW5lb25Ub25lTWFwcGluZyA9IDM7CmNvbnN0IEFDRVNGaWxtaWNUb25lTWFwcGluZyA9IDQ7CmNvbnN0IEN1c3RvbVRvbmVNYXBwaW5nID0gNTsKCmNvbnN0IFVWTWFwcGluZyA9IDMwMDsKY29uc3QgQ3ViZVJlZmxlY3Rpb25NYXBwaW5nID0gMzAxOwpjb25zdCBDdWJlUmVmcmFjdGlvbk1hcHBpbmcgPSAzMDI7CmNvbnN0IEVxdWlyZWN0YW5ndWxhclJlZmxlY3Rpb25NYXBwaW5nID0gMzAzOwpjb25zdCBFcXVpcmVjdGFuZ3VsYXJSZWZyYWN0aW9uTWFwcGluZyA9IDMwNDsKY29uc3QgQ3ViZVVWUmVmbGVjdGlvbk1hcHBpbmcgPSAzMDY7CmNvbnN0IFJlcGVhdFdyYXBwaW5nID0gMTAwMDsKY29uc3QgQ2xhbXBUb0VkZ2VXcmFwcGluZyA9IDEwMDE7CmNvbnN0IE1pcnJvcmVkUmVwZWF0V3JhcHBpbmcgPSAxMDAyOwpjb25zdCBOZWFyZXN0RmlsdGVyID0gMTAwMzsKY29uc3QgTmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXIgPSAxMDA0Owpjb25zdCBOZWFyZXN0TWlwTWFwTmVhcmVzdEZpbHRlciA9IDEwMDQ7CmNvbnN0IE5lYXJlc3RNaXBtYXBMaW5lYXJGaWx0ZXIgPSAxMDA1Owpjb25zdCBOZWFyZXN0TWlwTWFwTGluZWFyRmlsdGVyID0gMTAwNTsKY29uc3QgTGluZWFyRmlsdGVyID0gMTAwNjsKY29uc3QgTGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlciA9IDEwMDc7CmNvbnN0IExpbmVhck1pcE1hcE5lYXJlc3RGaWx0ZXIgPSAxMDA3Owpjb25zdCBMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIgPSAxMDA4Owpjb25zdCBMaW5lYXJNaXBNYXBMaW5lYXJGaWx0ZXIgPSAxMDA4Owpjb25zdCBVbnNpZ25lZEJ5dGVUeXBlID0gMTAwOTsKY29uc3QgQnl0ZVR5cGUgPSAxMDEwOwpjb25zdCBTaG9ydFR5cGUgPSAxMDExOwpjb25zdCBVbnNpZ25lZFNob3J0VHlwZSA9IDEwMTI7CmNvbnN0IEludFR5cGUgPSAxMDEzOwpjb25zdCBVbnNpZ25lZEludFR5cGUgPSAxMDE0Owpjb25zdCBGbG9hdFR5cGUgPSAxMDE1Owpjb25zdCBIYWxmRmxvYXRUeXBlID0gMTAxNjsKY29uc3QgVW5zaWduZWRTaG9ydDQ0NDRUeXBlID0gMTAxNzsKY29uc3QgVW5zaWduZWRTaG9ydDU1NTFUeXBlID0gMTAxODsKY29uc3QgVW5zaWduZWRJbnQyNDhUeXBlID0gMTAyMDsKY29uc3QgQWxwaGFGb3JtYXQgPSAxMDIxOwpjb25zdCBSR0JBRm9ybWF0ID0gMTAyMzsKY29uc3QgTHVtaW5hbmNlRm9ybWF0ID0gMTAyNDsKY29uc3QgTHVtaW5hbmNlQWxwaGFGb3JtYXQgPSAxMDI1Owpjb25zdCBEZXB0aEZvcm1hdCA9IDEwMjY7CmNvbnN0IERlcHRoU3RlbmNpbEZvcm1hdCA9IDEwMjc7CmNvbnN0IFJlZEZvcm1hdCA9IDEwMjg7CmNvbnN0IFJlZEludGVnZXJGb3JtYXQgPSAxMDI5Owpjb25zdCBSR0Zvcm1hdCA9IDEwMzA7CmNvbnN0IFJHSW50ZWdlckZvcm1hdCA9IDEwMzE7CmNvbnN0IFJHQkFJbnRlZ2VyRm9ybWF0ID0gMTAzMzsKCmNvbnN0IFJHQl9TM1RDX0RYVDFfRm9ybWF0ID0gMzM3NzY7CmNvbnN0IFJHQkFfUzNUQ19EWFQxX0Zvcm1hdCA9IDMzNzc3Owpjb25zdCBSR0JBX1MzVENfRFhUM19Gb3JtYXQgPSAzMzc3ODsKY29uc3QgUkdCQV9TM1RDX0RYVDVfRm9ybWF0ID0gMzM3Nzk7CmNvbnN0IFJHQl9QVlJUQ180QlBQVjFfRm9ybWF0ID0gMzU4NDA7CmNvbnN0IFJHQl9QVlJUQ18yQlBQVjFfRm9ybWF0ID0gMzU4NDE7CmNvbnN0IFJHQkFfUFZSVENfNEJQUFYxX0Zvcm1hdCA9IDM1ODQyOwpjb25zdCBSR0JBX1BWUlRDXzJCUFBWMV9Gb3JtYXQgPSAzNTg0MzsKY29uc3QgUkdCX0VUQzFfRm9ybWF0ID0gMzYxOTY7CmNvbnN0IFJHQl9FVEMyX0Zvcm1hdCA9IDM3NDkyOwpjb25zdCBSR0JBX0VUQzJfRUFDX0Zvcm1hdCA9IDM3NDk2Owpjb25zdCBSR0JBX0FTVENfNHg0X0Zvcm1hdCA9IDM3ODA4Owpjb25zdCBSR0JBX0FTVENfNXg0X0Zvcm1hdCA9IDM3ODA5Owpjb25zdCBSR0JBX0FTVENfNXg1X0Zvcm1hdCA9IDM3ODEwOwpjb25zdCBSR0JBX0FTVENfNng1X0Zvcm1hdCA9IDM3ODExOwpjb25zdCBSR0JBX0FTVENfNng2X0Zvcm1hdCA9IDM3ODEyOwpjb25zdCBSR0JBX0FTVENfOHg1X0Zvcm1hdCA9IDM3ODEzOwpjb25zdCBSR0JBX0FTVENfOHg2X0Zvcm1hdCA9IDM3ODE0Owpjb25zdCBSR0JBX0FTVENfOHg4X0Zvcm1hdCA9IDM3ODE1Owpjb25zdCBSR0JBX0FTVENfMTB4NV9Gb3JtYXQgPSAzNzgxNjsKY29uc3QgUkdCQV9BU1RDXzEweDZfRm9ybWF0ID0gMzc4MTc7CmNvbnN0IFJHQkFfQVNUQ18xMHg4X0Zvcm1hdCA9IDM3ODE4Owpjb25zdCBSR0JBX0FTVENfMTB4MTBfRm9ybWF0ID0gMzc4MTk7CmNvbnN0IFJHQkFfQVNUQ18xMngxMF9Gb3JtYXQgPSAzNzgyMDsKY29uc3QgUkdCQV9BU1RDXzEyeDEyX0Zvcm1hdCA9IDM3ODIxOwpjb25zdCBSR0JBX0JQVENfRm9ybWF0ID0gMzY0OTI7CmNvbnN0IFJHQl9CUFRDX1NJR05FRF9Gb3JtYXQgPSAzNjQ5NDsKY29uc3QgUkdCX0JQVENfVU5TSUdORURfRm9ybWF0ID0gMzY0OTU7CmNvbnN0IFJFRF9SR1RDMV9Gb3JtYXQgPSAzNjI4MzsKY29uc3QgU0lHTkVEX1JFRF9SR1RDMV9Gb3JtYXQgPSAzNjI4NDsKY29uc3QgUkVEX0dSRUVOX1JHVEMyX0Zvcm1hdCA9IDM2Mjg1Owpjb25zdCBTSUdORURfUkVEX0dSRUVOX1JHVEMyX0Zvcm1hdCA9IDM2Mjg2Owpjb25zdCBMb29wT25jZSA9IDIyMDA7CmNvbnN0IExvb3BSZXBlYXQgPSAyMjAxOwpjb25zdCBMb29wUGluZ1BvbmcgPSAyMjAyOwpjb25zdCBJbnRlcnBvbGF0ZURpc2NyZXRlID0gMjMwMDsKY29uc3QgSW50ZXJwb2xhdGVMaW5lYXIgPSAyMzAxOwpjb25zdCBJbnRlcnBvbGF0ZVNtb290aCA9IDIzMDI7CmNvbnN0IFplcm9DdXJ2YXR1cmVFbmRpbmcgPSAyNDAwOwpjb25zdCBaZXJvU2xvcGVFbmRpbmcgPSAyNDAxOwpjb25zdCBXcmFwQXJvdW5kRW5kaW5nID0gMjQwMjsKY29uc3QgTm9ybWFsQW5pbWF0aW9uQmxlbmRNb2RlID0gMjUwMDsKY29uc3QgQWRkaXRpdmVBbmltYXRpb25CbGVuZE1vZGUgPSAyNTAxOwpjb25zdCBUcmlhbmdsZXNEcmF3TW9kZSA9IDA7CmNvbnN0IFRyaWFuZ2xlU3RyaXBEcmF3TW9kZSA9IDE7CmNvbnN0IFRyaWFuZ2xlRmFuRHJhd01vZGUgPSAyOwovKiogQGRlcHJlY2F0ZWQgVXNlIExpbmVhclNSR0JDb2xvclNwYWNlIG9yIE5vQ29sb3JTcGFjZSBpbiB0aHJlZS5qcyByMTUyKy4gKi8KY29uc3QgTGluZWFyRW5jb2RpbmcgPSAzMDAwOwovKiogQGRlcHJlY2F0ZWQgVXNlIFNSR0JDb2xvclNwYWNlIGluIHRocmVlLmpzIHIxNTIrLiAqLwpjb25zdCBzUkdCRW5jb2RpbmcgPSAzMDAxOwpjb25zdCBCYXNpY0RlcHRoUGFja2luZyA9IDMyMDA7CmNvbnN0IFJHQkFEZXB0aFBhY2tpbmcgPSAzMjAxOwpjb25zdCBUYW5nZW50U3BhY2VOb3JtYWxNYXAgPSAwOwpjb25zdCBPYmplY3RTcGFjZU5vcm1hbE1hcCA9IDE7CgovLyBDb2xvciBzcGFjZSBzdHJpbmcgaWRlbnRpZmllcnMsIG1hdGNoaW5nIENTUyBDb2xvciBNb2R1bGUgTGV2ZWwgNCBhbmQgV2ViR1BVIG5hbWVzIHdoZXJlIGF2YWlsYWJsZS4KY29uc3QgTm9Db2xvclNwYWNlID0gJyc7CmNvbnN0IFNSR0JDb2xvclNwYWNlID0gJ3NyZ2InOwpjb25zdCBMaW5lYXJTUkdCQ29sb3JTcGFjZSA9ICdzcmdiLWxpbmVhcic7CmNvbnN0IERpc3BsYXlQM0NvbG9yU3BhY2UgPSAnZGlzcGxheS1wMyc7CmNvbnN0IExpbmVhckRpc3BsYXlQM0NvbG9yU3BhY2UgPSAnZGlzcGxheS1wMy1saW5lYXInOwoKY29uc3QgTGluZWFyVHJhbnNmZXIgPSAnbGluZWFyJzsKY29uc3QgU1JHQlRyYW5zZmVyID0gJ3NyZ2InOwoKY29uc3QgUmVjNzA5UHJpbWFyaWVzID0gJ3JlYzcwOSc7CmNvbnN0IFAzUHJpbWFyaWVzID0gJ3AzJzsKCmNvbnN0IFplcm9TdGVuY2lsT3AgPSAwOwpjb25zdCBLZWVwU3RlbmNpbE9wID0gNzY4MDsKY29uc3QgUmVwbGFjZVN0ZW5jaWxPcCA9IDc2ODE7CmNvbnN0IEluY3JlbWVudFN0ZW5jaWxPcCA9IDc2ODI7CmNvbnN0IERlY3JlbWVudFN0ZW5jaWxPcCA9IDc2ODM7CmNvbnN0IEluY3JlbWVudFdyYXBTdGVuY2lsT3AgPSAzNDA1NTsKY29uc3QgRGVjcmVtZW50V3JhcFN0ZW5jaWxPcCA9IDM0MDU2Owpjb25zdCBJbnZlcnRTdGVuY2lsT3AgPSA1Mzg2OwoKY29uc3QgTmV2ZXJTdGVuY2lsRnVuYyA9IDUxMjsKY29uc3QgTGVzc1N0ZW5jaWxGdW5jID0gNTEzOwpjb25zdCBFcXVhbFN0ZW5jaWxGdW5jID0gNTE0Owpjb25zdCBMZXNzRXF1YWxTdGVuY2lsRnVuYyA9IDUxNTsKY29uc3QgR3JlYXRlclN0ZW5jaWxGdW5jID0gNTE2Owpjb25zdCBOb3RFcXVhbFN0ZW5jaWxGdW5jID0gNTE3Owpjb25zdCBHcmVhdGVyRXF1YWxTdGVuY2lsRnVuYyA9IDUxODsKY29uc3QgQWx3YXlzU3RlbmNpbEZ1bmMgPSA1MTk7Cgpjb25zdCBOZXZlckNvbXBhcmUgPSA1MTI7CmNvbnN0IExlc3NDb21wYXJlID0gNTEzOwpjb25zdCBFcXVhbENvbXBhcmUgPSA1MTQ7CmNvbnN0IExlc3NFcXVhbENvbXBhcmUgPSA1MTU7CmNvbnN0IEdyZWF0ZXJDb21wYXJlID0gNTE2Owpjb25zdCBOb3RFcXVhbENvbXBhcmUgPSA1MTc7CmNvbnN0IEdyZWF0ZXJFcXVhbENvbXBhcmUgPSA1MTg7CmNvbnN0IEFsd2F5c0NvbXBhcmUgPSA1MTk7Cgpjb25zdCBTdGF0aWNEcmF3VXNhZ2UgPSAzNTA0NDsKY29uc3QgRHluYW1pY0RyYXdVc2FnZSA9IDM1MDQ4Owpjb25zdCBTdHJlYW1EcmF3VXNhZ2UgPSAzNTA0MDsKY29uc3QgU3RhdGljUmVhZFVzYWdlID0gMzUwNDU7CmNvbnN0IER5bmFtaWNSZWFkVXNhZ2UgPSAzNTA0OTsKY29uc3QgU3RyZWFtUmVhZFVzYWdlID0gMzUwNDE7CmNvbnN0IFN0YXRpY0NvcHlVc2FnZSA9IDM1MDQ2Owpjb25zdCBEeW5hbWljQ29weVVzYWdlID0gMzUwNTA7CmNvbnN0IFN0cmVhbUNvcHlVc2FnZSA9IDM1MDQyOwoKY29uc3QgR0xTTDEgPSAnMTAwJzsKY29uc3QgR0xTTDMgPSAnMzAwIGVzJzsKCmNvbnN0IF9TUkdCQUZvcm1hdCA9IDEwMzU7IC8vIGZhbGxiYWNrIGZvciBXZWJHTCAxCgpjb25zdCBXZWJHTENvb3JkaW5hdGVTeXN0ZW0gPSAyMDAwOwpjb25zdCBXZWJHUFVDb29yZGluYXRlU3lzdGVtID0gMjAwMTsKCi8qKgogKiBodHRwczovL2dpdGh1Yi5jb20vbXJkb29iL2V2ZW50ZGlzcGF0Y2hlci5qcy8KICovCgpjbGFzcyBFdmVudERpc3BhdGNoZXIgewoKCWFkZEV2ZW50TGlzdGVuZXIoIHR5cGUsIGxpc3RlbmVyICkgewoKCQlpZiAoIHRoaXMuX2xpc3RlbmVycyA9PT0gdW5kZWZpbmVkICkgdGhpcy5fbGlzdGVuZXJzID0ge307CgoJCWNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCgkJaWYgKCBsaXN0ZW5lcnNbIHR5cGUgXSA9PT0gdW5kZWZpbmVkICkgewoKCQkJbGlzdGVuZXJzWyB0eXBlIF0gPSBbXTsKCgkJfQoKCQlpZiAoIGxpc3RlbmVyc1sgdHlwZSBdLmluZGV4T2YoIGxpc3RlbmVyICkgPT09IC0gMSApIHsKCgkJCWxpc3RlbmVyc1sgdHlwZSBdLnB1c2goIGxpc3RlbmVyICk7CgoJCX0KCgl9CgoJaGFzRXZlbnRMaXN0ZW5lciggdHlwZSwgbGlzdGVuZXIgKSB7CgoJCWlmICggdGhpcy5fbGlzdGVuZXJzID09PSB1bmRlZmluZWQgKSByZXR1cm4gZmFsc2U7CgoJCWNvbnN0IGxpc3RlbmVycyA9IHRoaXMuX2xpc3RlbmVyczsKCgkJcmV0dXJuIGxpc3RlbmVyc1sgdHlwZSBdICE9PSB1bmRlZmluZWQgJiYgbGlzdGVuZXJzWyB0eXBlIF0uaW5kZXhPZiggbGlzdGVuZXIgKSAhPT0gLSAxOwoKCX0KCglyZW1vdmVFdmVudExpc3RlbmVyKCB0eXBlLCBsaXN0ZW5lciApIHsKCgkJaWYgKCB0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCApIHJldHVybjsKCgkJY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoJCWNvbnN0IGxpc3RlbmVyQXJyYXkgPSBsaXN0ZW5lcnNbIHR5cGUgXTsKCgkJaWYgKCBsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQgKSB7CgoJCQljb25zdCBpbmRleCA9IGxpc3RlbmVyQXJyYXkuaW5kZXhPZiggbGlzdGVuZXIgKTsKCgkJCWlmICggaW5kZXggIT09IC0gMSApIHsKCgkJCQlsaXN0ZW5lckFycmF5LnNwbGljZSggaW5kZXgsIDEgKTsKCgkJCX0KCgkJfQoKCX0KCglkaXNwYXRjaEV2ZW50KCBldmVudCApIHsKCgkJaWYgKCB0aGlzLl9saXN0ZW5lcnMgPT09IHVuZGVmaW5lZCApIHJldHVybjsKCgkJY29uc3QgbGlzdGVuZXJzID0gdGhpcy5fbGlzdGVuZXJzOwoJCWNvbnN0IGxpc3RlbmVyQXJyYXkgPSBsaXN0ZW5lcnNbIGV2ZW50LnR5cGUgXTsKCgkJaWYgKCBsaXN0ZW5lckFycmF5ICE9PSB1bmRlZmluZWQgKSB7CgoJCQlldmVudC50YXJnZXQgPSB0aGlzOwoKCQkJLy8gTWFrZSBhIGNvcHksIGluIGNhc2UgbGlzdGVuZXJzIGFyZSByZW1vdmVkIHdoaWxlIGl0ZXJhdGluZy4KCQkJY29uc3QgYXJyYXkgPSBsaXN0ZW5lckFycmF5LnNsaWNlKCAwICk7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBhcnJheS5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWFycmF5WyBpIF0uY2FsbCggdGhpcywgZXZlbnQgKTsKCgkJCX0KCgkJCWV2ZW50LnRhcmdldCA9IG51bGw7CgoJCX0KCgl9Cgp9Cgpjb25zdCBfbHV0ID0gWyAnMDAnLCAnMDEnLCAnMDInLCAnMDMnLCAnMDQnLCAnMDUnLCAnMDYnLCAnMDcnLCAnMDgnLCAnMDknLCAnMGEnLCAnMGInLCAnMGMnLCAnMGQnLCAnMGUnLCAnMGYnLCAnMTAnLCAnMTEnLCAnMTInLCAnMTMnLCAnMTQnLCAnMTUnLCAnMTYnLCAnMTcnLCAnMTgnLCAnMTknLCAnMWEnLCAnMWInLCAnMWMnLCAnMWQnLCAnMWUnLCAnMWYnLCAnMjAnLCAnMjEnLCAnMjInLCAnMjMnLCAnMjQnLCAnMjUnLCAnMjYnLCAnMjcnLCAnMjgnLCAnMjknLCAnMmEnLCAnMmInLCAnMmMnLCAnMmQnLCAnMmUnLCAnMmYnLCAnMzAnLCAnMzEnLCAnMzInLCAnMzMnLCAnMzQnLCAnMzUnLCAnMzYnLCAnMzcnLCAnMzgnLCAnMzknLCAnM2EnLCAnM2InLCAnM2MnLCAnM2QnLCAnM2UnLCAnM2YnLCAnNDAnLCAnNDEnLCAnNDInLCAnNDMnLCAnNDQnLCAnNDUnLCAnNDYnLCAnNDcnLCAnNDgnLCAnNDknLCAnNGEnLCAnNGInLCAnNGMnLCAnNGQnLCAnNGUnLCAnNGYnLCAnNTAnLCAnNTEnLCAnNTInLCAnNTMnLCAnNTQnLCAnNTUnLCAnNTYnLCAnNTcnLCAnNTgnLCAnNTknLCAnNWEnLCAnNWInLCAnNWMnLCAnNWQnLCAnNWUnLCAnNWYnLCAnNjAnLCAnNjEnLCAnNjInLCAnNjMnLCAnNjQnLCAnNjUnLCAnNjYnLCAnNjcnLCAnNjgnLCAnNjknLCAnNmEnLCAnNmInLCAnNmMnLCAnNmQnLCAnNmUnLCAnNmYnLCAnNzAnLCAnNzEnLCAnNzInLCAnNzMnLCAnNzQnLCAnNzUnLCAnNzYnLCAnNzcnLCAnNzgnLCAnNzknLCAnN2EnLCAnN2InLCAnN2MnLCAnN2QnLCAnN2UnLCAnN2YnLCAnODAnLCAnODEnLCAnODInLCAnODMnLCAnODQnLCAnODUnLCAnODYnLCAnODcnLCAnODgnLCAnODknLCAnOGEnLCAnOGInLCAnOGMnLCAnOGQnLCAnOGUnLCAnOGYnLCAnOTAnLCAnOTEnLCAnOTInLCAnOTMnLCAnOTQnLCAnOTUnLCAnOTYnLCAnOTcnLCAnOTgnLCAnOTknLCAnOWEnLCAnOWInLCAnOWMnLCAnOWQnLCAnOWUnLCAnOWYnLCAnYTAnLCAnYTEnLCAnYTInLCAnYTMnLCAnYTQnLCAnYTUnLCAnYTYnLCAnYTcnLCAnYTgnLCAnYTknLCAnYWEnLCAnYWInLCAnYWMnLCAnYWQnLCAnYWUnLCAnYWYnLCAnYjAnLCAnYjEnLCAnYjInLCAnYjMnLCAnYjQnLCAnYjUnLCAnYjYnLCAnYjcnLCAnYjgnLCAnYjknLCAnYmEnLCAnYmInLCAnYmMnLCAnYmQnLCAnYmUnLCAnYmYnLCAnYzAnLCAnYzEnLCAnYzInLCAnYzMnLCAnYzQnLCAnYzUnLCAnYzYnLCAnYzcnLCAnYzgnLCAnYzknLCAnY2EnLCAnY2InLCAnY2MnLCAnY2QnLCAnY2UnLCAnY2YnLCAnZDAnLCAnZDEnLCAnZDInLCAnZDMnLCAnZDQnLCAnZDUnLCAnZDYnLCAnZDcnLCAnZDgnLCAnZDknLCAnZGEnLCAnZGInLCAnZGMnLCAnZGQnLCAnZGUnLCAnZGYnLCAnZTAnLCAnZTEnLCAnZTInLCAnZTMnLCAnZTQnLCAnZTUnLCAnZTYnLCAnZTcnLCAnZTgnLCAnZTknLCAnZWEnLCAnZWInLCAnZWMnLCAnZWQnLCAnZWUnLCAnZWYnLCAnZjAnLCAnZjEnLCAnZjInLCAnZjMnLCAnZjQnLCAnZjUnLCAnZjYnLCAnZjcnLCAnZjgnLCAnZjknLCAnZmEnLCAnZmInLCAnZmMnLCAnZmQnLCAnZmUnLCAnZmYnIF07CgpsZXQgX3NlZWQgPSAxMjM0NTY3OwoKCmNvbnN0IERFRzJSQUQgPSBNYXRoLlBJIC8gMTgwOwpjb25zdCBSQUQyREVHID0gMTgwIC8gTWF0aC5QSTsKCi8vIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvMTA1MDM0L2hvdy10by1jcmVhdGUtYS1ndWlkLXV1aWQtaW4tamF2YXNjcmlwdC8yMTk2MzEzNiMyMTk2MzEzNgpmdW5jdGlvbiBnZW5lcmF0ZVVVSUQoKSB7CgoJY29uc3QgZDAgPSBNYXRoLnJhbmRvbSgpICogMHhmZmZmZmZmZiB8IDA7Cgljb25zdCBkMSA9IE1hdGgucmFuZG9tKCkgKiAweGZmZmZmZmZmIHwgMDsKCWNvbnN0IGQyID0gTWF0aC5yYW5kb20oKSAqIDB4ZmZmZmZmZmYgfCAwOwoJY29uc3QgZDMgPSBNYXRoLnJhbmRvbSgpICogMHhmZmZmZmZmZiB8IDA7Cgljb25zdCB1dWlkID0gX2x1dFsgZDAgJiAweGZmIF0gKyBfbHV0WyBkMCA+PiA4ICYgMHhmZiBdICsgX2x1dFsgZDAgPj4gMTYgJiAweGZmIF0gKyBfbHV0WyBkMCA+PiAyNCAmIDB4ZmYgXSArICctJyArCgkJCV9sdXRbIGQxICYgMHhmZiBdICsgX2x1dFsgZDEgPj4gOCAmIDB4ZmYgXSArICctJyArIF9sdXRbIGQxID4+IDE2ICYgMHgwZiB8IDB4NDAgXSArIF9sdXRbIGQxID4+IDI0ICYgMHhmZiBdICsgJy0nICsKCQkJX2x1dFsgZDIgJiAweDNmIHwgMHg4MCBdICsgX2x1dFsgZDIgPj4gOCAmIDB4ZmYgXSArICctJyArIF9sdXRbIGQyID4+IDE2ICYgMHhmZiBdICsgX2x1dFsgZDIgPj4gMjQgJiAweGZmIF0gKwoJCQlfbHV0WyBkMyAmIDB4ZmYgXSArIF9sdXRbIGQzID4+IDggJiAweGZmIF0gKyBfbHV0WyBkMyA+PiAxNiAmIDB4ZmYgXSArIF9sdXRbIGQzID4+IDI0ICYgMHhmZiBdOwoKCS8vIC50b0xvd2VyQ2FzZSgpIGhlcmUgZmxhdHRlbnMgY29uY2F0ZW5hdGVkIHN0cmluZ3MgdG8gc2F2ZSBoZWFwIG1lbW9yeSBzcGFjZS4KCXJldHVybiB1dWlkLnRvTG93ZXJDYXNlKCk7Cgp9CgpmdW5jdGlvbiBjbGFtcCggdmFsdWUsIG1pbiwgbWF4ICkgewoKCXJldHVybiBNYXRoLm1heCggbWluLCBNYXRoLm1pbiggbWF4LCB2YWx1ZSApICk7Cgp9CgovLyBjb21wdXRlIGV1Y2xpZGVhbiBtb2R1bG8gb2YgbSAlIG4KLy8gaHR0cHM6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvTW9kdWxvX29wZXJhdGlvbgpmdW5jdGlvbiBldWNsaWRlYW5Nb2R1bG8oIG4sIG0gKSB7CgoJcmV0dXJuICggKCBuICUgbSApICsgbSApICUgbTsKCn0KCi8vIExpbmVhciBtYXBwaW5nIGZyb20gcmFuZ2UgPGExLCBhMj4gdG8gcmFuZ2UgPGIxLCBiMj4KZnVuY3Rpb24gbWFwTGluZWFyKCB4LCBhMSwgYTIsIGIxLCBiMiApIHsKCglyZXR1cm4gYjEgKyAoIHggLSBhMSApICogKCBiMiAtIGIxICkgLyAoIGEyIC0gYTEgKTsKCn0KCi8vIGh0dHBzOi8vd3d3LmdhbWVkZXYubmV0L3R1dG9yaWFscy9wcm9ncmFtbWluZy9nZW5lcmFsLWFuZC1nYW1lcGxheS1wcm9ncmFtbWluZy9pbnZlcnNlLWxlcnAtYS1zdXBlci11c2VmdWwteWV0LW9mdGVuLW92ZXJsb29rZWQtZnVuY3Rpb24tcjUyMzAvCmZ1bmN0aW9uIGludmVyc2VMZXJwKCB4LCB5LCB2YWx1ZSApIHsKCglpZiAoIHggIT09IHkgKSB7CgoJCXJldHVybiAoIHZhbHVlIC0geCApIC8gKCB5IC0geCApOwoKCX0gZWxzZSB7CgoJCXJldHVybiAwOwoKCX0KCn0KCi8vIGh0dHBzOi8vZW4ud2lraXBlZGlhLm9yZy93aWtpL0xpbmVhcl9pbnRlcnBvbGF0aW9uCmZ1bmN0aW9uIGxlcnAoIHgsIHksIHQgKSB7CgoJcmV0dXJuICggMSAtIHQgKSAqIHggKyB0ICogeTsKCn0KCi8vIGh0dHA6Ly93d3cucm9yeWRyaXNjb2xsLmNvbS8yMDE2LzAzLzA3L2ZyYW1lLXJhdGUtaW5kZXBlbmRlbnQtZGFtcGluZy11c2luZy1sZXJwLwpmdW5jdGlvbiBkYW1wKCB4LCB5LCBsYW1iZGEsIGR0ICkgewoKCXJldHVybiBsZXJwKCB4LCB5LCAxIC0gTWF0aC5leHAoIC0gbGFtYmRhICogZHQgKSApOwoKfQoKLy8gaHR0cHM6Ly93d3cuZGVzbW9zLmNvbS9jYWxjdWxhdG9yL3Zjc2pueXo3eDQKZnVuY3Rpb24gcGluZ3BvbmcoIHgsIGxlbmd0aCA9IDEgKSB7CgoJcmV0dXJuIGxlbmd0aCAtIE1hdGguYWJzKCBldWNsaWRlYW5Nb2R1bG8oIHgsIGxlbmd0aCAqIDIgKSAtIGxlbmd0aCApOwoKfQoKLy8gaHR0cDovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9TbW9vdGhzdGVwCmZ1bmN0aW9uIHNtb290aHN0ZXAoIHgsIG1pbiwgbWF4ICkgewoKCWlmICggeCA8PSBtaW4gKSByZXR1cm4gMDsKCWlmICggeCA+PSBtYXggKSByZXR1cm4gMTsKCgl4ID0gKCB4IC0gbWluICkgLyAoIG1heCAtIG1pbiApOwoKCXJldHVybiB4ICogeCAqICggMyAtIDIgKiB4ICk7Cgp9CgpmdW5jdGlvbiBzbW9vdGhlcnN0ZXAoIHgsIG1pbiwgbWF4ICkgewoKCWlmICggeCA8PSBtaW4gKSByZXR1cm4gMDsKCWlmICggeCA+PSBtYXggKSByZXR1cm4gMTsKCgl4ID0gKCB4IC0gbWluICkgLyAoIG1heCAtIG1pbiApOwoKCXJldHVybiB4ICogeCAqIHggKiAoIHggKiAoIHggKiA2IC0gMTUgKSArIDEwICk7Cgp9CgovLyBSYW5kb20gaW50ZWdlciBmcm9tIDxsb3csIGhpZ2g+IGludGVydmFsCmZ1bmN0aW9uIHJhbmRJbnQoIGxvdywgaGlnaCApIHsKCglyZXR1cm4gbG93ICsgTWF0aC5mbG9vciggTWF0aC5yYW5kb20oKSAqICggaGlnaCAtIGxvdyArIDEgKSApOwoKfQoKLy8gUmFuZG9tIGZsb2F0IGZyb20gPGxvdywgaGlnaD4gaW50ZXJ2YWwKZnVuY3Rpb24gcmFuZEZsb2F0KCBsb3csIGhpZ2ggKSB7CgoJcmV0dXJuIGxvdyArIE1hdGgucmFuZG9tKCkgKiAoIGhpZ2ggLSBsb3cgKTsKCn0KCi8vIFJhbmRvbSBmbG9hdCBmcm9tIDwtcmFuZ2UvMiwgcmFuZ2UvMj4gaW50ZXJ2YWwKZnVuY3Rpb24gcmFuZEZsb2F0U3ByZWFkKCByYW5nZSApIHsKCglyZXR1cm4gcmFuZ2UgKiAoIDAuNSAtIE1hdGgucmFuZG9tKCkgKTsKCn0KCi8vIERldGVybWluaXN0aWMgcHNldWRvLXJhbmRvbSBmbG9hdCBpbiB0aGUgaW50ZXJ2YWwgWyAwLCAxIF0KZnVuY3Rpb24gc2VlZGVkUmFuZG9tKCBzICkgewoKCWlmICggcyAhPT0gdW5kZWZpbmVkICkgX3NlZWQgPSBzOwoKCS8vIE11bGJlcnJ5MzIgZ2VuZXJhdG9yCgoJbGV0IHQgPSBfc2VlZCArPSAweDZEMkI3OUY1OwoKCXQgPSBNYXRoLmltdWwoIHQgXiB0ID4+PiAxNSwgdCB8IDEgKTsKCgl0IF49IHQgKyBNYXRoLmltdWwoIHQgXiB0ID4+PiA3LCB0IHwgNjEgKTsKCglyZXR1cm4gKCAoIHQgXiB0ID4+PiAxNCApID4+PiAwICkgLyA0Mjk0OTY3Mjk2OwoKfQoKZnVuY3Rpb24gZGVnVG9SYWQoIGRlZ3JlZXMgKSB7CgoJcmV0dXJuIGRlZ3JlZXMgKiBERUcyUkFEOwoKfQoKZnVuY3Rpb24gcmFkVG9EZWcoIHJhZGlhbnMgKSB7CgoJcmV0dXJuIHJhZGlhbnMgKiBSQUQyREVHOwoKfQoKZnVuY3Rpb24gaXNQb3dlck9mVHdvKCB2YWx1ZSApIHsKCglyZXR1cm4gKCB2YWx1ZSAmICggdmFsdWUgLSAxICkgKSA9PT0gMCAmJiB2YWx1ZSAhPT0gMDsKCn0KCmZ1bmN0aW9uIGNlaWxQb3dlck9mVHdvKCB2YWx1ZSApIHsKCglyZXR1cm4gTWF0aC5wb3coIDIsIE1hdGguY2VpbCggTWF0aC5sb2coIHZhbHVlICkgLyBNYXRoLkxOMiApICk7Cgp9CgpmdW5jdGlvbiBmbG9vclBvd2VyT2ZUd28oIHZhbHVlICkgewoKCXJldHVybiBNYXRoLnBvdyggMiwgTWF0aC5mbG9vciggTWF0aC5sb2coIHZhbHVlICkgLyBNYXRoLkxOMiApICk7Cgp9CgpmdW5jdGlvbiBzZXRRdWF0ZXJuaW9uRnJvbVByb3BlckV1bGVyKCBxLCBhLCBiLCBjLCBvcmRlciApIHsKCgkvLyBJbnRyaW5zaWMgUHJvcGVyIEV1bGVyIEFuZ2xlcyAtIHNlZSBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9FdWxlcl9hbmdsZXMKCgkvLyByb3RhdGlvbnMgYXJlIGFwcGxpZWQgdG8gdGhlIGF4ZXMgaW4gdGhlIG9yZGVyIHNwZWNpZmllZCBieSAnb3JkZXInCgkvLyByb3RhdGlvbiBieSBhbmdsZSAnYScgaXMgYXBwbGllZCBmaXJzdCwgdGhlbiBieSBhbmdsZSAnYicsIHRoZW4gYnkgYW5nbGUgJ2MnCgkvLyBhbmdsZXMgYXJlIGluIHJhZGlhbnMKCgljb25zdCBjb3MgPSBNYXRoLmNvczsKCWNvbnN0IHNpbiA9IE1hdGguc2luOwoKCWNvbnN0IGMyID0gY29zKCBiIC8gMiApOwoJY29uc3QgczIgPSBzaW4oIGIgLyAyICk7CgoJY29uc3QgYzEzID0gY29zKCAoIGEgKyBjICkgLyAyICk7Cgljb25zdCBzMTMgPSBzaW4oICggYSArIGMgKSAvIDIgKTsKCgljb25zdCBjMV8zID0gY29zKCAoIGEgLSBjICkgLyAyICk7Cgljb25zdCBzMV8zID0gc2luKCAoIGEgLSBjICkgLyAyICk7CgoJY29uc3QgYzNfMSA9IGNvcyggKCBjIC0gYSApIC8gMiApOwoJY29uc3QgczNfMSA9IHNpbiggKCBjIC0gYSApIC8gMiApOwoKCXN3aXRjaCAoIG9yZGVyICkgewoKCQljYXNlICdYWVgnOgoJCQlxLnNldCggYzIgKiBzMTMsIHMyICogYzFfMywgczIgKiBzMV8zLCBjMiAqIGMxMyApOwoJCQlicmVhazsKCgkJY2FzZSAnWVpZJzoKCQkJcS5zZXQoIHMyICogczFfMywgYzIgKiBzMTMsIHMyICogYzFfMywgYzIgKiBjMTMgKTsKCQkJYnJlYWs7CgoJCWNhc2UgJ1pYWic6CgkJCXEuc2V0KCBzMiAqIGMxXzMsIHMyICogczFfMywgYzIgKiBzMTMsIGMyICogYzEzICk7CgkJCWJyZWFrOwoKCQljYXNlICdYWlgnOgoJCQlxLnNldCggYzIgKiBzMTMsIHMyICogczNfMSwgczIgKiBjM18xLCBjMiAqIGMxMyApOwoJCQlicmVhazsKCgkJY2FzZSAnWVhZJzoKCQkJcS5zZXQoIHMyICogYzNfMSwgYzIgKiBzMTMsIHMyICogczNfMSwgYzIgKiBjMTMgKTsKCQkJYnJlYWs7CgoJCWNhc2UgJ1pZWic6CgkJCXEuc2V0KCBzMiAqIHMzXzEsIHMyICogYzNfMSwgYzIgKiBzMTMsIGMyICogYzEzICk7CgkJCWJyZWFrOwoKCQlkZWZhdWx0OgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5NYXRoVXRpbHM6IC5zZXRRdWF0ZXJuaW9uRnJvbVByb3BlckV1bGVyKCkgZW5jb3VudGVyZWQgYW4gdW5rbm93biBvcmRlcjogJyArIG9yZGVyICk7CgoJfQoKfQoKZnVuY3Rpb24gZGVub3JtYWxpemUoIHZhbHVlLCBhcnJheSApIHsKCglzd2l0Y2ggKCBhcnJheS5jb25zdHJ1Y3RvciApIHsKCgkJY2FzZSBGbG9hdDMyQXJyYXk6CgoJCQlyZXR1cm4gdmFsdWU7CgoJCWNhc2UgVWludDMyQXJyYXk6CgoJCQlyZXR1cm4gdmFsdWUgLyA0Mjk0OTY3Mjk1LjA7CgoJCWNhc2UgVWludDE2QXJyYXk6CgoJCQlyZXR1cm4gdmFsdWUgLyA2NTUzNS4wOwoKCQljYXNlIFVpbnQ4QXJyYXk6CgoJCQlyZXR1cm4gdmFsdWUgLyAyNTUuMDsKCgkJY2FzZSBJbnQzMkFycmF5OgoKCQkJcmV0dXJuIE1hdGgubWF4KCB2YWx1ZSAvIDIxNDc0ODM2NDcuMCwgLSAxLjAgKTsKCgkJY2FzZSBJbnQxNkFycmF5OgoKCQkJcmV0dXJuIE1hdGgubWF4KCB2YWx1ZSAvIDMyNzY3LjAsIC0gMS4wICk7CgoJCWNhc2UgSW50OEFycmF5OgoKCQkJcmV0dXJuIE1hdGgubWF4KCB2YWx1ZSAvIDEyNy4wLCAtIDEuMCApOwoKCQlkZWZhdWx0OgoKCQkJdGhyb3cgbmV3IEVycm9yKCAnSW52YWxpZCBjb21wb25lbnQgdHlwZS4nICk7CgoJfQoKfQoKZnVuY3Rpb24gbm9ybWFsaXplKCB2YWx1ZSwgYXJyYXkgKSB7CgoJc3dpdGNoICggYXJyYXkuY29uc3RydWN0b3IgKSB7CgoJCWNhc2UgRmxvYXQzMkFycmF5OgoKCQkJcmV0dXJuIHZhbHVlOwoKCQljYXNlIFVpbnQzMkFycmF5OgoKCQkJcmV0dXJuIE1hdGgucm91bmQoIHZhbHVlICogNDI5NDk2NzI5NS4wICk7CgoJCWNhc2UgVWludDE2QXJyYXk6CgoJCQlyZXR1cm4gTWF0aC5yb3VuZCggdmFsdWUgKiA2NTUzNS4wICk7CgoJCWNhc2UgVWludDhBcnJheToKCgkJCXJldHVybiBNYXRoLnJvdW5kKCB2YWx1ZSAqIDI1NS4wICk7CgoJCWNhc2UgSW50MzJBcnJheToKCgkJCXJldHVybiBNYXRoLnJvdW5kKCB2YWx1ZSAqIDIxNDc0ODM2NDcuMCApOwoKCQljYXNlIEludDE2QXJyYXk6CgoJCQlyZXR1cm4gTWF0aC5yb3VuZCggdmFsdWUgKiAzMjc2Ny4wICk7CgoJCWNhc2UgSW50OEFycmF5OgoKCQkJcmV0dXJuIE1hdGgucm91bmQoIHZhbHVlICogMTI3LjAgKTsKCgkJZGVmYXVsdDoKCgkJCXRocm93IG5ldyBFcnJvciggJ0ludmFsaWQgY29tcG9uZW50IHR5cGUuJyApOwoKCX0KCn0KCmNvbnN0IE1hdGhVdGlscyA9IHsKCURFRzJSQUQ6IERFRzJSQUQsCglSQUQyREVHOiBSQUQyREVHLAoJZ2VuZXJhdGVVVUlEOiBnZW5lcmF0ZVVVSUQsCgljbGFtcDogY2xhbXAsCglldWNsaWRlYW5Nb2R1bG86IGV1Y2xpZGVhbk1vZHVsbywKCW1hcExpbmVhcjogbWFwTGluZWFyLAoJaW52ZXJzZUxlcnA6IGludmVyc2VMZXJwLAoJbGVycDogbGVycCwKCWRhbXA6IGRhbXAsCglwaW5ncG9uZzogcGluZ3BvbmcsCglzbW9vdGhzdGVwOiBzbW9vdGhzdGVwLAoJc21vb3RoZXJzdGVwOiBzbW9vdGhlcnN0ZXAsCglyYW5kSW50OiByYW5kSW50LAoJcmFuZEZsb2F0OiByYW5kRmxvYXQsCglyYW5kRmxvYXRTcHJlYWQ6IHJhbmRGbG9hdFNwcmVhZCwKCXNlZWRlZFJhbmRvbTogc2VlZGVkUmFuZG9tLAoJZGVnVG9SYWQ6IGRlZ1RvUmFkLAoJcmFkVG9EZWc6IHJhZFRvRGVnLAoJaXNQb3dlck9mVHdvOiBpc1Bvd2VyT2ZUd28sCgljZWlsUG93ZXJPZlR3bzogY2VpbFBvd2VyT2ZUd28sCglmbG9vclBvd2VyT2ZUd286IGZsb29yUG93ZXJPZlR3bywKCXNldFF1YXRlcm5pb25Gcm9tUHJvcGVyRXVsZXI6IHNldFF1YXRlcm5pb25Gcm9tUHJvcGVyRXVsZXIsCglub3JtYWxpemU6IG5vcm1hbGl6ZSwKCWRlbm9ybWFsaXplOiBkZW5vcm1hbGl6ZQp9OwoKY2xhc3MgVmVjdG9yMiB7CgoJY29uc3RydWN0b3IoIHggPSAwLCB5ID0gMCApIHsKCgkJVmVjdG9yMi5wcm90b3R5cGUuaXNWZWN0b3IyID0gdHJ1ZTsKCgkJdGhpcy54ID0geDsKCQl0aGlzLnkgPSB5OwoKCX0KCglnZXQgd2lkdGgoKSB7CgoJCXJldHVybiB0aGlzLng7CgoJfQoKCXNldCB3aWR0aCggdmFsdWUgKSB7CgoJCXRoaXMueCA9IHZhbHVlOwoKCX0KCglnZXQgaGVpZ2h0KCkgewoKCQlyZXR1cm4gdGhpcy55OwoKCX0KCglzZXQgaGVpZ2h0KCB2YWx1ZSApIHsKCgkJdGhpcy55ID0gdmFsdWU7CgoJfQoKCXNldCggeCwgeSApIHsKCgkJdGhpcy54ID0geDsKCQl0aGlzLnkgPSB5OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0U2NhbGFyKCBzY2FsYXIgKSB7CgoJCXRoaXMueCA9IHNjYWxhcjsKCQl0aGlzLnkgPSBzY2FsYXI7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRYKCB4ICkgewoKCQl0aGlzLnggPSB4OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0WSggeSApIHsKCgkJdGhpcy55ID0geTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldENvbXBvbmVudCggaW5kZXgsIHZhbHVlICkgewoKCQlzd2l0Y2ggKCBpbmRleCApIHsKCgkJCWNhc2UgMDogdGhpcy54ID0gdmFsdWU7IGJyZWFrOwoJCQljYXNlIDE6IHRoaXMueSA9IHZhbHVlOyBicmVhazsKCQkJZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKCAnaW5kZXggaXMgb3V0IG9mIHJhbmdlOiAnICsgaW5kZXggKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0Q29tcG9uZW50KCBpbmRleCApIHsKCgkJc3dpdGNoICggaW5kZXggKSB7CgoJCQljYXNlIDA6IHJldHVybiB0aGlzLng7CgkJCWNhc2UgMTogcmV0dXJuIHRoaXMueTsKCQkJZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKCAnaW5kZXggaXMgb3V0IG9mIHJhbmdlOiAnICsgaW5kZXggKTsKCgkJfQoKCX0KCgljbG9uZSgpIHsKCgkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCB0aGlzLngsIHRoaXMueSApOwoKCX0KCgljb3B5KCB2ICkgewoKCQl0aGlzLnggPSB2Lng7CgkJdGhpcy55ID0gdi55OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJYWRkKCB2ICkgewoKCQl0aGlzLnggKz0gdi54OwoJCXRoaXMueSArPSB2Lnk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglhZGRTY2FsYXIoIHMgKSB7CgoJCXRoaXMueCArPSBzOwoJCXRoaXMueSArPSBzOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJYWRkVmVjdG9ycyggYSwgYiApIHsKCgkJdGhpcy54ID0gYS54ICsgYi54OwoJCXRoaXMueSA9IGEueSArIGIueTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFkZFNjYWxlZFZlY3RvciggdiwgcyApIHsKCgkJdGhpcy54ICs9IHYueCAqIHM7CgkJdGhpcy55ICs9IHYueSAqIHM7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzdWIoIHYgKSB7CgoJCXRoaXMueCAtPSB2Lng7CgkJdGhpcy55IC09IHYueTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXN1YlNjYWxhciggcyApIHsKCgkJdGhpcy54IC09IHM7CgkJdGhpcy55IC09IHM7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzdWJWZWN0b3JzKCBhLCBiICkgewoKCQl0aGlzLnggPSBhLnggLSBiLng7CgkJdGhpcy55ID0gYS55IC0gYi55OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbXVsdGlwbHkoIHYgKSB7CgoJCXRoaXMueCAqPSB2Lng7CgkJdGhpcy55ICo9IHYueTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCW11bHRpcGx5U2NhbGFyKCBzY2FsYXIgKSB7CgoJCXRoaXMueCAqPSBzY2FsYXI7CgkJdGhpcy55ICo9IHNjYWxhcjsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWRpdmlkZSggdiApIHsKCgkJdGhpcy54IC89IHYueDsKCQl0aGlzLnkgLz0gdi55OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZGl2aWRlU2NhbGFyKCBzY2FsYXIgKSB7CgoJCXJldHVybiB0aGlzLm11bHRpcGx5U2NhbGFyKCAxIC8gc2NhbGFyICk7CgoJfQoKCWFwcGx5TWF0cml4MyggbSApIHsKCgkJY29uc3QgeCA9IHRoaXMueCwgeSA9IHRoaXMueTsKCQljb25zdCBlID0gbS5lbGVtZW50czsKCgkJdGhpcy54ID0gZVsgMCBdICogeCArIGVbIDMgXSAqIHkgKyBlWyA2IF07CgkJdGhpcy55ID0gZVsgMSBdICogeCArIGVbIDQgXSAqIHkgKyBlWyA3IF07CgoJCXJldHVybiB0aGlzOwoKCX0KCgltaW4oIHYgKSB7CgoJCXRoaXMueCA9IE1hdGgubWluKCB0aGlzLngsIHYueCApOwoJCXRoaXMueSA9IE1hdGgubWluKCB0aGlzLnksIHYueSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbWF4KCB2ICkgewoKCQl0aGlzLnggPSBNYXRoLm1heCggdGhpcy54LCB2LnggKTsKCQl0aGlzLnkgPSBNYXRoLm1heCggdGhpcy55LCB2LnkgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNsYW1wKCBtaW4sIG1heCApIHsKCgkJLy8gYXNzdW1lcyBtaW4gPCBtYXgsIGNvbXBvbmVudHdpc2UKCgkJdGhpcy54ID0gTWF0aC5tYXgoIG1pbi54LCBNYXRoLm1pbiggbWF4LngsIHRoaXMueCApICk7CgkJdGhpcy55ID0gTWF0aC5tYXgoIG1pbi55LCBNYXRoLm1pbiggbWF4LnksIHRoaXMueSApICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljbGFtcFNjYWxhciggbWluVmFsLCBtYXhWYWwgKSB7CgoJCXRoaXMueCA9IE1hdGgubWF4KCBtaW5WYWwsIE1hdGgubWluKCBtYXhWYWwsIHRoaXMueCApICk7CgkJdGhpcy55ID0gTWF0aC5tYXgoIG1pblZhbCwgTWF0aC5taW4oIG1heFZhbCwgdGhpcy55ICkgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNsYW1wTGVuZ3RoKCBtaW4sIG1heCApIHsKCgkJY29uc3QgbGVuZ3RoID0gdGhpcy5sZW5ndGgoKTsKCgkJcmV0dXJuIHRoaXMuZGl2aWRlU2NhbGFyKCBsZW5ndGggfHwgMSApLm11bHRpcGx5U2NhbGFyKCBNYXRoLm1heCggbWluLCBNYXRoLm1pbiggbWF4LCBsZW5ndGggKSApICk7CgoJfQoKCWZsb29yKCkgewoKCQl0aGlzLnggPSBNYXRoLmZsb29yKCB0aGlzLnggKTsKCQl0aGlzLnkgPSBNYXRoLmZsb29yKCB0aGlzLnkgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNlaWwoKSB7CgoJCXRoaXMueCA9IE1hdGguY2VpbCggdGhpcy54ICk7CgkJdGhpcy55ID0gTWF0aC5jZWlsKCB0aGlzLnkgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXJvdW5kKCkgewoKCQl0aGlzLnggPSBNYXRoLnJvdW5kKCB0aGlzLnggKTsKCQl0aGlzLnkgPSBNYXRoLnJvdW5kKCB0aGlzLnkgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXJvdW5kVG9aZXJvKCkgewoKCQl0aGlzLnggPSBNYXRoLnRydW5jKCB0aGlzLnggKTsKCQl0aGlzLnkgPSBNYXRoLnRydW5jKCB0aGlzLnkgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCW5lZ2F0ZSgpIHsKCgkJdGhpcy54ID0gLSB0aGlzLng7CgkJdGhpcy55ID0gLSB0aGlzLnk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglkb3QoIHYgKSB7CgoJCXJldHVybiB0aGlzLnggKiB2LnggKyB0aGlzLnkgKiB2Lnk7CgoJfQoKCWNyb3NzKCB2ICkgewoKCQlyZXR1cm4gdGhpcy54ICogdi55IC0gdGhpcy55ICogdi54OwoKCX0KCglsZW5ndGhTcSgpIHsKCgkJcmV0dXJuIHRoaXMueCAqIHRoaXMueCArIHRoaXMueSAqIHRoaXMueTsKCgl9CgoJbGVuZ3RoKCkgewoKCQlyZXR1cm4gTWF0aC5zcXJ0KCB0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKTsKCgl9CgoJbWFuaGF0dGFuTGVuZ3RoKCkgewoKCQlyZXR1cm4gTWF0aC5hYnMoIHRoaXMueCApICsgTWF0aC5hYnMoIHRoaXMueSApOwoKCX0KCglub3JtYWxpemUoKSB7CgoJCXJldHVybiB0aGlzLmRpdmlkZVNjYWxhciggdGhpcy5sZW5ndGgoKSB8fCAxICk7CgoJfQoKCWFuZ2xlKCkgewoKCQkvLyBjb21wdXRlcyB0aGUgYW5nbGUgaW4gcmFkaWFucyB3aXRoIHJlc3BlY3QgdG8gdGhlIHBvc2l0aXZlIHgtYXhpcwoKCQljb25zdCBhbmdsZSA9IE1hdGguYXRhbjIoIC0gdGhpcy55LCAtIHRoaXMueCApICsgTWF0aC5QSTsKCgkJcmV0dXJuIGFuZ2xlOwoKCX0KCglhbmdsZVRvKCB2ICkgewoKCQljb25zdCBkZW5vbWluYXRvciA9IE1hdGguc3FydCggdGhpcy5sZW5ndGhTcSgpICogdi5sZW5ndGhTcSgpICk7CgoJCWlmICggZGVub21pbmF0b3IgPT09IDAgKSByZXR1cm4gTWF0aC5QSSAvIDI7CgoJCWNvbnN0IHRoZXRhID0gdGhpcy5kb3QoIHYgKSAvIGRlbm9taW5hdG9yOwoKCQkvLyBjbGFtcCwgdG8gaGFuZGxlIG51bWVyaWNhbCBwcm9ibGVtcwoKCQlyZXR1cm4gTWF0aC5hY29zKCBjbGFtcCggdGhldGEsIC0gMSwgMSApICk7CgoJfQoKCWRpc3RhbmNlVG8oIHYgKSB7CgoJCXJldHVybiBNYXRoLnNxcnQoIHRoaXMuZGlzdGFuY2VUb1NxdWFyZWQoIHYgKSApOwoKCX0KCglkaXN0YW5jZVRvU3F1YXJlZCggdiApIHsKCgkJY29uc3QgZHggPSB0aGlzLnggLSB2LngsIGR5ID0gdGhpcy55IC0gdi55OwoJCXJldHVybiBkeCAqIGR4ICsgZHkgKiBkeTsKCgl9CgoJbWFuaGF0dGFuRGlzdGFuY2VUbyggdiApIHsKCgkJcmV0dXJuIE1hdGguYWJzKCB0aGlzLnggLSB2LnggKSArIE1hdGguYWJzKCB0aGlzLnkgLSB2LnkgKTsKCgl9CgoJc2V0TGVuZ3RoKCBsZW5ndGggKSB7CgoJCXJldHVybiB0aGlzLm5vcm1hbGl6ZSgpLm11bHRpcGx5U2NhbGFyKCBsZW5ndGggKTsKCgl9CgoJbGVycCggdiwgYWxwaGEgKSB7CgoJCXRoaXMueCArPSAoIHYueCAtIHRoaXMueCApICogYWxwaGE7CgkJdGhpcy55ICs9ICggdi55IC0gdGhpcy55ICkgKiBhbHBoYTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWxlcnBWZWN0b3JzKCB2MSwgdjIsIGFscGhhICkgewoKCQl0aGlzLnggPSB2MS54ICsgKCB2Mi54IC0gdjEueCApICogYWxwaGE7CgkJdGhpcy55ID0gdjEueSArICggdjIueSAtIHYxLnkgKSAqIGFscGhhOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZXF1YWxzKCB2ICkgewoKCQlyZXR1cm4gKCAoIHYueCA9PT0gdGhpcy54ICkgJiYgKCB2LnkgPT09IHRoaXMueSApICk7CgoJfQoKCWZyb21BcnJheSggYXJyYXksIG9mZnNldCA9IDAgKSB7CgoJCXRoaXMueCA9IGFycmF5WyBvZmZzZXQgXTsKCQl0aGlzLnkgPSBhcnJheVsgb2Zmc2V0ICsgMSBdOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9BcnJheSggYXJyYXkgPSBbXSwgb2Zmc2V0ID0gMCApIHsKCgkJYXJyYXlbIG9mZnNldCBdID0gdGhpcy54OwoJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0aGlzLnk7CgoJCXJldHVybiBhcnJheTsKCgl9CgoJZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpbmRleCApIHsKCgkJdGhpcy54ID0gYXR0cmlidXRlLmdldFgoIGluZGV4ICk7CgkJdGhpcy55ID0gYXR0cmlidXRlLmdldFkoIGluZGV4ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglyb3RhdGVBcm91bmQoIGNlbnRlciwgYW5nbGUgKSB7CgoJCWNvbnN0IGMgPSBNYXRoLmNvcyggYW5nbGUgKSwgcyA9IE1hdGguc2luKCBhbmdsZSApOwoKCQljb25zdCB4ID0gdGhpcy54IC0gY2VudGVyLng7CgkJY29uc3QgeSA9IHRoaXMueSAtIGNlbnRlci55OwoKCQl0aGlzLnggPSB4ICogYyAtIHkgKiBzICsgY2VudGVyLng7CgkJdGhpcy55ID0geCAqIHMgKyB5ICogYyArIGNlbnRlci55OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJcmFuZG9tKCkgewoKCQl0aGlzLnggPSBNYXRoLnJhbmRvbSgpOwoJCXRoaXMueSA9IE1hdGgucmFuZG9tKCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgkqWyBTeW1ib2wuaXRlcmF0b3IgXSgpIHsKCgkJeWllbGQgdGhpcy54OwoJCXlpZWxkIHRoaXMueTsKCgl9Cgp9CgpjbGFzcyBNYXRyaXgzIHsKCgljb25zdHJ1Y3RvciggbjExLCBuMTIsIG4xMywgbjIxLCBuMjIsIG4yMywgbjMxLCBuMzIsIG4zMyApIHsKCgkJTWF0cml4My5wcm90b3R5cGUuaXNNYXRyaXgzID0gdHJ1ZTsKCgkJdGhpcy5lbGVtZW50cyA9IFsKCgkJCTEsIDAsIDAsCgkJCTAsIDEsIDAsCgkJCTAsIDAsIDEKCgkJXTsKCgkJaWYgKCBuMTEgIT09IHVuZGVmaW5lZCApIHsKCgkJCXRoaXMuc2V0KCBuMTEsIG4xMiwgbjEzLCBuMjEsIG4yMiwgbjIzLCBuMzEsIG4zMiwgbjMzICk7CgoJCX0KCgl9CgoJc2V0KCBuMTEsIG4xMiwgbjEzLCBuMjEsIG4yMiwgbjIzLCBuMzEsIG4zMiwgbjMzICkgewoKCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCXRlWyAwIF0gPSBuMTE7IHRlWyAxIF0gPSBuMjE7IHRlWyAyIF0gPSBuMzE7CgkJdGVbIDMgXSA9IG4xMjsgdGVbIDQgXSA9IG4yMjsgdGVbIDUgXSA9IG4zMjsKCQl0ZVsgNiBdID0gbjEzOyB0ZVsgNyBdID0gbjIzOyB0ZVsgOCBdID0gbjMzOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJaWRlbnRpdHkoKSB7CgoJCXRoaXMuc2V0KAoKCQkJMSwgMCwgMCwKCQkJMCwgMSwgMCwKCQkJMCwgMCwgMQoKCQkpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY29weSggbSApIHsKCgkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoJCWNvbnN0IG1lID0gbS5lbGVtZW50czsKCgkJdGVbIDAgXSA9IG1lWyAwIF07IHRlWyAxIF0gPSBtZVsgMSBdOyB0ZVsgMiBdID0gbWVbIDIgXTsKCQl0ZVsgMyBdID0gbWVbIDMgXTsgdGVbIDQgXSA9IG1lWyA0IF07IHRlWyA1IF0gPSBtZVsgNSBdOwoJCXRlWyA2IF0gPSBtZVsgNiBdOyB0ZVsgNyBdID0gbWVbIDcgXTsgdGVbIDggXSA9IG1lWyA4IF07CgoJCXJldHVybiB0aGlzOwoKCX0KCglleHRyYWN0QmFzaXMoIHhBeGlzLCB5QXhpcywgekF4aXMgKSB7CgoJCXhBeGlzLnNldEZyb21NYXRyaXgzQ29sdW1uKCB0aGlzLCAwICk7CgkJeUF4aXMuc2V0RnJvbU1hdHJpeDNDb2x1bW4oIHRoaXMsIDEgKTsKCQl6QXhpcy5zZXRGcm9tTWF0cml4M0NvbHVtbiggdGhpcywgMiApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RnJvbU1hdHJpeDQoIG0gKSB7CgoJCWNvbnN0IG1lID0gbS5lbGVtZW50czsKCgkJdGhpcy5zZXQoCgoJCQltZVsgMCBdLCBtZVsgNCBdLCBtZVsgOCBdLAoJCQltZVsgMSBdLCBtZVsgNSBdLCBtZVsgOSBdLAoJCQltZVsgMiBdLCBtZVsgNiBdLCBtZVsgMTAgXQoKCQkpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbXVsdGlwbHkoIG0gKSB7CgoJCXJldHVybiB0aGlzLm11bHRpcGx5TWF0cmljZXMoIHRoaXMsIG0gKTsKCgl9CgoJcHJlbXVsdGlwbHkoIG0gKSB7CgoJCXJldHVybiB0aGlzLm11bHRpcGx5TWF0cmljZXMoIG0sIHRoaXMgKTsKCgl9CgoJbXVsdGlwbHlNYXRyaWNlcyggYSwgYiApIHsKCgkJY29uc3QgYWUgPSBhLmVsZW1lbnRzOwoJCWNvbnN0IGJlID0gYi5lbGVtZW50czsKCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCWNvbnN0IGExMSA9IGFlWyAwIF0sIGExMiA9IGFlWyAzIF0sIGExMyA9IGFlWyA2IF07CgkJY29uc3QgYTIxID0gYWVbIDEgXSwgYTIyID0gYWVbIDQgXSwgYTIzID0gYWVbIDcgXTsKCQljb25zdCBhMzEgPSBhZVsgMiBdLCBhMzIgPSBhZVsgNSBdLCBhMzMgPSBhZVsgOCBdOwoKCQljb25zdCBiMTEgPSBiZVsgMCBdLCBiMTIgPSBiZVsgMyBdLCBiMTMgPSBiZVsgNiBdOwoJCWNvbnN0IGIyMSA9IGJlWyAxIF0sIGIyMiA9IGJlWyA0IF0sIGIyMyA9IGJlWyA3IF07CgkJY29uc3QgYjMxID0gYmVbIDIgXSwgYjMyID0gYmVbIDUgXSwgYjMzID0gYmVbIDggXTsKCgkJdGVbIDAgXSA9IGExMSAqIGIxMSArIGExMiAqIGIyMSArIGExMyAqIGIzMTsKCQl0ZVsgMyBdID0gYTExICogYjEyICsgYTEyICogYjIyICsgYTEzICogYjMyOwoJCXRlWyA2IF0gPSBhMTEgKiBiMTMgKyBhMTIgKiBiMjMgKyBhMTMgKiBiMzM7CgoJCXRlWyAxIF0gPSBhMjEgKiBiMTEgKyBhMjIgKiBiMjEgKyBhMjMgKiBiMzE7CgkJdGVbIDQgXSA9IGEyMSAqIGIxMiArIGEyMiAqIGIyMiArIGEyMyAqIGIzMjsKCQl0ZVsgNyBdID0gYTIxICogYjEzICsgYTIyICogYjIzICsgYTIzICogYjMzOwoKCQl0ZVsgMiBdID0gYTMxICogYjExICsgYTMyICogYjIxICsgYTMzICogYjMxOwoJCXRlWyA1IF0gPSBhMzEgKiBiMTIgKyBhMzIgKiBiMjIgKyBhMzMgKiBiMzI7CgkJdGVbIDggXSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMzsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCW11bHRpcGx5U2NhbGFyKCBzICkgewoKCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCXRlWyAwIF0gKj0gczsgdGVbIDMgXSAqPSBzOyB0ZVsgNiBdICo9IHM7CgkJdGVbIDEgXSAqPSBzOyB0ZVsgNCBdICo9IHM7IHRlWyA3IF0gKj0gczsKCQl0ZVsgMiBdICo9IHM7IHRlWyA1IF0gKj0gczsgdGVbIDggXSAqPSBzOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZGV0ZXJtaW5hbnQoKSB7CgoJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCgkJY29uc3QgYSA9IHRlWyAwIF0sIGIgPSB0ZVsgMSBdLCBjID0gdGVbIDIgXSwKCQkJZCA9IHRlWyAzIF0sIGUgPSB0ZVsgNCBdLCBmID0gdGVbIDUgXSwKCQkJZyA9IHRlWyA2IF0sIGggPSB0ZVsgNyBdLCBpID0gdGVbIDggXTsKCgkJcmV0dXJuIGEgKiBlICogaSAtIGEgKiBmICogaCAtIGIgKiBkICogaSArIGIgKiBmICogZyArIGMgKiBkICogaCAtIGMgKiBlICogZzsKCgl9CgoJaW52ZXJ0KCkgewoKCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHMsCgoJCQluMTEgPSB0ZVsgMCBdLCBuMjEgPSB0ZVsgMSBdLCBuMzEgPSB0ZVsgMiBdLAoJCQluMTIgPSB0ZVsgMyBdLCBuMjIgPSB0ZVsgNCBdLCBuMzIgPSB0ZVsgNSBdLAoJCQluMTMgPSB0ZVsgNiBdLCBuMjMgPSB0ZVsgNyBdLCBuMzMgPSB0ZVsgOCBdLAoKCQkJdDExID0gbjMzICogbjIyIC0gbjMyICogbjIzLAoJCQl0MTIgPSBuMzIgKiBuMTMgLSBuMzMgKiBuMTIsCgkJCXQxMyA9IG4yMyAqIG4xMiAtIG4yMiAqIG4xMywKCgkJCWRldCA9IG4xMSAqIHQxMSArIG4yMSAqIHQxMiArIG4zMSAqIHQxMzsKCgkJaWYgKCBkZXQgPT09IDAgKSByZXR1cm4gdGhpcy5zZXQoIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAsIDAgKTsKCgkJY29uc3QgZGV0SW52ID0gMSAvIGRldDsKCgkJdGVbIDAgXSA9IHQxMSAqIGRldEludjsKCQl0ZVsgMSBdID0gKCBuMzEgKiBuMjMgLSBuMzMgKiBuMjEgKSAqIGRldEludjsKCQl0ZVsgMiBdID0gKCBuMzIgKiBuMjEgLSBuMzEgKiBuMjIgKSAqIGRldEludjsKCgkJdGVbIDMgXSA9IHQxMiAqIGRldEludjsKCQl0ZVsgNCBdID0gKCBuMzMgKiBuMTEgLSBuMzEgKiBuMTMgKSAqIGRldEludjsKCQl0ZVsgNSBdID0gKCBuMzEgKiBuMTIgLSBuMzIgKiBuMTEgKSAqIGRldEludjsKCgkJdGVbIDYgXSA9IHQxMyAqIGRldEludjsKCQl0ZVsgNyBdID0gKCBuMjEgKiBuMTMgLSBuMjMgKiBuMTEgKSAqIGRldEludjsKCQl0ZVsgOCBdID0gKCBuMjIgKiBuMTEgLSBuMjEgKiBuMTIgKSAqIGRldEludjsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRyYW5zcG9zZSgpIHsKCgkJbGV0IHRtcDsKCQljb25zdCBtID0gdGhpcy5lbGVtZW50czsKCgkJdG1wID0gbVsgMSBdOyBtWyAxIF0gPSBtWyAzIF07IG1bIDMgXSA9IHRtcDsKCQl0bXAgPSBtWyAyIF07IG1bIDIgXSA9IG1bIDYgXTsgbVsgNiBdID0gdG1wOwoJCXRtcCA9IG1bIDUgXTsgbVsgNSBdID0gbVsgNyBdOyBtWyA3IF0gPSB0bXA7CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXROb3JtYWxNYXRyaXgoIG1hdHJpeDQgKSB7CgoJCXJldHVybiB0aGlzLnNldEZyb21NYXRyaXg0KCBtYXRyaXg0ICkuaW52ZXJ0KCkudHJhbnNwb3NlKCk7CgoJfQoKCXRyYW5zcG9zZUludG9BcnJheSggciApIHsKCgkJY29uc3QgbSA9IHRoaXMuZWxlbWVudHM7CgoJCXJbIDAgXSA9IG1bIDAgXTsKCQlyWyAxIF0gPSBtWyAzIF07CgkJclsgMiBdID0gbVsgNiBdOwoJCXJbIDMgXSA9IG1bIDEgXTsKCQlyWyA0IF0gPSBtWyA0IF07CgkJclsgNSBdID0gbVsgNyBdOwoJCXJbIDYgXSA9IG1bIDIgXTsKCQlyWyA3IF0gPSBtWyA1IF07CgkJclsgOCBdID0gbVsgOCBdOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0VXZUcmFuc2Zvcm0oIHR4LCB0eSwgc3gsIHN5LCByb3RhdGlvbiwgY3gsIGN5ICkgewoKCQljb25zdCBjID0gTWF0aC5jb3MoIHJvdGF0aW9uICk7CgkJY29uc3QgcyA9IE1hdGguc2luKCByb3RhdGlvbiApOwoKCQl0aGlzLnNldCgKCQkJc3ggKiBjLCBzeCAqIHMsIC0gc3ggKiAoIGMgKiBjeCArIHMgKiBjeSApICsgY3ggKyB0eCwKCQkJLSBzeSAqIHMsIHN5ICogYywgLSBzeSAqICggLSBzICogY3ggKyBjICogY3kgKSArIGN5ICsgdHksCgkJCTAsIDAsIDEKCQkpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJLy8KCglzY2FsZSggc3gsIHN5ICkgewoKCQl0aGlzLnByZW11bHRpcGx5KCBfbTMubWFrZVNjYWxlKCBzeCwgc3kgKSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJcm90YXRlKCB0aGV0YSApIHsKCgkJdGhpcy5wcmVtdWx0aXBseSggX20zLm1ha2VSb3RhdGlvbiggLSB0aGV0YSApICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0cmFuc2xhdGUoIHR4LCB0eSApIHsKCgkJdGhpcy5wcmVtdWx0aXBseSggX20zLm1ha2VUcmFuc2xhdGlvbiggdHgsIHR5ICkgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCS8vIGZvciAyRCBUcmFuc2Zvcm1zCgoJbWFrZVRyYW5zbGF0aW9uKCB4LCB5ICkgewoKCQlpZiAoIHguaXNWZWN0b3IyICkgewoKCQkJdGhpcy5zZXQoCgoJCQkJMSwgMCwgeC54LAoJCQkJMCwgMSwgeC55LAoJCQkJMCwgMCwgMQoKCQkJKTsKCgkJfSBlbHNlIHsKCgkJCXRoaXMuc2V0KAoKCQkJCTEsIDAsIHgsCgkJCQkwLCAxLCB5LAoJCQkJMCwgMCwgMQoKCQkJKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbWFrZVJvdGF0aW9uKCB0aGV0YSApIHsKCgkJLy8gY291bnRlcmNsb2Nrd2lzZQoKCQljb25zdCBjID0gTWF0aC5jb3MoIHRoZXRhICk7CgkJY29uc3QgcyA9IE1hdGguc2luKCB0aGV0YSApOwoKCQl0aGlzLnNldCgKCgkJCWMsIC0gcywgMCwKCQkJcywgYywgMCwKCQkJMCwgMCwgMQoKCQkpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbWFrZVNjYWxlKCB4LCB5ICkgewoKCQl0aGlzLnNldCgKCgkJCXgsIDAsIDAsCgkJCTAsIHksIDAsCgkJCTAsIDAsIDEKCgkJKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCS8vCgoJZXF1YWxzKCBtYXRyaXggKSB7CgoJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCQljb25zdCBtZSA9IG1hdHJpeC5lbGVtZW50czsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgOTsgaSArKyApIHsKCgkJCWlmICggdGVbIGkgXSAhPT0gbWVbIGkgXSApIHJldHVybiBmYWxzZTsKCgkJfQoKCQlyZXR1cm4gdHJ1ZTsKCgl9CgoJZnJvbUFycmF5KCBhcnJheSwgb2Zmc2V0ID0gMCApIHsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgOTsgaSArKyApIHsKCgkJCXRoaXMuZWxlbWVudHNbIGkgXSA9IGFycmF5WyBpICsgb2Zmc2V0IF07CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgoJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCgkJYXJyYXlbIG9mZnNldCBdID0gdGVbIDAgXTsKCQlhcnJheVsgb2Zmc2V0ICsgMSBdID0gdGVbIDEgXTsKCQlhcnJheVsgb2Zmc2V0ICsgMiBdID0gdGVbIDIgXTsKCgkJYXJyYXlbIG9mZnNldCArIDMgXSA9IHRlWyAzIF07CgkJYXJyYXlbIG9mZnNldCArIDQgXSA9IHRlWyA0IF07CgkJYXJyYXlbIG9mZnNldCArIDUgXSA9IHRlWyA1IF07CgoJCWFycmF5WyBvZmZzZXQgKyA2IF0gPSB0ZVsgNiBdOwoJCWFycmF5WyBvZmZzZXQgKyA3IF0gPSB0ZVsgNyBdOwoJCWFycmF5WyBvZmZzZXQgKyA4IF0gPSB0ZVsgOCBdOwoKCQlyZXR1cm4gYXJyYXk7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5mcm9tQXJyYXkoIHRoaXMuZWxlbWVudHMgKTsKCgl9Cgp9Cgpjb25zdCBfbTMgPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCk7CgpmdW5jdGlvbiBhcnJheU5lZWRzVWludDMyKCBhcnJheSApIHsKCgkvLyBhc3N1bWVzIGxhcmdlciB2YWx1ZXMgdXN1YWxseSBvbiBsYXN0CgoJZm9yICggbGV0IGkgPSBhcnJheS5sZW5ndGggLSAxOyBpID49IDA7IC0tIGkgKSB7CgoJCWlmICggYXJyYXlbIGkgXSA+PSA2NTUzNSApIHJldHVybiB0cnVlOyAvLyBhY2NvdW50IGZvciBQUklNSVRJVkVfUkVTVEFSVF9GSVhFRF9JTkRFWCwgIzI0NTY1CgoJfQoKCXJldHVybiBmYWxzZTsKCn0KCmNvbnN0IFRZUEVEX0FSUkFZUyA9IHsKCUludDhBcnJheTogSW50OEFycmF5LAoJVWludDhBcnJheTogVWludDhBcnJheSwKCVVpbnQ4Q2xhbXBlZEFycmF5OiBVaW50OENsYW1wZWRBcnJheSwKCUludDE2QXJyYXk6IEludDE2QXJyYXksCglVaW50MTZBcnJheTogVWludDE2QXJyYXksCglJbnQzMkFycmF5OiBJbnQzMkFycmF5LAoJVWludDMyQXJyYXk6IFVpbnQzMkFycmF5LAoJRmxvYXQzMkFycmF5OiBGbG9hdDMyQXJyYXksCglGbG9hdDY0QXJyYXk6IEZsb2F0NjRBcnJheQp9OwoKZnVuY3Rpb24gZ2V0VHlwZWRBcnJheSggdHlwZSwgYnVmZmVyICkgewoKCXJldHVybiBuZXcgVFlQRURfQVJSQVlTWyB0eXBlIF0oIGJ1ZmZlciApOwoKfQoKZnVuY3Rpb24gY3JlYXRlRWxlbWVudE5TKCBuYW1lICkgewoKCXJldHVybiBkb2N1bWVudC5jcmVhdGVFbGVtZW50TlMoICdodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hodG1sJywgbmFtZSApOwoKfQoKZnVuY3Rpb24gY3JlYXRlQ2FudmFzRWxlbWVudCgpIHsKCgljb25zdCBjYW52YXMgPSBjcmVhdGVFbGVtZW50TlMoICdjYW52YXMnICk7CgljYW52YXMuc3R5bGUuZGlzcGxheSA9ICdibG9jayc7CglyZXR1cm4gY2FudmFzOwoKfQoKY29uc3QgX2NhY2hlID0ge307CgpmdW5jdGlvbiB3YXJuT25jZSggbWVzc2FnZSApIHsKCglpZiAoIG1lc3NhZ2UgaW4gX2NhY2hlICkgcmV0dXJuOwoKCV9jYWNoZVsgbWVzc2FnZSBdID0gdHJ1ZTsKCgljb25zb2xlLndhcm4oIG1lc3NhZ2UgKTsKCn0KCi8qKgogKiBNYXRyaWNlcyBjb252ZXJ0aW5nIFAzIDwtPiBSZWMuIDcwOSBwcmltYXJpZXMsIHdpdGhvdXQgZ2FtdXQgbWFwcGluZwogKiBvciBjbGlwcGluZy4gQmFzZWQgb24gVzNDIHNwZWNpZmljYXRpb25zIGZvciBzUkdCIGFuZCBEaXNwbGF5IFAzLAogKiBhbmQgSUNDIHNwZWNpZmljYXRpb25zIGZvciB0aGUgRDUwIGNvbm5lY3Rpb24gc3BhY2UuIFZhbHVlcyBpbi9vdXQKICogYXJlIF9saW5lYXJfIHNSR0IgYW5kIF9saW5lYXJfIERpc3BsYXkgUDMuCiAqCiAqIE5vdGUgdGhhdCBib3RoIHNSR0IgYW5kIERpc3BsYXkgUDMgdXNlIHRoZSBzUkdCIHRyYW5zZmVyIGZ1bmN0aW9ucy4KICoKICogUmVmZXJlbmNlOgogKiAtIGh0dHA6Ly93d3cucnVzc2VsbGNvdHRyZWxsLmNvbS9waG90by9tYXRyaXhDYWxjdWxhdG9yLmh0bQogKi8KCmNvbnN0IExJTkVBUl9TUkdCX1RPX0xJTkVBUl9ESVNQTEFZX1AzID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpLnNldCgKCTAuODIyNDYyMSwgMC4xNzc1MzgsIDAuMCwKCTAuMDMzMTk0MSwgMC45NjY4MDU4LCAwLjAsCgkwLjAxNzA4MjcsIDAuMDcyMzk3NCwgMC45MTA1MTk5LAopOwoKY29uc3QgTElORUFSX0RJU1BMQVlfUDNfVE9fTElORUFSX1NSR0IgPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkuc2V0KAoJMS4yMjQ5NDAxLCAtIDAuMjI0OTQwNCwgMC4wLAoJLSAwLjA0MjA1NjksIDEuMDQyMDU3MSwgMC4wLAoJLSAwLjAxOTYzNzYsIC0gMC4wNzg2MzYxLCAxLjA5ODI3MzUKKTsKCi8qKgogKiBEZWZpbmVzIHN1cHBvcnRlZCBjb2xvciBzcGFjZXMgYnkgdHJhbnNmZXIgZnVuY3Rpb24gYW5kIHByaW1hcmllcywKICogYW5kIHByb3ZpZGVzIGNvbnZlcnNpb25zIHRvL2Zyb20gdGhlIExpbmVhci1zUkdCIHJlZmVyZW5jZSBzcGFjZS4KICovCmNvbnN0IENPTE9SX1NQQUNFUyA9IHsKCVsgTGluZWFyU1JHQkNvbG9yU3BhY2UgXTogewoJCXRyYW5zZmVyOiBMaW5lYXJUcmFuc2ZlciwKCQlwcmltYXJpZXM6IFJlYzcwOVByaW1hcmllcywKCQl0b1JlZmVyZW5jZTogKCBjb2xvciApID0+IGNvbG9yLAoJCWZyb21SZWZlcmVuY2U6ICggY29sb3IgKSA9PiBjb2xvciwKCX0sCglbIFNSR0JDb2xvclNwYWNlIF06IHsKCQl0cmFuc2ZlcjogU1JHQlRyYW5zZmVyLAoJCXByaW1hcmllczogUmVjNzA5UHJpbWFyaWVzLAoJCXRvUmVmZXJlbmNlOiAoIGNvbG9yICkgPT4gY29sb3IuY29udmVydFNSR0JUb0xpbmVhcigpLAoJCWZyb21SZWZlcmVuY2U6ICggY29sb3IgKSA9PiBjb2xvci5jb252ZXJ0TGluZWFyVG9TUkdCKCksCgl9LAoJWyBMaW5lYXJEaXNwbGF5UDNDb2xvclNwYWNlIF06IHsKCQl0cmFuc2ZlcjogTGluZWFyVHJhbnNmZXIsCgkJcHJpbWFyaWVzOiBQM1ByaW1hcmllcywKCQl0b1JlZmVyZW5jZTogKCBjb2xvciApID0+IGNvbG9yLmFwcGx5TWF0cml4MyggTElORUFSX0RJU1BMQVlfUDNfVE9fTElORUFSX1NSR0IgKSwKCQlmcm9tUmVmZXJlbmNlOiAoIGNvbG9yICkgPT4gY29sb3IuYXBwbHlNYXRyaXgzKCBMSU5FQVJfU1JHQl9UT19MSU5FQVJfRElTUExBWV9QMyApLAoJfSwKCVsgRGlzcGxheVAzQ29sb3JTcGFjZSBdOiB7CgkJdHJhbnNmZXI6IFNSR0JUcmFuc2ZlciwKCQlwcmltYXJpZXM6IFAzUHJpbWFyaWVzLAoJCXRvUmVmZXJlbmNlOiAoIGNvbG9yICkgPT4gY29sb3IuY29udmVydFNSR0JUb0xpbmVhcigpLmFwcGx5TWF0cml4MyggTElORUFSX0RJU1BMQVlfUDNfVE9fTElORUFSX1NSR0IgKSwKCQlmcm9tUmVmZXJlbmNlOiAoIGNvbG9yICkgPT4gY29sb3IuYXBwbHlNYXRyaXgzKCBMSU5FQVJfU1JHQl9UT19MSU5FQVJfRElTUExBWV9QMyApLmNvbnZlcnRMaW5lYXJUb1NSR0IoKSwKCX0sCn07Cgpjb25zdCBTVVBQT1JURURfV09SS0lOR19DT0xPUl9TUEFDRVMgPSBuZXcgU2V0KCBbIExpbmVhclNSR0JDb2xvclNwYWNlLCBMaW5lYXJEaXNwbGF5UDNDb2xvclNwYWNlIF0gKTsKCmNvbnN0IENvbG9yTWFuYWdlbWVudCA9IHsKCgllbmFibGVkOiB0cnVlLAoKCV93b3JraW5nQ29sb3JTcGFjZTogTGluZWFyU1JHQkNvbG9yU3BhY2UsCgoJZ2V0IGxlZ2FjeU1vZGUoKSB7CgoJCWNvbnNvbGUud2FybiggJ1RIUkVFLkNvbG9yTWFuYWdlbWVudDogLmxlZ2FjeU1vZGU9ZmFsc2UgcmVuYW1lZCB0byAuZW5hYmxlZD10cnVlIGluIHIxNTAuJyApOwoKCQlyZXR1cm4gISB0aGlzLmVuYWJsZWQ7CgoJfSwKCglzZXQgbGVnYWN5TW9kZSggbGVnYWN5TW9kZSApIHsKCgkJY29uc29sZS53YXJuKCAnVEhSRUUuQ29sb3JNYW5hZ2VtZW50OiAubGVnYWN5TW9kZT1mYWxzZSByZW5hbWVkIHRvIC5lbmFibGVkPXRydWUgaW4gcjE1MC4nICk7CgoJCXRoaXMuZW5hYmxlZCA9ICEgbGVnYWN5TW9kZTsKCgl9LAoKCWdldCB3b3JraW5nQ29sb3JTcGFjZSgpIHsKCgkJcmV0dXJuIHRoaXMuX3dvcmtpbmdDb2xvclNwYWNlOwoKCX0sCgoJc2V0IHdvcmtpbmdDb2xvclNwYWNlKCBjb2xvclNwYWNlICkgewoKCQlpZiAoICEgU1VQUE9SVEVEX1dPUktJTkdfQ09MT1JfU1BBQ0VTLmhhcyggY29sb3JTcGFjZSApICkgewoKCQkJdGhyb3cgbmV3IEVycm9yKCBgVW5zdXBwb3J0ZWQgd29ya2luZyBjb2xvciBzcGFjZSwgIiR7IGNvbG9yU3BhY2UgfSIuYCApOwoKCQl9CgoJCXRoaXMuX3dvcmtpbmdDb2xvclNwYWNlID0gY29sb3JTcGFjZTsKCgl9LAoKCWNvbnZlcnQ6IGZ1bmN0aW9uICggY29sb3IsIHNvdXJjZUNvbG9yU3BhY2UsIHRhcmdldENvbG9yU3BhY2UgKSB7CgoJCWlmICggdGhpcy5lbmFibGVkID09PSBmYWxzZSB8fCBzb3VyY2VDb2xvclNwYWNlID09PSB0YXJnZXRDb2xvclNwYWNlIHx8ICEgc291cmNlQ29sb3JTcGFjZSB8fCAhIHRhcmdldENvbG9yU3BhY2UgKSB7CgoJCQlyZXR1cm4gY29sb3I7CgoJCX0KCgkJY29uc3Qgc291cmNlVG9SZWZlcmVuY2UgPSBDT0xPUl9TUEFDRVNbIHNvdXJjZUNvbG9yU3BhY2UgXS50b1JlZmVyZW5jZTsKCQljb25zdCB0YXJnZXRGcm9tUmVmZXJlbmNlID0gQ09MT1JfU1BBQ0VTWyB0YXJnZXRDb2xvclNwYWNlIF0uZnJvbVJlZmVyZW5jZTsKCgkJcmV0dXJuIHRhcmdldEZyb21SZWZlcmVuY2UoIHNvdXJjZVRvUmVmZXJlbmNlKCBjb2xvciApICk7CgoJfSwKCglmcm9tV29ya2luZ0NvbG9yU3BhY2U6IGZ1bmN0aW9uICggY29sb3IsIHRhcmdldENvbG9yU3BhY2UgKSB7CgoJCXJldHVybiB0aGlzLmNvbnZlcnQoIGNvbG9yLCB0aGlzLl93b3JraW5nQ29sb3JTcGFjZSwgdGFyZ2V0Q29sb3JTcGFjZSApOwoKCX0sCgoJdG9Xb3JraW5nQ29sb3JTcGFjZTogZnVuY3Rpb24gKCBjb2xvciwgc291cmNlQ29sb3JTcGFjZSApIHsKCgkJcmV0dXJuIHRoaXMuY29udmVydCggY29sb3IsIHNvdXJjZUNvbG9yU3BhY2UsIHRoaXMuX3dvcmtpbmdDb2xvclNwYWNlICk7CgoJfSwKCglnZXRQcmltYXJpZXM6IGZ1bmN0aW9uICggY29sb3JTcGFjZSApIHsKCgkJcmV0dXJuIENPTE9SX1NQQUNFU1sgY29sb3JTcGFjZSBdLnByaW1hcmllczsKCgl9LAoKCWdldFRyYW5zZmVyOiBmdW5jdGlvbiAoIGNvbG9yU3BhY2UgKSB7CgoJCWlmICggY29sb3JTcGFjZSA9PT0gTm9Db2xvclNwYWNlICkgcmV0dXJuIExpbmVhclRyYW5zZmVyOwoKCQlyZXR1cm4gQ09MT1JfU1BBQ0VTWyBjb2xvclNwYWNlIF0udHJhbnNmZXI7CgoJfSwKCn07CgoKZnVuY3Rpb24gU1JHQlRvTGluZWFyKCBjICkgewoKCXJldHVybiAoIGMgPCAwLjA0MDQ1ICkgPyBjICogMC4wNzczOTkzODA4IDogTWF0aC5wb3coIGMgKiAwLjk0Nzg2NzI5ODYgKyAwLjA1MjEzMjcwMTQsIDIuNCApOwoKfQoKZnVuY3Rpb24gTGluZWFyVG9TUkdCKCBjICkgewoKCXJldHVybiAoIGMgPCAwLjAwMzEzMDggKSA/IGMgKiAxMi45MiA6IDEuMDU1ICogKCBNYXRoLnBvdyggYywgMC40MTY2NiApICkgLSAwLjA1NTsKCn0KCmxldCBfY2FudmFzOwoKY2xhc3MgSW1hZ2VVdGlscyB7CgoJc3RhdGljIGdldERhdGFVUkwoIGltYWdlICkgewoKCQlpZiAoIC9eZGF0YTovaS50ZXN0KCBpbWFnZS5zcmMgKSApIHsKCgkJCXJldHVybiBpbWFnZS5zcmM7CgoJCX0KCgkJaWYgKCB0eXBlb2YgSFRNTENhbnZhc0VsZW1lbnQgPT09ICd1bmRlZmluZWQnICkgewoKCQkJcmV0dXJuIGltYWdlLnNyYzsKCgkJfQoKCQlsZXQgY2FudmFzOwoKCQlpZiAoIGltYWdlIGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQgKSB7CgoJCQljYW52YXMgPSBpbWFnZTsKCgkJfSBlbHNlIHsKCgkJCWlmICggX2NhbnZhcyA9PT0gdW5kZWZpbmVkICkgX2NhbnZhcyA9IGNyZWF0ZUVsZW1lbnROUyggJ2NhbnZhcycgKTsKCgkJCV9jYW52YXMud2lkdGggPSBpbWFnZS53aWR0aDsKCQkJX2NhbnZhcy5oZWlnaHQgPSBpbWFnZS5oZWlnaHQ7CgoJCQljb25zdCBjb250ZXh0ID0gX2NhbnZhcy5nZXRDb250ZXh0KCAnMmQnICk7CgoJCQlpZiAoIGltYWdlIGluc3RhbmNlb2YgSW1hZ2VEYXRhICkgewoKCQkJCWNvbnRleHQucHV0SW1hZ2VEYXRhKCBpbWFnZSwgMCwgMCApOwoKCQkJfSBlbHNlIHsKCgkJCQljb250ZXh0LmRyYXdJbWFnZSggaW1hZ2UsIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQgKTsKCgkJCX0KCgkJCWNhbnZhcyA9IF9jYW52YXM7CgoJCX0KCgkJaWYgKCBjYW52YXMud2lkdGggPiAyMDQ4IHx8IGNhbnZhcy5oZWlnaHQgPiAyMDQ4ICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuSW1hZ2VVdGlscy5nZXREYXRhVVJMOiBJbWFnZSBjb252ZXJ0ZWQgdG8ganBnIGZvciBwZXJmb3JtYW5jZSByZWFzb25zJywgaW1hZ2UgKTsKCgkJCXJldHVybiBjYW52YXMudG9EYXRhVVJMKCAnaW1hZ2UvanBlZycsIDAuNiApOwoKCQl9IGVsc2UgewoKCQkJcmV0dXJuIGNhbnZhcy50b0RhdGFVUkwoICdpbWFnZS9wbmcnICk7CgoJCX0KCgl9CgoJc3RhdGljIHNSR0JUb0xpbmVhciggaW1hZ2UgKSB7CgoJCWlmICggKCB0eXBlb2YgSFRNTEltYWdlRWxlbWVudCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50ICkgfHwKCQkJKCB0eXBlb2YgSFRNTENhbnZhc0VsZW1lbnQgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQgKSB8fAoJCQkoIHR5cGVvZiBJbWFnZUJpdG1hcCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBJbWFnZUJpdG1hcCApICkgewoKCQkJY29uc3QgY2FudmFzID0gY3JlYXRlRWxlbWVudE5TKCAnY2FudmFzJyApOwoKCQkJY2FudmFzLndpZHRoID0gaW1hZ2Uud2lkdGg7CgkJCWNhbnZhcy5oZWlnaHQgPSBpbWFnZS5oZWlnaHQ7CgoJCQljb25zdCBjb250ZXh0ID0gY2FudmFzLmdldENvbnRleHQoICcyZCcgKTsKCQkJY29udGV4dC5kcmF3SW1hZ2UoIGltYWdlLCAwLCAwLCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICk7CgoJCQljb25zdCBpbWFnZURhdGEgPSBjb250ZXh0LmdldEltYWdlRGF0YSggMCwgMCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCApOwoJCQljb25zdCBkYXRhID0gaW1hZ2VEYXRhLmRhdGE7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSArKyApIHsKCgkJCQlkYXRhWyBpIF0gPSBTUkdCVG9MaW5lYXIoIGRhdGFbIGkgXSAvIDI1NSApICogMjU1OwoKCQkJfQoKCQkJY29udGV4dC5wdXRJbWFnZURhdGEoIGltYWdlRGF0YSwgMCwgMCApOwoKCQkJcmV0dXJuIGNhbnZhczsKCgkJfSBlbHNlIGlmICggaW1hZ2UuZGF0YSApIHsKCgkJCWNvbnN0IGRhdGEgPSBpbWFnZS5kYXRhLnNsaWNlKCAwICk7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBkYXRhLmxlbmd0aDsgaSArKyApIHsKCgkJCQlpZiAoIGRhdGEgaW5zdGFuY2VvZiBVaW50OEFycmF5IHx8IGRhdGEgaW5zdGFuY2VvZiBVaW50OENsYW1wZWRBcnJheSApIHsKCgkJCQkJZGF0YVsgaSBdID0gTWF0aC5mbG9vciggU1JHQlRvTGluZWFyKCBkYXRhWyBpIF0gLyAyNTUgKSAqIDI1NSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCS8vIGFzc3VtaW5nIGZsb2F0CgoJCQkJCWRhdGFbIGkgXSA9IFNSR0JUb0xpbmVhciggZGF0YVsgaSBdICk7CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIHsKCQkJCWRhdGE6IGRhdGEsCgkJCQl3aWR0aDogaW1hZ2Uud2lkdGgsCgkJCQloZWlnaHQ6IGltYWdlLmhlaWdodAoJCQl9OwoKCQl9IGVsc2UgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuSW1hZ2VVdGlscy5zUkdCVG9MaW5lYXIoKTogVW5zdXBwb3J0ZWQgaW1hZ2UgdHlwZS4gTm8gY29sb3Igc3BhY2UgY29udmVyc2lvbiBhcHBsaWVkLicgKTsKCQkJcmV0dXJuIGltYWdlOwoKCQl9CgoJfQoKfQoKbGV0IF9zb3VyY2VJZCA9IDA7CgpjbGFzcyBTb3VyY2UgewoKCWNvbnN0cnVjdG9yKCBkYXRhID0gbnVsbCApIHsKCgkJdGhpcy5pc1NvdXJjZSA9IHRydWU7CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eSggdGhpcywgJ2lkJywgeyB2YWx1ZTogX3NvdXJjZUlkICsrIH0gKTsKCgkJdGhpcy51dWlkID0gZ2VuZXJhdGVVVUlEKCk7CgoJCXRoaXMuZGF0YSA9IGRhdGE7CgoJCXRoaXMudmVyc2lvbiA9IDA7CgoJfQoKCXNldCBuZWVkc1VwZGF0ZSggdmFsdWUgKSB7CgoJCWlmICggdmFsdWUgPT09IHRydWUgKSB0aGlzLnZlcnNpb24gKys7CgoJfQoKCXRvSlNPTiggbWV0YSApIHsKCgkJY29uc3QgaXNSb290T2JqZWN0ID0gKCBtZXRhID09PSB1bmRlZmluZWQgfHwgdHlwZW9mIG1ldGEgPT09ICdzdHJpbmcnICk7CgoJCWlmICggISBpc1Jvb3RPYmplY3QgJiYgbWV0YS5pbWFnZXNbIHRoaXMudXVpZCBdICE9PSB1bmRlZmluZWQgKSB7CgoJCQlyZXR1cm4gbWV0YS5pbWFnZXNbIHRoaXMudXVpZCBdOwoKCQl9CgoJCWNvbnN0IG91dHB1dCA9IHsKCQkJdXVpZDogdGhpcy51dWlkLAoJCQl1cmw6ICcnCgkJfTsKCgkJY29uc3QgZGF0YSA9IHRoaXMuZGF0YTsKCgkJaWYgKCBkYXRhICE9PSBudWxsICkgewoKCQkJbGV0IHVybDsKCgkJCWlmICggQXJyYXkuaXNBcnJheSggZGF0YSApICkgewoKCQkJCS8vIGN1YmUgdGV4dHVyZQoKCQkJCXVybCA9IFtdOwoKCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IGRhdGEubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJaWYgKCBkYXRhWyBpIF0uaXNEYXRhVGV4dHVyZSApIHsKCgkJCQkJCXVybC5wdXNoKCBzZXJpYWxpemVJbWFnZSggZGF0YVsgaSBdLmltYWdlICkgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXVybC5wdXNoKCBzZXJpYWxpemVJbWFnZSggZGF0YVsgaSBdICkgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJLy8gdGV4dHVyZQoKCQkJCXVybCA9IHNlcmlhbGl6ZUltYWdlKCBkYXRhICk7CgoJCQl9CgoJCQlvdXRwdXQudXJsID0gdXJsOwoKCQl9CgoJCWlmICggISBpc1Jvb3RPYmplY3QgKSB7CgoJCQltZXRhLmltYWdlc1sgdGhpcy51dWlkIF0gPSBvdXRwdXQ7CgoJCX0KCgkJcmV0dXJuIG91dHB1dDsKCgl9Cgp9CgpmdW5jdGlvbiBzZXJpYWxpemVJbWFnZSggaW1hZ2UgKSB7CgoJaWYgKCAoIHR5cGVvZiBIVE1MSW1hZ2VFbGVtZW50ICE9PSAndW5kZWZpbmVkJyAmJiBpbWFnZSBpbnN0YW5jZW9mIEhUTUxJbWFnZUVsZW1lbnQgKSB8fAoJCSggdHlwZW9mIEhUTUxDYW52YXNFbGVtZW50ICE9PSAndW5kZWZpbmVkJyAmJiBpbWFnZSBpbnN0YW5jZW9mIEhUTUxDYW52YXNFbGVtZW50ICkgfHwKCQkoIHR5cGVvZiBJbWFnZUJpdG1hcCAhPT0gJ3VuZGVmaW5lZCcgJiYgaW1hZ2UgaW5zdGFuY2VvZiBJbWFnZUJpdG1hcCApICkgewoKCQkvLyBkZWZhdWx0IGltYWdlcwoKCQlyZXR1cm4gSW1hZ2VVdGlscy5nZXREYXRhVVJMKCBpbWFnZSApOwoKCX0gZWxzZSB7CgoJCWlmICggaW1hZ2UuZGF0YSApIHsKCgkJCS8vIGltYWdlcyBvZiBEYXRhVGV4dHVyZQoKCQkJcmV0dXJuIHsKCQkJCWRhdGE6IEFycmF5LmZyb20oIGltYWdlLmRhdGEgKSwKCQkJCXdpZHRoOiBpbWFnZS53aWR0aCwKCQkJCWhlaWdodDogaW1hZ2UuaGVpZ2h0LAoJCQkJdHlwZTogaW1hZ2UuZGF0YS5jb25zdHJ1Y3Rvci5uYW1lCgkJCX07CgoJCX0gZWxzZSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5UZXh0dXJlOiBVbmFibGUgdG8gc2VyaWFsaXplIFRleHR1cmUuJyApOwoJCQlyZXR1cm4ge307CgoJCX0KCgl9Cgp9CgpsZXQgX3RleHR1cmVJZCA9IDA7CgpjbGFzcyBUZXh0dXJlIGV4dGVuZHMgRXZlbnREaXNwYXRjaGVyIHsKCgljb25zdHJ1Y3RvciggaW1hZ2UgPSBUZXh0dXJlLkRFRkFVTFRfSU1BR0UsIG1hcHBpbmcgPSBUZXh0dXJlLkRFRkFVTFRfTUFQUElORywgd3JhcFMgPSBDbGFtcFRvRWRnZVdyYXBwaW5nLCB3cmFwVCA9IENsYW1wVG9FZGdlV3JhcHBpbmcsIG1hZ0ZpbHRlciA9IExpbmVhckZpbHRlciwgbWluRmlsdGVyID0gTGluZWFyTWlwbWFwTGluZWFyRmlsdGVyLCBmb3JtYXQgPSBSR0JBRm9ybWF0LCB0eXBlID0gVW5zaWduZWRCeXRlVHlwZSwgYW5pc290cm9weSA9IFRleHR1cmUuREVGQVVMVF9BTklTT1RST1BZLCBjb2xvclNwYWNlID0gTm9Db2xvclNwYWNlICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzVGV4dHVyZSA9IHRydWU7CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eSggdGhpcywgJ2lkJywgeyB2YWx1ZTogX3RleHR1cmVJZCArKyB9ICk7CgoJCXRoaXMudXVpZCA9IGdlbmVyYXRlVVVJRCgpOwoKCQl0aGlzLm5hbWUgPSAnJzsKCgkJdGhpcy5zb3VyY2UgPSBuZXcgU291cmNlKCBpbWFnZSApOwoJCXRoaXMubWlwbWFwcyA9IFtdOwoKCQl0aGlzLm1hcHBpbmcgPSBtYXBwaW5nOwoJCXRoaXMuY2hhbm5lbCA9IDA7CgoJCXRoaXMud3JhcFMgPSB3cmFwUzsKCQl0aGlzLndyYXBUID0gd3JhcFQ7CgoJCXRoaXMubWFnRmlsdGVyID0gbWFnRmlsdGVyOwoJCXRoaXMubWluRmlsdGVyID0gbWluRmlsdGVyOwoKCQl0aGlzLmFuaXNvdHJvcHkgPSBhbmlzb3Ryb3B5OwoKCQl0aGlzLmZvcm1hdCA9IGZvcm1hdDsKCQl0aGlzLmludGVybmFsRm9ybWF0ID0gbnVsbDsKCQl0aGlzLnR5cGUgPSB0eXBlOwoKCQl0aGlzLm9mZnNldCA9IG5ldyBWZWN0b3IyKCAwLCAwICk7CgkJdGhpcy5yZXBlYXQgPSBuZXcgVmVjdG9yMiggMSwgMSApOwoJCXRoaXMuY2VudGVyID0gbmV3IFZlY3RvcjIoIDAsIDAgKTsKCQl0aGlzLnJvdGF0aW9uID0gMDsKCgkJdGhpcy5tYXRyaXhBdXRvVXBkYXRlID0gdHJ1ZTsKCQl0aGlzLm1hdHJpeCA9IG5ldyBNYXRyaXgzKCk7CgoJCXRoaXMuZ2VuZXJhdGVNaXBtYXBzID0gdHJ1ZTsKCQl0aGlzLnByZW11bHRpcGx5QWxwaGEgPSBmYWxzZTsKCQl0aGlzLmZsaXBZID0gdHJ1ZTsKCQl0aGlzLnVucGFja0FsaWdubWVudCA9IDQ7CS8vIHZhbGlkIHZhbHVlczogMSwgMiwgNCwgOCAoc2VlIGh0dHA6Ly93d3cua2hyb25vcy5vcmcvb3BlbmdsZXMvc2RrL2RvY3MvbWFuL3hodG1sL2dsUGl4ZWxTdG9yZWkueG1sKQoKCQlpZiAoIHR5cGVvZiBjb2xvclNwYWNlID09PSAnc3RyaW5nJyApIHsKCgkJCXRoaXMuY29sb3JTcGFjZSA9IGNvbG9yU3BhY2U7CgoJCX0gZWxzZSB7IC8vIEBkZXByZWNhdGVkLCByMTUyCgoJCQl3YXJuT25jZSggJ1RIUkVFLlRleHR1cmU6IFByb3BlcnR5IC5lbmNvZGluZyBoYXMgYmVlbiByZXBsYWNlZCBieSAuY29sb3JTcGFjZS4nICk7CgkJCXRoaXMuY29sb3JTcGFjZSA9IGNvbG9yU3BhY2UgPT09IHNSR0JFbmNvZGluZyA/IFNSR0JDb2xvclNwYWNlIDogTm9Db2xvclNwYWNlOwoKCQl9CgoKCQl0aGlzLnVzZXJEYXRhID0ge307CgoJCXRoaXMudmVyc2lvbiA9IDA7CgkJdGhpcy5vblVwZGF0ZSA9IG51bGw7CgoJCXRoaXMuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID0gZmFsc2U7IC8vIGluZGljYXRlcyB3aGV0aGVyIGEgdGV4dHVyZSBiZWxvbmdzIHRvIGEgcmVuZGVyIHRhcmdldCBvciBub3QKCQl0aGlzLm5lZWRzUE1SRU1VcGRhdGUgPSBmYWxzZTsgLy8gaW5kaWNhdGVzIHdoZXRoZXIgdGhpcyB0ZXh0dXJlIHNob3VsZCBiZSBwcm9jZXNzZWQgYnkgUE1SRU1HZW5lcmF0b3Igb3Igbm90IChvbmx5IHJlbGV2YW50IGZvciByZW5kZXIgdGFyZ2V0IHRleHR1cmVzKQoKCX0KCglnZXQgaW1hZ2UoKSB7CgoJCXJldHVybiB0aGlzLnNvdXJjZS5kYXRhOwoKCX0KCglzZXQgaW1hZ2UoIHZhbHVlID0gbnVsbCApIHsKCgkJdGhpcy5zb3VyY2UuZGF0YSA9IHZhbHVlOwoKCX0KCgl1cGRhdGVNYXRyaXgoKSB7CgoJCXRoaXMubWF0cml4LnNldFV2VHJhbnNmb3JtKCB0aGlzLm9mZnNldC54LCB0aGlzLm9mZnNldC55LCB0aGlzLnJlcGVhdC54LCB0aGlzLnJlcGVhdC55LCB0aGlzLnJvdGF0aW9uLCB0aGlzLmNlbnRlci54LCB0aGlzLmNlbnRlci55ICk7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJdGhpcy5uYW1lID0gc291cmNlLm5hbWU7CgoJCXRoaXMuc291cmNlID0gc291cmNlLnNvdXJjZTsKCQl0aGlzLm1pcG1hcHMgPSBzb3VyY2UubWlwbWFwcy5zbGljZSggMCApOwoKCQl0aGlzLm1hcHBpbmcgPSBzb3VyY2UubWFwcGluZzsKCQl0aGlzLmNoYW5uZWwgPSBzb3VyY2UuY2hhbm5lbDsKCgkJdGhpcy53cmFwUyA9IHNvdXJjZS53cmFwUzsKCQl0aGlzLndyYXBUID0gc291cmNlLndyYXBUOwoKCQl0aGlzLm1hZ0ZpbHRlciA9IHNvdXJjZS5tYWdGaWx0ZXI7CgkJdGhpcy5taW5GaWx0ZXIgPSBzb3VyY2UubWluRmlsdGVyOwoKCQl0aGlzLmFuaXNvdHJvcHkgPSBzb3VyY2UuYW5pc290cm9weTsKCgkJdGhpcy5mb3JtYXQgPSBzb3VyY2UuZm9ybWF0OwoJCXRoaXMuaW50ZXJuYWxGb3JtYXQgPSBzb3VyY2UuaW50ZXJuYWxGb3JtYXQ7CgkJdGhpcy50eXBlID0gc291cmNlLnR5cGU7CgoJCXRoaXMub2Zmc2V0LmNvcHkoIHNvdXJjZS5vZmZzZXQgKTsKCQl0aGlzLnJlcGVhdC5jb3B5KCBzb3VyY2UucmVwZWF0ICk7CgkJdGhpcy5jZW50ZXIuY29weSggc291cmNlLmNlbnRlciApOwoJCXRoaXMucm90YXRpb24gPSBzb3VyY2Uucm90YXRpb247CgoJCXRoaXMubWF0cml4QXV0b1VwZGF0ZSA9IHNvdXJjZS5tYXRyaXhBdXRvVXBkYXRlOwoJCXRoaXMubWF0cml4LmNvcHkoIHNvdXJjZS5tYXRyaXggKTsKCgkJdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBzb3VyY2UuZ2VuZXJhdGVNaXBtYXBzOwoJCXRoaXMucHJlbXVsdGlwbHlBbHBoYSA9IHNvdXJjZS5wcmVtdWx0aXBseUFscGhhOwoJCXRoaXMuZmxpcFkgPSBzb3VyY2UuZmxpcFk7CgkJdGhpcy51bnBhY2tBbGlnbm1lbnQgPSBzb3VyY2UudW5wYWNrQWxpZ25tZW50OwoJCXRoaXMuY29sb3JTcGFjZSA9IHNvdXJjZS5jb2xvclNwYWNlOwoKCQl0aGlzLnVzZXJEYXRhID0gSlNPTi5wYXJzZSggSlNPTi5zdHJpbmdpZnkoIHNvdXJjZS51c2VyRGF0YSApICk7CgoJCXRoaXMubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9KU09OKCBtZXRhICkgewoKCQljb25zdCBpc1Jvb3RPYmplY3QgPSAoIG1ldGEgPT09IHVuZGVmaW5lZCB8fCB0eXBlb2YgbWV0YSA9PT0gJ3N0cmluZycgKTsKCgkJaWYgKCAhIGlzUm9vdE9iamVjdCAmJiBtZXRhLnRleHR1cmVzWyB0aGlzLnV1aWQgXSAhPT0gdW5kZWZpbmVkICkgewoKCQkJcmV0dXJuIG1ldGEudGV4dHVyZXNbIHRoaXMudXVpZCBdOwoKCQl9CgoJCWNvbnN0IG91dHB1dCA9IHsKCgkJCW1ldGFkYXRhOiB7CgkJCQl2ZXJzaW9uOiA0LjYsCgkJCQl0eXBlOiAnVGV4dHVyZScsCgkJCQlnZW5lcmF0b3I6ICdUZXh0dXJlLnRvSlNPTicKCQkJfSwKCgkJCXV1aWQ6IHRoaXMudXVpZCwKCQkJbmFtZTogdGhpcy5uYW1lLAoKCQkJaW1hZ2U6IHRoaXMuc291cmNlLnRvSlNPTiggbWV0YSApLnV1aWQsCgoJCQltYXBwaW5nOiB0aGlzLm1hcHBpbmcsCgkJCWNoYW5uZWw6IHRoaXMuY2hhbm5lbCwKCgkJCXJlcGVhdDogWyB0aGlzLnJlcGVhdC54LCB0aGlzLnJlcGVhdC55IF0sCgkJCW9mZnNldDogWyB0aGlzLm9mZnNldC54LCB0aGlzLm9mZnNldC55IF0sCgkJCWNlbnRlcjogWyB0aGlzLmNlbnRlci54LCB0aGlzLmNlbnRlci55IF0sCgkJCXJvdGF0aW9uOiB0aGlzLnJvdGF0aW9uLAoKCQkJd3JhcDogWyB0aGlzLndyYXBTLCB0aGlzLndyYXBUIF0sCgoJCQlmb3JtYXQ6IHRoaXMuZm9ybWF0LAoJCQlpbnRlcm5hbEZvcm1hdDogdGhpcy5pbnRlcm5hbEZvcm1hdCwKCQkJdHlwZTogdGhpcy50eXBlLAoJCQljb2xvclNwYWNlOiB0aGlzLmNvbG9yU3BhY2UsCgoJCQltaW5GaWx0ZXI6IHRoaXMubWluRmlsdGVyLAoJCQltYWdGaWx0ZXI6IHRoaXMubWFnRmlsdGVyLAoJCQlhbmlzb3Ryb3B5OiB0aGlzLmFuaXNvdHJvcHksCgoJCQlmbGlwWTogdGhpcy5mbGlwWSwKCgkJCWdlbmVyYXRlTWlwbWFwczogdGhpcy5nZW5lcmF0ZU1pcG1hcHMsCgkJCXByZW11bHRpcGx5QWxwaGE6IHRoaXMucHJlbXVsdGlwbHlBbHBoYSwKCQkJdW5wYWNrQWxpZ25tZW50OiB0aGlzLnVucGFja0FsaWdubWVudAoKCQl9OwoKCQlpZiAoIE9iamVjdC5rZXlzKCB0aGlzLnVzZXJEYXRhICkubGVuZ3RoID4gMCApIG91dHB1dC51c2VyRGF0YSA9IHRoaXMudXNlckRhdGE7CgoJCWlmICggISBpc1Jvb3RPYmplY3QgKSB7CgoJCQltZXRhLnRleHR1cmVzWyB0aGlzLnV1aWQgXSA9IG91dHB1dDsKCgkJfQoKCQlyZXR1cm4gb3V0cHV0OwoKCX0KCglkaXNwb3NlKCkgewoKCQl0aGlzLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ2Rpc3Bvc2UnIH0gKTsKCgl9CgoJdHJhbnNmb3JtVXYoIHV2ICkgewoKCQlpZiAoIHRoaXMubWFwcGluZyAhPT0gVVZNYXBwaW5nICkgcmV0dXJuIHV2OwoKCQl1di5hcHBseU1hdHJpeDMoIHRoaXMubWF0cml4ICk7CgoJCWlmICggdXYueCA8IDAgfHwgdXYueCA+IDEgKSB7CgoJCQlzd2l0Y2ggKCB0aGlzLndyYXBTICkgewoKCQkJCWNhc2UgUmVwZWF0V3JhcHBpbmc6CgoJCQkJCXV2LnggPSB1di54IC0gTWF0aC5mbG9vciggdXYueCApOwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgQ2xhbXBUb0VkZ2VXcmFwcGluZzoKCgkJCQkJdXYueCA9IHV2LnggPCAwID8gMCA6IDE7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSBNaXJyb3JlZFJlcGVhdFdyYXBwaW5nOgoKCQkJCQlpZiAoIE1hdGguYWJzKCBNYXRoLmZsb29yKCB1di54ICkgJSAyICkgPT09IDEgKSB7CgoJCQkJCQl1di54ID0gTWF0aC5jZWlsKCB1di54ICkgLSB1di54OwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdXYueCA9IHV2LnggLSBNYXRoLmZsb29yKCB1di54ICk7CgoJCQkJCX0KCgkJCQkJYnJlYWs7CgoJCQl9CgoJCX0KCgkJaWYgKCB1di55IDwgMCB8fCB1di55ID4gMSApIHsKCgkJCXN3aXRjaCAoIHRoaXMud3JhcFQgKSB7CgoJCQkJY2FzZSBSZXBlYXRXcmFwcGluZzoKCgkJCQkJdXYueSA9IHV2LnkgLSBNYXRoLmZsb29yKCB1di55ICk7CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSBDbGFtcFRvRWRnZVdyYXBwaW5nOgoKCQkJCQl1di55ID0gdXYueSA8IDAgPyAwIDogMTsKCQkJCQlicmVhazsKCgkJCQljYXNlIE1pcnJvcmVkUmVwZWF0V3JhcHBpbmc6CgoJCQkJCWlmICggTWF0aC5hYnMoIE1hdGguZmxvb3IoIHV2LnkgKSAlIDIgKSA9PT0gMSApIHsKCgkJCQkJCXV2LnkgPSBNYXRoLmNlaWwoIHV2LnkgKSAtIHV2Lnk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQl1di55ID0gdXYueSAtIE1hdGguZmxvb3IoIHV2LnkgKTsKCgkJCQkJfQoKCQkJCQlicmVhazsKCgkJCX0KCgkJfQoKCQlpZiAoIHRoaXMuZmxpcFkgKSB7CgoJCQl1di55ID0gMSAtIHV2Lnk7CgoJCX0KCgkJcmV0dXJuIHV2OwoKCX0KCglzZXQgbmVlZHNVcGRhdGUoIHZhbHVlICkgewoKCQlpZiAoIHZhbHVlID09PSB0cnVlICkgewoKCQkJdGhpcy52ZXJzaW9uICsrOwoJCQl0aGlzLnNvdXJjZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCX0KCgl9CgoJZ2V0IGVuY29kaW5nKCkgeyAvLyBAZGVwcmVjYXRlZCwgcjE1MgoKCQl3YXJuT25jZSggJ1RIUkVFLlRleHR1cmU6IFByb3BlcnR5IC5lbmNvZGluZyBoYXMgYmVlbiByZXBsYWNlZCBieSAuY29sb3JTcGFjZS4nICk7CgkJcmV0dXJuIHRoaXMuY29sb3JTcGFjZSA9PT0gU1JHQkNvbG9yU3BhY2UgPyBzUkdCRW5jb2RpbmcgOiBMaW5lYXJFbmNvZGluZzsKCgl9CgoJc2V0IGVuY29kaW5nKCBlbmNvZGluZyApIHsgLy8gQGRlcHJlY2F0ZWQsIHIxNTIKCgkJd2Fybk9uY2UoICdUSFJFRS5UZXh0dXJlOiBQcm9wZXJ0eSAuZW5jb2RpbmcgaGFzIGJlZW4gcmVwbGFjZWQgYnkgLmNvbG9yU3BhY2UuJyApOwoJCXRoaXMuY29sb3JTcGFjZSA9IGVuY29kaW5nID09PSBzUkdCRW5jb2RpbmcgPyBTUkdCQ29sb3JTcGFjZSA6IE5vQ29sb3JTcGFjZTsKCgl9Cgp9CgpUZXh0dXJlLkRFRkFVTFRfSU1BR0UgPSBudWxsOwpUZXh0dXJlLkRFRkFVTFRfTUFQUElORyA9IFVWTWFwcGluZzsKVGV4dHVyZS5ERUZBVUxUX0FOSVNPVFJPUFkgPSAxOwoKY2xhc3MgVmVjdG9yNCB7CgoJY29uc3RydWN0b3IoIHggPSAwLCB5ID0gMCwgeiA9IDAsIHcgPSAxICkgewoKCQlWZWN0b3I0LnByb3RvdHlwZS5pc1ZlY3RvcjQgPSB0cnVlOwoKCQl0aGlzLnggPSB4OwoJCXRoaXMueSA9IHk7CgkJdGhpcy56ID0gejsKCQl0aGlzLncgPSB3OwoKCX0KCglnZXQgd2lkdGgoKSB7CgoJCXJldHVybiB0aGlzLno7CgoJfQoKCXNldCB3aWR0aCggdmFsdWUgKSB7CgoJCXRoaXMueiA9IHZhbHVlOwoKCX0KCglnZXQgaGVpZ2h0KCkgewoKCQlyZXR1cm4gdGhpcy53OwoKCX0KCglzZXQgaGVpZ2h0KCB2YWx1ZSApIHsKCgkJdGhpcy53ID0gdmFsdWU7CgoJfQoKCXNldCggeCwgeSwgeiwgdyApIHsKCgkJdGhpcy54ID0geDsKCQl0aGlzLnkgPSB5OwoJCXRoaXMueiA9IHo7CgkJdGhpcy53ID0gdzsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldFNjYWxhciggc2NhbGFyICkgewoKCQl0aGlzLnggPSBzY2FsYXI7CgkJdGhpcy55ID0gc2NhbGFyOwoJCXRoaXMueiA9IHNjYWxhcjsKCQl0aGlzLncgPSBzY2FsYXI7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRYKCB4ICkgewoKCQl0aGlzLnggPSB4OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0WSggeSApIHsKCgkJdGhpcy55ID0geTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldFooIHogKSB7CgoJCXRoaXMueiA9IHo7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRXKCB3ICkgewoKCQl0aGlzLncgPSB3OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0Q29tcG9uZW50KCBpbmRleCwgdmFsdWUgKSB7CgoJCXN3aXRjaCAoIGluZGV4ICkgewoKCQkJY2FzZSAwOiB0aGlzLnggPSB2YWx1ZTsgYnJlYWs7CgkJCWNhc2UgMTogdGhpcy55ID0gdmFsdWU7IGJyZWFrOwoJCQljYXNlIDI6IHRoaXMueiA9IHZhbHVlOyBicmVhazsKCQkJY2FzZSAzOiB0aGlzLncgPSB2YWx1ZTsgYnJlYWs7CgkJCWRlZmF1bHQ6IHRocm93IG5ldyBFcnJvciggJ2luZGV4IGlzIG91dCBvZiByYW5nZTogJyArIGluZGV4ICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWdldENvbXBvbmVudCggaW5kZXggKSB7CgoJCXN3aXRjaCAoIGluZGV4ICkgewoKCQkJY2FzZSAwOiByZXR1cm4gdGhpcy54OwoJCQljYXNlIDE6IHJldHVybiB0aGlzLnk7CgkJCWNhc2UgMjogcmV0dXJuIHRoaXMuejsKCQkJY2FzZSAzOiByZXR1cm4gdGhpcy53OwoJCQlkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoICdpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICcgKyBpbmRleCApOwoKCQl9CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMueCwgdGhpcy55LCB0aGlzLnosIHRoaXMudyApOwoKCX0KCgljb3B5KCB2ICkgewoKCQl0aGlzLnggPSB2Lng7CgkJdGhpcy55ID0gdi55OwoJCXRoaXMueiA9IHYuejsKCQl0aGlzLncgPSAoIHYudyAhPT0gdW5kZWZpbmVkICkgPyB2LncgOiAxOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJYWRkKCB2ICkgewoKCQl0aGlzLnggKz0gdi54OwoJCXRoaXMueSArPSB2Lnk7CgkJdGhpcy56ICs9IHYuejsKCQl0aGlzLncgKz0gdi53OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJYWRkU2NhbGFyKCBzICkgewoKCQl0aGlzLnggKz0gczsKCQl0aGlzLnkgKz0gczsKCQl0aGlzLnogKz0gczsKCQl0aGlzLncgKz0gczsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFkZFZlY3RvcnMoIGEsIGIgKSB7CgoJCXRoaXMueCA9IGEueCArIGIueDsKCQl0aGlzLnkgPSBhLnkgKyBiLnk7CgkJdGhpcy56ID0gYS56ICsgYi56OwoJCXRoaXMudyA9IGEudyArIGIudzsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFkZFNjYWxlZFZlY3RvciggdiwgcyApIHsKCgkJdGhpcy54ICs9IHYueCAqIHM7CgkJdGhpcy55ICs9IHYueSAqIHM7CgkJdGhpcy56ICs9IHYueiAqIHM7CgkJdGhpcy53ICs9IHYudyAqIHM7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzdWIoIHYgKSB7CgoJCXRoaXMueCAtPSB2Lng7CgkJdGhpcy55IC09IHYueTsKCQl0aGlzLnogLT0gdi56OwoJCXRoaXMudyAtPSB2Lnc7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzdWJTY2FsYXIoIHMgKSB7CgoJCXRoaXMueCAtPSBzOwoJCXRoaXMueSAtPSBzOwoJCXRoaXMueiAtPSBzOwoJCXRoaXMudyAtPSBzOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc3ViVmVjdG9ycyggYSwgYiApIHsKCgkJdGhpcy54ID0gYS54IC0gYi54OwoJCXRoaXMueSA9IGEueSAtIGIueTsKCQl0aGlzLnogPSBhLnogLSBiLno7CgkJdGhpcy53ID0gYS53IC0gYi53OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbXVsdGlwbHkoIHYgKSB7CgoJCXRoaXMueCAqPSB2Lng7CgkJdGhpcy55ICo9IHYueTsKCQl0aGlzLnogKj0gdi56OwoJCXRoaXMudyAqPSB2Lnc7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltdWx0aXBseVNjYWxhciggc2NhbGFyICkgewoKCQl0aGlzLnggKj0gc2NhbGFyOwoJCXRoaXMueSAqPSBzY2FsYXI7CgkJdGhpcy56ICo9IHNjYWxhcjsKCQl0aGlzLncgKj0gc2NhbGFyOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJYXBwbHlNYXRyaXg0KCBtICkgewoKCQljb25zdCB4ID0gdGhpcy54LCB5ID0gdGhpcy55LCB6ID0gdGhpcy56LCB3ID0gdGhpcy53OwoJCWNvbnN0IGUgPSBtLmVsZW1lbnRzOwoKCQl0aGlzLnggPSBlWyAwIF0gKiB4ICsgZVsgNCBdICogeSArIGVbIDggXSAqIHogKyBlWyAxMiBdICogdzsKCQl0aGlzLnkgPSBlWyAxIF0gKiB4ICsgZVsgNSBdICogeSArIGVbIDkgXSAqIHogKyBlWyAxMyBdICogdzsKCQl0aGlzLnogPSBlWyAyIF0gKiB4ICsgZVsgNiBdICogeSArIGVbIDEwIF0gKiB6ICsgZVsgMTQgXSAqIHc7CgkJdGhpcy53ID0gZVsgMyBdICogeCArIGVbIDcgXSAqIHkgKyBlWyAxMSBdICogeiArIGVbIDE1IF0gKiB3OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZGl2aWRlU2NhbGFyKCBzY2FsYXIgKSB7CgoJCXJldHVybiB0aGlzLm11bHRpcGx5U2NhbGFyKCAxIC8gc2NhbGFyICk7CgoJfQoKCXNldEF4aXNBbmdsZUZyb21RdWF0ZXJuaW9uKCBxICkgewoKCQkvLyBodHRwOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9nZW9tZXRyeS9yb3RhdGlvbnMvY29udmVyc2lvbnMvcXVhdGVybmlvblRvQW5nbGUvaW5kZXguaHRtCgoJCS8vIHEgaXMgYXNzdW1lZCB0byBiZSBub3JtYWxpemVkCgoJCXRoaXMudyA9IDIgKiBNYXRoLmFjb3MoIHEudyApOwoKCQljb25zdCBzID0gTWF0aC5zcXJ0KCAxIC0gcS53ICogcS53ICk7CgoJCWlmICggcyA8IDAuMDAwMSApIHsKCgkJCXRoaXMueCA9IDE7CgkJCXRoaXMueSA9IDA7CgkJCXRoaXMueiA9IDA7CgoJCX0gZWxzZSB7CgoJCQl0aGlzLnggPSBxLnggLyBzOwoJCQl0aGlzLnkgPSBxLnkgLyBzOwoJCQl0aGlzLnogPSBxLnogLyBzOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRBeGlzQW5nbGVGcm9tUm90YXRpb25NYXRyaXgoIG0gKSB7CgoJCS8vIGh0dHA6Ly93d3cuZXVjbGlkZWFuc3BhY2UuY29tL21hdGhzL2dlb21ldHJ5L3JvdGF0aW9ucy9jb252ZXJzaW9ucy9tYXRyaXhUb0FuZ2xlL2luZGV4Lmh0bQoKCQkvLyBhc3N1bWVzIHRoZSB1cHBlciAzeDMgb2YgbSBpcyBhIHB1cmUgcm90YXRpb24gbWF0cml4IChpLmUsIHVuc2NhbGVkKQoKCQlsZXQgYW5nbGUsIHgsIHksIHo7IC8vIHZhcmlhYmxlcyBmb3IgcmVzdWx0CgkJY29uc3QgZXBzaWxvbiA9IDAuMDEsCQkvLyBtYXJnaW4gdG8gYWxsb3cgZm9yIHJvdW5kaW5nIGVycm9ycwoJCQllcHNpbG9uMiA9IDAuMSwJCS8vIG1hcmdpbiB0byBkaXN0aW5ndWlzaCBiZXR3ZWVuIDAgYW5kIDE4MCBkZWdyZWVzCgoJCQl0ZSA9IG0uZWxlbWVudHMsCgoJCQltMTEgPSB0ZVsgMCBdLCBtMTIgPSB0ZVsgNCBdLCBtMTMgPSB0ZVsgOCBdLAoJCQltMjEgPSB0ZVsgMSBdLCBtMjIgPSB0ZVsgNSBdLCBtMjMgPSB0ZVsgOSBdLAoJCQltMzEgPSB0ZVsgMiBdLCBtMzIgPSB0ZVsgNiBdLCBtMzMgPSB0ZVsgMTAgXTsKCgkJaWYgKCAoIE1hdGguYWJzKCBtMTIgLSBtMjEgKSA8IGVwc2lsb24gKSAmJgoJCSAgICAgKCBNYXRoLmFicyggbTEzIC0gbTMxICkgPCBlcHNpbG9uICkgJiYKCQkgICAgICggTWF0aC5hYnMoIG0yMyAtIG0zMiApIDwgZXBzaWxvbiApICkgewoKCQkJLy8gc2luZ3VsYXJpdHkgZm91bmQKCQkJLy8gZmlyc3QgY2hlY2sgZm9yIGlkZW50aXR5IG1hdHJpeCB3aGljaCBtdXN0IGhhdmUgKzEgZm9yIGFsbCB0ZXJtcwoJCQkvLyBpbiBsZWFkaW5nIGRpYWdvbmFsIGFuZCB6ZXJvIGluIG90aGVyIHRlcm1zCgoJCQlpZiAoICggTWF0aC5hYnMoIG0xMiArIG0yMSApIDwgZXBzaWxvbjIgKSAmJgoJCQkgICAgICggTWF0aC5hYnMoIG0xMyArIG0zMSApIDwgZXBzaWxvbjIgKSAmJgoJCQkgICAgICggTWF0aC5hYnMoIG0yMyArIG0zMiApIDwgZXBzaWxvbjIgKSAmJgoJCQkgICAgICggTWF0aC5hYnMoIG0xMSArIG0yMiArIG0zMyAtIDMgKSA8IGVwc2lsb24yICkgKSB7CgoJCQkJLy8gdGhpcyBzaW5ndWxhcml0eSBpcyBpZGVudGl0eSBtYXRyaXggc28gYW5nbGUgPSAwCgoJCQkJdGhpcy5zZXQoIDEsIDAsIDAsIDAgKTsKCgkJCQlyZXR1cm4gdGhpczsgLy8gemVybyBhbmdsZSwgYXJiaXRyYXJ5IGF4aXMKCgkJCX0KCgkJCS8vIG90aGVyd2lzZSB0aGlzIHNpbmd1bGFyaXR5IGlzIGFuZ2xlID0gMTgwCgoJCQlhbmdsZSA9IE1hdGguUEk7CgoJCQljb25zdCB4eCA9ICggbTExICsgMSApIC8gMjsKCQkJY29uc3QgeXkgPSAoIG0yMiArIDEgKSAvIDI7CgkJCWNvbnN0IHp6ID0gKCBtMzMgKyAxICkgLyAyOwoJCQljb25zdCB4eSA9ICggbTEyICsgbTIxICkgLyA0OwoJCQljb25zdCB4eiA9ICggbTEzICsgbTMxICkgLyA0OwoJCQljb25zdCB5eiA9ICggbTIzICsgbTMyICkgLyA0OwoKCQkJaWYgKCAoIHh4ID4geXkgKSAmJiAoIHh4ID4genogKSApIHsKCgkJCQkvLyBtMTEgaXMgdGhlIGxhcmdlc3QgZGlhZ29uYWwgdGVybQoKCQkJCWlmICggeHggPCBlcHNpbG9uICkgewoKCQkJCQl4ID0gMDsKCQkJCQl5ID0gMC43MDcxMDY3ODE7CgkJCQkJeiA9IDAuNzA3MTA2NzgxOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXggPSBNYXRoLnNxcnQoIHh4ICk7CgkJCQkJeSA9IHh5IC8geDsKCQkJCQl6ID0geHogLyB4OwoKCQkJCX0KCgkJCX0gZWxzZSBpZiAoIHl5ID4genogKSB7CgoJCQkJLy8gbTIyIGlzIHRoZSBsYXJnZXN0IGRpYWdvbmFsIHRlcm0KCgkJCQlpZiAoIHl5IDwgZXBzaWxvbiApIHsKCgkJCQkJeCA9IDAuNzA3MTA2NzgxOwoJCQkJCXkgPSAwOwoJCQkJCXogPSAwLjcwNzEwNjc4MTsKCgkJCQl9IGVsc2UgewoKCQkJCQl5ID0gTWF0aC5zcXJ0KCB5eSApOwoJCQkJCXggPSB4eSAvIHk7CgkJCQkJeiA9IHl6IC8geTsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCS8vIG0zMyBpcyB0aGUgbGFyZ2VzdCBkaWFnb25hbCB0ZXJtIHNvIGJhc2UgcmVzdWx0IG9uIHRoaXMKCgkJCQlpZiAoIHp6IDwgZXBzaWxvbiApIHsKCgkJCQkJeCA9IDAuNzA3MTA2NzgxOwoJCQkJCXkgPSAwLjcwNzEwNjc4MTsKCQkJCQl6ID0gMDsKCgkJCQl9IGVsc2UgewoKCQkJCQl6ID0gTWF0aC5zcXJ0KCB6eiApOwoJCQkJCXggPSB4eiAvIHo7CgkJCQkJeSA9IHl6IC8gejsKCgkJCQl9CgoJCQl9CgoJCQl0aGlzLnNldCggeCwgeSwgeiwgYW5nbGUgKTsKCgkJCXJldHVybiB0aGlzOyAvLyByZXR1cm4gMTgwIGRlZyByb3RhdGlvbgoKCQl9CgoJCS8vIGFzIHdlIGhhdmUgcmVhY2hlZCBoZXJlIHRoZXJlIGFyZSBubyBzaW5ndWxhcml0aWVzIHNvIHdlIGNhbiBoYW5kbGUgbm9ybWFsbHkKCgkJbGV0IHMgPSBNYXRoLnNxcnQoICggbTMyIC0gbTIzICkgKiAoIG0zMiAtIG0yMyApICsKCQkJKCBtMTMgLSBtMzEgKSAqICggbTEzIC0gbTMxICkgKwoJCQkoIG0yMSAtIG0xMiApICogKCBtMjEgLSBtMTIgKSApOyAvLyB1c2VkIHRvIG5vcm1hbGl6ZQoKCQlpZiAoIE1hdGguYWJzKCBzICkgPCAwLjAwMSApIHMgPSAxOwoKCQkvLyBwcmV2ZW50IGRpdmlkZSBieSB6ZXJvLCBzaG91bGQgbm90IGhhcHBlbiBpZiBtYXRyaXggaXMgb3J0aG9nb25hbCBhbmQgc2hvdWxkIGJlCgkJLy8gY2F1Z2h0IGJ5IHNpbmd1bGFyaXR5IHRlc3QgYWJvdmUsIGJ1dCBJJ3ZlIGxlZnQgaXQgaW4ganVzdCBpbiBjYXNlCgoJCXRoaXMueCA9ICggbTMyIC0gbTIzICkgLyBzOwoJCXRoaXMueSA9ICggbTEzIC0gbTMxICkgLyBzOwoJCXRoaXMueiA9ICggbTIxIC0gbTEyICkgLyBzOwoJCXRoaXMudyA9IE1hdGguYWNvcyggKCBtMTEgKyBtMjIgKyBtMzMgLSAxICkgLyAyICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltaW4oIHYgKSB7CgoJCXRoaXMueCA9IE1hdGgubWluKCB0aGlzLngsIHYueCApOwoJCXRoaXMueSA9IE1hdGgubWluKCB0aGlzLnksIHYueSApOwoJCXRoaXMueiA9IE1hdGgubWluKCB0aGlzLnosIHYueiApOwoJCXRoaXMudyA9IE1hdGgubWluKCB0aGlzLncsIHYudyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbWF4KCB2ICkgewoKCQl0aGlzLnggPSBNYXRoLm1heCggdGhpcy54LCB2LnggKTsKCQl0aGlzLnkgPSBNYXRoLm1heCggdGhpcy55LCB2LnkgKTsKCQl0aGlzLnogPSBNYXRoLm1heCggdGhpcy56LCB2LnogKTsKCQl0aGlzLncgPSBNYXRoLm1heCggdGhpcy53LCB2LncgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNsYW1wKCBtaW4sIG1heCApIHsKCgkJLy8gYXNzdW1lcyBtaW4gPCBtYXgsIGNvbXBvbmVudHdpc2UKCgkJdGhpcy54ID0gTWF0aC5tYXgoIG1pbi54LCBNYXRoLm1pbiggbWF4LngsIHRoaXMueCApICk7CgkJdGhpcy55ID0gTWF0aC5tYXgoIG1pbi55LCBNYXRoLm1pbiggbWF4LnksIHRoaXMueSApICk7CgkJdGhpcy56ID0gTWF0aC5tYXgoIG1pbi56LCBNYXRoLm1pbiggbWF4LnosIHRoaXMueiApICk7CgkJdGhpcy53ID0gTWF0aC5tYXgoIG1pbi53LCBNYXRoLm1pbiggbWF4LncsIHRoaXMudyApICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljbGFtcFNjYWxhciggbWluVmFsLCBtYXhWYWwgKSB7CgoJCXRoaXMueCA9IE1hdGgubWF4KCBtaW5WYWwsIE1hdGgubWluKCBtYXhWYWwsIHRoaXMueCApICk7CgkJdGhpcy55ID0gTWF0aC5tYXgoIG1pblZhbCwgTWF0aC5taW4oIG1heFZhbCwgdGhpcy55ICkgKTsKCQl0aGlzLnogPSBNYXRoLm1heCggbWluVmFsLCBNYXRoLm1pbiggbWF4VmFsLCB0aGlzLnogKSApOwoJCXRoaXMudyA9IE1hdGgubWF4KCBtaW5WYWwsIE1hdGgubWluKCBtYXhWYWwsIHRoaXMudyApICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljbGFtcExlbmd0aCggbWluLCBtYXggKSB7CgoJCWNvbnN0IGxlbmd0aCA9IHRoaXMubGVuZ3RoKCk7CgoJCXJldHVybiB0aGlzLmRpdmlkZVNjYWxhciggbGVuZ3RoIHx8IDEgKS5tdWx0aXBseVNjYWxhciggTWF0aC5tYXgoIG1pbiwgTWF0aC5taW4oIG1heCwgbGVuZ3RoICkgKSApOwoKCX0KCglmbG9vcigpIHsKCgkJdGhpcy54ID0gTWF0aC5mbG9vciggdGhpcy54ICk7CgkJdGhpcy55ID0gTWF0aC5mbG9vciggdGhpcy55ICk7CgkJdGhpcy56ID0gTWF0aC5mbG9vciggdGhpcy56ICk7CgkJdGhpcy53ID0gTWF0aC5mbG9vciggdGhpcy53ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljZWlsKCkgewoKCQl0aGlzLnggPSBNYXRoLmNlaWwoIHRoaXMueCApOwoJCXRoaXMueSA9IE1hdGguY2VpbCggdGhpcy55ICk7CgkJdGhpcy56ID0gTWF0aC5jZWlsKCB0aGlzLnogKTsKCQl0aGlzLncgPSBNYXRoLmNlaWwoIHRoaXMudyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJcm91bmQoKSB7CgoJCXRoaXMueCA9IE1hdGgucm91bmQoIHRoaXMueCApOwoJCXRoaXMueSA9IE1hdGgucm91bmQoIHRoaXMueSApOwoJCXRoaXMueiA9IE1hdGgucm91bmQoIHRoaXMueiApOwoJCXRoaXMudyA9IE1hdGgucm91bmQoIHRoaXMudyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJcm91bmRUb1plcm8oKSB7CgoJCXRoaXMueCA9IE1hdGgudHJ1bmMoIHRoaXMueCApOwoJCXRoaXMueSA9IE1hdGgudHJ1bmMoIHRoaXMueSApOwoJCXRoaXMueiA9IE1hdGgudHJ1bmMoIHRoaXMueiApOwoJCXRoaXMudyA9IE1hdGgudHJ1bmMoIHRoaXMudyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbmVnYXRlKCkgewoKCQl0aGlzLnggPSAtIHRoaXMueDsKCQl0aGlzLnkgPSAtIHRoaXMueTsKCQl0aGlzLnogPSAtIHRoaXMuejsKCQl0aGlzLncgPSAtIHRoaXMudzsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWRvdCggdiApIHsKCgkJcmV0dXJuIHRoaXMueCAqIHYueCArIHRoaXMueSAqIHYueSArIHRoaXMueiAqIHYueiArIHRoaXMudyAqIHYudzsKCgl9CgoJbGVuZ3RoU3EoKSB7CgoJCXJldHVybiB0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLnogKyB0aGlzLncgKiB0aGlzLnc7CgoJfQoKCWxlbmd0aCgpIHsKCgkJcmV0dXJuIE1hdGguc3FydCggdGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICsgdGhpcy53ICogdGhpcy53ICk7CgoJfQoKCW1hbmhhdHRhbkxlbmd0aCgpIHsKCgkJcmV0dXJuIE1hdGguYWJzKCB0aGlzLnggKSArIE1hdGguYWJzKCB0aGlzLnkgKSArIE1hdGguYWJzKCB0aGlzLnogKSArIE1hdGguYWJzKCB0aGlzLncgKTsKCgl9CgoJbm9ybWFsaXplKCkgewoKCQlyZXR1cm4gdGhpcy5kaXZpZGVTY2FsYXIoIHRoaXMubGVuZ3RoKCkgfHwgMSApOwoKCX0KCglzZXRMZW5ndGgoIGxlbmd0aCApIHsKCgkJcmV0dXJuIHRoaXMubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIoIGxlbmd0aCApOwoKCX0KCglsZXJwKCB2LCBhbHBoYSApIHsKCgkJdGhpcy54ICs9ICggdi54IC0gdGhpcy54ICkgKiBhbHBoYTsKCQl0aGlzLnkgKz0gKCB2LnkgLSB0aGlzLnkgKSAqIGFscGhhOwoJCXRoaXMueiArPSAoIHYueiAtIHRoaXMueiApICogYWxwaGE7CgkJdGhpcy53ICs9ICggdi53IC0gdGhpcy53ICkgKiBhbHBoYTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWxlcnBWZWN0b3JzKCB2MSwgdjIsIGFscGhhICkgewoKCQl0aGlzLnggPSB2MS54ICsgKCB2Mi54IC0gdjEueCApICogYWxwaGE7CgkJdGhpcy55ID0gdjEueSArICggdjIueSAtIHYxLnkgKSAqIGFscGhhOwoJCXRoaXMueiA9IHYxLnogKyAoIHYyLnogLSB2MS56ICkgKiBhbHBoYTsKCQl0aGlzLncgPSB2MS53ICsgKCB2Mi53IC0gdjEudyApICogYWxwaGE7CgoJCXJldHVybiB0aGlzOwoKCX0KCgllcXVhbHMoIHYgKSB7CgoJCXJldHVybiAoICggdi54ID09PSB0aGlzLnggKSAmJiAoIHYueSA9PT0gdGhpcy55ICkgJiYgKCB2LnogPT09IHRoaXMueiApICYmICggdi53ID09PSB0aGlzLncgKSApOwoKCX0KCglmcm9tQXJyYXkoIGFycmF5LCBvZmZzZXQgPSAwICkgewoKCQl0aGlzLnggPSBhcnJheVsgb2Zmc2V0IF07CgkJdGhpcy55ID0gYXJyYXlbIG9mZnNldCArIDEgXTsKCQl0aGlzLnogPSBhcnJheVsgb2Zmc2V0ICsgMiBdOwoJCXRoaXMudyA9IGFycmF5WyBvZmZzZXQgKyAzIF07CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0FycmF5KCBhcnJheSA9IFtdLCBvZmZzZXQgPSAwICkgewoKCQlhcnJheVsgb2Zmc2V0IF0gPSB0aGlzLng7CgkJYXJyYXlbIG9mZnNldCArIDEgXSA9IHRoaXMueTsKCQlhcnJheVsgb2Zmc2V0ICsgMiBdID0gdGhpcy56OwoJCWFycmF5WyBvZmZzZXQgKyAzIF0gPSB0aGlzLnc7CgoJCXJldHVybiBhcnJheTsKCgl9CgoJZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpbmRleCApIHsKCgkJdGhpcy54ID0gYXR0cmlidXRlLmdldFgoIGluZGV4ICk7CgkJdGhpcy55ID0gYXR0cmlidXRlLmdldFkoIGluZGV4ICk7CgkJdGhpcy56ID0gYXR0cmlidXRlLmdldFooIGluZGV4ICk7CgkJdGhpcy53ID0gYXR0cmlidXRlLmdldFcoIGluZGV4ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglyYW5kb20oKSB7CgoJCXRoaXMueCA9IE1hdGgucmFuZG9tKCk7CgkJdGhpcy55ID0gTWF0aC5yYW5kb20oKTsKCQl0aGlzLnogPSBNYXRoLnJhbmRvbSgpOwoJCXRoaXMudyA9IE1hdGgucmFuZG9tKCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgkqWyBTeW1ib2wuaXRlcmF0b3IgXSgpIHsKCgkJeWllbGQgdGhpcy54OwoJCXlpZWxkIHRoaXMueTsKCQl5aWVsZCB0aGlzLno7CgkJeWllbGQgdGhpcy53OwoKCX0KCn0KCi8qCiBJbiBvcHRpb25zLCB3ZSBjYW4gc3BlY2lmeToKICogVGV4dHVyZSBwYXJhbWV0ZXJzIGZvciBhbiBhdXRvLWdlbmVyYXRlZCB0YXJnZXQgdGV4dHVyZQogKiBkZXB0aEJ1ZmZlci9zdGVuY2lsQnVmZmVyOiBCb29sZWFucyB0byBpbmRpY2F0ZSBpZiB3ZSBzaG91bGQgZ2VuZXJhdGUgdGhlc2UgYnVmZmVycwoqLwpjbGFzcyBSZW5kZXJUYXJnZXQgZXh0ZW5kcyBFdmVudERpc3BhdGNoZXIgewoKCWNvbnN0cnVjdG9yKCB3aWR0aCA9IDEsIGhlaWdodCA9IDEsIG9wdGlvbnMgPSB7fSApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc1JlbmRlclRhcmdldCA9IHRydWU7CgoJCXRoaXMud2lkdGggPSB3aWR0aDsKCQl0aGlzLmhlaWdodCA9IGhlaWdodDsKCQl0aGlzLmRlcHRoID0gMTsKCgkJdGhpcy5zY2lzc29yID0gbmV3IFZlY3RvcjQoIDAsIDAsIHdpZHRoLCBoZWlnaHQgKTsKCQl0aGlzLnNjaXNzb3JUZXN0ID0gZmFsc2U7CgoJCXRoaXMudmlld3BvcnQgPSBuZXcgVmVjdG9yNCggMCwgMCwgd2lkdGgsIGhlaWdodCApOwoKCQljb25zdCBpbWFnZSA9IHsgd2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodCwgZGVwdGg6IDEgfTsKCgkJaWYgKCBvcHRpb25zLmVuY29kaW5nICE9PSB1bmRlZmluZWQgKSB7CgoJCQkvLyBAZGVwcmVjYXRlZCwgcjE1MgoJCQl3YXJuT25jZSggJ1RIUkVFLldlYkdMUmVuZGVyVGFyZ2V0OiBvcHRpb24uZW5jb2RpbmcgaGFzIGJlZW4gcmVwbGFjZWQgYnkgb3B0aW9uLmNvbG9yU3BhY2UuJyApOwoJCQlvcHRpb25zLmNvbG9yU3BhY2UgPSBvcHRpb25zLmVuY29kaW5nID09PSBzUkdCRW5jb2RpbmcgPyBTUkdCQ29sb3JTcGFjZSA6IE5vQ29sb3JTcGFjZTsKCgkJfQoKCQlvcHRpb25zID0gT2JqZWN0LmFzc2lnbiggewoJCQlnZW5lcmF0ZU1pcG1hcHM6IGZhbHNlLAoJCQlpbnRlcm5hbEZvcm1hdDogbnVsbCwKCQkJbWluRmlsdGVyOiBMaW5lYXJGaWx0ZXIsCgkJCWRlcHRoQnVmZmVyOiB0cnVlLAoJCQlzdGVuY2lsQnVmZmVyOiBmYWxzZSwKCQkJZGVwdGhUZXh0dXJlOiBudWxsLAoJCQlzYW1wbGVzOiAwCgkJfSwgb3B0aW9ucyApOwoKCQl0aGlzLnRleHR1cmUgPSBuZXcgVGV4dHVyZSggaW1hZ2UsIG9wdGlvbnMubWFwcGluZywgb3B0aW9ucy53cmFwUywgb3B0aW9ucy53cmFwVCwgb3B0aW9ucy5tYWdGaWx0ZXIsIG9wdGlvbnMubWluRmlsdGVyLCBvcHRpb25zLmZvcm1hdCwgb3B0aW9ucy50eXBlLCBvcHRpb25zLmFuaXNvdHJvcHksIG9wdGlvbnMuY29sb3JTcGFjZSApOwoJCXRoaXMudGV4dHVyZS5pc1JlbmRlclRhcmdldFRleHR1cmUgPSB0cnVlOwoKCQl0aGlzLnRleHR1cmUuZmxpcFkgPSBmYWxzZTsKCQl0aGlzLnRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gb3B0aW9ucy5nZW5lcmF0ZU1pcG1hcHM7CgkJdGhpcy50ZXh0dXJlLmludGVybmFsRm9ybWF0ID0gb3B0aW9ucy5pbnRlcm5hbEZvcm1hdDsKCgkJdGhpcy5kZXB0aEJ1ZmZlciA9IG9wdGlvbnMuZGVwdGhCdWZmZXI7CgkJdGhpcy5zdGVuY2lsQnVmZmVyID0gb3B0aW9ucy5zdGVuY2lsQnVmZmVyOwoKCQl0aGlzLmRlcHRoVGV4dHVyZSA9IG9wdGlvbnMuZGVwdGhUZXh0dXJlOwoKCQl0aGlzLnNhbXBsZXMgPSBvcHRpb25zLnNhbXBsZXM7CgoJfQoKCXNldFNpemUoIHdpZHRoLCBoZWlnaHQsIGRlcHRoID0gMSApIHsKCgkJaWYgKCB0aGlzLndpZHRoICE9PSB3aWR0aCB8fCB0aGlzLmhlaWdodCAhPT0gaGVpZ2h0IHx8IHRoaXMuZGVwdGggIT09IGRlcHRoICkgewoKCQkJdGhpcy53aWR0aCA9IHdpZHRoOwoJCQl0aGlzLmhlaWdodCA9IGhlaWdodDsKCQkJdGhpcy5kZXB0aCA9IGRlcHRoOwoKCQkJdGhpcy50ZXh0dXJlLmltYWdlLndpZHRoID0gd2lkdGg7CgkJCXRoaXMudGV4dHVyZS5pbWFnZS5oZWlnaHQgPSBoZWlnaHQ7CgkJCXRoaXMudGV4dHVyZS5pbWFnZS5kZXB0aCA9IGRlcHRoOwoKCQkJdGhpcy5kaXNwb3NlKCk7CgoJCX0KCgkJdGhpcy52aWV3cG9ydC5zZXQoIDAsIDAsIHdpZHRoLCBoZWlnaHQgKTsKCQl0aGlzLnNjaXNzb3Iuc2V0KCAwLCAwLCB3aWR0aCwgaGVpZ2h0ICk7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJdGhpcy53aWR0aCA9IHNvdXJjZS53aWR0aDsKCQl0aGlzLmhlaWdodCA9IHNvdXJjZS5oZWlnaHQ7CgkJdGhpcy5kZXB0aCA9IHNvdXJjZS5kZXB0aDsKCgkJdGhpcy5zY2lzc29yLmNvcHkoIHNvdXJjZS5zY2lzc29yICk7CgkJdGhpcy5zY2lzc29yVGVzdCA9IHNvdXJjZS5zY2lzc29yVGVzdDsKCgkJdGhpcy52aWV3cG9ydC5jb3B5KCBzb3VyY2Uudmlld3BvcnQgKTsKCgkJdGhpcy50ZXh0dXJlID0gc291cmNlLnRleHR1cmUuY2xvbmUoKTsKCQl0aGlzLnRleHR1cmUuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID0gdHJ1ZTsKCgkJLy8gZW5zdXJlIGltYWdlIG9iamVjdCBpcyBub3Qgc2hhcmVkLCBzZWUgIzIwMzI4CgoJCWNvbnN0IGltYWdlID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS50ZXh0dXJlLmltYWdlICk7CgkJdGhpcy50ZXh0dXJlLnNvdXJjZSA9IG5ldyBTb3VyY2UoIGltYWdlICk7CgoJCXRoaXMuZGVwdGhCdWZmZXIgPSBzb3VyY2UuZGVwdGhCdWZmZXI7CgkJdGhpcy5zdGVuY2lsQnVmZmVyID0gc291cmNlLnN0ZW5jaWxCdWZmZXI7CgoJCWlmICggc291cmNlLmRlcHRoVGV4dHVyZSAhPT0gbnVsbCApIHRoaXMuZGVwdGhUZXh0dXJlID0gc291cmNlLmRlcHRoVGV4dHVyZS5jbG9uZSgpOwoKCQl0aGlzLnNhbXBsZXMgPSBzb3VyY2Uuc2FtcGxlczsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWRpc3Bvc2UoKSB7CgoJCXRoaXMuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnZGlzcG9zZScgfSApOwoKCX0KCn0KCmNsYXNzIFdlYkdMUmVuZGVyVGFyZ2V0IGV4dGVuZHMgUmVuZGVyVGFyZ2V0IHsKCgljb25zdHJ1Y3Rvciggd2lkdGggPSAxLCBoZWlnaHQgPSAxLCBvcHRpb25zID0ge30gKSB7CgoJCXN1cGVyKCB3aWR0aCwgaGVpZ2h0LCBvcHRpb25zICk7CgoJCXRoaXMuaXNXZWJHTFJlbmRlclRhcmdldCA9IHRydWU7CgoJfQoKfQoKY2xhc3MgRGF0YUFycmF5VGV4dHVyZSBleHRlbmRzIFRleHR1cmUgewoKCWNvbnN0cnVjdG9yKCBkYXRhID0gbnVsbCwgd2lkdGggPSAxLCBoZWlnaHQgPSAxLCBkZXB0aCA9IDEgKSB7CgoJCXN1cGVyKCBudWxsICk7CgoJCXRoaXMuaXNEYXRhQXJyYXlUZXh0dXJlID0gdHJ1ZTsKCgkJdGhpcy5pbWFnZSA9IHsgZGF0YSwgd2lkdGgsIGhlaWdodCwgZGVwdGggfTsKCgkJdGhpcy5tYWdGaWx0ZXIgPSBOZWFyZXN0RmlsdGVyOwoJCXRoaXMubWluRmlsdGVyID0gTmVhcmVzdEZpbHRlcjsKCgkJdGhpcy53cmFwUiA9IENsYW1wVG9FZGdlV3JhcHBpbmc7CgoJCXRoaXMuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgkJdGhpcy5mbGlwWSA9IGZhbHNlOwoJCXRoaXMudW5wYWNrQWxpZ25tZW50ID0gMTsKCgl9Cgp9CgpjbGFzcyBXZWJHTEFycmF5UmVuZGVyVGFyZ2V0IGV4dGVuZHMgV2ViR0xSZW5kZXJUYXJnZXQgewoKCWNvbnN0cnVjdG9yKCB3aWR0aCA9IDEsIGhlaWdodCA9IDEsIGRlcHRoID0gMSApIHsKCgkJc3VwZXIoIHdpZHRoLCBoZWlnaHQgKTsKCgkJdGhpcy5pc1dlYkdMQXJyYXlSZW5kZXJUYXJnZXQgPSB0cnVlOwoKCQl0aGlzLmRlcHRoID0gZGVwdGg7CgoJCXRoaXMudGV4dHVyZSA9IG5ldyBEYXRhQXJyYXlUZXh0dXJlKCBudWxsLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCApOwoKCQl0aGlzLnRleHR1cmUuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID0gdHJ1ZTsKCgl9Cgp9CgpjbGFzcyBEYXRhM0RUZXh0dXJlIGV4dGVuZHMgVGV4dHVyZSB7CgoJY29uc3RydWN0b3IoIGRhdGEgPSBudWxsLCB3aWR0aCA9IDEsIGhlaWdodCA9IDEsIGRlcHRoID0gMSApIHsKCgkJLy8gV2UncmUgZ29pbmcgdG8gYWRkIC5zZXRYWFgoKSBtZXRob2RzIGZvciBzZXR0aW5nIHByb3BlcnRpZXMgbGF0ZXIuCgkJLy8gVXNlcnMgY2FuIHN0aWxsIHNldCBpbiBEYXRhVGV4dHVyZTNEIGRpcmVjdGx5LgoJCS8vCgkJLy8JY29uc3QgdGV4dHVyZSA9IG5ldyBUSFJFRS5EYXRhVGV4dHVyZTNEKCBkYXRhLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCApOwoJCS8vIAl0ZXh0dXJlLmFuaXNvdHJvcHkgPSAxNjsKCQkvLwoJCS8vIFNlZSAjMTQ4MzkKCgkJc3VwZXIoIG51bGwgKTsKCgkJdGhpcy5pc0RhdGEzRFRleHR1cmUgPSB0cnVlOwoKCQl0aGlzLmltYWdlID0geyBkYXRhLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCB9OwoKCQl0aGlzLm1hZ0ZpbHRlciA9IE5lYXJlc3RGaWx0ZXI7CgkJdGhpcy5taW5GaWx0ZXIgPSBOZWFyZXN0RmlsdGVyOwoKCQl0aGlzLndyYXBSID0gQ2xhbXBUb0VkZ2VXcmFwcGluZzsKCgkJdGhpcy5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKCQl0aGlzLmZsaXBZID0gZmFsc2U7CgkJdGhpcy51bnBhY2tBbGlnbm1lbnQgPSAxOwoKCX0KCn0KCmNsYXNzIFdlYkdMM0RSZW5kZXJUYXJnZXQgZXh0ZW5kcyBXZWJHTFJlbmRlclRhcmdldCB7CgoJY29uc3RydWN0b3IoIHdpZHRoID0gMSwgaGVpZ2h0ID0gMSwgZGVwdGggPSAxICkgewoKCQlzdXBlciggd2lkdGgsIGhlaWdodCApOwoKCQl0aGlzLmlzV2ViR0wzRFJlbmRlclRhcmdldCA9IHRydWU7CgoJCXRoaXMuZGVwdGggPSBkZXB0aDsKCgkJdGhpcy50ZXh0dXJlID0gbmV3IERhdGEzRFRleHR1cmUoIG51bGwsIHdpZHRoLCBoZWlnaHQsIGRlcHRoICk7CgoJCXRoaXMudGV4dHVyZS5pc1JlbmRlclRhcmdldFRleHR1cmUgPSB0cnVlOwoKCX0KCn0KCmNsYXNzIFdlYkdMTXVsdGlwbGVSZW5kZXJUYXJnZXRzIGV4dGVuZHMgV2ViR0xSZW5kZXJUYXJnZXQgewoKCWNvbnN0cnVjdG9yKCB3aWR0aCA9IDEsIGhlaWdodCA9IDEsIGNvdW50ID0gMSwgb3B0aW9ucyA9IHt9ICkgewoKCQlzdXBlciggd2lkdGgsIGhlaWdodCwgb3B0aW9ucyApOwoKCQl0aGlzLmlzV2ViR0xNdWx0aXBsZVJlbmRlclRhcmdldHMgPSB0cnVlOwoKCQljb25zdCB0ZXh0dXJlID0gdGhpcy50ZXh0dXJlOwoKCQl0aGlzLnRleHR1cmUgPSBbXTsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgY291bnQ7IGkgKysgKSB7CgoJCQl0aGlzLnRleHR1cmVbIGkgXSA9IHRleHR1cmUuY2xvbmUoKTsKCQkJdGhpcy50ZXh0dXJlWyBpIF0uaXNSZW5kZXJUYXJnZXRUZXh0dXJlID0gdHJ1ZTsKCgkJfQoKCX0KCglzZXRTaXplKCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCA9IDEgKSB7CgoJCWlmICggdGhpcy53aWR0aCAhPT0gd2lkdGggfHwgdGhpcy5oZWlnaHQgIT09IGhlaWdodCB8fCB0aGlzLmRlcHRoICE9PSBkZXB0aCApIHsKCgkJCXRoaXMud2lkdGggPSB3aWR0aDsKCQkJdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CgkJCXRoaXMuZGVwdGggPSBkZXB0aDsKCgkJCWZvciAoIGxldCBpID0gMCwgaWwgPSB0aGlzLnRleHR1cmUubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJdGhpcy50ZXh0dXJlWyBpIF0uaW1hZ2Uud2lkdGggPSB3aWR0aDsKCQkJCXRoaXMudGV4dHVyZVsgaSBdLmltYWdlLmhlaWdodCA9IGhlaWdodDsKCQkJCXRoaXMudGV4dHVyZVsgaSBdLmltYWdlLmRlcHRoID0gZGVwdGg7CgoJCQl9CgoJCQl0aGlzLmRpc3Bvc2UoKTsKCgkJfQoKCQl0aGlzLnZpZXdwb3J0LnNldCggMCwgMCwgd2lkdGgsIGhlaWdodCApOwoJCXRoaXMuc2Npc3Nvci5zZXQoIDAsIDAsIHdpZHRoLCBoZWlnaHQgKTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQl0aGlzLmRpc3Bvc2UoKTsKCgkJdGhpcy53aWR0aCA9IHNvdXJjZS53aWR0aDsKCQl0aGlzLmhlaWdodCA9IHNvdXJjZS5oZWlnaHQ7CgkJdGhpcy5kZXB0aCA9IHNvdXJjZS5kZXB0aDsKCgkJdGhpcy5zY2lzc29yLmNvcHkoIHNvdXJjZS5zY2lzc29yICk7CgkJdGhpcy5zY2lzc29yVGVzdCA9IHNvdXJjZS5zY2lzc29yVGVzdDsKCgkJdGhpcy52aWV3cG9ydC5jb3B5KCBzb3VyY2Uudmlld3BvcnQgKTsKCgkJdGhpcy5kZXB0aEJ1ZmZlciA9IHNvdXJjZS5kZXB0aEJ1ZmZlcjsKCQl0aGlzLnN0ZW5jaWxCdWZmZXIgPSBzb3VyY2Uuc3RlbmNpbEJ1ZmZlcjsKCgkJaWYgKCBzb3VyY2UuZGVwdGhUZXh0dXJlICE9PSBudWxsICkgdGhpcy5kZXB0aFRleHR1cmUgPSBzb3VyY2UuZGVwdGhUZXh0dXJlLmNsb25lKCk7CgoJCXRoaXMudGV4dHVyZS5sZW5ndGggPSAwOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gc291cmNlLnRleHR1cmUubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQl0aGlzLnRleHR1cmVbIGkgXSA9IHNvdXJjZS50ZXh0dXJlWyBpIF0uY2xvbmUoKTsKCQkJdGhpcy50ZXh0dXJlWyBpIF0uaXNSZW5kZXJUYXJnZXRUZXh0dXJlID0gdHJ1ZTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpjbGFzcyBRdWF0ZXJuaW9uIHsKCgljb25zdHJ1Y3RvciggeCA9IDAsIHkgPSAwLCB6ID0gMCwgdyA9IDEgKSB7CgoJCXRoaXMuaXNRdWF0ZXJuaW9uID0gdHJ1ZTsKCgkJdGhpcy5feCA9IHg7CgkJdGhpcy5feSA9IHk7CgkJdGhpcy5feiA9IHo7CgkJdGhpcy5fdyA9IHc7CgoJfQoKCXN0YXRpYyBzbGVycEZsYXQoIGRzdCwgZHN0T2Zmc2V0LCBzcmMwLCBzcmNPZmZzZXQwLCBzcmMxLCBzcmNPZmZzZXQxLCB0ICkgewoKCQkvLyBmdXp6LWZyZWUsIGFycmF5LWJhc2VkIFF1YXRlcm5pb24gU0xFUlAgb3BlcmF0aW9uCgoJCWxldCB4MCA9IHNyYzBbIHNyY09mZnNldDAgKyAwIF0sCgkJCXkwID0gc3JjMFsgc3JjT2Zmc2V0MCArIDEgXSwKCQkJejAgPSBzcmMwWyBzcmNPZmZzZXQwICsgMiBdLAoJCQl3MCA9IHNyYzBbIHNyY09mZnNldDAgKyAzIF07CgoJCWNvbnN0IHgxID0gc3JjMVsgc3JjT2Zmc2V0MSArIDAgXSwKCQkJeTEgPSBzcmMxWyBzcmNPZmZzZXQxICsgMSBdLAoJCQl6MSA9IHNyYzFbIHNyY09mZnNldDEgKyAyIF0sCgkJCXcxID0gc3JjMVsgc3JjT2Zmc2V0MSArIDMgXTsKCgkJaWYgKCB0ID09PSAwICkgewoKCQkJZHN0WyBkc3RPZmZzZXQgKyAwIF0gPSB4MDsKCQkJZHN0WyBkc3RPZmZzZXQgKyAxIF0gPSB5MDsKCQkJZHN0WyBkc3RPZmZzZXQgKyAyIF0gPSB6MDsKCQkJZHN0WyBkc3RPZmZzZXQgKyAzIF0gPSB3MDsKCQkJcmV0dXJuOwoKCQl9CgoJCWlmICggdCA9PT0gMSApIHsKCgkJCWRzdFsgZHN0T2Zmc2V0ICsgMCBdID0geDE7CgkJCWRzdFsgZHN0T2Zmc2V0ICsgMSBdID0geTE7CgkJCWRzdFsgZHN0T2Zmc2V0ICsgMiBdID0gejE7CgkJCWRzdFsgZHN0T2Zmc2V0ICsgMyBdID0gdzE7CgkJCXJldHVybjsKCgkJfQoKCQlpZiAoIHcwICE9PSB3MSB8fCB4MCAhPT0geDEgfHwgeTAgIT09IHkxIHx8IHowICE9PSB6MSApIHsKCgkJCWxldCBzID0gMSAtIHQ7CgkJCWNvbnN0IGNvcyA9IHgwICogeDEgKyB5MCAqIHkxICsgejAgKiB6MSArIHcwICogdzEsCgkJCQlkaXIgPSAoIGNvcyA+PSAwID8gMSA6IC0gMSApLAoJCQkJc3FyU2luID0gMSAtIGNvcyAqIGNvczsKCgkJCS8vIFNraXAgdGhlIFNsZXJwIGZvciB0aW55IHN0ZXBzIHRvIGF2b2lkIG51bWVyaWMgcHJvYmxlbXM6CgkJCWlmICggc3FyU2luID4gTnVtYmVyLkVQU0lMT04gKSB7CgoJCQkJY29uc3Qgc2luID0gTWF0aC5zcXJ0KCBzcXJTaW4gKSwKCQkJCQlsZW4gPSBNYXRoLmF0YW4yKCBzaW4sIGNvcyAqIGRpciApOwoKCQkJCXMgPSBNYXRoLnNpbiggcyAqIGxlbiApIC8gc2luOwoJCQkJdCA9IE1hdGguc2luKCB0ICogbGVuICkgLyBzaW47CgoJCQl9CgoJCQljb25zdCB0RGlyID0gdCAqIGRpcjsKCgkJCXgwID0geDAgKiBzICsgeDEgKiB0RGlyOwoJCQl5MCA9IHkwICogcyArIHkxICogdERpcjsKCQkJejAgPSB6MCAqIHMgKyB6MSAqIHREaXI7CgkJCXcwID0gdzAgKiBzICsgdzEgKiB0RGlyOwoKCQkJLy8gTm9ybWFsaXplIGluIGNhc2Ugd2UganVzdCBkaWQgYSBsZXJwOgoJCQlpZiAoIHMgPT09IDEgLSB0ICkgewoKCQkJCWNvbnN0IGYgPSAxIC8gTWF0aC5zcXJ0KCB4MCAqIHgwICsgeTAgKiB5MCArIHowICogejAgKyB3MCAqIHcwICk7CgoJCQkJeDAgKj0gZjsKCQkJCXkwICo9IGY7CgkJCQl6MCAqPSBmOwoJCQkJdzAgKj0gZjsKCgkJCX0KCgkJfQoKCQlkc3RbIGRzdE9mZnNldCBdID0geDA7CgkJZHN0WyBkc3RPZmZzZXQgKyAxIF0gPSB5MDsKCQlkc3RbIGRzdE9mZnNldCArIDIgXSA9IHowOwoJCWRzdFsgZHN0T2Zmc2V0ICsgMyBdID0gdzA7CgoJfQoKCXN0YXRpYyBtdWx0aXBseVF1YXRlcm5pb25zRmxhdCggZHN0LCBkc3RPZmZzZXQsIHNyYzAsIHNyY09mZnNldDAsIHNyYzEsIHNyY09mZnNldDEgKSB7CgoJCWNvbnN0IHgwID0gc3JjMFsgc3JjT2Zmc2V0MCBdOwoJCWNvbnN0IHkwID0gc3JjMFsgc3JjT2Zmc2V0MCArIDEgXTsKCQljb25zdCB6MCA9IHNyYzBbIHNyY09mZnNldDAgKyAyIF07CgkJY29uc3QgdzAgPSBzcmMwWyBzcmNPZmZzZXQwICsgMyBdOwoKCQljb25zdCB4MSA9IHNyYzFbIHNyY09mZnNldDEgXTsKCQljb25zdCB5MSA9IHNyYzFbIHNyY09mZnNldDEgKyAxIF07CgkJY29uc3QgejEgPSBzcmMxWyBzcmNPZmZzZXQxICsgMiBdOwoJCWNvbnN0IHcxID0gc3JjMVsgc3JjT2Zmc2V0MSArIDMgXTsKCgkJZHN0WyBkc3RPZmZzZXQgXSA9IHgwICogdzEgKyB3MCAqIHgxICsgeTAgKiB6MSAtIHowICogeTE7CgkJZHN0WyBkc3RPZmZzZXQgKyAxIF0gPSB5MCAqIHcxICsgdzAgKiB5MSArIHowICogeDEgLSB4MCAqIHoxOwoJCWRzdFsgZHN0T2Zmc2V0ICsgMiBdID0gejAgKiB3MSArIHcwICogejEgKyB4MCAqIHkxIC0geTAgKiB4MTsKCQlkc3RbIGRzdE9mZnNldCArIDMgXSA9IHcwICogdzEgLSB4MCAqIHgxIC0geTAgKiB5MSAtIHowICogejE7CgoJCXJldHVybiBkc3Q7CgoJfQoKCWdldCB4KCkgewoKCQlyZXR1cm4gdGhpcy5feDsKCgl9CgoJc2V0IHgoIHZhbHVlICkgewoKCQl0aGlzLl94ID0gdmFsdWU7CgkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCX0KCglnZXQgeSgpIHsKCgkJcmV0dXJuIHRoaXMuX3k7CgoJfQoKCXNldCB5KCB2YWx1ZSApIHsKCgkJdGhpcy5feSA9IHZhbHVlOwoJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCgl9CgoJZ2V0IHooKSB7CgoJCXJldHVybiB0aGlzLl96OwoKCX0KCglzZXQgeiggdmFsdWUgKSB7CgoJCXRoaXMuX3ogPSB2YWx1ZTsKCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJfQoKCWdldCB3KCkgewoKCQlyZXR1cm4gdGhpcy5fdzsKCgl9CgoJc2V0IHcoIHZhbHVlICkgewoKCQl0aGlzLl93ID0gdmFsdWU7CgkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCX0KCglzZXQoIHgsIHksIHosIHcgKSB7CgoJCXRoaXMuX3ggPSB4OwoJCXRoaXMuX3kgPSB5OwoJCXRoaXMuX3ogPSB6OwoJCXRoaXMuX3cgPSB3OwoKCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljbG9uZSgpIHsKCgkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCB0aGlzLl94LCB0aGlzLl95LCB0aGlzLl96LCB0aGlzLl93ICk7CgoJfQoKCWNvcHkoIHF1YXRlcm5pb24gKSB7CgoJCXRoaXMuX3ggPSBxdWF0ZXJuaW9uLng7CgkJdGhpcy5feSA9IHF1YXRlcm5pb24ueTsKCQl0aGlzLl96ID0gcXVhdGVybmlvbi56OwoJCXRoaXMuX3cgPSBxdWF0ZXJuaW9uLnc7CgoJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldEZyb21FdWxlciggZXVsZXIsIHVwZGF0ZSApIHsKCgkJY29uc3QgeCA9IGV1bGVyLl94LCB5ID0gZXVsZXIuX3ksIHogPSBldWxlci5feiwgb3JkZXIgPSBldWxlci5fb3JkZXI7CgoJCS8vIGh0dHA6Ly93d3cubWF0aHdvcmtzLmNvbS9tYXRsYWJjZW50cmFsL2ZpbGVleGNoYW5nZS8KCQkvLyAJMjA2OTYtZnVuY3Rpb24tdG8tY29udmVydC1iZXR3ZWVuLWRjbS1ldWxlci1hbmdsZXMtcXVhdGVybmlvbnMtYW5kLWV1bGVyLXZlY3RvcnMvCgkJLy8JY29udGVudC9TcGluQ2FsYy5tCgoJCWNvbnN0IGNvcyA9IE1hdGguY29zOwoJCWNvbnN0IHNpbiA9IE1hdGguc2luOwoKCQljb25zdCBjMSA9IGNvcyggeCAvIDIgKTsKCQljb25zdCBjMiA9IGNvcyggeSAvIDIgKTsKCQljb25zdCBjMyA9IGNvcyggeiAvIDIgKTsKCgkJY29uc3QgczEgPSBzaW4oIHggLyAyICk7CgkJY29uc3QgczIgPSBzaW4oIHkgLyAyICk7CgkJY29uc3QgczMgPSBzaW4oIHogLyAyICk7CgoJCXN3aXRjaCAoIG9yZGVyICkgewoKCQkJY2FzZSAnWFlaJzoKCQkJCXRoaXMuX3ggPSBzMSAqIGMyICogYzMgKyBjMSAqIHMyICogczM7CgkJCQl0aGlzLl95ID0gYzEgKiBzMiAqIGMzIC0gczEgKiBjMiAqIHMzOwoJCQkJdGhpcy5feiA9IGMxICogYzIgKiBzMyArIHMxICogczIgKiBjMzsKCQkJCXRoaXMuX3cgPSBjMSAqIGMyICogYzMgLSBzMSAqIHMyICogczM7CgkJCQlicmVhazsKCgkJCWNhc2UgJ1lYWic6CgkJCQl0aGlzLl94ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwoJCQkJdGhpcy5feSA9IGMxICogczIgKiBjMyAtIHMxICogYzIgKiBzMzsKCQkJCXRoaXMuX3ogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CgkJCQl0aGlzLl93ID0gYzEgKiBjMiAqIGMzICsgczEgKiBzMiAqIHMzOwoJCQkJYnJlYWs7CgoJCQljYXNlICdaWFknOgoJCQkJdGhpcy5feCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKCQkJCXRoaXMuX3kgPSBjMSAqIHMyICogYzMgKyBzMSAqIGMyICogczM7CgkJCQl0aGlzLl96ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwoJCQkJdGhpcy5fdyA9IGMxICogYzIgKiBjMyAtIHMxICogczIgKiBzMzsKCQkJCWJyZWFrOwoKCQkJY2FzZSAnWllYJzoKCQkJCXRoaXMuX3ggPSBzMSAqIGMyICogYzMgLSBjMSAqIHMyICogczM7CgkJCQl0aGlzLl95ID0gYzEgKiBzMiAqIGMzICsgczEgKiBjMiAqIHMzOwoJCQkJdGhpcy5feiA9IGMxICogYzIgKiBzMyAtIHMxICogczIgKiBjMzsKCQkJCXRoaXMuX3cgPSBjMSAqIGMyICogYzMgKyBzMSAqIHMyICogczM7CgkJCQlicmVhazsKCgkJCWNhc2UgJ1laWCc6CgkJCQl0aGlzLl94ID0gczEgKiBjMiAqIGMzICsgYzEgKiBzMiAqIHMzOwoJCQkJdGhpcy5feSA9IGMxICogczIgKiBjMyArIHMxICogYzIgKiBzMzsKCQkJCXRoaXMuX3ogPSBjMSAqIGMyICogczMgLSBzMSAqIHMyICogYzM7CgkJCQl0aGlzLl93ID0gYzEgKiBjMiAqIGMzIC0gczEgKiBzMiAqIHMzOwoJCQkJYnJlYWs7CgoJCQljYXNlICdYWlknOgoJCQkJdGhpcy5feCA9IHMxICogYzIgKiBjMyAtIGMxICogczIgKiBzMzsKCQkJCXRoaXMuX3kgPSBjMSAqIHMyICogYzMgLSBzMSAqIGMyICogczM7CgkJCQl0aGlzLl96ID0gYzEgKiBjMiAqIHMzICsgczEgKiBzMiAqIGMzOwoJCQkJdGhpcy5fdyA9IGMxICogYzIgKiBjMyArIHMxICogczIgKiBzMzsKCQkJCWJyZWFrOwoKCQkJZGVmYXVsdDoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlF1YXRlcm5pb246IC5zZXRGcm9tRXVsZXIoKSBlbmNvdW50ZXJlZCBhbiB1bmtub3duIG9yZGVyOiAnICsgb3JkZXIgKTsKCgkJfQoKCQlpZiAoIHVwZGF0ZSAhPT0gZmFsc2UgKSB0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tQXhpc0FuZ2xlKCBheGlzLCBhbmdsZSApIHsKCgkJLy8gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvZ2VvbWV0cnkvcm90YXRpb25zL2NvbnZlcnNpb25zL2FuZ2xlVG9RdWF0ZXJuaW9uL2luZGV4Lmh0bQoKCQkvLyBhc3N1bWVzIGF4aXMgaXMgbm9ybWFsaXplZAoKCQljb25zdCBoYWxmQW5nbGUgPSBhbmdsZSAvIDIsIHMgPSBNYXRoLnNpbiggaGFsZkFuZ2xlICk7CgoJCXRoaXMuX3ggPSBheGlzLnggKiBzOwoJCXRoaXMuX3kgPSBheGlzLnkgKiBzOwoJCXRoaXMuX3ogPSBheGlzLnogKiBzOwoJCXRoaXMuX3cgPSBNYXRoLmNvcyggaGFsZkFuZ2xlICk7CgoJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldEZyb21Sb3RhdGlvbk1hdHJpeCggbSApIHsKCgkJLy8gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvZ2VvbWV0cnkvcm90YXRpb25zL2NvbnZlcnNpb25zL21hdHJpeFRvUXVhdGVybmlvbi9pbmRleC5odG0KCgkJLy8gYXNzdW1lcyB0aGUgdXBwZXIgM3gzIG9mIG0gaXMgYSBwdXJlIHJvdGF0aW9uIG1hdHJpeCAoaS5lLCB1bnNjYWxlZCkKCgkJY29uc3QgdGUgPSBtLmVsZW1lbnRzLAoKCQkJbTExID0gdGVbIDAgXSwgbTEyID0gdGVbIDQgXSwgbTEzID0gdGVbIDggXSwKCQkJbTIxID0gdGVbIDEgXSwgbTIyID0gdGVbIDUgXSwgbTIzID0gdGVbIDkgXSwKCQkJbTMxID0gdGVbIDIgXSwgbTMyID0gdGVbIDYgXSwgbTMzID0gdGVbIDEwIF0sCgoJCQl0cmFjZSA9IG0xMSArIG0yMiArIG0zMzsKCgkJaWYgKCB0cmFjZSA+IDAgKSB7CgoJCQljb25zdCBzID0gMC41IC8gTWF0aC5zcXJ0KCB0cmFjZSArIDEuMCApOwoKCQkJdGhpcy5fdyA9IDAuMjUgLyBzOwoJCQl0aGlzLl94ID0gKCBtMzIgLSBtMjMgKSAqIHM7CgkJCXRoaXMuX3kgPSAoIG0xMyAtIG0zMSApICogczsKCQkJdGhpcy5feiA9ICggbTIxIC0gbTEyICkgKiBzOwoKCQl9IGVsc2UgaWYgKCBtMTEgPiBtMjIgJiYgbTExID4gbTMzICkgewoKCQkJY29uc3QgcyA9IDIuMCAqIE1hdGguc3FydCggMS4wICsgbTExIC0gbTIyIC0gbTMzICk7CgoJCQl0aGlzLl93ID0gKCBtMzIgLSBtMjMgKSAvIHM7CgkJCXRoaXMuX3ggPSAwLjI1ICogczsKCQkJdGhpcy5feSA9ICggbTEyICsgbTIxICkgLyBzOwoJCQl0aGlzLl96ID0gKCBtMTMgKyBtMzEgKSAvIHM7CgoJCX0gZWxzZSBpZiAoIG0yMiA+IG0zMyApIHsKCgkJCWNvbnN0IHMgPSAyLjAgKiBNYXRoLnNxcnQoIDEuMCArIG0yMiAtIG0xMSAtIG0zMyApOwoKCQkJdGhpcy5fdyA9ICggbTEzIC0gbTMxICkgLyBzOwoJCQl0aGlzLl94ID0gKCBtMTIgKyBtMjEgKSAvIHM7CgkJCXRoaXMuX3kgPSAwLjI1ICogczsKCQkJdGhpcy5feiA9ICggbTIzICsgbTMyICkgLyBzOwoKCQl9IGVsc2UgewoKCQkJY29uc3QgcyA9IDIuMCAqIE1hdGguc3FydCggMS4wICsgbTMzIC0gbTExIC0gbTIyICk7CgoJCQl0aGlzLl93ID0gKCBtMjEgLSBtMTIgKSAvIHM7CgkJCXRoaXMuX3ggPSAoIG0xMyArIG0zMSApIC8gczsKCQkJdGhpcy5feSA9ICggbTIzICsgbTMyICkgLyBzOwoJCQl0aGlzLl96ID0gMC4yNSAqIHM7CgoJCX0KCgkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RnJvbVVuaXRWZWN0b3JzKCB2RnJvbSwgdlRvICkgewoKCQkvLyBhc3N1bWVzIGRpcmVjdGlvbiB2ZWN0b3JzIHZGcm9tIGFuZCB2VG8gYXJlIG5vcm1hbGl6ZWQKCgkJbGV0IHIgPSB2RnJvbS5kb3QoIHZUbyApICsgMTsKCgkJaWYgKCByIDwgTnVtYmVyLkVQU0lMT04gKSB7CgoJCQkvLyB2RnJvbSBhbmQgdlRvIHBvaW50IGluIG9wcG9zaXRlIGRpcmVjdGlvbnMKCgkJCXIgPSAwOwoKCQkJaWYgKCBNYXRoLmFicyggdkZyb20ueCApID4gTWF0aC5hYnMoIHZGcm9tLnogKSApIHsKCgkJCQl0aGlzLl94ID0gLSB2RnJvbS55OwoJCQkJdGhpcy5feSA9IHZGcm9tLng7CgkJCQl0aGlzLl96ID0gMDsKCQkJCXRoaXMuX3cgPSByOwoKCQkJfSBlbHNlIHsKCgkJCQl0aGlzLl94ID0gMDsKCQkJCXRoaXMuX3kgPSAtIHZGcm9tLno7CgkJCQl0aGlzLl96ID0gdkZyb20ueTsKCQkJCXRoaXMuX3cgPSByOwoKCQkJfQoKCQl9IGVsc2UgewoKCQkJLy8gY3Jvc3NWZWN0b3JzKCB2RnJvbSwgdlRvICk7IC8vIGlubGluZWQgdG8gYXZvaWQgY3ljbGljIGRlcGVuZGVuY3kgb24gVmVjdG9yMwoKCQkJdGhpcy5feCA9IHZGcm9tLnkgKiB2VG8ueiAtIHZGcm9tLnogKiB2VG8ueTsKCQkJdGhpcy5feSA9IHZGcm9tLnogKiB2VG8ueCAtIHZGcm9tLnggKiB2VG8uejsKCQkJdGhpcy5feiA9IHZGcm9tLnggKiB2VG8ueSAtIHZGcm9tLnkgKiB2VG8ueDsKCQkJdGhpcy5fdyA9IHI7CgoJCX0KCgkJcmV0dXJuIHRoaXMubm9ybWFsaXplKCk7CgoJfQoKCWFuZ2xlVG8oIHEgKSB7CgoJCXJldHVybiAyICogTWF0aC5hY29zKCBNYXRoLmFicyggY2xhbXAoIHRoaXMuZG90KCBxICksIC0gMSwgMSApICkgKTsKCgl9CgoJcm90YXRlVG93YXJkcyggcSwgc3RlcCApIHsKCgkJY29uc3QgYW5nbGUgPSB0aGlzLmFuZ2xlVG8oIHEgKTsKCgkJaWYgKCBhbmdsZSA9PT0gMCApIHJldHVybiB0aGlzOwoKCQljb25zdCB0ID0gTWF0aC5taW4oIDEsIHN0ZXAgLyBhbmdsZSApOwoKCQl0aGlzLnNsZXJwKCBxLCB0ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglpZGVudGl0eSgpIHsKCgkJcmV0dXJuIHRoaXMuc2V0KCAwLCAwLCAwLCAxICk7CgoJfQoKCWludmVydCgpIHsKCgkJLy8gcXVhdGVybmlvbiBpcyBhc3N1bWVkIHRvIGhhdmUgdW5pdCBsZW5ndGgKCgkJcmV0dXJuIHRoaXMuY29uanVnYXRlKCk7CgoJfQoKCWNvbmp1Z2F0ZSgpIHsKCgkJdGhpcy5feCAqPSAtIDE7CgkJdGhpcy5feSAqPSAtIDE7CgkJdGhpcy5feiAqPSAtIDE7CgoJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWRvdCggdiApIHsKCgkJcmV0dXJuIHRoaXMuX3ggKiB2Ll94ICsgdGhpcy5feSAqIHYuX3kgKyB0aGlzLl96ICogdi5feiArIHRoaXMuX3cgKiB2Ll93OwoKCX0KCglsZW5ndGhTcSgpIHsKCgkJcmV0dXJuIHRoaXMuX3ggKiB0aGlzLl94ICsgdGhpcy5feSAqIHRoaXMuX3kgKyB0aGlzLl96ICogdGhpcy5feiArIHRoaXMuX3cgKiB0aGlzLl93OwoKCX0KCglsZW5ndGgoKSB7CgoJCXJldHVybiBNYXRoLnNxcnQoIHRoaXMuX3ggKiB0aGlzLl94ICsgdGhpcy5feSAqIHRoaXMuX3kgKyB0aGlzLl96ICogdGhpcy5feiArIHRoaXMuX3cgKiB0aGlzLl93ICk7CgoJfQoKCW5vcm1hbGl6ZSgpIHsKCgkJbGV0IGwgPSB0aGlzLmxlbmd0aCgpOwoKCQlpZiAoIGwgPT09IDAgKSB7CgoJCQl0aGlzLl94ID0gMDsKCQkJdGhpcy5feSA9IDA7CgkJCXRoaXMuX3ogPSAwOwoJCQl0aGlzLl93ID0gMTsKCgkJfSBlbHNlIHsKCgkJCWwgPSAxIC8gbDsKCgkJCXRoaXMuX3ggPSB0aGlzLl94ICogbDsKCQkJdGhpcy5feSA9IHRoaXMuX3kgKiBsOwoJCQl0aGlzLl96ID0gdGhpcy5feiAqIGw7CgkJCXRoaXMuX3cgPSB0aGlzLl93ICogbDsKCgkJfQoKCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltdWx0aXBseSggcSApIHsKCgkJcmV0dXJuIHRoaXMubXVsdGlwbHlRdWF0ZXJuaW9ucyggdGhpcywgcSApOwoKCX0KCglwcmVtdWx0aXBseSggcSApIHsKCgkJcmV0dXJuIHRoaXMubXVsdGlwbHlRdWF0ZXJuaW9ucyggcSwgdGhpcyApOwoKCX0KCgltdWx0aXBseVF1YXRlcm5pb25zKCBhLCBiICkgewoKCQkvLyBmcm9tIGh0dHA6Ly93d3cuZXVjbGlkZWFuc3BhY2UuY29tL21hdGhzL2FsZ2VicmEvcmVhbE5vcm1lZEFsZ2VicmEvcXVhdGVybmlvbnMvY29kZS9pbmRleC5odG0KCgkJY29uc3QgcWF4ID0gYS5feCwgcWF5ID0gYS5feSwgcWF6ID0gYS5feiwgcWF3ID0gYS5fdzsKCQljb25zdCBxYnggPSBiLl94LCBxYnkgPSBiLl95LCBxYnogPSBiLl96LCBxYncgPSBiLl93OwoKCQl0aGlzLl94ID0gcWF4ICogcWJ3ICsgcWF3ICogcWJ4ICsgcWF5ICogcWJ6IC0gcWF6ICogcWJ5OwoJCXRoaXMuX3kgPSBxYXkgKiBxYncgKyBxYXcgKiBxYnkgKyBxYXogKiBxYnggLSBxYXggKiBxYno7CgkJdGhpcy5feiA9IHFheiAqIHFidyArIHFhdyAqIHFieiArIHFheCAqIHFieSAtIHFheSAqIHFieDsKCQl0aGlzLl93ID0gcWF3ICogcWJ3IC0gcWF4ICogcWJ4IC0gcWF5ICogcWJ5IC0gcWF6ICogcWJ6OwoKCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzbGVycCggcWIsIHQgKSB7CgoJCWlmICggdCA9PT0gMCApIHJldHVybiB0aGlzOwoJCWlmICggdCA9PT0gMSApIHJldHVybiB0aGlzLmNvcHkoIHFiICk7CgoJCWNvbnN0IHggPSB0aGlzLl94LCB5ID0gdGhpcy5feSwgeiA9IHRoaXMuX3osIHcgPSB0aGlzLl93OwoKCQkvLyBodHRwOi8vd3d3LmV1Y2xpZGVhbnNwYWNlLmNvbS9tYXRocy9hbGdlYnJhL3JlYWxOb3JtZWRBbGdlYnJhL3F1YXRlcm5pb25zL3NsZXJwLwoKCQlsZXQgY29zSGFsZlRoZXRhID0gdyAqIHFiLl93ICsgeCAqIHFiLl94ICsgeSAqIHFiLl95ICsgeiAqIHFiLl96OwoKCQlpZiAoIGNvc0hhbGZUaGV0YSA8IDAgKSB7CgoJCQl0aGlzLl93ID0gLSBxYi5fdzsKCQkJdGhpcy5feCA9IC0gcWIuX3g7CgkJCXRoaXMuX3kgPSAtIHFiLl95OwoJCQl0aGlzLl96ID0gLSBxYi5fejsKCgkJCWNvc0hhbGZUaGV0YSA9IC0gY29zSGFsZlRoZXRhOwoKCQl9IGVsc2UgewoKCQkJdGhpcy5jb3B5KCBxYiApOwoKCQl9CgoJCWlmICggY29zSGFsZlRoZXRhID49IDEuMCApIHsKCgkJCXRoaXMuX3cgPSB3OwoJCQl0aGlzLl94ID0geDsKCQkJdGhpcy5feSA9IHk7CgkJCXRoaXMuX3ogPSB6OwoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJY29uc3Qgc3FyU2luSGFsZlRoZXRhID0gMS4wIC0gY29zSGFsZlRoZXRhICogY29zSGFsZlRoZXRhOwoKCQlpZiAoIHNxclNpbkhhbGZUaGV0YSA8PSBOdW1iZXIuRVBTSUxPTiApIHsKCgkJCWNvbnN0IHMgPSAxIC0gdDsKCQkJdGhpcy5fdyA9IHMgKiB3ICsgdCAqIHRoaXMuX3c7CgkJCXRoaXMuX3ggPSBzICogeCArIHQgKiB0aGlzLl94OwoJCQl0aGlzLl95ID0gcyAqIHkgKyB0ICogdGhpcy5feTsKCQkJdGhpcy5feiA9IHMgKiB6ICsgdCAqIHRoaXMuX3o7CgoJCQl0aGlzLm5vcm1hbGl6ZSgpOwoJCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQljb25zdCBzaW5IYWxmVGhldGEgPSBNYXRoLnNxcnQoIHNxclNpbkhhbGZUaGV0YSApOwoJCWNvbnN0IGhhbGZUaGV0YSA9IE1hdGguYXRhbjIoIHNpbkhhbGZUaGV0YSwgY29zSGFsZlRoZXRhICk7CgkJY29uc3QgcmF0aW9BID0gTWF0aC5zaW4oICggMSAtIHQgKSAqIGhhbGZUaGV0YSApIC8gc2luSGFsZlRoZXRhLAoJCQlyYXRpb0IgPSBNYXRoLnNpbiggdCAqIGhhbGZUaGV0YSApIC8gc2luSGFsZlRoZXRhOwoKCQl0aGlzLl93ID0gKCB3ICogcmF0aW9BICsgdGhpcy5fdyAqIHJhdGlvQiApOwoJCXRoaXMuX3ggPSAoIHggKiByYXRpb0EgKyB0aGlzLl94ICogcmF0aW9CICk7CgkJdGhpcy5feSA9ICggeSAqIHJhdGlvQSArIHRoaXMuX3kgKiByYXRpb0IgKTsKCQl0aGlzLl96ID0gKCB6ICogcmF0aW9BICsgdGhpcy5feiAqIHJhdGlvQiApOwoKCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzbGVycFF1YXRlcm5pb25zKCBxYSwgcWIsIHQgKSB7CgoJCXJldHVybiB0aGlzLmNvcHkoIHFhICkuc2xlcnAoIHFiLCB0ICk7CgoJfQoKCXJhbmRvbSgpIHsKCgkJLy8gRGVyaXZlZCBmcm9tIGh0dHA6Ly9wbGFubmluZy5jcy51aXVjLmVkdS9ub2RlMTk4Lmh0bWwKCQkvLyBOb3RlLCB0aGlzIHNvdXJjZSB1c2VzIHcsIHgsIHksIHogb3JkZXJpbmcsCgkJLy8gc28gd2Ugc3dhcCB0aGUgb3JkZXIgYmVsb3cuCgoJCWNvbnN0IHUxID0gTWF0aC5yYW5kb20oKTsKCQljb25zdCBzcXJ0MXUxID0gTWF0aC5zcXJ0KCAxIC0gdTEgKTsKCQljb25zdCBzcXJ0dTEgPSBNYXRoLnNxcnQoIHUxICk7CgoJCWNvbnN0IHUyID0gMiAqIE1hdGguUEkgKiBNYXRoLnJhbmRvbSgpOwoKCQljb25zdCB1MyA9IDIgKiBNYXRoLlBJICogTWF0aC5yYW5kb20oKTsKCgkJcmV0dXJuIHRoaXMuc2V0KAoJCQlzcXJ0MXUxICogTWF0aC5jb3MoIHUyICksCgkJCXNxcnR1MSAqIE1hdGguc2luKCB1MyApLAoJCQlzcXJ0dTEgKiBNYXRoLmNvcyggdTMgKSwKCQkJc3FydDF1MSAqIE1hdGguc2luKCB1MiApLAoJCSk7CgoJfQoKCWVxdWFscyggcXVhdGVybmlvbiApIHsKCgkJcmV0dXJuICggcXVhdGVybmlvbi5feCA9PT0gdGhpcy5feCApICYmICggcXVhdGVybmlvbi5feSA9PT0gdGhpcy5feSApICYmICggcXVhdGVybmlvbi5feiA9PT0gdGhpcy5feiApICYmICggcXVhdGVybmlvbi5fdyA9PT0gdGhpcy5fdyApOwoKCX0KCglmcm9tQXJyYXkoIGFycmF5LCBvZmZzZXQgPSAwICkgewoKCQl0aGlzLl94ID0gYXJyYXlbIG9mZnNldCBdOwoJCXRoaXMuX3kgPSBhcnJheVsgb2Zmc2V0ICsgMSBdOwoJCXRoaXMuX3ogPSBhcnJheVsgb2Zmc2V0ICsgMiBdOwoJCXRoaXMuX3cgPSBhcnJheVsgb2Zmc2V0ICsgMyBdOwoKCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0FycmF5KCBhcnJheSA9IFtdLCBvZmZzZXQgPSAwICkgewoKCQlhcnJheVsgb2Zmc2V0IF0gPSB0aGlzLl94OwoJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0aGlzLl95OwoJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0aGlzLl96OwoJCWFycmF5WyBvZmZzZXQgKyAzIF0gPSB0aGlzLl93OwoKCQlyZXR1cm4gYXJyYXk7CgoJfQoKCWZyb21CdWZmZXJBdHRyaWJ1dGUoIGF0dHJpYnV0ZSwgaW5kZXggKSB7CgoJCXRoaXMuX3ggPSBhdHRyaWJ1dGUuZ2V0WCggaW5kZXggKTsKCQl0aGlzLl95ID0gYXR0cmlidXRlLmdldFkoIGluZGV4ICk7CgkJdGhpcy5feiA9IGF0dHJpYnV0ZS5nZXRaKCBpbmRleCApOwoJCXRoaXMuX3cgPSBhdHRyaWJ1dGUuZ2V0VyggaW5kZXggKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTigpIHsKCgkJcmV0dXJuIHRoaXMudG9BcnJheSgpOwoKCX0KCglfb25DaGFuZ2UoIGNhbGxiYWNrICkgewoKCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrID0gY2FsbGJhY2s7CgoJCXJldHVybiB0aGlzOwoKCX0KCglfb25DaGFuZ2VDYWxsYmFjaygpIHt9CgoJKlsgU3ltYm9sLml0ZXJhdG9yIF0oKSB7CgoJCXlpZWxkIHRoaXMuX3g7CgkJeWllbGQgdGhpcy5feTsKCQl5aWVsZCB0aGlzLl96OwoJCXlpZWxkIHRoaXMuX3c7CgoJfQoKfQoKY2xhc3MgVmVjdG9yMyB7CgoJY29uc3RydWN0b3IoIHggPSAwLCB5ID0gMCwgeiA9IDAgKSB7CgoJCVZlY3RvcjMucHJvdG90eXBlLmlzVmVjdG9yMyA9IHRydWU7CgoJCXRoaXMueCA9IHg7CgkJdGhpcy55ID0geTsKCQl0aGlzLnogPSB6OwoKCX0KCglzZXQoIHgsIHksIHogKSB7CgoJCWlmICggeiA9PT0gdW5kZWZpbmVkICkgeiA9IHRoaXMuejsgLy8gc3ByaXRlLnNjYWxlLnNldCh4LHkpCgoJCXRoaXMueCA9IHg7CgkJdGhpcy55ID0geTsKCQl0aGlzLnogPSB6OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0U2NhbGFyKCBzY2FsYXIgKSB7CgoJCXRoaXMueCA9IHNjYWxhcjsKCQl0aGlzLnkgPSBzY2FsYXI7CgkJdGhpcy56ID0gc2NhbGFyOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0WCggeCApIHsKCgkJdGhpcy54ID0geDsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldFkoIHkgKSB7CgoJCXRoaXMueSA9IHk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRaKCB6ICkgewoKCQl0aGlzLnogPSB6OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0Q29tcG9uZW50KCBpbmRleCwgdmFsdWUgKSB7CgoJCXN3aXRjaCAoIGluZGV4ICkgewoKCQkJY2FzZSAwOiB0aGlzLnggPSB2YWx1ZTsgYnJlYWs7CgkJCWNhc2UgMTogdGhpcy55ID0gdmFsdWU7IGJyZWFrOwoJCQljYXNlIDI6IHRoaXMueiA9IHZhbHVlOyBicmVhazsKCQkJZGVmYXVsdDogdGhyb3cgbmV3IEVycm9yKCAnaW5kZXggaXMgb3V0IG9mIHJhbmdlOiAnICsgaW5kZXggKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0Q29tcG9uZW50KCBpbmRleCApIHsKCgkJc3dpdGNoICggaW5kZXggKSB7CgoJCQljYXNlIDA6IHJldHVybiB0aGlzLng7CgkJCWNhc2UgMTogcmV0dXJuIHRoaXMueTsKCQkJY2FzZSAyOiByZXR1cm4gdGhpcy56OwoJCQlkZWZhdWx0OiB0aHJvdyBuZXcgRXJyb3IoICdpbmRleCBpcyBvdXQgb2YgcmFuZ2U6ICcgKyBpbmRleCApOwoKCQl9CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMueCwgdGhpcy55LCB0aGlzLnogKTsKCgl9CgoJY29weSggdiApIHsKCgkJdGhpcy54ID0gdi54OwoJCXRoaXMueSA9IHYueTsKCQl0aGlzLnogPSB2Lno7CgoJCXJldHVybiB0aGlzOwoKCX0KCglhZGQoIHYgKSB7CgoJCXRoaXMueCArPSB2Lng7CgkJdGhpcy55ICs9IHYueTsKCQl0aGlzLnogKz0gdi56OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJYWRkU2NhbGFyKCBzICkgewoKCQl0aGlzLnggKz0gczsKCQl0aGlzLnkgKz0gczsKCQl0aGlzLnogKz0gczsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFkZFZlY3RvcnMoIGEsIGIgKSB7CgoJCXRoaXMueCA9IGEueCArIGIueDsKCQl0aGlzLnkgPSBhLnkgKyBiLnk7CgkJdGhpcy56ID0gYS56ICsgYi56OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJYWRkU2NhbGVkVmVjdG9yKCB2LCBzICkgewoKCQl0aGlzLnggKz0gdi54ICogczsKCQl0aGlzLnkgKz0gdi55ICogczsKCQl0aGlzLnogKz0gdi56ICogczsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXN1YiggdiApIHsKCgkJdGhpcy54IC09IHYueDsKCQl0aGlzLnkgLT0gdi55OwoJCXRoaXMueiAtPSB2Lno7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzdWJTY2FsYXIoIHMgKSB7CgoJCXRoaXMueCAtPSBzOwoJCXRoaXMueSAtPSBzOwoJCXRoaXMueiAtPSBzOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc3ViVmVjdG9ycyggYSwgYiApIHsKCgkJdGhpcy54ID0gYS54IC0gYi54OwoJCXRoaXMueSA9IGEueSAtIGIueTsKCQl0aGlzLnogPSBhLnogLSBiLno7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltdWx0aXBseSggdiApIHsKCgkJdGhpcy54ICo9IHYueDsKCQl0aGlzLnkgKj0gdi55OwoJCXRoaXMueiAqPSB2Lno7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltdWx0aXBseVNjYWxhciggc2NhbGFyICkgewoKCQl0aGlzLnggKj0gc2NhbGFyOwoJCXRoaXMueSAqPSBzY2FsYXI7CgkJdGhpcy56ICo9IHNjYWxhcjsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCW11bHRpcGx5VmVjdG9ycyggYSwgYiApIHsKCgkJdGhpcy54ID0gYS54ICogYi54OwoJCXRoaXMueSA9IGEueSAqIGIueTsKCQl0aGlzLnogPSBhLnogKiBiLno7CgoJCXJldHVybiB0aGlzOwoKCX0KCglhcHBseUV1bGVyKCBldWxlciApIHsKCgkJcmV0dXJuIHRoaXMuYXBwbHlRdWF0ZXJuaW9uKCBfcXVhdGVybmlvbiQ0LnNldEZyb21FdWxlciggZXVsZXIgKSApOwoKCX0KCglhcHBseUF4aXNBbmdsZSggYXhpcywgYW5nbGUgKSB7CgoJCXJldHVybiB0aGlzLmFwcGx5UXVhdGVybmlvbiggX3F1YXRlcm5pb24kNC5zZXRGcm9tQXhpc0FuZ2xlKCBheGlzLCBhbmdsZSApICk7CgoJfQoKCWFwcGx5TWF0cml4MyggbSApIHsKCgkJY29uc3QgeCA9IHRoaXMueCwgeSA9IHRoaXMueSwgeiA9IHRoaXMuejsKCQljb25zdCBlID0gbS5lbGVtZW50czsKCgkJdGhpcy54ID0gZVsgMCBdICogeCArIGVbIDMgXSAqIHkgKyBlWyA2IF0gKiB6OwoJCXRoaXMueSA9IGVbIDEgXSAqIHggKyBlWyA0IF0gKiB5ICsgZVsgNyBdICogejsKCQl0aGlzLnogPSBlWyAyIF0gKiB4ICsgZVsgNSBdICogeSArIGVbIDggXSAqIHo7CgoJCXJldHVybiB0aGlzOwoKCX0KCglhcHBseU5vcm1hbE1hdHJpeCggbSApIHsKCgkJcmV0dXJuIHRoaXMuYXBwbHlNYXRyaXgzKCBtICkubm9ybWFsaXplKCk7CgoJfQoKCWFwcGx5TWF0cml4NCggbSApIHsKCgkJY29uc3QgeCA9IHRoaXMueCwgeSA9IHRoaXMueSwgeiA9IHRoaXMuejsKCQljb25zdCBlID0gbS5lbGVtZW50czsKCgkJY29uc3QgdyA9IDEgLyAoIGVbIDMgXSAqIHggKyBlWyA3IF0gKiB5ICsgZVsgMTEgXSAqIHogKyBlWyAxNSBdICk7CgoJCXRoaXMueCA9ICggZVsgMCBdICogeCArIGVbIDQgXSAqIHkgKyBlWyA4IF0gKiB6ICsgZVsgMTIgXSApICogdzsKCQl0aGlzLnkgPSAoIGVbIDEgXSAqIHggKyBlWyA1IF0gKiB5ICsgZVsgOSBdICogeiArIGVbIDEzIF0gKSAqIHc7CgkJdGhpcy56ID0gKCBlWyAyIF0gKiB4ICsgZVsgNiBdICogeSArIGVbIDEwIF0gKiB6ICsgZVsgMTQgXSApICogdzsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFwcGx5UXVhdGVybmlvbiggcSApIHsKCgkJY29uc3QgeCA9IHRoaXMueCwgeSA9IHRoaXMueSwgeiA9IHRoaXMuejsKCQljb25zdCBxeCA9IHEueCwgcXkgPSBxLnksIHF6ID0gcS56LCBxdyA9IHEudzsKCgkJLy8gY2FsY3VsYXRlIHF1YXQgKiB2ZWN0b3IKCgkJY29uc3QgaXggPSBxdyAqIHggKyBxeSAqIHogLSBxeiAqIHk7CgkJY29uc3QgaXkgPSBxdyAqIHkgKyBxeiAqIHggLSBxeCAqIHo7CgkJY29uc3QgaXogPSBxdyAqIHogKyBxeCAqIHkgLSBxeSAqIHg7CgkJY29uc3QgaXcgPSAtIHF4ICogeCAtIHF5ICogeSAtIHF6ICogejsKCgkJLy8gY2FsY3VsYXRlIHJlc3VsdCAqIGludmVyc2UgcXVhdAoKCQl0aGlzLnggPSBpeCAqIHF3ICsgaXcgKiAtIHF4ICsgaXkgKiAtIHF6IC0gaXogKiAtIHF5OwoJCXRoaXMueSA9IGl5ICogcXcgKyBpdyAqIC0gcXkgKyBpeiAqIC0gcXggLSBpeCAqIC0gcXo7CgkJdGhpcy56ID0gaXogKiBxdyArIGl3ICogLSBxeiArIGl4ICogLSBxeSAtIGl5ICogLSBxeDsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXByb2plY3QoIGNhbWVyYSApIHsKCgkJcmV0dXJuIHRoaXMuYXBwbHlNYXRyaXg0KCBjYW1lcmEubWF0cml4V29ybGRJbnZlcnNlICkuYXBwbHlNYXRyaXg0KCBjYW1lcmEucHJvamVjdGlvbk1hdHJpeCApOwoKCX0KCgl1bnByb2plY3QoIGNhbWVyYSApIHsKCgkJcmV0dXJuIHRoaXMuYXBwbHlNYXRyaXg0KCBjYW1lcmEucHJvamVjdGlvbk1hdHJpeEludmVyc2UgKS5hcHBseU1hdHJpeDQoIGNhbWVyYS5tYXRyaXhXb3JsZCApOwoKCX0KCgl0cmFuc2Zvcm1EaXJlY3Rpb24oIG0gKSB7CgoJCS8vIGlucHV0OiBUSFJFRS5NYXRyaXg0IGFmZmluZSBtYXRyaXgKCQkvLyB2ZWN0b3IgaW50ZXJwcmV0ZWQgYXMgYSBkaXJlY3Rpb24KCgkJY29uc3QgeCA9IHRoaXMueCwgeSA9IHRoaXMueSwgeiA9IHRoaXMuejsKCQljb25zdCBlID0gbS5lbGVtZW50czsKCgkJdGhpcy54ID0gZVsgMCBdICogeCArIGVbIDQgXSAqIHkgKyBlWyA4IF0gKiB6OwoJCXRoaXMueSA9IGVbIDEgXSAqIHggKyBlWyA1IF0gKiB5ICsgZVsgOSBdICogejsKCQl0aGlzLnogPSBlWyAyIF0gKiB4ICsgZVsgNiBdICogeSArIGVbIDEwIF0gKiB6OwoKCQlyZXR1cm4gdGhpcy5ub3JtYWxpemUoKTsKCgl9CgoJZGl2aWRlKCB2ICkgewoKCQl0aGlzLnggLz0gdi54OwoJCXRoaXMueSAvPSB2Lnk7CgkJdGhpcy56IC89IHYuejsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWRpdmlkZVNjYWxhciggc2NhbGFyICkgewoKCQlyZXR1cm4gdGhpcy5tdWx0aXBseVNjYWxhciggMSAvIHNjYWxhciApOwoKCX0KCgltaW4oIHYgKSB7CgoJCXRoaXMueCA9IE1hdGgubWluKCB0aGlzLngsIHYueCApOwoJCXRoaXMueSA9IE1hdGgubWluKCB0aGlzLnksIHYueSApOwoJCXRoaXMueiA9IE1hdGgubWluKCB0aGlzLnosIHYueiApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbWF4KCB2ICkgewoKCQl0aGlzLnggPSBNYXRoLm1heCggdGhpcy54LCB2LnggKTsKCQl0aGlzLnkgPSBNYXRoLm1heCggdGhpcy55LCB2LnkgKTsKCQl0aGlzLnogPSBNYXRoLm1heCggdGhpcy56LCB2LnogKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNsYW1wKCBtaW4sIG1heCApIHsKCgkJLy8gYXNzdW1lcyBtaW4gPCBtYXgsIGNvbXBvbmVudHdpc2UKCgkJdGhpcy54ID0gTWF0aC5tYXgoIG1pbi54LCBNYXRoLm1pbiggbWF4LngsIHRoaXMueCApICk7CgkJdGhpcy55ID0gTWF0aC5tYXgoIG1pbi55LCBNYXRoLm1pbiggbWF4LnksIHRoaXMueSApICk7CgkJdGhpcy56ID0gTWF0aC5tYXgoIG1pbi56LCBNYXRoLm1pbiggbWF4LnosIHRoaXMueiApICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljbGFtcFNjYWxhciggbWluVmFsLCBtYXhWYWwgKSB7CgoJCXRoaXMueCA9IE1hdGgubWF4KCBtaW5WYWwsIE1hdGgubWluKCBtYXhWYWwsIHRoaXMueCApICk7CgkJdGhpcy55ID0gTWF0aC5tYXgoIG1pblZhbCwgTWF0aC5taW4oIG1heFZhbCwgdGhpcy55ICkgKTsKCQl0aGlzLnogPSBNYXRoLm1heCggbWluVmFsLCBNYXRoLm1pbiggbWF4VmFsLCB0aGlzLnogKSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY2xhbXBMZW5ndGgoIG1pbiwgbWF4ICkgewoKCQljb25zdCBsZW5ndGggPSB0aGlzLmxlbmd0aCgpOwoKCQlyZXR1cm4gdGhpcy5kaXZpZGVTY2FsYXIoIGxlbmd0aCB8fCAxICkubXVsdGlwbHlTY2FsYXIoIE1hdGgubWF4KCBtaW4sIE1hdGgubWluKCBtYXgsIGxlbmd0aCApICkgKTsKCgl9CgoJZmxvb3IoKSB7CgoJCXRoaXMueCA9IE1hdGguZmxvb3IoIHRoaXMueCApOwoJCXRoaXMueSA9IE1hdGguZmxvb3IoIHRoaXMueSApOwoJCXRoaXMueiA9IE1hdGguZmxvb3IoIHRoaXMueiApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY2VpbCgpIHsKCgkJdGhpcy54ID0gTWF0aC5jZWlsKCB0aGlzLnggKTsKCQl0aGlzLnkgPSBNYXRoLmNlaWwoIHRoaXMueSApOwoJCXRoaXMueiA9IE1hdGguY2VpbCggdGhpcy56ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglyb3VuZCgpIHsKCgkJdGhpcy54ID0gTWF0aC5yb3VuZCggdGhpcy54ICk7CgkJdGhpcy55ID0gTWF0aC5yb3VuZCggdGhpcy55ICk7CgkJdGhpcy56ID0gTWF0aC5yb3VuZCggdGhpcy56ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglyb3VuZFRvWmVybygpIHsKCgkJdGhpcy54ID0gTWF0aC50cnVuYyggdGhpcy54ICk7CgkJdGhpcy55ID0gTWF0aC50cnVuYyggdGhpcy55ICk7CgkJdGhpcy56ID0gTWF0aC50cnVuYyggdGhpcy56ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgluZWdhdGUoKSB7CgoJCXRoaXMueCA9IC0gdGhpcy54OwoJCXRoaXMueSA9IC0gdGhpcy55OwoJCXRoaXMueiA9IC0gdGhpcy56OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZG90KCB2ICkgewoKCQlyZXR1cm4gdGhpcy54ICogdi54ICsgdGhpcy55ICogdi55ICsgdGhpcy56ICogdi56OwoKCX0KCgkvLyBUT0RPIGxlbmd0aFNxdWFyZWQ/CgoJbGVuZ3RoU3EoKSB7CgoJCXJldHVybiB0aGlzLnggKiB0aGlzLnggKyB0aGlzLnkgKiB0aGlzLnkgKyB0aGlzLnogKiB0aGlzLno7CgoJfQoKCWxlbmd0aCgpIHsKCgkJcmV0dXJuIE1hdGguc3FydCggdGhpcy54ICogdGhpcy54ICsgdGhpcy55ICogdGhpcy55ICsgdGhpcy56ICogdGhpcy56ICk7CgoJfQoKCW1hbmhhdHRhbkxlbmd0aCgpIHsKCgkJcmV0dXJuIE1hdGguYWJzKCB0aGlzLnggKSArIE1hdGguYWJzKCB0aGlzLnkgKSArIE1hdGguYWJzKCB0aGlzLnogKTsKCgl9CgoJbm9ybWFsaXplKCkgewoKCQlyZXR1cm4gdGhpcy5kaXZpZGVTY2FsYXIoIHRoaXMubGVuZ3RoKCkgfHwgMSApOwoKCX0KCglzZXRMZW5ndGgoIGxlbmd0aCApIHsKCgkJcmV0dXJuIHRoaXMubm9ybWFsaXplKCkubXVsdGlwbHlTY2FsYXIoIGxlbmd0aCApOwoKCX0KCglsZXJwKCB2LCBhbHBoYSApIHsKCgkJdGhpcy54ICs9ICggdi54IC0gdGhpcy54ICkgKiBhbHBoYTsKCQl0aGlzLnkgKz0gKCB2LnkgLSB0aGlzLnkgKSAqIGFscGhhOwoJCXRoaXMueiArPSAoIHYueiAtIHRoaXMueiApICogYWxwaGE7CgoJCXJldHVybiB0aGlzOwoKCX0KCglsZXJwVmVjdG9ycyggdjEsIHYyLCBhbHBoYSApIHsKCgkJdGhpcy54ID0gdjEueCArICggdjIueCAtIHYxLnggKSAqIGFscGhhOwoJCXRoaXMueSA9IHYxLnkgKyAoIHYyLnkgLSB2MS55ICkgKiBhbHBoYTsKCQl0aGlzLnogPSB2MS56ICsgKCB2Mi56IC0gdjEueiApICogYWxwaGE7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljcm9zcyggdiApIHsKCgkJcmV0dXJuIHRoaXMuY3Jvc3NWZWN0b3JzKCB0aGlzLCB2ICk7CgoJfQoKCWNyb3NzVmVjdG9ycyggYSwgYiApIHsKCgkJY29uc3QgYXggPSBhLngsIGF5ID0gYS55LCBheiA9IGEuejsKCQljb25zdCBieCA9IGIueCwgYnkgPSBiLnksIGJ6ID0gYi56OwoKCQl0aGlzLnggPSBheSAqIGJ6IC0gYXogKiBieTsKCQl0aGlzLnkgPSBheiAqIGJ4IC0gYXggKiBiejsKCQl0aGlzLnogPSBheCAqIGJ5IC0gYXkgKiBieDsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXByb2plY3RPblZlY3RvciggdiApIHsKCgkJY29uc3QgZGVub21pbmF0b3IgPSB2Lmxlbmd0aFNxKCk7CgoJCWlmICggZGVub21pbmF0b3IgPT09IDAgKSByZXR1cm4gdGhpcy5zZXQoIDAsIDAsIDAgKTsKCgkJY29uc3Qgc2NhbGFyID0gdi5kb3QoIHRoaXMgKSAvIGRlbm9taW5hdG9yOwoKCQlyZXR1cm4gdGhpcy5jb3B5KCB2ICkubXVsdGlwbHlTY2FsYXIoIHNjYWxhciApOwoKCX0KCglwcm9qZWN0T25QbGFuZSggcGxhbmVOb3JtYWwgKSB7CgoJCV92ZWN0b3IkYi5jb3B5KCB0aGlzICkucHJvamVjdE9uVmVjdG9yKCBwbGFuZU5vcm1hbCApOwoKCQlyZXR1cm4gdGhpcy5zdWIoIF92ZWN0b3IkYiApOwoKCX0KCglyZWZsZWN0KCBub3JtYWwgKSB7CgoJCS8vIHJlZmxlY3QgaW5jaWRlbnQgdmVjdG9yIG9mZiBwbGFuZSBvcnRob2dvbmFsIHRvIG5vcm1hbAoJCS8vIG5vcm1hbCBpcyBhc3N1bWVkIHRvIGhhdmUgdW5pdCBsZW5ndGgKCgkJcmV0dXJuIHRoaXMuc3ViKCBfdmVjdG9yJGIuY29weSggbm9ybWFsICkubXVsdGlwbHlTY2FsYXIoIDIgKiB0aGlzLmRvdCggbm9ybWFsICkgKSApOwoKCX0KCglhbmdsZVRvKCB2ICkgewoKCQljb25zdCBkZW5vbWluYXRvciA9IE1hdGguc3FydCggdGhpcy5sZW5ndGhTcSgpICogdi5sZW5ndGhTcSgpICk7CgoJCWlmICggZGVub21pbmF0b3IgPT09IDAgKSByZXR1cm4gTWF0aC5QSSAvIDI7CgoJCWNvbnN0IHRoZXRhID0gdGhpcy5kb3QoIHYgKSAvIGRlbm9taW5hdG9yOwoKCQkvLyBjbGFtcCwgdG8gaGFuZGxlIG51bWVyaWNhbCBwcm9ibGVtcwoKCQlyZXR1cm4gTWF0aC5hY29zKCBjbGFtcCggdGhldGEsIC0gMSwgMSApICk7CgoJfQoKCWRpc3RhbmNlVG8oIHYgKSB7CgoJCXJldHVybiBNYXRoLnNxcnQoIHRoaXMuZGlzdGFuY2VUb1NxdWFyZWQoIHYgKSApOwoKCX0KCglkaXN0YW5jZVRvU3F1YXJlZCggdiApIHsKCgkJY29uc3QgZHggPSB0aGlzLnggLSB2LngsIGR5ID0gdGhpcy55IC0gdi55LCBkeiA9IHRoaXMueiAtIHYuejsKCgkJcmV0dXJuIGR4ICogZHggKyBkeSAqIGR5ICsgZHogKiBkejsKCgl9CgoJbWFuaGF0dGFuRGlzdGFuY2VUbyggdiApIHsKCgkJcmV0dXJuIE1hdGguYWJzKCB0aGlzLnggLSB2LnggKSArIE1hdGguYWJzKCB0aGlzLnkgLSB2LnkgKSArIE1hdGguYWJzKCB0aGlzLnogLSB2LnogKTsKCgl9CgoJc2V0RnJvbVNwaGVyaWNhbCggcyApIHsKCgkJcmV0dXJuIHRoaXMuc2V0RnJvbVNwaGVyaWNhbENvb3Jkcyggcy5yYWRpdXMsIHMucGhpLCBzLnRoZXRhICk7CgoJfQoKCXNldEZyb21TcGhlcmljYWxDb29yZHMoIHJhZGl1cywgcGhpLCB0aGV0YSApIHsKCgkJY29uc3Qgc2luUGhpUmFkaXVzID0gTWF0aC5zaW4oIHBoaSApICogcmFkaXVzOwoKCQl0aGlzLnggPSBzaW5QaGlSYWRpdXMgKiBNYXRoLnNpbiggdGhldGEgKTsKCQl0aGlzLnkgPSBNYXRoLmNvcyggcGhpICkgKiByYWRpdXM7CgkJdGhpcy56ID0gc2luUGhpUmFkaXVzICogTWF0aC5jb3MoIHRoZXRhICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tQ3lsaW5kcmljYWwoIGMgKSB7CgoJCXJldHVybiB0aGlzLnNldEZyb21DeWxpbmRyaWNhbENvb3JkcyggYy5yYWRpdXMsIGMudGhldGEsIGMueSApOwoKCX0KCglzZXRGcm9tQ3lsaW5kcmljYWxDb29yZHMoIHJhZGl1cywgdGhldGEsIHkgKSB7CgoJCXRoaXMueCA9IHJhZGl1cyAqIE1hdGguc2luKCB0aGV0YSApOwoJCXRoaXMueSA9IHk7CgkJdGhpcy56ID0gcmFkaXVzICogTWF0aC5jb3MoIHRoZXRhICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tTWF0cml4UG9zaXRpb24oIG0gKSB7CgoJCWNvbnN0IGUgPSBtLmVsZW1lbnRzOwoKCQl0aGlzLnggPSBlWyAxMiBdOwoJCXRoaXMueSA9IGVbIDEzIF07CgkJdGhpcy56ID0gZVsgMTQgXTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldEZyb21NYXRyaXhTY2FsZSggbSApIHsKCgkJY29uc3Qgc3ggPSB0aGlzLnNldEZyb21NYXRyaXhDb2x1bW4oIG0sIDAgKS5sZW5ndGgoKTsKCQljb25zdCBzeSA9IHRoaXMuc2V0RnJvbU1hdHJpeENvbHVtbiggbSwgMSApLmxlbmd0aCgpOwoJCWNvbnN0IHN6ID0gdGhpcy5zZXRGcm9tTWF0cml4Q29sdW1uKCBtLCAyICkubGVuZ3RoKCk7CgoJCXRoaXMueCA9IHN4OwoJCXRoaXMueSA9IHN5OwoJCXRoaXMueiA9IHN6OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RnJvbU1hdHJpeENvbHVtbiggbSwgaW5kZXggKSB7CgoJCXJldHVybiB0aGlzLmZyb21BcnJheSggbS5lbGVtZW50cywgaW5kZXggKiA0ICk7CgoJfQoKCXNldEZyb21NYXRyaXgzQ29sdW1uKCBtLCBpbmRleCApIHsKCgkJcmV0dXJuIHRoaXMuZnJvbUFycmF5KCBtLmVsZW1lbnRzLCBpbmRleCAqIDMgKTsKCgl9CgoJc2V0RnJvbUV1bGVyKCBlICkgewoKCQl0aGlzLnggPSBlLl94OwoJCXRoaXMueSA9IGUuX3k7CgkJdGhpcy56ID0gZS5fejsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldEZyb21Db2xvciggYyApIHsKCgkJdGhpcy54ID0gYy5yOwoJCXRoaXMueSA9IGMuZzsKCQl0aGlzLnogPSBjLmI7CgoJCXJldHVybiB0aGlzOwoKCX0KCgllcXVhbHMoIHYgKSB7CgoJCXJldHVybiAoICggdi54ID09PSB0aGlzLnggKSAmJiAoIHYueSA9PT0gdGhpcy55ICkgJiYgKCB2LnogPT09IHRoaXMueiApICk7CgoJfQoKCWZyb21BcnJheSggYXJyYXksIG9mZnNldCA9IDAgKSB7CgoJCXRoaXMueCA9IGFycmF5WyBvZmZzZXQgXTsKCQl0aGlzLnkgPSBhcnJheVsgb2Zmc2V0ICsgMSBdOwoJCXRoaXMueiA9IGFycmF5WyBvZmZzZXQgKyAyIF07CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0FycmF5KCBhcnJheSA9IFtdLCBvZmZzZXQgPSAwICkgewoKCQlhcnJheVsgb2Zmc2V0IF0gPSB0aGlzLng7CgkJYXJyYXlbIG9mZnNldCArIDEgXSA9IHRoaXMueTsKCQlhcnJheVsgb2Zmc2V0ICsgMiBdID0gdGhpcy56OwoKCQlyZXR1cm4gYXJyYXk7CgoJfQoKCWZyb21CdWZmZXJBdHRyaWJ1dGUoIGF0dHJpYnV0ZSwgaW5kZXggKSB7CgoJCXRoaXMueCA9IGF0dHJpYnV0ZS5nZXRYKCBpbmRleCApOwoJCXRoaXMueSA9IGF0dHJpYnV0ZS5nZXRZKCBpbmRleCApOwoJCXRoaXMueiA9IGF0dHJpYnV0ZS5nZXRaKCBpbmRleCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJcmFuZG9tKCkgewoKCQl0aGlzLnggPSBNYXRoLnJhbmRvbSgpOwoJCXRoaXMueSA9IE1hdGgucmFuZG9tKCk7CgkJdGhpcy56ID0gTWF0aC5yYW5kb20oKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXJhbmRvbURpcmVjdGlvbigpIHsKCgkJLy8gRGVyaXZlZCBmcm9tIGh0dHBzOi8vbWF0aHdvcmxkLndvbGZyYW0uY29tL1NwaGVyZVBvaW50UGlja2luZy5odG1sCgoJCWNvbnN0IHUgPSAoIE1hdGgucmFuZG9tKCkgLSAwLjUgKSAqIDI7CgkJY29uc3QgdCA9IE1hdGgucmFuZG9tKCkgKiBNYXRoLlBJICogMjsKCQljb25zdCBmID0gTWF0aC5zcXJ0KCAxIC0gdSAqKiAyICk7CgoJCXRoaXMueCA9IGYgKiBNYXRoLmNvcyggdCApOwoJCXRoaXMueSA9IGYgKiBNYXRoLnNpbiggdCApOwoJCXRoaXMueiA9IHU7CgoJCXJldHVybiB0aGlzOwoKCX0KCgkqWyBTeW1ib2wuaXRlcmF0b3IgXSgpIHsKCgkJeWllbGQgdGhpcy54OwoJCXlpZWxkIHRoaXMueTsKCQl5aWVsZCB0aGlzLno7CgoJfQoKfQoKY29uc3QgX3ZlY3RvciRiID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfcXVhdGVybmlvbiQ0ID0gLypAX19QVVJFX18qLyBuZXcgUXVhdGVybmlvbigpOwoKY2xhc3MgQm94MyB7CgoJY29uc3RydWN0b3IoIG1pbiA9IG5ldyBWZWN0b3IzKCArIEluZmluaXR5LCArIEluZmluaXR5LCArIEluZmluaXR5ICksIG1heCA9IG5ldyBWZWN0b3IzKCAtIEluZmluaXR5LCAtIEluZmluaXR5LCAtIEluZmluaXR5ICkgKSB7CgoJCXRoaXMuaXNCb3gzID0gdHJ1ZTsKCgkJdGhpcy5taW4gPSBtaW47CgkJdGhpcy5tYXggPSBtYXg7CgoJfQoKCXNldCggbWluLCBtYXggKSB7CgoJCXRoaXMubWluLmNvcHkoIG1pbiApOwoJCXRoaXMubWF4LmNvcHkoIG1heCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RnJvbUFycmF5KCBhcnJheSApIHsKCgkJdGhpcy5tYWtlRW1wdHkoKTsKCgkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGFycmF5Lmxlbmd0aDsgaSA8IGlsOyBpICs9IDMgKSB7CgoJCQl0aGlzLmV4cGFuZEJ5UG9pbnQoIF92ZWN0b3IkYS5mcm9tQXJyYXkoIGFycmF5LCBpICkgKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlICkgewoKCQl0aGlzLm1ha2VFbXB0eSgpOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gYXR0cmlidXRlLmNvdW50OyBpIDwgaWw7IGkgKysgKSB7CgoJCQl0aGlzLmV4cGFuZEJ5UG9pbnQoIF92ZWN0b3IkYS5mcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGkgKSApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tUG9pbnRzKCBwb2ludHMgKSB7CgoJCXRoaXMubWFrZUVtcHR5KCk7CgoJCWZvciAoIGxldCBpID0gMCwgaWwgPSBwb2ludHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQl0aGlzLmV4cGFuZEJ5UG9pbnQoIHBvaW50c1sgaSBdICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldEZyb21DZW50ZXJBbmRTaXplKCBjZW50ZXIsIHNpemUgKSB7CgoJCWNvbnN0IGhhbGZTaXplID0gX3ZlY3RvciRhLmNvcHkoIHNpemUgKS5tdWx0aXBseVNjYWxhciggMC41ICk7CgoJCXRoaXMubWluLmNvcHkoIGNlbnRlciApLnN1YiggaGFsZlNpemUgKTsKCQl0aGlzLm1heC5jb3B5KCBjZW50ZXIgKS5hZGQoIGhhbGZTaXplICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tT2JqZWN0KCBvYmplY3QsIHByZWNpc2UgPSBmYWxzZSApIHsKCgkJdGhpcy5tYWtlRW1wdHkoKTsKCgkJcmV0dXJuIHRoaXMuZXhwYW5kQnlPYmplY3QoIG9iamVjdCwgcHJlY2lzZSApOwoKCX0KCgljbG9uZSgpIHsKCgkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCX0KCgljb3B5KCBib3ggKSB7CgoJCXRoaXMubWluLmNvcHkoIGJveC5taW4gKTsKCQl0aGlzLm1heC5jb3B5KCBib3gubWF4ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltYWtlRW1wdHkoKSB7CgoJCXRoaXMubWluLnggPSB0aGlzLm1pbi55ID0gdGhpcy5taW4ueiA9ICsgSW5maW5pdHk7CgkJdGhpcy5tYXgueCA9IHRoaXMubWF4LnkgPSB0aGlzLm1heC56ID0gLSBJbmZpbml0eTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWlzRW1wdHkoKSB7CgoJCS8vIHRoaXMgaXMgYSBtb3JlIHJvYnVzdCBjaGVjayBmb3IgZW1wdHkgdGhhbiAoIHZvbHVtZSA8PSAwICkgYmVjYXVzZSB2b2x1bWUgY2FuIGdldCBwb3NpdGl2ZSB3aXRoIHR3byBuZWdhdGl2ZSBheGVzCgoJCXJldHVybiAoIHRoaXMubWF4LnggPCB0aGlzLm1pbi54ICkgfHwgKCB0aGlzLm1heC55IDwgdGhpcy5taW4ueSApIHx8ICggdGhpcy5tYXgueiA8IHRoaXMubWluLnogKTsKCgl9CgoJZ2V0Q2VudGVyKCB0YXJnZXQgKSB7CgoJCXJldHVybiB0aGlzLmlzRW1wdHkoKSA/IHRhcmdldC5zZXQoIDAsIDAsIDAgKSA6IHRhcmdldC5hZGRWZWN0b3JzKCB0aGlzLm1pbiwgdGhpcy5tYXggKS5tdWx0aXBseVNjYWxhciggMC41ICk7CgoJfQoKCWdldFNpemUoIHRhcmdldCApIHsKCgkJcmV0dXJuIHRoaXMuaXNFbXB0eSgpID8gdGFyZ2V0LnNldCggMCwgMCwgMCApIDogdGFyZ2V0LnN1YlZlY3RvcnMoIHRoaXMubWF4LCB0aGlzLm1pbiApOwoKCX0KCglleHBhbmRCeVBvaW50KCBwb2ludCApIHsKCgkJdGhpcy5taW4ubWluKCBwb2ludCApOwoJCXRoaXMubWF4Lm1heCggcG9pbnQgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWV4cGFuZEJ5VmVjdG9yKCB2ZWN0b3IgKSB7CgoJCXRoaXMubWluLnN1YiggdmVjdG9yICk7CgkJdGhpcy5tYXguYWRkKCB2ZWN0b3IgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWV4cGFuZEJ5U2NhbGFyKCBzY2FsYXIgKSB7CgoJCXRoaXMubWluLmFkZFNjYWxhciggLSBzY2FsYXIgKTsKCQl0aGlzLm1heC5hZGRTY2FsYXIoIHNjYWxhciApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZXhwYW5kQnlPYmplY3QoIG9iamVjdCwgcHJlY2lzZSA9IGZhbHNlICkgewoKCQkvLyBDb21wdXRlcyB0aGUgd29ybGQtYXhpcy1hbGlnbmVkIGJvdW5kaW5nIGJveCBvZiBhbiBvYmplY3QgKGluY2x1ZGluZyBpdHMgY2hpbGRyZW4pLAoJCS8vIGFjY291bnRpbmcgZm9yIGJvdGggdGhlIG9iamVjdCdzLCBhbmQgY2hpbGRyZW4ncywgd29ybGQgdHJhbnNmb3JtcwoKCQlvYmplY3QudXBkYXRlV29ybGRNYXRyaXgoIGZhbHNlLCBmYWxzZSApOwoKCQlpZiAoIG9iamVjdC5ib3VuZGluZ0JveCAhPT0gdW5kZWZpbmVkICkgewoKCQkJaWYgKCBvYmplY3QuYm91bmRpbmdCb3ggPT09IG51bGwgKSB7CgoJCQkJb2JqZWN0LmNvbXB1dGVCb3VuZGluZ0JveCgpOwoKCQkJfQoKCQkJX2JveCQzLmNvcHkoIG9iamVjdC5ib3VuZGluZ0JveCApOwoJCQlfYm94JDMuYXBwbHlNYXRyaXg0KCBvYmplY3QubWF0cml4V29ybGQgKTsKCgkJCXRoaXMudW5pb24oIF9ib3gkMyApOwoKCQl9IGVsc2UgewoKCQkJY29uc3QgZ2VvbWV0cnkgPSBvYmplY3QuZ2VvbWV0cnk7CgoJCQlpZiAoIGdlb21ldHJ5ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJaWYgKCBwcmVjaXNlICYmIGdlb21ldHJ5LmF0dHJpYnV0ZXMgIT09IHVuZGVmaW5lZCAmJiBnZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNvbnN0IHBvc2l0aW9uID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBwb3NpdGlvbi5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCQlfdmVjdG9yJGEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIGkgKS5hcHBseU1hdHJpeDQoIG9iamVjdC5tYXRyaXhXb3JsZCApOwoJCQkJCQl0aGlzLmV4cGFuZEJ5UG9pbnQoIF92ZWN0b3IkYSApOwoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJaWYgKCBnZW9tZXRyeS5ib3VuZGluZ0JveCA9PT0gbnVsbCApIHsKCgkJCQkJCWdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ0JveCgpOwoKCQkJCQl9CgoJCQkJCV9ib3gkMy5jb3B5KCBnZW9tZXRyeS5ib3VuZGluZ0JveCApOwoJCQkJCV9ib3gkMy5hcHBseU1hdHJpeDQoIG9iamVjdC5tYXRyaXhXb3JsZCApOwoKCQkJCQl0aGlzLnVuaW9uKCBfYm94JDMgKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJY29uc3QgY2hpbGRyZW4gPSBvYmplY3QuY2hpbGRyZW47CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQl0aGlzLmV4cGFuZEJ5T2JqZWN0KCBjaGlsZHJlblsgaSBdLCBwcmVjaXNlICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvbnRhaW5zUG9pbnQoIHBvaW50ICkgewoKCQlyZXR1cm4gcG9pbnQueCA8IHRoaXMubWluLnggfHwgcG9pbnQueCA+IHRoaXMubWF4LnggfHwKCQkJcG9pbnQueSA8IHRoaXMubWluLnkgfHwgcG9pbnQueSA+IHRoaXMubWF4LnkgfHwKCQkJcG9pbnQueiA8IHRoaXMubWluLnogfHwgcG9pbnQueiA+IHRoaXMubWF4LnogPyBmYWxzZSA6IHRydWU7CgoJfQoKCWNvbnRhaW5zQm94KCBib3ggKSB7CgoJCXJldHVybiB0aGlzLm1pbi54IDw9IGJveC5taW4ueCAmJiBib3gubWF4LnggPD0gdGhpcy5tYXgueCAmJgoJCQl0aGlzLm1pbi55IDw9IGJveC5taW4ueSAmJiBib3gubWF4LnkgPD0gdGhpcy5tYXgueSAmJgoJCQl0aGlzLm1pbi56IDw9IGJveC5taW4ueiAmJiBib3gubWF4LnogPD0gdGhpcy5tYXguejsKCgl9CgoJZ2V0UGFyYW1ldGVyKCBwb2ludCwgdGFyZ2V0ICkgewoKCQkvLyBUaGlzIGNhbiBwb3RlbnRpYWxseSBoYXZlIGEgZGl2aWRlIGJ5IHplcm8gaWYgdGhlIGJveAoJCS8vIGhhcyBhIHNpemUgZGltZW5zaW9uIG9mIDAuCgoJCXJldHVybiB0YXJnZXQuc2V0KAoJCQkoIHBvaW50LnggLSB0aGlzLm1pbi54ICkgLyAoIHRoaXMubWF4LnggLSB0aGlzLm1pbi54ICksCgkJCSggcG9pbnQueSAtIHRoaXMubWluLnkgKSAvICggdGhpcy5tYXgueSAtIHRoaXMubWluLnkgKSwKCQkJKCBwb2ludC56IC0gdGhpcy5taW4ueiApIC8gKCB0aGlzLm1heC56IC0gdGhpcy5taW4ueiApCgkJKTsKCgl9CgoJaW50ZXJzZWN0c0JveCggYm94ICkgewoKCQkvLyB1c2luZyA2IHNwbGl0dGluZyBwbGFuZXMgdG8gcnVsZSBvdXQgaW50ZXJzZWN0aW9ucy4KCQlyZXR1cm4gYm94Lm1heC54IDwgdGhpcy5taW4ueCB8fCBib3gubWluLnggPiB0aGlzLm1heC54IHx8CgkJCWJveC5tYXgueSA8IHRoaXMubWluLnkgfHwgYm94Lm1pbi55ID4gdGhpcy5tYXgueSB8fAoJCQlib3gubWF4LnogPCB0aGlzLm1pbi56IHx8IGJveC5taW4ueiA+IHRoaXMubWF4LnogPyBmYWxzZSA6IHRydWU7CgoJfQoKCWludGVyc2VjdHNTcGhlcmUoIHNwaGVyZSApIHsKCgkJLy8gRmluZCB0aGUgcG9pbnQgb24gdGhlIEFBQkIgY2xvc2VzdCB0byB0aGUgc3BoZXJlIGNlbnRlci4KCQl0aGlzLmNsYW1wUG9pbnQoIHNwaGVyZS5jZW50ZXIsIF92ZWN0b3IkYSApOwoKCQkvLyBJZiB0aGF0IHBvaW50IGlzIGluc2lkZSB0aGUgc3BoZXJlLCB0aGUgQUFCQiBhbmQgc3BoZXJlIGludGVyc2VjdC4KCQlyZXR1cm4gX3ZlY3RvciRhLmRpc3RhbmNlVG9TcXVhcmVkKCBzcGhlcmUuY2VudGVyICkgPD0gKCBzcGhlcmUucmFkaXVzICogc3BoZXJlLnJhZGl1cyApOwoKCX0KCglpbnRlcnNlY3RzUGxhbmUoIHBsYW5lICkgewoKCQkvLyBXZSBjb21wdXRlIHRoZSBtaW5pbXVtIGFuZCBtYXhpbXVtIGRvdCBwcm9kdWN0IHZhbHVlcy4gSWYgdGhvc2UgdmFsdWVzCgkJLy8gYXJlIG9uIHRoZSBzYW1lIHNpZGUgKGJhY2sgb3IgZnJvbnQpIG9mIHRoZSBwbGFuZSwgdGhlbiB0aGVyZSBpcyBubyBpbnRlcnNlY3Rpb24uCgoJCWxldCBtaW4sIG1heDsKCgkJaWYgKCBwbGFuZS5ub3JtYWwueCA+IDAgKSB7CgoJCQltaW4gPSBwbGFuZS5ub3JtYWwueCAqIHRoaXMubWluLng7CgkJCW1heCA9IHBsYW5lLm5vcm1hbC54ICogdGhpcy5tYXgueDsKCgkJfSBlbHNlIHsKCgkJCW1pbiA9IHBsYW5lLm5vcm1hbC54ICogdGhpcy5tYXgueDsKCQkJbWF4ID0gcGxhbmUubm9ybWFsLnggKiB0aGlzLm1pbi54OwoKCQl9CgoJCWlmICggcGxhbmUubm9ybWFsLnkgPiAwICkgewoKCQkJbWluICs9IHBsYW5lLm5vcm1hbC55ICogdGhpcy5taW4ueTsKCQkJbWF4ICs9IHBsYW5lLm5vcm1hbC55ICogdGhpcy5tYXgueTsKCgkJfSBlbHNlIHsKCgkJCW1pbiArPSBwbGFuZS5ub3JtYWwueSAqIHRoaXMubWF4Lnk7CgkJCW1heCArPSBwbGFuZS5ub3JtYWwueSAqIHRoaXMubWluLnk7CgoJCX0KCgkJaWYgKCBwbGFuZS5ub3JtYWwueiA+IDAgKSB7CgoJCQltaW4gKz0gcGxhbmUubm9ybWFsLnogKiB0aGlzLm1pbi56OwoJCQltYXggKz0gcGxhbmUubm9ybWFsLnogKiB0aGlzLm1heC56OwoKCQl9IGVsc2UgewoKCQkJbWluICs9IHBsYW5lLm5vcm1hbC56ICogdGhpcy5tYXguejsKCQkJbWF4ICs9IHBsYW5lLm5vcm1hbC56ICogdGhpcy5taW4uejsKCgkJfQoKCQlyZXR1cm4gKCBtaW4gPD0gLSBwbGFuZS5jb25zdGFudCAmJiBtYXggPj0gLSBwbGFuZS5jb25zdGFudCApOwoKCX0KCglpbnRlcnNlY3RzVHJpYW5nbGUoIHRyaWFuZ2xlICkgewoKCQlpZiAoIHRoaXMuaXNFbXB0eSgpICkgewoKCQkJcmV0dXJuIGZhbHNlOwoKCQl9CgoJCS8vIGNvbXB1dGUgYm94IGNlbnRlciBhbmQgZXh0ZW50cwoJCXRoaXMuZ2V0Q2VudGVyKCBfY2VudGVyICk7CgkJX2V4dGVudHMuc3ViVmVjdG9ycyggdGhpcy5tYXgsIF9jZW50ZXIgKTsKCgkJLy8gdHJhbnNsYXRlIHRyaWFuZ2xlIHRvIGFhYmIgb3JpZ2luCgkJX3YwJDIuc3ViVmVjdG9ycyggdHJpYW5nbGUuYSwgX2NlbnRlciApOwoJCV92MSQ3LnN1YlZlY3RvcnMoIHRyaWFuZ2xlLmIsIF9jZW50ZXIgKTsKCQlfdjIkNC5zdWJWZWN0b3JzKCB0cmlhbmdsZS5jLCBfY2VudGVyICk7CgoJCS8vIGNvbXB1dGUgZWRnZSB2ZWN0b3JzIGZvciB0cmlhbmdsZQoJCV9mMC5zdWJWZWN0b3JzKCBfdjEkNywgX3YwJDIgKTsKCQlfZjEuc3ViVmVjdG9ycyggX3YyJDQsIF92MSQ3ICk7CgkJX2YyLnN1YlZlY3RvcnMoIF92MCQyLCBfdjIkNCApOwoKCQkvLyB0ZXN0IGFnYWluc3QgYXhlcyB0aGF0IGFyZSBnaXZlbiBieSBjcm9zcyBwcm9kdWN0IGNvbWJpbmF0aW9ucyBvZiB0aGUgZWRnZXMgb2YgdGhlIHRyaWFuZ2xlIGFuZCB0aGUgZWRnZXMgb2YgdGhlIGFhYmIKCQkvLyBtYWtlIGFuIGF4aXMgdGVzdGluZyBvZiBlYWNoIG9mIHRoZSAzIHNpZGVzIG9mIHRoZSBhYWJiIGFnYWluc3QgZWFjaCBvZiB0aGUgMyBzaWRlcyBvZiB0aGUgdHJpYW5nbGUgPSA5IGF4aXMgb2Ygc2VwYXJhdGlvbgoJCS8vIGF4aXNfaWogPSB1X2kgeCBmX2ogKHUwLCB1MSwgdTIgPSBmYWNlIG5vcm1hbHMgb2YgYWFiYiA9IHgseSx6IGF4ZXMgdmVjdG9ycyBzaW5jZSBhYWJiIGlzIGF4aXMgYWxpZ25lZCkKCQlsZXQgYXhlcyA9IFsKCQkJMCwgLSBfZjAueiwgX2YwLnksIDAsIC0gX2YxLnosIF9mMS55LCAwLCAtIF9mMi56LCBfZjIueSwKCQkJX2YwLnosIDAsIC0gX2YwLngsIF9mMS56LCAwLCAtIF9mMS54LCBfZjIueiwgMCwgLSBfZjIueCwKCQkJLSBfZjAueSwgX2YwLngsIDAsIC0gX2YxLnksIF9mMS54LCAwLCAtIF9mMi55LCBfZjIueCwgMAoJCV07CgkJaWYgKCAhIHNhdEZvckF4ZXMoIGF4ZXMsIF92MCQyLCBfdjEkNywgX3YyJDQsIF9leHRlbnRzICkgKSB7CgoJCQlyZXR1cm4gZmFsc2U7CgoJCX0KCgkJLy8gdGVzdCAzIGZhY2Ugbm9ybWFscyBmcm9tIHRoZSBhYWJiCgkJYXhlcyA9IFsgMSwgMCwgMCwgMCwgMSwgMCwgMCwgMCwgMSBdOwoJCWlmICggISBzYXRGb3JBeGVzKCBheGVzLCBfdjAkMiwgX3YxJDcsIF92MiQ0LCBfZXh0ZW50cyApICkgewoKCQkJcmV0dXJuIGZhbHNlOwoKCQl9CgoJCS8vIGZpbmFsbHkgdGVzdGluZyB0aGUgZmFjZSBub3JtYWwgb2YgdGhlIHRyaWFuZ2xlCgkJLy8gdXNlIGFscmVhZHkgZXhpc3RpbmcgdHJpYW5nbGUgZWRnZSB2ZWN0b3JzIGhlcmUKCQlfdHJpYW5nbGVOb3JtYWwuY3Jvc3NWZWN0b3JzKCBfZjAsIF9mMSApOwoJCWF4ZXMgPSBbIF90cmlhbmdsZU5vcm1hbC54LCBfdHJpYW5nbGVOb3JtYWwueSwgX3RyaWFuZ2xlTm9ybWFsLnogXTsKCgkJcmV0dXJuIHNhdEZvckF4ZXMoIGF4ZXMsIF92MCQyLCBfdjEkNywgX3YyJDQsIF9leHRlbnRzICk7CgoJfQoKCWNsYW1wUG9pbnQoIHBvaW50LCB0YXJnZXQgKSB7CgoJCXJldHVybiB0YXJnZXQuY29weSggcG9pbnQgKS5jbGFtcCggdGhpcy5taW4sIHRoaXMubWF4ICk7CgoJfQoKCWRpc3RhbmNlVG9Qb2ludCggcG9pbnQgKSB7CgoJCXJldHVybiB0aGlzLmNsYW1wUG9pbnQoIHBvaW50LCBfdmVjdG9yJGEgKS5kaXN0YW5jZVRvKCBwb2ludCApOwoKCX0KCglnZXRCb3VuZGluZ1NwaGVyZSggdGFyZ2V0ICkgewoKCQlpZiAoIHRoaXMuaXNFbXB0eSgpICkgewoKCQkJdGFyZ2V0Lm1ha2VFbXB0eSgpOwoKCQl9IGVsc2UgewoKCQkJdGhpcy5nZXRDZW50ZXIoIHRhcmdldC5jZW50ZXIgKTsKCgkJCXRhcmdldC5yYWRpdXMgPSB0aGlzLmdldFNpemUoIF92ZWN0b3IkYSApLmxlbmd0aCgpICogMC41OwoKCQl9CgoJCXJldHVybiB0YXJnZXQ7CgoJfQoKCWludGVyc2VjdCggYm94ICkgewoKCQl0aGlzLm1pbi5tYXgoIGJveC5taW4gKTsKCQl0aGlzLm1heC5taW4oIGJveC5tYXggKTsKCgkJLy8gZW5zdXJlIHRoYXQgaWYgdGhlcmUgaXMgbm8gb3ZlcmxhcCwgdGhlIHJlc3VsdCBpcyBmdWxseSBlbXB0eSwgbm90IHNsaWdodGx5IGVtcHR5IHdpdGggbm9uLWluZi8raW5mIHZhbHVlcyB0aGF0IHdpbGwgY2F1c2Ugc3Vic2VxdWVuY2UgaW50ZXJzZWN0cyB0byBlcnJvbmVvdXNseSByZXR1cm4gdmFsaWQgdmFsdWVzLgoJCWlmICggdGhpcy5pc0VtcHR5KCkgKSB0aGlzLm1ha2VFbXB0eSgpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdW5pb24oIGJveCApIHsKCgkJdGhpcy5taW4ubWluKCBib3gubWluICk7CgkJdGhpcy5tYXgubWF4KCBib3gubWF4ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglhcHBseU1hdHJpeDQoIG1hdHJpeCApIHsKCgkJLy8gdHJhbnNmb3JtIG9mIGVtcHR5IGJveCBpcyBhbiBlbXB0eSBib3guCgkJaWYgKCB0aGlzLmlzRW1wdHkoKSApIHJldHVybiB0aGlzOwoKCQkvLyBOT1RFOiBJIGFtIHVzaW5nIGEgYmluYXJ5IHBhdHRlcm4gdG8gc3BlY2lmeSBhbGwgMl4zIGNvbWJpbmF0aW9ucyBiZWxvdwoJCV9wb2ludHNbIDAgXS5zZXQoIHRoaXMubWluLngsIHRoaXMubWluLnksIHRoaXMubWluLnogKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOyAvLyAwMDAKCQlfcG9pbnRzWyAxIF0uc2V0KCB0aGlzLm1pbi54LCB0aGlzLm1pbi55LCB0aGlzLm1heC56ICkuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsgLy8gMDAxCgkJX3BvaW50c1sgMiBdLnNldCggdGhpcy5taW4ueCwgdGhpcy5tYXgueSwgdGhpcy5taW4ueiApLmFwcGx5TWF0cml4NCggbWF0cml4ICk7IC8vIDAxMAoJCV9wb2ludHNbIDMgXS5zZXQoIHRoaXMubWluLngsIHRoaXMubWF4LnksIHRoaXMubWF4LnogKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOyAvLyAwMTEKCQlfcG9pbnRzWyA0IF0uc2V0KCB0aGlzLm1heC54LCB0aGlzLm1pbi55LCB0aGlzLm1pbi56ICkuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsgLy8gMTAwCgkJX3BvaW50c1sgNSBdLnNldCggdGhpcy5tYXgueCwgdGhpcy5taW4ueSwgdGhpcy5tYXgueiApLmFwcGx5TWF0cml4NCggbWF0cml4ICk7IC8vIDEwMQoJCV9wb2ludHNbIDYgXS5zZXQoIHRoaXMubWF4LngsIHRoaXMubWF4LnksIHRoaXMubWluLnogKS5hcHBseU1hdHJpeDQoIG1hdHJpeCApOyAvLyAxMTAKCQlfcG9pbnRzWyA3IF0uc2V0KCB0aGlzLm1heC54LCB0aGlzLm1heC55LCB0aGlzLm1heC56ICkuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsgLy8gMTExCgoJCXRoaXMuc2V0RnJvbVBvaW50cyggX3BvaW50cyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdHJhbnNsYXRlKCBvZmZzZXQgKSB7CgoJCXRoaXMubWluLmFkZCggb2Zmc2V0ICk7CgkJdGhpcy5tYXguYWRkKCBvZmZzZXQgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWVxdWFscyggYm94ICkgewoKCQlyZXR1cm4gYm94Lm1pbi5lcXVhbHMoIHRoaXMubWluICkgJiYgYm94Lm1heC5lcXVhbHMoIHRoaXMubWF4ICk7CgoJfQoKfQoKY29uc3QgX3BvaW50cyA9IFsKCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKSwKCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKSwKCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKSwKCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKSwKCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKSwKCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKSwKCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKSwKCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKQpdOwoKY29uc3QgX3ZlY3RvciRhID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKY29uc3QgX2JveCQzID0gLypAX19QVVJFX18qLyBuZXcgQm94MygpOwoKLy8gdHJpYW5nbGUgY2VudGVyZWQgdmVydGljZXMKCmNvbnN0IF92MCQyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfdjEkNyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3YyJDQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgovLyB0cmlhbmdsZSBlZGdlIHZlY3RvcnMKCmNvbnN0IF9mMCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX2YxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfZjIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgpjb25zdCBfY2VudGVyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfZXh0ZW50cyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3RyaWFuZ2xlTm9ybWFsID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfdGVzdEF4aXMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgpmdW5jdGlvbiBzYXRGb3JBeGVzKCBheGVzLCB2MCwgdjEsIHYyLCBleHRlbnRzICkgewoKCWZvciAoIGxldCBpID0gMCwgaiA9IGF4ZXMubGVuZ3RoIC0gMzsgaSA8PSBqOyBpICs9IDMgKSB7CgoJCV90ZXN0QXhpcy5mcm9tQXJyYXkoIGF4ZXMsIGkgKTsKCQkvLyBwcm9qZWN0IHRoZSBhYWJiIG9udG8gdGhlIHNlcGFyYXRpbmcgYXhpcwoJCWNvbnN0IHIgPSBleHRlbnRzLnggKiBNYXRoLmFicyggX3Rlc3RBeGlzLnggKSArIGV4dGVudHMueSAqIE1hdGguYWJzKCBfdGVzdEF4aXMueSApICsgZXh0ZW50cy56ICogTWF0aC5hYnMoIF90ZXN0QXhpcy56ICk7CgkJLy8gcHJvamVjdCBhbGwgMyB2ZXJ0aWNlcyBvZiB0aGUgdHJpYW5nbGUgb250byB0aGUgc2VwYXJhdGluZyBheGlzCgkJY29uc3QgcDAgPSB2MC5kb3QoIF90ZXN0QXhpcyApOwoJCWNvbnN0IHAxID0gdjEuZG90KCBfdGVzdEF4aXMgKTsKCQljb25zdCBwMiA9IHYyLmRvdCggX3Rlc3RBeGlzICk7CgkJLy8gYWN0dWFsIHRlc3QsIGJhc2ljYWxseSBzZWUgaWYgZWl0aGVyIG9mIHRoZSBtb3N0IGV4dHJlbWUgb2YgdGhlIHRyaWFuZ2xlIHBvaW50cyBpbnRlcnNlY3RzIHIKCQlpZiAoIE1hdGgubWF4KCAtIE1hdGgubWF4KCBwMCwgcDEsIHAyICksIE1hdGgubWluKCBwMCwgcDEsIHAyICkgKSA+IHIgKSB7CgoJCQkvLyBwb2ludHMgb2YgdGhlIHByb2plY3RlZCB0cmlhbmdsZSBhcmUgb3V0c2lkZSB0aGUgcHJvamVjdGVkIGhhbGYtbGVuZ3RoIG9mIHRoZSBhYWJiCgkJCS8vIHRoZSBheGlzIGlzIHNlcGFyYXRpbmcgYW5kIHdlIGNhbiBleGl0CgkJCXJldHVybiBmYWxzZTsKCgkJfQoKCX0KCglyZXR1cm4gdHJ1ZTsKCn0KCmNvbnN0IF9ib3gkMiA9IC8qQF9fUFVSRV9fKi8gbmV3IEJveDMoKTsKY29uc3QgX3YxJDYgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF92MiQzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKY2xhc3MgU3BoZXJlIHsKCgljb25zdHJ1Y3RvciggY2VudGVyID0gbmV3IFZlY3RvcjMoKSwgcmFkaXVzID0gLSAxICkgewoKCQl0aGlzLmNlbnRlciA9IGNlbnRlcjsKCQl0aGlzLnJhZGl1cyA9IHJhZGl1czsKCgl9CgoJc2V0KCBjZW50ZXIsIHJhZGl1cyApIHsKCgkJdGhpcy5jZW50ZXIuY29weSggY2VudGVyICk7CgkJdGhpcy5yYWRpdXMgPSByYWRpdXM7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tUG9pbnRzKCBwb2ludHMsIG9wdGlvbmFsQ2VudGVyICkgewoKCQljb25zdCBjZW50ZXIgPSB0aGlzLmNlbnRlcjsKCgkJaWYgKCBvcHRpb25hbENlbnRlciAhPT0gdW5kZWZpbmVkICkgewoKCQkJY2VudGVyLmNvcHkoIG9wdGlvbmFsQ2VudGVyICk7CgoJCX0gZWxzZSB7CgoJCQlfYm94JDIuc2V0RnJvbVBvaW50cyggcG9pbnRzICkuZ2V0Q2VudGVyKCBjZW50ZXIgKTsKCgkJfQoKCQlsZXQgbWF4UmFkaXVzU3EgPSAwOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gcG9pbnRzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJbWF4UmFkaXVzU3EgPSBNYXRoLm1heCggbWF4UmFkaXVzU3EsIGNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCggcG9pbnRzWyBpIF0gKSApOwoKCQl9CgoJCXRoaXMucmFkaXVzID0gTWF0aC5zcXJ0KCBtYXhSYWRpdXNTcSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY29weSggc3BoZXJlICkgewoKCQl0aGlzLmNlbnRlci5jb3B5KCBzcGhlcmUuY2VudGVyICk7CgkJdGhpcy5yYWRpdXMgPSBzcGhlcmUucmFkaXVzOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJaXNFbXB0eSgpIHsKCgkJcmV0dXJuICggdGhpcy5yYWRpdXMgPCAwICk7CgoJfQoKCW1ha2VFbXB0eSgpIHsKCgkJdGhpcy5jZW50ZXIuc2V0KCAwLCAwLCAwICk7CgkJdGhpcy5yYWRpdXMgPSAtIDE7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljb250YWluc1BvaW50KCBwb2ludCApIHsKCgkJcmV0dXJuICggcG9pbnQuZGlzdGFuY2VUb1NxdWFyZWQoIHRoaXMuY2VudGVyICkgPD0gKCB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzICkgKTsKCgl9CgoJZGlzdGFuY2VUb1BvaW50KCBwb2ludCApIHsKCgkJcmV0dXJuICggcG9pbnQuZGlzdGFuY2VUbyggdGhpcy5jZW50ZXIgKSAtIHRoaXMucmFkaXVzICk7CgoJfQoKCWludGVyc2VjdHNTcGhlcmUoIHNwaGVyZSApIHsKCgkJY29uc3QgcmFkaXVzU3VtID0gdGhpcy5yYWRpdXMgKyBzcGhlcmUucmFkaXVzOwoKCQlyZXR1cm4gc3BoZXJlLmNlbnRlci5kaXN0YW5jZVRvU3F1YXJlZCggdGhpcy5jZW50ZXIgKSA8PSAoIHJhZGl1c1N1bSAqIHJhZGl1c1N1bSApOwoKCX0KCglpbnRlcnNlY3RzQm94KCBib3ggKSB7CgoJCXJldHVybiBib3guaW50ZXJzZWN0c1NwaGVyZSggdGhpcyApOwoKCX0KCglpbnRlcnNlY3RzUGxhbmUoIHBsYW5lICkgewoKCQlyZXR1cm4gTWF0aC5hYnMoIHBsYW5lLmRpc3RhbmNlVG9Qb2ludCggdGhpcy5jZW50ZXIgKSApIDw9IHRoaXMucmFkaXVzOwoKCX0KCgljbGFtcFBvaW50KCBwb2ludCwgdGFyZ2V0ICkgewoKCQljb25zdCBkZWx0YUxlbmd0aFNxID0gdGhpcy5jZW50ZXIuZGlzdGFuY2VUb1NxdWFyZWQoIHBvaW50ICk7CgoJCXRhcmdldC5jb3B5KCBwb2ludCApOwoKCQlpZiAoIGRlbHRhTGVuZ3RoU3EgPiAoIHRoaXMucmFkaXVzICogdGhpcy5yYWRpdXMgKSApIHsKCgkJCXRhcmdldC5zdWIoIHRoaXMuY2VudGVyICkubm9ybWFsaXplKCk7CgkJCXRhcmdldC5tdWx0aXBseVNjYWxhciggdGhpcy5yYWRpdXMgKS5hZGQoIHRoaXMuY2VudGVyICk7CgoJCX0KCgkJcmV0dXJuIHRhcmdldDsKCgl9CgoJZ2V0Qm91bmRpbmdCb3goIHRhcmdldCApIHsKCgkJaWYgKCB0aGlzLmlzRW1wdHkoKSApIHsKCgkJCS8vIEVtcHR5IHNwaGVyZSBwcm9kdWNlcyBlbXB0eSBib3VuZGluZyBib3gKCQkJdGFyZ2V0Lm1ha2VFbXB0eSgpOwoJCQlyZXR1cm4gdGFyZ2V0OwoKCQl9CgoJCXRhcmdldC5zZXQoIHRoaXMuY2VudGVyLCB0aGlzLmNlbnRlciApOwoJCXRhcmdldC5leHBhbmRCeVNjYWxhciggdGhpcy5yYWRpdXMgKTsKCgkJcmV0dXJuIHRhcmdldDsKCgl9CgoJYXBwbHlNYXRyaXg0KCBtYXRyaXggKSB7CgoJCXRoaXMuY2VudGVyLmFwcGx5TWF0cml4NCggbWF0cml4ICk7CgkJdGhpcy5yYWRpdXMgPSB0aGlzLnJhZGl1cyAqIG1hdHJpeC5nZXRNYXhTY2FsZU9uQXhpcygpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdHJhbnNsYXRlKCBvZmZzZXQgKSB7CgoJCXRoaXMuY2VudGVyLmFkZCggb2Zmc2V0ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglleHBhbmRCeVBvaW50KCBwb2ludCApIHsKCgkJaWYgKCB0aGlzLmlzRW1wdHkoKSApIHsKCgkJCXRoaXMuY2VudGVyLmNvcHkoIHBvaW50ICk7CgoJCQl0aGlzLnJhZGl1cyA9IDA7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQlfdjEkNi5zdWJWZWN0b3JzKCBwb2ludCwgdGhpcy5jZW50ZXIgKTsKCgkJY29uc3QgbGVuZ3RoU3EgPSBfdjEkNi5sZW5ndGhTcSgpOwoKCQlpZiAoIGxlbmd0aFNxID4gKCB0aGlzLnJhZGl1cyAqIHRoaXMucmFkaXVzICkgKSB7CgoJCQkvLyBjYWxjdWxhdGUgdGhlIG1pbmltYWwgc3BoZXJlCgoJCQljb25zdCBsZW5ndGggPSBNYXRoLnNxcnQoIGxlbmd0aFNxICk7CgoJCQljb25zdCBkZWx0YSA9ICggbGVuZ3RoIC0gdGhpcy5yYWRpdXMgKSAqIDAuNTsKCgkJCXRoaXMuY2VudGVyLmFkZFNjYWxlZFZlY3RvciggX3YxJDYsIGRlbHRhIC8gbGVuZ3RoICk7CgoJCQl0aGlzLnJhZGl1cyArPSBkZWx0YTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdW5pb24oIHNwaGVyZSApIHsKCgkJaWYgKCBzcGhlcmUuaXNFbXB0eSgpICkgewoKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJaWYgKCB0aGlzLmlzRW1wdHkoKSApIHsKCgkJCXRoaXMuY29weSggc3BoZXJlICk7CgoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQlpZiAoIHRoaXMuY2VudGVyLmVxdWFscyggc3BoZXJlLmNlbnRlciApID09PSB0cnVlICkgewoKCQkJIHRoaXMucmFkaXVzID0gTWF0aC5tYXgoIHRoaXMucmFkaXVzLCBzcGhlcmUucmFkaXVzICk7CgoJCX0gZWxzZSB7CgoJCQlfdjIkMy5zdWJWZWN0b3JzKCBzcGhlcmUuY2VudGVyLCB0aGlzLmNlbnRlciApLnNldExlbmd0aCggc3BoZXJlLnJhZGl1cyApOwoKCQkJdGhpcy5leHBhbmRCeVBvaW50KCBfdjEkNi5jb3B5KCBzcGhlcmUuY2VudGVyICkuYWRkKCBfdjIkMyApICk7CgoJCQl0aGlzLmV4cGFuZEJ5UG9pbnQoIF92MSQ2LmNvcHkoIHNwaGVyZS5jZW50ZXIgKS5zdWIoIF92MiQzICkgKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZXF1YWxzKCBzcGhlcmUgKSB7CgoJCXJldHVybiBzcGhlcmUuY2VudGVyLmVxdWFscyggdGhpcy5jZW50ZXIgKSAmJiAoIHNwaGVyZS5yYWRpdXMgPT09IHRoaXMucmFkaXVzICk7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJfQoKfQoKY29uc3QgX3ZlY3RvciQ5ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfc2VnQ2VudGVyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfc2VnRGlyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfZGlmZiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNvbnN0IF9lZGdlMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX2VkZ2UyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfbm9ybWFsJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgpjbGFzcyBSYXkgewoKCWNvbnN0cnVjdG9yKCBvcmlnaW4gPSBuZXcgVmVjdG9yMygpLCBkaXJlY3Rpb24gPSBuZXcgVmVjdG9yMyggMCwgMCwgLSAxICkgKSB7CgoJCXRoaXMub3JpZ2luID0gb3JpZ2luOwoJCXRoaXMuZGlyZWN0aW9uID0gZGlyZWN0aW9uOwoKCX0KCglzZXQoIG9yaWdpbiwgZGlyZWN0aW9uICkgewoKCQl0aGlzLm9yaWdpbi5jb3B5KCBvcmlnaW4gKTsKCQl0aGlzLmRpcmVjdGlvbi5jb3B5KCBkaXJlY3Rpb24gKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvcHkoIHJheSApIHsKCgkJdGhpcy5vcmlnaW4uY29weSggcmF5Lm9yaWdpbiApOwoJCXRoaXMuZGlyZWN0aW9uLmNvcHkoIHJheS5kaXJlY3Rpb24gKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWF0KCB0LCB0YXJnZXQgKSB7CgoJCXJldHVybiB0YXJnZXQuY29weSggdGhpcy5vcmlnaW4gKS5hZGRTY2FsZWRWZWN0b3IoIHRoaXMuZGlyZWN0aW9uLCB0ICk7CgoJfQoKCWxvb2tBdCggdiApIHsKCgkJdGhpcy5kaXJlY3Rpb24uY29weSggdiApLnN1YiggdGhpcy5vcmlnaW4gKS5ub3JtYWxpemUoKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXJlY2FzdCggdCApIHsKCgkJdGhpcy5vcmlnaW4uY29weSggdGhpcy5hdCggdCwgX3ZlY3RvciQ5ICkgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNsb3Nlc3RQb2ludFRvUG9pbnQoIHBvaW50LCB0YXJnZXQgKSB7CgoJCXRhcmdldC5zdWJWZWN0b3JzKCBwb2ludCwgdGhpcy5vcmlnaW4gKTsKCgkJY29uc3QgZGlyZWN0aW9uRGlzdGFuY2UgPSB0YXJnZXQuZG90KCB0aGlzLmRpcmVjdGlvbiApOwoKCQlpZiAoIGRpcmVjdGlvbkRpc3RhbmNlIDwgMCApIHsKCgkJCXJldHVybiB0YXJnZXQuY29weSggdGhpcy5vcmlnaW4gKTsKCgkJfQoKCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIHRoaXMub3JpZ2luICkuYWRkU2NhbGVkVmVjdG9yKCB0aGlzLmRpcmVjdGlvbiwgZGlyZWN0aW9uRGlzdGFuY2UgKTsKCgl9CgoJZGlzdGFuY2VUb1BvaW50KCBwb2ludCApIHsKCgkJcmV0dXJuIE1hdGguc3FydCggdGhpcy5kaXN0YW5jZVNxVG9Qb2ludCggcG9pbnQgKSApOwoKCX0KCglkaXN0YW5jZVNxVG9Qb2ludCggcG9pbnQgKSB7CgoJCWNvbnN0IGRpcmVjdGlvbkRpc3RhbmNlID0gX3ZlY3RvciQ5LnN1YlZlY3RvcnMoIHBvaW50LCB0aGlzLm9yaWdpbiApLmRvdCggdGhpcy5kaXJlY3Rpb24gKTsKCgkJLy8gcG9pbnQgYmVoaW5kIHRoZSByYXkKCgkJaWYgKCBkaXJlY3Rpb25EaXN0YW5jZSA8IDAgKSB7CgoJCQlyZXR1cm4gdGhpcy5vcmlnaW4uZGlzdGFuY2VUb1NxdWFyZWQoIHBvaW50ICk7CgoJCX0KCgkJX3ZlY3RvciQ5LmNvcHkoIHRoaXMub3JpZ2luICkuYWRkU2NhbGVkVmVjdG9yKCB0aGlzLmRpcmVjdGlvbiwgZGlyZWN0aW9uRGlzdGFuY2UgKTsKCgkJcmV0dXJuIF92ZWN0b3IkOS5kaXN0YW5jZVRvU3F1YXJlZCggcG9pbnQgKTsKCgl9CgoJZGlzdGFuY2VTcVRvU2VnbWVudCggdjAsIHYxLCBvcHRpb25hbFBvaW50T25SYXksIG9wdGlvbmFsUG9pbnRPblNlZ21lbnQgKSB7CgoJCS8vIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL3Btam9uaWFrL0dlb21ldHJpY1Rvb2xzL2Jsb2IvbWFzdGVyL0dURW5naW5lL0luY2x1ZGUvTWF0aGVtYXRpY3MvR3RlRGlzdFJheVNlZ21lbnQuaAoJCS8vIEl0IHJldHVybnMgdGhlIG1pbiBkaXN0YW5jZSBiZXR3ZWVuIHRoZSByYXkgYW5kIHRoZSBzZWdtZW50CgkJLy8gZGVmaW5lZCBieSB2MCBhbmQgdjEKCQkvLyBJdCBjYW4gYWxzbyBzZXQgdHdvIG9wdGlvbmFsIHRhcmdldHMgOgoJCS8vIC0gVGhlIGNsb3Nlc3QgcG9pbnQgb24gdGhlIHJheQoJCS8vIC0gVGhlIGNsb3Nlc3QgcG9pbnQgb24gdGhlIHNlZ21lbnQKCgkJX3NlZ0NlbnRlci5jb3B5KCB2MCApLmFkZCggdjEgKS5tdWx0aXBseVNjYWxhciggMC41ICk7CgkJX3NlZ0Rpci5jb3B5KCB2MSApLnN1YiggdjAgKS5ub3JtYWxpemUoKTsKCQlfZGlmZi5jb3B5KCB0aGlzLm9yaWdpbiApLnN1YiggX3NlZ0NlbnRlciApOwoKCQljb25zdCBzZWdFeHRlbnQgPSB2MC5kaXN0YW5jZVRvKCB2MSApICogMC41OwoJCWNvbnN0IGEwMSA9IC0gdGhpcy5kaXJlY3Rpb24uZG90KCBfc2VnRGlyICk7CgkJY29uc3QgYjAgPSBfZGlmZi5kb3QoIHRoaXMuZGlyZWN0aW9uICk7CgkJY29uc3QgYjEgPSAtIF9kaWZmLmRvdCggX3NlZ0RpciApOwoJCWNvbnN0IGMgPSBfZGlmZi5sZW5ndGhTcSgpOwoJCWNvbnN0IGRldCA9IE1hdGguYWJzKCAxIC0gYTAxICogYTAxICk7CgkJbGV0IHMwLCBzMSwgc3FyRGlzdCwgZXh0RGV0OwoKCQlpZiAoIGRldCA+IDAgKSB7CgoJCQkvLyBUaGUgcmF5IGFuZCBzZWdtZW50IGFyZSBub3QgcGFyYWxsZWwuCgoJCQlzMCA9IGEwMSAqIGIxIC0gYjA7CgkJCXMxID0gYTAxICogYjAgLSBiMTsKCQkJZXh0RGV0ID0gc2VnRXh0ZW50ICogZGV0OwoKCQkJaWYgKCBzMCA+PSAwICkgewoKCQkJCWlmICggczEgPj0gLSBleHREZXQgKSB7CgoJCQkJCWlmICggczEgPD0gZXh0RGV0ICkgewoKCQkJCQkJLy8gcmVnaW9uIDAKCQkJCQkJLy8gTWluaW11bSBhdCBpbnRlcmlvciBwb2ludHMgb2YgcmF5IGFuZCBzZWdtZW50LgoKCQkJCQkJY29uc3QgaW52RGV0ID0gMSAvIGRldDsKCQkJCQkJczAgKj0gaW52RGV0OwoJCQkJCQlzMSAqPSBpbnZEZXQ7CgkJCQkJCXNxckRpc3QgPSBzMCAqICggczAgKyBhMDEgKiBzMSArIDIgKiBiMCApICsgczEgKiAoIGEwMSAqIHMwICsgczEgKyAyICogYjEgKSArIGM7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQkvLyByZWdpb24gMQoKCQkJCQkJczEgPSBzZWdFeHRlbnQ7CgkJCQkJCXMwID0gTWF0aC5tYXgoIDAsIC0gKCBhMDEgKiBzMSArIGIwICkgKTsKCQkJCQkJc3FyRGlzdCA9IC0gczAgKiBzMCArIHMxICogKCBzMSArIDIgKiBiMSApICsgYzsKCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCS8vIHJlZ2lvbiA1CgoJCQkJCXMxID0gLSBzZWdFeHRlbnQ7CgkJCQkJczAgPSBNYXRoLm1heCggMCwgLSAoIGEwMSAqIHMxICsgYjAgKSApOwoJCQkJCXNxckRpc3QgPSAtIHMwICogczAgKyBzMSAqICggczEgKyAyICogYjEgKSArIGM7CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQlpZiAoIHMxIDw9IC0gZXh0RGV0ICkgewoKCQkJCQkvLyByZWdpb24gNAoKCQkJCQlzMCA9IE1hdGgubWF4KCAwLCAtICggLSBhMDEgKiBzZWdFeHRlbnQgKyBiMCApICk7CgkJCQkJczEgPSAoIHMwID4gMCApID8gLSBzZWdFeHRlbnQgOiBNYXRoLm1pbiggTWF0aC5tYXgoIC0gc2VnRXh0ZW50LCAtIGIxICksIHNlZ0V4dGVudCApOwoJCQkJCXNxckRpc3QgPSAtIHMwICogczAgKyBzMSAqICggczEgKyAyICogYjEgKSArIGM7CgoJCQkJfSBlbHNlIGlmICggczEgPD0gZXh0RGV0ICkgewoKCQkJCQkvLyByZWdpb24gMwoKCQkJCQlzMCA9IDA7CgkJCQkJczEgPSBNYXRoLm1pbiggTWF0aC5tYXgoIC0gc2VnRXh0ZW50LCAtIGIxICksIHNlZ0V4dGVudCApOwoJCQkJCXNxckRpc3QgPSBzMSAqICggczEgKyAyICogYjEgKSArIGM7CgoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gcmVnaW9uIDIKCgkJCQkJczAgPSBNYXRoLm1heCggMCwgLSAoIGEwMSAqIHNlZ0V4dGVudCArIGIwICkgKTsKCQkJCQlzMSA9ICggczAgPiAwICkgPyBzZWdFeHRlbnQgOiBNYXRoLm1pbiggTWF0aC5tYXgoIC0gc2VnRXh0ZW50LCAtIGIxICksIHNlZ0V4dGVudCApOwoJCQkJCXNxckRpc3QgPSAtIHMwICogczAgKyBzMSAqICggczEgKyAyICogYjEgKSArIGM7CgoJCQkJfQoKCQkJfQoKCQl9IGVsc2UgewoKCQkJLy8gUmF5IGFuZCBzZWdtZW50IGFyZSBwYXJhbGxlbC4KCgkJCXMxID0gKCBhMDEgPiAwICkgPyAtIHNlZ0V4dGVudCA6IHNlZ0V4dGVudDsKCQkJczAgPSBNYXRoLm1heCggMCwgLSAoIGEwMSAqIHMxICsgYjAgKSApOwoJCQlzcXJEaXN0ID0gLSBzMCAqIHMwICsgczEgKiAoIHMxICsgMiAqIGIxICkgKyBjOwoKCQl9CgoJCWlmICggb3B0aW9uYWxQb2ludE9uUmF5ICkgewoKCQkJb3B0aW9uYWxQb2ludE9uUmF5LmNvcHkoIHRoaXMub3JpZ2luICkuYWRkU2NhbGVkVmVjdG9yKCB0aGlzLmRpcmVjdGlvbiwgczAgKTsKCgkJfQoKCQlpZiAoIG9wdGlvbmFsUG9pbnRPblNlZ21lbnQgKSB7CgoJCQlvcHRpb25hbFBvaW50T25TZWdtZW50LmNvcHkoIF9zZWdDZW50ZXIgKS5hZGRTY2FsZWRWZWN0b3IoIF9zZWdEaXIsIHMxICk7CgoJCX0KCgkJcmV0dXJuIHNxckRpc3Q7CgoJfQoKCWludGVyc2VjdFNwaGVyZSggc3BoZXJlLCB0YXJnZXQgKSB7CgoJCV92ZWN0b3IkOS5zdWJWZWN0b3JzKCBzcGhlcmUuY2VudGVyLCB0aGlzLm9yaWdpbiApOwoJCWNvbnN0IHRjYSA9IF92ZWN0b3IkOS5kb3QoIHRoaXMuZGlyZWN0aW9uICk7CgkJY29uc3QgZDIgPSBfdmVjdG9yJDkuZG90KCBfdmVjdG9yJDkgKSAtIHRjYSAqIHRjYTsKCQljb25zdCByYWRpdXMyID0gc3BoZXJlLnJhZGl1cyAqIHNwaGVyZS5yYWRpdXM7CgoJCWlmICggZDIgPiByYWRpdXMyICkgcmV0dXJuIG51bGw7CgoJCWNvbnN0IHRoYyA9IE1hdGguc3FydCggcmFkaXVzMiAtIGQyICk7CgoJCS8vIHQwID0gZmlyc3QgaW50ZXJzZWN0IHBvaW50IC0gZW50cmFuY2Ugb24gZnJvbnQgb2Ygc3BoZXJlCgkJY29uc3QgdDAgPSB0Y2EgLSB0aGM7CgoJCS8vIHQxID0gc2Vjb25kIGludGVyc2VjdCBwb2ludCAtIGV4aXQgcG9pbnQgb24gYmFjayBvZiBzcGhlcmUKCQljb25zdCB0MSA9IHRjYSArIHRoYzsKCgkJLy8gdGVzdCB0byBzZWUgaWYgdDEgaXMgYmVoaW5kIHRoZSByYXkgLSBpZiBzbywgcmV0dXJuIG51bGwKCQlpZiAoIHQxIDwgMCApIHJldHVybiBudWxsOwoKCQkvLyB0ZXN0IHRvIHNlZSBpZiB0MCBpcyBiZWhpbmQgdGhlIHJheToKCQkvLyBpZiBpdCBpcywgdGhlIHJheSBpcyBpbnNpZGUgdGhlIHNwaGVyZSwgc28gcmV0dXJuIHRoZSBzZWNvbmQgZXhpdCBwb2ludCBzY2FsZWQgYnkgdDEsCgkJLy8gaW4gb3JkZXIgdG8gYWx3YXlzIHJldHVybiBhbiBpbnRlcnNlY3QgcG9pbnQgdGhhdCBpcyBpbiBmcm9udCBvZiB0aGUgcmF5LgoJCWlmICggdDAgPCAwICkgcmV0dXJuIHRoaXMuYXQoIHQxLCB0YXJnZXQgKTsKCgkJLy8gZWxzZSB0MCBpcyBpbiBmcm9udCBvZiB0aGUgcmF5LCBzbyByZXR1cm4gdGhlIGZpcnN0IGNvbGxpc2lvbiBwb2ludCBzY2FsZWQgYnkgdDAKCQlyZXR1cm4gdGhpcy5hdCggdDAsIHRhcmdldCApOwoKCX0KCglpbnRlcnNlY3RzU3BoZXJlKCBzcGhlcmUgKSB7CgoJCXJldHVybiB0aGlzLmRpc3RhbmNlU3FUb1BvaW50KCBzcGhlcmUuY2VudGVyICkgPD0gKCBzcGhlcmUucmFkaXVzICogc3BoZXJlLnJhZGl1cyApOwoKCX0KCglkaXN0YW5jZVRvUGxhbmUoIHBsYW5lICkgewoKCQljb25zdCBkZW5vbWluYXRvciA9IHBsYW5lLm5vcm1hbC5kb3QoIHRoaXMuZGlyZWN0aW9uICk7CgoJCWlmICggZGVub21pbmF0b3IgPT09IDAgKSB7CgoJCQkvLyBsaW5lIGlzIGNvcGxhbmFyLCByZXR1cm4gb3JpZ2luCgkJCWlmICggcGxhbmUuZGlzdGFuY2VUb1BvaW50KCB0aGlzLm9yaWdpbiApID09PSAwICkgewoKCQkJCXJldHVybiAwOwoKCQkJfQoKCQkJLy8gTnVsbCBpcyBwcmVmZXJhYmxlIHRvIHVuZGVmaW5lZCBzaW5jZSB1bmRlZmluZWQgbWVhbnMuLi4uIGl0IGlzIHVuZGVmaW5lZAoKCQkJcmV0dXJuIG51bGw7CgoJCX0KCgkJY29uc3QgdCA9IC0gKCB0aGlzLm9yaWdpbi5kb3QoIHBsYW5lLm5vcm1hbCApICsgcGxhbmUuY29uc3RhbnQgKSAvIGRlbm9taW5hdG9yOwoKCQkvLyBSZXR1cm4gaWYgdGhlIHJheSBuZXZlciBpbnRlcnNlY3RzIHRoZSBwbGFuZQoKCQlyZXR1cm4gdCA+PSAwID8gdCA6IG51bGw7CgoJfQoKCWludGVyc2VjdFBsYW5lKCBwbGFuZSwgdGFyZ2V0ICkgewoKCQljb25zdCB0ID0gdGhpcy5kaXN0YW5jZVRvUGxhbmUoIHBsYW5lICk7CgoJCWlmICggdCA9PT0gbnVsbCApIHsKCgkJCXJldHVybiBudWxsOwoKCQl9CgoJCXJldHVybiB0aGlzLmF0KCB0LCB0YXJnZXQgKTsKCgl9CgoJaW50ZXJzZWN0c1BsYW5lKCBwbGFuZSApIHsKCgkJLy8gY2hlY2sgaWYgdGhlIHJheSBsaWVzIG9uIHRoZSBwbGFuZSBmaXJzdAoKCQljb25zdCBkaXN0VG9Qb2ludCA9IHBsYW5lLmRpc3RhbmNlVG9Qb2ludCggdGhpcy5vcmlnaW4gKTsKCgkJaWYgKCBkaXN0VG9Qb2ludCA9PT0gMCApIHsKCgkJCXJldHVybiB0cnVlOwoKCQl9CgoJCWNvbnN0IGRlbm9taW5hdG9yID0gcGxhbmUubm9ybWFsLmRvdCggdGhpcy5kaXJlY3Rpb24gKTsKCgkJaWYgKCBkZW5vbWluYXRvciAqIGRpc3RUb1BvaW50IDwgMCApIHsKCgkJCXJldHVybiB0cnVlOwoKCQl9CgoJCS8vIHJheSBvcmlnaW4gaXMgYmVoaW5kIHRoZSBwbGFuZSAoYW5kIGlzIHBvaW50aW5nIGJlaGluZCBpdCkKCgkJcmV0dXJuIGZhbHNlOwoKCX0KCglpbnRlcnNlY3RCb3goIGJveCwgdGFyZ2V0ICkgewoKCQlsZXQgdG1pbiwgdG1heCwgdHltaW4sIHR5bWF4LCB0em1pbiwgdHptYXg7CgoJCWNvbnN0IGludmRpcnggPSAxIC8gdGhpcy5kaXJlY3Rpb24ueCwKCQkJaW52ZGlyeSA9IDEgLyB0aGlzLmRpcmVjdGlvbi55LAoJCQlpbnZkaXJ6ID0gMSAvIHRoaXMuZGlyZWN0aW9uLno7CgoJCWNvbnN0IG9yaWdpbiA9IHRoaXMub3JpZ2luOwoKCQlpZiAoIGludmRpcnggPj0gMCApIHsKCgkJCXRtaW4gPSAoIGJveC5taW4ueCAtIG9yaWdpbi54ICkgKiBpbnZkaXJ4OwoJCQl0bWF4ID0gKCBib3gubWF4LnggLSBvcmlnaW4ueCApICogaW52ZGlyeDsKCgkJfSBlbHNlIHsKCgkJCXRtaW4gPSAoIGJveC5tYXgueCAtIG9yaWdpbi54ICkgKiBpbnZkaXJ4OwoJCQl0bWF4ID0gKCBib3gubWluLnggLSBvcmlnaW4ueCApICogaW52ZGlyeDsKCgkJfQoKCQlpZiAoIGludmRpcnkgPj0gMCApIHsKCgkJCXR5bWluID0gKCBib3gubWluLnkgLSBvcmlnaW4ueSApICogaW52ZGlyeTsKCQkJdHltYXggPSAoIGJveC5tYXgueSAtIG9yaWdpbi55ICkgKiBpbnZkaXJ5OwoKCQl9IGVsc2UgewoKCQkJdHltaW4gPSAoIGJveC5tYXgueSAtIG9yaWdpbi55ICkgKiBpbnZkaXJ5OwoJCQl0eW1heCA9ICggYm94Lm1pbi55IC0gb3JpZ2luLnkgKSAqIGludmRpcnk7CgoJCX0KCgkJaWYgKCAoIHRtaW4gPiB0eW1heCApIHx8ICggdHltaW4gPiB0bWF4ICkgKSByZXR1cm4gbnVsbDsKCgkJaWYgKCB0eW1pbiA+IHRtaW4gfHwgaXNOYU4oIHRtaW4gKSApIHRtaW4gPSB0eW1pbjsKCgkJaWYgKCB0eW1heCA8IHRtYXggfHwgaXNOYU4oIHRtYXggKSApIHRtYXggPSB0eW1heDsKCgkJaWYgKCBpbnZkaXJ6ID49IDAgKSB7CgoJCQl0em1pbiA9ICggYm94Lm1pbi56IC0gb3JpZ2luLnogKSAqIGludmRpcno7CgkJCXR6bWF4ID0gKCBib3gubWF4LnogLSBvcmlnaW4ueiApICogaW52ZGlyejsKCgkJfSBlbHNlIHsKCgkJCXR6bWluID0gKCBib3gubWF4LnogLSBvcmlnaW4ueiApICogaW52ZGlyejsKCQkJdHptYXggPSAoIGJveC5taW4ueiAtIG9yaWdpbi56ICkgKiBpbnZkaXJ6OwoKCQl9CgoJCWlmICggKCB0bWluID4gdHptYXggKSB8fCAoIHR6bWluID4gdG1heCApICkgcmV0dXJuIG51bGw7CgoJCWlmICggdHptaW4gPiB0bWluIHx8IHRtaW4gIT09IHRtaW4gKSB0bWluID0gdHptaW47CgoJCWlmICggdHptYXggPCB0bWF4IHx8IHRtYXggIT09IHRtYXggKSB0bWF4ID0gdHptYXg7CgoJCS8vcmV0dXJuIHBvaW50IGNsb3Nlc3QgdG8gdGhlIHJheSAocG9zaXRpdmUgc2lkZSkKCgkJaWYgKCB0bWF4IDwgMCApIHJldHVybiBudWxsOwoKCQlyZXR1cm4gdGhpcy5hdCggdG1pbiA+PSAwID8gdG1pbiA6IHRtYXgsIHRhcmdldCApOwoKCX0KCglpbnRlcnNlY3RzQm94KCBib3ggKSB7CgoJCXJldHVybiB0aGlzLmludGVyc2VjdEJveCggYm94LCBfdmVjdG9yJDkgKSAhPT0gbnVsbDsKCgl9CgoJaW50ZXJzZWN0VHJpYW5nbGUoIGEsIGIsIGMsIGJhY2tmYWNlQ3VsbGluZywgdGFyZ2V0ICkgewoKCQkvLyBDb21wdXRlIHRoZSBvZmZzZXQgb3JpZ2luLCBlZGdlcywgYW5kIG5vcm1hbC4KCgkJLy8gZnJvbSBodHRwczovL2dpdGh1Yi5jb20vcG1qb25pYWsvR2VvbWV0cmljVG9vbHMvYmxvYi9tYXN0ZXIvR1RFbmdpbmUvSW5jbHVkZS9NYXRoZW1hdGljcy9HdGVJbnRyUmF5M1RyaWFuZ2xlMy5oCgoJCV9lZGdlMS5zdWJWZWN0b3JzKCBiLCBhICk7CgkJX2VkZ2UyLnN1YlZlY3RvcnMoIGMsIGEgKTsKCQlfbm9ybWFsJDEuY3Jvc3NWZWN0b3JzKCBfZWRnZTEsIF9lZGdlMiApOwoKCQkvLyBTb2x2ZSBRICsgdCpEID0gYjEqRTEgKyBiMipFMiAoUSA9IGtEaWZmLCBEID0gcmF5IGRpcmVjdGlvbiwKCQkvLyBFMSA9IGtFZGdlMSwgRTIgPSBrRWRnZTIsIE4gPSBDcm9zcyhFMSxFMikpIGJ5CgkJLy8gICB8RG90KEQsTil8KmIxID0gc2lnbihEb3QoRCxOKSkqRG90KEQsQ3Jvc3MoUSxFMikpCgkJLy8gICB8RG90KEQsTil8KmIyID0gc2lnbihEb3QoRCxOKSkqRG90KEQsQ3Jvc3MoRTEsUSkpCgkJLy8gICB8RG90KEQsTil8KnQgPSAtc2lnbihEb3QoRCxOKSkqRG90KFEsTikKCQlsZXQgRGROID0gdGhpcy5kaXJlY3Rpb24uZG90KCBfbm9ybWFsJDEgKTsKCQlsZXQgc2lnbjsKCgkJaWYgKCBEZE4gPiAwICkgewoKCQkJaWYgKCBiYWNrZmFjZUN1bGxpbmcgKSByZXR1cm4gbnVsbDsKCQkJc2lnbiA9IDE7CgoJCX0gZWxzZSBpZiAoIERkTiA8IDAgKSB7CgoJCQlzaWduID0gLSAxOwoJCQlEZE4gPSAtIERkTjsKCgkJfSBlbHNlIHsKCgkJCXJldHVybiBudWxsOwoKCQl9CgoJCV9kaWZmLnN1YlZlY3RvcnMoIHRoaXMub3JpZ2luLCBhICk7CgkJY29uc3QgRGRReEUyID0gc2lnbiAqIHRoaXMuZGlyZWN0aW9uLmRvdCggX2VkZ2UyLmNyb3NzVmVjdG9ycyggX2RpZmYsIF9lZGdlMiApICk7CgoJCS8vIGIxIDwgMCwgbm8gaW50ZXJzZWN0aW9uCgkJaWYgKCBEZFF4RTIgPCAwICkgewoKCQkJcmV0dXJuIG51bGw7CgoJCX0KCgkJY29uc3QgRGRFMXhRID0gc2lnbiAqIHRoaXMuZGlyZWN0aW9uLmRvdCggX2VkZ2UxLmNyb3NzKCBfZGlmZiApICk7CgoJCS8vIGIyIDwgMCwgbm8gaW50ZXJzZWN0aW9uCgkJaWYgKCBEZEUxeFEgPCAwICkgewoKCQkJcmV0dXJuIG51bGw7CgoJCX0KCgkJLy8gYjErYjIgPiAxLCBubyBpbnRlcnNlY3Rpb24KCQlpZiAoIERkUXhFMiArIERkRTF4USA+IERkTiApIHsKCgkJCXJldHVybiBudWxsOwoKCQl9CgoJCS8vIExpbmUgaW50ZXJzZWN0cyB0cmlhbmdsZSwgY2hlY2sgaWYgcmF5IGRvZXMuCgkJY29uc3QgUWROID0gLSBzaWduICogX2RpZmYuZG90KCBfbm9ybWFsJDEgKTsKCgkJLy8gdCA8IDAsIG5vIGludGVyc2VjdGlvbgoJCWlmICggUWROIDwgMCApIHsKCgkJCXJldHVybiBudWxsOwoKCQl9CgoJCS8vIFJheSBpbnRlcnNlY3RzIHRyaWFuZ2xlLgoJCXJldHVybiB0aGlzLmF0KCBRZE4gLyBEZE4sIHRhcmdldCApOwoKCX0KCglhcHBseU1hdHJpeDQoIG1hdHJpeDQgKSB7CgoJCXRoaXMub3JpZ2luLmFwcGx5TWF0cml4NCggbWF0cml4NCApOwoJCXRoaXMuZGlyZWN0aW9uLnRyYW5zZm9ybURpcmVjdGlvbiggbWF0cml4NCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZXF1YWxzKCByYXkgKSB7CgoJCXJldHVybiByYXkub3JpZ2luLmVxdWFscyggdGhpcy5vcmlnaW4gKSAmJiByYXkuZGlyZWN0aW9uLmVxdWFscyggdGhpcy5kaXJlY3Rpb24gKTsKCgl9CgoJY2xvbmUoKSB7CgoJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCgl9Cgp9CgpjbGFzcyBNYXRyaXg0IHsKCgljb25zdHJ1Y3RvciggbjExLCBuMTIsIG4xMywgbjE0LCBuMjEsIG4yMiwgbjIzLCBuMjQsIG4zMSwgbjMyLCBuMzMsIG4zNCwgbjQxLCBuNDIsIG40MywgbjQ0ICkgewoKCQlNYXRyaXg0LnByb3RvdHlwZS5pc01hdHJpeDQgPSB0cnVlOwoKCQl0aGlzLmVsZW1lbnRzID0gWwoKCQkJMSwgMCwgMCwgMCwKCQkJMCwgMSwgMCwgMCwKCQkJMCwgMCwgMSwgMCwKCQkJMCwgMCwgMCwgMQoKCQldOwoKCQlpZiAoIG4xMSAhPT0gdW5kZWZpbmVkICkgewoKCQkJdGhpcy5zZXQoIG4xMSwgbjEyLCBuMTMsIG4xNCwgbjIxLCBuMjIsIG4yMywgbjI0LCBuMzEsIG4zMiwgbjMzLCBuMzQsIG40MSwgbjQyLCBuNDMsIG40NCApOwoKCQl9CgoJfQoKCXNldCggbjExLCBuMTIsIG4xMywgbjE0LCBuMjEsIG4yMiwgbjIzLCBuMjQsIG4zMSwgbjMyLCBuMzMsIG4zNCwgbjQxLCBuNDIsIG40MywgbjQ0ICkgewoKCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCXRlWyAwIF0gPSBuMTE7IHRlWyA0IF0gPSBuMTI7IHRlWyA4IF0gPSBuMTM7IHRlWyAxMiBdID0gbjE0OwoJCXRlWyAxIF0gPSBuMjE7IHRlWyA1IF0gPSBuMjI7IHRlWyA5IF0gPSBuMjM7IHRlWyAxMyBdID0gbjI0OwoJCXRlWyAyIF0gPSBuMzE7IHRlWyA2IF0gPSBuMzI7IHRlWyAxMCBdID0gbjMzOyB0ZVsgMTQgXSA9IG4zNDsKCQl0ZVsgMyBdID0gbjQxOyB0ZVsgNyBdID0gbjQyOyB0ZVsgMTEgXSA9IG40MzsgdGVbIDE1IF0gPSBuNDQ7CgoJCXJldHVybiB0aGlzOwoKCX0KCglpZGVudGl0eSgpIHsKCgkJdGhpcy5zZXQoCgoJCQkxLCAwLCAwLCAwLAoJCQkwLCAxLCAwLCAwLAoJCQkwLCAwLCAxLCAwLAoJCQkwLCAwLCAwLCAxCgoJCSk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljbG9uZSgpIHsKCgkJcmV0dXJuIG5ldyBNYXRyaXg0KCkuZnJvbUFycmF5KCB0aGlzLmVsZW1lbnRzICk7CgoJfQoKCWNvcHkoIG0gKSB7CgoJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCQljb25zdCBtZSA9IG0uZWxlbWVudHM7CgoJCXRlWyAwIF0gPSBtZVsgMCBdOyB0ZVsgMSBdID0gbWVbIDEgXTsgdGVbIDIgXSA9IG1lWyAyIF07IHRlWyAzIF0gPSBtZVsgMyBdOwoJCXRlWyA0IF0gPSBtZVsgNCBdOyB0ZVsgNSBdID0gbWVbIDUgXTsgdGVbIDYgXSA9IG1lWyA2IF07IHRlWyA3IF0gPSBtZVsgNyBdOwoJCXRlWyA4IF0gPSBtZVsgOCBdOyB0ZVsgOSBdID0gbWVbIDkgXTsgdGVbIDEwIF0gPSBtZVsgMTAgXTsgdGVbIDExIF0gPSBtZVsgMTEgXTsKCQl0ZVsgMTIgXSA9IG1lWyAxMiBdOyB0ZVsgMTMgXSA9IG1lWyAxMyBdOyB0ZVsgMTQgXSA9IG1lWyAxNCBdOyB0ZVsgMTUgXSA9IG1lWyAxNSBdOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY29weVBvc2l0aW9uKCBtICkgewoKCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHMsIG1lID0gbS5lbGVtZW50czsKCgkJdGVbIDEyIF0gPSBtZVsgMTIgXTsKCQl0ZVsgMTMgXSA9IG1lWyAxMyBdOwoJCXRlWyAxNCBdID0gbWVbIDE0IF07CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tTWF0cml4MyggbSApIHsKCgkJY29uc3QgbWUgPSBtLmVsZW1lbnRzOwoKCQl0aGlzLnNldCgKCgkJCW1lWyAwIF0sIG1lWyAzIF0sIG1lWyA2IF0sIDAsCgkJCW1lWyAxIF0sIG1lWyA0IF0sIG1lWyA3IF0sIDAsCgkJCW1lWyAyIF0sIG1lWyA1IF0sIG1lWyA4IF0sIDAsCgkJCTAsIDAsIDAsIDEKCgkJKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWV4dHJhY3RCYXNpcyggeEF4aXMsIHlBeGlzLCB6QXhpcyApIHsKCgkJeEF4aXMuc2V0RnJvbU1hdHJpeENvbHVtbiggdGhpcywgMCApOwoJCXlBeGlzLnNldEZyb21NYXRyaXhDb2x1bW4oIHRoaXMsIDEgKTsKCQl6QXhpcy5zZXRGcm9tTWF0cml4Q29sdW1uKCB0aGlzLCAyICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltYWtlQmFzaXMoIHhBeGlzLCB5QXhpcywgekF4aXMgKSB7CgoJCXRoaXMuc2V0KAoJCQl4QXhpcy54LCB5QXhpcy54LCB6QXhpcy54LCAwLAoJCQl4QXhpcy55LCB5QXhpcy55LCB6QXhpcy55LCAwLAoJCQl4QXhpcy56LCB5QXhpcy56LCB6QXhpcy56LCAwLAoJCQkwLCAwLCAwLCAxCgkJKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWV4dHJhY3RSb3RhdGlvbiggbSApIHsKCgkJLy8gdGhpcyBtZXRob2QgZG9lcyBub3Qgc3VwcG9ydCByZWZsZWN0aW9uIG1hdHJpY2VzCgoJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCQljb25zdCBtZSA9IG0uZWxlbWVudHM7CgoJCWNvbnN0IHNjYWxlWCA9IDEgLyBfdjEkNS5zZXRGcm9tTWF0cml4Q29sdW1uKCBtLCAwICkubGVuZ3RoKCk7CgkJY29uc3Qgc2NhbGVZID0gMSAvIF92MSQ1LnNldEZyb21NYXRyaXhDb2x1bW4oIG0sIDEgKS5sZW5ndGgoKTsKCQljb25zdCBzY2FsZVogPSAxIC8gX3YxJDUuc2V0RnJvbU1hdHJpeENvbHVtbiggbSwgMiApLmxlbmd0aCgpOwoKCQl0ZVsgMCBdID0gbWVbIDAgXSAqIHNjYWxlWDsKCQl0ZVsgMSBdID0gbWVbIDEgXSAqIHNjYWxlWDsKCQl0ZVsgMiBdID0gbWVbIDIgXSAqIHNjYWxlWDsKCQl0ZVsgMyBdID0gMDsKCgkJdGVbIDQgXSA9IG1lWyA0IF0gKiBzY2FsZVk7CgkJdGVbIDUgXSA9IG1lWyA1IF0gKiBzY2FsZVk7CgkJdGVbIDYgXSA9IG1lWyA2IF0gKiBzY2FsZVk7CgkJdGVbIDcgXSA9IDA7CgoJCXRlWyA4IF0gPSBtZVsgOCBdICogc2NhbGVaOwoJCXRlWyA5IF0gPSBtZVsgOSBdICogc2NhbGVaOwoJCXRlWyAxMCBdID0gbWVbIDEwIF0gKiBzY2FsZVo7CgkJdGVbIDExIF0gPSAwOwoKCQl0ZVsgMTIgXSA9IDA7CgkJdGVbIDEzIF0gPSAwOwoJCXRlWyAxNCBdID0gMDsKCQl0ZVsgMTUgXSA9IDE7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltYWtlUm90YXRpb25Gcm9tRXVsZXIoIGV1bGVyICkgewoKCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCWNvbnN0IHggPSBldWxlci54LCB5ID0gZXVsZXIueSwgeiA9IGV1bGVyLno7CgkJY29uc3QgYSA9IE1hdGguY29zKCB4ICksIGIgPSBNYXRoLnNpbiggeCApOwoJCWNvbnN0IGMgPSBNYXRoLmNvcyggeSApLCBkID0gTWF0aC5zaW4oIHkgKTsKCQljb25zdCBlID0gTWF0aC5jb3MoIHogKSwgZiA9IE1hdGguc2luKCB6ICk7CgoJCWlmICggZXVsZXIub3JkZXIgPT09ICdYWVonICkgewoKCQkJY29uc3QgYWUgPSBhICogZSwgYWYgPSBhICogZiwgYmUgPSBiICogZSwgYmYgPSBiICogZjsKCgkJCXRlWyAwIF0gPSBjICogZTsKCQkJdGVbIDQgXSA9IC0gYyAqIGY7CgkJCXRlWyA4IF0gPSBkOwoKCQkJdGVbIDEgXSA9IGFmICsgYmUgKiBkOwoJCQl0ZVsgNSBdID0gYWUgLSBiZiAqIGQ7CgkJCXRlWyA5IF0gPSAtIGIgKiBjOwoKCQkJdGVbIDIgXSA9IGJmIC0gYWUgKiBkOwoJCQl0ZVsgNiBdID0gYmUgKyBhZiAqIGQ7CgkJCXRlWyAxMCBdID0gYSAqIGM7CgoJCX0gZWxzZSBpZiAoIGV1bGVyLm9yZGVyID09PSAnWVhaJyApIHsKCgkJCWNvbnN0IGNlID0gYyAqIGUsIGNmID0gYyAqIGYsIGRlID0gZCAqIGUsIGRmID0gZCAqIGY7CgoJCQl0ZVsgMCBdID0gY2UgKyBkZiAqIGI7CgkJCXRlWyA0IF0gPSBkZSAqIGIgLSBjZjsKCQkJdGVbIDggXSA9IGEgKiBkOwoKCQkJdGVbIDEgXSA9IGEgKiBmOwoJCQl0ZVsgNSBdID0gYSAqIGU7CgkJCXRlWyA5IF0gPSAtIGI7CgoJCQl0ZVsgMiBdID0gY2YgKiBiIC0gZGU7CgkJCXRlWyA2IF0gPSBkZiArIGNlICogYjsKCQkJdGVbIDEwIF0gPSBhICogYzsKCgkJfSBlbHNlIGlmICggZXVsZXIub3JkZXIgPT09ICdaWFknICkgewoKCQkJY29uc3QgY2UgPSBjICogZSwgY2YgPSBjICogZiwgZGUgPSBkICogZSwgZGYgPSBkICogZjsKCgkJCXRlWyAwIF0gPSBjZSAtIGRmICogYjsKCQkJdGVbIDQgXSA9IC0gYSAqIGY7CgkJCXRlWyA4IF0gPSBkZSArIGNmICogYjsKCgkJCXRlWyAxIF0gPSBjZiArIGRlICogYjsKCQkJdGVbIDUgXSA9IGEgKiBlOwoJCQl0ZVsgOSBdID0gZGYgLSBjZSAqIGI7CgoJCQl0ZVsgMiBdID0gLSBhICogZDsKCQkJdGVbIDYgXSA9IGI7CgkJCXRlWyAxMCBdID0gYSAqIGM7CgoJCX0gZWxzZSBpZiAoIGV1bGVyLm9yZGVyID09PSAnWllYJyApIHsKCgkJCWNvbnN0IGFlID0gYSAqIGUsIGFmID0gYSAqIGYsIGJlID0gYiAqIGUsIGJmID0gYiAqIGY7CgoJCQl0ZVsgMCBdID0gYyAqIGU7CgkJCXRlWyA0IF0gPSBiZSAqIGQgLSBhZjsKCQkJdGVbIDggXSA9IGFlICogZCArIGJmOwoKCQkJdGVbIDEgXSA9IGMgKiBmOwoJCQl0ZVsgNSBdID0gYmYgKiBkICsgYWU7CgkJCXRlWyA5IF0gPSBhZiAqIGQgLSBiZTsKCgkJCXRlWyAyIF0gPSAtIGQ7CgkJCXRlWyA2IF0gPSBiICogYzsKCQkJdGVbIDEwIF0gPSBhICogYzsKCgkJfSBlbHNlIGlmICggZXVsZXIub3JkZXIgPT09ICdZWlgnICkgewoKCQkJY29uc3QgYWMgPSBhICogYywgYWQgPSBhICogZCwgYmMgPSBiICogYywgYmQgPSBiICogZDsKCgkJCXRlWyAwIF0gPSBjICogZTsKCQkJdGVbIDQgXSA9IGJkIC0gYWMgKiBmOwoJCQl0ZVsgOCBdID0gYmMgKiBmICsgYWQ7CgoJCQl0ZVsgMSBdID0gZjsKCQkJdGVbIDUgXSA9IGEgKiBlOwoJCQl0ZVsgOSBdID0gLSBiICogZTsKCgkJCXRlWyAyIF0gPSAtIGQgKiBlOwoJCQl0ZVsgNiBdID0gYWQgKiBmICsgYmM7CgkJCXRlWyAxMCBdID0gYWMgLSBiZCAqIGY7CgoJCX0gZWxzZSBpZiAoIGV1bGVyLm9yZGVyID09PSAnWFpZJyApIHsKCgkJCWNvbnN0IGFjID0gYSAqIGMsIGFkID0gYSAqIGQsIGJjID0gYiAqIGMsIGJkID0gYiAqIGQ7CgoJCQl0ZVsgMCBdID0gYyAqIGU7CgkJCXRlWyA0IF0gPSAtIGY7CgkJCXRlWyA4IF0gPSBkICogZTsKCgkJCXRlWyAxIF0gPSBhYyAqIGYgKyBiZDsKCQkJdGVbIDUgXSA9IGEgKiBlOwoJCQl0ZVsgOSBdID0gYWQgKiBmIC0gYmM7CgoJCQl0ZVsgMiBdID0gYmMgKiBmIC0gYWQ7CgkJCXRlWyA2IF0gPSBiICogZTsKCQkJdGVbIDEwIF0gPSBiZCAqIGYgKyBhYzsKCgkJfQoKCQkvLyBib3R0b20gcm93CgkJdGVbIDMgXSA9IDA7CgkJdGVbIDcgXSA9IDA7CgkJdGVbIDExIF0gPSAwOwoKCQkvLyBsYXN0IGNvbHVtbgoJCXRlWyAxMiBdID0gMDsKCQl0ZVsgMTMgXSA9IDA7CgkJdGVbIDE0IF0gPSAwOwoJCXRlWyAxNSBdID0gMTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCW1ha2VSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKCBxICkgewoKCQlyZXR1cm4gdGhpcy5jb21wb3NlKCBfemVybywgcSwgX29uZSApOwoKCX0KCglsb29rQXQoIGV5ZSwgdGFyZ2V0LCB1cCApIHsKCgkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQlfei5zdWJWZWN0b3JzKCBleWUsIHRhcmdldCApOwoKCQlpZiAoIF96Lmxlbmd0aFNxKCkgPT09IDAgKSB7CgoJCQkvLyBleWUgYW5kIHRhcmdldCBhcmUgaW4gdGhlIHNhbWUgcG9zaXRpb24KCgkJCV96LnogPSAxOwoKCQl9CgoJCV96Lm5vcm1hbGl6ZSgpOwoJCV94LmNyb3NzVmVjdG9ycyggdXAsIF96ICk7CgoJCWlmICggX3gubGVuZ3RoU3EoKSA9PT0gMCApIHsKCgkJCS8vIHVwIGFuZCB6IGFyZSBwYXJhbGxlbAoKCQkJaWYgKCBNYXRoLmFicyggdXAueiApID09PSAxICkgewoKCQkJCV96LnggKz0gMC4wMDAxOwoKCQkJfSBlbHNlIHsKCgkJCQlfei56ICs9IDAuMDAwMTsKCgkJCX0KCgkJCV96Lm5vcm1hbGl6ZSgpOwoJCQlfeC5jcm9zc1ZlY3RvcnMoIHVwLCBfeiApOwoKCQl9CgoJCV94Lm5vcm1hbGl6ZSgpOwoJCV95LmNyb3NzVmVjdG9ycyggX3osIF94ICk7CgoJCXRlWyAwIF0gPSBfeC54OyB0ZVsgNCBdID0gX3kueDsgdGVbIDggXSA9IF96Lng7CgkJdGVbIDEgXSA9IF94Lnk7IHRlWyA1IF0gPSBfeS55OyB0ZVsgOSBdID0gX3oueTsKCQl0ZVsgMiBdID0gX3guejsgdGVbIDYgXSA9IF95Lno7IHRlWyAxMCBdID0gX3ouejsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCW11bHRpcGx5KCBtICkgewoKCQlyZXR1cm4gdGhpcy5tdWx0aXBseU1hdHJpY2VzKCB0aGlzLCBtICk7CgoJfQoKCXByZW11bHRpcGx5KCBtICkgewoKCQlyZXR1cm4gdGhpcy5tdWx0aXBseU1hdHJpY2VzKCBtLCB0aGlzICk7CgoJfQoKCW11bHRpcGx5TWF0cmljZXMoIGEsIGIgKSB7CgoJCWNvbnN0IGFlID0gYS5lbGVtZW50czsKCQljb25zdCBiZSA9IGIuZWxlbWVudHM7CgkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQljb25zdCBhMTEgPSBhZVsgMCBdLCBhMTIgPSBhZVsgNCBdLCBhMTMgPSBhZVsgOCBdLCBhMTQgPSBhZVsgMTIgXTsKCQljb25zdCBhMjEgPSBhZVsgMSBdLCBhMjIgPSBhZVsgNSBdLCBhMjMgPSBhZVsgOSBdLCBhMjQgPSBhZVsgMTMgXTsKCQljb25zdCBhMzEgPSBhZVsgMiBdLCBhMzIgPSBhZVsgNiBdLCBhMzMgPSBhZVsgMTAgXSwgYTM0ID0gYWVbIDE0IF07CgkJY29uc3QgYTQxID0gYWVbIDMgXSwgYTQyID0gYWVbIDcgXSwgYTQzID0gYWVbIDExIF0sIGE0NCA9IGFlWyAxNSBdOwoKCQljb25zdCBiMTEgPSBiZVsgMCBdLCBiMTIgPSBiZVsgNCBdLCBiMTMgPSBiZVsgOCBdLCBiMTQgPSBiZVsgMTIgXTsKCQljb25zdCBiMjEgPSBiZVsgMSBdLCBiMjIgPSBiZVsgNSBdLCBiMjMgPSBiZVsgOSBdLCBiMjQgPSBiZVsgMTMgXTsKCQljb25zdCBiMzEgPSBiZVsgMiBdLCBiMzIgPSBiZVsgNiBdLCBiMzMgPSBiZVsgMTAgXSwgYjM0ID0gYmVbIDE0IF07CgkJY29uc3QgYjQxID0gYmVbIDMgXSwgYjQyID0gYmVbIDcgXSwgYjQzID0gYmVbIDExIF0sIGI0NCA9IGJlWyAxNSBdOwoKCQl0ZVsgMCBdID0gYTExICogYjExICsgYTEyICogYjIxICsgYTEzICogYjMxICsgYTE0ICogYjQxOwoJCXRlWyA0IF0gPSBhMTEgKiBiMTIgKyBhMTIgKiBiMjIgKyBhMTMgKiBiMzIgKyBhMTQgKiBiNDI7CgkJdGVbIDggXSA9IGExMSAqIGIxMyArIGExMiAqIGIyMyArIGExMyAqIGIzMyArIGExNCAqIGI0MzsKCQl0ZVsgMTIgXSA9IGExMSAqIGIxNCArIGExMiAqIGIyNCArIGExMyAqIGIzNCArIGExNCAqIGI0NDsKCgkJdGVbIDEgXSA9IGEyMSAqIGIxMSArIGEyMiAqIGIyMSArIGEyMyAqIGIzMSArIGEyNCAqIGI0MTsKCQl0ZVsgNSBdID0gYTIxICogYjEyICsgYTIyICogYjIyICsgYTIzICogYjMyICsgYTI0ICogYjQyOwoJCXRlWyA5IF0gPSBhMjEgKiBiMTMgKyBhMjIgKiBiMjMgKyBhMjMgKiBiMzMgKyBhMjQgKiBiNDM7CgkJdGVbIDEzIF0gPSBhMjEgKiBiMTQgKyBhMjIgKiBiMjQgKyBhMjMgKiBiMzQgKyBhMjQgKiBiNDQ7CgoJCXRlWyAyIF0gPSBhMzEgKiBiMTEgKyBhMzIgKiBiMjEgKyBhMzMgKiBiMzEgKyBhMzQgKiBiNDE7CgkJdGVbIDYgXSA9IGEzMSAqIGIxMiArIGEzMiAqIGIyMiArIGEzMyAqIGIzMiArIGEzNCAqIGI0MjsKCQl0ZVsgMTAgXSA9IGEzMSAqIGIxMyArIGEzMiAqIGIyMyArIGEzMyAqIGIzMyArIGEzNCAqIGI0MzsKCQl0ZVsgMTQgXSA9IGEzMSAqIGIxNCArIGEzMiAqIGIyNCArIGEzMyAqIGIzNCArIGEzNCAqIGI0NDsKCgkJdGVbIDMgXSA9IGE0MSAqIGIxMSArIGE0MiAqIGIyMSArIGE0MyAqIGIzMSArIGE0NCAqIGI0MTsKCQl0ZVsgNyBdID0gYTQxICogYjEyICsgYTQyICogYjIyICsgYTQzICogYjMyICsgYTQ0ICogYjQyOwoJCXRlWyAxMSBdID0gYTQxICogYjEzICsgYTQyICogYjIzICsgYTQzICogYjMzICsgYTQ0ICogYjQzOwoJCXRlWyAxNSBdID0gYTQxICogYjE0ICsgYTQyICogYjI0ICsgYTQzICogYjM0ICsgYTQ0ICogYjQ0OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbXVsdGlwbHlTY2FsYXIoIHMgKSB7CgoJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCgkJdGVbIDAgXSAqPSBzOyB0ZVsgNCBdICo9IHM7IHRlWyA4IF0gKj0gczsgdGVbIDEyIF0gKj0gczsKCQl0ZVsgMSBdICo9IHM7IHRlWyA1IF0gKj0gczsgdGVbIDkgXSAqPSBzOyB0ZVsgMTMgXSAqPSBzOwoJCXRlWyAyIF0gKj0gczsgdGVbIDYgXSAqPSBzOyB0ZVsgMTAgXSAqPSBzOyB0ZVsgMTQgXSAqPSBzOwoJCXRlWyAzIF0gKj0gczsgdGVbIDcgXSAqPSBzOyB0ZVsgMTEgXSAqPSBzOyB0ZVsgMTUgXSAqPSBzOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZGV0ZXJtaW5hbnQoKSB7CgoJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCgkJY29uc3QgbjExID0gdGVbIDAgXSwgbjEyID0gdGVbIDQgXSwgbjEzID0gdGVbIDggXSwgbjE0ID0gdGVbIDEyIF07CgkJY29uc3QgbjIxID0gdGVbIDEgXSwgbjIyID0gdGVbIDUgXSwgbjIzID0gdGVbIDkgXSwgbjI0ID0gdGVbIDEzIF07CgkJY29uc3QgbjMxID0gdGVbIDIgXSwgbjMyID0gdGVbIDYgXSwgbjMzID0gdGVbIDEwIF0sIG4zNCA9IHRlWyAxNCBdOwoJCWNvbnN0IG40MSA9IHRlWyAzIF0sIG40MiA9IHRlWyA3IF0sIG40MyA9IHRlWyAxMSBdLCBuNDQgPSB0ZVsgMTUgXTsKCgkJLy9UT0RPOiBtYWtlIHRoaXMgbW9yZSBlZmZpY2llbnQKCQkvLyggYmFzZWQgb24gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvYWxnZWJyYS9tYXRyaXgvZnVuY3Rpb25zL2ludmVyc2UvZm91ckQvaW5kZXguaHRtICkKCgkJcmV0dXJuICgKCQkJbjQxICogKAoJCQkJKyBuMTQgKiBuMjMgKiBuMzIKCQkJCSAtIG4xMyAqIG4yNCAqIG4zMgoJCQkJIC0gbjE0ICogbjIyICogbjMzCgkJCQkgKyBuMTIgKiBuMjQgKiBuMzMKCQkJCSArIG4xMyAqIG4yMiAqIG4zNAoJCQkJIC0gbjEyICogbjIzICogbjM0CgkJCSkgKwoJCQluNDIgKiAoCgkJCQkrIG4xMSAqIG4yMyAqIG4zNAoJCQkJIC0gbjExICogbjI0ICogbjMzCgkJCQkgKyBuMTQgKiBuMjEgKiBuMzMKCQkJCSAtIG4xMyAqIG4yMSAqIG4zNAoJCQkJICsgbjEzICogbjI0ICogbjMxCgkJCQkgLSBuMTQgKiBuMjMgKiBuMzEKCQkJKSArCgkJCW40MyAqICgKCQkJCSsgbjExICogbjI0ICogbjMyCgkJCQkgLSBuMTEgKiBuMjIgKiBuMzQKCQkJCSAtIG4xNCAqIG4yMSAqIG4zMgoJCQkJICsgbjEyICogbjIxICogbjM0CgkJCQkgKyBuMTQgKiBuMjIgKiBuMzEKCQkJCSAtIG4xMiAqIG4yNCAqIG4zMQoJCQkpICsKCQkJbjQ0ICogKAoJCQkJLSBuMTMgKiBuMjIgKiBuMzEKCQkJCSAtIG4xMSAqIG4yMyAqIG4zMgoJCQkJICsgbjExICogbjIyICogbjMzCgkJCQkgKyBuMTMgKiBuMjEgKiBuMzIKCQkJCSAtIG4xMiAqIG4yMSAqIG4zMwoJCQkJICsgbjEyICogbjIzICogbjMxCgkJCSkKCgkJKTsKCgl9CgoJdHJhbnNwb3NlKCkgewoKCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgkJbGV0IHRtcDsKCgkJdG1wID0gdGVbIDEgXTsgdGVbIDEgXSA9IHRlWyA0IF07IHRlWyA0IF0gPSB0bXA7CgkJdG1wID0gdGVbIDIgXTsgdGVbIDIgXSA9IHRlWyA4IF07IHRlWyA4IF0gPSB0bXA7CgkJdG1wID0gdGVbIDYgXTsgdGVbIDYgXSA9IHRlWyA5IF07IHRlWyA5IF0gPSB0bXA7CgoJCXRtcCA9IHRlWyAzIF07IHRlWyAzIF0gPSB0ZVsgMTIgXTsgdGVbIDEyIF0gPSB0bXA7CgkJdG1wID0gdGVbIDcgXTsgdGVbIDcgXSA9IHRlWyAxMyBdOyB0ZVsgMTMgXSA9IHRtcDsKCQl0bXAgPSB0ZVsgMTEgXTsgdGVbIDExIF0gPSB0ZVsgMTQgXTsgdGVbIDE0IF0gPSB0bXA7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRQb3NpdGlvbiggeCwgeSwgeiApIHsKCgkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQlpZiAoIHguaXNWZWN0b3IzICkgewoKCQkJdGVbIDEyIF0gPSB4Lng7CgkJCXRlWyAxMyBdID0geC55OwoJCQl0ZVsgMTQgXSA9IHguejsKCgkJfSBlbHNlIHsKCgkJCXRlWyAxMiBdID0geDsKCQkJdGVbIDEzIF0gPSB5OwoJCQl0ZVsgMTQgXSA9IHo7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWludmVydCgpIHsKCgkJLy8gYmFzZWQgb24gaHR0cDovL3d3dy5ldWNsaWRlYW5zcGFjZS5jb20vbWF0aHMvYWxnZWJyYS9tYXRyaXgvZnVuY3Rpb25zL2ludmVyc2UvZm91ckQvaW5kZXguaHRtCgkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzLAoKCQkJbjExID0gdGVbIDAgXSwgbjIxID0gdGVbIDEgXSwgbjMxID0gdGVbIDIgXSwgbjQxID0gdGVbIDMgXSwKCQkJbjEyID0gdGVbIDQgXSwgbjIyID0gdGVbIDUgXSwgbjMyID0gdGVbIDYgXSwgbjQyID0gdGVbIDcgXSwKCQkJbjEzID0gdGVbIDggXSwgbjIzID0gdGVbIDkgXSwgbjMzID0gdGVbIDEwIF0sIG40MyA9IHRlWyAxMSBdLAoJCQluMTQgPSB0ZVsgMTIgXSwgbjI0ID0gdGVbIDEzIF0sIG4zNCA9IHRlWyAxNCBdLCBuNDQgPSB0ZVsgMTUgXSwKCgkJCXQxMSA9IG4yMyAqIG4zNCAqIG40MiAtIG4yNCAqIG4zMyAqIG40MiArIG4yNCAqIG4zMiAqIG40MyAtIG4yMiAqIG4zNCAqIG40MyAtIG4yMyAqIG4zMiAqIG40NCArIG4yMiAqIG4zMyAqIG40NCwKCQkJdDEyID0gbjE0ICogbjMzICogbjQyIC0gbjEzICogbjM0ICogbjQyIC0gbjE0ICogbjMyICogbjQzICsgbjEyICogbjM0ICogbjQzICsgbjEzICogbjMyICogbjQ0IC0gbjEyICogbjMzICogbjQ0LAoJCQl0MTMgPSBuMTMgKiBuMjQgKiBuNDIgLSBuMTQgKiBuMjMgKiBuNDIgKyBuMTQgKiBuMjIgKiBuNDMgLSBuMTIgKiBuMjQgKiBuNDMgLSBuMTMgKiBuMjIgKiBuNDQgKyBuMTIgKiBuMjMgKiBuNDQsCgkJCXQxNCA9IG4xNCAqIG4yMyAqIG4zMiAtIG4xMyAqIG4yNCAqIG4zMiAtIG4xNCAqIG4yMiAqIG4zMyArIG4xMiAqIG4yNCAqIG4zMyArIG4xMyAqIG4yMiAqIG4zNCAtIG4xMiAqIG4yMyAqIG4zNDsKCgkJY29uc3QgZGV0ID0gbjExICogdDExICsgbjIxICogdDEyICsgbjMxICogdDEzICsgbjQxICogdDE0OwoKCQlpZiAoIGRldCA9PT0gMCApIHJldHVybiB0aGlzLnNldCggMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCwgMCApOwoKCQljb25zdCBkZXRJbnYgPSAxIC8gZGV0OwoKCQl0ZVsgMCBdID0gdDExICogZGV0SW52OwoJCXRlWyAxIF0gPSAoIG4yNCAqIG4zMyAqIG40MSAtIG4yMyAqIG4zNCAqIG40MSAtIG4yNCAqIG4zMSAqIG40MyArIG4yMSAqIG4zNCAqIG40MyArIG4yMyAqIG4zMSAqIG40NCAtIG4yMSAqIG4zMyAqIG40NCApICogZGV0SW52OwoJCXRlWyAyIF0gPSAoIG4yMiAqIG4zNCAqIG40MSAtIG4yNCAqIG4zMiAqIG40MSArIG4yNCAqIG4zMSAqIG40MiAtIG4yMSAqIG4zNCAqIG40MiAtIG4yMiAqIG4zMSAqIG40NCArIG4yMSAqIG4zMiAqIG40NCApICogZGV0SW52OwoJCXRlWyAzIF0gPSAoIG4yMyAqIG4zMiAqIG40MSAtIG4yMiAqIG4zMyAqIG40MSAtIG4yMyAqIG4zMSAqIG40MiArIG4yMSAqIG4zMyAqIG40MiArIG4yMiAqIG4zMSAqIG40MyAtIG4yMSAqIG4zMiAqIG40MyApICogZGV0SW52OwoKCQl0ZVsgNCBdID0gdDEyICogZGV0SW52OwoJCXRlWyA1IF0gPSAoIG4xMyAqIG4zNCAqIG40MSAtIG4xNCAqIG4zMyAqIG40MSArIG4xNCAqIG4zMSAqIG40MyAtIG4xMSAqIG4zNCAqIG40MyAtIG4xMyAqIG4zMSAqIG40NCArIG4xMSAqIG4zMyAqIG40NCApICogZGV0SW52OwoJCXRlWyA2IF0gPSAoIG4xNCAqIG4zMiAqIG40MSAtIG4xMiAqIG4zNCAqIG40MSAtIG4xNCAqIG4zMSAqIG40MiArIG4xMSAqIG4zNCAqIG40MiArIG4xMiAqIG4zMSAqIG40NCAtIG4xMSAqIG4zMiAqIG40NCApICogZGV0SW52OwoJCXRlWyA3IF0gPSAoIG4xMiAqIG4zMyAqIG40MSAtIG4xMyAqIG4zMiAqIG40MSArIG4xMyAqIG4zMSAqIG40MiAtIG4xMSAqIG4zMyAqIG40MiAtIG4xMiAqIG4zMSAqIG40MyArIG4xMSAqIG4zMiAqIG40MyApICogZGV0SW52OwoKCQl0ZVsgOCBdID0gdDEzICogZGV0SW52OwoJCXRlWyA5IF0gPSAoIG4xNCAqIG4yMyAqIG40MSAtIG4xMyAqIG4yNCAqIG40MSAtIG4xNCAqIG4yMSAqIG40MyArIG4xMSAqIG4yNCAqIG40MyArIG4xMyAqIG4yMSAqIG40NCAtIG4xMSAqIG4yMyAqIG40NCApICogZGV0SW52OwoJCXRlWyAxMCBdID0gKCBuMTIgKiBuMjQgKiBuNDEgLSBuMTQgKiBuMjIgKiBuNDEgKyBuMTQgKiBuMjEgKiBuNDIgLSBuMTEgKiBuMjQgKiBuNDIgLSBuMTIgKiBuMjEgKiBuNDQgKyBuMTEgKiBuMjIgKiBuNDQgKSAqIGRldEludjsKCQl0ZVsgMTEgXSA9ICggbjEzICogbjIyICogbjQxIC0gbjEyICogbjIzICogbjQxIC0gbjEzICogbjIxICogbjQyICsgbjExICogbjIzICogbjQyICsgbjEyICogbjIxICogbjQzIC0gbjExICogbjIyICogbjQzICkgKiBkZXRJbnY7CgoJCXRlWyAxMiBdID0gdDE0ICogZGV0SW52OwoJCXRlWyAxMyBdID0gKCBuMTMgKiBuMjQgKiBuMzEgLSBuMTQgKiBuMjMgKiBuMzEgKyBuMTQgKiBuMjEgKiBuMzMgLSBuMTEgKiBuMjQgKiBuMzMgLSBuMTMgKiBuMjEgKiBuMzQgKyBuMTEgKiBuMjMgKiBuMzQgKSAqIGRldEludjsKCQl0ZVsgMTQgXSA9ICggbjE0ICogbjIyICogbjMxIC0gbjEyICogbjI0ICogbjMxIC0gbjE0ICogbjIxICogbjMyICsgbjExICogbjI0ICogbjMyICsgbjEyICogbjIxICogbjM0IC0gbjExICogbjIyICogbjM0ICkgKiBkZXRJbnY7CgkJdGVbIDE1IF0gPSAoIG4xMiAqIG4yMyAqIG4zMSAtIG4xMyAqIG4yMiAqIG4zMSArIG4xMyAqIG4yMSAqIG4zMiAtIG4xMSAqIG4yMyAqIG4zMiAtIG4xMiAqIG4yMSAqIG4zMyArIG4xMSAqIG4yMiAqIG4zMyApICogZGV0SW52OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2NhbGUoIHYgKSB7CgoJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCQljb25zdCB4ID0gdi54LCB5ID0gdi55LCB6ID0gdi56OwoKCQl0ZVsgMCBdICo9IHg7IHRlWyA0IF0gKj0geTsgdGVbIDggXSAqPSB6OwoJCXRlWyAxIF0gKj0geDsgdGVbIDUgXSAqPSB5OyB0ZVsgOSBdICo9IHo7CgkJdGVbIDIgXSAqPSB4OyB0ZVsgNiBdICo9IHk7IHRlWyAxMCBdICo9IHo7CgkJdGVbIDMgXSAqPSB4OyB0ZVsgNyBdICo9IHk7IHRlWyAxMSBdICo9IHo7CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXRNYXhTY2FsZU9uQXhpcygpIHsKCgkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQljb25zdCBzY2FsZVhTcSA9IHRlWyAwIF0gKiB0ZVsgMCBdICsgdGVbIDEgXSAqIHRlWyAxIF0gKyB0ZVsgMiBdICogdGVbIDIgXTsKCQljb25zdCBzY2FsZVlTcSA9IHRlWyA0IF0gKiB0ZVsgNCBdICsgdGVbIDUgXSAqIHRlWyA1IF0gKyB0ZVsgNiBdICogdGVbIDYgXTsKCQljb25zdCBzY2FsZVpTcSA9IHRlWyA4IF0gKiB0ZVsgOCBdICsgdGVbIDkgXSAqIHRlWyA5IF0gKyB0ZVsgMTAgXSAqIHRlWyAxMCBdOwoKCQlyZXR1cm4gTWF0aC5zcXJ0KCBNYXRoLm1heCggc2NhbGVYU3EsIHNjYWxlWVNxLCBzY2FsZVpTcSApICk7CgoJfQoKCW1ha2VUcmFuc2xhdGlvbiggeCwgeSwgeiApIHsKCgkJaWYgKCB4LmlzVmVjdG9yMyApIHsKCgkJCXRoaXMuc2V0KAoKCQkJCTEsIDAsIDAsIHgueCwKCQkJCTAsIDEsIDAsIHgueSwKCQkJCTAsIDAsIDEsIHgueiwKCQkJCTAsIDAsIDAsIDEKCgkJCSk7CgoJCX0gZWxzZSB7CgoJCQl0aGlzLnNldCgKCgkJCQkxLCAwLCAwLCB4LAoJCQkJMCwgMSwgMCwgeSwKCQkJCTAsIDAsIDEsIHosCgkJCQkwLCAwLCAwLCAxCgoJCQkpOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgltYWtlUm90YXRpb25YKCB0aGV0YSApIHsKCgkJY29uc3QgYyA9IE1hdGguY29zKCB0aGV0YSApLCBzID0gTWF0aC5zaW4oIHRoZXRhICk7CgoJCXRoaXMuc2V0KAoKCQkJMSwgMCwgMCwgMCwKCQkJMCwgYywgLSBzLCAwLAoJCQkwLCBzLCBjLCAwLAoJCQkwLCAwLCAwLCAxCgoJCSk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltYWtlUm90YXRpb25ZKCB0aGV0YSApIHsKCgkJY29uc3QgYyA9IE1hdGguY29zKCB0aGV0YSApLCBzID0gTWF0aC5zaW4oIHRoZXRhICk7CgoJCXRoaXMuc2V0KAoKCQkJIGMsIDAsIHMsIDAsCgkJCSAwLCAxLCAwLCAwLAoJCQktIHMsIDAsIGMsIDAsCgkJCSAwLCAwLCAwLCAxCgoJCSk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltYWtlUm90YXRpb25aKCB0aGV0YSApIHsKCgkJY29uc3QgYyA9IE1hdGguY29zKCB0aGV0YSApLCBzID0gTWF0aC5zaW4oIHRoZXRhICk7CgoJCXRoaXMuc2V0KAoKCQkJYywgLSBzLCAwLCAwLAoJCQlzLCBjLCAwLCAwLAoJCQkwLCAwLCAxLCAwLAoJCQkwLCAwLCAwLCAxCgoJCSk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltYWtlUm90YXRpb25BeGlzKCBheGlzLCBhbmdsZSApIHsKCgkJLy8gQmFzZWQgb24gaHR0cDovL3d3dy5nYW1lZGV2Lm5ldC9yZWZlcmVuY2UvYXJ0aWNsZXMvYXJ0aWNsZTExOTkuYXNwCgoJCWNvbnN0IGMgPSBNYXRoLmNvcyggYW5nbGUgKTsKCQljb25zdCBzID0gTWF0aC5zaW4oIGFuZ2xlICk7CgkJY29uc3QgdCA9IDEgLSBjOwoJCWNvbnN0IHggPSBheGlzLngsIHkgPSBheGlzLnksIHogPSBheGlzLno7CgkJY29uc3QgdHggPSB0ICogeCwgdHkgPSB0ICogeTsKCgkJdGhpcy5zZXQoCgoJCQl0eCAqIHggKyBjLCB0eCAqIHkgLSBzICogeiwgdHggKiB6ICsgcyAqIHksIDAsCgkJCXR4ICogeSArIHMgKiB6LCB0eSAqIHkgKyBjLCB0eSAqIHogLSBzICogeCwgMCwKCQkJdHggKiB6IC0gcyAqIHksIHR5ICogeiArIHMgKiB4LCB0ICogeiAqIHogKyBjLCAwLAoJCQkwLCAwLCAwLCAxCgoJCSk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltYWtlU2NhbGUoIHgsIHksIHogKSB7CgoJCXRoaXMuc2V0KAoKCQkJeCwgMCwgMCwgMCwKCQkJMCwgeSwgMCwgMCwKCQkJMCwgMCwgeiwgMCwKCQkJMCwgMCwgMCwgMQoKCQkpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbWFrZVNoZWFyKCB4eSwgeHosIHl4LCB5eiwgengsIHp5ICkgewoKCQl0aGlzLnNldCgKCgkJCTEsIHl4LCB6eCwgMCwKCQkJeHksIDEsIHp5LCAwLAoJCQl4eiwgeXosIDEsIDAsCgkJCTAsIDAsIDAsIDEKCgkJKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvbXBvc2UoIHBvc2l0aW9uLCBxdWF0ZXJuaW9uLCBzY2FsZSApIHsKCgkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQljb25zdCB4ID0gcXVhdGVybmlvbi5feCwgeSA9IHF1YXRlcm5pb24uX3ksIHogPSBxdWF0ZXJuaW9uLl96LCB3ID0gcXVhdGVybmlvbi5fdzsKCQljb25zdCB4MiA9IHggKyB4LAl5MiA9IHkgKyB5LCB6MiA9IHogKyB6OwoJCWNvbnN0IHh4ID0geCAqIHgyLCB4eSA9IHggKiB5MiwgeHogPSB4ICogejI7CgkJY29uc3QgeXkgPSB5ICogeTIsIHl6ID0geSAqIHoyLCB6eiA9IHogKiB6MjsKCQljb25zdCB3eCA9IHcgKiB4Miwgd3kgPSB3ICogeTIsIHd6ID0gdyAqIHoyOwoKCQljb25zdCBzeCA9IHNjYWxlLngsIHN5ID0gc2NhbGUueSwgc3ogPSBzY2FsZS56OwoKCQl0ZVsgMCBdID0gKCAxIC0gKCB5eSArIHp6ICkgKSAqIHN4OwoJCXRlWyAxIF0gPSAoIHh5ICsgd3ogKSAqIHN4OwoJCXRlWyAyIF0gPSAoIHh6IC0gd3kgKSAqIHN4OwoJCXRlWyAzIF0gPSAwOwoKCQl0ZVsgNCBdID0gKCB4eSAtIHd6ICkgKiBzeTsKCQl0ZVsgNSBdID0gKCAxIC0gKCB4eCArIHp6ICkgKSAqIHN5OwoJCXRlWyA2IF0gPSAoIHl6ICsgd3ggKSAqIHN5OwoJCXRlWyA3IF0gPSAwOwoKCQl0ZVsgOCBdID0gKCB4eiArIHd5ICkgKiBzejsKCQl0ZVsgOSBdID0gKCB5eiAtIHd4ICkgKiBzejsKCQl0ZVsgMTAgXSA9ICggMSAtICggeHggKyB5eSApICkgKiBzejsKCQl0ZVsgMTEgXSA9IDA7CgoJCXRlWyAxMiBdID0gcG9zaXRpb24ueDsKCQl0ZVsgMTMgXSA9IHBvc2l0aW9uLnk7CgkJdGVbIDE0IF0gPSBwb3NpdGlvbi56OwoJCXRlWyAxNSBdID0gMTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWRlY29tcG9zZSggcG9zaXRpb24sIHF1YXRlcm5pb24sIHNjYWxlICkgewoKCQljb25zdCB0ZSA9IHRoaXMuZWxlbWVudHM7CgoJCWxldCBzeCA9IF92MSQ1LnNldCggdGVbIDAgXSwgdGVbIDEgXSwgdGVbIDIgXSApLmxlbmd0aCgpOwoJCWNvbnN0IHN5ID0gX3YxJDUuc2V0KCB0ZVsgNCBdLCB0ZVsgNSBdLCB0ZVsgNiBdICkubGVuZ3RoKCk7CgkJY29uc3Qgc3ogPSBfdjEkNS5zZXQoIHRlWyA4IF0sIHRlWyA5IF0sIHRlWyAxMCBdICkubGVuZ3RoKCk7CgoJCS8vIGlmIGRldGVybWluZSBpcyBuZWdhdGl2ZSwgd2UgbmVlZCB0byBpbnZlcnQgb25lIHNjYWxlCgkJY29uc3QgZGV0ID0gdGhpcy5kZXRlcm1pbmFudCgpOwoJCWlmICggZGV0IDwgMCApIHN4ID0gLSBzeDsKCgkJcG9zaXRpb24ueCA9IHRlWyAxMiBdOwoJCXBvc2l0aW9uLnkgPSB0ZVsgMTMgXTsKCQlwb3NpdGlvbi56ID0gdGVbIDE0IF07CgoJCS8vIHNjYWxlIHRoZSByb3RhdGlvbiBwYXJ0CgkJX20xJDIuY29weSggdGhpcyApOwoKCQljb25zdCBpbnZTWCA9IDEgLyBzeDsKCQljb25zdCBpbnZTWSA9IDEgLyBzeTsKCQljb25zdCBpbnZTWiA9IDEgLyBzejsKCgkJX20xJDIuZWxlbWVudHNbIDAgXSAqPSBpbnZTWDsKCQlfbTEkMi5lbGVtZW50c1sgMSBdICo9IGludlNYOwoJCV9tMSQyLmVsZW1lbnRzWyAyIF0gKj0gaW52U1g7CgoJCV9tMSQyLmVsZW1lbnRzWyA0IF0gKj0gaW52U1k7CgkJX20xJDIuZWxlbWVudHNbIDUgXSAqPSBpbnZTWTsKCQlfbTEkMi5lbGVtZW50c1sgNiBdICo9IGludlNZOwoKCQlfbTEkMi5lbGVtZW50c1sgOCBdICo9IGludlNaOwoJCV9tMSQyLmVsZW1lbnRzWyA5IF0gKj0gaW52U1o7CgkJX20xJDIuZWxlbWVudHNbIDEwIF0gKj0gaW52U1o7CgoJCXF1YXRlcm5pb24uc2V0RnJvbVJvdGF0aW9uTWF0cml4KCBfbTEkMiApOwoKCQlzY2FsZS54ID0gc3g7CgkJc2NhbGUueSA9IHN5OwoJCXNjYWxlLnogPSBzejsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCW1ha2VQZXJzcGVjdGl2ZSggbGVmdCwgcmlnaHQsIHRvcCwgYm90dG9tLCBuZWFyLCBmYXIsIGNvb3JkaW5hdGVTeXN0ZW0gPSBXZWJHTENvb3JkaW5hdGVTeXN0ZW0gKSB7CgoJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCQljb25zdCB4ID0gMiAqIG5lYXIgLyAoIHJpZ2h0IC0gbGVmdCApOwoJCWNvbnN0IHkgPSAyICogbmVhciAvICggdG9wIC0gYm90dG9tICk7CgoJCWNvbnN0IGEgPSAoIHJpZ2h0ICsgbGVmdCApIC8gKCByaWdodCAtIGxlZnQgKTsKCQljb25zdCBiID0gKCB0b3AgKyBib3R0b20gKSAvICggdG9wIC0gYm90dG9tICk7CgoJCWxldCBjLCBkOwoKCQlpZiAoIGNvb3JkaW5hdGVTeXN0ZW0gPT09IFdlYkdMQ29vcmRpbmF0ZVN5c3RlbSApIHsKCgkJCWMgPSAtICggZmFyICsgbmVhciApIC8gKCBmYXIgLSBuZWFyICk7CgkJCWQgPSAoIC0gMiAqIGZhciAqIG5lYXIgKSAvICggZmFyIC0gbmVhciApOwoKCQl9IGVsc2UgaWYgKCBjb29yZGluYXRlU3lzdGVtID09PSBXZWJHUFVDb29yZGluYXRlU3lzdGVtICkgewoKCQkJYyA9IC0gZmFyIC8gKCBmYXIgLSBuZWFyICk7CgkJCWQgPSAoIC0gZmFyICogbmVhciApIC8gKCBmYXIgLSBuZWFyICk7CgoJCX0gZWxzZSB7CgoJCQl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5NYXRyaXg0Lm1ha2VQZXJzcGVjdGl2ZSgpOiBJbnZhbGlkIGNvb3JkaW5hdGUgc3lzdGVtOiAnICsgY29vcmRpbmF0ZVN5c3RlbSApOwoKCQl9CgoJCXRlWyAwIF0gPSB4Owl0ZVsgNCBdID0gMDsJdGVbIDggXSA9IGE7IAl0ZVsgMTIgXSA9IDA7CgkJdGVbIDEgXSA9IDA7CXRlWyA1IF0gPSB5Owl0ZVsgOSBdID0gYjsgCXRlWyAxMyBdID0gMDsKCQl0ZVsgMiBdID0gMDsJdGVbIDYgXSA9IDA7CXRlWyAxMCBdID0gYzsgCXRlWyAxNCBdID0gZDsKCQl0ZVsgMyBdID0gMDsJdGVbIDcgXSA9IDA7CXRlWyAxMSBdID0gLSAxOwl0ZVsgMTUgXSA9IDA7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltYWtlT3J0aG9ncmFwaGljKCBsZWZ0LCByaWdodCwgdG9wLCBib3R0b20sIG5lYXIsIGZhciwgY29vcmRpbmF0ZVN5c3RlbSA9IFdlYkdMQ29vcmRpbmF0ZVN5c3RlbSApIHsKCgkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoJCWNvbnN0IHcgPSAxLjAgLyAoIHJpZ2h0IC0gbGVmdCApOwoJCWNvbnN0IGggPSAxLjAgLyAoIHRvcCAtIGJvdHRvbSApOwoJCWNvbnN0IHAgPSAxLjAgLyAoIGZhciAtIG5lYXIgKTsKCgkJY29uc3QgeCA9ICggcmlnaHQgKyBsZWZ0ICkgKiB3OwoJCWNvbnN0IHkgPSAoIHRvcCArIGJvdHRvbSApICogaDsKCgkJbGV0IHosIHpJbnY7CgoJCWlmICggY29vcmRpbmF0ZVN5c3RlbSA9PT0gV2ViR0xDb29yZGluYXRlU3lzdGVtICkgewoKCQkJeiA9ICggZmFyICsgbmVhciApICogcDsKCQkJekludiA9IC0gMiAqIHA7CgoJCX0gZWxzZSBpZiAoIGNvb3JkaW5hdGVTeXN0ZW0gPT09IFdlYkdQVUNvb3JkaW5hdGVTeXN0ZW0gKSB7CgoJCQl6ID0gbmVhciAqIHA7CgkJCXpJbnYgPSAtIDEgKiBwOwoKCQl9IGVsc2UgewoKCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuTWF0cml4NC5tYWtlT3J0aG9ncmFwaGljKCk6IEludmFsaWQgY29vcmRpbmF0ZSBzeXN0ZW06ICcgKyBjb29yZGluYXRlU3lzdGVtICk7CgoJCX0KCgkJdGVbIDAgXSA9IDIgKiB3Owl0ZVsgNCBdID0gMDsJCXRlWyA4IF0gPSAwOyAJCXRlWyAxMiBdID0gLSB4OwoJCXRlWyAxIF0gPSAwOyAJCXRlWyA1IF0gPSAyICogaDsJdGVbIDkgXSA9IDA7IAkJdGVbIDEzIF0gPSAtIHk7CgkJdGVbIDIgXSA9IDA7IAkJdGVbIDYgXSA9IDA7CQl0ZVsgMTAgXSA9IHpJbnY7CXRlWyAxNCBdID0gLSB6OwoJCXRlWyAzIF0gPSAwOyAJCXRlWyA3IF0gPSAwOwkJdGVbIDExIF0gPSAwOwkJdGVbIDE1IF0gPSAxOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZXF1YWxzKCBtYXRyaXggKSB7CgoJCWNvbnN0IHRlID0gdGhpcy5lbGVtZW50czsKCQljb25zdCBtZSA9IG1hdHJpeC5lbGVtZW50czsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgMTY7IGkgKysgKSB7CgoJCQlpZiAoIHRlWyBpIF0gIT09IG1lWyBpIF0gKSByZXR1cm4gZmFsc2U7CgoJCX0KCgkJcmV0dXJuIHRydWU7CgoJfQoKCWZyb21BcnJheSggYXJyYXksIG9mZnNldCA9IDAgKSB7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IDE2OyBpICsrICkgewoKCQkJdGhpcy5lbGVtZW50c1sgaSBdID0gYXJyYXlbIGkgKyBvZmZzZXQgXTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9BcnJheSggYXJyYXkgPSBbXSwgb2Zmc2V0ID0gMCApIHsKCgkJY29uc3QgdGUgPSB0aGlzLmVsZW1lbnRzOwoKCQlhcnJheVsgb2Zmc2V0IF0gPSB0ZVsgMCBdOwoJCWFycmF5WyBvZmZzZXQgKyAxIF0gPSB0ZVsgMSBdOwoJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0ZVsgMiBdOwoJCWFycmF5WyBvZmZzZXQgKyAzIF0gPSB0ZVsgMyBdOwoKCQlhcnJheVsgb2Zmc2V0ICsgNCBdID0gdGVbIDQgXTsKCQlhcnJheVsgb2Zmc2V0ICsgNSBdID0gdGVbIDUgXTsKCQlhcnJheVsgb2Zmc2V0ICsgNiBdID0gdGVbIDYgXTsKCQlhcnJheVsgb2Zmc2V0ICsgNyBdID0gdGVbIDcgXTsKCgkJYXJyYXlbIG9mZnNldCArIDggXSA9IHRlWyA4IF07CgkJYXJyYXlbIG9mZnNldCArIDkgXSA9IHRlWyA5IF07CgkJYXJyYXlbIG9mZnNldCArIDEwIF0gPSB0ZVsgMTAgXTsKCQlhcnJheVsgb2Zmc2V0ICsgMTEgXSA9IHRlWyAxMSBdOwoKCQlhcnJheVsgb2Zmc2V0ICsgMTIgXSA9IHRlWyAxMiBdOwoJCWFycmF5WyBvZmZzZXQgKyAxMyBdID0gdGVbIDEzIF07CgkJYXJyYXlbIG9mZnNldCArIDE0IF0gPSB0ZVsgMTQgXTsKCQlhcnJheVsgb2Zmc2V0ICsgMTUgXSA9IHRlWyAxNSBdOwoKCQlyZXR1cm4gYXJyYXk7CgoJfQoKfQoKY29uc3QgX3YxJDUgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF9tMSQyID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwpjb25zdCBfemVybyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDAsIDAsIDAgKTsKY29uc3QgX29uZSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDEsIDEsIDEgKTsKY29uc3QgX3ggPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF95ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfeiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNvbnN0IF9tYXRyaXggPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXg0KCk7CmNvbnN0IF9xdWF0ZXJuaW9uJDMgPSAvKkBfX1BVUkVfXyovIG5ldyBRdWF0ZXJuaW9uKCk7CgpjbGFzcyBFdWxlciB7CgoJY29uc3RydWN0b3IoIHggPSAwLCB5ID0gMCwgeiA9IDAsIG9yZGVyID0gRXVsZXIuREVGQVVMVF9PUkRFUiApIHsKCgkJdGhpcy5pc0V1bGVyID0gdHJ1ZTsKCgkJdGhpcy5feCA9IHg7CgkJdGhpcy5feSA9IHk7CgkJdGhpcy5feiA9IHo7CgkJdGhpcy5fb3JkZXIgPSBvcmRlcjsKCgl9CgoJZ2V0IHgoKSB7CgoJCXJldHVybiB0aGlzLl94OwoKCX0KCglzZXQgeCggdmFsdWUgKSB7CgoJCXRoaXMuX3ggPSB2YWx1ZTsKCQl0aGlzLl9vbkNoYW5nZUNhbGxiYWNrKCk7CgoJfQoKCWdldCB5KCkgewoKCQlyZXR1cm4gdGhpcy5feTsKCgl9CgoJc2V0IHkoIHZhbHVlICkgewoKCQl0aGlzLl95ID0gdmFsdWU7CgkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCX0KCglnZXQgeigpIHsKCgkJcmV0dXJuIHRoaXMuX3o7CgoJfQoKCXNldCB6KCB2YWx1ZSApIHsKCgkJdGhpcy5feiA9IHZhbHVlOwoJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCgl9CgoJZ2V0IG9yZGVyKCkgewoKCQlyZXR1cm4gdGhpcy5fb3JkZXI7CgoJfQoKCXNldCBvcmRlciggdmFsdWUgKSB7CgoJCXRoaXMuX29yZGVyID0gdmFsdWU7CgkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCX0KCglzZXQoIHgsIHksIHosIG9yZGVyID0gdGhpcy5fb3JkZXIgKSB7CgoJCXRoaXMuX3ggPSB4OwoJCXRoaXMuX3kgPSB5OwoJCXRoaXMuX3ogPSB6OwoJCXRoaXMuX29yZGVyID0gb3JkZXI7CgoJCXRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMuX3gsIHRoaXMuX3ksIHRoaXMuX3osIHRoaXMuX29yZGVyICk7CgoJfQoKCWNvcHkoIGV1bGVyICkgewoKCQl0aGlzLl94ID0gZXVsZXIuX3g7CgkJdGhpcy5feSA9IGV1bGVyLl95OwoJCXRoaXMuX3ogPSBldWxlci5fejsKCQl0aGlzLl9vcmRlciA9IGV1bGVyLl9vcmRlcjsKCgkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RnJvbVJvdGF0aW9uTWF0cml4KCBtLCBvcmRlciA9IHRoaXMuX29yZGVyLCB1cGRhdGUgPSB0cnVlICkgewoKCQkvLyBhc3N1bWVzIHRoZSB1cHBlciAzeDMgb2YgbSBpcyBhIHB1cmUgcm90YXRpb24gbWF0cml4IChpLmUsIHVuc2NhbGVkKQoKCQljb25zdCB0ZSA9IG0uZWxlbWVudHM7CgkJY29uc3QgbTExID0gdGVbIDAgXSwgbTEyID0gdGVbIDQgXSwgbTEzID0gdGVbIDggXTsKCQljb25zdCBtMjEgPSB0ZVsgMSBdLCBtMjIgPSB0ZVsgNSBdLCBtMjMgPSB0ZVsgOSBdOwoJCWNvbnN0IG0zMSA9IHRlWyAyIF0sIG0zMiA9IHRlWyA2IF0sIG0zMyA9IHRlWyAxMCBdOwoKCQlzd2l0Y2ggKCBvcmRlciApIHsKCgkJCWNhc2UgJ1hZWic6CgoJCQkJdGhpcy5feSA9IE1hdGguYXNpbiggY2xhbXAoIG0xMywgLSAxLCAxICkgKTsKCgkJCQlpZiAoIE1hdGguYWJzKCBtMTMgKSA8IDAuOTk5OTk5OSApIHsKCgkJCQkJdGhpcy5feCA9IE1hdGguYXRhbjIoIC0gbTIzLCBtMzMgKTsKCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggLSBtMTIsIG0xMSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXRoaXMuX3ggPSBNYXRoLmF0YW4yKCBtMzIsIG0yMiApOwoJCQkJCXRoaXMuX3ogPSAwOwoKCQkJCX0KCgkJCQlicmVhazsKCgkJCWNhc2UgJ1lYWic6CgoJCQkJdGhpcy5feCA9IE1hdGguYXNpbiggLSBjbGFtcCggbTIzLCAtIDEsIDEgKSApOwoKCQkJCWlmICggTWF0aC5hYnMoIG0yMyApIDwgMC45OTk5OTk5ICkgewoKCQkJCQl0aGlzLl95ID0gTWF0aC5hdGFuMiggbTEzLCBtMzMgKTsKCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggbTIxLCBtMjIgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQl0aGlzLl95ID0gTWF0aC5hdGFuMiggLSBtMzEsIG0xMSApOwoJCQkJCXRoaXMuX3ogPSAwOwoKCQkJCX0KCgkJCQlicmVhazsKCgkJCWNhc2UgJ1pYWSc6CgoJCQkJdGhpcy5feCA9IE1hdGguYXNpbiggY2xhbXAoIG0zMiwgLSAxLCAxICkgKTsKCgkJCQlpZiAoIE1hdGguYWJzKCBtMzIgKSA8IDAuOTk5OTk5OSApIHsKCgkJCQkJdGhpcy5feSA9IE1hdGguYXRhbjIoIC0gbTMxLCBtMzMgKTsKCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggLSBtMTIsIG0yMiApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXRoaXMuX3kgPSAwOwoJCQkJCXRoaXMuX3ogPSBNYXRoLmF0YW4yKCBtMjEsIG0xMSApOwoKCQkJCX0KCgkJCQlicmVhazsKCgkJCWNhc2UgJ1pZWCc6CgoJCQkJdGhpcy5feSA9IE1hdGguYXNpbiggLSBjbGFtcCggbTMxLCAtIDEsIDEgKSApOwoKCQkJCWlmICggTWF0aC5hYnMoIG0zMSApIDwgMC45OTk5OTk5ICkgewoKCQkJCQl0aGlzLl94ID0gTWF0aC5hdGFuMiggbTMyLCBtMzMgKTsKCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggbTIxLCBtMTEgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQl0aGlzLl94ID0gMDsKCQkJCQl0aGlzLl96ID0gTWF0aC5hdGFuMiggLSBtMTIsIG0yMiApOwoKCQkJCX0KCgkJCQlicmVhazsKCgkJCWNhc2UgJ1laWCc6CgoJCQkJdGhpcy5feiA9IE1hdGguYXNpbiggY2xhbXAoIG0yMSwgLSAxLCAxICkgKTsKCgkJCQlpZiAoIE1hdGguYWJzKCBtMjEgKSA8IDAuOTk5OTk5OSApIHsKCgkJCQkJdGhpcy5feCA9IE1hdGguYXRhbjIoIC0gbTIzLCBtMjIgKTsKCQkJCQl0aGlzLl95ID0gTWF0aC5hdGFuMiggLSBtMzEsIG0xMSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXRoaXMuX3ggPSAwOwoJCQkJCXRoaXMuX3kgPSBNYXRoLmF0YW4yKCBtMTMsIG0zMyApOwoKCQkJCX0KCgkJCQlicmVhazsKCgkJCWNhc2UgJ1haWSc6CgoJCQkJdGhpcy5feiA9IE1hdGguYXNpbiggLSBjbGFtcCggbTEyLCAtIDEsIDEgKSApOwoKCQkJCWlmICggTWF0aC5hYnMoIG0xMiApIDwgMC45OTk5OTk5ICkgewoKCQkJCQl0aGlzLl94ID0gTWF0aC5hdGFuMiggbTMyLCBtMjIgKTsKCQkJCQl0aGlzLl95ID0gTWF0aC5hdGFuMiggbTEzLCBtMTEgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQl0aGlzLl94ID0gTWF0aC5hdGFuMiggLSBtMjMsIG0zMyApOwoJCQkJCXRoaXMuX3kgPSAwOwoKCQkJCX0KCgkJCQlicmVhazsKCgkJCWRlZmF1bHQ6CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuRXVsZXI6IC5zZXRGcm9tUm90YXRpb25NYXRyaXgoKSBlbmNvdW50ZXJlZCBhbiB1bmtub3duIG9yZGVyOiAnICsgb3JkZXIgKTsKCgkJfQoKCQl0aGlzLl9vcmRlciA9IG9yZGVyOwoKCQlpZiAoIHVwZGF0ZSA9PT0gdHJ1ZSApIHRoaXMuX29uQ2hhbmdlQ2FsbGJhY2soKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldEZyb21RdWF0ZXJuaW9uKCBxLCBvcmRlciwgdXBkYXRlICkgewoKCQlfbWF0cml4Lm1ha2VSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKCBxICk7CgoJCXJldHVybiB0aGlzLnNldEZyb21Sb3RhdGlvbk1hdHJpeCggX21hdHJpeCwgb3JkZXIsIHVwZGF0ZSApOwoKCX0KCglzZXRGcm9tVmVjdG9yMyggdiwgb3JkZXIgPSB0aGlzLl9vcmRlciApIHsKCgkJcmV0dXJuIHRoaXMuc2V0KCB2LngsIHYueSwgdi56LCBvcmRlciApOwoKCX0KCglyZW9yZGVyKCBuZXdPcmRlciApIHsKCgkJLy8gV0FSTklORzogdGhpcyBkaXNjYXJkcyByZXZvbHV0aW9uIGluZm9ybWF0aW9uIC1iaG91c3RvbgoKCQlfcXVhdGVybmlvbiQzLnNldEZyb21FdWxlciggdGhpcyApOwoKCQlyZXR1cm4gdGhpcy5zZXRGcm9tUXVhdGVybmlvbiggX3F1YXRlcm5pb24kMywgbmV3T3JkZXIgKTsKCgl9CgoJZXF1YWxzKCBldWxlciApIHsKCgkJcmV0dXJuICggZXVsZXIuX3ggPT09IHRoaXMuX3ggKSAmJiAoIGV1bGVyLl95ID09PSB0aGlzLl95ICkgJiYgKCBldWxlci5feiA9PT0gdGhpcy5feiApICYmICggZXVsZXIuX29yZGVyID09PSB0aGlzLl9vcmRlciApOwoKCX0KCglmcm9tQXJyYXkoIGFycmF5ICkgewoKCQl0aGlzLl94ID0gYXJyYXlbIDAgXTsKCQl0aGlzLl95ID0gYXJyYXlbIDEgXTsKCQl0aGlzLl96ID0gYXJyYXlbIDIgXTsKCQlpZiAoIGFycmF5WyAzIF0gIT09IHVuZGVmaW5lZCApIHRoaXMuX29yZGVyID0gYXJyYXlbIDMgXTsKCgkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjaygpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9BcnJheSggYXJyYXkgPSBbXSwgb2Zmc2V0ID0gMCApIHsKCgkJYXJyYXlbIG9mZnNldCBdID0gdGhpcy5feDsKCQlhcnJheVsgb2Zmc2V0ICsgMSBdID0gdGhpcy5feTsKCQlhcnJheVsgb2Zmc2V0ICsgMiBdID0gdGhpcy5fejsKCQlhcnJheVsgb2Zmc2V0ICsgMyBdID0gdGhpcy5fb3JkZXI7CgoJCXJldHVybiBhcnJheTsKCgl9CgoJX29uQ2hhbmdlKCBjYWxsYmFjayApIHsKCgkJdGhpcy5fb25DaGFuZ2VDYWxsYmFjayA9IGNhbGxiYWNrOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJX29uQ2hhbmdlQ2FsbGJhY2soKSB7fQoKCSpbIFN5bWJvbC5pdGVyYXRvciBdKCkgewoKCQl5aWVsZCB0aGlzLl94OwoJCXlpZWxkIHRoaXMuX3k7CgkJeWllbGQgdGhpcy5fejsKCQl5aWVsZCB0aGlzLl9vcmRlcjsKCgl9Cgp9CgpFdWxlci5ERUZBVUxUX09SREVSID0gJ1hZWic7CgpjbGFzcyBMYXllcnMgewoKCWNvbnN0cnVjdG9yKCkgewoKCQl0aGlzLm1hc2sgPSAxIHwgMDsKCgl9CgoJc2V0KCBjaGFubmVsICkgewoKCQl0aGlzLm1hc2sgPSAoIDEgPDwgY2hhbm5lbCB8IDAgKSA+Pj4gMDsKCgl9CgoJZW5hYmxlKCBjaGFubmVsICkgewoKCQl0aGlzLm1hc2sgfD0gMSA8PCBjaGFubmVsIHwgMDsKCgl9CgoJZW5hYmxlQWxsKCkgewoKCQl0aGlzLm1hc2sgPSAweGZmZmZmZmZmIHwgMDsKCgl9CgoJdG9nZ2xlKCBjaGFubmVsICkgewoKCQl0aGlzLm1hc2sgXj0gMSA8PCBjaGFubmVsIHwgMDsKCgl9CgoJZGlzYWJsZSggY2hhbm5lbCApIHsKCgkJdGhpcy5tYXNrICY9IH4gKCAxIDw8IGNoYW5uZWwgfCAwICk7CgoJfQoKCWRpc2FibGVBbGwoKSB7CgoJCXRoaXMubWFzayA9IDA7CgoJfQoKCXRlc3QoIGxheWVycyApIHsKCgkJcmV0dXJuICggdGhpcy5tYXNrICYgbGF5ZXJzLm1hc2sgKSAhPT0gMDsKCgl9CgoJaXNFbmFibGVkKCBjaGFubmVsICkgewoKCQlyZXR1cm4gKCB0aGlzLm1hc2sgJiAoIDEgPDwgY2hhbm5lbCB8IDAgKSApICE9PSAwOwoKCX0KCn0KCmxldCBfb2JqZWN0M0RJZCA9IDA7Cgpjb25zdCBfdjEkNCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3ExID0gLypAX19QVVJFX18qLyBuZXcgUXVhdGVybmlvbigpOwpjb25zdCBfbTEkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKY29uc3QgX3RhcmdldCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNvbnN0IF9wb3NpdGlvbiQzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfc2NhbGUkMiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3F1YXRlcm5pb24kMiA9IC8qQF9fUFVSRV9fKi8gbmV3IFF1YXRlcm5pb24oKTsKCmNvbnN0IF94QXhpcyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDEsIDAsIDAgKTsKY29uc3QgX3lBeGlzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggMCwgMSwgMCApOwpjb25zdCBfekF4aXMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAwLCAwLCAxICk7Cgpjb25zdCBfYWRkZWRFdmVudCA9IHsgdHlwZTogJ2FkZGVkJyB9Owpjb25zdCBfcmVtb3ZlZEV2ZW50ID0geyB0eXBlOiAncmVtb3ZlZCcgfTsKCmNsYXNzIE9iamVjdDNEIGV4dGVuZHMgRXZlbnREaXNwYXRjaGVyIHsKCgljb25zdHJ1Y3RvcigpIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc09iamVjdDNEID0gdHJ1ZTsKCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KCB0aGlzLCAnaWQnLCB7IHZhbHVlOiBfb2JqZWN0M0RJZCArKyB9ICk7CgoJCXRoaXMudXVpZCA9IGdlbmVyYXRlVVVJRCgpOwoKCQl0aGlzLm5hbWUgPSAnJzsKCQl0aGlzLnR5cGUgPSAnT2JqZWN0M0QnOwoKCQl0aGlzLnBhcmVudCA9IG51bGw7CgkJdGhpcy5jaGlsZHJlbiA9IFtdOwoKCQl0aGlzLnVwID0gT2JqZWN0M0QuREVGQVVMVF9VUC5jbG9uZSgpOwoKCQljb25zdCBwb3NpdGlvbiA9IG5ldyBWZWN0b3IzKCk7CgkJY29uc3Qgcm90YXRpb24gPSBuZXcgRXVsZXIoKTsKCQljb25zdCBxdWF0ZXJuaW9uID0gbmV3IFF1YXRlcm5pb24oKTsKCQljb25zdCBzY2FsZSA9IG5ldyBWZWN0b3IzKCAxLCAxLCAxICk7CgoJCWZ1bmN0aW9uIG9uUm90YXRpb25DaGFuZ2UoKSB7CgoJCQlxdWF0ZXJuaW9uLnNldEZyb21FdWxlciggcm90YXRpb24sIGZhbHNlICk7CgoJCX0KCgkJZnVuY3Rpb24gb25RdWF0ZXJuaW9uQ2hhbmdlKCkgewoKCQkJcm90YXRpb24uc2V0RnJvbVF1YXRlcm5pb24oIHF1YXRlcm5pb24sIHVuZGVmaW5lZCwgZmFsc2UgKTsKCgkJfQoKCQlyb3RhdGlvbi5fb25DaGFuZ2UoIG9uUm90YXRpb25DaGFuZ2UgKTsKCQlxdWF0ZXJuaW9uLl9vbkNoYW5nZSggb25RdWF0ZXJuaW9uQ2hhbmdlICk7CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCB0aGlzLCB7CgkJCXBvc2l0aW9uOiB7CgkJCQljb25maWd1cmFibGU6IHRydWUsCgkJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQkJdmFsdWU6IHBvc2l0aW9uCgkJCX0sCgkJCXJvdGF0aW9uOiB7CgkJCQljb25maWd1cmFibGU6IHRydWUsCgkJCQllbnVtZXJhYmxlOiB0cnVlLAoJCQkJdmFsdWU6IHJvdGF0aW9uCgkJCX0sCgkJCXF1YXRlcm5pb246IHsKCQkJCWNvbmZpZ3VyYWJsZTogdHJ1ZSwKCQkJCWVudW1lcmFibGU6IHRydWUsCgkJCQl2YWx1ZTogcXVhdGVybmlvbgoJCQl9LAoJCQlzY2FsZTogewoJCQkJY29uZmlndXJhYmxlOiB0cnVlLAoJCQkJZW51bWVyYWJsZTogdHJ1ZSwKCQkJCXZhbHVlOiBzY2FsZQoJCQl9LAoJCQltb2RlbFZpZXdNYXRyaXg6IHsKCQkJCXZhbHVlOiBuZXcgTWF0cml4NCgpCgkJCX0sCgkJCW5vcm1hbE1hdHJpeDogewoJCQkJdmFsdWU6IG5ldyBNYXRyaXgzKCkKCQkJfQoJCX0gKTsKCgkJdGhpcy5tYXRyaXggPSBuZXcgTWF0cml4NCgpOwoJCXRoaXMubWF0cml4V29ybGQgPSBuZXcgTWF0cml4NCgpOwoKCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBPYmplY3QzRC5ERUZBVUxUX01BVFJJWF9BVVRPX1VQREFURTsKCQl0aGlzLm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgPSBmYWxzZTsKCgkJdGhpcy5tYXRyaXhXb3JsZEF1dG9VcGRhdGUgPSBPYmplY3QzRC5ERUZBVUxUX01BVFJJWF9XT1JMRF9BVVRPX1VQREFURTsgLy8gY2hlY2tlZCBieSB0aGUgcmVuZGVyZXIKCgkJdGhpcy5sYXllcnMgPSBuZXcgTGF5ZXJzKCk7CgkJdGhpcy52aXNpYmxlID0gdHJ1ZTsKCgkJdGhpcy5jYXN0U2hhZG93ID0gZmFsc2U7CgkJdGhpcy5yZWNlaXZlU2hhZG93ID0gZmFsc2U7CgoJCXRoaXMuZnJ1c3R1bUN1bGxlZCA9IHRydWU7CgkJdGhpcy5yZW5kZXJPcmRlciA9IDA7CgoJCXRoaXMuYW5pbWF0aW9ucyA9IFtdOwoKCQl0aGlzLnVzZXJEYXRhID0ge307CgoJfQoKCW9uQmVmb3JlUmVuZGVyKCAvKiByZW5kZXJlciwgc2NlbmUsIGNhbWVyYSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cCAqLyApIHt9CgoJb25BZnRlclJlbmRlciggLyogcmVuZGVyZXIsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXAgKi8gKSB7fQoKCWFwcGx5TWF0cml4NCggbWF0cml4ICkgewoKCQlpZiAoIHRoaXMubWF0cml4QXV0b1VwZGF0ZSApIHRoaXMudXBkYXRlTWF0cml4KCk7CgoJCXRoaXMubWF0cml4LnByZW11bHRpcGx5KCBtYXRyaXggKTsKCgkJdGhpcy5tYXRyaXguZGVjb21wb3NlKCB0aGlzLnBvc2l0aW9uLCB0aGlzLnF1YXRlcm5pb24sIHRoaXMuc2NhbGUgKTsKCgl9CgoJYXBwbHlRdWF0ZXJuaW9uKCBxICkgewoKCQl0aGlzLnF1YXRlcm5pb24ucHJlbXVsdGlwbHkoIHEgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldFJvdGF0aW9uRnJvbUF4aXNBbmdsZSggYXhpcywgYW5nbGUgKSB7CgoJCS8vIGFzc3VtZXMgYXhpcyBpcyBub3JtYWxpemVkCgoJCXRoaXMucXVhdGVybmlvbi5zZXRGcm9tQXhpc0FuZ2xlKCBheGlzLCBhbmdsZSApOwoKCX0KCglzZXRSb3RhdGlvbkZyb21FdWxlciggZXVsZXIgKSB7CgoJCXRoaXMucXVhdGVybmlvbi5zZXRGcm9tRXVsZXIoIGV1bGVyLCB0cnVlICk7CgoJfQoKCXNldFJvdGF0aW9uRnJvbU1hdHJpeCggbSApIHsKCgkJLy8gYXNzdW1lcyB0aGUgdXBwZXIgM3gzIG9mIG0gaXMgYSBwdXJlIHJvdGF0aW9uIG1hdHJpeCAoaS5lLCB1bnNjYWxlZCkKCgkJdGhpcy5xdWF0ZXJuaW9uLnNldEZyb21Sb3RhdGlvbk1hdHJpeCggbSApOwoKCX0KCglzZXRSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKCBxICkgewoKCQkvLyBhc3N1bWVzIHEgaXMgbm9ybWFsaXplZAoKCQl0aGlzLnF1YXRlcm5pb24uY29weSggcSApOwoKCX0KCglyb3RhdGVPbkF4aXMoIGF4aXMsIGFuZ2xlICkgewoKCQkvLyByb3RhdGUgb2JqZWN0IG9uIGF4aXMgaW4gb2JqZWN0IHNwYWNlCgkJLy8gYXhpcyBpcyBhc3N1bWVkIHRvIGJlIG5vcm1hbGl6ZWQKCgkJX3ExLnNldEZyb21BeGlzQW5nbGUoIGF4aXMsIGFuZ2xlICk7CgoJCXRoaXMucXVhdGVybmlvbi5tdWx0aXBseSggX3ExICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglyb3RhdGVPbldvcmxkQXhpcyggYXhpcywgYW5nbGUgKSB7CgoJCS8vIHJvdGF0ZSBvYmplY3Qgb24gYXhpcyBpbiB3b3JsZCBzcGFjZQoJCS8vIGF4aXMgaXMgYXNzdW1lZCB0byBiZSBub3JtYWxpemVkCgkJLy8gbWV0aG9kIGFzc3VtZXMgbm8gcm90YXRlZCBwYXJlbnQKCgkJX3ExLnNldEZyb21BeGlzQW5nbGUoIGF4aXMsIGFuZ2xlICk7CgoJCXRoaXMucXVhdGVybmlvbi5wcmVtdWx0aXBseSggX3ExICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglyb3RhdGVYKCBhbmdsZSApIHsKCgkJcmV0dXJuIHRoaXMucm90YXRlT25BeGlzKCBfeEF4aXMsIGFuZ2xlICk7CgoJfQoKCXJvdGF0ZVkoIGFuZ2xlICkgewoKCQlyZXR1cm4gdGhpcy5yb3RhdGVPbkF4aXMoIF95QXhpcywgYW5nbGUgKTsKCgl9CgoJcm90YXRlWiggYW5nbGUgKSB7CgoJCXJldHVybiB0aGlzLnJvdGF0ZU9uQXhpcyggX3pBeGlzLCBhbmdsZSApOwoKCX0KCgl0cmFuc2xhdGVPbkF4aXMoIGF4aXMsIGRpc3RhbmNlICkgewoKCQkvLyB0cmFuc2xhdGUgb2JqZWN0IGJ5IGRpc3RhbmNlIGFsb25nIGF4aXMgaW4gb2JqZWN0IHNwYWNlCgkJLy8gYXhpcyBpcyBhc3N1bWVkIHRvIGJlIG5vcm1hbGl6ZWQKCgkJX3YxJDQuY29weSggYXhpcyApLmFwcGx5UXVhdGVybmlvbiggdGhpcy5xdWF0ZXJuaW9uICk7CgoJCXRoaXMucG9zaXRpb24uYWRkKCBfdjEkNC5tdWx0aXBseVNjYWxhciggZGlzdGFuY2UgKSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdHJhbnNsYXRlWCggZGlzdGFuY2UgKSB7CgoJCXJldHVybiB0aGlzLnRyYW5zbGF0ZU9uQXhpcyggX3hBeGlzLCBkaXN0YW5jZSApOwoKCX0KCgl0cmFuc2xhdGVZKCBkaXN0YW5jZSApIHsKCgkJcmV0dXJuIHRoaXMudHJhbnNsYXRlT25BeGlzKCBfeUF4aXMsIGRpc3RhbmNlICk7CgoJfQoKCXRyYW5zbGF0ZVooIGRpc3RhbmNlICkgewoKCQlyZXR1cm4gdGhpcy50cmFuc2xhdGVPbkF4aXMoIF96QXhpcywgZGlzdGFuY2UgKTsKCgl9CgoJbG9jYWxUb1dvcmxkKCB2ZWN0b3IgKSB7CgoJCXRoaXMudXBkYXRlV29ybGRNYXRyaXgoIHRydWUsIGZhbHNlICk7CgoJCXJldHVybiB2ZWN0b3IuYXBwbHlNYXRyaXg0KCB0aGlzLm1hdHJpeFdvcmxkICk7CgoJfQoKCXdvcmxkVG9Mb2NhbCggdmVjdG9yICkgewoKCQl0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKCQlyZXR1cm4gdmVjdG9yLmFwcGx5TWF0cml4NCggX20xJDEuY29weSggdGhpcy5tYXRyaXhXb3JsZCApLmludmVydCgpICk7CgoJfQoKCWxvb2tBdCggeCwgeSwgeiApIHsKCgkJLy8gVGhpcyBtZXRob2QgZG9lcyBub3Qgc3VwcG9ydCBvYmplY3RzIGhhdmluZyBub24tdW5pZm9ybWx5LXNjYWxlZCBwYXJlbnQocykKCgkJaWYgKCB4LmlzVmVjdG9yMyApIHsKCgkJCV90YXJnZXQuY29weSggeCApOwoKCQl9IGVsc2UgewoKCQkJX3RhcmdldC5zZXQoIHgsIHksIHogKTsKCgkJfQoKCQljb25zdCBwYXJlbnQgPSB0aGlzLnBhcmVudDsKCgkJdGhpcy51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCgkJX3Bvc2l0aW9uJDMuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCB0aGlzLm1hdHJpeFdvcmxkICk7CgoJCWlmICggdGhpcy5pc0NhbWVyYSB8fCB0aGlzLmlzTGlnaHQgKSB7CgoJCQlfbTEkMS5sb29rQXQoIF9wb3NpdGlvbiQzLCBfdGFyZ2V0LCB0aGlzLnVwICk7CgoJCX0gZWxzZSB7CgoJCQlfbTEkMS5sb29rQXQoIF90YXJnZXQsIF9wb3NpdGlvbiQzLCB0aGlzLnVwICk7CgoJCX0KCgkJdGhpcy5xdWF0ZXJuaW9uLnNldEZyb21Sb3RhdGlvbk1hdHJpeCggX20xJDEgKTsKCgkJaWYgKCBwYXJlbnQgKSB7CgoJCQlfbTEkMS5leHRyYWN0Um90YXRpb24oIHBhcmVudC5tYXRyaXhXb3JsZCApOwoJCQlfcTEuc2V0RnJvbVJvdGF0aW9uTWF0cml4KCBfbTEkMSApOwoJCQl0aGlzLnF1YXRlcm5pb24ucHJlbXVsdGlwbHkoIF9xMS5pbnZlcnQoKSApOwoKCQl9CgoJfQoKCWFkZCggb2JqZWN0ICkgewoKCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggPiAxICkgewoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSArKyApIHsKCgkJCQl0aGlzLmFkZCggYXJndW1lbnRzWyBpIF0gKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCWlmICggb2JqZWN0ID09PSB0aGlzICkgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLk9iamVjdDNELmFkZDogb2JqZWN0IGNhblwndCBiZSBhZGRlZCBhcyBhIGNoaWxkIG9mIGl0c2VsZi4nLCBvYmplY3QgKTsKCQkJcmV0dXJuIHRoaXM7CgoJCX0KCgkJaWYgKCBvYmplY3QgJiYgb2JqZWN0LmlzT2JqZWN0M0QgKSB7CgoJCQlpZiAoIG9iamVjdC5wYXJlbnQgIT09IG51bGwgKSB7CgoJCQkJb2JqZWN0LnBhcmVudC5yZW1vdmUoIG9iamVjdCApOwoKCQkJfQoKCQkJb2JqZWN0LnBhcmVudCA9IHRoaXM7CgkJCXRoaXMuY2hpbGRyZW4ucHVzaCggb2JqZWN0ICk7CgoJCQlvYmplY3QuZGlzcGF0Y2hFdmVudCggX2FkZGVkRXZlbnQgKTsKCgkJfSBlbHNlIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5PYmplY3QzRC5hZGQ6IG9iamVjdCBub3QgYW4gaW5zdGFuY2Ugb2YgVEhSRUUuT2JqZWN0M0QuJywgb2JqZWN0ICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXJlbW92ZSggb2JqZWN0ICkgewoKCQlpZiAoIGFyZ3VtZW50cy5sZW5ndGggPiAxICkgewoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgYXJndW1lbnRzLmxlbmd0aDsgaSArKyApIHsKCgkJCQl0aGlzLnJlbW92ZSggYXJndW1lbnRzWyBpIF0gKTsKCgkJCX0KCgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCWNvbnN0IGluZGV4ID0gdGhpcy5jaGlsZHJlbi5pbmRleE9mKCBvYmplY3QgKTsKCgkJaWYgKCBpbmRleCAhPT0gLSAxICkgewoKCQkJb2JqZWN0LnBhcmVudCA9IG51bGw7CgkJCXRoaXMuY2hpbGRyZW4uc3BsaWNlKCBpbmRleCwgMSApOwoKCQkJb2JqZWN0LmRpc3BhdGNoRXZlbnQoIF9yZW1vdmVkRXZlbnQgKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJcmVtb3ZlRnJvbVBhcmVudCgpIHsKCgkJY29uc3QgcGFyZW50ID0gdGhpcy5wYXJlbnQ7CgoJCWlmICggcGFyZW50ICE9PSBudWxsICkgewoKCQkJcGFyZW50LnJlbW92ZSggdGhpcyApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgljbGVhcigpIHsKCgkJcmV0dXJuIHRoaXMucmVtb3ZlKCAuLi4gdGhpcy5jaGlsZHJlbiApOwoKCX0KCglhdHRhY2goIG9iamVjdCApIHsKCgkJLy8gYWRkcyBvYmplY3QgYXMgYSBjaGlsZCBvZiB0aGlzLCB3aGlsZSBtYWludGFpbmluZyB0aGUgb2JqZWN0J3Mgd29ybGQgdHJhbnNmb3JtCgoJCS8vIE5vdGU6IFRoaXMgbWV0aG9kIGRvZXMgbm90IHN1cHBvcnQgc2NlbmUgZ3JhcGhzIGhhdmluZyBub24tdW5pZm9ybWx5LXNjYWxlZCBub2RlcyhzKQoKCQl0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKCQlfbTEkMS5jb3B5KCB0aGlzLm1hdHJpeFdvcmxkICkuaW52ZXJ0KCk7CgoJCWlmICggb2JqZWN0LnBhcmVudCAhPT0gbnVsbCApIHsKCgkJCW9iamVjdC5wYXJlbnQudXBkYXRlV29ybGRNYXRyaXgoIHRydWUsIGZhbHNlICk7CgoJCQlfbTEkMS5tdWx0aXBseSggb2JqZWN0LnBhcmVudC5tYXRyaXhXb3JsZCApOwoKCQl9CgoJCW9iamVjdC5hcHBseU1hdHJpeDQoIF9tMSQxICk7CgoJCXRoaXMuYWRkKCBvYmplY3QgKTsKCgkJb2JqZWN0LnVwZGF0ZVdvcmxkTWF0cml4KCBmYWxzZSwgdHJ1ZSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0T2JqZWN0QnlJZCggaWQgKSB7CgoJCXJldHVybiB0aGlzLmdldE9iamVjdEJ5UHJvcGVydHkoICdpZCcsIGlkICk7CgoJfQoKCWdldE9iamVjdEJ5TmFtZSggbmFtZSApIHsKCgkJcmV0dXJuIHRoaXMuZ2V0T2JqZWN0QnlQcm9wZXJ0eSggJ25hbWUnLCBuYW1lICk7CgoJfQoKCWdldE9iamVjdEJ5UHJvcGVydHkoIG5hbWUsIHZhbHVlICkgewoKCQlpZiAoIHRoaXNbIG5hbWUgXSA9PT0gdmFsdWUgKSByZXR1cm4gdGhpczsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5jaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJY29uc3QgY2hpbGQgPSB0aGlzLmNoaWxkcmVuWyBpIF07CgkJCWNvbnN0IG9iamVjdCA9IGNoaWxkLmdldE9iamVjdEJ5UHJvcGVydHkoIG5hbWUsIHZhbHVlICk7CgoJCQlpZiAoIG9iamVjdCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXJldHVybiBvYmplY3Q7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHVuZGVmaW5lZDsKCgl9CgoJZ2V0T2JqZWN0c0J5UHJvcGVydHkoIG5hbWUsIHZhbHVlICkgewoKCQlsZXQgcmVzdWx0ID0gW107CgoJCWlmICggdGhpc1sgbmFtZSBdID09PSB2YWx1ZSApIHJlc3VsdC5wdXNoKCB0aGlzICk7CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IGNoaWxkUmVzdWx0ID0gdGhpcy5jaGlsZHJlblsgaSBdLmdldE9iamVjdHNCeVByb3BlcnR5KCBuYW1lLCB2YWx1ZSApOwoKCQkJaWYgKCBjaGlsZFJlc3VsdC5sZW5ndGggPiAwICkgewoKCQkJCXJlc3VsdCA9IHJlc3VsdC5jb25jYXQoIGNoaWxkUmVzdWx0ICk7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHJlc3VsdDsKCgl9CgoJZ2V0V29ybGRQb3NpdGlvbiggdGFyZ2V0ICkgewoKCQl0aGlzLnVwZGF0ZVdvcmxkTWF0cml4KCB0cnVlLCBmYWxzZSApOwoKCQlyZXR1cm4gdGFyZ2V0LnNldEZyb21NYXRyaXhQb3NpdGlvbiggdGhpcy5tYXRyaXhXb3JsZCApOwoKCX0KCglnZXRXb3JsZFF1YXRlcm5pb24oIHRhcmdldCApIHsKCgkJdGhpcy51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCgkJdGhpcy5tYXRyaXhXb3JsZC5kZWNvbXBvc2UoIF9wb3NpdGlvbiQzLCB0YXJnZXQsIF9zY2FsZSQyICk7CgoJCXJldHVybiB0YXJnZXQ7CgoJfQoKCWdldFdvcmxkU2NhbGUoIHRhcmdldCApIHsKCgkJdGhpcy51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCgkJdGhpcy5tYXRyaXhXb3JsZC5kZWNvbXBvc2UoIF9wb3NpdGlvbiQzLCBfcXVhdGVybmlvbiQyLCB0YXJnZXQgKTsKCgkJcmV0dXJuIHRhcmdldDsKCgl9CgoJZ2V0V29ybGREaXJlY3Rpb24oIHRhcmdldCApIHsKCgkJdGhpcy51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCgkJY29uc3QgZSA9IHRoaXMubWF0cml4V29ybGQuZWxlbWVudHM7CgoJCXJldHVybiB0YXJnZXQuc2V0KCBlWyA4IF0sIGVbIDkgXSwgZVsgMTAgXSApLm5vcm1hbGl6ZSgpOwoKCX0KCglyYXljYXN0KCAvKiByYXljYXN0ZXIsIGludGVyc2VjdHMgKi8gKSB7fQoKCXRyYXZlcnNlKCBjYWxsYmFjayApIHsKCgkJY2FsbGJhY2soIHRoaXMgKTsKCgkJY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJY2hpbGRyZW5bIGkgXS50cmF2ZXJzZSggY2FsbGJhY2sgKTsKCgkJfQoKCX0KCgl0cmF2ZXJzZVZpc2libGUoIGNhbGxiYWNrICkgewoKCQlpZiAoIHRoaXMudmlzaWJsZSA9PT0gZmFsc2UgKSByZXR1cm47CgoJCWNhbGxiYWNrKCB0aGlzICk7CgoJCWNvbnN0IGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNoaWxkcmVuWyBpIF0udHJhdmVyc2VWaXNpYmxlKCBjYWxsYmFjayApOwoKCQl9CgoJfQoKCXRyYXZlcnNlQW5jZXN0b3JzKCBjYWxsYmFjayApIHsKCgkJY29uc3QgcGFyZW50ID0gdGhpcy5wYXJlbnQ7CgoJCWlmICggcGFyZW50ICE9PSBudWxsICkgewoKCQkJY2FsbGJhY2soIHBhcmVudCApOwoKCQkJcGFyZW50LnRyYXZlcnNlQW5jZXN0b3JzKCBjYWxsYmFjayApOwoKCQl9CgoJfQoKCXVwZGF0ZU1hdHJpeCgpIHsKCgkJdGhpcy5tYXRyaXguY29tcG9zZSggdGhpcy5wb3NpdGlvbiwgdGhpcy5xdWF0ZXJuaW9uLCB0aGlzLnNjYWxlICk7CgoJCXRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IHRydWU7CgoJfQoKCXVwZGF0ZU1hdHJpeFdvcmxkKCBmb3JjZSApIHsKCgkJaWYgKCB0aGlzLm1hdHJpeEF1dG9VcGRhdGUgKSB0aGlzLnVwZGF0ZU1hdHJpeCgpOwoKCQlpZiAoIHRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZSB8fCBmb3JjZSApIHsKCgkJCWlmICggdGhpcy5wYXJlbnQgPT09IG51bGwgKSB7CgoJCQkJdGhpcy5tYXRyaXhXb3JsZC5jb3B5KCB0aGlzLm1hdHJpeCApOwoKCQkJfSBlbHNlIHsKCgkJCQl0aGlzLm1hdHJpeFdvcmxkLm11bHRpcGx5TWF0cmljZXMoIHRoaXMucGFyZW50Lm1hdHJpeFdvcmxkLCB0aGlzLm1hdHJpeCApOwoKCQkJfQoKCQkJdGhpcy5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlID0gZmFsc2U7CgoJCQlmb3JjZSA9IHRydWU7CgoJCX0KCgkJLy8gdXBkYXRlIGNoaWxkcmVuCgoJCWNvbnN0IGNoaWxkcmVuID0gdGhpcy5jaGlsZHJlbjsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IGNoaWxkID0gY2hpbGRyZW5bIGkgXTsKCgkJCWlmICggY2hpbGQubWF0cml4V29ybGRBdXRvVXBkYXRlID09PSB0cnVlIHx8IGZvcmNlID09PSB0cnVlICkgewoKCQkJCWNoaWxkLnVwZGF0ZU1hdHJpeFdvcmxkKCBmb3JjZSApOwoKCQkJfQoKCQl9CgoJfQoKCXVwZGF0ZVdvcmxkTWF0cml4KCB1cGRhdGVQYXJlbnRzLCB1cGRhdGVDaGlsZHJlbiApIHsKCgkJY29uc3QgcGFyZW50ID0gdGhpcy5wYXJlbnQ7CgoJCWlmICggdXBkYXRlUGFyZW50cyA9PT0gdHJ1ZSAmJiBwYXJlbnQgIT09IG51bGwgJiYgcGFyZW50Lm1hdHJpeFdvcmxkQXV0b1VwZGF0ZSA9PT0gdHJ1ZSApIHsKCgkJCXBhcmVudC51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCgkJfQoKCQlpZiAoIHRoaXMubWF0cml4QXV0b1VwZGF0ZSApIHRoaXMudXBkYXRlTWF0cml4KCk7CgoJCWlmICggdGhpcy5wYXJlbnQgPT09IG51bGwgKSB7CgoJCQl0aGlzLm1hdHJpeFdvcmxkLmNvcHkoIHRoaXMubWF0cml4ICk7CgoJCX0gZWxzZSB7CgoJCQl0aGlzLm1hdHJpeFdvcmxkLm11bHRpcGx5TWF0cmljZXMoIHRoaXMucGFyZW50Lm1hdHJpeFdvcmxkLCB0aGlzLm1hdHJpeCApOwoKCQl9CgoJCS8vIHVwZGF0ZSBjaGlsZHJlbgoKCQlpZiAoIHVwZGF0ZUNoaWxkcmVuID09PSB0cnVlICkgewoKCQkJY29uc3QgY2hpbGRyZW4gPSB0aGlzLmNoaWxkcmVuOwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQljb25zdCBjaGlsZCA9IGNoaWxkcmVuWyBpIF07CgoJCQkJaWYgKCBjaGlsZC5tYXRyaXhXb3JsZEF1dG9VcGRhdGUgPT09IHRydWUgKSB7CgoJCQkJCWNoaWxkLnVwZGF0ZVdvcmxkTWF0cml4KCBmYWxzZSwgdHJ1ZSApOwoKCQkJCX0KCgkJCX0KCgkJfQoKCX0KCgl0b0pTT04oIG1ldGEgKSB7CgoJCS8vIG1ldGEgaXMgYSBzdHJpbmcgd2hlbiBjYWxsZWQgZnJvbSBKU09OLnN0cmluZ2lmeQoJCWNvbnN0IGlzUm9vdE9iamVjdCA9ICggbWV0YSA9PT0gdW5kZWZpbmVkIHx8IHR5cGVvZiBtZXRhID09PSAnc3RyaW5nJyApOwoKCQljb25zdCBvdXRwdXQgPSB7fTsKCgkJLy8gbWV0YSBpcyBhIGhhc2ggdXNlZCB0byBjb2xsZWN0IGdlb21ldHJpZXMsIG1hdGVyaWFscy4KCQkvLyBub3QgcHJvdmlkaW5nIGl0IGltcGxpZXMgdGhhdCB0aGlzIGlzIHRoZSByb290IG9iamVjdAoJCS8vIGJlaW5nIHNlcmlhbGl6ZWQuCgkJaWYgKCBpc1Jvb3RPYmplY3QgKSB7CgoJCQkvLyBpbml0aWFsaXplIG1ldGEgb2JqCgkJCW1ldGEgPSB7CgkJCQlnZW9tZXRyaWVzOiB7fSwKCQkJCW1hdGVyaWFsczoge30sCgkJCQl0ZXh0dXJlczoge30sCgkJCQlpbWFnZXM6IHt9LAoJCQkJc2hhcGVzOiB7fSwKCQkJCXNrZWxldG9uczoge30sCgkJCQlhbmltYXRpb25zOiB7fSwKCQkJCW5vZGVzOiB7fQoJCQl9OwoKCQkJb3V0cHV0Lm1ldGFkYXRhID0gewoJCQkJdmVyc2lvbjogNC42LAoJCQkJdHlwZTogJ09iamVjdCcsCgkJCQlnZW5lcmF0b3I6ICdPYmplY3QzRC50b0pTT04nCgkJCX07CgoJCX0KCgkJLy8gc3RhbmRhcmQgT2JqZWN0M0Qgc2VyaWFsaXphdGlvbgoKCQljb25zdCBvYmplY3QgPSB7fTsKCgkJb2JqZWN0LnV1aWQgPSB0aGlzLnV1aWQ7CgkJb2JqZWN0LnR5cGUgPSB0aGlzLnR5cGU7CgoJCWlmICggdGhpcy5uYW1lICE9PSAnJyApIG9iamVjdC5uYW1lID0gdGhpcy5uYW1lOwoJCWlmICggdGhpcy5jYXN0U2hhZG93ID09PSB0cnVlICkgb2JqZWN0LmNhc3RTaGFkb3cgPSB0cnVlOwoJCWlmICggdGhpcy5yZWNlaXZlU2hhZG93ID09PSB0cnVlICkgb2JqZWN0LnJlY2VpdmVTaGFkb3cgPSB0cnVlOwoJCWlmICggdGhpcy52aXNpYmxlID09PSBmYWxzZSApIG9iamVjdC52aXNpYmxlID0gZmFsc2U7CgkJaWYgKCB0aGlzLmZydXN0dW1DdWxsZWQgPT09IGZhbHNlICkgb2JqZWN0LmZydXN0dW1DdWxsZWQgPSBmYWxzZTsKCQlpZiAoIHRoaXMucmVuZGVyT3JkZXIgIT09IDAgKSBvYmplY3QucmVuZGVyT3JkZXIgPSB0aGlzLnJlbmRlck9yZGVyOwoJCWlmICggT2JqZWN0LmtleXMoIHRoaXMudXNlckRhdGEgKS5sZW5ndGggPiAwICkgb2JqZWN0LnVzZXJEYXRhID0gdGhpcy51c2VyRGF0YTsKCgkJb2JqZWN0LmxheWVycyA9IHRoaXMubGF5ZXJzLm1hc2s7CgkJb2JqZWN0Lm1hdHJpeCA9IHRoaXMubWF0cml4LnRvQXJyYXkoKTsKCQlvYmplY3QudXAgPSB0aGlzLnVwLnRvQXJyYXkoKTsKCgkJaWYgKCB0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPT09IGZhbHNlICkgb2JqZWN0Lm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCgkJLy8gb2JqZWN0IHNwZWNpZmljIHByb3BlcnRpZXMKCgkJaWYgKCB0aGlzLmlzSW5zdGFuY2VkTWVzaCApIHsKCgkJCW9iamVjdC50eXBlID0gJ0luc3RhbmNlZE1lc2gnOwoJCQlvYmplY3QuY291bnQgPSB0aGlzLmNvdW50OwoJCQlvYmplY3QuaW5zdGFuY2VNYXRyaXggPSB0aGlzLmluc3RhbmNlTWF0cml4LnRvSlNPTigpOwoJCQlpZiAoIHRoaXMuaW5zdGFuY2VDb2xvciAhPT0gbnVsbCApIG9iamVjdC5pbnN0YW5jZUNvbG9yID0gdGhpcy5pbnN0YW5jZUNvbG9yLnRvSlNPTigpOwoKCQl9CgoJCS8vCgoJCWZ1bmN0aW9uIHNlcmlhbGl6ZSggbGlicmFyeSwgZWxlbWVudCApIHsKCgkJCWlmICggbGlicmFyeVsgZWxlbWVudC51dWlkIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQlsaWJyYXJ5WyBlbGVtZW50LnV1aWQgXSA9IGVsZW1lbnQudG9KU09OKCBtZXRhICk7CgoJCQl9CgoJCQlyZXR1cm4gZWxlbWVudC51dWlkOwoKCQl9CgoJCWlmICggdGhpcy5pc1NjZW5lICkgewoKCQkJaWYgKCB0aGlzLmJhY2tncm91bmQgKSB7CgoJCQkJaWYgKCB0aGlzLmJhY2tncm91bmQuaXNDb2xvciApIHsKCgkJCQkJb2JqZWN0LmJhY2tncm91bmQgPSB0aGlzLmJhY2tncm91bmQudG9KU09OKCk7CgoJCQkJfSBlbHNlIGlmICggdGhpcy5iYWNrZ3JvdW5kLmlzVGV4dHVyZSApIHsKCgkJCQkJb2JqZWN0LmJhY2tncm91bmQgPSB0aGlzLmJhY2tncm91bmQudG9KU09OKCBtZXRhICkudXVpZDsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHRoaXMuZW52aXJvbm1lbnQgJiYgdGhpcy5lbnZpcm9ubWVudC5pc1RleHR1cmUgJiYgdGhpcy5lbnZpcm9ubWVudC5pc1JlbmRlclRhcmdldFRleHR1cmUgIT09IHRydWUgKSB7CgoJCQkJb2JqZWN0LmVudmlyb25tZW50ID0gdGhpcy5lbnZpcm9ubWVudC50b0pTT04oIG1ldGEgKS51dWlkOwoKCQkJfQoKCQl9IGVsc2UgaWYgKCB0aGlzLmlzTWVzaCB8fCB0aGlzLmlzTGluZSB8fCB0aGlzLmlzUG9pbnRzICkgewoKCQkJb2JqZWN0Lmdlb21ldHJ5ID0gc2VyaWFsaXplKCBtZXRhLmdlb21ldHJpZXMsIHRoaXMuZ2VvbWV0cnkgKTsKCgkJCWNvbnN0IHBhcmFtZXRlcnMgPSB0aGlzLmdlb21ldHJ5LnBhcmFtZXRlcnM7CgoJCQlpZiAoIHBhcmFtZXRlcnMgIT09IHVuZGVmaW5lZCAmJiBwYXJhbWV0ZXJzLnNoYXBlcyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnN0IHNoYXBlcyA9IHBhcmFtZXRlcnMuc2hhcGVzOwoKCQkJCWlmICggQXJyYXkuaXNBcnJheSggc2hhcGVzICkgKSB7CgoJCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IHNoYXBlcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCQkJY29uc3Qgc2hhcGUgPSBzaGFwZXNbIGkgXTsKCgkJCQkJCXNlcmlhbGl6ZSggbWV0YS5zaGFwZXMsIHNoYXBlICk7CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQlzZXJpYWxpemUoIG1ldGEuc2hhcGVzLCBzaGFwZXMgKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJaWYgKCB0aGlzLmlzU2tpbm5lZE1lc2ggKSB7CgoJCQlvYmplY3QuYmluZE1vZGUgPSB0aGlzLmJpbmRNb2RlOwoJCQlvYmplY3QuYmluZE1hdHJpeCA9IHRoaXMuYmluZE1hdHJpeC50b0FycmF5KCk7CgoJCQlpZiAoIHRoaXMuc2tlbGV0b24gIT09IHVuZGVmaW5lZCApIHsKCgkJCQlzZXJpYWxpemUoIG1ldGEuc2tlbGV0b25zLCB0aGlzLnNrZWxldG9uICk7CgoJCQkJb2JqZWN0LnNrZWxldG9uID0gdGhpcy5za2VsZXRvbi51dWlkOwoKCQkJfQoKCQl9CgoJCWlmICggdGhpcy5tYXRlcmlhbCAhPT0gdW5kZWZpbmVkICkgewoKCQkJaWYgKCBBcnJheS5pc0FycmF5KCB0aGlzLm1hdGVyaWFsICkgKSB7CgoJCQkJY29uc3QgdXVpZHMgPSBbXTsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB0aGlzLm1hdGVyaWFsLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCXV1aWRzLnB1c2goIHNlcmlhbGl6ZSggbWV0YS5tYXRlcmlhbHMsIHRoaXMubWF0ZXJpYWxbIGkgXSApICk7CgoJCQkJfQoKCQkJCW9iamVjdC5tYXRlcmlhbCA9IHV1aWRzOwoKCQkJfSBlbHNlIHsKCgkJCQlvYmplY3QubWF0ZXJpYWwgPSBzZXJpYWxpemUoIG1ldGEubWF0ZXJpYWxzLCB0aGlzLm1hdGVyaWFsICk7CgoJCQl9CgoJCX0KCgkJLy8KCgkJaWYgKCB0aGlzLmNoaWxkcmVuLmxlbmd0aCA+IDAgKSB7CgoJCQlvYmplY3QuY2hpbGRyZW4gPSBbXTsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMuY2hpbGRyZW4ubGVuZ3RoOyBpICsrICkgewoKCQkJCW9iamVjdC5jaGlsZHJlbi5wdXNoKCB0aGlzLmNoaWxkcmVuWyBpIF0udG9KU09OKCBtZXRhICkub2JqZWN0ICk7CgoJCQl9CgoJCX0KCgkJLy8KCgkJaWYgKCB0aGlzLmFuaW1hdGlvbnMubGVuZ3RoID4gMCApIHsKCgkJCW9iamVjdC5hbmltYXRpb25zID0gW107CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLmFuaW1hdGlvbnMubGVuZ3RoOyBpICsrICkgewoKCQkJCWNvbnN0IGFuaW1hdGlvbiA9IHRoaXMuYW5pbWF0aW9uc1sgaSBdOwoKCQkJCW9iamVjdC5hbmltYXRpb25zLnB1c2goIHNlcmlhbGl6ZSggbWV0YS5hbmltYXRpb25zLCBhbmltYXRpb24gKSApOwoKCQkJfQoKCQl9CgoJCWlmICggaXNSb290T2JqZWN0ICkgewoKCQkJY29uc3QgZ2VvbWV0cmllcyA9IGV4dHJhY3RGcm9tQ2FjaGUoIG1ldGEuZ2VvbWV0cmllcyApOwoJCQljb25zdCBtYXRlcmlhbHMgPSBleHRyYWN0RnJvbUNhY2hlKCBtZXRhLm1hdGVyaWFscyApOwoJCQljb25zdCB0ZXh0dXJlcyA9IGV4dHJhY3RGcm9tQ2FjaGUoIG1ldGEudGV4dHVyZXMgKTsKCQkJY29uc3QgaW1hZ2VzID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS5pbWFnZXMgKTsKCQkJY29uc3Qgc2hhcGVzID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS5zaGFwZXMgKTsKCQkJY29uc3Qgc2tlbGV0b25zID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS5za2VsZXRvbnMgKTsKCQkJY29uc3QgYW5pbWF0aW9ucyA9IGV4dHJhY3RGcm9tQ2FjaGUoIG1ldGEuYW5pbWF0aW9ucyApOwoJCQljb25zdCBub2RlcyA9IGV4dHJhY3RGcm9tQ2FjaGUoIG1ldGEubm9kZXMgKTsKCgkJCWlmICggZ2VvbWV0cmllcy5sZW5ndGggPiAwICkgb3V0cHV0Lmdlb21ldHJpZXMgPSBnZW9tZXRyaWVzOwoJCQlpZiAoIG1hdGVyaWFscy5sZW5ndGggPiAwICkgb3V0cHV0Lm1hdGVyaWFscyA9IG1hdGVyaWFsczsKCQkJaWYgKCB0ZXh0dXJlcy5sZW5ndGggPiAwICkgb3V0cHV0LnRleHR1cmVzID0gdGV4dHVyZXM7CgkJCWlmICggaW1hZ2VzLmxlbmd0aCA+IDAgKSBvdXRwdXQuaW1hZ2VzID0gaW1hZ2VzOwoJCQlpZiAoIHNoYXBlcy5sZW5ndGggPiAwICkgb3V0cHV0LnNoYXBlcyA9IHNoYXBlczsKCQkJaWYgKCBza2VsZXRvbnMubGVuZ3RoID4gMCApIG91dHB1dC5za2VsZXRvbnMgPSBza2VsZXRvbnM7CgkJCWlmICggYW5pbWF0aW9ucy5sZW5ndGggPiAwICkgb3V0cHV0LmFuaW1hdGlvbnMgPSBhbmltYXRpb25zOwoJCQlpZiAoIG5vZGVzLmxlbmd0aCA+IDAgKSBvdXRwdXQubm9kZXMgPSBub2RlczsKCgkJfQoKCQlvdXRwdXQub2JqZWN0ID0gb2JqZWN0OwoKCQlyZXR1cm4gb3V0cHV0OwoKCQkvLyBleHRyYWN0IGRhdGEgZnJvbSB0aGUgY2FjaGUgaGFzaAoJCS8vIHJlbW92ZSBtZXRhZGF0YSBvbiBlYWNoIGl0ZW0KCQkvLyBhbmQgcmV0dXJuIGFzIGFycmF5CgkJZnVuY3Rpb24gZXh0cmFjdEZyb21DYWNoZSggY2FjaGUgKSB7CgoJCQljb25zdCB2YWx1ZXMgPSBbXTsKCQkJZm9yICggY29uc3Qga2V5IGluIGNhY2hlICkgewoKCQkJCWNvbnN0IGRhdGEgPSBjYWNoZVsga2V5IF07CgkJCQlkZWxldGUgZGF0YS5tZXRhZGF0YTsKCQkJCXZhbHVlcy5wdXNoKCBkYXRhICk7CgoJCQl9CgoJCQlyZXR1cm4gdmFsdWVzOwoKCQl9CgoJfQoKCWNsb25lKCByZWN1cnNpdmUgKSB7CgoJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMsIHJlY3Vyc2l2ZSApOwoKCX0KCgljb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSA9IHRydWUgKSB7CgoJCXRoaXMubmFtZSA9IHNvdXJjZS5uYW1lOwoKCQl0aGlzLnVwLmNvcHkoIHNvdXJjZS51cCApOwoKCQl0aGlzLnBvc2l0aW9uLmNvcHkoIHNvdXJjZS5wb3NpdGlvbiApOwoJCXRoaXMucm90YXRpb24ub3JkZXIgPSBzb3VyY2Uucm90YXRpb24ub3JkZXI7CgkJdGhpcy5xdWF0ZXJuaW9uLmNvcHkoIHNvdXJjZS5xdWF0ZXJuaW9uICk7CgkJdGhpcy5zY2FsZS5jb3B5KCBzb3VyY2Uuc2NhbGUgKTsKCgkJdGhpcy5tYXRyaXguY29weSggc291cmNlLm1hdHJpeCApOwoJCXRoaXMubWF0cml4V29ybGQuY29weSggc291cmNlLm1hdHJpeFdvcmxkICk7CgoJCXRoaXMubWF0cml4QXV0b1VwZGF0ZSA9IHNvdXJjZS5tYXRyaXhBdXRvVXBkYXRlOwoJCXRoaXMubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IHNvdXJjZS5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlOwoKCQl0aGlzLm1hdHJpeFdvcmxkQXV0b1VwZGF0ZSA9IHNvdXJjZS5tYXRyaXhXb3JsZEF1dG9VcGRhdGU7CgoJCXRoaXMubGF5ZXJzLm1hc2sgPSBzb3VyY2UubGF5ZXJzLm1hc2s7CgkJdGhpcy52aXNpYmxlID0gc291cmNlLnZpc2libGU7CgoJCXRoaXMuY2FzdFNoYWRvdyA9IHNvdXJjZS5jYXN0U2hhZG93OwoJCXRoaXMucmVjZWl2ZVNoYWRvdyA9IHNvdXJjZS5yZWNlaXZlU2hhZG93OwoKCQl0aGlzLmZydXN0dW1DdWxsZWQgPSBzb3VyY2UuZnJ1c3R1bUN1bGxlZDsKCQl0aGlzLnJlbmRlck9yZGVyID0gc291cmNlLnJlbmRlck9yZGVyOwoKCQl0aGlzLmFuaW1hdGlvbnMgPSBzb3VyY2UuYW5pbWF0aW9ucy5zbGljZSgpOwoKCQl0aGlzLnVzZXJEYXRhID0gSlNPTi5wYXJzZSggSlNPTi5zdHJpbmdpZnkoIHNvdXJjZS51c2VyRGF0YSApICk7CgoJCWlmICggcmVjdXJzaXZlID09PSB0cnVlICkgewoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgc291cmNlLmNoaWxkcmVuLmxlbmd0aDsgaSArKyApIHsKCgkJCQljb25zdCBjaGlsZCA9IHNvdXJjZS5jaGlsZHJlblsgaSBdOwoJCQkJdGhpcy5hZGQoIGNoaWxkLmNsb25lKCkgKTsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpPYmplY3QzRC5ERUZBVUxUX1VQID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggMCwgMSwgMCApOwpPYmplY3QzRC5ERUZBVUxUX01BVFJJWF9BVVRPX1VQREFURSA9IHRydWU7Ck9iamVjdDNELkRFRkFVTFRfTUFUUklYX1dPUkxEX0FVVE9fVVBEQVRFID0gdHJ1ZTsKCmNvbnN0IF92MCQxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfdjEkMyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3YyJDIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF92MyQxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKY29uc3QgX3ZhYiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3ZhYyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3ZiYyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3ZhcCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3ZicCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3ZjcCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmxldCB3YXJuZWRHZXRVViA9IGZhbHNlOwoKY2xhc3MgVHJpYW5nbGUgewoKCWNvbnN0cnVjdG9yKCBhID0gbmV3IFZlY3RvcjMoKSwgYiA9IG5ldyBWZWN0b3IzKCksIGMgPSBuZXcgVmVjdG9yMygpICkgewoKCQl0aGlzLmEgPSBhOwoJCXRoaXMuYiA9IGI7CgkJdGhpcy5jID0gYzsKCgl9CgoJc3RhdGljIGdldE5vcm1hbCggYSwgYiwgYywgdGFyZ2V0ICkgewoKCQl0YXJnZXQuc3ViVmVjdG9ycyggYywgYiApOwoJCV92MCQxLnN1YlZlY3RvcnMoIGEsIGIgKTsKCQl0YXJnZXQuY3Jvc3MoIF92MCQxICk7CgoJCWNvbnN0IHRhcmdldExlbmd0aFNxID0gdGFyZ2V0Lmxlbmd0aFNxKCk7CgkJaWYgKCB0YXJnZXRMZW5ndGhTcSA+IDAgKSB7CgoJCQlyZXR1cm4gdGFyZ2V0Lm11bHRpcGx5U2NhbGFyKCAxIC8gTWF0aC5zcXJ0KCB0YXJnZXRMZW5ndGhTcSApICk7CgoJCX0KCgkJcmV0dXJuIHRhcmdldC5zZXQoIDAsIDAsIDAgKTsKCgl9CgoJLy8gc3RhdGljL2luc3RhbmNlIG1ldGhvZCB0byBjYWxjdWxhdGUgYmFyeWNlbnRyaWMgY29vcmRpbmF0ZXMKCS8vIGJhc2VkIG9uOiBodHRwOi8vd3d3LmJsYWNrcGF3bi5jb20vdGV4dHMvcG9pbnRpbnBvbHkvZGVmYXVsdC5odG1sCglzdGF0aWMgZ2V0QmFyeWNvb3JkKCBwb2ludCwgYSwgYiwgYywgdGFyZ2V0ICkgewoKCQlfdjAkMS5zdWJWZWN0b3JzKCBjLCBhICk7CgkJX3YxJDMuc3ViVmVjdG9ycyggYiwgYSApOwoJCV92MiQyLnN1YlZlY3RvcnMoIHBvaW50LCBhICk7CgoJCWNvbnN0IGRvdDAwID0gX3YwJDEuZG90KCBfdjAkMSApOwoJCWNvbnN0IGRvdDAxID0gX3YwJDEuZG90KCBfdjEkMyApOwoJCWNvbnN0IGRvdDAyID0gX3YwJDEuZG90KCBfdjIkMiApOwoJCWNvbnN0IGRvdDExID0gX3YxJDMuZG90KCBfdjEkMyApOwoJCWNvbnN0IGRvdDEyID0gX3YxJDMuZG90KCBfdjIkMiApOwoKCQljb25zdCBkZW5vbSA9ICggZG90MDAgKiBkb3QxMSAtIGRvdDAxICogZG90MDEgKTsKCgkJLy8gY29sbGluZWFyIG9yIHNpbmd1bGFyIHRyaWFuZ2xlCgkJaWYgKCBkZW5vbSA9PT0gMCApIHsKCgkJCS8vIGFyYml0cmFyeSBsb2NhdGlvbiBvdXRzaWRlIG9mIHRyaWFuZ2xlPwoJCQkvLyBub3Qgc3VyZSBpZiB0aGlzIGlzIHRoZSBiZXN0IGlkZWEsIG1heWJlIHNob3VsZCBiZSByZXR1cm5pbmcgdW5kZWZpbmVkCgkJCXJldHVybiB0YXJnZXQuc2V0KCAtIDIsIC0gMSwgLSAxICk7CgoJCX0KCgkJY29uc3QgaW52RGVub20gPSAxIC8gZGVub207CgkJY29uc3QgdSA9ICggZG90MTEgKiBkb3QwMiAtIGRvdDAxICogZG90MTIgKSAqIGludkRlbm9tOwoJCWNvbnN0IHYgPSAoIGRvdDAwICogZG90MTIgLSBkb3QwMSAqIGRvdDAyICkgKiBpbnZEZW5vbTsKCgkJLy8gYmFyeWNlbnRyaWMgY29vcmRpbmF0ZXMgbXVzdCBhbHdheXMgc3VtIHRvIDEKCQlyZXR1cm4gdGFyZ2V0LnNldCggMSAtIHUgLSB2LCB2LCB1ICk7CgoJfQoKCXN0YXRpYyBjb250YWluc1BvaW50KCBwb2ludCwgYSwgYiwgYyApIHsKCgkJdGhpcy5nZXRCYXJ5Y29vcmQoIHBvaW50LCBhLCBiLCBjLCBfdjMkMSApOwoKCQlyZXR1cm4gKCBfdjMkMS54ID49IDAgKSAmJiAoIF92MyQxLnkgPj0gMCApICYmICggKCBfdjMkMS54ICsgX3YzJDEueSApIDw9IDEgKTsKCgl9CgoJc3RhdGljIGdldFVWKCBwb2ludCwgcDEsIHAyLCBwMywgdXYxLCB1djIsIHV2MywgdGFyZ2V0ICkgeyAvLyBAZGVwcmVjYXRlZCwgcjE1MQoKCQlpZiAoIHdhcm5lZEdldFVWID09PSBmYWxzZSApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlRyaWFuZ2xlLmdldFVWKCkgaGFzIGJlZW4gcmVuYW1lZCB0byBUSFJFRS5UcmlhbmdsZS5nZXRJbnRlcnBvbGF0aW9uKCkuJyApOwoKCQkJd2FybmVkR2V0VVYgPSB0cnVlOwoKCQl9CgoJCXJldHVybiB0aGlzLmdldEludGVycG9sYXRpb24oIHBvaW50LCBwMSwgcDIsIHAzLCB1djEsIHV2MiwgdXYzLCB0YXJnZXQgKTsKCgl9CgoJc3RhdGljIGdldEludGVycG9sYXRpb24oIHBvaW50LCBwMSwgcDIsIHAzLCB2MSwgdjIsIHYzLCB0YXJnZXQgKSB7CgoJCXRoaXMuZ2V0QmFyeWNvb3JkKCBwb2ludCwgcDEsIHAyLCBwMywgX3YzJDEgKTsKCgkJdGFyZ2V0LnNldFNjYWxhciggMCApOwoJCXRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIHYxLCBfdjMkMS54ICk7CgkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggdjIsIF92MyQxLnkgKTsKCQl0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKCB2MywgX3YzJDEueiApOwoKCQlyZXR1cm4gdGFyZ2V0OwoKCX0KCglzdGF0aWMgaXNGcm9udEZhY2luZyggYSwgYiwgYywgZGlyZWN0aW9uICkgewoKCQlfdjAkMS5zdWJWZWN0b3JzKCBjLCBiICk7CgkJX3YxJDMuc3ViVmVjdG9ycyggYSwgYiApOwoKCQkvLyBzdHJpY3RseSBmcm9udCBmYWNpbmcKCQlyZXR1cm4gKCBfdjAkMS5jcm9zcyggX3YxJDMgKS5kb3QoIGRpcmVjdGlvbiApIDwgMCApID8gdHJ1ZSA6IGZhbHNlOwoKCX0KCglzZXQoIGEsIGIsIGMgKSB7CgoJCXRoaXMuYS5jb3B5KCBhICk7CgkJdGhpcy5iLmNvcHkoIGIgKTsKCQl0aGlzLmMuY29weSggYyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RnJvbVBvaW50c0FuZEluZGljZXMoIHBvaW50cywgaTAsIGkxLCBpMiApIHsKCgkJdGhpcy5hLmNvcHkoIHBvaW50c1sgaTAgXSApOwoJCXRoaXMuYi5jb3B5KCBwb2ludHNbIGkxIF0gKTsKCQl0aGlzLmMuY29weSggcG9pbnRzWyBpMiBdICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tQXR0cmlidXRlQW5kSW5kaWNlcyggYXR0cmlidXRlLCBpMCwgaTEsIGkyICkgewoKCQl0aGlzLmEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpMCApOwoJCXRoaXMuYi5mcm9tQnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGkxICk7CgkJdGhpcy5jLmZyb21CdWZmZXJBdHRyaWJ1dGUoIGF0dHJpYnV0ZSwgaTIgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJfQoKCWNvcHkoIHRyaWFuZ2xlICkgewoKCQl0aGlzLmEuY29weSggdHJpYW5nbGUuYSApOwoJCXRoaXMuYi5jb3B5KCB0cmlhbmdsZS5iICk7CgkJdGhpcy5jLmNvcHkoIHRyaWFuZ2xlLmMgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWdldEFyZWEoKSB7CgoJCV92MCQxLnN1YlZlY3RvcnMoIHRoaXMuYywgdGhpcy5iICk7CgkJX3YxJDMuc3ViVmVjdG9ycyggdGhpcy5hLCB0aGlzLmIgKTsKCgkJcmV0dXJuIF92MCQxLmNyb3NzKCBfdjEkMyApLmxlbmd0aCgpICogMC41OwoKCX0KCglnZXRNaWRwb2ludCggdGFyZ2V0ICkgewoKCQlyZXR1cm4gdGFyZ2V0LmFkZFZlY3RvcnMoIHRoaXMuYSwgdGhpcy5iICkuYWRkKCB0aGlzLmMgKS5tdWx0aXBseVNjYWxhciggMSAvIDMgKTsKCgl9CgoJZ2V0Tm9ybWFsKCB0YXJnZXQgKSB7CgoJCXJldHVybiBUcmlhbmdsZS5nZXROb3JtYWwoIHRoaXMuYSwgdGhpcy5iLCB0aGlzLmMsIHRhcmdldCApOwoKCX0KCglnZXRQbGFuZSggdGFyZ2V0ICkgewoKCQlyZXR1cm4gdGFyZ2V0LnNldEZyb21Db3BsYW5hclBvaW50cyggdGhpcy5hLCB0aGlzLmIsIHRoaXMuYyApOwoKCX0KCglnZXRCYXJ5Y29vcmQoIHBvaW50LCB0YXJnZXQgKSB7CgoJCXJldHVybiBUcmlhbmdsZS5nZXRCYXJ5Y29vcmQoIHBvaW50LCB0aGlzLmEsIHRoaXMuYiwgdGhpcy5jLCB0YXJnZXQgKTsKCgl9CgoJZ2V0VVYoIHBvaW50LCB1djEsIHV2MiwgdXYzLCB0YXJnZXQgKSB7IC8vIEBkZXByZWNhdGVkLCByMTUxCgoJCWlmICggd2FybmVkR2V0VVYgPT09IGZhbHNlICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuVHJpYW5nbGUuZ2V0VVYoKSBoYXMgYmVlbiByZW5hbWVkIHRvIFRIUkVFLlRyaWFuZ2xlLmdldEludGVycG9sYXRpb24oKS4nICk7CgoJCQl3YXJuZWRHZXRVViA9IHRydWU7CgoJCX0KCgkJcmV0dXJuIFRyaWFuZ2xlLmdldEludGVycG9sYXRpb24oIHBvaW50LCB0aGlzLmEsIHRoaXMuYiwgdGhpcy5jLCB1djEsIHV2MiwgdXYzLCB0YXJnZXQgKTsKCgl9CgoJZ2V0SW50ZXJwb2xhdGlvbiggcG9pbnQsIHYxLCB2MiwgdjMsIHRhcmdldCApIHsKCgkJcmV0dXJuIFRyaWFuZ2xlLmdldEludGVycG9sYXRpb24oIHBvaW50LCB0aGlzLmEsIHRoaXMuYiwgdGhpcy5jLCB2MSwgdjIsIHYzLCB0YXJnZXQgKTsKCgl9CgoJY29udGFpbnNQb2ludCggcG9pbnQgKSB7CgoJCXJldHVybiBUcmlhbmdsZS5jb250YWluc1BvaW50KCBwb2ludCwgdGhpcy5hLCB0aGlzLmIsIHRoaXMuYyApOwoKCX0KCglpc0Zyb250RmFjaW5nKCBkaXJlY3Rpb24gKSB7CgoJCXJldHVybiBUcmlhbmdsZS5pc0Zyb250RmFjaW5nKCB0aGlzLmEsIHRoaXMuYiwgdGhpcy5jLCBkaXJlY3Rpb24gKTsKCgl9CgoJaW50ZXJzZWN0c0JveCggYm94ICkgewoKCQlyZXR1cm4gYm94LmludGVyc2VjdHNUcmlhbmdsZSggdGhpcyApOwoKCX0KCgljbG9zZXN0UG9pbnRUb1BvaW50KCBwLCB0YXJnZXQgKSB7CgoJCWNvbnN0IGEgPSB0aGlzLmEsIGIgPSB0aGlzLmIsIGMgPSB0aGlzLmM7CgkJbGV0IHYsIHc7CgoJCS8vIGFsZ29yaXRobSB0aGFua3MgdG8gUmVhbC1UaW1lIENvbGxpc2lvbiBEZXRlY3Rpb24gYnkgQ2hyaXN0ZXIgRXJpY3NvbiwKCQkvLyBwdWJsaXNoZWQgYnkgTW9yZ2FuIEthdWZtYW5uIFB1Ymxpc2hlcnMsIChjKSAyMDA1IEVsc2V2aWVyIEluYy4sCgkJLy8gdW5kZXIgdGhlIGFjY29tcGFueWluZyBsaWNlbnNlOyBzZWUgY2hhcHRlciA1LjEuNSBmb3IgZGV0YWlsZWQgZXhwbGFuYXRpb24uCgkJLy8gYmFzaWNhbGx5LCB3ZSdyZSBkaXN0aW5ndWlzaGluZyB3aGljaCBvZiB0aGUgdm9yb25vaSByZWdpb25zIG9mIHRoZSB0cmlhbmdsZQoJCS8vIHRoZSBwb2ludCBsaWVzIGluIHdpdGggdGhlIG1pbmltdW0gYW1vdW50IG9mIHJlZHVuZGFudCBjb21wdXRhdGlvbi4KCgkJX3ZhYi5zdWJWZWN0b3JzKCBiLCBhICk7CgkJX3ZhYy5zdWJWZWN0b3JzKCBjLCBhICk7CgkJX3ZhcC5zdWJWZWN0b3JzKCBwLCBhICk7CgkJY29uc3QgZDEgPSBfdmFiLmRvdCggX3ZhcCApOwoJCWNvbnN0IGQyID0gX3ZhYy5kb3QoIF92YXAgKTsKCQlpZiAoIGQxIDw9IDAgJiYgZDIgPD0gMCApIHsKCgkJCS8vIHZlcnRleCByZWdpb24gb2YgQTsgYmFyeWNlbnRyaWMgY29vcmRzICgxLCAwLCAwKQoJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGEgKTsKCgkJfQoKCQlfdmJwLnN1YlZlY3RvcnMoIHAsIGIgKTsKCQljb25zdCBkMyA9IF92YWIuZG90KCBfdmJwICk7CgkJY29uc3QgZDQgPSBfdmFjLmRvdCggX3ZicCApOwoJCWlmICggZDMgPj0gMCAmJiBkNCA8PSBkMyApIHsKCgkJCS8vIHZlcnRleCByZWdpb24gb2YgQjsgYmFyeWNlbnRyaWMgY29vcmRzICgwLCAxLCAwKQoJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGIgKTsKCgkJfQoKCQljb25zdCB2YyA9IGQxICogZDQgLSBkMyAqIGQyOwoJCWlmICggdmMgPD0gMCAmJiBkMSA+PSAwICYmIGQzIDw9IDAgKSB7CgoJCQl2ID0gZDEgLyAoIGQxIC0gZDMgKTsKCQkJLy8gZWRnZSByZWdpb24gb2YgQUI7IGJhcnljZW50cmljIGNvb3JkcyAoMS12LCB2LCAwKQoJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGEgKS5hZGRTY2FsZWRWZWN0b3IoIF92YWIsIHYgKTsKCgkJfQoKCQlfdmNwLnN1YlZlY3RvcnMoIHAsIGMgKTsKCQljb25zdCBkNSA9IF92YWIuZG90KCBfdmNwICk7CgkJY29uc3QgZDYgPSBfdmFjLmRvdCggX3ZjcCApOwoJCWlmICggZDYgPj0gMCAmJiBkNSA8PSBkNiApIHsKCgkJCS8vIHZlcnRleCByZWdpb24gb2YgQzsgYmFyeWNlbnRyaWMgY29vcmRzICgwLCAwLCAxKQoJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGMgKTsKCgkJfQoKCQljb25zdCB2YiA9IGQ1ICogZDIgLSBkMSAqIGQ2OwoJCWlmICggdmIgPD0gMCAmJiBkMiA+PSAwICYmIGQ2IDw9IDAgKSB7CgoJCQl3ID0gZDIgLyAoIGQyIC0gZDYgKTsKCQkJLy8gZWRnZSByZWdpb24gb2YgQUM7IGJhcnljZW50cmljIGNvb3JkcyAoMS13LCAwLCB3KQoJCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIGEgKS5hZGRTY2FsZWRWZWN0b3IoIF92YWMsIHcgKTsKCgkJfQoKCQljb25zdCB2YSA9IGQzICogZDYgLSBkNSAqIGQ0OwoJCWlmICggdmEgPD0gMCAmJiAoIGQ0IC0gZDMgKSA+PSAwICYmICggZDUgLSBkNiApID49IDAgKSB7CgoJCQlfdmJjLnN1YlZlY3RvcnMoIGMsIGIgKTsKCQkJdyA9ICggZDQgLSBkMyApIC8gKCAoIGQ0IC0gZDMgKSArICggZDUgLSBkNiApICk7CgkJCS8vIGVkZ2UgcmVnaW9uIG9mIEJDOyBiYXJ5Y2VudHJpYyBjb29yZHMgKDAsIDEtdywgdykKCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBiICkuYWRkU2NhbGVkVmVjdG9yKCBfdmJjLCB3ICk7IC8vIGVkZ2UgcmVnaW9uIG9mIEJDCgoJCX0KCgkJLy8gZmFjZSByZWdpb24KCQljb25zdCBkZW5vbSA9IDEgLyAoIHZhICsgdmIgKyB2YyApOwoJCS8vIHUgPSB2YSAqIGRlbm9tCgkJdiA9IHZiICogZGVub207CgkJdyA9IHZjICogZGVub207CgoJCXJldHVybiB0YXJnZXQuY29weSggYSApLmFkZFNjYWxlZFZlY3RvciggX3ZhYiwgdiApLmFkZFNjYWxlZFZlY3RvciggX3ZhYywgdyApOwoKCX0KCgllcXVhbHMoIHRyaWFuZ2xlICkgewoKCQlyZXR1cm4gdHJpYW5nbGUuYS5lcXVhbHMoIHRoaXMuYSApICYmIHRyaWFuZ2xlLmIuZXF1YWxzKCB0aGlzLmIgKSAmJiB0cmlhbmdsZS5jLmVxdWFscyggdGhpcy5jICk7CgoJfQoKfQoKbGV0IF9tYXRlcmlhbElkID0gMDsKCmNsYXNzIE1hdGVyaWFsIGV4dGVuZHMgRXZlbnREaXNwYXRjaGVyIHsKCgljb25zdHJ1Y3RvcigpIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc01hdGVyaWFsID0gdHJ1ZTsKCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KCB0aGlzLCAnaWQnLCB7IHZhbHVlOiBfbWF0ZXJpYWxJZCArKyB9ICk7CgoJCXRoaXMudXVpZCA9IGdlbmVyYXRlVVVJRCgpOwoKCQl0aGlzLm5hbWUgPSAnJzsKCQl0aGlzLnR5cGUgPSAnTWF0ZXJpYWwnOwoKCQl0aGlzLmJsZW5kaW5nID0gTm9ybWFsQmxlbmRpbmc7CgkJdGhpcy5zaWRlID0gRnJvbnRTaWRlOwoJCXRoaXMudmVydGV4Q29sb3JzID0gZmFsc2U7CgoJCXRoaXMub3BhY2l0eSA9IDE7CgkJdGhpcy50cmFuc3BhcmVudCA9IGZhbHNlOwoJCXRoaXMuYWxwaGFIYXNoID0gZmFsc2U7CgoJCXRoaXMuYmxlbmRTcmMgPSBTcmNBbHBoYUZhY3RvcjsKCQl0aGlzLmJsZW5kRHN0ID0gT25lTWludXNTcmNBbHBoYUZhY3RvcjsKCQl0aGlzLmJsZW5kRXF1YXRpb24gPSBBZGRFcXVhdGlvbjsKCQl0aGlzLmJsZW5kU3JjQWxwaGEgPSBudWxsOwoJCXRoaXMuYmxlbmREc3RBbHBoYSA9IG51bGw7CgkJdGhpcy5ibGVuZEVxdWF0aW9uQWxwaGEgPSBudWxsOwoKCQl0aGlzLmRlcHRoRnVuYyA9IExlc3NFcXVhbERlcHRoOwoJCXRoaXMuZGVwdGhUZXN0ID0gdHJ1ZTsKCQl0aGlzLmRlcHRoV3JpdGUgPSB0cnVlOwoKCQl0aGlzLnN0ZW5jaWxXcml0ZU1hc2sgPSAweGZmOwoJCXRoaXMuc3RlbmNpbEZ1bmMgPSBBbHdheXNTdGVuY2lsRnVuYzsKCQl0aGlzLnN0ZW5jaWxSZWYgPSAwOwoJCXRoaXMuc3RlbmNpbEZ1bmNNYXNrID0gMHhmZjsKCQl0aGlzLnN0ZW5jaWxGYWlsID0gS2VlcFN0ZW5jaWxPcDsKCQl0aGlzLnN0ZW5jaWxaRmFpbCA9IEtlZXBTdGVuY2lsT3A7CgkJdGhpcy5zdGVuY2lsWlBhc3MgPSBLZWVwU3RlbmNpbE9wOwoJCXRoaXMuc3RlbmNpbFdyaXRlID0gZmFsc2U7CgoJCXRoaXMuY2xpcHBpbmdQbGFuZXMgPSBudWxsOwoJCXRoaXMuY2xpcEludGVyc2VjdGlvbiA9IGZhbHNlOwoJCXRoaXMuY2xpcFNoYWRvd3MgPSBmYWxzZTsKCgkJdGhpcy5zaGFkb3dTaWRlID0gbnVsbDsKCgkJdGhpcy5jb2xvcldyaXRlID0gdHJ1ZTsKCgkJdGhpcy5wcmVjaXNpb24gPSBudWxsOyAvLyBvdmVycmlkZSB0aGUgcmVuZGVyZXIncyBkZWZhdWx0IHByZWNpc2lvbiBmb3IgdGhpcyBtYXRlcmlhbAoKCQl0aGlzLnBvbHlnb25PZmZzZXQgPSBmYWxzZTsKCQl0aGlzLnBvbHlnb25PZmZzZXRGYWN0b3IgPSAwOwoJCXRoaXMucG9seWdvbk9mZnNldFVuaXRzID0gMDsKCgkJdGhpcy5kaXRoZXJpbmcgPSBmYWxzZTsKCgkJdGhpcy5hbHBoYVRvQ292ZXJhZ2UgPSBmYWxzZTsKCQl0aGlzLnByZW11bHRpcGxpZWRBbHBoYSA9IGZhbHNlOwoJCXRoaXMuZm9yY2VTaW5nbGVQYXNzID0gZmFsc2U7CgoJCXRoaXMudmlzaWJsZSA9IHRydWU7CgoJCXRoaXMudG9uZU1hcHBlZCA9IHRydWU7CgoJCXRoaXMudXNlckRhdGEgPSB7fTsKCgkJdGhpcy52ZXJzaW9uID0gMDsKCgkJdGhpcy5fYWxwaGFUZXN0ID0gMDsKCgl9CgoJZ2V0IGFscGhhVGVzdCgpIHsKCgkJcmV0dXJuIHRoaXMuX2FscGhhVGVzdDsKCgl9CgoJc2V0IGFscGhhVGVzdCggdmFsdWUgKSB7CgoJCWlmICggdGhpcy5fYWxwaGFUZXN0ID4gMCAhPT0gdmFsdWUgPiAwICkgewoKCQkJdGhpcy52ZXJzaW9uICsrOwoKCQl9CgoJCXRoaXMuX2FscGhhVGVzdCA9IHZhbHVlOwoKCX0KCglvbkJ1aWxkKCAvKiBzaGFkZXJvYmplY3QsIHJlbmRlcmVyICovICkge30KCglvbkJlZm9yZVJlbmRlciggLyogcmVuZGVyZXIsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBvYmplY3QsIGdyb3VwICovICkge30KCglvbkJlZm9yZUNvbXBpbGUoIC8qIHNoYWRlcm9iamVjdCwgcmVuZGVyZXIgKi8gKSB7fQoKCWN1c3RvbVByb2dyYW1DYWNoZUtleSgpIHsKCgkJcmV0dXJuIHRoaXMub25CZWZvcmVDb21waWxlLnRvU3RyaW5nKCk7CgoJfQoKCXNldFZhbHVlcyggdmFsdWVzICkgewoKCQlpZiAoIHZhbHVlcyA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQlmb3IgKCBjb25zdCBrZXkgaW4gdmFsdWVzICkgewoKCQkJY29uc3QgbmV3VmFsdWUgPSB2YWx1ZXNbIGtleSBdOwoKCQkJaWYgKCBuZXdWYWx1ZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggYFRIUkVFLk1hdGVyaWFsOiBwYXJhbWV0ZXIgJyR7IGtleSB9JyBoYXMgdmFsdWUgb2YgdW5kZWZpbmVkLmAgKTsKCQkJCWNvbnRpbnVlOwoKCQkJfQoKCQkJY29uc3QgY3VycmVudFZhbHVlID0gdGhpc1sga2V5IF07CgoJCQlpZiAoIGN1cnJlbnRWYWx1ZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggYFRIUkVFLk1hdGVyaWFsOiAnJHsga2V5IH0nIGlzIG5vdCBhIHByb3BlcnR5IG9mIFRIUkVFLiR7IHRoaXMudHlwZSB9LmAgKTsKCQkJCWNvbnRpbnVlOwoKCQkJfQoKCQkJaWYgKCBjdXJyZW50VmFsdWUgJiYgY3VycmVudFZhbHVlLmlzQ29sb3IgKSB7CgoJCQkJY3VycmVudFZhbHVlLnNldCggbmV3VmFsdWUgKTsKCgkJCX0gZWxzZSBpZiAoICggY3VycmVudFZhbHVlICYmIGN1cnJlbnRWYWx1ZS5pc1ZlY3RvcjMgKSAmJiAoIG5ld1ZhbHVlICYmIG5ld1ZhbHVlLmlzVmVjdG9yMyApICkgewoKCQkJCWN1cnJlbnRWYWx1ZS5jb3B5KCBuZXdWYWx1ZSApOwoKCQkJfSBlbHNlIHsKCgkJCQl0aGlzWyBrZXkgXSA9IG5ld1ZhbHVlOwoKCQkJfQoKCQl9CgoJfQoKCXRvSlNPTiggbWV0YSApIHsKCgkJY29uc3QgaXNSb290T2JqZWN0ID0gKCBtZXRhID09PSB1bmRlZmluZWQgfHwgdHlwZW9mIG1ldGEgPT09ICdzdHJpbmcnICk7CgoJCWlmICggaXNSb290T2JqZWN0ICkgewoKCQkJbWV0YSA9IHsKCQkJCXRleHR1cmVzOiB7fSwKCQkJCWltYWdlczoge30KCQkJfTsKCgkJfQoKCQljb25zdCBkYXRhID0gewoJCQltZXRhZGF0YTogewoJCQkJdmVyc2lvbjogNC42LAoJCQkJdHlwZTogJ01hdGVyaWFsJywKCQkJCWdlbmVyYXRvcjogJ01hdGVyaWFsLnRvSlNPTicKCQkJfQoJCX07CgoJCS8vIHN0YW5kYXJkIE1hdGVyaWFsIHNlcmlhbGl6YXRpb24KCQlkYXRhLnV1aWQgPSB0aGlzLnV1aWQ7CgkJZGF0YS50eXBlID0gdGhpcy50eXBlOwoKCQlpZiAoIHRoaXMubmFtZSAhPT0gJycgKSBkYXRhLm5hbWUgPSB0aGlzLm5hbWU7CgoJCWlmICggdGhpcy5jb2xvciAmJiB0aGlzLmNvbG9yLmlzQ29sb3IgKSBkYXRhLmNvbG9yID0gdGhpcy5jb2xvci5nZXRIZXgoKTsKCgkJaWYgKCB0aGlzLnJvdWdobmVzcyAhPT0gdW5kZWZpbmVkICkgZGF0YS5yb3VnaG5lc3MgPSB0aGlzLnJvdWdobmVzczsKCQlpZiAoIHRoaXMubWV0YWxuZXNzICE9PSB1bmRlZmluZWQgKSBkYXRhLm1ldGFsbmVzcyA9IHRoaXMubWV0YWxuZXNzOwoKCQlpZiAoIHRoaXMuc2hlZW4gIT09IHVuZGVmaW5lZCApIGRhdGEuc2hlZW4gPSB0aGlzLnNoZWVuOwoJCWlmICggdGhpcy5zaGVlbkNvbG9yICYmIHRoaXMuc2hlZW5Db2xvci5pc0NvbG9yICkgZGF0YS5zaGVlbkNvbG9yID0gdGhpcy5zaGVlbkNvbG9yLmdldEhleCgpOwoJCWlmICggdGhpcy5zaGVlblJvdWdobmVzcyAhPT0gdW5kZWZpbmVkICkgZGF0YS5zaGVlblJvdWdobmVzcyA9IHRoaXMuc2hlZW5Sb3VnaG5lc3M7CgkJaWYgKCB0aGlzLmVtaXNzaXZlICYmIHRoaXMuZW1pc3NpdmUuaXNDb2xvciApIGRhdGEuZW1pc3NpdmUgPSB0aGlzLmVtaXNzaXZlLmdldEhleCgpOwoJCWlmICggdGhpcy5lbWlzc2l2ZUludGVuc2l0eSAmJiB0aGlzLmVtaXNzaXZlSW50ZW5zaXR5ICE9PSAxICkgZGF0YS5lbWlzc2l2ZUludGVuc2l0eSA9IHRoaXMuZW1pc3NpdmVJbnRlbnNpdHk7CgoJCWlmICggdGhpcy5zcGVjdWxhciAmJiB0aGlzLnNwZWN1bGFyLmlzQ29sb3IgKSBkYXRhLnNwZWN1bGFyID0gdGhpcy5zcGVjdWxhci5nZXRIZXgoKTsKCQlpZiAoIHRoaXMuc3BlY3VsYXJJbnRlbnNpdHkgIT09IHVuZGVmaW5lZCApIGRhdGEuc3BlY3VsYXJJbnRlbnNpdHkgPSB0aGlzLnNwZWN1bGFySW50ZW5zaXR5OwoJCWlmICggdGhpcy5zcGVjdWxhckNvbG9yICYmIHRoaXMuc3BlY3VsYXJDb2xvci5pc0NvbG9yICkgZGF0YS5zcGVjdWxhckNvbG9yID0gdGhpcy5zcGVjdWxhckNvbG9yLmdldEhleCgpOwoJCWlmICggdGhpcy5zaGluaW5lc3MgIT09IHVuZGVmaW5lZCApIGRhdGEuc2hpbmluZXNzID0gdGhpcy5zaGluaW5lc3M7CgkJaWYgKCB0aGlzLmNsZWFyY29hdCAhPT0gdW5kZWZpbmVkICkgZGF0YS5jbGVhcmNvYXQgPSB0aGlzLmNsZWFyY29hdDsKCQlpZiAoIHRoaXMuY2xlYXJjb2F0Um91Z2huZXNzICE9PSB1bmRlZmluZWQgKSBkYXRhLmNsZWFyY29hdFJvdWdobmVzcyA9IHRoaXMuY2xlYXJjb2F0Um91Z2huZXNzOwoKCQlpZiAoIHRoaXMuY2xlYXJjb2F0TWFwICYmIHRoaXMuY2xlYXJjb2F0TWFwLmlzVGV4dHVyZSApIHsKCgkJCWRhdGEuY2xlYXJjb2F0TWFwID0gdGhpcy5jbGVhcmNvYXRNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCgkJfQoKCQlpZiAoIHRoaXMuY2xlYXJjb2F0Um91Z2huZXNzTWFwICYmIHRoaXMuY2xlYXJjb2F0Um91Z2huZXNzTWFwLmlzVGV4dHVyZSApIHsKCgkJCWRhdGEuY2xlYXJjb2F0Um91Z2huZXNzTWFwID0gdGhpcy5jbGVhcmNvYXRSb3VnaG5lc3NNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCgkJfQoKCQlpZiAoIHRoaXMuY2xlYXJjb2F0Tm9ybWFsTWFwICYmIHRoaXMuY2xlYXJjb2F0Tm9ybWFsTWFwLmlzVGV4dHVyZSApIHsKCgkJCWRhdGEuY2xlYXJjb2F0Tm9ybWFsTWFwID0gdGhpcy5jbGVhcmNvYXROb3JtYWxNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCQkJZGF0YS5jbGVhcmNvYXROb3JtYWxTY2FsZSA9IHRoaXMuY2xlYXJjb2F0Tm9ybWFsU2NhbGUudG9BcnJheSgpOwoKCQl9CgoJCWlmICggdGhpcy5pcmlkZXNjZW5jZSAhPT0gdW5kZWZpbmVkICkgZGF0YS5pcmlkZXNjZW5jZSA9IHRoaXMuaXJpZGVzY2VuY2U7CgkJaWYgKCB0aGlzLmlyaWRlc2NlbmNlSU9SICE9PSB1bmRlZmluZWQgKSBkYXRhLmlyaWRlc2NlbmNlSU9SID0gdGhpcy5pcmlkZXNjZW5jZUlPUjsKCQlpZiAoIHRoaXMuaXJpZGVzY2VuY2VUaGlja25lc3NSYW5nZSAhPT0gdW5kZWZpbmVkICkgZGF0YS5pcmlkZXNjZW5jZVRoaWNrbmVzc1JhbmdlID0gdGhpcy5pcmlkZXNjZW5jZVRoaWNrbmVzc1JhbmdlOwoKCQlpZiAoIHRoaXMuaXJpZGVzY2VuY2VNYXAgJiYgdGhpcy5pcmlkZXNjZW5jZU1hcC5pc1RleHR1cmUgKSB7CgoJCQlkYXRhLmlyaWRlc2NlbmNlTWFwID0gdGhpcy5pcmlkZXNjZW5jZU1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoKCQl9CgoJCWlmICggdGhpcy5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcCAmJiB0aGlzLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwLmlzVGV4dHVyZSApIHsKCgkJCWRhdGEuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAgPSB0aGlzLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgoJCX0KCgkJaWYgKCB0aGlzLmFuaXNvdHJvcHkgIT09IHVuZGVmaW5lZCApIGRhdGEuYW5pc290cm9weSA9IHRoaXMuYW5pc290cm9weTsKCQlpZiAoIHRoaXMuYW5pc290cm9weVJvdGF0aW9uICE9PSB1bmRlZmluZWQgKSBkYXRhLmFuaXNvdHJvcHlSb3RhdGlvbiA9IHRoaXMuYW5pc290cm9weVJvdGF0aW9uOwoKCQlpZiAoIHRoaXMuYW5pc290cm9weU1hcCAmJiB0aGlzLmFuaXNvdHJvcHlNYXAuaXNUZXh0dXJlICkgewoKCQkJZGF0YS5hbmlzb3Ryb3B5TWFwID0gdGhpcy5hbmlzb3Ryb3B5TWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgoJCX0KCgkJaWYgKCB0aGlzLm1hcCAmJiB0aGlzLm1hcC5pc1RleHR1cmUgKSBkYXRhLm1hcCA9IHRoaXMubWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJaWYgKCB0aGlzLm1hdGNhcCAmJiB0aGlzLm1hdGNhcC5pc1RleHR1cmUgKSBkYXRhLm1hdGNhcCA9IHRoaXMubWF0Y2FwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJaWYgKCB0aGlzLmFscGhhTWFwICYmIHRoaXMuYWxwaGFNYXAuaXNUZXh0dXJlICkgZGF0YS5hbHBoYU1hcCA9IHRoaXMuYWxwaGFNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCgkJaWYgKCB0aGlzLmxpZ2h0TWFwICYmIHRoaXMubGlnaHRNYXAuaXNUZXh0dXJlICkgewoKCQkJZGF0YS5saWdodE1hcCA9IHRoaXMubGlnaHRNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCQkJZGF0YS5saWdodE1hcEludGVuc2l0eSA9IHRoaXMubGlnaHRNYXBJbnRlbnNpdHk7CgoJCX0KCgkJaWYgKCB0aGlzLmFvTWFwICYmIHRoaXMuYW9NYXAuaXNUZXh0dXJlICkgewoKCQkJZGF0YS5hb01hcCA9IHRoaXMuYW9NYXAudG9KU09OKCBtZXRhICkudXVpZDsKCQkJZGF0YS5hb01hcEludGVuc2l0eSA9IHRoaXMuYW9NYXBJbnRlbnNpdHk7CgoJCX0KCgkJaWYgKCB0aGlzLmJ1bXBNYXAgJiYgdGhpcy5idW1wTWFwLmlzVGV4dHVyZSApIHsKCgkJCWRhdGEuYnVtcE1hcCA9IHRoaXMuYnVtcE1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoJCQlkYXRhLmJ1bXBTY2FsZSA9IHRoaXMuYnVtcFNjYWxlOwoKCQl9CgoJCWlmICggdGhpcy5ub3JtYWxNYXAgJiYgdGhpcy5ub3JtYWxNYXAuaXNUZXh0dXJlICkgewoKCQkJZGF0YS5ub3JtYWxNYXAgPSB0aGlzLm5vcm1hbE1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoJCQlkYXRhLm5vcm1hbE1hcFR5cGUgPSB0aGlzLm5vcm1hbE1hcFR5cGU7CgkJCWRhdGEubm9ybWFsU2NhbGUgPSB0aGlzLm5vcm1hbFNjYWxlLnRvQXJyYXkoKTsKCgkJfQoKCQlpZiAoIHRoaXMuZGlzcGxhY2VtZW50TWFwICYmIHRoaXMuZGlzcGxhY2VtZW50TWFwLmlzVGV4dHVyZSApIHsKCgkJCWRhdGEuZGlzcGxhY2VtZW50TWFwID0gdGhpcy5kaXNwbGFjZW1lbnRNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCQkJZGF0YS5kaXNwbGFjZW1lbnRTY2FsZSA9IHRoaXMuZGlzcGxhY2VtZW50U2NhbGU7CgkJCWRhdGEuZGlzcGxhY2VtZW50QmlhcyA9IHRoaXMuZGlzcGxhY2VtZW50QmlhczsKCgkJfQoKCQlpZiAoIHRoaXMucm91Z2huZXNzTWFwICYmIHRoaXMucm91Z2huZXNzTWFwLmlzVGV4dHVyZSApIGRhdGEucm91Z2huZXNzTWFwID0gdGhpcy5yb3VnaG5lc3NNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCQlpZiAoIHRoaXMubWV0YWxuZXNzTWFwICYmIHRoaXMubWV0YWxuZXNzTWFwLmlzVGV4dHVyZSApIGRhdGEubWV0YWxuZXNzTWFwID0gdGhpcy5tZXRhbG5lc3NNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCgkJaWYgKCB0aGlzLmVtaXNzaXZlTWFwICYmIHRoaXMuZW1pc3NpdmVNYXAuaXNUZXh0dXJlICkgZGF0YS5lbWlzc2l2ZU1hcCA9IHRoaXMuZW1pc3NpdmVNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCQlpZiAoIHRoaXMuc3BlY3VsYXJNYXAgJiYgdGhpcy5zcGVjdWxhck1hcC5pc1RleHR1cmUgKSBkYXRhLnNwZWN1bGFyTWFwID0gdGhpcy5zcGVjdWxhck1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoJCWlmICggdGhpcy5zcGVjdWxhckludGVuc2l0eU1hcCAmJiB0aGlzLnNwZWN1bGFySW50ZW5zaXR5TWFwLmlzVGV4dHVyZSApIGRhdGEuc3BlY3VsYXJJbnRlbnNpdHlNYXAgPSB0aGlzLnNwZWN1bGFySW50ZW5zaXR5TWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgkJaWYgKCB0aGlzLnNwZWN1bGFyQ29sb3JNYXAgJiYgdGhpcy5zcGVjdWxhckNvbG9yTWFwLmlzVGV4dHVyZSApIGRhdGEuc3BlY3VsYXJDb2xvck1hcCA9IHRoaXMuc3BlY3VsYXJDb2xvck1hcC50b0pTT04oIG1ldGEgKS51dWlkOwoKCQlpZiAoIHRoaXMuZW52TWFwICYmIHRoaXMuZW52TWFwLmlzVGV4dHVyZSApIHsKCgkJCWRhdGEuZW52TWFwID0gdGhpcy5lbnZNYXAudG9KU09OKCBtZXRhICkudXVpZDsKCgkJCWlmICggdGhpcy5jb21iaW5lICE9PSB1bmRlZmluZWQgKSBkYXRhLmNvbWJpbmUgPSB0aGlzLmNvbWJpbmU7CgoJCX0KCgkJaWYgKCB0aGlzLmVudk1hcEludGVuc2l0eSAhPT0gdW5kZWZpbmVkICkgZGF0YS5lbnZNYXBJbnRlbnNpdHkgPSB0aGlzLmVudk1hcEludGVuc2l0eTsKCQlpZiAoIHRoaXMucmVmbGVjdGl2aXR5ICE9PSB1bmRlZmluZWQgKSBkYXRhLnJlZmxlY3Rpdml0eSA9IHRoaXMucmVmbGVjdGl2aXR5OwoJCWlmICggdGhpcy5yZWZyYWN0aW9uUmF0aW8gIT09IHVuZGVmaW5lZCApIGRhdGEucmVmcmFjdGlvblJhdGlvID0gdGhpcy5yZWZyYWN0aW9uUmF0aW87CgoJCWlmICggdGhpcy5ncmFkaWVudE1hcCAmJiB0aGlzLmdyYWRpZW50TWFwLmlzVGV4dHVyZSApIHsKCgkJCWRhdGEuZ3JhZGllbnRNYXAgPSB0aGlzLmdyYWRpZW50TWFwLnRvSlNPTiggbWV0YSApLnV1aWQ7CgoJCX0KCgkJaWYgKCB0aGlzLnRyYW5zbWlzc2lvbiAhPT0gdW5kZWZpbmVkICkgZGF0YS50cmFuc21pc3Npb24gPSB0aGlzLnRyYW5zbWlzc2lvbjsKCQlpZiAoIHRoaXMudHJhbnNtaXNzaW9uTWFwICYmIHRoaXMudHJhbnNtaXNzaW9uTWFwLmlzVGV4dHVyZSApIGRhdGEudHJhbnNtaXNzaW9uTWFwID0gdGhpcy50cmFuc21pc3Npb25NYXAudG9KU09OKCBtZXRhICkudXVpZDsKCQlpZiAoIHRoaXMudGhpY2tuZXNzICE9PSB1bmRlZmluZWQgKSBkYXRhLnRoaWNrbmVzcyA9IHRoaXMudGhpY2tuZXNzOwoJCWlmICggdGhpcy50aGlja25lc3NNYXAgJiYgdGhpcy50aGlja25lc3NNYXAuaXNUZXh0dXJlICkgZGF0YS50aGlja25lc3NNYXAgPSB0aGlzLnRoaWNrbmVzc01hcC50b0pTT04oIG1ldGEgKS51dWlkOwoJCWlmICggdGhpcy5hdHRlbnVhdGlvbkRpc3RhbmNlICE9PSB1bmRlZmluZWQgJiYgdGhpcy5hdHRlbnVhdGlvbkRpc3RhbmNlICE9PSBJbmZpbml0eSApIGRhdGEuYXR0ZW51YXRpb25EaXN0YW5jZSA9IHRoaXMuYXR0ZW51YXRpb25EaXN0YW5jZTsKCQlpZiAoIHRoaXMuYXR0ZW51YXRpb25Db2xvciAhPT0gdW5kZWZpbmVkICkgZGF0YS5hdHRlbnVhdGlvbkNvbG9yID0gdGhpcy5hdHRlbnVhdGlvbkNvbG9yLmdldEhleCgpOwoKCQlpZiAoIHRoaXMuc2l6ZSAhPT0gdW5kZWZpbmVkICkgZGF0YS5zaXplID0gdGhpcy5zaXplOwoJCWlmICggdGhpcy5zaGFkb3dTaWRlICE9PSBudWxsICkgZGF0YS5zaGFkb3dTaWRlID0gdGhpcy5zaGFkb3dTaWRlOwoJCWlmICggdGhpcy5zaXplQXR0ZW51YXRpb24gIT09IHVuZGVmaW5lZCApIGRhdGEuc2l6ZUF0dGVudWF0aW9uID0gdGhpcy5zaXplQXR0ZW51YXRpb247CgoJCWlmICggdGhpcy5ibGVuZGluZyAhPT0gTm9ybWFsQmxlbmRpbmcgKSBkYXRhLmJsZW5kaW5nID0gdGhpcy5ibGVuZGluZzsKCQlpZiAoIHRoaXMuc2lkZSAhPT0gRnJvbnRTaWRlICkgZGF0YS5zaWRlID0gdGhpcy5zaWRlOwoJCWlmICggdGhpcy52ZXJ0ZXhDb2xvcnMgPT09IHRydWUgKSBkYXRhLnZlcnRleENvbG9ycyA9IHRydWU7CgoJCWlmICggdGhpcy5vcGFjaXR5IDwgMSApIGRhdGEub3BhY2l0eSA9IHRoaXMub3BhY2l0eTsKCQlpZiAoIHRoaXMudHJhbnNwYXJlbnQgPT09IHRydWUgKSBkYXRhLnRyYW5zcGFyZW50ID0gdHJ1ZTsKCgkJZGF0YS5kZXB0aEZ1bmMgPSB0aGlzLmRlcHRoRnVuYzsKCQlkYXRhLmRlcHRoVGVzdCA9IHRoaXMuZGVwdGhUZXN0OwoJCWRhdGEuZGVwdGhXcml0ZSA9IHRoaXMuZGVwdGhXcml0ZTsKCQlkYXRhLmNvbG9yV3JpdGUgPSB0aGlzLmNvbG9yV3JpdGU7CgoJCWRhdGEuc3RlbmNpbFdyaXRlID0gdGhpcy5zdGVuY2lsV3JpdGU7CgkJZGF0YS5zdGVuY2lsV3JpdGVNYXNrID0gdGhpcy5zdGVuY2lsV3JpdGVNYXNrOwoJCWRhdGEuc3RlbmNpbEZ1bmMgPSB0aGlzLnN0ZW5jaWxGdW5jOwoJCWRhdGEuc3RlbmNpbFJlZiA9IHRoaXMuc3RlbmNpbFJlZjsKCQlkYXRhLnN0ZW5jaWxGdW5jTWFzayA9IHRoaXMuc3RlbmNpbEZ1bmNNYXNrOwoJCWRhdGEuc3RlbmNpbEZhaWwgPSB0aGlzLnN0ZW5jaWxGYWlsOwoJCWRhdGEuc3RlbmNpbFpGYWlsID0gdGhpcy5zdGVuY2lsWkZhaWw7CgkJZGF0YS5zdGVuY2lsWlBhc3MgPSB0aGlzLnN0ZW5jaWxaUGFzczsKCgkJLy8gcm90YXRpb24gKFNwcml0ZU1hdGVyaWFsKQoJCWlmICggdGhpcy5yb3RhdGlvbiAhPT0gdW5kZWZpbmVkICYmIHRoaXMucm90YXRpb24gIT09IDAgKSBkYXRhLnJvdGF0aW9uID0gdGhpcy5yb3RhdGlvbjsKCgkJaWYgKCB0aGlzLnBvbHlnb25PZmZzZXQgPT09IHRydWUgKSBkYXRhLnBvbHlnb25PZmZzZXQgPSB0cnVlOwoJCWlmICggdGhpcy5wb2x5Z29uT2Zmc2V0RmFjdG9yICE9PSAwICkgZGF0YS5wb2x5Z29uT2Zmc2V0RmFjdG9yID0gdGhpcy5wb2x5Z29uT2Zmc2V0RmFjdG9yOwoJCWlmICggdGhpcy5wb2x5Z29uT2Zmc2V0VW5pdHMgIT09IDAgKSBkYXRhLnBvbHlnb25PZmZzZXRVbml0cyA9IHRoaXMucG9seWdvbk9mZnNldFVuaXRzOwoKCQlpZiAoIHRoaXMubGluZXdpZHRoICE9PSB1bmRlZmluZWQgJiYgdGhpcy5saW5ld2lkdGggIT09IDEgKSBkYXRhLmxpbmV3aWR0aCA9IHRoaXMubGluZXdpZHRoOwoJCWlmICggdGhpcy5kYXNoU2l6ZSAhPT0gdW5kZWZpbmVkICkgZGF0YS5kYXNoU2l6ZSA9IHRoaXMuZGFzaFNpemU7CgkJaWYgKCB0aGlzLmdhcFNpemUgIT09IHVuZGVmaW5lZCApIGRhdGEuZ2FwU2l6ZSA9IHRoaXMuZ2FwU2l6ZTsKCQlpZiAoIHRoaXMuc2NhbGUgIT09IHVuZGVmaW5lZCApIGRhdGEuc2NhbGUgPSB0aGlzLnNjYWxlOwoKCQlpZiAoIHRoaXMuZGl0aGVyaW5nID09PSB0cnVlICkgZGF0YS5kaXRoZXJpbmcgPSB0cnVlOwoKCQlpZiAoIHRoaXMuYWxwaGFUZXN0ID4gMCApIGRhdGEuYWxwaGFUZXN0ID0gdGhpcy5hbHBoYVRlc3Q7CgkJaWYgKCB0aGlzLmFscGhhSGFzaCA9PT0gdHJ1ZSApIGRhdGEuYWxwaGFIYXNoID0gdHJ1ZTsKCQlpZiAoIHRoaXMuYWxwaGFUb0NvdmVyYWdlID09PSB0cnVlICkgZGF0YS5hbHBoYVRvQ292ZXJhZ2UgPSB0cnVlOwoJCWlmICggdGhpcy5wcmVtdWx0aXBsaWVkQWxwaGEgPT09IHRydWUgKSBkYXRhLnByZW11bHRpcGxpZWRBbHBoYSA9IHRydWU7CgkJaWYgKCB0aGlzLmZvcmNlU2luZ2xlUGFzcyA9PT0gdHJ1ZSApIGRhdGEuZm9yY2VTaW5nbGVQYXNzID0gdHJ1ZTsKCgkJaWYgKCB0aGlzLndpcmVmcmFtZSA9PT0gdHJ1ZSApIGRhdGEud2lyZWZyYW1lID0gdHJ1ZTsKCQlpZiAoIHRoaXMud2lyZWZyYW1lTGluZXdpZHRoID4gMSApIGRhdGEud2lyZWZyYW1lTGluZXdpZHRoID0gdGhpcy53aXJlZnJhbWVMaW5ld2lkdGg7CgkJaWYgKCB0aGlzLndpcmVmcmFtZUxpbmVjYXAgIT09ICdyb3VuZCcgKSBkYXRhLndpcmVmcmFtZUxpbmVjYXAgPSB0aGlzLndpcmVmcmFtZUxpbmVjYXA7CgkJaWYgKCB0aGlzLndpcmVmcmFtZUxpbmVqb2luICE9PSAncm91bmQnICkgZGF0YS53aXJlZnJhbWVMaW5lam9pbiA9IHRoaXMud2lyZWZyYW1lTGluZWpvaW47CgoJCWlmICggdGhpcy5mbGF0U2hhZGluZyA9PT0gdHJ1ZSApIGRhdGEuZmxhdFNoYWRpbmcgPSB0cnVlOwoKCQlpZiAoIHRoaXMudmlzaWJsZSA9PT0gZmFsc2UgKSBkYXRhLnZpc2libGUgPSBmYWxzZTsKCgkJaWYgKCB0aGlzLnRvbmVNYXBwZWQgPT09IGZhbHNlICkgZGF0YS50b25lTWFwcGVkID0gZmFsc2U7CgoJCWlmICggdGhpcy5mb2cgPT09IGZhbHNlICkgZGF0YS5mb2cgPSBmYWxzZTsKCgkJaWYgKCBPYmplY3Qua2V5cyggdGhpcy51c2VyRGF0YSApLmxlbmd0aCA+IDAgKSBkYXRhLnVzZXJEYXRhID0gdGhpcy51c2VyRGF0YTsKCgkJLy8gVE9ETzogQ29waWVkIGZyb20gT2JqZWN0M0QudG9KU09OCgoJCWZ1bmN0aW9uIGV4dHJhY3RGcm9tQ2FjaGUoIGNhY2hlICkgewoKCQkJY29uc3QgdmFsdWVzID0gW107CgoJCQlmb3IgKCBjb25zdCBrZXkgaW4gY2FjaGUgKSB7CgoJCQkJY29uc3QgZGF0YSA9IGNhY2hlWyBrZXkgXTsKCQkJCWRlbGV0ZSBkYXRhLm1ldGFkYXRhOwoJCQkJdmFsdWVzLnB1c2goIGRhdGEgKTsKCgkJCX0KCgkJCXJldHVybiB2YWx1ZXM7CgoJCX0KCgkJaWYgKCBpc1Jvb3RPYmplY3QgKSB7CgoJCQljb25zdCB0ZXh0dXJlcyA9IGV4dHJhY3RGcm9tQ2FjaGUoIG1ldGEudGV4dHVyZXMgKTsKCQkJY29uc3QgaW1hZ2VzID0gZXh0cmFjdEZyb21DYWNoZSggbWV0YS5pbWFnZXMgKTsKCgkJCWlmICggdGV4dHVyZXMubGVuZ3RoID4gMCApIGRhdGEudGV4dHVyZXMgPSB0ZXh0dXJlczsKCQkJaWYgKCBpbWFnZXMubGVuZ3RoID4gMCApIGRhdGEuaW1hZ2VzID0gaW1hZ2VzOwoKCQl9CgoJCXJldHVybiBkYXRhOwoKCX0KCgljbG9uZSgpIHsKCgkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXRoaXMubmFtZSA9IHNvdXJjZS5uYW1lOwoKCQl0aGlzLmJsZW5kaW5nID0gc291cmNlLmJsZW5kaW5nOwoJCXRoaXMuc2lkZSA9IHNvdXJjZS5zaWRlOwoJCXRoaXMudmVydGV4Q29sb3JzID0gc291cmNlLnZlcnRleENvbG9yczsKCgkJdGhpcy5vcGFjaXR5ID0gc291cmNlLm9wYWNpdHk7CgkJdGhpcy50cmFuc3BhcmVudCA9IHNvdXJjZS50cmFuc3BhcmVudDsKCgkJdGhpcy5ibGVuZFNyYyA9IHNvdXJjZS5ibGVuZFNyYzsKCQl0aGlzLmJsZW5kRHN0ID0gc291cmNlLmJsZW5kRHN0OwoJCXRoaXMuYmxlbmRFcXVhdGlvbiA9IHNvdXJjZS5ibGVuZEVxdWF0aW9uOwoJCXRoaXMuYmxlbmRTcmNBbHBoYSA9IHNvdXJjZS5ibGVuZFNyY0FscGhhOwoJCXRoaXMuYmxlbmREc3RBbHBoYSA9IHNvdXJjZS5ibGVuZERzdEFscGhhOwoJCXRoaXMuYmxlbmRFcXVhdGlvbkFscGhhID0gc291cmNlLmJsZW5kRXF1YXRpb25BbHBoYTsKCgkJdGhpcy5kZXB0aEZ1bmMgPSBzb3VyY2UuZGVwdGhGdW5jOwoJCXRoaXMuZGVwdGhUZXN0ID0gc291cmNlLmRlcHRoVGVzdDsKCQl0aGlzLmRlcHRoV3JpdGUgPSBzb3VyY2UuZGVwdGhXcml0ZTsKCgkJdGhpcy5zdGVuY2lsV3JpdGVNYXNrID0gc291cmNlLnN0ZW5jaWxXcml0ZU1hc2s7CgkJdGhpcy5zdGVuY2lsRnVuYyA9IHNvdXJjZS5zdGVuY2lsRnVuYzsKCQl0aGlzLnN0ZW5jaWxSZWYgPSBzb3VyY2Uuc3RlbmNpbFJlZjsKCQl0aGlzLnN0ZW5jaWxGdW5jTWFzayA9IHNvdXJjZS5zdGVuY2lsRnVuY01hc2s7CgkJdGhpcy5zdGVuY2lsRmFpbCA9IHNvdXJjZS5zdGVuY2lsRmFpbDsKCQl0aGlzLnN0ZW5jaWxaRmFpbCA9IHNvdXJjZS5zdGVuY2lsWkZhaWw7CgkJdGhpcy5zdGVuY2lsWlBhc3MgPSBzb3VyY2Uuc3RlbmNpbFpQYXNzOwoJCXRoaXMuc3RlbmNpbFdyaXRlID0gc291cmNlLnN0ZW5jaWxXcml0ZTsKCgkJY29uc3Qgc3JjUGxhbmVzID0gc291cmNlLmNsaXBwaW5nUGxhbmVzOwoJCWxldCBkc3RQbGFuZXMgPSBudWxsOwoKCQlpZiAoIHNyY1BsYW5lcyAhPT0gbnVsbCApIHsKCgkJCWNvbnN0IG4gPSBzcmNQbGFuZXMubGVuZ3RoOwoJCQlkc3RQbGFuZXMgPSBuZXcgQXJyYXkoIG4gKTsKCgkJCWZvciAoIGxldCBpID0gMDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCQlkc3RQbGFuZXNbIGkgXSA9IHNyY1BsYW5lc1sgaSBdLmNsb25lKCk7CgoJCQl9CgoJCX0KCgkJdGhpcy5jbGlwcGluZ1BsYW5lcyA9IGRzdFBsYW5lczsKCQl0aGlzLmNsaXBJbnRlcnNlY3Rpb24gPSBzb3VyY2UuY2xpcEludGVyc2VjdGlvbjsKCQl0aGlzLmNsaXBTaGFkb3dzID0gc291cmNlLmNsaXBTaGFkb3dzOwoKCQl0aGlzLnNoYWRvd1NpZGUgPSBzb3VyY2Uuc2hhZG93U2lkZTsKCgkJdGhpcy5jb2xvcldyaXRlID0gc291cmNlLmNvbG9yV3JpdGU7CgoJCXRoaXMucHJlY2lzaW9uID0gc291cmNlLnByZWNpc2lvbjsKCgkJdGhpcy5wb2x5Z29uT2Zmc2V0ID0gc291cmNlLnBvbHlnb25PZmZzZXQ7CgkJdGhpcy5wb2x5Z29uT2Zmc2V0RmFjdG9yID0gc291cmNlLnBvbHlnb25PZmZzZXRGYWN0b3I7CgkJdGhpcy5wb2x5Z29uT2Zmc2V0VW5pdHMgPSBzb3VyY2UucG9seWdvbk9mZnNldFVuaXRzOwoKCQl0aGlzLmRpdGhlcmluZyA9IHNvdXJjZS5kaXRoZXJpbmc7CgoJCXRoaXMuYWxwaGFUZXN0ID0gc291cmNlLmFscGhhVGVzdDsKCQl0aGlzLmFscGhhSGFzaCA9IHNvdXJjZS5hbHBoYUhhc2g7CgkJdGhpcy5hbHBoYVRvQ292ZXJhZ2UgPSBzb3VyY2UuYWxwaGFUb0NvdmVyYWdlOwoJCXRoaXMucHJlbXVsdGlwbGllZEFscGhhID0gc291cmNlLnByZW11bHRpcGxpZWRBbHBoYTsKCQl0aGlzLmZvcmNlU2luZ2xlUGFzcyA9IHNvdXJjZS5mb3JjZVNpbmdsZVBhc3M7CgoJCXRoaXMudmlzaWJsZSA9IHNvdXJjZS52aXNpYmxlOwoKCQl0aGlzLnRvbmVNYXBwZWQgPSBzb3VyY2UudG9uZU1hcHBlZDsKCgkJdGhpcy51c2VyRGF0YSA9IEpTT04ucGFyc2UoIEpTT04uc3RyaW5naWZ5KCBzb3VyY2UudXNlckRhdGEgKSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZGlzcG9zZSgpIHsKCgkJdGhpcy5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdkaXNwb3NlJyB9ICk7CgoJfQoKCXNldCBuZWVkc1VwZGF0ZSggdmFsdWUgKSB7CgoJCWlmICggdmFsdWUgPT09IHRydWUgKSB0aGlzLnZlcnNpb24gKys7CgoJfQoKfQoKY29uc3QgX2NvbG9yS2V5d29yZHMgPSB7ICdhbGljZWJsdWUnOiAweEYwRjhGRiwgJ2FudGlxdWV3aGl0ZSc6IDB4RkFFQkQ3LCAnYXF1YSc6IDB4MDBGRkZGLCAnYXF1YW1hcmluZSc6IDB4N0ZGRkQ0LCAnYXp1cmUnOiAweEYwRkZGRiwKCSdiZWlnZSc6IDB4RjVGNURDLCAnYmlzcXVlJzogMHhGRkU0QzQsICdibGFjayc6IDB4MDAwMDAwLCAnYmxhbmNoZWRhbG1vbmQnOiAweEZGRUJDRCwgJ2JsdWUnOiAweDAwMDBGRiwgJ2JsdWV2aW9sZXQnOiAweDhBMkJFMiwKCSdicm93bic6IDB4QTUyQTJBLCAnYnVybHl3b29kJzogMHhERUI4ODcsICdjYWRldGJsdWUnOiAweDVGOUVBMCwgJ2NoYXJ0cmV1c2UnOiAweDdGRkYwMCwgJ2Nob2NvbGF0ZSc6IDB4RDI2OTFFLCAnY29yYWwnOiAweEZGN0Y1MCwKCSdjb3JuZmxvd2VyYmx1ZSc6IDB4NjQ5NUVELCAnY29ybnNpbGsnOiAweEZGRjhEQywgJ2NyaW1zb24nOiAweERDMTQzQywgJ2N5YW4nOiAweDAwRkZGRiwgJ2RhcmtibHVlJzogMHgwMDAwOEIsICdkYXJrY3lhbic6IDB4MDA4QjhCLAoJJ2Rhcmtnb2xkZW5yb2QnOiAweEI4ODYwQiwgJ2RhcmtncmF5JzogMHhBOUE5QTksICdkYXJrZ3JlZW4nOiAweDAwNjQwMCwgJ2RhcmtncmV5JzogMHhBOUE5QTksICdkYXJra2hha2knOiAweEJEQjc2QiwgJ2RhcmttYWdlbnRhJzogMHg4QjAwOEIsCgknZGFya29saXZlZ3JlZW4nOiAweDU1NkIyRiwgJ2RhcmtvcmFuZ2UnOiAweEZGOEMwMCwgJ2RhcmtvcmNoaWQnOiAweDk5MzJDQywgJ2RhcmtyZWQnOiAweDhCMDAwMCwgJ2RhcmtzYWxtb24nOiAweEU5OTY3QSwgJ2RhcmtzZWFncmVlbic6IDB4OEZCQzhGLAoJJ2RhcmtzbGF0ZWJsdWUnOiAweDQ4M0Q4QiwgJ2RhcmtzbGF0ZWdyYXknOiAweDJGNEY0RiwgJ2RhcmtzbGF0ZWdyZXknOiAweDJGNEY0RiwgJ2Rhcmt0dXJxdW9pc2UnOiAweDAwQ0VEMSwgJ2Rhcmt2aW9sZXQnOiAweDk0MDBEMywKCSdkZWVwcGluayc6IDB4RkYxNDkzLCAnZGVlcHNreWJsdWUnOiAweDAwQkZGRiwgJ2RpbWdyYXknOiAweDY5Njk2OSwgJ2RpbWdyZXknOiAweDY5Njk2OSwgJ2RvZGdlcmJsdWUnOiAweDFFOTBGRiwgJ2ZpcmVicmljayc6IDB4QjIyMjIyLAoJJ2Zsb3JhbHdoaXRlJzogMHhGRkZBRjAsICdmb3Jlc3RncmVlbic6IDB4MjI4QjIyLCAnZnVjaHNpYSc6IDB4RkYwMEZGLCAnZ2FpbnNib3JvJzogMHhEQ0RDREMsICdnaG9zdHdoaXRlJzogMHhGOEY4RkYsICdnb2xkJzogMHhGRkQ3MDAsCgknZ29sZGVucm9kJzogMHhEQUE1MjAsICdncmF5JzogMHg4MDgwODAsICdncmVlbic6IDB4MDA4MDAwLCAnZ3JlZW55ZWxsb3cnOiAweEFERkYyRiwgJ2dyZXknOiAweDgwODA4MCwgJ2hvbmV5ZGV3JzogMHhGMEZGRjAsICdob3RwaW5rJzogMHhGRjY5QjQsCgknaW5kaWFucmVkJzogMHhDRDVDNUMsICdpbmRpZ28nOiAweDRCMDA4MiwgJ2l2b3J5JzogMHhGRkZGRjAsICdraGFraSc6IDB4RjBFNjhDLCAnbGF2ZW5kZXInOiAweEU2RTZGQSwgJ2xhdmVuZGVyYmx1c2gnOiAweEZGRjBGNSwgJ2xhd25ncmVlbic6IDB4N0NGQzAwLAoJJ2xlbW9uY2hpZmZvbic6IDB4RkZGQUNELCAnbGlnaHRibHVlJzogMHhBREQ4RTYsICdsaWdodGNvcmFsJzogMHhGMDgwODAsICdsaWdodGN5YW4nOiAweEUwRkZGRiwgJ2xpZ2h0Z29sZGVucm9keWVsbG93JzogMHhGQUZBRDIsICdsaWdodGdyYXknOiAweEQzRDNEMywKCSdsaWdodGdyZWVuJzogMHg5MEVFOTAsICdsaWdodGdyZXknOiAweEQzRDNEMywgJ2xpZ2h0cGluayc6IDB4RkZCNkMxLCAnbGlnaHRzYWxtb24nOiAweEZGQTA3QSwgJ2xpZ2h0c2VhZ3JlZW4nOiAweDIwQjJBQSwgJ2xpZ2h0c2t5Ymx1ZSc6IDB4ODdDRUZBLAoJJ2xpZ2h0c2xhdGVncmF5JzogMHg3Nzg4OTksICdsaWdodHNsYXRlZ3JleSc6IDB4Nzc4ODk5LCAnbGlnaHRzdGVlbGJsdWUnOiAweEIwQzRERSwgJ2xpZ2h0eWVsbG93JzogMHhGRkZGRTAsICdsaW1lJzogMHgwMEZGMDAsICdsaW1lZ3JlZW4nOiAweDMyQ0QzMiwKCSdsaW5lbic6IDB4RkFGMEU2LCAnbWFnZW50YSc6IDB4RkYwMEZGLCAnbWFyb29uJzogMHg4MDAwMDAsICdtZWRpdW1hcXVhbWFyaW5lJzogMHg2NkNEQUEsICdtZWRpdW1ibHVlJzogMHgwMDAwQ0QsICdtZWRpdW1vcmNoaWQnOiAweEJBNTVEMywKCSdtZWRpdW1wdXJwbGUnOiAweDkzNzBEQiwgJ21lZGl1bXNlYWdyZWVuJzogMHgzQ0IzNzEsICdtZWRpdW1zbGF0ZWJsdWUnOiAweDdCNjhFRSwgJ21lZGl1bXNwcmluZ2dyZWVuJzogMHgwMEZBOUEsICdtZWRpdW10dXJxdW9pc2UnOiAweDQ4RDFDQywKCSdtZWRpdW12aW9sZXRyZWQnOiAweEM3MTU4NSwgJ21pZG5pZ2h0Ymx1ZSc6IDB4MTkxOTcwLCAnbWludGNyZWFtJzogMHhGNUZGRkEsICdtaXN0eXJvc2UnOiAweEZGRTRFMSwgJ21vY2Nhc2luJzogMHhGRkU0QjUsICduYXZham93aGl0ZSc6IDB4RkZERUFELAoJJ25hdnknOiAweDAwMDA4MCwgJ29sZGxhY2UnOiAweEZERjVFNiwgJ29saXZlJzogMHg4MDgwMDAsICdvbGl2ZWRyYWInOiAweDZCOEUyMywgJ29yYW5nZSc6IDB4RkZBNTAwLCAnb3JhbmdlcmVkJzogMHhGRjQ1MDAsICdvcmNoaWQnOiAweERBNzBENiwKCSdwYWxlZ29sZGVucm9kJzogMHhFRUU4QUEsICdwYWxlZ3JlZW4nOiAweDk4RkI5OCwgJ3BhbGV0dXJxdW9pc2UnOiAweEFGRUVFRSwgJ3BhbGV2aW9sZXRyZWQnOiAweERCNzA5MywgJ3BhcGF5YXdoaXAnOiAweEZGRUZENSwgJ3BlYWNocHVmZic6IDB4RkZEQUI5LAoJJ3BlcnUnOiAweENEODUzRiwgJ3BpbmsnOiAweEZGQzBDQiwgJ3BsdW0nOiAweEREQTBERCwgJ3Bvd2RlcmJsdWUnOiAweEIwRTBFNiwgJ3B1cnBsZSc6IDB4ODAwMDgwLCAncmViZWNjYXB1cnBsZSc6IDB4NjYzMzk5LCAncmVkJzogMHhGRjAwMDAsICdyb3N5YnJvd24nOiAweEJDOEY4RiwKCSdyb3lhbGJsdWUnOiAweDQxNjlFMSwgJ3NhZGRsZWJyb3duJzogMHg4QjQ1MTMsICdzYWxtb24nOiAweEZBODA3MiwgJ3NhbmR5YnJvd24nOiAweEY0QTQ2MCwgJ3NlYWdyZWVuJzogMHgyRThCNTcsICdzZWFzaGVsbCc6IDB4RkZGNUVFLAoJJ3NpZW5uYSc6IDB4QTA1MjJELCAnc2lsdmVyJzogMHhDMEMwQzAsICdza3libHVlJzogMHg4N0NFRUIsICdzbGF0ZWJsdWUnOiAweDZBNUFDRCwgJ3NsYXRlZ3JheSc6IDB4NzA4MDkwLCAnc2xhdGVncmV5JzogMHg3MDgwOTAsICdzbm93JzogMHhGRkZBRkEsCgknc3ByaW5nZ3JlZW4nOiAweDAwRkY3RiwgJ3N0ZWVsYmx1ZSc6IDB4NDY4MkI0LCAndGFuJzogMHhEMkI0OEMsICd0ZWFsJzogMHgwMDgwODAsICd0aGlzdGxlJzogMHhEOEJGRDgsICd0b21hdG8nOiAweEZGNjM0NywgJ3R1cnF1b2lzZSc6IDB4NDBFMEQwLAoJJ3Zpb2xldCc6IDB4RUU4MkVFLCAnd2hlYXQnOiAweEY1REVCMywgJ3doaXRlJzogMHhGRkZGRkYsICd3aGl0ZXNtb2tlJzogMHhGNUY1RjUsICd5ZWxsb3cnOiAweEZGRkYwMCwgJ3llbGxvd2dyZWVuJzogMHg5QUNEMzIgfTsKCmNvbnN0IF9oc2xBID0geyBoOiAwLCBzOiAwLCBsOiAwIH07CmNvbnN0IF9oc2xCID0geyBoOiAwLCBzOiAwLCBsOiAwIH07CgpmdW5jdGlvbiBodWUycmdiKCBwLCBxLCB0ICkgewoKCWlmICggdCA8IDAgKSB0ICs9IDE7CglpZiAoIHQgPiAxICkgdCAtPSAxOwoJaWYgKCB0IDwgMSAvIDYgKSByZXR1cm4gcCArICggcSAtIHAgKSAqIDYgKiB0OwoJaWYgKCB0IDwgMSAvIDIgKSByZXR1cm4gcTsKCWlmICggdCA8IDIgLyAzICkgcmV0dXJuIHAgKyAoIHEgLSBwICkgKiA2ICogKCAyIC8gMyAtIHQgKTsKCXJldHVybiBwOwoKfQoKY2xhc3MgQ29sb3IgewoKCWNvbnN0cnVjdG9yKCByLCBnLCBiICkgewoKCQl0aGlzLmlzQ29sb3IgPSB0cnVlOwoKCQl0aGlzLnIgPSAxOwoJCXRoaXMuZyA9IDE7CgkJdGhpcy5iID0gMTsKCgkJcmV0dXJuIHRoaXMuc2V0KCByLCBnLCBiICk7CgoJfQoKCXNldCggciwgZywgYiApIHsKCgkJaWYgKCBnID09PSB1bmRlZmluZWQgJiYgYiA9PT0gdW5kZWZpbmVkICkgewoKCQkJLy8gciBpcyBUSFJFRS5Db2xvciwgaGV4IG9yIHN0cmluZwoKCQkJY29uc3QgdmFsdWUgPSByOwoKCQkJaWYgKCB2YWx1ZSAmJiB2YWx1ZS5pc0NvbG9yICkgewoKCQkJCXRoaXMuY29weSggdmFsdWUgKTsKCgkJCX0gZWxzZSBpZiAoIHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicgKSB7CgoJCQkJdGhpcy5zZXRIZXgoIHZhbHVlICk7CgoJCQl9IGVsc2UgaWYgKCB0eXBlb2YgdmFsdWUgPT09ICdzdHJpbmcnICkgewoKCQkJCXRoaXMuc2V0U3R5bGUoIHZhbHVlICk7CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQl0aGlzLnNldFJHQiggciwgZywgYiApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRTY2FsYXIoIHNjYWxhciApIHsKCgkJdGhpcy5yID0gc2NhbGFyOwoJCXRoaXMuZyA9IHNjYWxhcjsKCQl0aGlzLmIgPSBzY2FsYXI7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRIZXgoIGhleCwgY29sb3JTcGFjZSA9IFNSR0JDb2xvclNwYWNlICkgewoKCQloZXggPSBNYXRoLmZsb29yKCBoZXggKTsKCgkJdGhpcy5yID0gKCBoZXggPj4gMTYgJiAyNTUgKSAvIDI1NTsKCQl0aGlzLmcgPSAoIGhleCA+PiA4ICYgMjU1ICkgLyAyNTU7CgkJdGhpcy5iID0gKCBoZXggJiAyNTUgKSAvIDI1NTsKCgkJQ29sb3JNYW5hZ2VtZW50LnRvV29ya2luZ0NvbG9yU3BhY2UoIHRoaXMsIGNvbG9yU3BhY2UgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldFJHQiggciwgZywgYiwgY29sb3JTcGFjZSA9IENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSApIHsKCgkJdGhpcy5yID0gcjsKCQl0aGlzLmcgPSBnOwoJCXRoaXMuYiA9IGI7CgoJCUNvbG9yTWFuYWdlbWVudC50b1dvcmtpbmdDb2xvclNwYWNlKCB0aGlzLCBjb2xvclNwYWNlICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRIU0woIGgsIHMsIGwsIGNvbG9yU3BhY2UgPSBDb2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2UgKSB7CgoJCS8vIGgscyxsIHJhbmdlcyBhcmUgaW4gMC4wIC0gMS4wCgkJaCA9IGV1Y2xpZGVhbk1vZHVsbyggaCwgMSApOwoJCXMgPSBjbGFtcCggcywgMCwgMSApOwoJCWwgPSBjbGFtcCggbCwgMCwgMSApOwoKCQlpZiAoIHMgPT09IDAgKSB7CgoJCQl0aGlzLnIgPSB0aGlzLmcgPSB0aGlzLmIgPSBsOwoKCQl9IGVsc2UgewoKCQkJY29uc3QgcCA9IGwgPD0gMC41ID8gbCAqICggMSArIHMgKSA6IGwgKyBzIC0gKCBsICogcyApOwoJCQljb25zdCBxID0gKCAyICogbCApIC0gcDsKCgkJCXRoaXMuciA9IGh1ZTJyZ2IoIHEsIHAsIGggKyAxIC8gMyApOwoJCQl0aGlzLmcgPSBodWUycmdiKCBxLCBwLCBoICk7CgkJCXRoaXMuYiA9IGh1ZTJyZ2IoIHEsIHAsIGggLSAxIC8gMyApOwoKCQl9CgoJCUNvbG9yTWFuYWdlbWVudC50b1dvcmtpbmdDb2xvclNwYWNlKCB0aGlzLCBjb2xvclNwYWNlICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRTdHlsZSggc3R5bGUsIGNvbG9yU3BhY2UgPSBTUkdCQ29sb3JTcGFjZSApIHsKCgkJZnVuY3Rpb24gaGFuZGxlQWxwaGEoIHN0cmluZyApIHsKCgkJCWlmICggc3RyaW5nID09PSB1bmRlZmluZWQgKSByZXR1cm47CgoJCQlpZiAoIHBhcnNlRmxvYXQoIHN0cmluZyApIDwgMSApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5Db2xvcjogQWxwaGEgY29tcG9uZW50IG9mICcgKyBzdHlsZSArICcgd2lsbCBiZSBpZ25vcmVkLicgKTsKCgkJCX0KCgkJfQoKCgkJbGV0IG07CgoJCWlmICggbSA9IC9eKFx3KylcKChbXlwpXSopXCkvLmV4ZWMoIHN0eWxlICkgKSB7CgoJCQkvLyByZ2IgLyBoc2wKCgkJCWxldCBjb2xvcjsKCQkJY29uc3QgbmFtZSA9IG1bIDEgXTsKCQkJY29uc3QgY29tcG9uZW50cyA9IG1bIDIgXTsKCgkJCXN3aXRjaCAoIG5hbWUgKSB7CgoJCQkJY2FzZSAncmdiJzoKCQkJCWNhc2UgJ3JnYmEnOgoKCQkJCQlpZiAoIGNvbG9yID0gL15ccyooXGQrKVxzKixccyooXGQrKVxzKixccyooXGQrKVxzKig/OixccyooXGQqXC4/XGQrKVxzKik/JC8uZXhlYyggY29tcG9uZW50cyApICkgewoKCQkJCQkJLy8gcmdiKDI1NSwwLDApIHJnYmEoMjU1LDAsMCwwLjUpCgoJCQkJCQloYW5kbGVBbHBoYSggY29sb3JbIDQgXSApOwoKCQkJCQkJcmV0dXJuIHRoaXMuc2V0UkdCKAoJCQkJCQkJTWF0aC5taW4oIDI1NSwgcGFyc2VJbnQoIGNvbG9yWyAxIF0sIDEwICkgKSAvIDI1NSwKCQkJCQkJCU1hdGgubWluKCAyNTUsIHBhcnNlSW50KCBjb2xvclsgMiBdLCAxMCApICkgLyAyNTUsCgkJCQkJCQlNYXRoLm1pbiggMjU1LCBwYXJzZUludCggY29sb3JbIDMgXSwgMTAgKSApIC8gMjU1LAoJCQkJCQkJY29sb3JTcGFjZQoJCQkJCQkpOwoKCQkJCQl9CgoJCQkJCWlmICggY29sb3IgPSAvXlxzKihcZCspXCVccyosXHMqKFxkKylcJVxzKixccyooXGQrKVwlXHMqKD86LFxzKihcZCpcLj9cZCspXHMqKT8kLy5leGVjKCBjb21wb25lbnRzICkgKSB7CgoJCQkJCQkvLyByZ2IoMTAwJSwwJSwwJSkgcmdiYSgxMDAlLDAlLDAlLDAuNSkKCgkJCQkJCWhhbmRsZUFscGhhKCBjb2xvclsgNCBdICk7CgoJCQkJCQlyZXR1cm4gdGhpcy5zZXRSR0IoCgkJCQkJCQlNYXRoLm1pbiggMTAwLCBwYXJzZUludCggY29sb3JbIDEgXSwgMTAgKSApIC8gMTAwLAoJCQkJCQkJTWF0aC5taW4oIDEwMCwgcGFyc2VJbnQoIGNvbG9yWyAyIF0sIDEwICkgKSAvIDEwMCwKCQkJCQkJCU1hdGgubWluKCAxMDAsIHBhcnNlSW50KCBjb2xvclsgMyBdLCAxMCApICkgLyAxMDAsCgkJCQkJCQljb2xvclNwYWNlCgkJCQkJCSk7CgoJCQkJCX0KCgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnaHNsJzoKCQkJCWNhc2UgJ2hzbGEnOgoKCQkJCQlpZiAoIGNvbG9yID0gL15ccyooXGQqXC4/XGQrKVxzKixccyooXGQqXC4/XGQrKVwlXHMqLFxzKihcZCpcLj9cZCspXCVccyooPzosXHMqKFxkKlwuP1xkKylccyopPyQvLmV4ZWMoIGNvbXBvbmVudHMgKSApIHsKCgkJCQkJCS8vIGhzbCgxMjAsNTAlLDUwJSkgaHNsYSgxMjAsNTAlLDUwJSwwLjUpCgoJCQkJCQloYW5kbGVBbHBoYSggY29sb3JbIDQgXSApOwoKCQkJCQkJcmV0dXJuIHRoaXMuc2V0SFNMKAoJCQkJCQkJcGFyc2VGbG9hdCggY29sb3JbIDEgXSApIC8gMzYwLAoJCQkJCQkJcGFyc2VGbG9hdCggY29sb3JbIDIgXSApIC8gMTAwLAoJCQkJCQkJcGFyc2VGbG9hdCggY29sb3JbIDMgXSApIC8gMTAwLAoJCQkJCQkJY29sb3JTcGFjZQoJCQkJCQkpOwoKCQkJCQl9CgoJCQkJCWJyZWFrOwoKCQkJCWRlZmF1bHQ6CgoJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkNvbG9yOiBVbmtub3duIGNvbG9yIG1vZGVsICcgKyBzdHlsZSApOwoKCQkJfQoKCQl9IGVsc2UgaWYgKCBtID0gL15cIyhbQS1GYS1mXGRdKykkLy5leGVjKCBzdHlsZSApICkgewoKCQkJLy8gaGV4IGNvbG9yCgoJCQljb25zdCBoZXggPSBtWyAxIF07CgkJCWNvbnN0IHNpemUgPSBoZXgubGVuZ3RoOwoKCQkJaWYgKCBzaXplID09PSAzICkgewoKCQkJCS8vICNmZjAKCQkJCXJldHVybiB0aGlzLnNldFJHQigKCQkJCQlwYXJzZUludCggaGV4LmNoYXJBdCggMCApLCAxNiApIC8gMTUsCgkJCQkJcGFyc2VJbnQoIGhleC5jaGFyQXQoIDEgKSwgMTYgKSAvIDE1LAoJCQkJCXBhcnNlSW50KCBoZXguY2hhckF0KCAyICksIDE2ICkgLyAxNSwKCQkJCQljb2xvclNwYWNlCgkJCQkpOwoKCQkJfSBlbHNlIGlmICggc2l6ZSA9PT0gNiApIHsKCgkJCQkvLyAjZmYwMDAwCgkJCQlyZXR1cm4gdGhpcy5zZXRIZXgoIHBhcnNlSW50KCBoZXgsIDE2ICksIGNvbG9yU3BhY2UgKTsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQ29sb3I6IEludmFsaWQgaGV4IGNvbG9yICcgKyBzdHlsZSApOwoKCQkJfQoKCQl9IGVsc2UgaWYgKCBzdHlsZSAmJiBzdHlsZS5sZW5ndGggPiAwICkgewoKCQkJcmV0dXJuIHRoaXMuc2V0Q29sb3JOYW1lKCBzdHlsZSwgY29sb3JTcGFjZSApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRDb2xvck5hbWUoIHN0eWxlLCBjb2xvclNwYWNlID0gU1JHQkNvbG9yU3BhY2UgKSB7CgoJCS8vIGNvbG9yIGtleXdvcmRzCgkJY29uc3QgaGV4ID0gX2NvbG9yS2V5d29yZHNbIHN0eWxlLnRvTG93ZXJDYXNlKCkgXTsKCgkJaWYgKCBoZXggIT09IHVuZGVmaW5lZCApIHsKCgkJCS8vIHJlZAoJCQl0aGlzLnNldEhleCggaGV4LCBjb2xvclNwYWNlICk7CgoJCX0gZWxzZSB7CgoJCQkvLyB1bmtub3duIGNvbG9yCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkNvbG9yOiBVbmtub3duIGNvbG9yICcgKyBzdHlsZSApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgljbG9uZSgpIHsKCgkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCB0aGlzLnIsIHRoaXMuZywgdGhpcy5iICk7CgoJfQoKCWNvcHkoIGNvbG9yICkgewoKCQl0aGlzLnIgPSBjb2xvci5yOwoJCXRoaXMuZyA9IGNvbG9yLmc7CgkJdGhpcy5iID0gY29sb3IuYjsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvcHlTUkdCVG9MaW5lYXIoIGNvbG9yICkgewoKCQl0aGlzLnIgPSBTUkdCVG9MaW5lYXIoIGNvbG9yLnIgKTsKCQl0aGlzLmcgPSBTUkdCVG9MaW5lYXIoIGNvbG9yLmcgKTsKCQl0aGlzLmIgPSBTUkdCVG9MaW5lYXIoIGNvbG9yLmIgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvcHlMaW5lYXJUb1NSR0IoIGNvbG9yICkgewoKCQl0aGlzLnIgPSBMaW5lYXJUb1NSR0IoIGNvbG9yLnIgKTsKCQl0aGlzLmcgPSBMaW5lYXJUb1NSR0IoIGNvbG9yLmcgKTsKCQl0aGlzLmIgPSBMaW5lYXJUb1NSR0IoIGNvbG9yLmIgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvbnZlcnRTUkdCVG9MaW5lYXIoKSB7CgoJCXRoaXMuY29weVNSR0JUb0xpbmVhciggdGhpcyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY29udmVydExpbmVhclRvU1JHQigpIHsKCgkJdGhpcy5jb3B5TGluZWFyVG9TUkdCKCB0aGlzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXRIZXgoIGNvbG9yU3BhY2UgPSBTUkdCQ29sb3JTcGFjZSApIHsKCgkJQ29sb3JNYW5hZ2VtZW50LmZyb21Xb3JraW5nQ29sb3JTcGFjZSggX2NvbG9yLmNvcHkoIHRoaXMgKSwgY29sb3JTcGFjZSApOwoKCQlyZXR1cm4gTWF0aC5yb3VuZCggY2xhbXAoIF9jb2xvci5yICogMjU1LCAwLCAyNTUgKSApICogNjU1MzYgKyBNYXRoLnJvdW5kKCBjbGFtcCggX2NvbG9yLmcgKiAyNTUsIDAsIDI1NSApICkgKiAyNTYgKyBNYXRoLnJvdW5kKCBjbGFtcCggX2NvbG9yLmIgKiAyNTUsIDAsIDI1NSApICk7CgoJfQoKCWdldEhleFN0cmluZyggY29sb3JTcGFjZSA9IFNSR0JDb2xvclNwYWNlICkgewoKCQlyZXR1cm4gKCAnMDAwMDAwJyArIHRoaXMuZ2V0SGV4KCBjb2xvclNwYWNlICkudG9TdHJpbmcoIDE2ICkgKS5zbGljZSggLSA2ICk7CgoJfQoKCWdldEhTTCggdGFyZ2V0LCBjb2xvclNwYWNlID0gQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlICkgewoKCQkvLyBoLHMsbCByYW5nZXMgYXJlIGluIDAuMCAtIDEuMAoKCQlDb2xvck1hbmFnZW1lbnQuZnJvbVdvcmtpbmdDb2xvclNwYWNlKCBfY29sb3IuY29weSggdGhpcyApLCBjb2xvclNwYWNlICk7CgoJCWNvbnN0IHIgPSBfY29sb3IuciwgZyA9IF9jb2xvci5nLCBiID0gX2NvbG9yLmI7CgoJCWNvbnN0IG1heCA9IE1hdGgubWF4KCByLCBnLCBiICk7CgkJY29uc3QgbWluID0gTWF0aC5taW4oIHIsIGcsIGIgKTsKCgkJbGV0IGh1ZSwgc2F0dXJhdGlvbjsKCQljb25zdCBsaWdodG5lc3MgPSAoIG1pbiArIG1heCApIC8gMi4wOwoKCQlpZiAoIG1pbiA9PT0gbWF4ICkgewoKCQkJaHVlID0gMDsKCQkJc2F0dXJhdGlvbiA9IDA7CgoJCX0gZWxzZSB7CgoJCQljb25zdCBkZWx0YSA9IG1heCAtIG1pbjsKCgkJCXNhdHVyYXRpb24gPSBsaWdodG5lc3MgPD0gMC41ID8gZGVsdGEgLyAoIG1heCArIG1pbiApIDogZGVsdGEgLyAoIDIgLSBtYXggLSBtaW4gKTsKCgkJCXN3aXRjaCAoIG1heCApIHsKCgkJCQljYXNlIHI6IGh1ZSA9ICggZyAtIGIgKSAvIGRlbHRhICsgKCBnIDwgYiA/IDYgOiAwICk7IGJyZWFrOwoJCQkJY2FzZSBnOiBodWUgPSAoIGIgLSByICkgLyBkZWx0YSArIDI7IGJyZWFrOwoJCQkJY2FzZSBiOiBodWUgPSAoIHIgLSBnICkgLyBkZWx0YSArIDQ7IGJyZWFrOwoKCQkJfQoKCQkJaHVlIC89IDY7CgoJCX0KCgkJdGFyZ2V0LmggPSBodWU7CgkJdGFyZ2V0LnMgPSBzYXR1cmF0aW9uOwoJCXRhcmdldC5sID0gbGlnaHRuZXNzOwoKCQlyZXR1cm4gdGFyZ2V0OwoKCX0KCglnZXRSR0IoIHRhcmdldCwgY29sb3JTcGFjZSA9IENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSApIHsKCgkJQ29sb3JNYW5hZ2VtZW50LmZyb21Xb3JraW5nQ29sb3JTcGFjZSggX2NvbG9yLmNvcHkoIHRoaXMgKSwgY29sb3JTcGFjZSApOwoKCQl0YXJnZXQuciA9IF9jb2xvci5yOwoJCXRhcmdldC5nID0gX2NvbG9yLmc7CgkJdGFyZ2V0LmIgPSBfY29sb3IuYjsKCgkJcmV0dXJuIHRhcmdldDsKCgl9CgoJZ2V0U3R5bGUoIGNvbG9yU3BhY2UgPSBTUkdCQ29sb3JTcGFjZSApIHsKCgkJQ29sb3JNYW5hZ2VtZW50LmZyb21Xb3JraW5nQ29sb3JTcGFjZSggX2NvbG9yLmNvcHkoIHRoaXMgKSwgY29sb3JTcGFjZSApOwoKCQljb25zdCByID0gX2NvbG9yLnIsIGcgPSBfY29sb3IuZywgYiA9IF9jb2xvci5iOwoKCQlpZiAoIGNvbG9yU3BhY2UgIT09IFNSR0JDb2xvclNwYWNlICkgewoKCQkJLy8gUmVxdWlyZXMgQ1NTIENvbG9yIE1vZHVsZSBMZXZlbCA0IChodHRwczovL3d3dy53My5vcmcvVFIvY3NzLWNvbG9yLTQvKS4KCQkJcmV0dXJuIGBjb2xvcigkeyBjb2xvclNwYWNlIH0gJHsgci50b0ZpeGVkKCAzICkgfSAkeyBnLnRvRml4ZWQoIDMgKSB9ICR7IGIudG9GaXhlZCggMyApIH0pYDsKCgkJfQoKCQlyZXR1cm4gYHJnYigkeyBNYXRoLnJvdW5kKCByICogMjU1ICkgfSwkeyBNYXRoLnJvdW5kKCBnICogMjU1ICkgfSwkeyBNYXRoLnJvdW5kKCBiICogMjU1ICkgfSlgOwoKCX0KCglvZmZzZXRIU0woIGgsIHMsIGwgKSB7CgoJCXRoaXMuZ2V0SFNMKCBfaHNsQSApOwoKCQlyZXR1cm4gdGhpcy5zZXRIU0woIF9oc2xBLmggKyBoLCBfaHNsQS5zICsgcywgX2hzbEEubCArIGwgKTsKCgl9CgoJYWRkKCBjb2xvciApIHsKCgkJdGhpcy5yICs9IGNvbG9yLnI7CgkJdGhpcy5nICs9IGNvbG9yLmc7CgkJdGhpcy5iICs9IGNvbG9yLmI7CgoJCXJldHVybiB0aGlzOwoKCX0KCglhZGRDb2xvcnMoIGNvbG9yMSwgY29sb3IyICkgewoKCQl0aGlzLnIgPSBjb2xvcjEuciArIGNvbG9yMi5yOwoJCXRoaXMuZyA9IGNvbG9yMS5nICsgY29sb3IyLmc7CgkJdGhpcy5iID0gY29sb3IxLmIgKyBjb2xvcjIuYjsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFkZFNjYWxhciggcyApIHsKCgkJdGhpcy5yICs9IHM7CgkJdGhpcy5nICs9IHM7CgkJdGhpcy5iICs9IHM7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzdWIoIGNvbG9yICkgewoKCQl0aGlzLnIgPSBNYXRoLm1heCggMCwgdGhpcy5yIC0gY29sb3IuciApOwoJCXRoaXMuZyA9IE1hdGgubWF4KCAwLCB0aGlzLmcgLSBjb2xvci5nICk7CgkJdGhpcy5iID0gTWF0aC5tYXgoIDAsIHRoaXMuYiAtIGNvbG9yLmIgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCW11bHRpcGx5KCBjb2xvciApIHsKCgkJdGhpcy5yICo9IGNvbG9yLnI7CgkJdGhpcy5nICo9IGNvbG9yLmc7CgkJdGhpcy5iICo9IGNvbG9yLmI7CgoJCXJldHVybiB0aGlzOwoKCX0KCgltdWx0aXBseVNjYWxhciggcyApIHsKCgkJdGhpcy5yICo9IHM7CgkJdGhpcy5nICo9IHM7CgkJdGhpcy5iICo9IHM7CgoJCXJldHVybiB0aGlzOwoKCX0KCglsZXJwKCBjb2xvciwgYWxwaGEgKSB7CgoJCXRoaXMuciArPSAoIGNvbG9yLnIgLSB0aGlzLnIgKSAqIGFscGhhOwoJCXRoaXMuZyArPSAoIGNvbG9yLmcgLSB0aGlzLmcgKSAqIGFscGhhOwoJCXRoaXMuYiArPSAoIGNvbG9yLmIgLSB0aGlzLmIgKSAqIGFscGhhOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbGVycENvbG9ycyggY29sb3IxLCBjb2xvcjIsIGFscGhhICkgewoKCQl0aGlzLnIgPSBjb2xvcjEuciArICggY29sb3IyLnIgLSBjb2xvcjEuciApICogYWxwaGE7CgkJdGhpcy5nID0gY29sb3IxLmcgKyAoIGNvbG9yMi5nIC0gY29sb3IxLmcgKSAqIGFscGhhOwoJCXRoaXMuYiA9IGNvbG9yMS5iICsgKCBjb2xvcjIuYiAtIGNvbG9yMS5iICkgKiBhbHBoYTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWxlcnBIU0woIGNvbG9yLCBhbHBoYSApIHsKCgkJdGhpcy5nZXRIU0woIF9oc2xBICk7CgkJY29sb3IuZ2V0SFNMKCBfaHNsQiApOwoKCQljb25zdCBoID0gbGVycCggX2hzbEEuaCwgX2hzbEIuaCwgYWxwaGEgKTsKCQljb25zdCBzID0gbGVycCggX2hzbEEucywgX2hzbEIucywgYWxwaGEgKTsKCQljb25zdCBsID0gbGVycCggX2hzbEEubCwgX2hzbEIubCwgYWxwaGEgKTsKCgkJdGhpcy5zZXRIU0woIGgsIHMsIGwgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldEZyb21WZWN0b3IzKCB2ICkgewoKCQl0aGlzLnIgPSB2Lng7CgkJdGhpcy5nID0gdi55OwoJCXRoaXMuYiA9IHYuejsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFwcGx5TWF0cml4MyggbSApIHsKCgkJY29uc3QgciA9IHRoaXMuciwgZyA9IHRoaXMuZywgYiA9IHRoaXMuYjsKCQljb25zdCBlID0gbS5lbGVtZW50czsKCgkJdGhpcy5yID0gZVsgMCBdICogciArIGVbIDMgXSAqIGcgKyBlWyA2IF0gKiBiOwoJCXRoaXMuZyA9IGVbIDEgXSAqIHIgKyBlWyA0IF0gKiBnICsgZVsgNyBdICogYjsKCQl0aGlzLmIgPSBlWyAyIF0gKiByICsgZVsgNSBdICogZyArIGVbIDggXSAqIGI7CgoJCXJldHVybiB0aGlzOwoKCX0KCgllcXVhbHMoIGMgKSB7CgoJCXJldHVybiAoIGMuciA9PT0gdGhpcy5yICkgJiYgKCBjLmcgPT09IHRoaXMuZyApICYmICggYy5iID09PSB0aGlzLmIgKTsKCgl9CgoJZnJvbUFycmF5KCBhcnJheSwgb2Zmc2V0ID0gMCApIHsKCgkJdGhpcy5yID0gYXJyYXlbIG9mZnNldCBdOwoJCXRoaXMuZyA9IGFycmF5WyBvZmZzZXQgKyAxIF07CgkJdGhpcy5iID0gYXJyYXlbIG9mZnNldCArIDIgXTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgoJCWFycmF5WyBvZmZzZXQgXSA9IHRoaXMucjsKCQlhcnJheVsgb2Zmc2V0ICsgMSBdID0gdGhpcy5nOwoJCWFycmF5WyBvZmZzZXQgKyAyIF0gPSB0aGlzLmI7CgoJCXJldHVybiBhcnJheTsKCgl9CgoJZnJvbUJ1ZmZlckF0dHJpYnV0ZSggYXR0cmlidXRlLCBpbmRleCApIHsKCgkJdGhpcy5yID0gYXR0cmlidXRlLmdldFgoIGluZGV4ICk7CgkJdGhpcy5nID0gYXR0cmlidXRlLmdldFkoIGluZGV4ICk7CgkJdGhpcy5iID0gYXR0cmlidXRlLmdldFooIGluZGV4ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0pTT04oKSB7CgoJCXJldHVybiB0aGlzLmdldEhleCgpOwoKCX0KCgkqWyBTeW1ib2wuaXRlcmF0b3IgXSgpIHsKCgkJeWllbGQgdGhpcy5yOwoJCXlpZWxkIHRoaXMuZzsKCQl5aWVsZCB0aGlzLmI7CgoJfQoKfQoKY29uc3QgX2NvbG9yID0gLypAX19QVVJFX18qLyBuZXcgQ29sb3IoKTsKCkNvbG9yLk5BTUVTID0gX2NvbG9yS2V5d29yZHM7CgpjbGFzcyBNZXNoQmFzaWNNYXRlcmlhbCBleHRlbmRzIE1hdGVyaWFsIHsKCgljb25zdHJ1Y3RvciggcGFyYW1ldGVycyApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc01lc2hCYXNpY01hdGVyaWFsID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ01lc2hCYXNpY01hdGVyaWFsJzsKCgkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggMHhmZmZmZmYgKTsgLy8gZW1pc3NpdmUKCgkJdGhpcy5tYXAgPSBudWxsOwoKCQl0aGlzLmxpZ2h0TWFwID0gbnVsbDsKCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gMS4wOwoKCQl0aGlzLmFvTWFwID0gbnVsbDsKCQl0aGlzLmFvTWFwSW50ZW5zaXR5ID0gMS4wOwoKCQl0aGlzLnNwZWN1bGFyTWFwID0gbnVsbDsKCgkJdGhpcy5hbHBoYU1hcCA9IG51bGw7CgoJCXRoaXMuZW52TWFwID0gbnVsbDsKCQl0aGlzLmNvbWJpbmUgPSBNdWx0aXBseU9wZXJhdGlvbjsKCQl0aGlzLnJlZmxlY3Rpdml0eSA9IDE7CgkJdGhpcy5yZWZyYWN0aW9uUmF0aW8gPSAwLjk4OwoKCQl0aGlzLndpcmVmcmFtZSA9IGZhbHNlOwoJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gMTsKCQl0aGlzLndpcmVmcmFtZUxpbmVjYXAgPSAncm91bmQnOwoJCXRoaXMud2lyZWZyYW1lTGluZWpvaW4gPSAncm91bmQnOwoKCQl0aGlzLmZvZyA9IHRydWU7CgoJCXRoaXMuc2V0VmFsdWVzKCBwYXJhbWV0ZXJzICk7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMuY29sb3IuY29weSggc291cmNlLmNvbG9yICk7CgoJCXRoaXMubWFwID0gc291cmNlLm1hcDsKCgkJdGhpcy5saWdodE1hcCA9IHNvdXJjZS5saWdodE1hcDsKCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gc291cmNlLmxpZ2h0TWFwSW50ZW5zaXR5OwoKCQl0aGlzLmFvTWFwID0gc291cmNlLmFvTWFwOwoJCXRoaXMuYW9NYXBJbnRlbnNpdHkgPSBzb3VyY2UuYW9NYXBJbnRlbnNpdHk7CgoJCXRoaXMuc3BlY3VsYXJNYXAgPSBzb3VyY2Uuc3BlY3VsYXJNYXA7CgoJCXRoaXMuYWxwaGFNYXAgPSBzb3VyY2UuYWxwaGFNYXA7CgoJCXRoaXMuZW52TWFwID0gc291cmNlLmVudk1hcDsKCQl0aGlzLmNvbWJpbmUgPSBzb3VyY2UuY29tYmluZTsKCQl0aGlzLnJlZmxlY3Rpdml0eSA9IHNvdXJjZS5yZWZsZWN0aXZpdHk7CgkJdGhpcy5yZWZyYWN0aW9uUmF0aW8gPSBzb3VyY2UucmVmcmFjdGlvblJhdGlvOwoKCQl0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CgkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSBzb3VyY2Uud2lyZWZyYW1lTGluZXdpZHRoOwoJCXRoaXMud2lyZWZyYW1lTGluZWNhcCA9IHNvdXJjZS53aXJlZnJhbWVMaW5lY2FwOwoJCXRoaXMud2lyZWZyYW1lTGluZWpvaW4gPSBzb3VyY2Uud2lyZWZyYW1lTGluZWpvaW47CgoJCXRoaXMuZm9nID0gc291cmNlLmZvZzsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKLy8gRmFzdCBIYWxmIEZsb2F0IENvbnZlcnNpb25zLCBodHRwOi8vd3d3LmZveC10b29sa2l0Lm9yZy9mdHAvZmFzdGhhbGZmbG9hdGNvbnZlcnNpb24ucGRmCgpjb25zdCBfdGFibGVzID0gLypAX19QVVJFX18qLyBfZ2VuZXJhdGVUYWJsZXMoKTsKCmZ1bmN0aW9uIF9nZW5lcmF0ZVRhYmxlcygpIHsKCgkvLyBmbG9hdDMyIHRvIGZsb2F0MTYgaGVscGVycwoKCWNvbnN0IGJ1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlciggNCApOwoJY29uc3QgZmxvYXRWaWV3ID0gbmV3IEZsb2F0MzJBcnJheSggYnVmZmVyICk7Cgljb25zdCB1aW50MzJWaWV3ID0gbmV3IFVpbnQzMkFycmF5KCBidWZmZXIgKTsKCgljb25zdCBiYXNlVGFibGUgPSBuZXcgVWludDMyQXJyYXkoIDUxMiApOwoJY29uc3Qgc2hpZnRUYWJsZSA9IG5ldyBVaW50MzJBcnJheSggNTEyICk7CgoJZm9yICggbGV0IGkgPSAwOyBpIDwgMjU2OyArKyBpICkgewoKCQljb25zdCBlID0gaSAtIDEyNzsKCgkJLy8gdmVyeSBzbWFsbCBudW1iZXIgKDAsIC0wKQoKCQlpZiAoIGUgPCAtIDI3ICkgewoKCQkJYmFzZVRhYmxlWyBpIF0gPSAweDAwMDA7CgkJCWJhc2VUYWJsZVsgaSB8IDB4MTAwIF0gPSAweDgwMDA7CgkJCXNoaWZ0VGFibGVbIGkgXSA9IDI0OwoJCQlzaGlmdFRhYmxlWyBpIHwgMHgxMDAgXSA9IDI0OwoKCQkJLy8gc21hbGwgbnVtYmVyIChkZW5vcm0pCgoJCX0gZWxzZSBpZiAoIGUgPCAtIDE0ICkgewoKCQkJYmFzZVRhYmxlWyBpIF0gPSAweDA0MDAgPj4gKCAtIGUgLSAxNCApOwoJCQliYXNlVGFibGVbIGkgfCAweDEwMCBdID0gKCAweDA0MDAgPj4gKCAtIGUgLSAxNCApICkgfCAweDgwMDA7CgkJCXNoaWZ0VGFibGVbIGkgXSA9IC0gZSAtIDE7CgkJCXNoaWZ0VGFibGVbIGkgfCAweDEwMCBdID0gLSBlIC0gMTsKCgkJCS8vIG5vcm1hbCBudW1iZXIKCgkJfSBlbHNlIGlmICggZSA8PSAxNSApIHsKCgkJCWJhc2VUYWJsZVsgaSBdID0gKCBlICsgMTUgKSA8PCAxMDsKCQkJYmFzZVRhYmxlWyBpIHwgMHgxMDAgXSA9ICggKCBlICsgMTUgKSA8PCAxMCApIHwgMHg4MDAwOwoJCQlzaGlmdFRhYmxlWyBpIF0gPSAxMzsKCQkJc2hpZnRUYWJsZVsgaSB8IDB4MTAwIF0gPSAxMzsKCgkJCS8vIGxhcmdlIG51bWJlciAoSW5maW5pdHksIC1JbmZpbml0eSkKCgkJfSBlbHNlIGlmICggZSA8IDEyOCApIHsKCgkJCWJhc2VUYWJsZVsgaSBdID0gMHg3YzAwOwoJCQliYXNlVGFibGVbIGkgfCAweDEwMCBdID0gMHhmYzAwOwoJCQlzaGlmdFRhYmxlWyBpIF0gPSAyNDsKCQkJc2hpZnRUYWJsZVsgaSB8IDB4MTAwIF0gPSAyNDsKCgkJCS8vIHN0YXkgKE5hTiwgSW5maW5pdHksIC1JbmZpbml0eSkKCgkJfSBlbHNlIHsKCgkJCWJhc2VUYWJsZVsgaSBdID0gMHg3YzAwOwoJCQliYXNlVGFibGVbIGkgfCAweDEwMCBdID0gMHhmYzAwOwoJCQlzaGlmdFRhYmxlWyBpIF0gPSAxMzsKCQkJc2hpZnRUYWJsZVsgaSB8IDB4MTAwIF0gPSAxMzsKCgkJfQoKCX0KCgkvLyBmbG9hdDE2IHRvIGZsb2F0MzIgaGVscGVycwoKCWNvbnN0IG1hbnRpc3NhVGFibGUgPSBuZXcgVWludDMyQXJyYXkoIDIwNDggKTsKCWNvbnN0IGV4cG9uZW50VGFibGUgPSBuZXcgVWludDMyQXJyYXkoIDY0ICk7Cgljb25zdCBvZmZzZXRUYWJsZSA9IG5ldyBVaW50MzJBcnJheSggNjQgKTsKCglmb3IgKCBsZXQgaSA9IDE7IGkgPCAxMDI0OyArKyBpICkgewoKCQlsZXQgbSA9IGkgPDwgMTM7IC8vIHplcm8gcGFkIG1hbnRpc3NhIGJpdHMKCQlsZXQgZSA9IDA7IC8vIHplcm8gZXhwb25lbnQKCgkJLy8gbm9ybWFsaXplZAoJCXdoaWxlICggKCBtICYgMHgwMDgwMDAwMCApID09PSAwICkgewoKCQkJbSA8PD0gMTsKCQkJZSAtPSAweDAwODAwMDAwOyAvLyBkZWNyZW1lbnQgZXhwb25lbnQKCgkJfQoKCQltICY9IH4gMHgwMDgwMDAwMDsgLy8gY2xlYXIgbGVhZGluZyAxIGJpdAoJCWUgKz0gMHgzODgwMDAwMDsgLy8gYWRqdXN0IGJpYXMKCgkJbWFudGlzc2FUYWJsZVsgaSBdID0gbSB8IGU7CgoJfQoKCWZvciAoIGxldCBpID0gMTAyNDsgaSA8IDIwNDg7ICsrIGkgKSB7CgoJCW1hbnRpc3NhVGFibGVbIGkgXSA9IDB4MzgwMDAwMDAgKyAoICggaSAtIDEwMjQgKSA8PCAxMyApOwoKCX0KCglmb3IgKCBsZXQgaSA9IDE7IGkgPCAzMTsgKysgaSApIHsKCgkJZXhwb25lbnRUYWJsZVsgaSBdID0gaSA8PCAyMzsKCgl9CgoJZXhwb25lbnRUYWJsZVsgMzEgXSA9IDB4NDc4MDAwMDA7CglleHBvbmVudFRhYmxlWyAzMiBdID0gMHg4MDAwMDAwMDsKCglmb3IgKCBsZXQgaSA9IDMzOyBpIDwgNjM7ICsrIGkgKSB7CgoJCWV4cG9uZW50VGFibGVbIGkgXSA9IDB4ODAwMDAwMDAgKyAoICggaSAtIDMyICkgPDwgMjMgKTsKCgl9CgoJZXhwb25lbnRUYWJsZVsgNjMgXSA9IDB4Yzc4MDAwMDA7CgoJZm9yICggbGV0IGkgPSAxOyBpIDwgNjQ7ICsrIGkgKSB7CgoJCWlmICggaSAhPT0gMzIgKSB7CgoJCQlvZmZzZXRUYWJsZVsgaSBdID0gMTAyNDsKCgkJfQoKCX0KCglyZXR1cm4gewoJCWZsb2F0VmlldzogZmxvYXRWaWV3LAoJCXVpbnQzMlZpZXc6IHVpbnQzMlZpZXcsCgkJYmFzZVRhYmxlOiBiYXNlVGFibGUsCgkJc2hpZnRUYWJsZTogc2hpZnRUYWJsZSwKCQltYW50aXNzYVRhYmxlOiBtYW50aXNzYVRhYmxlLAoJCWV4cG9uZW50VGFibGU6IGV4cG9uZW50VGFibGUsCgkJb2Zmc2V0VGFibGU6IG9mZnNldFRhYmxlCgl9OwoKfQoKLy8gZmxvYXQzMiB0byBmbG9hdDE2CgpmdW5jdGlvbiB0b0hhbGZGbG9hdCggdmFsICkgewoKCWlmICggTWF0aC5hYnMoIHZhbCApID4gNjU1MDQgKSBjb25zb2xlLndhcm4oICdUSFJFRS5EYXRhVXRpbHMudG9IYWxmRmxvYXQoKTogVmFsdWUgb3V0IG9mIHJhbmdlLicgKTsKCgl2YWwgPSBjbGFtcCggdmFsLCAtIDY1NTA0LCA2NTUwNCApOwoKCV90YWJsZXMuZmxvYXRWaWV3WyAwIF0gPSB2YWw7Cgljb25zdCBmID0gX3RhYmxlcy51aW50MzJWaWV3WyAwIF07Cgljb25zdCBlID0gKCBmID4+IDIzICkgJiAweDFmZjsKCXJldHVybiBfdGFibGVzLmJhc2VUYWJsZVsgZSBdICsgKCAoIGYgJiAweDAwN2ZmZmZmICkgPj4gX3RhYmxlcy5zaGlmdFRhYmxlWyBlIF0gKTsKCn0KCi8vIGZsb2F0MTYgdG8gZmxvYXQzMgoKZnVuY3Rpb24gZnJvbUhhbGZGbG9hdCggdmFsICkgewoKCWNvbnN0IG0gPSB2YWwgPj4gMTA7CglfdGFibGVzLnVpbnQzMlZpZXdbIDAgXSA9IF90YWJsZXMubWFudGlzc2FUYWJsZVsgX3RhYmxlcy5vZmZzZXRUYWJsZVsgbSBdICsgKCB2YWwgJiAweDNmZiApIF0gKyBfdGFibGVzLmV4cG9uZW50VGFibGVbIG0gXTsKCXJldHVybiBfdGFibGVzLmZsb2F0Vmlld1sgMCBdOwoKfQoKY29uc3QgRGF0YVV0aWxzID0gewoJdG9IYWxmRmxvYXQ6IHRvSGFsZkZsb2F0LAoJZnJvbUhhbGZGbG9hdDogZnJvbUhhbGZGbG9hdCwKfTsKCmNvbnN0IF92ZWN0b3IkOCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3ZlY3RvcjIkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjIoKTsKCmNsYXNzIEJ1ZmZlckF0dHJpYnV0ZSB7CgoJY29uc3RydWN0b3IoIGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCA9IGZhbHNlICkgewoKCQlpZiAoIEFycmF5LmlzQXJyYXkoIGFycmF5ICkgKSB7CgoJCQl0aHJvdyBuZXcgVHlwZUVycm9yKCAnVEhSRUUuQnVmZmVyQXR0cmlidXRlOiBhcnJheSBzaG91bGQgYmUgYSBUeXBlZCBBcnJheS4nICk7CgoJCX0KCgkJdGhpcy5pc0J1ZmZlckF0dHJpYnV0ZSA9IHRydWU7CgoJCXRoaXMubmFtZSA9ICcnOwoKCQl0aGlzLmFycmF5ID0gYXJyYXk7CgkJdGhpcy5pdGVtU2l6ZSA9IGl0ZW1TaXplOwoJCXRoaXMuY291bnQgPSBhcnJheSAhPT0gdW5kZWZpbmVkID8gYXJyYXkubGVuZ3RoIC8gaXRlbVNpemUgOiAwOwoJCXRoaXMubm9ybWFsaXplZCA9IG5vcm1hbGl6ZWQ7CgoJCXRoaXMudXNhZ2UgPSBTdGF0aWNEcmF3VXNhZ2U7CgkJdGhpcy51cGRhdGVSYW5nZSA9IHsgb2Zmc2V0OiAwLCBjb3VudDogLSAxIH07CgkJdGhpcy5ncHVUeXBlID0gRmxvYXRUeXBlOwoKCQl0aGlzLnZlcnNpb24gPSAwOwoKCX0KCglvblVwbG9hZENhbGxiYWNrKCkge30KCglzZXQgbmVlZHNVcGRhdGUoIHZhbHVlICkgewoKCQlpZiAoIHZhbHVlID09PSB0cnVlICkgdGhpcy52ZXJzaW9uICsrOwoKCX0KCglzZXRVc2FnZSggdmFsdWUgKSB7CgoJCXRoaXMudXNhZ2UgPSB2YWx1ZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJdGhpcy5uYW1lID0gc291cmNlLm5hbWU7CgkJdGhpcy5hcnJheSA9IG5ldyBzb3VyY2UuYXJyYXkuY29uc3RydWN0b3IoIHNvdXJjZS5hcnJheSApOwoJCXRoaXMuaXRlbVNpemUgPSBzb3VyY2UuaXRlbVNpemU7CgkJdGhpcy5jb3VudCA9IHNvdXJjZS5jb3VudDsKCQl0aGlzLm5vcm1hbGl6ZWQgPSBzb3VyY2Uubm9ybWFsaXplZDsKCgkJdGhpcy51c2FnZSA9IHNvdXJjZS51c2FnZTsKCQl0aGlzLmdwdVR5cGUgPSBzb3VyY2UuZ3B1VHlwZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvcHlBdCggaW5kZXgxLCBhdHRyaWJ1dGUsIGluZGV4MiApIHsKCgkJaW5kZXgxICo9IHRoaXMuaXRlbVNpemU7CgkJaW5kZXgyICo9IGF0dHJpYnV0ZS5pdGVtU2l6ZTsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5pdGVtU2l6ZTsgaSA8IGw7IGkgKysgKSB7CgoJCQl0aGlzLmFycmF5WyBpbmRleDEgKyBpIF0gPSBhdHRyaWJ1dGUuYXJyYXlbIGluZGV4MiArIGkgXTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY29weUFycmF5KCBhcnJheSApIHsKCgkJdGhpcy5hcnJheS5zZXQoIGFycmF5ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglhcHBseU1hdHJpeDMoIG0gKSB7CgoJCWlmICggdGhpcy5pdGVtU2l6ZSA9PT0gMiApIHsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMuY291bnQ7IGkgPCBsOyBpICsrICkgewoKCQkJCV92ZWN0b3IyJDEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggdGhpcywgaSApOwoJCQkJX3ZlY3RvcjIkMS5hcHBseU1hdHJpeDMoIG0gKTsKCgkJCQl0aGlzLnNldFhZKCBpLCBfdmVjdG9yMiQxLngsIF92ZWN0b3IyJDEueSApOwoKCQkJfQoKCQl9IGVsc2UgaWYgKCB0aGlzLml0ZW1TaXplID09PSAzICkgewoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJX3ZlY3RvciQ4LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHRoaXMsIGkgKTsKCQkJCV92ZWN0b3IkOC5hcHBseU1hdHJpeDMoIG0gKTsKCgkJCQl0aGlzLnNldFhZWiggaSwgX3ZlY3RvciQ4LngsIF92ZWN0b3IkOC55LCBfdmVjdG9yJDgueiApOwoKCQkJfQoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglhcHBseU1hdHJpeDQoIG0gKSB7CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMuY291bnQ7IGkgPCBsOyBpICsrICkgewoKCQkJX3ZlY3RvciQ4LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHRoaXMsIGkgKTsKCgkJCV92ZWN0b3IkOC5hcHBseU1hdHJpeDQoIG0gKTsKCgkJCXRoaXMuc2V0WFlaKCBpLCBfdmVjdG9yJDgueCwgX3ZlY3RvciQ4LnksIF92ZWN0b3IkOC56ICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFwcGx5Tm9ybWFsTWF0cml4KCBtICkgewoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB0aGlzLmNvdW50OyBpIDwgbDsgaSArKyApIHsKCgkJCV92ZWN0b3IkOC5mcm9tQnVmZmVyQXR0cmlidXRlKCB0aGlzLCBpICk7CgoJCQlfdmVjdG9yJDguYXBwbHlOb3JtYWxNYXRyaXgoIG0gKTsKCgkJCXRoaXMuc2V0WFlaKCBpLCBfdmVjdG9yJDgueCwgX3ZlY3RvciQ4LnksIF92ZWN0b3IkOC56ICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRyYW5zZm9ybURpcmVjdGlvbiggbSApIHsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgoJCQlfdmVjdG9yJDguZnJvbUJ1ZmZlckF0dHJpYnV0ZSggdGhpcywgaSApOwoKCQkJX3ZlY3RvciQ4LnRyYW5zZm9ybURpcmVjdGlvbiggbSApOwoKCQkJdGhpcy5zZXRYWVooIGksIF92ZWN0b3IkOC54LCBfdmVjdG9yJDgueSwgX3ZlY3RvciQ4LnogKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0KCB2YWx1ZSwgb2Zmc2V0ID0gMCApIHsKCgkJLy8gTWF0Y2hpbmcgQnVmZmVyQXR0cmlidXRlIGNvbnN0cnVjdG9yLCBkbyBub3Qgbm9ybWFsaXplIHRoZSBhcnJheS4KCQl0aGlzLmFycmF5LnNldCggdmFsdWUsIG9mZnNldCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0Q29tcG9uZW50KCBpbmRleCwgY29tcG9uZW50ICkgewoKCQlsZXQgdmFsdWUgPSB0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyBjb21wb25lbnQgXTsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB2YWx1ZSA9IGRlbm9ybWFsaXplKCB2YWx1ZSwgdGhpcy5hcnJheSApOwoKCQlyZXR1cm4gdmFsdWU7CgoJfQoKCXNldENvbXBvbmVudCggaW5kZXgsIGNvbXBvbmVudCwgdmFsdWUgKSB7CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgdmFsdWUgPSBub3JtYWxpemUoIHZhbHVlLCB0aGlzLmFycmF5ICk7CgoJCXRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIGNvbXBvbmVudCBdID0gdmFsdWU7CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXRYKCBpbmRleCApIHsKCgkJbGV0IHggPSB0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgXTsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB4ID0gZGVub3JtYWxpemUoIHgsIHRoaXMuYXJyYXkgKTsKCgkJcmV0dXJuIHg7CgoJfQoKCXNldFgoIGluZGV4LCB4ICkgewoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHggPSBub3JtYWxpemUoIHgsIHRoaXMuYXJyYXkgKTsKCgkJdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplIF0gPSB4OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0WSggaW5kZXggKSB7CgoJCWxldCB5ID0gdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplICsgMSBdOwoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHkgPSBkZW5vcm1hbGl6ZSggeSwgdGhpcy5hcnJheSApOwoKCQlyZXR1cm4geTsKCgl9CgoJc2V0WSggaW5kZXgsIHkgKSB7CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgeSA9IG5vcm1hbGl6ZSggeSwgdGhpcy5hcnJheSApOwoKCQl0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAxIF0gPSB5OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0WiggaW5kZXggKSB7CgoJCWxldCB6ID0gdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplICsgMiBdOwoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHogPSBkZW5vcm1hbGl6ZSggeiwgdGhpcy5hcnJheSApOwoKCQlyZXR1cm4gejsKCgl9CgoJc2V0WiggaW5kZXgsIHogKSB7CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgeiA9IG5vcm1hbGl6ZSggeiwgdGhpcy5hcnJheSApOwoKCQl0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAyIF0gPSB6OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0VyggaW5kZXggKSB7CgoJCWxldCB3ID0gdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplICsgMyBdOwoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHcgPSBkZW5vcm1hbGl6ZSggdywgdGhpcy5hcnJheSApOwoKCQlyZXR1cm4gdzsKCgl9CgoJc2V0VyggaW5kZXgsIHcgKSB7CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgdyA9IG5vcm1hbGl6ZSggdywgdGhpcy5hcnJheSApOwoKCQl0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAzIF0gPSB3OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0WFkoIGluZGV4LCB4LCB5ICkgewoKCQlpbmRleCAqPSB0aGlzLml0ZW1TaXplOwoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHsKCgkJCXggPSBub3JtYWxpemUoIHgsIHRoaXMuYXJyYXkgKTsKCQkJeSA9IG5vcm1hbGl6ZSggeSwgdGhpcy5hcnJheSApOwoKCQl9CgoJCXRoaXMuYXJyYXlbIGluZGV4ICsgMCBdID0geDsKCQl0aGlzLmFycmF5WyBpbmRleCArIDEgXSA9IHk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRYWVooIGluZGV4LCB4LCB5LCB6ICkgewoKCQlpbmRleCAqPSB0aGlzLml0ZW1TaXplOwoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHsKCgkJCXggPSBub3JtYWxpemUoIHgsIHRoaXMuYXJyYXkgKTsKCQkJeSA9IG5vcm1hbGl6ZSggeSwgdGhpcy5hcnJheSApOwoJCQl6ID0gbm9ybWFsaXplKCB6LCB0aGlzLmFycmF5ICk7CgoJCX0KCgkJdGhpcy5hcnJheVsgaW5kZXggKyAwIF0gPSB4OwoJCXRoaXMuYXJyYXlbIGluZGV4ICsgMSBdID0geTsKCQl0aGlzLmFycmF5WyBpbmRleCArIDIgXSA9IHo7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRYWVpXKCBpbmRleCwgeCwgeSwgeiwgdyApIHsKCgkJaW5kZXggKj0gdGhpcy5pdGVtU2l6ZTsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB7CgoJCQl4ID0gbm9ybWFsaXplKCB4LCB0aGlzLmFycmF5ICk7CgkJCXkgPSBub3JtYWxpemUoIHksIHRoaXMuYXJyYXkgKTsKCQkJeiA9IG5vcm1hbGl6ZSggeiwgdGhpcy5hcnJheSApOwoJCQl3ID0gbm9ybWFsaXplKCB3LCB0aGlzLmFycmF5ICk7CgoJCX0KCgkJdGhpcy5hcnJheVsgaW5kZXggKyAwIF0gPSB4OwoJCXRoaXMuYXJyYXlbIGluZGV4ICsgMSBdID0geTsKCQl0aGlzLmFycmF5WyBpbmRleCArIDIgXSA9IHo7CgkJdGhpcy5hcnJheVsgaW5kZXggKyAzIF0gPSB3OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJb25VcGxvYWQoIGNhbGxiYWNrICkgewoKCQl0aGlzLm9uVXBsb2FkQ2FsbGJhY2sgPSBjYWxsYmFjazsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMuYXJyYXksIHRoaXMuaXRlbVNpemUgKS5jb3B5KCB0aGlzICk7CgoJfQoKCXRvSlNPTigpIHsKCgkJY29uc3QgZGF0YSA9IHsKCQkJaXRlbVNpemU6IHRoaXMuaXRlbVNpemUsCgkJCXR5cGU6IHRoaXMuYXJyYXkuY29uc3RydWN0b3IubmFtZSwKCQkJYXJyYXk6IEFycmF5LmZyb20oIHRoaXMuYXJyYXkgKSwKCQkJbm9ybWFsaXplZDogdGhpcy5ub3JtYWxpemVkCgkJfTsKCgkJaWYgKCB0aGlzLm5hbWUgIT09ICcnICkgZGF0YS5uYW1lID0gdGhpcy5uYW1lOwoJCWlmICggdGhpcy51c2FnZSAhPT0gU3RhdGljRHJhd1VzYWdlICkgZGF0YS51c2FnZSA9IHRoaXMudXNhZ2U7CgkJaWYgKCB0aGlzLnVwZGF0ZVJhbmdlLm9mZnNldCAhPT0gMCB8fCB0aGlzLnVwZGF0ZVJhbmdlLmNvdW50ICE9PSAtIDEgKSBkYXRhLnVwZGF0ZVJhbmdlID0gdGhpcy51cGRhdGVSYW5nZTsKCgkJcmV0dXJuIGRhdGE7CgoJfQoKfQoKLy8KCmNsYXNzIEludDhCdWZmZXJBdHRyaWJ1dGUgZXh0ZW5kcyBCdWZmZXJBdHRyaWJ1dGUgewoKCWNvbnN0cnVjdG9yKCBhcnJheSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKSB7CgoJCXN1cGVyKCBuZXcgSW50OEFycmF5KCBhcnJheSApLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKCX0KCn0KCmNsYXNzIFVpbnQ4QnVmZmVyQXR0cmlidXRlIGV4dGVuZHMgQnVmZmVyQXR0cmlidXRlIHsKCgljb25zdHJ1Y3RvciggYXJyYXksIGl0ZW1TaXplLCBub3JtYWxpemVkICkgewoKCQlzdXBlciggbmV3IFVpbnQ4QXJyYXkoIGFycmF5ICksIGl0ZW1TaXplLCBub3JtYWxpemVkICk7CgoJfQoKfQoKY2xhc3MgVWludDhDbGFtcGVkQnVmZmVyQXR0cmlidXRlIGV4dGVuZHMgQnVmZmVyQXR0cmlidXRlIHsKCgljb25zdHJ1Y3RvciggYXJyYXksIGl0ZW1TaXplLCBub3JtYWxpemVkICkgewoKCQlzdXBlciggbmV3IFVpbnQ4Q2xhbXBlZEFycmF5KCBhcnJheSApLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKCX0KCn0KCmNsYXNzIEludDE2QnVmZmVyQXR0cmlidXRlIGV4dGVuZHMgQnVmZmVyQXR0cmlidXRlIHsKCgljb25zdHJ1Y3RvciggYXJyYXksIGl0ZW1TaXplLCBub3JtYWxpemVkICkgewoKCQlzdXBlciggbmV3IEludDE2QXJyYXkoIGFycmF5ICksIGl0ZW1TaXplLCBub3JtYWxpemVkICk7CgoJfQoKfQoKY2xhc3MgVWludDE2QnVmZmVyQXR0cmlidXRlIGV4dGVuZHMgQnVmZmVyQXR0cmlidXRlIHsKCgljb25zdHJ1Y3RvciggYXJyYXksIGl0ZW1TaXplLCBub3JtYWxpemVkICkgewoKCQlzdXBlciggbmV3IFVpbnQxNkFycmF5KCBhcnJheSApLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKCX0KCn0KCmNsYXNzIEludDMyQnVmZmVyQXR0cmlidXRlIGV4dGVuZHMgQnVmZmVyQXR0cmlidXRlIHsKCgljb25zdHJ1Y3RvciggYXJyYXksIGl0ZW1TaXplLCBub3JtYWxpemVkICkgewoKCQlzdXBlciggbmV3IEludDMyQXJyYXkoIGFycmF5ICksIGl0ZW1TaXplLCBub3JtYWxpemVkICk7CgoJfQoKfQoKY2xhc3MgVWludDMyQnVmZmVyQXR0cmlidXRlIGV4dGVuZHMgQnVmZmVyQXR0cmlidXRlIHsKCgljb25zdHJ1Y3RvciggYXJyYXksIGl0ZW1TaXplLCBub3JtYWxpemVkICkgewoKCQlzdXBlciggbmV3IFVpbnQzMkFycmF5KCBhcnJheSApLCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKCX0KCn0KCmNsYXNzIEZsb2F0MTZCdWZmZXJBdHRyaWJ1dGUgZXh0ZW5kcyBCdWZmZXJBdHRyaWJ1dGUgewoKCWNvbnN0cnVjdG9yKCBhcnJheSwgaXRlbVNpemUsIG5vcm1hbGl6ZWQgKSB7CgoJCXN1cGVyKCBuZXcgVWludDE2QXJyYXkoIGFycmF5ICksIGl0ZW1TaXplLCBub3JtYWxpemVkICk7CgoJCXRoaXMuaXNGbG9hdDE2QnVmZmVyQXR0cmlidXRlID0gdHJ1ZTsKCgl9CgoJZ2V0WCggaW5kZXggKSB7CgoJCWxldCB4ID0gZnJvbUhhbGZGbG9hdCggdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplIF0gKTsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB4ID0gZGVub3JtYWxpemUoIHgsIHRoaXMuYXJyYXkgKTsKCgkJcmV0dXJuIHg7CgoJfQoKCXNldFgoIGluZGV4LCB4ICkgewoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHggPSBub3JtYWxpemUoIHgsIHRoaXMuYXJyYXkgKTsKCgkJdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplIF0gPSB0b0hhbGZGbG9hdCggeCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0WSggaW5kZXggKSB7CgoJCWxldCB5ID0gZnJvbUhhbGZGbG9hdCggdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplICsgMSBdICk7CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgeSA9IGRlbm9ybWFsaXplKCB5LCB0aGlzLmFycmF5ICk7CgoJCXJldHVybiB5OwoKCX0KCglzZXRZKCBpbmRleCwgeSApIHsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB5ID0gbm9ybWFsaXplKCB5LCB0aGlzLmFycmF5ICk7CgoJCXRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIDEgXSA9IHRvSGFsZkZsb2F0KCB5ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXRaKCBpbmRleCApIHsKCgkJbGV0IHogPSBmcm9tSGFsZkZsb2F0KCB0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAyIF0gKTsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB6ID0gZGVub3JtYWxpemUoIHosIHRoaXMuYXJyYXkgKTsKCgkJcmV0dXJuIHo7CgoJfQoKCXNldFooIGluZGV4LCB6ICkgewoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHogPSBub3JtYWxpemUoIHosIHRoaXMuYXJyYXkgKTsKCgkJdGhpcy5hcnJheVsgaW5kZXggKiB0aGlzLml0ZW1TaXplICsgMiBdID0gdG9IYWxmRmxvYXQoIHogKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWdldFcoIGluZGV4ICkgewoKCQlsZXQgdyA9IGZyb21IYWxmRmxvYXQoIHRoaXMuYXJyYXlbIGluZGV4ICogdGhpcy5pdGVtU2l6ZSArIDMgXSApOwoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHcgPSBkZW5vcm1hbGl6ZSggdywgdGhpcy5hcnJheSApOwoKCQlyZXR1cm4gdzsKCgl9CgoJc2V0VyggaW5kZXgsIHcgKSB7CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgdyA9IG5vcm1hbGl6ZSggdywgdGhpcy5hcnJheSApOwoKCQl0aGlzLmFycmF5WyBpbmRleCAqIHRoaXMuaXRlbVNpemUgKyAzIF0gPSB0b0hhbGZGbG9hdCggdyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0WFkoIGluZGV4LCB4LCB5ICkgewoKCQlpbmRleCAqPSB0aGlzLml0ZW1TaXplOwoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHsKCgkJCXggPSBub3JtYWxpemUoIHgsIHRoaXMuYXJyYXkgKTsKCQkJeSA9IG5vcm1hbGl6ZSggeSwgdGhpcy5hcnJheSApOwoKCQl9CgoJCXRoaXMuYXJyYXlbIGluZGV4ICsgMCBdID0gdG9IYWxmRmxvYXQoIHggKTsKCQl0aGlzLmFycmF5WyBpbmRleCArIDEgXSA9IHRvSGFsZkZsb2F0KCB5ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRYWVooIGluZGV4LCB4LCB5LCB6ICkgewoKCQlpbmRleCAqPSB0aGlzLml0ZW1TaXplOwoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHsKCgkJCXggPSBub3JtYWxpemUoIHgsIHRoaXMuYXJyYXkgKTsKCQkJeSA9IG5vcm1hbGl6ZSggeSwgdGhpcy5hcnJheSApOwoJCQl6ID0gbm9ybWFsaXplKCB6LCB0aGlzLmFycmF5ICk7CgoJCX0KCgkJdGhpcy5hcnJheVsgaW5kZXggKyAwIF0gPSB0b0hhbGZGbG9hdCggeCApOwoJCXRoaXMuYXJyYXlbIGluZGV4ICsgMSBdID0gdG9IYWxmRmxvYXQoIHkgKTsKCQl0aGlzLmFycmF5WyBpbmRleCArIDIgXSA9IHRvSGFsZkZsb2F0KCB6ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRYWVpXKCBpbmRleCwgeCwgeSwgeiwgdyApIHsKCgkJaW5kZXggKj0gdGhpcy5pdGVtU2l6ZTsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB7CgoJCQl4ID0gbm9ybWFsaXplKCB4LCB0aGlzLmFycmF5ICk7CgkJCXkgPSBub3JtYWxpemUoIHksIHRoaXMuYXJyYXkgKTsKCQkJeiA9IG5vcm1hbGl6ZSggeiwgdGhpcy5hcnJheSApOwoJCQl3ID0gbm9ybWFsaXplKCB3LCB0aGlzLmFycmF5ICk7CgoJCX0KCgkJdGhpcy5hcnJheVsgaW5kZXggKyAwIF0gPSB0b0hhbGZGbG9hdCggeCApOwoJCXRoaXMuYXJyYXlbIGluZGV4ICsgMSBdID0gdG9IYWxmRmxvYXQoIHkgKTsKCQl0aGlzLmFycmF5WyBpbmRleCArIDIgXSA9IHRvSGFsZkZsb2F0KCB6ICk7CgkJdGhpcy5hcnJheVsgaW5kZXggKyAzIF0gPSB0b0hhbGZGbG9hdCggdyApOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgoKY2xhc3MgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSBleHRlbmRzIEJ1ZmZlckF0dHJpYnV0ZSB7CgoJY29uc3RydWN0b3IoIGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApIHsKCgkJc3VwZXIoIG5ldyBGbG9hdDMyQXJyYXkoIGFycmF5ICksIGl0ZW1TaXplLCBub3JtYWxpemVkICk7CgoJfQoKfQoKY2xhc3MgRmxvYXQ2NEJ1ZmZlckF0dHJpYnV0ZSBleHRlbmRzIEJ1ZmZlckF0dHJpYnV0ZSB7CgoJY29uc3RydWN0b3IoIGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApIHsKCgkJc3VwZXIoIG5ldyBGbG9hdDY0QXJyYXkoIGFycmF5ICksIGl0ZW1TaXplLCBub3JtYWxpemVkICk7CgoJfQoKfQoKbGV0IF9pZCQyID0gMDsKCmNvbnN0IF9tMSA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKY29uc3QgX29iaiA9IC8qQF9fUFVSRV9fKi8gbmV3IE9iamVjdDNEKCk7CmNvbnN0IF9vZmZzZXQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF9ib3gkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IEJveDMoKTsKY29uc3QgX2JveE1vcnBoVGFyZ2V0cyA9IC8qQF9fUFVSRV9fKi8gbmV3IEJveDMoKTsKY29uc3QgX3ZlY3RvciQ3ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKY2xhc3MgQnVmZmVyR2VvbWV0cnkgZXh0ZW5kcyBFdmVudERpc3BhdGNoZXIgewoKCWNvbnN0cnVjdG9yKCkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzQnVmZmVyR2VvbWV0cnkgPSB0cnVlOwoKCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHRoaXMsICdpZCcsIHsgdmFsdWU6IF9pZCQyICsrIH0gKTsKCgkJdGhpcy51dWlkID0gZ2VuZXJhdGVVVUlEKCk7CgoJCXRoaXMubmFtZSA9ICcnOwoJCXRoaXMudHlwZSA9ICdCdWZmZXJHZW9tZXRyeSc7CgoJCXRoaXMuaW5kZXggPSBudWxsOwoJCXRoaXMuYXR0cmlidXRlcyA9IHt9OwoKCQl0aGlzLm1vcnBoQXR0cmlidXRlcyA9IHt9OwoJCXRoaXMubW9ycGhUYXJnZXRzUmVsYXRpdmUgPSBmYWxzZTsKCgkJdGhpcy5ncm91cHMgPSBbXTsKCgkJdGhpcy5ib3VuZGluZ0JveCA9IG51bGw7CgkJdGhpcy5ib3VuZGluZ1NwaGVyZSA9IG51bGw7CgoJCXRoaXMuZHJhd1JhbmdlID0geyBzdGFydDogMCwgY291bnQ6IEluZmluaXR5IH07CgoJCXRoaXMudXNlckRhdGEgPSB7fTsKCgl9CgoJZ2V0SW5kZXgoKSB7CgoJCXJldHVybiB0aGlzLmluZGV4OwoKCX0KCglzZXRJbmRleCggaW5kZXggKSB7CgoJCWlmICggQXJyYXkuaXNBcnJheSggaW5kZXggKSApIHsKCgkJCXRoaXMuaW5kZXggPSBuZXcgKCBhcnJheU5lZWRzVWludDMyKCBpbmRleCApID8gVWludDMyQnVmZmVyQXR0cmlidXRlIDogVWludDE2QnVmZmVyQXR0cmlidXRlICkoIGluZGV4LCAxICk7CgoJCX0gZWxzZSB7CgoJCQl0aGlzLmluZGV4ID0gaW5kZXg7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWdldEF0dHJpYnV0ZSggbmFtZSApIHsKCgkJcmV0dXJuIHRoaXMuYXR0cmlidXRlc1sgbmFtZSBdOwoKCX0KCglzZXRBdHRyaWJ1dGUoIG5hbWUsIGF0dHJpYnV0ZSApIHsKCgkJdGhpcy5hdHRyaWJ1dGVzWyBuYW1lIF0gPSBhdHRyaWJ1dGU7CgoJCXJldHVybiB0aGlzOwoKCX0KCglkZWxldGVBdHRyaWJ1dGUoIG5hbWUgKSB7CgoJCWRlbGV0ZSB0aGlzLmF0dHJpYnV0ZXNbIG5hbWUgXTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWhhc0F0dHJpYnV0ZSggbmFtZSApIHsKCgkJcmV0dXJuIHRoaXMuYXR0cmlidXRlc1sgbmFtZSBdICE9PSB1bmRlZmluZWQ7CgoJfQoKCWFkZEdyb3VwKCBzdGFydCwgY291bnQsIG1hdGVyaWFsSW5kZXggPSAwICkgewoKCQl0aGlzLmdyb3Vwcy5wdXNoKCB7CgoJCQlzdGFydDogc3RhcnQsCgkJCWNvdW50OiBjb3VudCwKCQkJbWF0ZXJpYWxJbmRleDogbWF0ZXJpYWxJbmRleAoKCQl9ICk7CgoJfQoKCWNsZWFyR3JvdXBzKCkgewoKCQl0aGlzLmdyb3VwcyA9IFtdOwoKCX0KCglzZXREcmF3UmFuZ2UoIHN0YXJ0LCBjb3VudCApIHsKCgkJdGhpcy5kcmF3UmFuZ2Uuc3RhcnQgPSBzdGFydDsKCQl0aGlzLmRyYXdSYW5nZS5jb3VudCA9IGNvdW50OwoKCX0KCglhcHBseU1hdHJpeDQoIG1hdHJpeCApIHsKCgkJY29uc3QgcG9zaXRpb24gPSB0aGlzLmF0dHJpYnV0ZXMucG9zaXRpb247CgoJCWlmICggcG9zaXRpb24gIT09IHVuZGVmaW5lZCApIHsKCgkJCXBvc2l0aW9uLmFwcGx5TWF0cml4NCggbWF0cml4ICk7CgoJCQlwb3NpdGlvbi5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCX0KCgkJY29uc3Qgbm9ybWFsID0gdGhpcy5hdHRyaWJ1dGVzLm5vcm1hbDsKCgkJaWYgKCBub3JtYWwgIT09IHVuZGVmaW5lZCApIHsKCgkJCWNvbnN0IG5vcm1hbE1hdHJpeCA9IG5ldyBNYXRyaXgzKCkuZ2V0Tm9ybWFsTWF0cml4KCBtYXRyaXggKTsKCgkJCW5vcm1hbC5hcHBseU5vcm1hbE1hdHJpeCggbm9ybWFsTWF0cml4ICk7CgoJCQlub3JtYWwubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQl9CgoJCWNvbnN0IHRhbmdlbnQgPSB0aGlzLmF0dHJpYnV0ZXMudGFuZ2VudDsKCgkJaWYgKCB0YW5nZW50ICE9PSB1bmRlZmluZWQgKSB7CgoJCQl0YW5nZW50LnRyYW5zZm9ybURpcmVjdGlvbiggbWF0cml4ICk7CgoJCQl0YW5nZW50Lm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJfQoKCQlpZiAoIHRoaXMuYm91bmRpbmdCb3ggIT09IG51bGwgKSB7CgoJCQl0aGlzLmNvbXB1dGVCb3VuZGluZ0JveCgpOwoKCQl9CgoJCWlmICggdGhpcy5ib3VuZGluZ1NwaGVyZSAhPT0gbnVsbCApIHsKCgkJCXRoaXMuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFwcGx5UXVhdGVybmlvbiggcSApIHsKCgkJX20xLm1ha2VSb3RhdGlvbkZyb21RdWF0ZXJuaW9uKCBxICk7CgoJCXRoaXMuYXBwbHlNYXRyaXg0KCBfbTEgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXJvdGF0ZVgoIGFuZ2xlICkgewoKCQkvLyByb3RhdGUgZ2VvbWV0cnkgYXJvdW5kIHdvcmxkIHgtYXhpcwoKCQlfbTEubWFrZVJvdGF0aW9uWCggYW5nbGUgKTsKCgkJdGhpcy5hcHBseU1hdHJpeDQoIF9tMSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJcm90YXRlWSggYW5nbGUgKSB7CgoJCS8vIHJvdGF0ZSBnZW9tZXRyeSBhcm91bmQgd29ybGQgeS1heGlzCgoJCV9tMS5tYWtlUm90YXRpb25ZKCBhbmdsZSApOwoKCQl0aGlzLmFwcGx5TWF0cml4NCggX20xICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglyb3RhdGVaKCBhbmdsZSApIHsKCgkJLy8gcm90YXRlIGdlb21ldHJ5IGFyb3VuZCB3b3JsZCB6LWF4aXMKCgkJX20xLm1ha2VSb3RhdGlvblooIGFuZ2xlICk7CgoJCXRoaXMuYXBwbHlNYXRyaXg0KCBfbTEgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRyYW5zbGF0ZSggeCwgeSwgeiApIHsKCgkJLy8gdHJhbnNsYXRlIGdlb21ldHJ5CgoJCV9tMS5tYWtlVHJhbnNsYXRpb24oIHgsIHksIHogKTsKCgkJdGhpcy5hcHBseU1hdHJpeDQoIF9tMSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2NhbGUoIHgsIHksIHogKSB7CgoJCS8vIHNjYWxlIGdlb21ldHJ5CgoJCV9tMS5tYWtlU2NhbGUoIHgsIHksIHogKTsKCgkJdGhpcy5hcHBseU1hdHJpeDQoIF9tMSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbG9va0F0KCB2ZWN0b3IgKSB7CgoJCV9vYmoubG9va0F0KCB2ZWN0b3IgKTsKCgkJX29iai51cGRhdGVNYXRyaXgoKTsKCgkJdGhpcy5hcHBseU1hdHJpeDQoIF9vYmoubWF0cml4ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljZW50ZXIoKSB7CgoJCXRoaXMuY29tcHV0ZUJvdW5kaW5nQm94KCk7CgoJCXRoaXMuYm91bmRpbmdCb3guZ2V0Q2VudGVyKCBfb2Zmc2V0ICkubmVnYXRlKCk7CgoJCXRoaXMudHJhbnNsYXRlKCBfb2Zmc2V0LngsIF9vZmZzZXQueSwgX29mZnNldC56ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tUG9pbnRzKCBwb2ludHMgKSB7CgoJCWNvbnN0IHBvc2l0aW9uID0gW107CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHBvaW50cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJY29uc3QgcG9pbnQgPSBwb2ludHNbIGkgXTsKCQkJcG9zaXRpb24ucHVzaCggcG9pbnQueCwgcG9pbnQueSwgcG9pbnQueiB8fCAwICk7CgoJCX0KCgkJdGhpcy5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbiwgMyApICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljb21wdXRlQm91bmRpbmdCb3goKSB7CgoJCWlmICggdGhpcy5ib3VuZGluZ0JveCA9PT0gbnVsbCApIHsKCgkJCXRoaXMuYm91bmRpbmdCb3ggPSBuZXcgQm94MygpOwoKCQl9CgoJCWNvbnN0IHBvc2l0aW9uID0gdGhpcy5hdHRyaWJ1dGVzLnBvc2l0aW9uOwoJCWNvbnN0IG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uID0gdGhpcy5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb247CgoJCWlmICggcG9zaXRpb24gJiYgcG9zaXRpb24uaXNHTEJ1ZmZlckF0dHJpYnV0ZSApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5CdWZmZXJHZW9tZXRyeS5jb21wdXRlQm91bmRpbmdCb3goKTogR0xCdWZmZXJBdHRyaWJ1dGUgcmVxdWlyZXMgYSBtYW51YWwgYm91bmRpbmcgYm94LiBBbHRlcm5hdGl2ZWx5IHNldCAibWVzaC5mcnVzdHVtQ3VsbGVkIiB0byAiZmFsc2UiLicsIHRoaXMgKTsKCgkJCXRoaXMuYm91bmRpbmdCb3guc2V0KAoJCQkJbmV3IFZlY3RvcjMoIC0gSW5maW5pdHksIC0gSW5maW5pdHksIC0gSW5maW5pdHkgKSwKCQkJCW5ldyBWZWN0b3IzKCArIEluZmluaXR5LCArIEluZmluaXR5LCArIEluZmluaXR5ICkKCQkJKTsKCgkJCXJldHVybjsKCgkJfQoKCQlpZiAoIHBvc2l0aW9uICE9PSB1bmRlZmluZWQgKSB7CgoJCQl0aGlzLmJvdW5kaW5nQm94LnNldEZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uICk7CgoJCQkvLyBwcm9jZXNzIG1vcnBoIGF0dHJpYnV0ZXMgaWYgcHJlc2VudAoKCQkJaWYgKCBtb3JwaEF0dHJpYnV0ZXNQb3NpdGlvbiApIHsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24ubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb25bIGkgXTsKCQkJCQlfYm94JDEuc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZSggbW9ycGhBdHRyaWJ1dGUgKTsKCgkJCQkJaWYgKCB0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlICkgewoKCQkJCQkJX3ZlY3RvciQ3LmFkZFZlY3RvcnMoIHRoaXMuYm91bmRpbmdCb3gubWluLCBfYm94JDEubWluICk7CgkJCQkJCXRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludCggX3ZlY3RvciQ3ICk7CgoJCQkJCQlfdmVjdG9yJDcuYWRkVmVjdG9ycyggdGhpcy5ib3VuZGluZ0JveC5tYXgsIF9ib3gkMS5tYXggKTsKCQkJCQkJdGhpcy5ib3VuZGluZ0JveC5leHBhbmRCeVBvaW50KCBfdmVjdG9yJDcgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludCggX2JveCQxLm1pbiApOwoJCQkJCQl0aGlzLmJvdW5kaW5nQm94LmV4cGFuZEJ5UG9pbnQoIF9ib3gkMS5tYXggKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJfSBlbHNlIHsKCgkJCXRoaXMuYm91bmRpbmdCb3gubWFrZUVtcHR5KCk7CgoJCX0KCgkJaWYgKCBpc05hTiggdGhpcy5ib3VuZGluZ0JveC5taW4ueCApIHx8IGlzTmFOKCB0aGlzLmJvdW5kaW5nQm94Lm1pbi55ICkgfHwgaXNOYU4oIHRoaXMuYm91bmRpbmdCb3gubWluLnogKSApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5CdWZmZXJHZW9tZXRyeS5jb21wdXRlQm91bmRpbmdCb3goKTogQ29tcHV0ZWQgbWluL21heCBoYXZlIE5hTiB2YWx1ZXMuIFRoZSAicG9zaXRpb24iIGF0dHJpYnV0ZSBpcyBsaWtlbHkgdG8gaGF2ZSBOYU4gdmFsdWVzLicsIHRoaXMgKTsKCgkJfQoKCX0KCgljb21wdXRlQm91bmRpbmdTcGhlcmUoKSB7CgoJCWlmICggdGhpcy5ib3VuZGluZ1NwaGVyZSA9PT0gbnVsbCApIHsKCgkJCXRoaXMuYm91bmRpbmdTcGhlcmUgPSBuZXcgU3BoZXJlKCk7CgoJCX0KCgkJY29uc3QgcG9zaXRpb24gPSB0aGlzLmF0dHJpYnV0ZXMucG9zaXRpb247CgkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24gPSB0aGlzLm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbjsKCgkJaWYgKCBwb3NpdGlvbiAmJiBwb3NpdGlvbi5pc0dMQnVmZmVyQXR0cmlidXRlICkgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOiBHTEJ1ZmZlckF0dHJpYnV0ZSByZXF1aXJlcyBhIG1hbnVhbCBib3VuZGluZyBzcGhlcmUuIEFsdGVybmF0aXZlbHkgc2V0ICJtZXNoLmZydXN0dW1DdWxsZWQiIHRvICJmYWxzZSIuJywgdGhpcyApOwoKCQkJdGhpcy5ib3VuZGluZ1NwaGVyZS5zZXQoIG5ldyBWZWN0b3IzKCksIEluZmluaXR5ICk7CgoJCQlyZXR1cm47CgoJCX0KCgkJaWYgKCBwb3NpdGlvbiApIHsKCgkJCS8vIGZpcnN0LCBmaW5kIHRoZSBjZW50ZXIgb2YgdGhlIGJvdW5kaW5nIHNwaGVyZQoKCQkJY29uc3QgY2VudGVyID0gdGhpcy5ib3VuZGluZ1NwaGVyZS5jZW50ZXI7CgoJCQlfYm94JDEuc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24gKTsKCgkJCS8vIHByb2Nlc3MgbW9ycGggYXR0cmlidXRlcyBpZiBwcmVzZW50CgoJCQlpZiAoIG1vcnBoQXR0cmlidXRlc1Bvc2l0aW9uICkgewoKCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBtb3JwaEF0dHJpYnV0ZXNQb3NpdGlvbi5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGUgPSBtb3JwaEF0dHJpYnV0ZXNQb3NpdGlvblsgaSBdOwoJCQkJCV9ib3hNb3JwaFRhcmdldHMuc2V0RnJvbUJ1ZmZlckF0dHJpYnV0ZSggbW9ycGhBdHRyaWJ1dGUgKTsKCgkJCQkJaWYgKCB0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlICkgewoKCQkJCQkJX3ZlY3RvciQ3LmFkZFZlY3RvcnMoIF9ib3gkMS5taW4sIF9ib3hNb3JwaFRhcmdldHMubWluICk7CgkJCQkJCV9ib3gkMS5leHBhbmRCeVBvaW50KCBfdmVjdG9yJDcgKTsKCgkJCQkJCV92ZWN0b3IkNy5hZGRWZWN0b3JzKCBfYm94JDEubWF4LCBfYm94TW9ycGhUYXJnZXRzLm1heCApOwoJCQkJCQlfYm94JDEuZXhwYW5kQnlQb2ludCggX3ZlY3RvciQ3ICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlfYm94JDEuZXhwYW5kQnlQb2ludCggX2JveE1vcnBoVGFyZ2V0cy5taW4gKTsKCQkJCQkJX2JveCQxLmV4cGFuZEJ5UG9pbnQoIF9ib3hNb3JwaFRhcmdldHMubWF4ICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQlfYm94JDEuZ2V0Q2VudGVyKCBjZW50ZXIgKTsKCgkJCS8vIHNlY29uZCwgdHJ5IHRvIGZpbmQgYSBib3VuZGluZ1NwaGVyZSB3aXRoIGEgcmFkaXVzIHNtYWxsZXIgdGhhbiB0aGUKCQkJLy8gYm91bmRpbmdTcGhlcmUgb2YgdGhlIGJvdW5kaW5nQm94OiBzcXJ0KDMpIHNtYWxsZXIgaW4gdGhlIGJlc3QgY2FzZQoKCQkJbGV0IG1heFJhZGl1c1NxID0gMDsKCgkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBwb3NpdGlvbi5jb3VudDsgaSA8IGlsOyBpICsrICkgewoKCQkJCV92ZWN0b3IkNy5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbiwgaSApOwoKCQkJCW1heFJhZGl1c1NxID0gTWF0aC5tYXgoIG1heFJhZGl1c1NxLCBjZW50ZXIuZGlzdGFuY2VUb1NxdWFyZWQoIF92ZWN0b3IkNyApICk7CgoJCQl9CgoJCQkvLyBwcm9jZXNzIG1vcnBoIGF0dHJpYnV0ZXMgaWYgcHJlc2VudAoKCQkJaWYgKCBtb3JwaEF0dHJpYnV0ZXNQb3NpdGlvbiApIHsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb24ubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gbW9ycGhBdHRyaWJ1dGVzUG9zaXRpb25bIGkgXTsKCQkJCQljb25zdCBtb3JwaFRhcmdldHNSZWxhdGl2ZSA9IHRoaXMubW9ycGhUYXJnZXRzUmVsYXRpdmU7CgoJCQkJCWZvciAoIGxldCBqID0gMCwgamwgPSBtb3JwaEF0dHJpYnV0ZS5jb3VudDsgaiA8IGpsOyBqICsrICkgewoKCQkJCQkJX3ZlY3RvciQ3LmZyb21CdWZmZXJBdHRyaWJ1dGUoIG1vcnBoQXR0cmlidXRlLCBqICk7CgoJCQkJCQlpZiAoIG1vcnBoVGFyZ2V0c1JlbGF0aXZlICkgewoKCQkJCQkJCV9vZmZzZXQuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIGogKTsKCQkJCQkJCV92ZWN0b3IkNy5hZGQoIF9vZmZzZXQgKTsKCgkJCQkJCX0KCgkJCQkJCW1heFJhZGl1c1NxID0gTWF0aC5tYXgoIG1heFJhZGl1c1NxLCBjZW50ZXIuZGlzdGFuY2VUb1NxdWFyZWQoIF92ZWN0b3IkNyApICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQl0aGlzLmJvdW5kaW5nU3BoZXJlLnJhZGl1cyA9IE1hdGguc3FydCggbWF4UmFkaXVzU3EgKTsKCgkJCWlmICggaXNOYU4oIHRoaXMuYm91bmRpbmdTcGhlcmUucmFkaXVzICkgKSB7CgoJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLkJ1ZmZlckdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOiBDb21wdXRlZCByYWRpdXMgaXMgTmFOLiBUaGUgInBvc2l0aW9uIiBhdHRyaWJ1dGUgaXMgbGlrZWx5IHRvIGhhdmUgTmFOIHZhbHVlcy4nLCB0aGlzICk7CgoJCQl9CgoJCX0KCgl9CgoJY29tcHV0ZVRhbmdlbnRzKCkgewoKCQljb25zdCBpbmRleCA9IHRoaXMuaW5kZXg7CgkJY29uc3QgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlczsKCgkJLy8gYmFzZWQgb24gaHR0cDovL3d3dy50ZXJhdGhvbi5jb20vY29kZS90YW5nZW50Lmh0bWwKCQkvLyAocGVyIHZlcnRleCB0YW5nZW50cykKCgkJaWYgKCBpbmRleCA9PT0gbnVsbCB8fAoJCQkgYXR0cmlidXRlcy5wb3NpdGlvbiA9PT0gdW5kZWZpbmVkIHx8CgkJCSBhdHRyaWJ1dGVzLm5vcm1hbCA9PT0gdW5kZWZpbmVkIHx8CgkJCSBhdHRyaWJ1dGVzLnV2ID09PSB1bmRlZmluZWQgKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuQnVmZmVyR2VvbWV0cnk6IC5jb21wdXRlVGFuZ2VudHMoKSBmYWlsZWQuIE1pc3NpbmcgcmVxdWlyZWQgYXR0cmlidXRlcyAoaW5kZXgsIHBvc2l0aW9uLCBub3JtYWwgb3IgdXYpJyApOwoJCQlyZXR1cm47CgoJCX0KCgkJY29uc3QgaW5kaWNlcyA9IGluZGV4LmFycmF5OwoJCWNvbnN0IHBvc2l0aW9ucyA9IGF0dHJpYnV0ZXMucG9zaXRpb24uYXJyYXk7CgkJY29uc3Qgbm9ybWFscyA9IGF0dHJpYnV0ZXMubm9ybWFsLmFycmF5OwoJCWNvbnN0IHV2cyA9IGF0dHJpYnV0ZXMudXYuYXJyYXk7CgoJCWNvbnN0IG5WZXJ0aWNlcyA9IHBvc2l0aW9ucy5sZW5ndGggLyAzOwoKCQlpZiAoIHRoaXMuaGFzQXR0cmlidXRlKCAndGFuZ2VudCcgKSA9PT0gZmFsc2UgKSB7CgoJCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3RhbmdlbnQnLCBuZXcgQnVmZmVyQXR0cmlidXRlKCBuZXcgRmxvYXQzMkFycmF5KCA0ICogblZlcnRpY2VzICksIDQgKSApOwoKCQl9CgoJCWNvbnN0IHRhbmdlbnRzID0gdGhpcy5nZXRBdHRyaWJ1dGUoICd0YW5nZW50JyApLmFycmF5OwoKCQljb25zdCB0YW4xID0gW10sIHRhbjIgPSBbXTsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgblZlcnRpY2VzOyBpICsrICkgewoKCQkJdGFuMVsgaSBdID0gbmV3IFZlY3RvcjMoKTsKCQkJdGFuMlsgaSBdID0gbmV3IFZlY3RvcjMoKTsKCgkJfQoKCQljb25zdCB2QSA9IG5ldyBWZWN0b3IzKCksCgkJCXZCID0gbmV3IFZlY3RvcjMoKSwKCQkJdkMgPSBuZXcgVmVjdG9yMygpLAoKCQkJdXZBID0gbmV3IFZlY3RvcjIoKSwKCQkJdXZCID0gbmV3IFZlY3RvcjIoKSwKCQkJdXZDID0gbmV3IFZlY3RvcjIoKSwKCgkJCXNkaXIgPSBuZXcgVmVjdG9yMygpLAoJCQl0ZGlyID0gbmV3IFZlY3RvcjMoKTsKCgkJZnVuY3Rpb24gaGFuZGxlVHJpYW5nbGUoIGEsIGIsIGMgKSB7CgoJCQl2QS5mcm9tQXJyYXkoIHBvc2l0aW9ucywgYSAqIDMgKTsKCQkJdkIuZnJvbUFycmF5KCBwb3NpdGlvbnMsIGIgKiAzICk7CgkJCXZDLmZyb21BcnJheSggcG9zaXRpb25zLCBjICogMyApOwoKCQkJdXZBLmZyb21BcnJheSggdXZzLCBhICogMiApOwoJCQl1dkIuZnJvbUFycmF5KCB1dnMsIGIgKiAyICk7CgkJCXV2Qy5mcm9tQXJyYXkoIHV2cywgYyAqIDIgKTsKCgkJCXZCLnN1YiggdkEgKTsKCQkJdkMuc3ViKCB2QSApOwoKCQkJdXZCLnN1YiggdXZBICk7CgkJCXV2Qy5zdWIoIHV2QSApOwoKCQkJY29uc3QgciA9IDEuMCAvICggdXZCLnggKiB1dkMueSAtIHV2Qy54ICogdXZCLnkgKTsKCgkJCS8vIHNpbGVudGx5IGlnbm9yZSBkZWdlbmVyYXRlIHV2IHRyaWFuZ2xlcyBoYXZpbmcgY29pbmNpZGVudCBvciBjb2xpbmVhciB2ZXJ0aWNlcwoKCQkJaWYgKCAhIGlzRmluaXRlKCByICkgKSByZXR1cm47CgoJCQlzZGlyLmNvcHkoIHZCICkubXVsdGlwbHlTY2FsYXIoIHV2Qy55ICkuYWRkU2NhbGVkVmVjdG9yKCB2QywgLSB1dkIueSApLm11bHRpcGx5U2NhbGFyKCByICk7CgkJCXRkaXIuY29weSggdkMgKS5tdWx0aXBseVNjYWxhciggdXZCLnggKS5hZGRTY2FsZWRWZWN0b3IoIHZCLCAtIHV2Qy54ICkubXVsdGlwbHlTY2FsYXIoIHIgKTsKCgkJCXRhbjFbIGEgXS5hZGQoIHNkaXIgKTsKCQkJdGFuMVsgYiBdLmFkZCggc2RpciApOwoJCQl0YW4xWyBjIF0uYWRkKCBzZGlyICk7CgoJCQl0YW4yWyBhIF0uYWRkKCB0ZGlyICk7CgkJCXRhbjJbIGIgXS5hZGQoIHRkaXIgKTsKCQkJdGFuMlsgYyBdLmFkZCggdGRpciApOwoKCQl9CgoJCWxldCBncm91cHMgPSB0aGlzLmdyb3VwczsKCgkJaWYgKCBncm91cHMubGVuZ3RoID09PSAwICkgewoKCQkJZ3JvdXBzID0gWyB7CgkJCQlzdGFydDogMCwKCQkJCWNvdW50OiBpbmRpY2VzLmxlbmd0aAoJCQl9IF07CgoJCX0KCgkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBpbDsgKysgaSApIHsKCgkJCWNvbnN0IGdyb3VwID0gZ3JvdXBzWyBpIF07CgoJCQljb25zdCBzdGFydCA9IGdyb3VwLnN0YXJ0OwoJCQljb25zdCBjb3VudCA9IGdyb3VwLmNvdW50OwoKCQkJZm9yICggbGV0IGogPSBzdGFydCwgamwgPSBzdGFydCArIGNvdW50OyBqIDwgamw7IGogKz0gMyApIHsKCgkJCQloYW5kbGVUcmlhbmdsZSgKCQkJCQlpbmRpY2VzWyBqICsgMCBdLAoJCQkJCWluZGljZXNbIGogKyAxIF0sCgkJCQkJaW5kaWNlc1sgaiArIDIgXQoJCQkJKTsKCgkJCX0KCgkJfQoKCQljb25zdCB0bXAgPSBuZXcgVmVjdG9yMygpLCB0bXAyID0gbmV3IFZlY3RvcjMoKTsKCQljb25zdCBuID0gbmV3IFZlY3RvcjMoKSwgbjIgPSBuZXcgVmVjdG9yMygpOwoKCQlmdW5jdGlvbiBoYW5kbGVWZXJ0ZXgoIHYgKSB7CgoJCQluLmZyb21BcnJheSggbm9ybWFscywgdiAqIDMgKTsKCQkJbjIuY29weSggbiApOwoKCQkJY29uc3QgdCA9IHRhbjFbIHYgXTsKCgkJCS8vIEdyYW0tU2NobWlkdCBvcnRob2dvbmFsaXplCgoJCQl0bXAuY29weSggdCApOwoJCQl0bXAuc3ViKCBuLm11bHRpcGx5U2NhbGFyKCBuLmRvdCggdCApICkgKS5ub3JtYWxpemUoKTsKCgkJCS8vIENhbGN1bGF0ZSBoYW5kZWRuZXNzCgoJCQl0bXAyLmNyb3NzVmVjdG9ycyggbjIsIHQgKTsKCQkJY29uc3QgdGVzdCA9IHRtcDIuZG90KCB0YW4yWyB2IF0gKTsKCQkJY29uc3QgdyA9ICggdGVzdCA8IDAuMCApID8gLSAxLjAgOiAxLjA7CgoJCQl0YW5nZW50c1sgdiAqIDQgXSA9IHRtcC54OwoJCQl0YW5nZW50c1sgdiAqIDQgKyAxIF0gPSB0bXAueTsKCQkJdGFuZ2VudHNbIHYgKiA0ICsgMiBdID0gdG1wLno7CgkJCXRhbmdlbnRzWyB2ICogNCArIDMgXSA9IHc7CgoJCX0KCgkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBpbDsgKysgaSApIHsKCgkJCWNvbnN0IGdyb3VwID0gZ3JvdXBzWyBpIF07CgoJCQljb25zdCBzdGFydCA9IGdyb3VwLnN0YXJ0OwoJCQljb25zdCBjb3VudCA9IGdyb3VwLmNvdW50OwoKCQkJZm9yICggbGV0IGogPSBzdGFydCwgamwgPSBzdGFydCArIGNvdW50OyBqIDwgamw7IGogKz0gMyApIHsKCgkJCQloYW5kbGVWZXJ0ZXgoIGluZGljZXNbIGogKyAwIF0gKTsKCQkJCWhhbmRsZVZlcnRleCggaW5kaWNlc1sgaiArIDEgXSApOwoJCQkJaGFuZGxlVmVydGV4KCBpbmRpY2VzWyBqICsgMiBdICk7CgoJCQl9CgoJCX0KCgl9CgoJY29tcHV0ZVZlcnRleE5vcm1hbHMoKSB7CgoJCWNvbnN0IGluZGV4ID0gdGhpcy5pbmRleDsKCQljb25zdCBwb3NpdGlvbkF0dHJpYnV0ZSA9IHRoaXMuZ2V0QXR0cmlidXRlKCAncG9zaXRpb24nICk7CgoJCWlmICggcG9zaXRpb25BdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCApIHsKCgkJCWxldCBub3JtYWxBdHRyaWJ1dGUgPSB0aGlzLmdldEF0dHJpYnV0ZSggJ25vcm1hbCcgKTsKCgkJCWlmICggbm9ybWFsQXR0cmlidXRlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJbm9ybWFsQXR0cmlidXRlID0gbmV3IEJ1ZmZlckF0dHJpYnV0ZSggbmV3IEZsb2F0MzJBcnJheSggcG9zaXRpb25BdHRyaWJ1dGUuY291bnQgKiAzICksIDMgKTsKCQkJCXRoaXMuc2V0QXR0cmlidXRlKCAnbm9ybWFsJywgbm9ybWFsQXR0cmlidXRlICk7CgoJCQl9IGVsc2UgewoKCQkJCS8vIHJlc2V0IGV4aXN0aW5nIG5vcm1hbHMgdG8gemVybwoKCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBub3JtYWxBdHRyaWJ1dGUuY291bnQ7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJbm9ybWFsQXR0cmlidXRlLnNldFhZWiggaSwgMCwgMCwgMCApOwoKCQkJCX0KCgkJCX0KCgkJCWNvbnN0IHBBID0gbmV3IFZlY3RvcjMoKSwgcEIgPSBuZXcgVmVjdG9yMygpLCBwQyA9IG5ldyBWZWN0b3IzKCk7CgkJCWNvbnN0IG5BID0gbmV3IFZlY3RvcjMoKSwgbkIgPSBuZXcgVmVjdG9yMygpLCBuQyA9IG5ldyBWZWN0b3IzKCk7CgkJCWNvbnN0IGNiID0gbmV3IFZlY3RvcjMoKSwgYWIgPSBuZXcgVmVjdG9yMygpOwoKCQkJLy8gaW5kZXhlZCBlbGVtZW50cwoKCQkJaWYgKCBpbmRleCApIHsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gaW5kZXguY291bnQ7IGkgPCBpbDsgaSArPSAzICkgewoKCQkJCQljb25zdCB2QSA9IGluZGV4LmdldFgoIGkgKyAwICk7CgkJCQkJY29uc3QgdkIgPSBpbmRleC5nZXRYKCBpICsgMSApOwoJCQkJCWNvbnN0IHZDID0gaW5kZXguZ2V0WCggaSArIDIgKTsKCgkJCQkJcEEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIHZBICk7CgkJCQkJcEIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIHZCICk7CgkJCQkJcEMuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIHZDICk7CgoJCQkJCWNiLnN1YlZlY3RvcnMoIHBDLCBwQiApOwoJCQkJCWFiLnN1YlZlY3RvcnMoIHBBLCBwQiApOwoJCQkJCWNiLmNyb3NzKCBhYiApOwoKCQkJCQluQS5mcm9tQnVmZmVyQXR0cmlidXRlKCBub3JtYWxBdHRyaWJ1dGUsIHZBICk7CgkJCQkJbkIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFsQXR0cmlidXRlLCB2QiApOwoJCQkJCW5DLmZyb21CdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbEF0dHJpYnV0ZSwgdkMgKTsKCgkJCQkJbkEuYWRkKCBjYiApOwoJCQkJCW5CLmFkZCggY2IgKTsKCQkJCQluQy5hZGQoIGNiICk7CgoJCQkJCW5vcm1hbEF0dHJpYnV0ZS5zZXRYWVooIHZBLCBuQS54LCBuQS55LCBuQS56ICk7CgkJCQkJbm9ybWFsQXR0cmlidXRlLnNldFhZWiggdkIsIG5CLngsIG5CLnksIG5CLnogKTsKCQkJCQlub3JtYWxBdHRyaWJ1dGUuc2V0WFlaKCB2QywgbkMueCwgbkMueSwgbkMueiApOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJLy8gbm9uLWluZGV4ZWQgZWxlbWVudHMgKHVuY29ubmVjdGVkIHRyaWFuZ2xlIHNvdXApCgoJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHBvc2l0aW9uQXR0cmlidXRlLmNvdW50OyBpIDwgaWw7IGkgKz0gMyApIHsKCgkJCQkJcEEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIGkgKyAwICk7CgkJCQkJcEIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIGkgKyAxICk7CgkJCQkJcEMuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIGkgKyAyICk7CgoJCQkJCWNiLnN1YlZlY3RvcnMoIHBDLCBwQiApOwoJCQkJCWFiLnN1YlZlY3RvcnMoIHBBLCBwQiApOwoJCQkJCWNiLmNyb3NzKCBhYiApOwoKCQkJCQlub3JtYWxBdHRyaWJ1dGUuc2V0WFlaKCBpICsgMCwgY2IueCwgY2IueSwgY2IueiApOwoJCQkJCW5vcm1hbEF0dHJpYnV0ZS5zZXRYWVooIGkgKyAxLCBjYi54LCBjYi55LCBjYi56ICk7CgkJCQkJbm9ybWFsQXR0cmlidXRlLnNldFhZWiggaSArIDIsIGNiLngsIGNiLnksIGNiLnogKTsKCgkJCQl9CgoJCQl9CgoJCQl0aGlzLm5vcm1hbGl6ZU5vcm1hbHMoKTsKCgkJCW5vcm1hbEF0dHJpYnV0ZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCX0KCgl9CgoJbm9ybWFsaXplTm9ybWFscygpIHsKCgkJY29uc3Qgbm9ybWFscyA9IHRoaXMuYXR0cmlidXRlcy5ub3JtYWw7CgoJCWZvciAoIGxldCBpID0gMCwgaWwgPSBub3JtYWxzLmNvdW50OyBpIDwgaWw7IGkgKysgKSB7CgoJCQlfdmVjdG9yJDcuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFscywgaSApOwoKCQkJX3ZlY3RvciQ3Lm5vcm1hbGl6ZSgpOwoKCQkJbm9ybWFscy5zZXRYWVooIGksIF92ZWN0b3IkNy54LCBfdmVjdG9yJDcueSwgX3ZlY3RvciQ3LnogKTsKCgkJfQoKCX0KCgl0b05vbkluZGV4ZWQoKSB7CgoJCWZ1bmN0aW9uIGNvbnZlcnRCdWZmZXJBdHRyaWJ1dGUoIGF0dHJpYnV0ZSwgaW5kaWNlcyApIHsKCgkJCWNvbnN0IGFycmF5ID0gYXR0cmlidXRlLmFycmF5OwoJCQljb25zdCBpdGVtU2l6ZSA9IGF0dHJpYnV0ZS5pdGVtU2l6ZTsKCQkJY29uc3Qgbm9ybWFsaXplZCA9IGF0dHJpYnV0ZS5ub3JtYWxpemVkOwoKCQkJY29uc3QgYXJyYXkyID0gbmV3IGFycmF5LmNvbnN0cnVjdG9yKCBpbmRpY2VzLmxlbmd0aCAqIGl0ZW1TaXplICk7CgoJCQlsZXQgaW5kZXggPSAwLCBpbmRleDIgPSAwOwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gaW5kaWNlcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWlmICggYXR0cmlidXRlLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUgKSB7CgoJCQkJCWluZGV4ID0gaW5kaWNlc1sgaSBdICogYXR0cmlidXRlLmRhdGEuc3RyaWRlICsgYXR0cmlidXRlLm9mZnNldDsKCgkJCQl9IGVsc2UgewoKCQkJCQlpbmRleCA9IGluZGljZXNbIGkgXSAqIGl0ZW1TaXplOwoKCQkJCX0KCgkJCQlmb3IgKCBsZXQgaiA9IDA7IGogPCBpdGVtU2l6ZTsgaiArKyApIHsKCgkJCQkJYXJyYXkyWyBpbmRleDIgKysgXSA9IGFycmF5WyBpbmRleCArKyBdOwoKCQkJCX0KCgkJCX0KCgkJCXJldHVybiBuZXcgQnVmZmVyQXR0cmlidXRlKCBhcnJheTIsIGl0ZW1TaXplLCBub3JtYWxpemVkICk7CgoJCX0KCgkJLy8KCgkJaWYgKCB0aGlzLmluZGV4ID09PSBudWxsICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQnVmZmVyR2VvbWV0cnkudG9Ob25JbmRleGVkKCk6IEJ1ZmZlckdlb21ldHJ5IGlzIGFscmVhZHkgbm9uLWluZGV4ZWQuJyApOwoJCQlyZXR1cm4gdGhpczsKCgkJfQoKCQljb25zdCBnZW9tZXRyeTIgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCgkJY29uc3QgaW5kaWNlcyA9IHRoaXMuaW5kZXguYXJyYXk7CgkJY29uc3QgYXR0cmlidXRlcyA9IHRoaXMuYXR0cmlidXRlczsKCgkJLy8gYXR0cmlidXRlcwoKCQlmb3IgKCBjb25zdCBuYW1lIGluIGF0dHJpYnV0ZXMgKSB7CgoJCQljb25zdCBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzWyBuYW1lIF07CgoJCQljb25zdCBuZXdBdHRyaWJ1dGUgPSBjb252ZXJ0QnVmZmVyQXR0cmlidXRlKCBhdHRyaWJ1dGUsIGluZGljZXMgKTsKCgkJCWdlb21ldHJ5Mi5zZXRBdHRyaWJ1dGUoIG5hbWUsIG5ld0F0dHJpYnV0ZSApOwoKCQl9CgoJCS8vIG1vcnBoIGF0dHJpYnV0ZXMKCgkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzID0gdGhpcy5tb3JwaEF0dHJpYnV0ZXM7CgoJCWZvciAoIGNvbnN0IG5hbWUgaW4gbW9ycGhBdHRyaWJ1dGVzICkgewoKCQkJY29uc3QgbW9ycGhBcnJheSA9IFtdOwoJCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoQXR0cmlidXRlc1sgbmFtZSBdOyAvLyBtb3JwaEF0dHJpYnV0ZTogYXJyYXkgb2YgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZXMKCgkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBtb3JwaEF0dHJpYnV0ZS5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQljb25zdCBhdHRyaWJ1dGUgPSBtb3JwaEF0dHJpYnV0ZVsgaSBdOwoKCQkJCWNvbnN0IG5ld0F0dHJpYnV0ZSA9IGNvbnZlcnRCdWZmZXJBdHRyaWJ1dGUoIGF0dHJpYnV0ZSwgaW5kaWNlcyApOwoKCQkJCW1vcnBoQXJyYXkucHVzaCggbmV3QXR0cmlidXRlICk7CgoJCQl9CgoJCQlnZW9tZXRyeTIubW9ycGhBdHRyaWJ1dGVzWyBuYW1lIF0gPSBtb3JwaEFycmF5OwoKCQl9CgoJCWdlb21ldHJ5Mi5tb3JwaFRhcmdldHNSZWxhdGl2ZSA9IHRoaXMubW9ycGhUYXJnZXRzUmVsYXRpdmU7CgoJCS8vIGdyb3VwcwoKCQljb25zdCBncm91cHMgPSB0aGlzLmdyb3VwczsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQljb25zdCBncm91cCA9IGdyb3Vwc1sgaSBdOwoJCQlnZW9tZXRyeTIuYWRkR3JvdXAoIGdyb3VwLnN0YXJ0LCBncm91cC5jb3VudCwgZ3JvdXAubWF0ZXJpYWxJbmRleCApOwoKCQl9CgoJCXJldHVybiBnZW9tZXRyeTI7CgoJfQoKCXRvSlNPTigpIHsKCgkJY29uc3QgZGF0YSA9IHsKCQkJbWV0YWRhdGE6IHsKCQkJCXZlcnNpb246IDQuNiwKCQkJCXR5cGU6ICdCdWZmZXJHZW9tZXRyeScsCgkJCQlnZW5lcmF0b3I6ICdCdWZmZXJHZW9tZXRyeS50b0pTT04nCgkJCX0KCQl9OwoKCQkvLyBzdGFuZGFyZCBCdWZmZXJHZW9tZXRyeSBzZXJpYWxpemF0aW9uCgoJCWRhdGEudXVpZCA9IHRoaXMudXVpZDsKCQlkYXRhLnR5cGUgPSB0aGlzLnR5cGU7CgkJaWYgKCB0aGlzLm5hbWUgIT09ICcnICkgZGF0YS5uYW1lID0gdGhpcy5uYW1lOwoJCWlmICggT2JqZWN0LmtleXMoIHRoaXMudXNlckRhdGEgKS5sZW5ndGggPiAwICkgZGF0YS51c2VyRGF0YSA9IHRoaXMudXNlckRhdGE7CgoJCWlmICggdGhpcy5wYXJhbWV0ZXJzICE9PSB1bmRlZmluZWQgKSB7CgoJCQljb25zdCBwYXJhbWV0ZXJzID0gdGhpcy5wYXJhbWV0ZXJzOwoKCQkJZm9yICggY29uc3Qga2V5IGluIHBhcmFtZXRlcnMgKSB7CgoJCQkJaWYgKCBwYXJhbWV0ZXJzWyBrZXkgXSAhPT0gdW5kZWZpbmVkICkgZGF0YVsga2V5IF0gPSBwYXJhbWV0ZXJzWyBrZXkgXTsKCgkJCX0KCgkJCXJldHVybiBkYXRhOwoKCQl9CgoJCS8vIGZvciBzaW1wbGljaXR5IHRoZSBjb2RlIGFzc3VtZXMgYXR0cmlidXRlcyBhcmUgbm90IHNoYXJlZCBhY3Jvc3MgZ2VvbWV0cmllcywgc2VlICMxNTgxMQoKCQlkYXRhLmRhdGEgPSB7IGF0dHJpYnV0ZXM6IHt9IH07CgoJCWNvbnN0IGluZGV4ID0gdGhpcy5pbmRleDsKCgkJaWYgKCBpbmRleCAhPT0gbnVsbCApIHsKCgkJCWRhdGEuZGF0YS5pbmRleCA9IHsKCQkJCXR5cGU6IGluZGV4LmFycmF5LmNvbnN0cnVjdG9yLm5hbWUsCgkJCQlhcnJheTogQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoIGluZGV4LmFycmF5ICkKCQkJfTsKCgkJfQoKCQljb25zdCBhdHRyaWJ1dGVzID0gdGhpcy5hdHRyaWJ1dGVzOwoKCQlmb3IgKCBjb25zdCBrZXkgaW4gYXR0cmlidXRlcyApIHsKCgkJCWNvbnN0IGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXNbIGtleSBdOwoKCQkJZGF0YS5kYXRhLmF0dHJpYnV0ZXNbIGtleSBdID0gYXR0cmlidXRlLnRvSlNPTiggZGF0YS5kYXRhICk7CgoJCX0KCgkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzID0ge307CgkJbGV0IGhhc01vcnBoQXR0cmlidXRlcyA9IGZhbHNlOwoKCQlmb3IgKCBjb25zdCBrZXkgaW4gdGhpcy5tb3JwaEF0dHJpYnV0ZXMgKSB7CgoJCQljb25zdCBhdHRyaWJ1dGVBcnJheSA9IHRoaXMubW9ycGhBdHRyaWJ1dGVzWyBrZXkgXTsKCgkJCWNvbnN0IGFycmF5ID0gW107CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gYXR0cmlidXRlQXJyYXkubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJY29uc3QgYXR0cmlidXRlID0gYXR0cmlidXRlQXJyYXlbIGkgXTsKCgkJCQlhcnJheS5wdXNoKCBhdHRyaWJ1dGUudG9KU09OKCBkYXRhLmRhdGEgKSApOwoKCQkJfQoKCQkJaWYgKCBhcnJheS5sZW5ndGggPiAwICkgewoKCQkJCW1vcnBoQXR0cmlidXRlc1sga2V5IF0gPSBhcnJheTsKCgkJCQloYXNNb3JwaEF0dHJpYnV0ZXMgPSB0cnVlOwoKCQkJfQoKCQl9CgoJCWlmICggaGFzTW9ycGhBdHRyaWJ1dGVzICkgewoKCQkJZGF0YS5kYXRhLm1vcnBoQXR0cmlidXRlcyA9IG1vcnBoQXR0cmlidXRlczsKCQkJZGF0YS5kYXRhLm1vcnBoVGFyZ2V0c1JlbGF0aXZlID0gdGhpcy5tb3JwaFRhcmdldHNSZWxhdGl2ZTsKCgkJfQoKCQljb25zdCBncm91cHMgPSB0aGlzLmdyb3VwczsKCgkJaWYgKCBncm91cHMubGVuZ3RoID4gMCApIHsKCgkJCWRhdGEuZGF0YS5ncm91cHMgPSBKU09OLnBhcnNlKCBKU09OLnN0cmluZ2lmeSggZ3JvdXBzICkgKTsKCgkJfQoKCQljb25zdCBib3VuZGluZ1NwaGVyZSA9IHRoaXMuYm91bmRpbmdTcGhlcmU7CgoJCWlmICggYm91bmRpbmdTcGhlcmUgIT09IG51bGwgKSB7CgoJCQlkYXRhLmRhdGEuYm91bmRpbmdTcGhlcmUgPSB7CgkJCQljZW50ZXI6IGJvdW5kaW5nU3BoZXJlLmNlbnRlci50b0FycmF5KCksCgkJCQlyYWRpdXM6IGJvdW5kaW5nU3BoZXJlLnJhZGl1cwoJCQl9OwoKCQl9CgoJCXJldHVybiBkYXRhOwoKCX0KCgljbG9uZSgpIHsKCgkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCS8vIHJlc2V0CgoJCXRoaXMuaW5kZXggPSBudWxsOwoJCXRoaXMuYXR0cmlidXRlcyA9IHt9OwoJCXRoaXMubW9ycGhBdHRyaWJ1dGVzID0ge307CgkJdGhpcy5ncm91cHMgPSBbXTsKCQl0aGlzLmJvdW5kaW5nQm94ID0gbnVsbDsKCQl0aGlzLmJvdW5kaW5nU3BoZXJlID0gbnVsbDsKCgkJLy8gdXNlZCBmb3Igc3RvcmluZyBjbG9uZWQsIHNoYXJlZCBkYXRhCgoJCWNvbnN0IGRhdGEgPSB7fTsKCgkJLy8gbmFtZQoKCQl0aGlzLm5hbWUgPSBzb3VyY2UubmFtZTsKCgkJLy8gaW5kZXgKCgkJY29uc3QgaW5kZXggPSBzb3VyY2UuaW5kZXg7CgoJCWlmICggaW5kZXggIT09IG51bGwgKSB7CgoJCQl0aGlzLnNldEluZGV4KCBpbmRleC5jbG9uZSggZGF0YSApICk7CgoJCX0KCgkJLy8gYXR0cmlidXRlcwoKCQljb25zdCBhdHRyaWJ1dGVzID0gc291cmNlLmF0dHJpYnV0ZXM7CgoJCWZvciAoIGNvbnN0IG5hbWUgaW4gYXR0cmlidXRlcyApIHsKCgkJCWNvbnN0IGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXNbIG5hbWUgXTsKCQkJdGhpcy5zZXRBdHRyaWJ1dGUoIG5hbWUsIGF0dHJpYnV0ZS5jbG9uZSggZGF0YSApICk7CgoJCX0KCgkJLy8gbW9ycGggYXR0cmlidXRlcwoKCQljb25zdCBtb3JwaEF0dHJpYnV0ZXMgPSBzb3VyY2UubW9ycGhBdHRyaWJ1dGVzOwoKCQlmb3IgKCBjb25zdCBuYW1lIGluIG1vcnBoQXR0cmlidXRlcyApIHsKCgkJCWNvbnN0IGFycmF5ID0gW107CgkJCWNvbnN0IG1vcnBoQXR0cmlidXRlID0gbW9ycGhBdHRyaWJ1dGVzWyBuYW1lIF07IC8vIG1vcnBoQXR0cmlidXRlOiBhcnJheSBvZiBGbG9hdDMyQnVmZmVyQXR0cmlidXRlcwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gbW9ycGhBdHRyaWJ1dGUubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQlhcnJheS5wdXNoKCBtb3JwaEF0dHJpYnV0ZVsgaSBdLmNsb25lKCBkYXRhICkgKTsKCgkJCX0KCgkJCXRoaXMubW9ycGhBdHRyaWJ1dGVzWyBuYW1lIF0gPSBhcnJheTsKCgkJfQoKCQl0aGlzLm1vcnBoVGFyZ2V0c1JlbGF0aXZlID0gc291cmNlLm1vcnBoVGFyZ2V0c1JlbGF0aXZlOwoKCQkvLyBncm91cHMKCgkJY29uc3QgZ3JvdXBzID0gc291cmNlLmdyb3VwczsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQljb25zdCBncm91cCA9IGdyb3Vwc1sgaSBdOwoJCQl0aGlzLmFkZEdyb3VwKCBncm91cC5zdGFydCwgZ3JvdXAuY291bnQsIGdyb3VwLm1hdGVyaWFsSW5kZXggKTsKCgkJfQoKCQkvLyBib3VuZGluZyBib3gKCgkJY29uc3QgYm91bmRpbmdCb3ggPSBzb3VyY2UuYm91bmRpbmdCb3g7CgoJCWlmICggYm91bmRpbmdCb3ggIT09IG51bGwgKSB7CgoJCQl0aGlzLmJvdW5kaW5nQm94ID0gYm91bmRpbmdCb3guY2xvbmUoKTsKCgkJfQoKCQkvLyBib3VuZGluZyBzcGhlcmUKCgkJY29uc3QgYm91bmRpbmdTcGhlcmUgPSBzb3VyY2UuYm91bmRpbmdTcGhlcmU7CgoJCWlmICggYm91bmRpbmdTcGhlcmUgIT09IG51bGwgKSB7CgoJCQl0aGlzLmJvdW5kaW5nU3BoZXJlID0gYm91bmRpbmdTcGhlcmUuY2xvbmUoKTsKCgkJfQoKCQkvLyBkcmF3IHJhbmdlCgoJCXRoaXMuZHJhd1JhbmdlLnN0YXJ0ID0gc291cmNlLmRyYXdSYW5nZS5zdGFydDsKCQl0aGlzLmRyYXdSYW5nZS5jb3VudCA9IHNvdXJjZS5kcmF3UmFuZ2UuY291bnQ7CgoJCS8vIHVzZXIgZGF0YQoKCQl0aGlzLnVzZXJEYXRhID0gc291cmNlLnVzZXJEYXRhOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZGlzcG9zZSgpIHsKCgkJdGhpcy5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdkaXNwb3NlJyB9ICk7CgoJfQoKfQoKY29uc3QgX2ludmVyc2VNYXRyaXgkMyA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKY29uc3QgX3JheSQzID0gLypAX19QVVJFX18qLyBuZXcgUmF5KCk7CmNvbnN0IF9zcGhlcmUkNSA9IC8qQF9fUFVSRV9fKi8gbmV3IFNwaGVyZSgpOwpjb25zdCBfc3BoZXJlSGl0QXQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgpjb25zdCBfdkEkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3ZCJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF92QyQxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKY29uc3QgX3RlbXBBID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfbW9ycGhBID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKY29uc3QgX3V2QSQxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMigpOwpjb25zdCBfdXZCJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IyKCk7CmNvbnN0IF91dkMkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjIoKTsKCmNvbnN0IF9ub3JtYWxBID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfbm9ybWFsQiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX25vcm1hbEMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgpjb25zdCBfaW50ZXJzZWN0aW9uUG9pbnQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF9pbnRlcnNlY3Rpb25Qb2ludFdvcmxkID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKY2xhc3MgTWVzaCBleHRlbmRzIE9iamVjdDNEIHsKCgljb25zdHJ1Y3RvciggZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKSwgbWF0ZXJpYWwgPSBuZXcgTWVzaEJhc2ljTWF0ZXJpYWwoKSApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc01lc2ggPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnTWVzaCc7CgoJCXRoaXMuZ2VvbWV0cnkgPSBnZW9tZXRyeTsKCQl0aGlzLm1hdGVyaWFsID0gbWF0ZXJpYWw7CgoJCXRoaXMudXBkYXRlTW9ycGhUYXJnZXRzKCk7CgoJfQoKCWNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApOwoKCQlpZiAoIHNvdXJjZS5tb3JwaFRhcmdldEluZmx1ZW5jZXMgIT09IHVuZGVmaW5lZCApIHsKCgkJCXRoaXMubW9ycGhUYXJnZXRJbmZsdWVuY2VzID0gc291cmNlLm1vcnBoVGFyZ2V0SW5mbHVlbmNlcy5zbGljZSgpOwoKCQl9CgoJCWlmICggc291cmNlLm1vcnBoVGFyZ2V0RGljdGlvbmFyeSAhPT0gdW5kZWZpbmVkICkgewoKCQkJdGhpcy5tb3JwaFRhcmdldERpY3Rpb25hcnkgPSBPYmplY3QuYXNzaWduKCB7fSwgc291cmNlLm1vcnBoVGFyZ2V0RGljdGlvbmFyeSApOwoKCQl9CgoJCXRoaXMubWF0ZXJpYWwgPSBBcnJheS5pc0FycmF5KCBzb3VyY2UubWF0ZXJpYWwgKSA/IHNvdXJjZS5tYXRlcmlhbC5zbGljZSgpIDogc291cmNlLm1hdGVyaWFsOwoJCXRoaXMuZ2VvbWV0cnkgPSBzb3VyY2UuZ2VvbWV0cnk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl1cGRhdGVNb3JwaFRhcmdldHMoKSB7CgoJCWNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCgkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzOwoJCWNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyggbW9ycGhBdHRyaWJ1dGVzICk7CgoJCWlmICgga2V5cy5sZW5ndGggPiAwICkgewoKCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGUgPSBtb3JwaEF0dHJpYnV0ZXNbIGtleXNbIDAgXSBdOwoKCQkJaWYgKCBtb3JwaEF0dHJpYnV0ZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXRoaXMubW9ycGhUYXJnZXRJbmZsdWVuY2VzID0gW107CgkJCQl0aGlzLm1vcnBoVGFyZ2V0RGljdGlvbmFyeSA9IHt9OwoKCQkJCWZvciAoIGxldCBtID0gMCwgbWwgPSBtb3JwaEF0dHJpYnV0ZS5sZW5ndGg7IG0gPCBtbDsgbSArKyApIHsKCgkJCQkJY29uc3QgbmFtZSA9IG1vcnBoQXR0cmlidXRlWyBtIF0ubmFtZSB8fCBTdHJpbmcoIG0gKTsKCgkJCQkJdGhpcy5tb3JwaFRhcmdldEluZmx1ZW5jZXMucHVzaCggMCApOwoJCQkJCXRoaXMubW9ycGhUYXJnZXREaWN0aW9uYXJ5WyBuYW1lIF0gPSBtOwoKCQkJCX0KCgkJCX0KCgkJfQoKCX0KCglnZXRWZXJ0ZXhQb3NpdGlvbiggaW5kZXgsIHRhcmdldCApIHsKCgkJY29uc3QgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwoJCWNvbnN0IHBvc2l0aW9uID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKCQljb25zdCBtb3JwaFBvc2l0aW9uID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uOwoJCWNvbnN0IG1vcnBoVGFyZ2V0c1JlbGF0aXZlID0gZ2VvbWV0cnkubW9ycGhUYXJnZXRzUmVsYXRpdmU7CgoJCXRhcmdldC5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbiwgaW5kZXggKTsKCgkJY29uc3QgbW9ycGhJbmZsdWVuY2VzID0gdGhpcy5tb3JwaFRhcmdldEluZmx1ZW5jZXM7CgoJCWlmICggbW9ycGhQb3NpdGlvbiAmJiBtb3JwaEluZmx1ZW5jZXMgKSB7CgoJCQlfbW9ycGhBLnNldCggMCwgMCwgMCApOwoKCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG1vcnBoUG9zaXRpb24ubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJY29uc3QgaW5mbHVlbmNlID0gbW9ycGhJbmZsdWVuY2VzWyBpIF07CgkJCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoUG9zaXRpb25bIGkgXTsKCgkJCQlpZiAoIGluZmx1ZW5jZSA9PT0gMCApIGNvbnRpbnVlOwoKCQkJCV90ZW1wQS5mcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaEF0dHJpYnV0ZSwgaW5kZXggKTsKCgkJCQlpZiAoIG1vcnBoVGFyZ2V0c1JlbGF0aXZlICkgewoKCQkJCQlfbW9ycGhBLmFkZFNjYWxlZFZlY3RvciggX3RlbXBBLCBpbmZsdWVuY2UgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlfbW9ycGhBLmFkZFNjYWxlZFZlY3RvciggX3RlbXBBLnN1YiggdGFyZ2V0ICksIGluZmx1ZW5jZSApOwoKCQkJCX0KCgkJCX0KCgkJCXRhcmdldC5hZGQoIF9tb3JwaEEgKTsKCgkJfQoKCQlyZXR1cm4gdGFyZ2V0OwoKCX0KCglyYXljYXN0KCByYXljYXN0ZXIsIGludGVyc2VjdHMgKSB7CgoJCWNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCQljb25zdCBtYXRlcmlhbCA9IHRoaXMubWF0ZXJpYWw7CgkJY29uc3QgbWF0cml4V29ybGQgPSB0aGlzLm1hdHJpeFdvcmxkOwoKCQlpZiAoIG1hdGVyaWFsID09PSB1bmRlZmluZWQgKSByZXR1cm47CgoJCS8vIHRlc3Qgd2l0aCBib3VuZGluZyBzcGhlcmUgaW4gd29ybGQgc3BhY2UKCgkJaWYgKCBnZW9tZXRyeS5ib3VuZGluZ1NwaGVyZSA9PT0gbnVsbCApIGdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoKCQlfc3BoZXJlJDUuY29weSggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgKTsKCQlfc3BoZXJlJDUuYXBwbHlNYXRyaXg0KCBtYXRyaXhXb3JsZCApOwoKCQkvLyBjaGVjayBkaXN0YW5jZSBmcm9tIHJheSBvcmlnaW4gdG8gYm91bmRpbmcgc3BoZXJlCgoJCV9yYXkkMy5jb3B5KCByYXljYXN0ZXIucmF5ICkucmVjYXN0KCByYXljYXN0ZXIubmVhciApOwoKCQlpZiAoIF9zcGhlcmUkNS5jb250YWluc1BvaW50KCBfcmF5JDMub3JpZ2luICkgPT09IGZhbHNlICkgewoKCQkJaWYgKCBfcmF5JDMuaW50ZXJzZWN0U3BoZXJlKCBfc3BoZXJlJDUsIF9zcGhlcmVIaXRBdCApID09PSBudWxsICkgcmV0dXJuOwoKCQkJaWYgKCBfcmF5JDMub3JpZ2luLmRpc3RhbmNlVG9TcXVhcmVkKCBfc3BoZXJlSGl0QXQgKSA+ICggcmF5Y2FzdGVyLmZhciAtIHJheWNhc3Rlci5uZWFyICkgKiogMiApIHJldHVybjsKCgkJfQoKCQkvLyBjb252ZXJ0IHJheSB0byBsb2NhbCBzcGFjZSBvZiBtZXNoCgoJCV9pbnZlcnNlTWF0cml4JDMuY29weSggbWF0cml4V29ybGQgKS5pbnZlcnQoKTsKCQlfcmF5JDMuY29weSggcmF5Y2FzdGVyLnJheSApLmFwcGx5TWF0cml4NCggX2ludmVyc2VNYXRyaXgkMyApOwoKCQkvLyB0ZXN0IHdpdGggYm91bmRpbmcgYm94IGluIGxvY2FsIHNwYWNlCgoJCWlmICggZ2VvbWV0cnkuYm91bmRpbmdCb3ggIT09IG51bGwgKSB7CgoJCQlpZiAoIF9yYXkkMy5pbnRlcnNlY3RzQm94KCBnZW9tZXRyeS5ib3VuZGluZ0JveCApID09PSBmYWxzZSApIHJldHVybjsKCgkJfQoKCQkvLyB0ZXN0IGZvciBpbnRlcnNlY3Rpb25zIHdpdGggZ2VvbWV0cnkKCgkJdGhpcy5fY29tcHV0ZUludGVyc2VjdGlvbnMoIHJheWNhc3RlciwgaW50ZXJzZWN0cywgX3JheSQzICk7CgoJfQoKCV9jb21wdXRlSW50ZXJzZWN0aW9ucyggcmF5Y2FzdGVyLCBpbnRlcnNlY3RzLCByYXlMb2NhbFNwYWNlICkgewoKCQlsZXQgaW50ZXJzZWN0aW9uOwoKCQljb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgkJY29uc3QgbWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsOwoKCQljb25zdCBpbmRleCA9IGdlb21ldHJ5LmluZGV4OwoJCWNvbnN0IHBvc2l0aW9uID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKCQljb25zdCB1diA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMudXY7CgkJY29uc3QgdXYxID0gZ2VvbWV0cnkuYXR0cmlidXRlcy51djE7CgkJY29uc3Qgbm9ybWFsID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5ub3JtYWw7CgkJY29uc3QgZ3JvdXBzID0gZ2VvbWV0cnkuZ3JvdXBzOwoJCWNvbnN0IGRyYXdSYW5nZSA9IGdlb21ldHJ5LmRyYXdSYW5nZTsKCgkJaWYgKCBpbmRleCAhPT0gbnVsbCApIHsKCgkJCS8vIGluZGV4ZWQgYnVmZmVyIGdlb21ldHJ5CgoJCQlpZiAoIEFycmF5LmlzQXJyYXkoIG1hdGVyaWFsICkgKSB7CgoJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKCQkJCQljb25zdCBncm91cE1hdGVyaWFsID0gbWF0ZXJpYWxbIGdyb3VwLm1hdGVyaWFsSW5kZXggXTsKCgkJCQkJY29uc3Qgc3RhcnQgPSBNYXRoLm1heCggZ3JvdXAuc3RhcnQsIGRyYXdSYW5nZS5zdGFydCApOwoJCQkJCWNvbnN0IGVuZCA9IE1hdGgubWluKCBpbmRleC5jb3VudCwgTWF0aC5taW4oICggZ3JvdXAuc3RhcnQgKyBncm91cC5jb3VudCApLCAoIGRyYXdSYW5nZS5zdGFydCArIGRyYXdSYW5nZS5jb3VudCApICkgKTsKCgkJCQkJZm9yICggbGV0IGogPSBzdGFydCwgamwgPSBlbmQ7IGogPCBqbDsgaiArPSAzICkgewoKCQkJCQkJY29uc3QgYSA9IGluZGV4LmdldFgoIGogKTsKCQkJCQkJY29uc3QgYiA9IGluZGV4LmdldFgoIGogKyAxICk7CgkJCQkJCWNvbnN0IGMgPSBpbmRleC5nZXRYKCBqICsgMiApOwoKCQkJCQkJaW50ZXJzZWN0aW9uID0gY2hlY2tHZW9tZXRyeUludGVyc2VjdGlvbiggdGhpcywgZ3JvdXBNYXRlcmlhbCwgcmF5Y2FzdGVyLCByYXlMb2NhbFNwYWNlLCB1diwgdXYxLCBub3JtYWwsIGEsIGIsIGMgKTsKCgkJCQkJCWlmICggaW50ZXJzZWN0aW9uICkgewoKCQkJCQkJCWludGVyc2VjdGlvbi5mYWNlSW5kZXggPSBNYXRoLmZsb29yKCBqIC8gMyApOyAvLyB0cmlhbmdsZSBudW1iZXIgaW4gaW5kZXhlZCBidWZmZXIgc2VtYW50aWNzCgkJCQkJCQlpbnRlcnNlY3Rpb24uZmFjZS5tYXRlcmlhbEluZGV4ID0gZ3JvdXAubWF0ZXJpYWxJbmRleDsKCQkJCQkJCWludGVyc2VjdHMucHVzaCggaW50ZXJzZWN0aW9uICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCWNvbnN0IHN0YXJ0ID0gTWF0aC5tYXgoIDAsIGRyYXdSYW5nZS5zdGFydCApOwoJCQkJY29uc3QgZW5kID0gTWF0aC5taW4oIGluZGV4LmNvdW50LCAoIGRyYXdSYW5nZS5zdGFydCArIGRyYXdSYW5nZS5jb3VudCApICk7CgoJCQkJZm9yICggbGV0IGkgPSBzdGFydCwgaWwgPSBlbmQ7IGkgPCBpbDsgaSArPSAzICkgewoKCQkJCQljb25zdCBhID0gaW5kZXguZ2V0WCggaSApOwoJCQkJCWNvbnN0IGIgPSBpbmRleC5nZXRYKCBpICsgMSApOwoJCQkJCWNvbnN0IGMgPSBpbmRleC5nZXRYKCBpICsgMiApOwoKCQkJCQlpbnRlcnNlY3Rpb24gPSBjaGVja0dlb21ldHJ5SW50ZXJzZWN0aW9uKCB0aGlzLCBtYXRlcmlhbCwgcmF5Y2FzdGVyLCByYXlMb2NhbFNwYWNlLCB1diwgdXYxLCBub3JtYWwsIGEsIGIsIGMgKTsKCgkJCQkJaWYgKCBpbnRlcnNlY3Rpb24gKSB7CgoJCQkJCQlpbnRlcnNlY3Rpb24uZmFjZUluZGV4ID0gTWF0aC5mbG9vciggaSAvIDMgKTsgLy8gdHJpYW5nbGUgbnVtYmVyIGluIGluZGV4ZWQgYnVmZmVyIHNlbWFudGljcwoJCQkJCQlpbnRlcnNlY3RzLnB1c2goIGludGVyc2VjdGlvbiApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQl9IGVsc2UgaWYgKCBwb3NpdGlvbiAhPT0gdW5kZWZpbmVkICkgewoKCQkJLy8gbm9uLWluZGV4ZWQgYnVmZmVyIGdlb21ldHJ5CgoJCQlpZiAoIEFycmF5LmlzQXJyYXkoIG1hdGVyaWFsICkgKSB7CgoJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGdyb3Vwcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJY29uc3QgZ3JvdXAgPSBncm91cHNbIGkgXTsKCQkJCQljb25zdCBncm91cE1hdGVyaWFsID0gbWF0ZXJpYWxbIGdyb3VwLm1hdGVyaWFsSW5kZXggXTsKCgkJCQkJY29uc3Qgc3RhcnQgPSBNYXRoLm1heCggZ3JvdXAuc3RhcnQsIGRyYXdSYW5nZS5zdGFydCApOwoJCQkJCWNvbnN0IGVuZCA9IE1hdGgubWluKCBwb3NpdGlvbi5jb3VudCwgTWF0aC5taW4oICggZ3JvdXAuc3RhcnQgKyBncm91cC5jb3VudCApLCAoIGRyYXdSYW5nZS5zdGFydCArIGRyYXdSYW5nZS5jb3VudCApICkgKTsKCgkJCQkJZm9yICggbGV0IGogPSBzdGFydCwgamwgPSBlbmQ7IGogPCBqbDsgaiArPSAzICkgewoKCQkJCQkJY29uc3QgYSA9IGo7CgkJCQkJCWNvbnN0IGIgPSBqICsgMTsKCQkJCQkJY29uc3QgYyA9IGogKyAyOwoKCQkJCQkJaW50ZXJzZWN0aW9uID0gY2hlY2tHZW9tZXRyeUludGVyc2VjdGlvbiggdGhpcywgZ3JvdXBNYXRlcmlhbCwgcmF5Y2FzdGVyLCByYXlMb2NhbFNwYWNlLCB1diwgdXYxLCBub3JtYWwsIGEsIGIsIGMgKTsKCgkJCQkJCWlmICggaW50ZXJzZWN0aW9uICkgewoKCQkJCQkJCWludGVyc2VjdGlvbi5mYWNlSW5kZXggPSBNYXRoLmZsb29yKCBqIC8gMyApOyAvLyB0cmlhbmdsZSBudW1iZXIgaW4gbm9uLWluZGV4ZWQgYnVmZmVyIHNlbWFudGljcwoJCQkJCQkJaW50ZXJzZWN0aW9uLmZhY2UubWF0ZXJpYWxJbmRleCA9IGdyb3VwLm1hdGVyaWFsSW5kZXg7CgkJCQkJCQlpbnRlcnNlY3RzLnB1c2goIGludGVyc2VjdGlvbiApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQljb25zdCBzdGFydCA9IE1hdGgubWF4KCAwLCBkcmF3UmFuZ2Uuc3RhcnQgKTsKCQkJCWNvbnN0IGVuZCA9IE1hdGgubWluKCBwb3NpdGlvbi5jb3VudCwgKCBkcmF3UmFuZ2Uuc3RhcnQgKyBkcmF3UmFuZ2UuY291bnQgKSApOwoKCQkJCWZvciAoIGxldCBpID0gc3RhcnQsIGlsID0gZW5kOyBpIDwgaWw7IGkgKz0gMyApIHsKCgkJCQkJY29uc3QgYSA9IGk7CgkJCQkJY29uc3QgYiA9IGkgKyAxOwoJCQkJCWNvbnN0IGMgPSBpICsgMjsKCgkJCQkJaW50ZXJzZWN0aW9uID0gY2hlY2tHZW9tZXRyeUludGVyc2VjdGlvbiggdGhpcywgbWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5TG9jYWxTcGFjZSwgdXYsIHV2MSwgbm9ybWFsLCBhLCBiLCBjICk7CgoJCQkJCWlmICggaW50ZXJzZWN0aW9uICkgewoKCQkJCQkJaW50ZXJzZWN0aW9uLmZhY2VJbmRleCA9IE1hdGguZmxvb3IoIGkgLyAzICk7IC8vIHRyaWFuZ2xlIG51bWJlciBpbiBub24taW5kZXhlZCBidWZmZXIgc2VtYW50aWNzCgkJCQkJCWludGVyc2VjdHMucHVzaCggaW50ZXJzZWN0aW9uICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCX0KCgl9Cgp9CgpmdW5jdGlvbiBjaGVja0ludGVyc2VjdGlvbiggb2JqZWN0LCBtYXRlcmlhbCwgcmF5Y2FzdGVyLCByYXksIHBBLCBwQiwgcEMsIHBvaW50ICkgewoKCWxldCBpbnRlcnNlY3Q7CgoJaWYgKCBtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSApIHsKCgkJaW50ZXJzZWN0ID0gcmF5LmludGVyc2VjdFRyaWFuZ2xlKCBwQywgcEIsIHBBLCB0cnVlLCBwb2ludCApOwoKCX0gZWxzZSB7CgoJCWludGVyc2VjdCA9IHJheS5pbnRlcnNlY3RUcmlhbmdsZSggcEEsIHBCLCBwQywgKCBtYXRlcmlhbC5zaWRlID09PSBGcm9udFNpZGUgKSwgcG9pbnQgKTsKCgl9CgoJaWYgKCBpbnRlcnNlY3QgPT09IG51bGwgKSByZXR1cm4gbnVsbDsKCglfaW50ZXJzZWN0aW9uUG9pbnRXb3JsZC5jb3B5KCBwb2ludCApOwoJX2ludGVyc2VjdGlvblBvaW50V29ybGQuYXBwbHlNYXRyaXg0KCBvYmplY3QubWF0cml4V29ybGQgKTsKCgljb25zdCBkaXN0YW5jZSA9IHJheWNhc3Rlci5yYXkub3JpZ2luLmRpc3RhbmNlVG8oIF9pbnRlcnNlY3Rpb25Qb2ludFdvcmxkICk7CgoJaWYgKCBkaXN0YW5jZSA8IHJheWNhc3Rlci5uZWFyIHx8IGRpc3RhbmNlID4gcmF5Y2FzdGVyLmZhciApIHJldHVybiBudWxsOwoKCXJldHVybiB7CgkJZGlzdGFuY2U6IGRpc3RhbmNlLAoJCXBvaW50OiBfaW50ZXJzZWN0aW9uUG9pbnRXb3JsZC5jbG9uZSgpLAoJCW9iamVjdDogb2JqZWN0Cgl9OwoKfQoKZnVuY3Rpb24gY2hlY2tHZW9tZXRyeUludGVyc2VjdGlvbiggb2JqZWN0LCBtYXRlcmlhbCwgcmF5Y2FzdGVyLCByYXksIHV2LCB1djEsIG5vcm1hbCwgYSwgYiwgYyApIHsKCglvYmplY3QuZ2V0VmVydGV4UG9zaXRpb24oIGEsIF92QSQxICk7CglvYmplY3QuZ2V0VmVydGV4UG9zaXRpb24oIGIsIF92QiQxICk7CglvYmplY3QuZ2V0VmVydGV4UG9zaXRpb24oIGMsIF92QyQxICk7CgoJY29uc3QgaW50ZXJzZWN0aW9uID0gY2hlY2tJbnRlcnNlY3Rpb24oIG9iamVjdCwgbWF0ZXJpYWwsIHJheWNhc3RlciwgcmF5LCBfdkEkMSwgX3ZCJDEsIF92QyQxLCBfaW50ZXJzZWN0aW9uUG9pbnQgKTsKCglpZiAoIGludGVyc2VjdGlvbiApIHsKCgkJaWYgKCB1diApIHsKCgkJCV91dkEkMS5mcm9tQnVmZmVyQXR0cmlidXRlKCB1diwgYSApOwoJCQlfdXZCJDEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggdXYsIGIgKTsKCQkJX3V2QyQxLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHV2LCBjICk7CgoJCQlpbnRlcnNlY3Rpb24udXYgPSBUcmlhbmdsZS5nZXRJbnRlcnBvbGF0aW9uKCBfaW50ZXJzZWN0aW9uUG9pbnQsIF92QSQxLCBfdkIkMSwgX3ZDJDEsIF91dkEkMSwgX3V2QiQxLCBfdXZDJDEsIG5ldyBWZWN0b3IyKCkgKTsKCgkJfQoKCQlpZiAoIHV2MSApIHsKCgkJCV91dkEkMS5mcm9tQnVmZmVyQXR0cmlidXRlKCB1djEsIGEgKTsKCQkJX3V2QiQxLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHV2MSwgYiApOwoJCQlfdXZDJDEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggdXYxLCBjICk7CgoJCQlpbnRlcnNlY3Rpb24udXYxID0gVHJpYW5nbGUuZ2V0SW50ZXJwb2xhdGlvbiggX2ludGVyc2VjdGlvblBvaW50LCBfdkEkMSwgX3ZCJDEsIF92QyQxLCBfdXZBJDEsIF91dkIkMSwgX3V2QyQxLCBuZXcgVmVjdG9yMigpICk7CgkJCWludGVyc2VjdGlvbi51djIgPSBpbnRlcnNlY3Rpb24udXYxOyAvLyBAZGVwcmVjYXRlZCwgcjE1MgoKCQl9CgoJCWlmICggbm9ybWFsICkgewoKCQkJX25vcm1hbEEuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFsLCBhICk7CgkJCV9ub3JtYWxCLmZyb21CdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbCwgYiApOwoJCQlfbm9ybWFsQy5mcm9tQnVmZmVyQXR0cmlidXRlKCBub3JtYWwsIGMgKTsKCgkJCWludGVyc2VjdGlvbi5ub3JtYWwgPSBUcmlhbmdsZS5nZXRJbnRlcnBvbGF0aW9uKCBfaW50ZXJzZWN0aW9uUG9pbnQsIF92QSQxLCBfdkIkMSwgX3ZDJDEsIF9ub3JtYWxBLCBfbm9ybWFsQiwgX25vcm1hbEMsIG5ldyBWZWN0b3IzKCkgKTsKCgkJCWlmICggaW50ZXJzZWN0aW9uLm5vcm1hbC5kb3QoIHJheS5kaXJlY3Rpb24gKSA+IDAgKSB7CgoJCQkJaW50ZXJzZWN0aW9uLm5vcm1hbC5tdWx0aXBseVNjYWxhciggLSAxICk7CgoJCQl9CgoJCX0KCgkJY29uc3QgZmFjZSA9IHsKCQkJYTogYSwKCQkJYjogYiwKCQkJYzogYywKCQkJbm9ybWFsOiBuZXcgVmVjdG9yMygpLAoJCQltYXRlcmlhbEluZGV4OiAwCgkJfTsKCgkJVHJpYW5nbGUuZ2V0Tm9ybWFsKCBfdkEkMSwgX3ZCJDEsIF92QyQxLCBmYWNlLm5vcm1hbCApOwoKCQlpbnRlcnNlY3Rpb24uZmFjZSA9IGZhY2U7CgoJfQoKCXJldHVybiBpbnRlcnNlY3Rpb247Cgp9CgpjbGFzcyBCb3hHZW9tZXRyeSBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKCgljb25zdHJ1Y3Rvciggd2lkdGggPSAxLCBoZWlnaHQgPSAxLCBkZXB0aCA9IDEsIHdpZHRoU2VnbWVudHMgPSAxLCBoZWlnaHRTZWdtZW50cyA9IDEsIGRlcHRoU2VnbWVudHMgPSAxICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLnR5cGUgPSAnQm94R2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXdpZHRoOiB3aWR0aCwKCQkJaGVpZ2h0OiBoZWlnaHQsCgkJCWRlcHRoOiBkZXB0aCwKCQkJd2lkdGhTZWdtZW50czogd2lkdGhTZWdtZW50cywKCQkJaGVpZ2h0U2VnbWVudHM6IGhlaWdodFNlZ21lbnRzLAoJCQlkZXB0aFNlZ21lbnRzOiBkZXB0aFNlZ21lbnRzCgkJfTsKCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQkvLyBzZWdtZW50cwoKCQl3aWR0aFNlZ21lbnRzID0gTWF0aC5mbG9vciggd2lkdGhTZWdtZW50cyApOwoJCWhlaWdodFNlZ21lbnRzID0gTWF0aC5mbG9vciggaGVpZ2h0U2VnbWVudHMgKTsKCQlkZXB0aFNlZ21lbnRzID0gTWF0aC5mbG9vciggZGVwdGhTZWdtZW50cyApOwoKCQkvLyBidWZmZXJzCgoJCWNvbnN0IGluZGljZXMgPSBbXTsKCQljb25zdCB2ZXJ0aWNlcyA9IFtdOwoJCWNvbnN0IG5vcm1hbHMgPSBbXTsKCQljb25zdCB1dnMgPSBbXTsKCgkJLy8gaGVscGVyIHZhcmlhYmxlcwoKCQlsZXQgbnVtYmVyT2ZWZXJ0aWNlcyA9IDA7CgkJbGV0IGdyb3VwU3RhcnQgPSAwOwoKCQkvLyBidWlsZCBlYWNoIHNpZGUgb2YgdGhlIGJveCBnZW9tZXRyeQoKCQlidWlsZFBsYW5lKCAneicsICd5JywgJ3gnLCAtIDEsIC0gMSwgZGVwdGgsIGhlaWdodCwgd2lkdGgsIGRlcHRoU2VnbWVudHMsIGhlaWdodFNlZ21lbnRzLCAwICk7IC8vIHB4CgkJYnVpbGRQbGFuZSggJ3onLCAneScsICd4JywgMSwgLSAxLCBkZXB0aCwgaGVpZ2h0LCAtIHdpZHRoLCBkZXB0aFNlZ21lbnRzLCBoZWlnaHRTZWdtZW50cywgMSApOyAvLyBueAoJCWJ1aWxkUGxhbmUoICd4JywgJ3onLCAneScsIDEsIDEsIHdpZHRoLCBkZXB0aCwgaGVpZ2h0LCB3aWR0aFNlZ21lbnRzLCBkZXB0aFNlZ21lbnRzLCAyICk7IC8vIHB5CgkJYnVpbGRQbGFuZSggJ3gnLCAneicsICd5JywgMSwgLSAxLCB3aWR0aCwgZGVwdGgsIC0gaGVpZ2h0LCB3aWR0aFNlZ21lbnRzLCBkZXB0aFNlZ21lbnRzLCAzICk7IC8vIG55CgkJYnVpbGRQbGFuZSggJ3gnLCAneScsICd6JywgMSwgLSAxLCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgd2lkdGhTZWdtZW50cywgaGVpZ2h0U2VnbWVudHMsIDQgKTsgLy8gcHoKCQlidWlsZFBsYW5lKCAneCcsICd5JywgJ3onLCAtIDEsIC0gMSwgd2lkdGgsIGhlaWdodCwgLSBkZXB0aCwgd2lkdGhTZWdtZW50cywgaGVpZ2h0U2VnbWVudHMsIDUgKTsgLy8gbnoKCgkJLy8gYnVpbGQgZ2VvbWV0cnkKCgkJdGhpcy5zZXRJbmRleCggaW5kaWNlcyApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAnbm9ybWFsJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbHMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAndXYnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdXZzLCAyICkgKTsKCgkJZnVuY3Rpb24gYnVpbGRQbGFuZSggdSwgdiwgdywgdWRpciwgdmRpciwgd2lkdGgsIGhlaWdodCwgZGVwdGgsIGdyaWRYLCBncmlkWSwgbWF0ZXJpYWxJbmRleCApIHsKCgkJCWNvbnN0IHNlZ21lbnRXaWR0aCA9IHdpZHRoIC8gZ3JpZFg7CgkJCWNvbnN0IHNlZ21lbnRIZWlnaHQgPSBoZWlnaHQgLyBncmlkWTsKCgkJCWNvbnN0IHdpZHRoSGFsZiA9IHdpZHRoIC8gMjsKCQkJY29uc3QgaGVpZ2h0SGFsZiA9IGhlaWdodCAvIDI7CgkJCWNvbnN0IGRlcHRoSGFsZiA9IGRlcHRoIC8gMjsKCgkJCWNvbnN0IGdyaWRYMSA9IGdyaWRYICsgMTsKCQkJY29uc3QgZ3JpZFkxID0gZ3JpZFkgKyAxOwoKCQkJbGV0IHZlcnRleENvdW50ZXIgPSAwOwoJCQlsZXQgZ3JvdXBDb3VudCA9IDA7CgoJCQljb25zdCB2ZWN0b3IgPSBuZXcgVmVjdG9yMygpOwoKCQkJLy8gZ2VuZXJhdGUgdmVydGljZXMsIG5vcm1hbHMgYW5kIHV2cwoKCQkJZm9yICggbGV0IGl5ID0gMDsgaXkgPCBncmlkWTE7IGl5ICsrICkgewoKCQkJCWNvbnN0IHkgPSBpeSAqIHNlZ21lbnRIZWlnaHQgLSBoZWlnaHRIYWxmOwoKCQkJCWZvciAoIGxldCBpeCA9IDA7IGl4IDwgZ3JpZFgxOyBpeCArKyApIHsKCgkJCQkJY29uc3QgeCA9IGl4ICogc2VnbWVudFdpZHRoIC0gd2lkdGhIYWxmOwoKCQkJCQkvLyBzZXQgdmFsdWVzIHRvIGNvcnJlY3QgdmVjdG9yIGNvbXBvbmVudAoKCQkJCQl2ZWN0b3JbIHUgXSA9IHggKiB1ZGlyOwoJCQkJCXZlY3RvclsgdiBdID0geSAqIHZkaXI7CgkJCQkJdmVjdG9yWyB3IF0gPSBkZXB0aEhhbGY7CgoJCQkJCS8vIG5vdyBhcHBseSB2ZWN0b3IgdG8gdmVydGV4IGJ1ZmZlcgoKCQkJCQl2ZXJ0aWNlcy5wdXNoKCB2ZWN0b3IueCwgdmVjdG9yLnksIHZlY3Rvci56ICk7CgoJCQkJCS8vIHNldCB2YWx1ZXMgdG8gY29ycmVjdCB2ZWN0b3IgY29tcG9uZW50CgoJCQkJCXZlY3RvclsgdSBdID0gMDsKCQkJCQl2ZWN0b3JbIHYgXSA9IDA7CgkJCQkJdmVjdG9yWyB3IF0gPSBkZXB0aCA+IDAgPyAxIDogLSAxOwoKCQkJCQkvLyBub3cgYXBwbHkgdmVjdG9yIHRvIG5vcm1hbCBidWZmZXIKCgkJCQkJbm9ybWFscy5wdXNoKCB2ZWN0b3IueCwgdmVjdG9yLnksIHZlY3Rvci56ICk7CgoJCQkJCS8vIHV2cwoKCQkJCQl1dnMucHVzaCggaXggLyBncmlkWCApOwoJCQkJCXV2cy5wdXNoKCAxIC0gKCBpeSAvIGdyaWRZICkgKTsKCgkJCQkJLy8gY291bnRlcnMKCgkJCQkJdmVydGV4Q291bnRlciArPSAxOwoKCQkJCX0KCgkJCX0KCgkJCS8vIGluZGljZXMKCgkJCS8vIDEuIHlvdSBuZWVkIHRocmVlIGluZGljZXMgdG8gZHJhdyBhIHNpbmdsZSBmYWNlCgkJCS8vIDIuIGEgc2luZ2xlIHNlZ21lbnQgY29uc2lzdHMgb2YgdHdvIGZhY2VzCgkJCS8vIDMuIHNvIHdlIG5lZWQgdG8gZ2VuZXJhdGUgc2l4ICgyKjMpIGluZGljZXMgcGVyIHNlZ21lbnQKCgkJCWZvciAoIGxldCBpeSA9IDA7IGl5IDwgZ3JpZFk7IGl5ICsrICkgewoKCQkJCWZvciAoIGxldCBpeCA9IDA7IGl4IDwgZ3JpZFg7IGl4ICsrICkgewoKCQkJCQljb25zdCBhID0gbnVtYmVyT2ZWZXJ0aWNlcyArIGl4ICsgZ3JpZFgxICogaXk7CgkJCQkJY29uc3QgYiA9IG51bWJlck9mVmVydGljZXMgKyBpeCArIGdyaWRYMSAqICggaXkgKyAxICk7CgkJCQkJY29uc3QgYyA9IG51bWJlck9mVmVydGljZXMgKyAoIGl4ICsgMSApICsgZ3JpZFgxICogKCBpeSArIDEgKTsKCQkJCQljb25zdCBkID0gbnVtYmVyT2ZWZXJ0aWNlcyArICggaXggKyAxICkgKyBncmlkWDEgKiBpeTsKCgkJCQkJLy8gZmFjZXMKCgkJCQkJaW5kaWNlcy5wdXNoKCBhLCBiLCBkICk7CgkJCQkJaW5kaWNlcy5wdXNoKCBiLCBjLCBkICk7CgoJCQkJCS8vIGluY3JlYXNlIGNvdW50ZXIKCgkJCQkJZ3JvdXBDb3VudCArPSA2OwoKCQkJCX0KCgkJCX0KCgkJCS8vIGFkZCBhIGdyb3VwIHRvIHRoZSBnZW9tZXRyeS4gdGhpcyB3aWxsIGVuc3VyZSBtdWx0aSBtYXRlcmlhbCBzdXBwb3J0CgoJCQlzY29wZS5hZGRHcm91cCggZ3JvdXBTdGFydCwgZ3JvdXBDb3VudCwgbWF0ZXJpYWxJbmRleCApOwoKCQkJLy8gY2FsY3VsYXRlIG5ldyBzdGFydCB2YWx1ZSBmb3IgZ3JvdXBzCgoJCQlncm91cFN0YXJ0ICs9IGdyb3VwQ291bnQ7CgoJCQkvLyB1cGRhdGUgdG90YWwgbnVtYmVyIG9mIHZlcnRpY2VzCgoJCQludW1iZXJPZlZlcnRpY2VzICs9IHZlcnRleENvdW50ZXI7CgoJCX0KCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5wYXJhbWV0ZXJzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzdGF0aWMgZnJvbUpTT04oIGRhdGEgKSB7CgoJCXJldHVybiBuZXcgQm94R2VvbWV0cnkoIGRhdGEud2lkdGgsIGRhdGEuaGVpZ2h0LCBkYXRhLmRlcHRoLCBkYXRhLndpZHRoU2VnbWVudHMsIGRhdGEuaGVpZ2h0U2VnbWVudHMsIGRhdGEuZGVwdGhTZWdtZW50cyApOwoKCX0KCn0KCi8qKgogKiBVbmlmb3JtIFV0aWxpdGllcwogKi8KCmZ1bmN0aW9uIGNsb25lVW5pZm9ybXMoIHNyYyApIHsKCgljb25zdCBkc3QgPSB7fTsKCglmb3IgKCBjb25zdCB1IGluIHNyYyApIHsKCgkJZHN0WyB1IF0gPSB7fTsKCgkJZm9yICggY29uc3QgcCBpbiBzcmNbIHUgXSApIHsKCgkJCWNvbnN0IHByb3BlcnR5ID0gc3JjWyB1IF1bIHAgXTsKCgkJCWlmICggcHJvcGVydHkgJiYgKCBwcm9wZXJ0eS5pc0NvbG9yIHx8CgkJCQlwcm9wZXJ0eS5pc01hdHJpeDMgfHwgcHJvcGVydHkuaXNNYXRyaXg0IHx8CgkJCQlwcm9wZXJ0eS5pc1ZlY3RvcjIgfHwgcHJvcGVydHkuaXNWZWN0b3IzIHx8IHByb3BlcnR5LmlzVmVjdG9yNCB8fAoJCQkJcHJvcGVydHkuaXNUZXh0dXJlIHx8IHByb3BlcnR5LmlzUXVhdGVybmlvbiApICkgewoKCQkJCWlmICggcHJvcGVydHkuaXNSZW5kZXJUYXJnZXRUZXh0dXJlICkgewoKCQkJCQljb25zb2xlLndhcm4oICdVbmlmb3Jtc1V0aWxzOiBUZXh0dXJlcyBvZiByZW5kZXIgdGFyZ2V0cyBjYW5ub3QgYmUgY2xvbmVkIHZpYSBjbG9uZVVuaWZvcm1zKCkgb3IgbWVyZ2VVbmlmb3JtcygpLicgKTsKCQkJCQlkc3RbIHUgXVsgcCBdID0gbnVsbDsKCgkJCQl9IGVsc2UgewoKCQkJCQlkc3RbIHUgXVsgcCBdID0gcHJvcGVydHkuY2xvbmUoKTsKCgkJCQl9CgoJCQl9IGVsc2UgaWYgKCBBcnJheS5pc0FycmF5KCBwcm9wZXJ0eSApICkgewoKCQkJCWRzdFsgdSBdWyBwIF0gPSBwcm9wZXJ0eS5zbGljZSgpOwoKCQkJfSBlbHNlIHsKCgkJCQlkc3RbIHUgXVsgcCBdID0gcHJvcGVydHk7CgoJCQl9CgoJCX0KCgl9CgoJcmV0dXJuIGRzdDsKCn0KCmZ1bmN0aW9uIG1lcmdlVW5pZm9ybXMoIHVuaWZvcm1zICkgewoKCWNvbnN0IG1lcmdlZCA9IHt9OwoKCWZvciAoIGxldCB1ID0gMDsgdSA8IHVuaWZvcm1zLmxlbmd0aDsgdSArKyApIHsKCgkJY29uc3QgdG1wID0gY2xvbmVVbmlmb3JtcyggdW5pZm9ybXNbIHUgXSApOwoKCQlmb3IgKCBjb25zdCBwIGluIHRtcCApIHsKCgkJCW1lcmdlZFsgcCBdID0gdG1wWyBwIF07CgoJCX0KCgl9CgoJcmV0dXJuIG1lcmdlZDsKCn0KCmZ1bmN0aW9uIGNsb25lVW5pZm9ybXNHcm91cHMoIHNyYyApIHsKCgljb25zdCBkc3QgPSBbXTsKCglmb3IgKCBsZXQgdSA9IDA7IHUgPCBzcmMubGVuZ3RoOyB1ICsrICkgewoKCQlkc3QucHVzaCggc3JjWyB1IF0uY2xvbmUoKSApOwoKCX0KCglyZXR1cm4gZHN0OwoKfQoKZnVuY3Rpb24gZ2V0VW5saXRVbmlmb3JtQ29sb3JTcGFjZSggcmVuZGVyZXIgKSB7CgoJaWYgKCByZW5kZXJlci5nZXRSZW5kZXJUYXJnZXQoKSA9PT0gbnVsbCApIHsKCgkJLy8gaHR0cHM6Ly9naXRodWIuY29tL21yZG9vYi90aHJlZS5qcy9wdWxsLzIzOTM3I2lzc3VlY29tbWVudC0xMTExMDY3Mzk4CgkJcmV0dXJuIHJlbmRlcmVyLm91dHB1dENvbG9yU3BhY2U7CgoJfQoKCXJldHVybiBDb2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2U7Cgp9CgovLyBMZWdhY3kKCmNvbnN0IFVuaWZvcm1zVXRpbHMgPSB7IGNsb25lOiBjbG9uZVVuaWZvcm1zLCBtZXJnZTogbWVyZ2VVbmlmb3JtcyB9OwoKdmFyIGRlZmF1bHRfdmVydGV4ID0gInZvaWQgbWFpbigpIHtcblx0Z2xfUG9zaXRpb24gPSBwcm9qZWN0aW9uTWF0cml4ICogbW9kZWxWaWV3TWF0cml4ICogdmVjNCggcG9zaXRpb24sIDEuMCApO1xufSI7Cgp2YXIgZGVmYXVsdF9mcmFnbWVudCA9ICJ2b2lkIG1haW4oKSB7XG5cdGdsX0ZyYWdDb2xvciA9IHZlYzQoIDEuMCwgMC4wLCAwLjAsIDEuMCApO1xufSI7CgpjbGFzcyBTaGFkZXJNYXRlcmlhbCBleHRlbmRzIE1hdGVyaWFsIHsKCgljb25zdHJ1Y3RvciggcGFyYW1ldGVycyApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc1NoYWRlck1hdGVyaWFsID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ1NoYWRlck1hdGVyaWFsJzsKCgkJdGhpcy5kZWZpbmVzID0ge307CgkJdGhpcy51bmlmb3JtcyA9IHt9OwoJCXRoaXMudW5pZm9ybXNHcm91cHMgPSBbXTsKCgkJdGhpcy52ZXJ0ZXhTaGFkZXIgPSBkZWZhdWx0X3ZlcnRleDsKCQl0aGlzLmZyYWdtZW50U2hhZGVyID0gZGVmYXVsdF9mcmFnbWVudDsKCgkJdGhpcy5saW5ld2lkdGggPSAxOwoKCQl0aGlzLndpcmVmcmFtZSA9IGZhbHNlOwoJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gMTsKCgkJdGhpcy5mb2cgPSBmYWxzZTsgLy8gc2V0IHRvIHVzZSBzY2VuZSBmb2cKCQl0aGlzLmxpZ2h0cyA9IGZhbHNlOyAvLyBzZXQgdG8gdXNlIHNjZW5lIGxpZ2h0cwoJCXRoaXMuY2xpcHBpbmcgPSBmYWxzZTsgLy8gc2V0IHRvIHVzZSB1c2VyLWRlZmluZWQgY2xpcHBpbmcgcGxhbmVzCgoJCXRoaXMuZm9yY2VTaW5nbGVQYXNzID0gdHJ1ZTsKCgkJdGhpcy5leHRlbnNpb25zID0gewoJCQlkZXJpdmF0aXZlczogZmFsc2UsIC8vIHNldCB0byB1c2UgZGVyaXZhdGl2ZXMKCQkJZnJhZ0RlcHRoOiBmYWxzZSwgLy8gc2V0IHRvIHVzZSBmcmFnbWVudCBkZXB0aCB2YWx1ZXMKCQkJZHJhd0J1ZmZlcnM6IGZhbHNlLCAvLyBzZXQgdG8gdXNlIGRyYXcgYnVmZmVycwoJCQlzaGFkZXJUZXh0dXJlTE9EOiBmYWxzZSAvLyBzZXQgdG8gdXNlIHNoYWRlciB0ZXh0dXJlIExPRAoJCX07CgoJCS8vIFdoZW4gcmVuZGVyZWQgZ2VvbWV0cnkgZG9lc24ndCBpbmNsdWRlIHRoZXNlIGF0dHJpYnV0ZXMgYnV0IHRoZSBtYXRlcmlhbCBkb2VzLAoJCS8vIHVzZSB0aGVzZSBkZWZhdWx0IHZhbHVlcyBpbiBXZWJHTC4gVGhpcyBhdm9pZHMgZXJyb3JzIHdoZW4gYnVmZmVyIGRhdGEgaXMgbWlzc2luZy4KCQl0aGlzLmRlZmF1bHRBdHRyaWJ1dGVWYWx1ZXMgPSB7CgkJCSdjb2xvcic6IFsgMSwgMSwgMSBdLAoJCQkndXYnOiBbIDAsIDAgXSwKCQkJJ3V2MSc6IFsgMCwgMCBdCgkJfTsKCgkJdGhpcy5pbmRleDBBdHRyaWJ1dGVOYW1lID0gdW5kZWZpbmVkOwoJCXRoaXMudW5pZm9ybXNOZWVkVXBkYXRlID0gZmFsc2U7CgoJCXRoaXMuZ2xzbFZlcnNpb24gPSBudWxsOwoKCQlpZiAoIHBhcmFtZXRlcnMgIT09IHVuZGVmaW5lZCApIHsKCgkJCXRoaXMuc2V0VmFsdWVzKCBwYXJhbWV0ZXJzICk7CgoJCX0KCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5mcmFnbWVudFNoYWRlciA9IHNvdXJjZS5mcmFnbWVudFNoYWRlcjsKCQl0aGlzLnZlcnRleFNoYWRlciA9IHNvdXJjZS52ZXJ0ZXhTaGFkZXI7CgoJCXRoaXMudW5pZm9ybXMgPSBjbG9uZVVuaWZvcm1zKCBzb3VyY2UudW5pZm9ybXMgKTsKCQl0aGlzLnVuaWZvcm1zR3JvdXBzID0gY2xvbmVVbmlmb3Jtc0dyb3Vwcyggc291cmNlLnVuaWZvcm1zR3JvdXBzICk7CgoJCXRoaXMuZGVmaW5lcyA9IE9iamVjdC5hc3NpZ24oIHt9LCBzb3VyY2UuZGVmaW5lcyApOwoKCQl0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CgkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSBzb3VyY2Uud2lyZWZyYW1lTGluZXdpZHRoOwoKCQl0aGlzLmZvZyA9IHNvdXJjZS5mb2c7CgkJdGhpcy5saWdodHMgPSBzb3VyY2UubGlnaHRzOwoJCXRoaXMuY2xpcHBpbmcgPSBzb3VyY2UuY2xpcHBpbmc7CgoJCXRoaXMuZXh0ZW5zaW9ucyA9IE9iamVjdC5hc3NpZ24oIHt9LCBzb3VyY2UuZXh0ZW5zaW9ucyApOwoKCQl0aGlzLmdsc2xWZXJzaW9uID0gc291cmNlLmdsc2xWZXJzaW9uOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9KU09OKCBtZXRhICkgewoKCQljb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCBtZXRhICk7CgoJCWRhdGEuZ2xzbFZlcnNpb24gPSB0aGlzLmdsc2xWZXJzaW9uOwoJCWRhdGEudW5pZm9ybXMgPSB7fTsKCgkJZm9yICggY29uc3QgbmFtZSBpbiB0aGlzLnVuaWZvcm1zICkgewoKCQkJY29uc3QgdW5pZm9ybSA9IHRoaXMudW5pZm9ybXNbIG5hbWUgXTsKCQkJY29uc3QgdmFsdWUgPSB1bmlmb3JtLnZhbHVlOwoKCQkJaWYgKCB2YWx1ZSAmJiB2YWx1ZS5pc1RleHR1cmUgKSB7CgoJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewoJCQkJCXR5cGU6ICd0JywKCQkJCQl2YWx1ZTogdmFsdWUudG9KU09OKCBtZXRhICkudXVpZAoJCQkJfTsKCgkJCX0gZWxzZSBpZiAoIHZhbHVlICYmIHZhbHVlLmlzQ29sb3IgKSB7CgoJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewoJCQkJCXR5cGU6ICdjJywKCQkJCQl2YWx1ZTogdmFsdWUuZ2V0SGV4KCkKCQkJCX07CgoJCQl9IGVsc2UgaWYgKCB2YWx1ZSAmJiB2YWx1ZS5pc1ZlY3RvcjIgKSB7CgoJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewoJCQkJCXR5cGU6ICd2MicsCgkJCQkJdmFsdWU6IHZhbHVlLnRvQXJyYXkoKQoJCQkJfTsKCgkJCX0gZWxzZSBpZiAoIHZhbHVlICYmIHZhbHVlLmlzVmVjdG9yMyApIHsKCgkJCQlkYXRhLnVuaWZvcm1zWyBuYW1lIF0gPSB7CgkJCQkJdHlwZTogJ3YzJywKCQkJCQl2YWx1ZTogdmFsdWUudG9BcnJheSgpCgkJCQl9OwoKCQkJfSBlbHNlIGlmICggdmFsdWUgJiYgdmFsdWUuaXNWZWN0b3I0ICkgewoKCQkJCWRhdGEudW5pZm9ybXNbIG5hbWUgXSA9IHsKCQkJCQl0eXBlOiAndjQnLAoJCQkJCXZhbHVlOiB2YWx1ZS50b0FycmF5KCkKCQkJCX07CgoJCQl9IGVsc2UgaWYgKCB2YWx1ZSAmJiB2YWx1ZS5pc01hdHJpeDMgKSB7CgoJCQkJZGF0YS51bmlmb3Jtc1sgbmFtZSBdID0gewoJCQkJCXR5cGU6ICdtMycsCgkJCQkJdmFsdWU6IHZhbHVlLnRvQXJyYXkoKQoJCQkJfTsKCgkJCX0gZWxzZSBpZiAoIHZhbHVlICYmIHZhbHVlLmlzTWF0cml4NCApIHsKCgkJCQlkYXRhLnVuaWZvcm1zWyBuYW1lIF0gPSB7CgkJCQkJdHlwZTogJ200JywKCQkJCQl2YWx1ZTogdmFsdWUudG9BcnJheSgpCgkJCQl9OwoKCQkJfSBlbHNlIHsKCgkJCQlkYXRhLnVuaWZvcm1zWyBuYW1lIF0gPSB7CgkJCQkJdmFsdWU6IHZhbHVlCgkJCQl9OwoKCQkJCS8vIG5vdGU6IHRoZSBhcnJheSB2YXJpYW50cyB2MnYsIHYzdiwgdjR2LCBtNHYgYW5kIHR2IGFyZSBub3Qgc3VwcG9ydGVkIHNvIGZhcgoKCQkJfQoKCQl9CgoJCWlmICggT2JqZWN0LmtleXMoIHRoaXMuZGVmaW5lcyApLmxlbmd0aCA+IDAgKSBkYXRhLmRlZmluZXMgPSB0aGlzLmRlZmluZXM7CgoJCWRhdGEudmVydGV4U2hhZGVyID0gdGhpcy52ZXJ0ZXhTaGFkZXI7CgkJZGF0YS5mcmFnbWVudFNoYWRlciA9IHRoaXMuZnJhZ21lbnRTaGFkZXI7CgoJCWRhdGEubGlnaHRzID0gdGhpcy5saWdodHM7CgkJZGF0YS5jbGlwcGluZyA9IHRoaXMuY2xpcHBpbmc7CgoJCWNvbnN0IGV4dGVuc2lvbnMgPSB7fTsKCgkJZm9yICggY29uc3Qga2V5IGluIHRoaXMuZXh0ZW5zaW9ucyApIHsKCgkJCWlmICggdGhpcy5leHRlbnNpb25zWyBrZXkgXSA9PT0gdHJ1ZSApIGV4dGVuc2lvbnNbIGtleSBdID0gdHJ1ZTsKCgkJfQoKCQlpZiAoIE9iamVjdC5rZXlzKCBleHRlbnNpb25zICkubGVuZ3RoID4gMCApIGRhdGEuZXh0ZW5zaW9ucyA9IGV4dGVuc2lvbnM7CgoJCXJldHVybiBkYXRhOwoKCX0KCn0KCmNsYXNzIENhbWVyYSBleHRlbmRzIE9iamVjdDNEIHsKCgljb25zdHJ1Y3RvcigpIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc0NhbWVyYSA9IHRydWU7CgoJCXRoaXMudHlwZSA9ICdDYW1lcmEnOwoKCQl0aGlzLm1hdHJpeFdvcmxkSW52ZXJzZSA9IG5ldyBNYXRyaXg0KCk7CgoJCXRoaXMucHJvamVjdGlvbk1hdHJpeCA9IG5ldyBNYXRyaXg0KCk7CgkJdGhpcy5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZSA9IG5ldyBNYXRyaXg0KCk7CgoJCXRoaXMuY29vcmRpbmF0ZVN5c3RlbSA9IFdlYkdMQ29vcmRpbmF0ZVN5c3RlbTsKCgl9CgoJY29weSggc291cmNlLCByZWN1cnNpdmUgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgoJCXRoaXMubWF0cml4V29ybGRJbnZlcnNlLmNvcHkoIHNvdXJjZS5tYXRyaXhXb3JsZEludmVyc2UgKTsKCgkJdGhpcy5wcm9qZWN0aW9uTWF0cml4LmNvcHkoIHNvdXJjZS5wcm9qZWN0aW9uTWF0cml4ICk7CgkJdGhpcy5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZS5jb3B5KCBzb3VyY2UucHJvamVjdGlvbk1hdHJpeEludmVyc2UgKTsKCgkJdGhpcy5jb29yZGluYXRlU3lzdGVtID0gc291cmNlLmNvb3JkaW5hdGVTeXN0ZW07CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXRXb3JsZERpcmVjdGlvbiggdGFyZ2V0ICkgewoKCQlyZXR1cm4gc3VwZXIuZ2V0V29ybGREaXJlY3Rpb24oIHRhcmdldCApLm5lZ2F0ZSgpOwoKCX0KCgl1cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKSB7CgoJCXN1cGVyLnVwZGF0ZU1hdHJpeFdvcmxkKCBmb3JjZSApOwoKCQl0aGlzLm1hdHJpeFdvcmxkSW52ZXJzZS5jb3B5KCB0aGlzLm1hdHJpeFdvcmxkICkuaW52ZXJ0KCk7CgoJfQoKCXVwZGF0ZVdvcmxkTWF0cml4KCB1cGRhdGVQYXJlbnRzLCB1cGRhdGVDaGlsZHJlbiApIHsKCgkJc3VwZXIudXBkYXRlV29ybGRNYXRyaXgoIHVwZGF0ZVBhcmVudHMsIHVwZGF0ZUNoaWxkcmVuICk7CgoJCXRoaXMubWF0cml4V29ybGRJbnZlcnNlLmNvcHkoIHRoaXMubWF0cml4V29ybGQgKS5pbnZlcnQoKTsKCgl9CgoJY2xvbmUoKSB7CgoJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCgl9Cgp9CgpjbGFzcyBQZXJzcGVjdGl2ZUNhbWVyYSBleHRlbmRzIENhbWVyYSB7CgoJY29uc3RydWN0b3IoIGZvdiA9IDUwLCBhc3BlY3QgPSAxLCBuZWFyID0gMC4xLCBmYXIgPSAyMDAwICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzUGVyc3BlY3RpdmVDYW1lcmEgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnUGVyc3BlY3RpdmVDYW1lcmEnOwoKCQl0aGlzLmZvdiA9IGZvdjsKCQl0aGlzLnpvb20gPSAxOwoKCQl0aGlzLm5lYXIgPSBuZWFyOwoJCXRoaXMuZmFyID0gZmFyOwoJCXRoaXMuZm9jdXMgPSAxMDsKCgkJdGhpcy5hc3BlY3QgPSBhc3BlY3Q7CgkJdGhpcy52aWV3ID0gbnVsbDsKCgkJdGhpcy5maWxtR2F1Z2UgPSAzNTsJLy8gd2lkdGggb2YgdGhlIGZpbG0gKGRlZmF1bHQgaW4gbWlsbGltZXRlcnMpCgkJdGhpcy5maWxtT2Zmc2V0ID0gMDsJLy8gaG9yaXpvbnRhbCBmaWxtIG9mZnNldCAoc2FtZSB1bml0IGFzIGdhdWdlKQoKCQl0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCgl9CgoJY29weSggc291cmNlLCByZWN1cnNpdmUgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgoJCXRoaXMuZm92ID0gc291cmNlLmZvdjsKCQl0aGlzLnpvb20gPSBzb3VyY2Uuem9vbTsKCgkJdGhpcy5uZWFyID0gc291cmNlLm5lYXI7CgkJdGhpcy5mYXIgPSBzb3VyY2UuZmFyOwoJCXRoaXMuZm9jdXMgPSBzb3VyY2UuZm9jdXM7CgoJCXRoaXMuYXNwZWN0ID0gc291cmNlLmFzcGVjdDsKCQl0aGlzLnZpZXcgPSBzb3VyY2UudmlldyA9PT0gbnVsbCA/IG51bGwgOiBPYmplY3QuYXNzaWduKCB7fSwgc291cmNlLnZpZXcgKTsKCgkJdGhpcy5maWxtR2F1Z2UgPSBzb3VyY2UuZmlsbUdhdWdlOwoJCXRoaXMuZmlsbU9mZnNldCA9IHNvdXJjZS5maWxtT2Zmc2V0OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJLyoqCgkgKiBTZXRzIHRoZSBGT1YgYnkgZm9jYWwgbGVuZ3RoIGluIHJlc3BlY3QgdG8gdGhlIGN1cnJlbnQgLmZpbG1HYXVnZS4KCSAqCgkgKiBUaGUgZGVmYXVsdCBmaWxtIGdhdWdlIGlzIDM1LCBzbyB0aGF0IHRoZSBmb2NhbCBsZW5ndGggY2FuIGJlIHNwZWNpZmllZCBmb3IKCSAqIGEgMzVtbSAoZnVsbCBmcmFtZSkgY2FtZXJhLgoJICoKCSAqIFZhbHVlcyBmb3IgZm9jYWwgbGVuZ3RoIGFuZCBmaWxtIGdhdWdlIG11c3QgaGF2ZSB0aGUgc2FtZSB1bml0LgoJICovCglzZXRGb2NhbExlbmd0aCggZm9jYWxMZW5ndGggKSB7CgoJCS8qKiBzZWUge0BsaW5rIGh0dHA6Ly93d3cuYm9iYXRraW5zLmNvbS9waG90b2dyYXBoeS90ZWNobmljYWwvZmllbGRfb2Zfdmlldy5odG1sfSAqLwoJCWNvbnN0IHZFeHRlbnRTbG9wZSA9IDAuNSAqIHRoaXMuZ2V0RmlsbUhlaWdodCgpIC8gZm9jYWxMZW5ndGg7CgoJCXRoaXMuZm92ID0gUkFEMkRFRyAqIDIgKiBNYXRoLmF0YW4oIHZFeHRlbnRTbG9wZSApOwoJCXRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCX0KCgkvKioKCSAqIENhbGN1bGF0ZXMgdGhlIGZvY2FsIGxlbmd0aCBmcm9tIHRoZSBjdXJyZW50IC5mb3YgYW5kIC5maWxtR2F1Z2UuCgkgKi8KCWdldEZvY2FsTGVuZ3RoKCkgewoKCQljb25zdCB2RXh0ZW50U2xvcGUgPSBNYXRoLnRhbiggREVHMlJBRCAqIDAuNSAqIHRoaXMuZm92ICk7CgoJCXJldHVybiAwLjUgKiB0aGlzLmdldEZpbG1IZWlnaHQoKSAvIHZFeHRlbnRTbG9wZTsKCgl9CgoJZ2V0RWZmZWN0aXZlRk9WKCkgewoKCQlyZXR1cm4gUkFEMkRFRyAqIDIgKiBNYXRoLmF0YW4oCgkJCU1hdGgudGFuKCBERUcyUkFEICogMC41ICogdGhpcy5mb3YgKSAvIHRoaXMuem9vbSApOwoKCX0KCglnZXRGaWxtV2lkdGgoKSB7CgoJCS8vIGZpbG0gbm90IGNvbXBsZXRlbHkgY292ZXJlZCBpbiBwb3J0cmFpdCBmb3JtYXQgKGFzcGVjdCA8IDEpCgkJcmV0dXJuIHRoaXMuZmlsbUdhdWdlICogTWF0aC5taW4oIHRoaXMuYXNwZWN0LCAxICk7CgoJfQoKCWdldEZpbG1IZWlnaHQoKSB7CgoJCS8vIGZpbG0gbm90IGNvbXBsZXRlbHkgY292ZXJlZCBpbiBsYW5kc2NhcGUgZm9ybWF0IChhc3BlY3QgPiAxKQoJCXJldHVybiB0aGlzLmZpbG1HYXVnZSAvIE1hdGgubWF4KCB0aGlzLmFzcGVjdCwgMSApOwoKCX0KCgkvKioKCSAqIFNldHMgYW4gb2Zmc2V0IGluIGEgbGFyZ2VyIGZydXN0dW0uIFRoaXMgaXMgdXNlZnVsIGZvciBtdWx0aS13aW5kb3cgb3IKCSAqIG11bHRpLW1vbml0b3IvbXVsdGktbWFjaGluZSBzZXR1cHMuCgkgKgoJICogRm9yIGV4YW1wbGUsIGlmIHlvdSBoYXZlIDN4MiBtb25pdG9ycyBhbmQgZWFjaCBtb25pdG9yIGlzIDE5MjB4MTA4MCBhbmQKCSAqIHRoZSBtb25pdG9ycyBhcmUgaW4gZ3JpZCBsaWtlIHRoaXMKCSAqCgkgKiAgICstLS0rLS0tKy0tLSsKCSAqICAgfCBBIHwgQiB8IEMgfAoJICogICArLS0tKy0tLSstLS0rCgkgKiAgIHwgRCB8IEUgfCBGIHwKCSAqICAgKy0tLSstLS0rLS0tKwoJICoKCSAqIHRoZW4gZm9yIGVhY2ggbW9uaXRvciB5b3Ugd291bGQgY2FsbCBpdCBsaWtlIHRoaXMKCSAqCgkgKiAgIGNvbnN0IHcgPSAxOTIwOwoJICogICBjb25zdCBoID0gMTA4MDsKCSAqICAgY29uc3QgZnVsbFdpZHRoID0gdyAqIDM7CgkgKiAgIGNvbnN0IGZ1bGxIZWlnaHQgPSBoICogMjsKCSAqCgkgKiAgIC0tQS0tCgkgKiAgIGNhbWVyYS5zZXRWaWV3T2Zmc2V0KCBmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHcgKiAwLCBoICogMCwgdywgaCApOwoJICogICAtLUItLQoJICogICBjYW1lcmEuc2V0Vmlld09mZnNldCggZnVsbFdpZHRoLCBmdWxsSGVpZ2h0LCB3ICogMSwgaCAqIDAsIHcsIGggKTsKCSAqICAgLS1DLS0KCSAqICAgY2FtZXJhLnNldFZpZXdPZmZzZXQoIGZ1bGxXaWR0aCwgZnVsbEhlaWdodCwgdyAqIDIsIGggKiAwLCB3LCBoICk7CgkgKiAgIC0tRC0tCgkgKiAgIGNhbWVyYS5zZXRWaWV3T2Zmc2V0KCBmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHcgKiAwLCBoICogMSwgdywgaCApOwoJICogICAtLUUtLQoJICogICBjYW1lcmEuc2V0Vmlld09mZnNldCggZnVsbFdpZHRoLCBmdWxsSGVpZ2h0LCB3ICogMSwgaCAqIDEsIHcsIGggKTsKCSAqICAgLS1GLS0KCSAqICAgY2FtZXJhLnNldFZpZXdPZmZzZXQoIGZ1bGxXaWR0aCwgZnVsbEhlaWdodCwgdyAqIDIsIGggKiAxLCB3LCBoICk7CgkgKgoJICogICBOb3RlIHRoZXJlIGlzIG5vIHJlYXNvbiBtb25pdG9ycyBoYXZlIHRvIGJlIHRoZSBzYW1lIHNpemUgb3IgaW4gYSBncmlkLgoJICovCglzZXRWaWV3T2Zmc2V0KCBmdWxsV2lkdGgsIGZ1bGxIZWlnaHQsIHgsIHksIHdpZHRoLCBoZWlnaHQgKSB7CgoJCXRoaXMuYXNwZWN0ID0gZnVsbFdpZHRoIC8gZnVsbEhlaWdodDsKCgkJaWYgKCB0aGlzLnZpZXcgPT09IG51bGwgKSB7CgoJCQl0aGlzLnZpZXcgPSB7CgkJCQllbmFibGVkOiB0cnVlLAoJCQkJZnVsbFdpZHRoOiAxLAoJCQkJZnVsbEhlaWdodDogMSwKCQkJCW9mZnNldFg6IDAsCgkJCQlvZmZzZXRZOiAwLAoJCQkJd2lkdGg6IDEsCgkJCQloZWlnaHQ6IDEKCQkJfTsKCgkJfQoKCQl0aGlzLnZpZXcuZW5hYmxlZCA9IHRydWU7CgkJdGhpcy52aWV3LmZ1bGxXaWR0aCA9IGZ1bGxXaWR0aDsKCQl0aGlzLnZpZXcuZnVsbEhlaWdodCA9IGZ1bGxIZWlnaHQ7CgkJdGhpcy52aWV3Lm9mZnNldFggPSB4OwoJCXRoaXMudmlldy5vZmZzZXRZID0geTsKCQl0aGlzLnZpZXcud2lkdGggPSB3aWR0aDsKCQl0aGlzLnZpZXcuaGVpZ2h0ID0gaGVpZ2h0OwoKCQl0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCgl9CgoJY2xlYXJWaWV3T2Zmc2V0KCkgewoKCQlpZiAoIHRoaXMudmlldyAhPT0gbnVsbCApIHsKCgkJCXRoaXMudmlldy5lbmFibGVkID0gZmFsc2U7CgoJCX0KCgkJdGhpcy51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CgoJfQoKCXVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKSB7CgoJCWNvbnN0IG5lYXIgPSB0aGlzLm5lYXI7CgkJbGV0IHRvcCA9IG5lYXIgKiBNYXRoLnRhbiggREVHMlJBRCAqIDAuNSAqIHRoaXMuZm92ICkgLyB0aGlzLnpvb207CgkJbGV0IGhlaWdodCA9IDIgKiB0b3A7CgkJbGV0IHdpZHRoID0gdGhpcy5hc3BlY3QgKiBoZWlnaHQ7CgkJbGV0IGxlZnQgPSAtIDAuNSAqIHdpZHRoOwoJCWNvbnN0IHZpZXcgPSB0aGlzLnZpZXc7CgoJCWlmICggdGhpcy52aWV3ICE9PSBudWxsICYmIHRoaXMudmlldy5lbmFibGVkICkgewoKCQkJY29uc3QgZnVsbFdpZHRoID0gdmlldy5mdWxsV2lkdGgsCgkJCQlmdWxsSGVpZ2h0ID0gdmlldy5mdWxsSGVpZ2h0OwoKCQkJbGVmdCArPSB2aWV3Lm9mZnNldFggKiB3aWR0aCAvIGZ1bGxXaWR0aDsKCQkJdG9wIC09IHZpZXcub2Zmc2V0WSAqIGhlaWdodCAvIGZ1bGxIZWlnaHQ7CgkJCXdpZHRoICo9IHZpZXcud2lkdGggLyBmdWxsV2lkdGg7CgkJCWhlaWdodCAqPSB2aWV3LmhlaWdodCAvIGZ1bGxIZWlnaHQ7CgoJCX0KCgkJY29uc3Qgc2tldyA9IHRoaXMuZmlsbU9mZnNldDsKCQlpZiAoIHNrZXcgIT09IDAgKSBsZWZ0ICs9IG5lYXIgKiBza2V3IC8gdGhpcy5nZXRGaWxtV2lkdGgoKTsKCgkJdGhpcy5wcm9qZWN0aW9uTWF0cml4Lm1ha2VQZXJzcGVjdGl2ZSggbGVmdCwgbGVmdCArIHdpZHRoLCB0b3AsIHRvcCAtIGhlaWdodCwgbmVhciwgdGhpcy5mYXIsIHRoaXMuY29vcmRpbmF0ZVN5c3RlbSApOwoKCQl0aGlzLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlLmNvcHkoIHRoaXMucHJvamVjdGlvbk1hdHJpeCApLmludmVydCgpOwoKCX0KCgl0b0pTT04oIG1ldGEgKSB7CgoJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oIG1ldGEgKTsKCgkJZGF0YS5vYmplY3QuZm92ID0gdGhpcy5mb3Y7CgkJZGF0YS5vYmplY3Quem9vbSA9IHRoaXMuem9vbTsKCgkJZGF0YS5vYmplY3QubmVhciA9IHRoaXMubmVhcjsKCQlkYXRhLm9iamVjdC5mYXIgPSB0aGlzLmZhcjsKCQlkYXRhLm9iamVjdC5mb2N1cyA9IHRoaXMuZm9jdXM7CgoJCWRhdGEub2JqZWN0LmFzcGVjdCA9IHRoaXMuYXNwZWN0OwoKCQlpZiAoIHRoaXMudmlldyAhPT0gbnVsbCApIGRhdGEub2JqZWN0LnZpZXcgPSBPYmplY3QuYXNzaWduKCB7fSwgdGhpcy52aWV3ICk7CgoJCWRhdGEub2JqZWN0LmZpbG1HYXVnZSA9IHRoaXMuZmlsbUdhdWdlOwoJCWRhdGEub2JqZWN0LmZpbG1PZmZzZXQgPSB0aGlzLmZpbG1PZmZzZXQ7CgoJCXJldHVybiBkYXRhOwoKCX0KCn0KCmNvbnN0IGZvdiA9IC0gOTA7IC8vIG5lZ2F0aXZlIGZvdiBpcyBub3QgYW4gZXJyb3IKY29uc3QgYXNwZWN0ID0gMTsKCmNsYXNzIEN1YmVDYW1lcmEgZXh0ZW5kcyBPYmplY3QzRCB7CgoJY29uc3RydWN0b3IoIG5lYXIsIGZhciwgcmVuZGVyVGFyZ2V0ICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLnR5cGUgPSAnQ3ViZUNhbWVyYSc7CgoJCXRoaXMucmVuZGVyVGFyZ2V0ID0gcmVuZGVyVGFyZ2V0OwoJCXRoaXMuY29vcmRpbmF0ZVN5c3RlbSA9IG51bGw7CgkJdGhpcy5hY3RpdmVNaXBtYXBMZXZlbCA9IDA7CgoJCWNvbnN0IGNhbWVyYVBYID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CgkJY2FtZXJhUFgubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJdGhpcy5hZGQoIGNhbWVyYVBYICk7CgoJCWNvbnN0IGNhbWVyYU5YID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CgkJY2FtZXJhTlgubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJdGhpcy5hZGQoIGNhbWVyYU5YICk7CgoJCWNvbnN0IGNhbWVyYVBZID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CgkJY2FtZXJhUFkubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJdGhpcy5hZGQoIGNhbWVyYVBZICk7CgoJCWNvbnN0IGNhbWVyYU5ZID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CgkJY2FtZXJhTlkubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJdGhpcy5hZGQoIGNhbWVyYU5ZICk7CgoJCWNvbnN0IGNhbWVyYVBaID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CgkJY2FtZXJhUFoubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJdGhpcy5hZGQoIGNhbWVyYVBaICk7CgoJCWNvbnN0IGNhbWVyYU5aID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CgkJY2FtZXJhTloubGF5ZXJzID0gdGhpcy5sYXllcnM7CgkJdGhpcy5hZGQoIGNhbWVyYU5aICk7CgoJfQoKCXVwZGF0ZUNvb3JkaW5hdGVTeXN0ZW0oKSB7CgoJCWNvbnN0IGNvb3JkaW5hdGVTeXN0ZW0gPSB0aGlzLmNvb3JkaW5hdGVTeXN0ZW07CgoJCWNvbnN0IGNhbWVyYXMgPSB0aGlzLmNoaWxkcmVuLmNvbmNhdCgpOwoKCQljb25zdCBbIGNhbWVyYVBYLCBjYW1lcmFOWCwgY2FtZXJhUFksIGNhbWVyYU5ZLCBjYW1lcmFQWiwgY2FtZXJhTlogXSA9IGNhbWVyYXM7CgoJCWZvciAoIGNvbnN0IGNhbWVyYSBvZiBjYW1lcmFzICkgdGhpcy5yZW1vdmUoIGNhbWVyYSApOwoKCQlpZiAoIGNvb3JkaW5hdGVTeXN0ZW0gPT09IFdlYkdMQ29vcmRpbmF0ZVN5c3RlbSApIHsKCgkJCWNhbWVyYVBYLnVwLnNldCggMCwgMSwgMCApOwoJCQljYW1lcmFQWC5sb29rQXQoIDEsIDAsIDAgKTsKCgkJCWNhbWVyYU5YLnVwLnNldCggMCwgMSwgMCApOwoJCQljYW1lcmFOWC5sb29rQXQoIC0gMSwgMCwgMCApOwoKCQkJY2FtZXJhUFkudXAuc2V0KCAwLCAwLCAtIDEgKTsKCQkJY2FtZXJhUFkubG9va0F0KCAwLCAxLCAwICk7CgoJCQljYW1lcmFOWS51cC5zZXQoIDAsIDAsIDEgKTsKCQkJY2FtZXJhTlkubG9va0F0KCAwLCAtIDEsIDAgKTsKCgkJCWNhbWVyYVBaLnVwLnNldCggMCwgMSwgMCApOwoJCQljYW1lcmFQWi5sb29rQXQoIDAsIDAsIDEgKTsKCgkJCWNhbWVyYU5aLnVwLnNldCggMCwgMSwgMCApOwoJCQljYW1lcmFOWi5sb29rQXQoIDAsIDAsIC0gMSApOwoKCQl9IGVsc2UgaWYgKCBjb29yZGluYXRlU3lzdGVtID09PSBXZWJHUFVDb29yZGluYXRlU3lzdGVtICkgewoKCQkJY2FtZXJhUFgudXAuc2V0KCAwLCAtIDEsIDAgKTsKCQkJY2FtZXJhUFgubG9va0F0KCAtIDEsIDAsIDAgKTsKCgkJCWNhbWVyYU5YLnVwLnNldCggMCwgLSAxLCAwICk7CgkJCWNhbWVyYU5YLmxvb2tBdCggMSwgMCwgMCApOwoKCQkJY2FtZXJhUFkudXAuc2V0KCAwLCAwLCAxICk7CgkJCWNhbWVyYVBZLmxvb2tBdCggMCwgMSwgMCApOwoKCQkJY2FtZXJhTlkudXAuc2V0KCAwLCAwLCAtIDEgKTsKCQkJY2FtZXJhTlkubG9va0F0KCAwLCAtIDEsIDAgKTsKCgkJCWNhbWVyYVBaLnVwLnNldCggMCwgLSAxLCAwICk7CgkJCWNhbWVyYVBaLmxvb2tBdCggMCwgMCwgMSApOwoKCQkJY2FtZXJhTloudXAuc2V0KCAwLCAtIDEsIDAgKTsKCQkJY2FtZXJhTloubG9va0F0KCAwLCAwLCAtIDEgKTsKCgkJfSBlbHNlIHsKCgkJCXRocm93IG5ldyBFcnJvciggJ1RIUkVFLkN1YmVDYW1lcmEudXBkYXRlQ29vcmRpbmF0ZVN5c3RlbSgpOiBJbnZhbGlkIGNvb3JkaW5hdGUgc3lzdGVtOiAnICsgY29vcmRpbmF0ZVN5c3RlbSApOwoKCQl9CgoJCWZvciAoIGNvbnN0IGNhbWVyYSBvZiBjYW1lcmFzICkgewoKCQkJdGhpcy5hZGQoIGNhbWVyYSApOwoKCQkJY2FtZXJhLnVwZGF0ZU1hdHJpeFdvcmxkKCk7CgoJCX0KCgl9CgoJdXBkYXRlKCByZW5kZXJlciwgc2NlbmUgKSB7CgoJCWlmICggdGhpcy5wYXJlbnQgPT09IG51bGwgKSB0aGlzLnVwZGF0ZU1hdHJpeFdvcmxkKCk7CgoJCWNvbnN0IHsgcmVuZGVyVGFyZ2V0LCBhY3RpdmVNaXBtYXBMZXZlbCB9ID0gdGhpczsKCgkJaWYgKCB0aGlzLmNvb3JkaW5hdGVTeXN0ZW0gIT09IHJlbmRlcmVyLmNvb3JkaW5hdGVTeXN0ZW0gKSB7CgoJCQl0aGlzLmNvb3JkaW5hdGVTeXN0ZW0gPSByZW5kZXJlci5jb29yZGluYXRlU3lzdGVtOwoKCQkJdGhpcy51cGRhdGVDb29yZGluYXRlU3lzdGVtKCk7CgoJCX0KCgkJY29uc3QgWyBjYW1lcmFQWCwgY2FtZXJhTlgsIGNhbWVyYVBZLCBjYW1lcmFOWSwgY2FtZXJhUFosIGNhbWVyYU5aIF0gPSB0aGlzLmNoaWxkcmVuOwoKCQljb25zdCBjdXJyZW50UmVuZGVyVGFyZ2V0ID0gcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CgkJY29uc3QgY3VycmVudEFjdGl2ZUN1YmVGYWNlID0gcmVuZGVyZXIuZ2V0QWN0aXZlQ3ViZUZhY2UoKTsKCQljb25zdCBjdXJyZW50QWN0aXZlTWlwbWFwTGV2ZWwgPSByZW5kZXJlci5nZXRBY3RpdmVNaXBtYXBMZXZlbCgpOwoKCQljb25zdCBjdXJyZW50WHJFbmFibGVkID0gcmVuZGVyZXIueHIuZW5hYmxlZDsKCgkJcmVuZGVyZXIueHIuZW5hYmxlZCA9IGZhbHNlOwoKCQljb25zdCBnZW5lcmF0ZU1pcG1hcHMgPSByZW5kZXJUYXJnZXQudGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHM7CgoJCXJlbmRlclRhcmdldC50ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyA9IGZhbHNlOwoKCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgMCwgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKCQlyZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmFQWCApOwoKCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgMSwgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKCQlyZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmFOWCApOwoKCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgMiwgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKCQlyZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmFQWSApOwoKCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgMywgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKCQlyZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmFOWSApOwoKCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCwgNCwgYWN0aXZlTWlwbWFwTGV2ZWwgKTsKCQlyZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjYW1lcmFQWiApOwoKCQkvLyBtaXBtYXBzIGFyZSBnZW5lcmF0ZWQgZHVyaW5nIHRoZSBsYXN0IGNhbGwgb2YgcmVuZGVyKCkKCQkvLyBhdCB0aGlzIHBvaW50LCBhbGwgc2lkZXMgb2YgdGhlIGN1YmUgcmVuZGVyIHRhcmdldCBhcmUgZGVmaW5lZAoKCQlyZW5kZXJUYXJnZXQudGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHMgPSBnZW5lcmF0ZU1pcG1hcHM7CgoJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0LCA1LCBhY3RpdmVNaXBtYXBMZXZlbCApOwoJCXJlbmRlcmVyLnJlbmRlciggc2NlbmUsIGNhbWVyYU5aICk7CgoJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggY3VycmVudFJlbmRlclRhcmdldCwgY3VycmVudEFjdGl2ZUN1YmVGYWNlLCBjdXJyZW50QWN0aXZlTWlwbWFwTGV2ZWwgKTsKCgkJcmVuZGVyZXIueHIuZW5hYmxlZCA9IGN1cnJlbnRYckVuYWJsZWQ7CgoJCXJlbmRlclRhcmdldC50ZXh0dXJlLm5lZWRzUE1SRU1VcGRhdGUgPSB0cnVlOwoKCX0KCn0KCmNsYXNzIEN1YmVUZXh0dXJlIGV4dGVuZHMgVGV4dHVyZSB7CgoJY29uc3RydWN0b3IoIGltYWdlcywgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5LCBjb2xvclNwYWNlICkgewoKCQlpbWFnZXMgPSBpbWFnZXMgIT09IHVuZGVmaW5lZCA/IGltYWdlcyA6IFtdOwoJCW1hcHBpbmcgPSBtYXBwaW5nICE9PSB1bmRlZmluZWQgPyBtYXBwaW5nIDogQ3ViZVJlZmxlY3Rpb25NYXBwaW5nOwoKCQlzdXBlciggaW1hZ2VzLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciwgbWluRmlsdGVyLCBmb3JtYXQsIHR5cGUsIGFuaXNvdHJvcHksIGNvbG9yU3BhY2UgKTsKCgkJdGhpcy5pc0N1YmVUZXh0dXJlID0gdHJ1ZTsKCgkJdGhpcy5mbGlwWSA9IGZhbHNlOwoKCX0KCglnZXQgaW1hZ2VzKCkgewoKCQlyZXR1cm4gdGhpcy5pbWFnZTsKCgl9CgoJc2V0IGltYWdlcyggdmFsdWUgKSB7CgoJCXRoaXMuaW1hZ2UgPSB2YWx1ZTsKCgl9Cgp9CgpjbGFzcyBXZWJHTEN1YmVSZW5kZXJUYXJnZXQgZXh0ZW5kcyBXZWJHTFJlbmRlclRhcmdldCB7CgoJY29uc3RydWN0b3IoIHNpemUgPSAxLCBvcHRpb25zID0ge30gKSB7CgoJCXN1cGVyKCBzaXplLCBzaXplLCBvcHRpb25zICk7CgoJCXRoaXMuaXNXZWJHTEN1YmVSZW5kZXJUYXJnZXQgPSB0cnVlOwoKCQljb25zdCBpbWFnZSA9IHsgd2lkdGg6IHNpemUsIGhlaWdodDogc2l6ZSwgZGVwdGg6IDEgfTsKCQljb25zdCBpbWFnZXMgPSBbIGltYWdlLCBpbWFnZSwgaW1hZ2UsIGltYWdlLCBpbWFnZSwgaW1hZ2UgXTsKCgkJaWYgKCBvcHRpb25zLmVuY29kaW5nICE9PSB1bmRlZmluZWQgKSB7CgoJCQkvLyBAZGVwcmVjYXRlZCwgcjE1MgoJCQl3YXJuT25jZSggJ1RIUkVFLldlYkdMQ3ViZVJlbmRlclRhcmdldDogb3B0aW9uLmVuY29kaW5nIGhhcyBiZWVuIHJlcGxhY2VkIGJ5IG9wdGlvbi5jb2xvclNwYWNlLicgKTsKCQkJb3B0aW9ucy5jb2xvclNwYWNlID0gb3B0aW9ucy5lbmNvZGluZyA9PT0gc1JHQkVuY29kaW5nID8gU1JHQkNvbG9yU3BhY2UgOiBOb0NvbG9yU3BhY2U7CgoJCX0KCgkJdGhpcy50ZXh0dXJlID0gbmV3IEN1YmVUZXh0dXJlKCBpbWFnZXMsIG9wdGlvbnMubWFwcGluZywgb3B0aW9ucy53cmFwUywgb3B0aW9ucy53cmFwVCwgb3B0aW9ucy5tYWdGaWx0ZXIsIG9wdGlvbnMubWluRmlsdGVyLCBvcHRpb25zLmZvcm1hdCwgb3B0aW9ucy50eXBlLCBvcHRpb25zLmFuaXNvdHJvcHksIG9wdGlvbnMuY29sb3JTcGFjZSApOwoKCQkvLyBCeSBjb252ZW50aW9uIC0tIGxpa2VseSBiYXNlZCBvbiB0aGUgUmVuZGVyTWFuIHNwZWMgZnJvbSB0aGUgMTk5MCdzIC0tIGN1YmUgbWFwcyBhcmUgc3BlY2lmaWVkIGJ5IFdlYkdMIChhbmQgdGhyZWUuanMpCgkJLy8gaW4gYSBjb29yZGluYXRlIHN5c3RlbSBpbiB3aGljaCBwb3NpdGl2ZS14IGlzIHRvIHRoZSByaWdodCB3aGVuIGxvb2tpbmcgdXAgdGhlIHBvc2l0aXZlLXogYXhpcyAtLSBpbiBvdGhlciB3b3JkcywKCQkvLyBpbiBhIGxlZnQtaGFuZGVkIGNvb3JkaW5hdGUgc3lzdGVtLiBCeSBjb250aW51aW5nIHRoaXMgY29udmVudGlvbiwgcHJlZXhpc3RpbmcgY3ViZSBtYXBzIGNvbnRpbnVlZCB0byByZW5kZXIgY29ycmVjdGx5LgoKCQkvLyB0aHJlZS5qcyB1c2VzIGEgcmlnaHQtaGFuZGVkIGNvb3JkaW5hdGUgc3lzdGVtLiBTbyBlbnZpcm9ubWVudCBtYXBzIHVzZWQgaW4gdGhyZWUuanMgYXBwZWFyIHRvIGhhdmUgcHggYW5kIG54IHN3YXBwZWQKCQkvLyBhbmQgdGhlIGZsYWcgaXNSZW5kZXJUYXJnZXRUZXh0dXJlIGNvbnRyb2xzIHRoaXMgY29udmVyc2lvbi4gVGhlIGZsaXAgaXMgbm90IHJlcXVpcmVkIHdoZW4gdXNpbmcgV2ViR0xDdWJlUmVuZGVyVGFyZ2V0LnRleHR1cmUKCQkvLyBhcyBhIGN1YmUgdGV4dHVyZSAodGhpcyBpcyBkZXRlY3RlZCB3aGVuIGlzUmVuZGVyVGFyZ2V0VGV4dHVyZSBpcyBzZXQgdG8gdHJ1ZSBmb3IgY3ViZSB0ZXh0dXJlcykuCgoJCXRoaXMudGV4dHVyZS5pc1JlbmRlclRhcmdldFRleHR1cmUgPSB0cnVlOwoKCQl0aGlzLnRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gb3B0aW9ucy5nZW5lcmF0ZU1pcG1hcHMgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuZ2VuZXJhdGVNaXBtYXBzIDogZmFsc2U7CgkJdGhpcy50ZXh0dXJlLm1pbkZpbHRlciA9IG9wdGlvbnMubWluRmlsdGVyICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLm1pbkZpbHRlciA6IExpbmVhckZpbHRlcjsKCgl9CgoJZnJvbUVxdWlyZWN0YW5ndWxhclRleHR1cmUoIHJlbmRlcmVyLCB0ZXh0dXJlICkgewoKCQl0aGlzLnRleHR1cmUudHlwZSA9IHRleHR1cmUudHlwZTsKCQl0aGlzLnRleHR1cmUuY29sb3JTcGFjZSA9IHRleHR1cmUuY29sb3JTcGFjZTsKCgkJdGhpcy50ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyA9IHRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzOwoJCXRoaXMudGV4dHVyZS5taW5GaWx0ZXIgPSB0ZXh0dXJlLm1pbkZpbHRlcjsKCQl0aGlzLnRleHR1cmUubWFnRmlsdGVyID0gdGV4dHVyZS5tYWdGaWx0ZXI7CgoJCWNvbnN0IHNoYWRlciA9IHsKCgkJCXVuaWZvcm1zOiB7CgkJCQl0RXF1aXJlY3Q6IHsgdmFsdWU6IG51bGwgfSwKCQkJfSwKCgkJCXZlcnRleFNoYWRlcjogLyogZ2xzbCAqL2AKCgkJCQl2YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uOwoKCQkJCXZlYzMgdHJhbnNmb3JtRGlyZWN0aW9uKCBpbiB2ZWMzIGRpciwgaW4gbWF0NCBtYXRyaXggKSB7CgoJCQkJCXJldHVybiBub3JtYWxpemUoICggbWF0cml4ICogdmVjNCggZGlyLCAwLjAgKSApLnh5eiApOwoKCQkJCX0KCgkJCQl2b2lkIG1haW4oKSB7CgoJCQkJCXZXb3JsZERpcmVjdGlvbiA9IHRyYW5zZm9ybURpcmVjdGlvbiggcG9zaXRpb24sIG1vZGVsTWF0cml4ICk7CgoJCQkJCSNpbmNsdWRlIDxiZWdpbl92ZXJ0ZXg+CgkJCQkJI2luY2x1ZGUgPHByb2plY3RfdmVydGV4PgoKCQkJCX0KCQkJYCwKCgkJCWZyYWdtZW50U2hhZGVyOiAvKiBnbHNsICovYAoKCQkJCXVuaWZvcm0gc2FtcGxlcjJEIHRFcXVpcmVjdDsKCgkJCQl2YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uOwoKCQkJCSNpbmNsdWRlIDxjb21tb24+CgoJCQkJdm9pZCBtYWluKCkgewoKCQkJCQl2ZWMzIGRpcmVjdGlvbiA9IG5vcm1hbGl6ZSggdldvcmxkRGlyZWN0aW9uICk7CgoJCQkJCXZlYzIgc2FtcGxlVVYgPSBlcXVpcmVjdFV2KCBkaXJlY3Rpb24gKTsKCgkJCQkJZ2xfRnJhZ0NvbG9yID0gdGV4dHVyZTJEKCB0RXF1aXJlY3QsIHNhbXBsZVVWICk7CgoJCQkJfQoJCQlgCgkJfTsKCgkJY29uc3QgZ2VvbWV0cnkgPSBuZXcgQm94R2VvbWV0cnkoIDUsIDUsIDUgKTsKCgkJY29uc3QgbWF0ZXJpYWwgPSBuZXcgU2hhZGVyTWF0ZXJpYWwoIHsKCgkJCW5hbWU6ICdDdWJlbWFwRnJvbUVxdWlyZWN0JywKCgkJCXVuaWZvcm1zOiBjbG9uZVVuaWZvcm1zKCBzaGFkZXIudW5pZm9ybXMgKSwKCQkJdmVydGV4U2hhZGVyOiBzaGFkZXIudmVydGV4U2hhZGVyLAoJCQlmcmFnbWVudFNoYWRlcjogc2hhZGVyLmZyYWdtZW50U2hhZGVyLAoJCQlzaWRlOiBCYWNrU2lkZSwKCQkJYmxlbmRpbmc6IE5vQmxlbmRpbmcKCgkJfSApOwoKCQltYXRlcmlhbC51bmlmb3Jtcy50RXF1aXJlY3QudmFsdWUgPSB0ZXh0dXJlOwoKCQljb25zdCBtZXNoID0gbmV3IE1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCQljb25zdCBjdXJyZW50TWluRmlsdGVyID0gdGV4dHVyZS5taW5GaWx0ZXI7CgoJCS8vIEF2b2lkIGJsdXJyZWQgcG9sZXMKCQlpZiAoIHRleHR1cmUubWluRmlsdGVyID09PSBMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIgKSB0ZXh0dXJlLm1pbkZpbHRlciA9IExpbmVhckZpbHRlcjsKCgkJY29uc3QgY2FtZXJhID0gbmV3IEN1YmVDYW1lcmEoIDEsIDEwLCB0aGlzICk7CgkJY2FtZXJhLnVwZGF0ZSggcmVuZGVyZXIsIG1lc2ggKTsKCgkJdGV4dHVyZS5taW5GaWx0ZXIgPSBjdXJyZW50TWluRmlsdGVyOwoKCQltZXNoLmdlb21ldHJ5LmRpc3Bvc2UoKTsKCQltZXNoLm1hdGVyaWFsLmRpc3Bvc2UoKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNsZWFyKCByZW5kZXJlciwgY29sb3IsIGRlcHRoLCBzdGVuY2lsICkgewoKCQljb25zdCBjdXJyZW50UmVuZGVyVGFyZ2V0ID0gcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIHRoaXMsIGkgKTsKCgkJCXJlbmRlcmVyLmNsZWFyKCBjb2xvciwgZGVwdGgsIHN0ZW5jaWwgKTsKCgkJfQoKCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIGN1cnJlbnRSZW5kZXJUYXJnZXQgKTsKCgl9Cgp9Cgpjb25zdCBfdmVjdG9yMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3ZlY3RvcjIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF9ub3JtYWxNYXRyaXggPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCk7CgpjbGFzcyBQbGFuZSB7CgoJY29uc3RydWN0b3IoIG5vcm1hbCA9IG5ldyBWZWN0b3IzKCAxLCAwLCAwICksIGNvbnN0YW50ID0gMCApIHsKCgkJdGhpcy5pc1BsYW5lID0gdHJ1ZTsKCgkJLy8gbm9ybWFsIGlzIGFzc3VtZWQgdG8gYmUgbm9ybWFsaXplZAoKCQl0aGlzLm5vcm1hbCA9IG5vcm1hbDsKCQl0aGlzLmNvbnN0YW50ID0gY29uc3RhbnQ7CgoJfQoKCXNldCggbm9ybWFsLCBjb25zdGFudCApIHsKCgkJdGhpcy5ub3JtYWwuY29weSggbm9ybWFsICk7CgkJdGhpcy5jb25zdGFudCA9IGNvbnN0YW50OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0Q29tcG9uZW50cyggeCwgeSwgeiwgdyApIHsKCgkJdGhpcy5ub3JtYWwuc2V0KCB4LCB5LCB6ICk7CgkJdGhpcy5jb25zdGFudCA9IHc7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tTm9ybWFsQW5kQ29wbGFuYXJQb2ludCggbm9ybWFsLCBwb2ludCApIHsKCgkJdGhpcy5ub3JtYWwuY29weSggbm9ybWFsICk7CgkJdGhpcy5jb25zdGFudCA9IC0gcG9pbnQuZG90KCB0aGlzLm5vcm1hbCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RnJvbUNvcGxhbmFyUG9pbnRzKCBhLCBiLCBjICkgewoKCQljb25zdCBub3JtYWwgPSBfdmVjdG9yMS5zdWJWZWN0b3JzKCBjLCBiICkuY3Jvc3MoIF92ZWN0b3IyLnN1YlZlY3RvcnMoIGEsIGIgKSApLm5vcm1hbGl6ZSgpOwoKCQkvLyBROiBzaG91bGQgYW4gZXJyb3IgYmUgdGhyb3duIGlmIG5vcm1hbCBpcyB6ZXJvIChlLmcuIGRlZ2VuZXJhdGUgcGxhbmUpPwoKCQl0aGlzLnNldEZyb21Ob3JtYWxBbmRDb3BsYW5hclBvaW50KCBub3JtYWwsIGEgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvcHkoIHBsYW5lICkgewoKCQl0aGlzLm5vcm1hbC5jb3B5KCBwbGFuZS5ub3JtYWwgKTsKCQl0aGlzLmNvbnN0YW50ID0gcGxhbmUuY29uc3RhbnQ7CgoJCXJldHVybiB0aGlzOwoKCX0KCglub3JtYWxpemUoKSB7CgoJCS8vIE5vdGU6IHdpbGwgbGVhZCB0byBhIGRpdmlkZSBieSB6ZXJvIGlmIHRoZSBwbGFuZSBpcyBpbnZhbGlkLgoKCQljb25zdCBpbnZlcnNlTm9ybWFsTGVuZ3RoID0gMS4wIC8gdGhpcy5ub3JtYWwubGVuZ3RoKCk7CgkJdGhpcy5ub3JtYWwubXVsdGlwbHlTY2FsYXIoIGludmVyc2VOb3JtYWxMZW5ndGggKTsKCQl0aGlzLmNvbnN0YW50ICo9IGludmVyc2VOb3JtYWxMZW5ndGg7CgoJCXJldHVybiB0aGlzOwoKCX0KCgluZWdhdGUoKSB7CgoJCXRoaXMuY29uc3RhbnQgKj0gLSAxOwoJCXRoaXMubm9ybWFsLm5lZ2F0ZSgpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZGlzdGFuY2VUb1BvaW50KCBwb2ludCApIHsKCgkJcmV0dXJuIHRoaXMubm9ybWFsLmRvdCggcG9pbnQgKSArIHRoaXMuY29uc3RhbnQ7CgoJfQoKCWRpc3RhbmNlVG9TcGhlcmUoIHNwaGVyZSApIHsKCgkJcmV0dXJuIHRoaXMuZGlzdGFuY2VUb1BvaW50KCBzcGhlcmUuY2VudGVyICkgLSBzcGhlcmUucmFkaXVzOwoKCX0KCglwcm9qZWN0UG9pbnQoIHBvaW50LCB0YXJnZXQgKSB7CgoJCXJldHVybiB0YXJnZXQuY29weSggcG9pbnQgKS5hZGRTY2FsZWRWZWN0b3IoIHRoaXMubm9ybWFsLCAtIHRoaXMuZGlzdGFuY2VUb1BvaW50KCBwb2ludCApICk7CgoJfQoKCWludGVyc2VjdExpbmUoIGxpbmUsIHRhcmdldCApIHsKCgkJY29uc3QgZGlyZWN0aW9uID0gbGluZS5kZWx0YSggX3ZlY3RvcjEgKTsKCgkJY29uc3QgZGVub21pbmF0b3IgPSB0aGlzLm5vcm1hbC5kb3QoIGRpcmVjdGlvbiApOwoKCQlpZiAoIGRlbm9taW5hdG9yID09PSAwICkgewoKCQkJLy8gbGluZSBpcyBjb3BsYW5hciwgcmV0dXJuIG9yaWdpbgoJCQlpZiAoIHRoaXMuZGlzdGFuY2VUb1BvaW50KCBsaW5lLnN0YXJ0ICkgPT09IDAgKSB7CgoJCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBsaW5lLnN0YXJ0ICk7CgoJCQl9CgoJCQkvLyBVbnN1cmUgaWYgdGhpcyBpcyB0aGUgY29ycmVjdCBtZXRob2QgdG8gaGFuZGxlIHRoaXMgY2FzZS4KCQkJcmV0dXJuIG51bGw7CgoJCX0KCgkJY29uc3QgdCA9IC0gKCBsaW5lLnN0YXJ0LmRvdCggdGhpcy5ub3JtYWwgKSArIHRoaXMuY29uc3RhbnQgKSAvIGRlbm9taW5hdG9yOwoKCQlpZiAoIHQgPCAwIHx8IHQgPiAxICkgewoKCQkJcmV0dXJuIG51bGw7CgoJCX0KCgkJcmV0dXJuIHRhcmdldC5jb3B5KCBsaW5lLnN0YXJ0ICkuYWRkU2NhbGVkVmVjdG9yKCBkaXJlY3Rpb24sIHQgKTsKCgl9CgoJaW50ZXJzZWN0c0xpbmUoIGxpbmUgKSB7CgoJCS8vIE5vdGU6IHRoaXMgdGVzdHMgaWYgYSBsaW5lIGludGVyc2VjdHMgdGhlIHBsYW5lLCBub3Qgd2hldGhlciBpdCAob3IgaXRzIGVuZC1wb2ludHMpIGFyZSBjb3BsYW5hciB3aXRoIGl0LgoKCQljb25zdCBzdGFydFNpZ24gPSB0aGlzLmRpc3RhbmNlVG9Qb2ludCggbGluZS5zdGFydCApOwoJCWNvbnN0IGVuZFNpZ24gPSB0aGlzLmRpc3RhbmNlVG9Qb2ludCggbGluZS5lbmQgKTsKCgkJcmV0dXJuICggc3RhcnRTaWduIDwgMCAmJiBlbmRTaWduID4gMCApIHx8ICggZW5kU2lnbiA8IDAgJiYgc3RhcnRTaWduID4gMCApOwoKCX0KCglpbnRlcnNlY3RzQm94KCBib3ggKSB7CgoJCXJldHVybiBib3guaW50ZXJzZWN0c1BsYW5lKCB0aGlzICk7CgoJfQoKCWludGVyc2VjdHNTcGhlcmUoIHNwaGVyZSApIHsKCgkJcmV0dXJuIHNwaGVyZS5pbnRlcnNlY3RzUGxhbmUoIHRoaXMgKTsKCgl9CgoJY29wbGFuYXJQb2ludCggdGFyZ2V0ICkgewoKCQlyZXR1cm4gdGFyZ2V0LmNvcHkoIHRoaXMubm9ybWFsICkubXVsdGlwbHlTY2FsYXIoIC0gdGhpcy5jb25zdGFudCApOwoKCX0KCglhcHBseU1hdHJpeDQoIG1hdHJpeCwgb3B0aW9uYWxOb3JtYWxNYXRyaXggKSB7CgoJCWNvbnN0IG5vcm1hbE1hdHJpeCA9IG9wdGlvbmFsTm9ybWFsTWF0cml4IHx8IF9ub3JtYWxNYXRyaXguZ2V0Tm9ybWFsTWF0cml4KCBtYXRyaXggKTsKCgkJY29uc3QgcmVmZXJlbmNlUG9pbnQgPSB0aGlzLmNvcGxhbmFyUG9pbnQoIF92ZWN0b3IxICkuYXBwbHlNYXRyaXg0KCBtYXRyaXggKTsKCgkJY29uc3Qgbm9ybWFsID0gdGhpcy5ub3JtYWwuYXBwbHlNYXRyaXgzKCBub3JtYWxNYXRyaXggKS5ub3JtYWxpemUoKTsKCgkJdGhpcy5jb25zdGFudCA9IC0gcmVmZXJlbmNlUG9pbnQuZG90KCBub3JtYWwgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRyYW5zbGF0ZSggb2Zmc2V0ICkgewoKCQl0aGlzLmNvbnN0YW50IC09IG9mZnNldC5kb3QoIHRoaXMubm9ybWFsICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgllcXVhbHMoIHBsYW5lICkgewoKCQlyZXR1cm4gcGxhbmUubm9ybWFsLmVxdWFscyggdGhpcy5ub3JtYWwgKSAmJiAoIHBsYW5lLmNvbnN0YW50ID09PSB0aGlzLmNvbnN0YW50ICk7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJfQoKfQoKY29uc3QgX3NwaGVyZSQ0ID0gLypAX19QVVJFX18qLyBuZXcgU3BoZXJlKCk7CmNvbnN0IF92ZWN0b3IkNiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNsYXNzIEZydXN0dW0gewoKCWNvbnN0cnVjdG9yKCBwMCA9IG5ldyBQbGFuZSgpLCBwMSA9IG5ldyBQbGFuZSgpLCBwMiA9IG5ldyBQbGFuZSgpLCBwMyA9IG5ldyBQbGFuZSgpLCBwNCA9IG5ldyBQbGFuZSgpLCBwNSA9IG5ldyBQbGFuZSgpICkgewoKCQl0aGlzLnBsYW5lcyA9IFsgcDAsIHAxLCBwMiwgcDMsIHA0LCBwNSBdOwoKCX0KCglzZXQoIHAwLCBwMSwgcDIsIHAzLCBwNCwgcDUgKSB7CgoJCWNvbnN0IHBsYW5lcyA9IHRoaXMucGxhbmVzOwoKCQlwbGFuZXNbIDAgXS5jb3B5KCBwMCApOwoJCXBsYW5lc1sgMSBdLmNvcHkoIHAxICk7CgkJcGxhbmVzWyAyIF0uY29weSggcDIgKTsKCQlwbGFuZXNbIDMgXS5jb3B5KCBwMyApOwoJCXBsYW5lc1sgNCBdLmNvcHkoIHA0ICk7CgkJcGxhbmVzWyA1IF0uY29weSggcDUgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvcHkoIGZydXN0dW0gKSB7CgoJCWNvbnN0IHBsYW5lcyA9IHRoaXMucGxhbmVzOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKCQkJcGxhbmVzWyBpIF0uY29weSggZnJ1c3R1bS5wbGFuZXNbIGkgXSApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRGcm9tUHJvamVjdGlvbk1hdHJpeCggbSwgY29vcmRpbmF0ZVN5c3RlbSA9IFdlYkdMQ29vcmRpbmF0ZVN5c3RlbSApIHsKCgkJY29uc3QgcGxhbmVzID0gdGhpcy5wbGFuZXM7CgkJY29uc3QgbWUgPSBtLmVsZW1lbnRzOwoJCWNvbnN0IG1lMCA9IG1lWyAwIF0sIG1lMSA9IG1lWyAxIF0sIG1lMiA9IG1lWyAyIF0sIG1lMyA9IG1lWyAzIF07CgkJY29uc3QgbWU0ID0gbWVbIDQgXSwgbWU1ID0gbWVbIDUgXSwgbWU2ID0gbWVbIDYgXSwgbWU3ID0gbWVbIDcgXTsKCQljb25zdCBtZTggPSBtZVsgOCBdLCBtZTkgPSBtZVsgOSBdLCBtZTEwID0gbWVbIDEwIF0sIG1lMTEgPSBtZVsgMTEgXTsKCQljb25zdCBtZTEyID0gbWVbIDEyIF0sIG1lMTMgPSBtZVsgMTMgXSwgbWUxNCA9IG1lWyAxNCBdLCBtZTE1ID0gbWVbIDE1IF07CgoJCXBsYW5lc1sgMCBdLnNldENvbXBvbmVudHMoIG1lMyAtIG1lMCwgbWU3IC0gbWU0LCBtZTExIC0gbWU4LCBtZTE1IC0gbWUxMiApLm5vcm1hbGl6ZSgpOwoJCXBsYW5lc1sgMSBdLnNldENvbXBvbmVudHMoIG1lMyArIG1lMCwgbWU3ICsgbWU0LCBtZTExICsgbWU4LCBtZTE1ICsgbWUxMiApLm5vcm1hbGl6ZSgpOwoJCXBsYW5lc1sgMiBdLnNldENvbXBvbmVudHMoIG1lMyArIG1lMSwgbWU3ICsgbWU1LCBtZTExICsgbWU5LCBtZTE1ICsgbWUxMyApLm5vcm1hbGl6ZSgpOwoJCXBsYW5lc1sgMyBdLnNldENvbXBvbmVudHMoIG1lMyAtIG1lMSwgbWU3IC0gbWU1LCBtZTExIC0gbWU5LCBtZTE1IC0gbWUxMyApLm5vcm1hbGl6ZSgpOwoJCXBsYW5lc1sgNCBdLnNldENvbXBvbmVudHMoIG1lMyAtIG1lMiwgbWU3IC0gbWU2LCBtZTExIC0gbWUxMCwgbWUxNSAtIG1lMTQgKS5ub3JtYWxpemUoKTsKCgkJaWYgKCBjb29yZGluYXRlU3lzdGVtID09PSBXZWJHTENvb3JkaW5hdGVTeXN0ZW0gKSB7CgoJCQlwbGFuZXNbIDUgXS5zZXRDb21wb25lbnRzKCBtZTMgKyBtZTIsIG1lNyArIG1lNiwgbWUxMSArIG1lMTAsIG1lMTUgKyBtZTE0ICkubm9ybWFsaXplKCk7CgoJCX0gZWxzZSBpZiAoIGNvb3JkaW5hdGVTeXN0ZW0gPT09IFdlYkdQVUNvb3JkaW5hdGVTeXN0ZW0gKSB7CgoJCQlwbGFuZXNbIDUgXS5zZXRDb21wb25lbnRzKCBtZTIsIG1lNiwgbWUxMCwgbWUxNCApLm5vcm1hbGl6ZSgpOwoKCQl9IGVsc2UgewoKCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuRnJ1c3R1bS5zZXRGcm9tUHJvamVjdGlvbk1hdHJpeCgpOiBJbnZhbGlkIGNvb3JkaW5hdGUgc3lzdGVtOiAnICsgY29vcmRpbmF0ZVN5c3RlbSApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglpbnRlcnNlY3RzT2JqZWN0KCBvYmplY3QgKSB7CgoJCWlmICggb2JqZWN0LmJvdW5kaW5nU3BoZXJlICE9PSB1bmRlZmluZWQgKSB7CgoJCQlpZiAoIG9iamVjdC5ib3VuZGluZ1NwaGVyZSA9PT0gbnVsbCApIG9iamVjdC5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTsKCgkJCV9zcGhlcmUkNC5jb3B5KCBvYmplY3QuYm91bmRpbmdTcGhlcmUgKS5hcHBseU1hdHJpeDQoIG9iamVjdC5tYXRyaXhXb3JsZCApOwoKCQl9IGVsc2UgewoKCQkJY29uc3QgZ2VvbWV0cnkgPSBvYmplY3QuZ2VvbWV0cnk7CgoJCQlpZiAoIGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlID09PSBudWxsICkgZ2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgoJCQlfc3BoZXJlJDQuY29weSggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgKS5hcHBseU1hdHJpeDQoIG9iamVjdC5tYXRyaXhXb3JsZCApOwoKCQl9CgoJCXJldHVybiB0aGlzLmludGVyc2VjdHNTcGhlcmUoIF9zcGhlcmUkNCApOwoKCX0KCglpbnRlcnNlY3RzU3ByaXRlKCBzcHJpdGUgKSB7CgoJCV9zcGhlcmUkNC5jZW50ZXIuc2V0KCAwLCAwLCAwICk7CgkJX3NwaGVyZSQ0LnJhZGl1cyA9IDAuNzA3MTA2NzgxMTg2NTQ3NjsKCQlfc3BoZXJlJDQuYXBwbHlNYXRyaXg0KCBzcHJpdGUubWF0cml4V29ybGQgKTsKCgkJcmV0dXJuIHRoaXMuaW50ZXJzZWN0c1NwaGVyZSggX3NwaGVyZSQ0ICk7CgoJfQoKCWludGVyc2VjdHNTcGhlcmUoIHNwaGVyZSApIHsKCgkJY29uc3QgcGxhbmVzID0gdGhpcy5wbGFuZXM7CgkJY29uc3QgY2VudGVyID0gc3BoZXJlLmNlbnRlcjsKCQljb25zdCBuZWdSYWRpdXMgPSAtIHNwaGVyZS5yYWRpdXM7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IDY7IGkgKysgKSB7CgoJCQljb25zdCBkaXN0YW5jZSA9IHBsYW5lc1sgaSBdLmRpc3RhbmNlVG9Qb2ludCggY2VudGVyICk7CgoJCQlpZiAoIGRpc3RhbmNlIDwgbmVnUmFkaXVzICkgewoKCQkJCXJldHVybiBmYWxzZTsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gdHJ1ZTsKCgl9CgoJaW50ZXJzZWN0c0JveCggYm94ICkgewoKCQljb25zdCBwbGFuZXMgPSB0aGlzLnBsYW5lczsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSArKyApIHsKCgkJCWNvbnN0IHBsYW5lID0gcGxhbmVzWyBpIF07CgoJCQkvLyBjb3JuZXIgYXQgbWF4IGRpc3RhbmNlCgoJCQlfdmVjdG9yJDYueCA9IHBsYW5lLm5vcm1hbC54ID4gMCA/IGJveC5tYXgueCA6IGJveC5taW4ueDsKCQkJX3ZlY3RvciQ2LnkgPSBwbGFuZS5ub3JtYWwueSA+IDAgPyBib3gubWF4LnkgOiBib3gubWluLnk7CgkJCV92ZWN0b3IkNi56ID0gcGxhbmUubm9ybWFsLnogPiAwID8gYm94Lm1heC56IDogYm94Lm1pbi56OwoKCQkJaWYgKCBwbGFuZS5kaXN0YW5jZVRvUG9pbnQoIF92ZWN0b3IkNiApIDwgMCApIHsKCgkJCQlyZXR1cm4gZmFsc2U7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHRydWU7CgoJfQoKCWNvbnRhaW5zUG9pbnQoIHBvaW50ICkgewoKCQljb25zdCBwbGFuZXMgPSB0aGlzLnBsYW5lczsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSArKyApIHsKCgkJCWlmICggcGxhbmVzWyBpIF0uZGlzdGFuY2VUb1BvaW50KCBwb2ludCApIDwgMCApIHsKCgkJCQlyZXR1cm4gZmFsc2U7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHRydWU7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJfQoKfQoKZnVuY3Rpb24gV2ViR0xBbmltYXRpb24oKSB7CgoJbGV0IGNvbnRleHQgPSBudWxsOwoJbGV0IGlzQW5pbWF0aW5nID0gZmFsc2U7CglsZXQgYW5pbWF0aW9uTG9vcCA9IG51bGw7CglsZXQgcmVxdWVzdElkID0gbnVsbDsKCglmdW5jdGlvbiBvbkFuaW1hdGlvbkZyYW1lKCB0aW1lLCBmcmFtZSApIHsKCgkJYW5pbWF0aW9uTG9vcCggdGltZSwgZnJhbWUgKTsKCgkJcmVxdWVzdElkID0gY29udGV4dC5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoIG9uQW5pbWF0aW9uRnJhbWUgKTsKCgl9CgoJcmV0dXJuIHsKCgkJc3RhcnQ6IGZ1bmN0aW9uICgpIHsKCgkJCWlmICggaXNBbmltYXRpbmcgPT09IHRydWUgKSByZXR1cm47CgkJCWlmICggYW5pbWF0aW9uTG9vcCA9PT0gbnVsbCApIHJldHVybjsKCgkJCXJlcXVlc3RJZCA9IGNvbnRleHQucmVxdWVzdEFuaW1hdGlvbkZyYW1lKCBvbkFuaW1hdGlvbkZyYW1lICk7CgoJCQlpc0FuaW1hdGluZyA9IHRydWU7CgoJCX0sCgoJCXN0b3A6IGZ1bmN0aW9uICgpIHsKCgkJCWNvbnRleHQuY2FuY2VsQW5pbWF0aW9uRnJhbWUoIHJlcXVlc3RJZCApOwoKCQkJaXNBbmltYXRpbmcgPSBmYWxzZTsKCgkJfSwKCgkJc2V0QW5pbWF0aW9uTG9vcDogZnVuY3Rpb24gKCBjYWxsYmFjayApIHsKCgkJCWFuaW1hdGlvbkxvb3AgPSBjYWxsYmFjazsKCgkJfSwKCgkJc2V0Q29udGV4dDogZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCWNvbnRleHQgPSB2YWx1ZTsKCgkJfQoKCX07Cgp9CgpmdW5jdGlvbiBXZWJHTEF0dHJpYnV0ZXMoIGdsLCBjYXBhYmlsaXRpZXMgKSB7CgoJY29uc3QgaXNXZWJHTDIgPSBjYXBhYmlsaXRpZXMuaXNXZWJHTDI7CgoJY29uc3QgYnVmZmVycyA9IG5ldyBXZWFrTWFwKCk7CgoJZnVuY3Rpb24gY3JlYXRlQnVmZmVyKCBhdHRyaWJ1dGUsIGJ1ZmZlclR5cGUgKSB7CgoJCWNvbnN0IGFycmF5ID0gYXR0cmlidXRlLmFycmF5OwoJCWNvbnN0IHVzYWdlID0gYXR0cmlidXRlLnVzYWdlOwoKCQljb25zdCBidWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTsKCgkJZ2wuYmluZEJ1ZmZlciggYnVmZmVyVHlwZSwgYnVmZmVyICk7CgkJZ2wuYnVmZmVyRGF0YSggYnVmZmVyVHlwZSwgYXJyYXksIHVzYWdlICk7CgoJCWF0dHJpYnV0ZS5vblVwbG9hZENhbGxiYWNrKCk7CgoJCWxldCB0eXBlOwoKCQlpZiAoIGFycmF5IGluc3RhbmNlb2YgRmxvYXQzMkFycmF5ICkgewoKCQkJdHlwZSA9IGdsLkZMT0FUOwoKCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIFVpbnQxNkFycmF5ICkgewoKCQkJaWYgKCBhdHRyaWJ1dGUuaXNGbG9hdDE2QnVmZmVyQXR0cmlidXRlICkgewoKCQkJCWlmICggaXNXZWJHTDIgKSB7CgoJCQkJCXR5cGUgPSBnbC5IQUxGX0ZMT0FUOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXRocm93IG5ldyBFcnJvciggJ1RIUkVFLldlYkdMQXR0cmlidXRlczogVXNhZ2Ugb2YgRmxvYXQxNkJ1ZmZlckF0dHJpYnV0ZSByZXF1aXJlcyBXZWJHTDIuJyApOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJdHlwZSA9IGdsLlVOU0lHTkVEX1NIT1JUOwoKCQkJfQoKCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIEludDE2QXJyYXkgKSB7CgoJCQl0eXBlID0gZ2wuU0hPUlQ7CgoJCX0gZWxzZSBpZiAoIGFycmF5IGluc3RhbmNlb2YgVWludDMyQXJyYXkgKSB7CgoJCQl0eXBlID0gZ2wuVU5TSUdORURfSU5UOwoKCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIEludDMyQXJyYXkgKSB7CgoJCQl0eXBlID0gZ2wuSU5UOwoKCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIEludDhBcnJheSApIHsKCgkJCXR5cGUgPSBnbC5CWVRFOwoKCQl9IGVsc2UgaWYgKCBhcnJheSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkgKSB7CgoJCQl0eXBlID0gZ2wuVU5TSUdORURfQllURTsKCgkJfSBlbHNlIGlmICggYXJyYXkgaW5zdGFuY2VvZiBVaW50OENsYW1wZWRBcnJheSApIHsKCgkJCXR5cGUgPSBnbC5VTlNJR05FRF9CWVRFOwoKCQl9IGVsc2UgewoKCQkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuV2ViR0xBdHRyaWJ1dGVzOiBVbnN1cHBvcnRlZCBidWZmZXIgZGF0YSBmb3JtYXQ6ICcgKyBhcnJheSApOwoKCQl9CgoJCXJldHVybiB7CgkJCWJ1ZmZlcjogYnVmZmVyLAoJCQl0eXBlOiB0eXBlLAoJCQlieXRlc1BlckVsZW1lbnQ6IGFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULAoJCQl2ZXJzaW9uOiBhdHRyaWJ1dGUudmVyc2lvbgoJCX07CgoJfQoKCWZ1bmN0aW9uIHVwZGF0ZUJ1ZmZlciggYnVmZmVyLCBhdHRyaWJ1dGUsIGJ1ZmZlclR5cGUgKSB7CgoJCWNvbnN0IGFycmF5ID0gYXR0cmlidXRlLmFycmF5OwoJCWNvbnN0IHVwZGF0ZVJhbmdlID0gYXR0cmlidXRlLnVwZGF0ZVJhbmdlOwoKCQlnbC5iaW5kQnVmZmVyKCBidWZmZXJUeXBlLCBidWZmZXIgKTsKCgkJaWYgKCB1cGRhdGVSYW5nZS5jb3VudCA9PT0gLSAxICkgewoKCQkJLy8gTm90IHVzaW5nIHVwZGF0ZSByYW5nZXMKCgkJCWdsLmJ1ZmZlclN1YkRhdGEoIGJ1ZmZlclR5cGUsIDAsIGFycmF5ICk7CgoJCX0gZWxzZSB7CgoJCQlpZiAoIGlzV2ViR0wyICkgewoKCQkJCWdsLmJ1ZmZlclN1YkRhdGEoIGJ1ZmZlclR5cGUsIHVwZGF0ZVJhbmdlLm9mZnNldCAqIGFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULAoJCQkJCWFycmF5LCB1cGRhdGVSYW5nZS5vZmZzZXQsIHVwZGF0ZVJhbmdlLmNvdW50ICk7CgoJCQl9IGVsc2UgewoKCQkJCWdsLmJ1ZmZlclN1YkRhdGEoIGJ1ZmZlclR5cGUsIHVwZGF0ZVJhbmdlLm9mZnNldCAqIGFycmF5LkJZVEVTX1BFUl9FTEVNRU5ULAoJCQkJCWFycmF5LnN1YmFycmF5KCB1cGRhdGVSYW5nZS5vZmZzZXQsIHVwZGF0ZVJhbmdlLm9mZnNldCArIHVwZGF0ZVJhbmdlLmNvdW50ICkgKTsKCgkJCX0KCgkJCXVwZGF0ZVJhbmdlLmNvdW50ID0gLSAxOyAvLyByZXNldCByYW5nZQoKCQl9CgoJCWF0dHJpYnV0ZS5vblVwbG9hZENhbGxiYWNrKCk7CgoJfQoKCS8vCgoJZnVuY3Rpb24gZ2V0KCBhdHRyaWJ1dGUgKSB7CgoJCWlmICggYXR0cmlidXRlLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUgKSBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGUuZGF0YTsKCgkJcmV0dXJuIGJ1ZmZlcnMuZ2V0KCBhdHRyaWJ1dGUgKTsKCgl9CgoJZnVuY3Rpb24gcmVtb3ZlKCBhdHRyaWJ1dGUgKSB7CgoJCWlmICggYXR0cmlidXRlLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUgKSBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGUuZGF0YTsKCgkJY29uc3QgZGF0YSA9IGJ1ZmZlcnMuZ2V0KCBhdHRyaWJ1dGUgKTsKCgkJaWYgKCBkYXRhICkgewoKCQkJZ2wuZGVsZXRlQnVmZmVyKCBkYXRhLmJ1ZmZlciApOwoKCQkJYnVmZmVycy5kZWxldGUoIGF0dHJpYnV0ZSApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHVwZGF0ZSggYXR0cmlidXRlLCBidWZmZXJUeXBlICkgewoKCQlpZiAoIGF0dHJpYnV0ZS5pc0dMQnVmZmVyQXR0cmlidXRlICkgewoKCQkJY29uc3QgY2FjaGVkID0gYnVmZmVycy5nZXQoIGF0dHJpYnV0ZSApOwoKCQkJaWYgKCAhIGNhY2hlZCB8fCBjYWNoZWQudmVyc2lvbiA8IGF0dHJpYnV0ZS52ZXJzaW9uICkgewoKCQkJCWJ1ZmZlcnMuc2V0KCBhdHRyaWJ1dGUsIHsKCQkJCQlidWZmZXI6IGF0dHJpYnV0ZS5idWZmZXIsCgkJCQkJdHlwZTogYXR0cmlidXRlLnR5cGUsCgkJCQkJYnl0ZXNQZXJFbGVtZW50OiBhdHRyaWJ1dGUuZWxlbWVudFNpemUsCgkJCQkJdmVyc2lvbjogYXR0cmlidXRlLnZlcnNpb24KCQkJCX0gKTsKCgkJCX0KCgkJCXJldHVybjsKCgkJfQoKCQlpZiAoIGF0dHJpYnV0ZS5pc0ludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlICkgYXR0cmlidXRlID0gYXR0cmlidXRlLmRhdGE7CgoJCWNvbnN0IGRhdGEgPSBidWZmZXJzLmdldCggYXR0cmlidXRlICk7CgoJCWlmICggZGF0YSA9PT0gdW5kZWZpbmVkICkgewoKCQkJYnVmZmVycy5zZXQoIGF0dHJpYnV0ZSwgY3JlYXRlQnVmZmVyKCBhdHRyaWJ1dGUsIGJ1ZmZlclR5cGUgKSApOwoKCQl9IGVsc2UgaWYgKCBkYXRhLnZlcnNpb24gPCBhdHRyaWJ1dGUudmVyc2lvbiApIHsKCgkJCXVwZGF0ZUJ1ZmZlciggZGF0YS5idWZmZXIsIGF0dHJpYnV0ZSwgYnVmZmVyVHlwZSApOwoKCQkJZGF0YS52ZXJzaW9uID0gYXR0cmlidXRlLnZlcnNpb247CgoJCX0KCgl9CgoJcmV0dXJuIHsKCgkJZ2V0OiBnZXQsCgkJcmVtb3ZlOiByZW1vdmUsCgkJdXBkYXRlOiB1cGRhdGUKCgl9OwoKfQoKY2xhc3MgUGxhbmVHZW9tZXRyeSBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKCgljb25zdHJ1Y3Rvciggd2lkdGggPSAxLCBoZWlnaHQgPSAxLCB3aWR0aFNlZ21lbnRzID0gMSwgaGVpZ2h0U2VnbWVudHMgPSAxICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLnR5cGUgPSAnUGxhbmVHZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJd2lkdGg6IHdpZHRoLAoJCQloZWlnaHQ6IGhlaWdodCwKCQkJd2lkdGhTZWdtZW50czogd2lkdGhTZWdtZW50cywKCQkJaGVpZ2h0U2VnbWVudHM6IGhlaWdodFNlZ21lbnRzCgkJfTsKCgkJY29uc3Qgd2lkdGhfaGFsZiA9IHdpZHRoIC8gMjsKCQljb25zdCBoZWlnaHRfaGFsZiA9IGhlaWdodCAvIDI7CgoJCWNvbnN0IGdyaWRYID0gTWF0aC5mbG9vciggd2lkdGhTZWdtZW50cyApOwoJCWNvbnN0IGdyaWRZID0gTWF0aC5mbG9vciggaGVpZ2h0U2VnbWVudHMgKTsKCgkJY29uc3QgZ3JpZFgxID0gZ3JpZFggKyAxOwoJCWNvbnN0IGdyaWRZMSA9IGdyaWRZICsgMTsKCgkJY29uc3Qgc2VnbWVudF93aWR0aCA9IHdpZHRoIC8gZ3JpZFg7CgkJY29uc3Qgc2VnbWVudF9oZWlnaHQgPSBoZWlnaHQgLyBncmlkWTsKCgkJLy8KCgkJY29uc3QgaW5kaWNlcyA9IFtdOwoJCWNvbnN0IHZlcnRpY2VzID0gW107CgkJY29uc3Qgbm9ybWFscyA9IFtdOwoJCWNvbnN0IHV2cyA9IFtdOwoKCQlmb3IgKCBsZXQgaXkgPSAwOyBpeSA8IGdyaWRZMTsgaXkgKysgKSB7CgoJCQljb25zdCB5ID0gaXkgKiBzZWdtZW50X2hlaWdodCAtIGhlaWdodF9oYWxmOwoKCQkJZm9yICggbGV0IGl4ID0gMDsgaXggPCBncmlkWDE7IGl4ICsrICkgewoKCQkJCWNvbnN0IHggPSBpeCAqIHNlZ21lbnRfd2lkdGggLSB3aWR0aF9oYWxmOwoKCQkJCXZlcnRpY2VzLnB1c2goIHgsIC0geSwgMCApOwoKCQkJCW5vcm1hbHMucHVzaCggMCwgMCwgMSApOwoKCQkJCXV2cy5wdXNoKCBpeCAvIGdyaWRYICk7CgkJCQl1dnMucHVzaCggMSAtICggaXkgLyBncmlkWSApICk7CgoJCQl9CgoJCX0KCgkJZm9yICggbGV0IGl5ID0gMDsgaXkgPCBncmlkWTsgaXkgKysgKSB7CgoJCQlmb3IgKCBsZXQgaXggPSAwOyBpeCA8IGdyaWRYOyBpeCArKyApIHsKCgkJCQljb25zdCBhID0gaXggKyBncmlkWDEgKiBpeTsKCQkJCWNvbnN0IGIgPSBpeCArIGdyaWRYMSAqICggaXkgKyAxICk7CgkJCQljb25zdCBjID0gKCBpeCArIDEgKSArIGdyaWRYMSAqICggaXkgKyAxICk7CgkJCQljb25zdCBkID0gKCBpeCArIDEgKSArIGdyaWRYMSAqIGl5OwoKCQkJCWluZGljZXMucHVzaCggYSwgYiwgZCApOwoJCQkJaW5kaWNlcy5wdXNoKCBiLCBjLCBkICk7CgoJCQl9CgoJCX0KCgkJdGhpcy5zZXRJbmRleCggaW5kaWNlcyApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAnbm9ybWFsJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbHMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAndXYnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdXZzLCAyICkgKTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5wYXJhbWV0ZXJzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzdGF0aWMgZnJvbUpTT04oIGRhdGEgKSB7CgoJCXJldHVybiBuZXcgUGxhbmVHZW9tZXRyeSggZGF0YS53aWR0aCwgZGF0YS5oZWlnaHQsIGRhdGEud2lkdGhTZWdtZW50cywgZGF0YS5oZWlnaHRTZWdtZW50cyApOwoKCX0KCn0KCnZhciBhbHBoYWhhc2hfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9BTFBIQUhBU0hcblx0aWYgKCBkaWZmdXNlQ29sb3IuYSA8IGdldEFscGhhSGFzaFRocmVzaG9sZCggdlBvc2l0aW9uICkgKSBkaXNjYXJkO1xuI2VuZGlmIjsKCnZhciBhbHBoYWhhc2hfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FMUEhBSEFTSFxuXHRjb25zdCBmbG9hdCBBTFBIQV9IQVNIX1NDQUxFID0gMC4wNTtcblx0ZmxvYXQgaGFzaDJEKCB2ZWMyIHZhbHVlICkge1xuXHRcdHJldHVybiBmcmFjdCggMS4wZTQgKiBzaW4oIDE3LjAgKiB2YWx1ZS54ICsgMC4xICogdmFsdWUueSApICogKCAwLjEgKyBhYnMoIHNpbiggMTMuMCAqIHZhbHVlLnkgKyB2YWx1ZS54ICkgKSApICk7XG5cdH1cblx0ZmxvYXQgaGFzaDNEKCB2ZWMzIHZhbHVlICkge1xuXHRcdHJldHVybiBoYXNoMkQoIHZlYzIoIGhhc2gyRCggdmFsdWUueHkgKSwgdmFsdWUueiApICk7XG5cdH1cblx0ZmxvYXQgZ2V0QWxwaGFIYXNoVGhyZXNob2xkKCB2ZWMzIHBvc2l0aW9uICkge1xuXHRcdGZsb2F0IG1heERlcml2ID0gbWF4KFxuXHRcdFx0bGVuZ3RoKCBkRmR4KCBwb3NpdGlvbi54eXogKSApLFxuXHRcdFx0bGVuZ3RoKCBkRmR5KCBwb3NpdGlvbi54eXogKSApXG5cdFx0KTtcblx0XHRmbG9hdCBwaXhTY2FsZSA9IDEuMCAvICggQUxQSEFfSEFTSF9TQ0FMRSAqIG1heERlcml2ICk7XG5cdFx0dmVjMiBwaXhTY2FsZXMgPSB2ZWMyKFxuXHRcdFx0ZXhwMiggZmxvb3IoIGxvZzIoIHBpeFNjYWxlICkgKSApLFxuXHRcdFx0ZXhwMiggY2VpbCggbG9nMiggcGl4U2NhbGUgKSApIClcblx0XHQpO1xuXHRcdHZlYzIgYWxwaGEgPSB2ZWMyKFxuXHRcdFx0aGFzaDNEKCBmbG9vciggcGl4U2NhbGVzLnggKiBwb3NpdGlvbi54eXogKSApLFxuXHRcdFx0aGFzaDNEKCBmbG9vciggcGl4U2NhbGVzLnkgKiBwb3NpdGlvbi54eXogKSApXG5cdFx0KTtcblx0XHRmbG9hdCBsZXJwRmFjdG9yID0gZnJhY3QoIGxvZzIoIHBpeFNjYWxlICkgKTtcblx0XHRmbG9hdCB4ID0gKCAxLjAgLSBsZXJwRmFjdG9yICkgKiBhbHBoYS54ICsgbGVycEZhY3RvciAqIGFscGhhLnk7XG5cdFx0ZmxvYXQgYSA9IG1pbiggbGVycEZhY3RvciwgMS4wIC0gbGVycEZhY3RvciApO1xuXHRcdHZlYzMgY2FzZXMgPSB2ZWMzKFxuXHRcdFx0eCAqIHggLyAoIDIuMCAqIGEgKiAoIDEuMCAtIGEgKSApLFxuXHRcdFx0KCB4IC0gMC41ICogYSApIC8gKCAxLjAgLSBhICksXG5cdFx0XHQxLjAgLSAoICggMS4wIC0geCApICogKCAxLjAgLSB4ICkgLyAoIDIuMCAqIGEgKiAoIDEuMCAtIGEgKSApIClcblx0XHQpO1xuXHRcdGZsb2F0IHRocmVzaG9sZCA9ICggeCA8ICggMS4wIC0gYSApIClcblx0XHRcdD8gKCAoIHggPCBhICkgPyBjYXNlcy54IDogY2FzZXMueSApXG5cdFx0XHQ6IGNhc2VzLno7XG5cdFx0cmV0dXJuIGNsYW1wKCB0aHJlc2hvbGQgLCAxLjBlLTYsIDEuMCApO1xuXHR9XG4jZW5kaWYiOwoKdmFyIGFscGhhbWFwX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfQUxQSEFNQVBcblx0ZGlmZnVzZUNvbG9yLmEgKj0gdGV4dHVyZTJEKCBhbHBoYU1hcCwgdkFscGhhTWFwVXYgKS5nO1xuI2VuZGlmIjsKCnZhciBhbHBoYW1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfQUxQSEFNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgYWxwaGFNYXA7XG4jZW5kaWYiOwoKdmFyIGFscGhhdGVzdF9mcmFnbWVudCA9ICIjaWZkZWYgVVNFX0FMUEhBVEVTVFxuXHRpZiAoIGRpZmZ1c2VDb2xvci5hIDwgYWxwaGFUZXN0ICkgZGlzY2FyZDtcbiNlbmRpZiI7Cgp2YXIgYWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9BTFBIQVRFU1Rcblx0dW5pZm9ybSBmbG9hdCBhbHBoYVRlc3Q7XG4jZW5kaWYiOwoKdmFyIGFvbWFwX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfQU9NQVBcblx0ZmxvYXQgYW1iaWVudE9jY2x1c2lvbiA9ICggdGV4dHVyZTJEKCBhb01hcCwgdkFvTWFwVXYgKS5yIC0gMS4wICkgKiBhb01hcEludGVuc2l0eSArIDEuMDtcblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICo9IGFtYmllbnRPY2NsdXNpb247XG5cdCNpZiBkZWZpbmVkKCBVU0VfRU5WTUFQICkgJiYgZGVmaW5lZCggU1RBTkRBUkQgKVxuXHRcdGZsb2F0IGRvdE5WID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnlOb3JtYWwsIGdlb21ldHJ5Vmlld0RpciApICk7XG5cdFx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhciAqPSBjb21wdXRlU3BlY3VsYXJPY2NsdXNpb24oIGRvdE5WLCBhbWJpZW50T2NjbHVzaW9uLCBtYXRlcmlhbC5yb3VnaG5lc3MgKTtcblx0I2VuZGlmXG4jZW5kaWYiOwoKdmFyIGFvbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9BT01BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBhb01hcDtcblx0dW5pZm9ybSBmbG9hdCBhb01hcEludGVuc2l0eTtcbiNlbmRpZiI7Cgp2YXIgYmVnaW5fdmVydGV4ID0gInZlYzMgdHJhbnNmb3JtZWQgPSB2ZWMzKCBwb3NpdGlvbiApO1xuI2lmZGVmIFVTRV9BTFBIQUhBU0hcblx0dlBvc2l0aW9uID0gdmVjMyggcG9zaXRpb24gKTtcbiNlbmRpZiI7Cgp2YXIgYmVnaW5ub3JtYWxfdmVydGV4ID0gInZlYzMgb2JqZWN0Tm9ybWFsID0gdmVjMyggbm9ybWFsICk7XG4jaWZkZWYgVVNFX1RBTkdFTlRcblx0dmVjMyBvYmplY3RUYW5nZW50ID0gdmVjMyggdGFuZ2VudC54eXogKTtcbiNlbmRpZiI7Cgp2YXIgYnNkZnMgPSAiZmxvYXQgR19CbGlublBob25nX0ltcGxpY2l0KCApIHtcblx0cmV0dXJuIDAuMjU7XG59XG5mbG9hdCBEX0JsaW5uUGhvbmcoIGNvbnN0IGluIGZsb2F0IHNoaW5pbmVzcywgY29uc3QgaW4gZmxvYXQgZG90TkggKSB7XG5cdHJldHVybiBSRUNJUFJPQ0FMX1BJICogKCBzaGluaW5lc3MgKiAwLjUgKyAxLjAgKSAqIHBvdyggZG90TkgsIHNoaW5pbmVzcyApO1xufVxudmVjMyBCUkRGX0JsaW5uUGhvbmcoIGNvbnN0IGluIHZlYzMgbGlnaHREaXIsIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIHZlYzMgc3BlY3VsYXJDb2xvciwgY29uc3QgaW4gZmxvYXQgc2hpbmluZXNzICkge1xuXHR2ZWMzIGhhbGZEaXIgPSBub3JtYWxpemUoIGxpZ2h0RGlyICsgdmlld0RpciApO1xuXHRmbG9hdCBkb3ROSCA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgaGFsZkRpciApICk7XG5cdGZsb2F0IGRvdFZIID0gc2F0dXJhdGUoIGRvdCggdmlld0RpciwgaGFsZkRpciApICk7XG5cdHZlYzMgRiA9IEZfU2NobGljayggc3BlY3VsYXJDb2xvciwgMS4wLCBkb3RWSCApO1xuXHRmbG9hdCBHID0gR19CbGlublBob25nX0ltcGxpY2l0KCApO1xuXHRmbG9hdCBEID0gRF9CbGlublBob25nKCBzaGluaW5lc3MsIGRvdE5IICk7XG5cdHJldHVybiBGICogKCBHICogRCApO1xufSAvLyB2YWxpZGF0ZWQiOwoKdmFyIGlyaWRlc2NlbmNlX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0Vcblx0Y29uc3QgbWF0MyBYWVpfVE9fUkVDNzA5ID0gbWF0Myhcblx0XHQgMy4yNDA0NTQyLCAtMC45NjkyNjYwLCAgMC4wNTU2NDM0LFxuXHRcdC0xLjUzNzEzODUsICAxLjg3NjAxMDgsIC0wLjIwNDAyNTksXG5cdFx0LTAuNDk4NTMxNCwgIDAuMDQxNTU2MCwgIDEuMDU3MjI1MlxuXHQpO1xuXHR2ZWMzIEZyZXNuZWwwVG9Jb3IoIHZlYzMgZnJlc25lbDAgKSB7XG5cdFx0dmVjMyBzcXJ0RjAgPSBzcXJ0KCBmcmVzbmVsMCApO1xuXHRcdHJldHVybiAoIHZlYzMoIDEuMCApICsgc3FydEYwICkgLyAoIHZlYzMoIDEuMCApIC0gc3FydEYwICk7XG5cdH1cblx0dmVjMyBJb3JUb0ZyZXNuZWwwKCB2ZWMzIHRyYW5zbWl0dGVkSW9yLCBmbG9hdCBpbmNpZGVudElvciApIHtcblx0XHRyZXR1cm4gcG93MiggKCB0cmFuc21pdHRlZElvciAtIHZlYzMoIGluY2lkZW50SW9yICkgKSAvICggdHJhbnNtaXR0ZWRJb3IgKyB2ZWMzKCBpbmNpZGVudElvciApICkgKTtcblx0fVxuXHRmbG9hdCBJb3JUb0ZyZXNuZWwwKCBmbG9hdCB0cmFuc21pdHRlZElvciwgZmxvYXQgaW5jaWRlbnRJb3IgKSB7XG5cdFx0cmV0dXJuIHBvdzIoICggdHJhbnNtaXR0ZWRJb3IgLSBpbmNpZGVudElvciApIC8gKCB0cmFuc21pdHRlZElvciArIGluY2lkZW50SW9yICkpO1xuXHR9XG5cdHZlYzMgZXZhbFNlbnNpdGl2aXR5KCBmbG9hdCBPUEQsIHZlYzMgc2hpZnQgKSB7XG5cdFx0ZmxvYXQgcGhhc2UgPSAyLjAgKiBQSSAqIE9QRCAqIDEuMGUtOTtcblx0XHR2ZWMzIHZhbCA9IHZlYzMoIDUuNDg1NmUtMTMsIDQuNDIwMWUtMTMsIDUuMjQ4MWUtMTMgKTtcblx0XHR2ZWMzIHBvcyA9IHZlYzMoIDEuNjgxMGUrMDYsIDEuNzk1M2UrMDYsIDIuMjA4NGUrMDYgKTtcblx0XHR2ZWMzIHZhciA9IHZlYzMoIDQuMzI3OGUrMDksIDkuMzA0NmUrMDksIDYuNjEyMWUrMDkgKTtcblx0XHR2ZWMzIHh5eiA9IHZhbCAqIHNxcnQoIDIuMCAqIFBJICogdmFyICkgKiBjb3MoIHBvcyAqIHBoYXNlICsgc2hpZnQgKSAqIGV4cCggLSBwb3cyKCBwaGFzZSApICogdmFyICk7XG5cdFx0eHl6LnggKz0gOS43NDcwZS0xNCAqIHNxcnQoIDIuMCAqIFBJICogNC41MjgyZSswOSApICogY29zKCAyLjIzOTllKzA2ICogcGhhc2UgKyBzaGlmdFsgMCBdICkgKiBleHAoIC0gNC41MjgyZSswOSAqIHBvdzIoIHBoYXNlICkgKTtcblx0XHR4eXogLz0gMS4wNjg1ZS03O1xuXHRcdHZlYzMgcmdiID0gWFlaX1RPX1JFQzcwOSAqIHh5ejtcblx0XHRyZXR1cm4gcmdiO1xuXHR9XG5cdHZlYzMgZXZhbElyaWRlc2NlbmNlKCBmbG9hdCBvdXRzaWRlSU9SLCBmbG9hdCBldGEyLCBmbG9hdCBjb3NUaGV0YTEsIGZsb2F0IHRoaW5GaWxtVGhpY2tuZXNzLCB2ZWMzIGJhc2VGMCApIHtcblx0XHR2ZWMzIEk7XG5cdFx0ZmxvYXQgaXJpZGVzY2VuY2VJT1IgPSBtaXgoIG91dHNpZGVJT1IsIGV0YTIsIHNtb290aHN0ZXAoIDAuMCwgMC4wMywgdGhpbkZpbG1UaGlja25lc3MgKSApO1xuXHRcdGZsb2F0IHNpblRoZXRhMlNxID0gcG93Miggb3V0c2lkZUlPUiAvIGlyaWRlc2NlbmNlSU9SICkgKiAoIDEuMCAtIHBvdzIoIGNvc1RoZXRhMSApICk7XG5cdFx0ZmxvYXQgY29zVGhldGEyU3EgPSAxLjAgLSBzaW5UaGV0YTJTcTtcblx0XHRpZiAoIGNvc1RoZXRhMlNxIDwgMC4wICkge1xuXHRcdFx0cmV0dXJuIHZlYzMoIDEuMCApO1xuXHRcdH1cblx0XHRmbG9hdCBjb3NUaGV0YTIgPSBzcXJ0KCBjb3NUaGV0YTJTcSApO1xuXHRcdGZsb2F0IFIwID0gSW9yVG9GcmVzbmVsMCggaXJpZGVzY2VuY2VJT1IsIG91dHNpZGVJT1IgKTtcblx0XHRmbG9hdCBSMTIgPSBGX1NjaGxpY2soIFIwLCAxLjAsIGNvc1RoZXRhMSApO1xuXHRcdGZsb2F0IFQxMjEgPSAxLjAgLSBSMTI7XG5cdFx0ZmxvYXQgcGhpMTIgPSAwLjA7XG5cdFx0aWYgKCBpcmlkZXNjZW5jZUlPUiA8IG91dHNpZGVJT1IgKSBwaGkxMiA9IFBJO1xuXHRcdGZsb2F0IHBoaTIxID0gUEkgLSBwaGkxMjtcblx0XHR2ZWMzIGJhc2VJT1IgPSBGcmVzbmVsMFRvSW9yKCBjbGFtcCggYmFzZUYwLCAwLjAsIDAuOTk5OSApICk7XHRcdHZlYzMgUjEgPSBJb3JUb0ZyZXNuZWwwKCBiYXNlSU9SLCBpcmlkZXNjZW5jZUlPUiApO1xuXHRcdHZlYzMgUjIzID0gRl9TY2hsaWNrKCBSMSwgMS4wLCBjb3NUaGV0YTIgKTtcblx0XHR2ZWMzIHBoaTIzID0gdmVjMyggMC4wICk7XG5cdFx0aWYgKCBiYXNlSU9SWyAwIF0gPCBpcmlkZXNjZW5jZUlPUiApIHBoaTIzWyAwIF0gPSBQSTtcblx0XHRpZiAoIGJhc2VJT1JbIDEgXSA8IGlyaWRlc2NlbmNlSU9SICkgcGhpMjNbIDEgXSA9IFBJO1xuXHRcdGlmICggYmFzZUlPUlsgMiBdIDwgaXJpZGVzY2VuY2VJT1IgKSBwaGkyM1sgMiBdID0gUEk7XG5cdFx0ZmxvYXQgT1BEID0gMi4wICogaXJpZGVzY2VuY2VJT1IgKiB0aGluRmlsbVRoaWNrbmVzcyAqIGNvc1RoZXRhMjtcblx0XHR2ZWMzIHBoaSA9IHZlYzMoIHBoaTIxICkgKyBwaGkyMztcblx0XHR2ZWMzIFIxMjMgPSBjbGFtcCggUjEyICogUjIzLCAxZS01LCAwLjk5OTkgKTtcblx0XHR2ZWMzIHIxMjMgPSBzcXJ0KCBSMTIzICk7XG5cdFx0dmVjMyBScyA9IHBvdzIoIFQxMjEgKSAqIFIyMyAvICggdmVjMyggMS4wICkgLSBSMTIzICk7XG5cdFx0dmVjMyBDMCA9IFIxMiArIFJzO1xuXHRcdEkgPSBDMDtcblx0XHR2ZWMzIENtID0gUnMgLSBUMTIxO1xuXHRcdGZvciAoIGludCBtID0gMTsgbSA8PSAyOyArKyBtICkge1xuXHRcdFx0Q20gKj0gcjEyMztcblx0XHRcdHZlYzMgU20gPSAyLjAgKiBldmFsU2Vuc2l0aXZpdHkoIGZsb2F0KCBtICkgKiBPUEQsIGZsb2F0KCBtICkgKiBwaGkgKTtcblx0XHRcdEkgKz0gQ20gKiBTbTtcblx0XHR9XG5cdFx0cmV0dXJuIG1heCggSSwgdmVjMyggMC4wICkgKTtcblx0fVxuI2VuZGlmIjsKCnZhciBidW1wbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9CVU1QTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGJ1bXBNYXA7XG5cdHVuaWZvcm0gZmxvYXQgYnVtcFNjYWxlO1xuXHR2ZWMyIGRIZHh5X2Z3ZCgpIHtcblx0XHR2ZWMyIGRTVGR4ID0gZEZkeCggdkJ1bXBNYXBVdiApO1xuXHRcdHZlYzIgZFNUZHkgPSBkRmR5KCB2QnVtcE1hcFV2ICk7XG5cdFx0ZmxvYXQgSGxsID0gYnVtcFNjYWxlICogdGV4dHVyZTJEKCBidW1wTWFwLCB2QnVtcE1hcFV2ICkueDtcblx0XHRmbG9hdCBkQnggPSBidW1wU2NhbGUgKiB0ZXh0dXJlMkQoIGJ1bXBNYXAsIHZCdW1wTWFwVXYgKyBkU1RkeCApLnggLSBIbGw7XG5cdFx0ZmxvYXQgZEJ5ID0gYnVtcFNjYWxlICogdGV4dHVyZTJEKCBidW1wTWFwLCB2QnVtcE1hcFV2ICsgZFNUZHkgKS54IC0gSGxsO1xuXHRcdHJldHVybiB2ZWMyKCBkQngsIGRCeSApO1xuXHR9XG5cdHZlYzMgcGVydHVyYk5vcm1hbEFyYiggdmVjMyBzdXJmX3BvcywgdmVjMyBzdXJmX25vcm0sIHZlYzIgZEhkeHksIGZsb2F0IGZhY2VEaXJlY3Rpb24gKSB7XG5cdFx0dmVjMyB2U2lnbWFYID0gZEZkeCggc3VyZl9wb3MueHl6ICk7XG5cdFx0dmVjMyB2U2lnbWFZID0gZEZkeSggc3VyZl9wb3MueHl6ICk7XG5cdFx0dmVjMyB2TiA9IHN1cmZfbm9ybTtcblx0XHR2ZWMzIFIxID0gY3Jvc3MoIHZTaWdtYVksIHZOICk7XG5cdFx0dmVjMyBSMiA9IGNyb3NzKCB2TiwgdlNpZ21hWCApO1xuXHRcdGZsb2F0IGZEZXQgPSBkb3QoIHZTaWdtYVgsIFIxICkgKiBmYWNlRGlyZWN0aW9uO1xuXHRcdHZlYzMgdkdyYWQgPSBzaWduKCBmRGV0ICkgKiAoIGRIZHh5LnggKiBSMSArIGRIZHh5LnkgKiBSMiApO1xuXHRcdHJldHVybiBub3JtYWxpemUoIGFicyggZkRldCApICogc3VyZl9ub3JtIC0gdkdyYWQgKTtcblx0fVxuI2VuZGlmIjsKCnZhciBjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQgPSAiI2lmIE5VTV9DTElQUElOR19QTEFORVMgPiAwXG5cdHZlYzQgcGxhbmU7XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgVU5JT05fQ0xJUFBJTkdfUExBTkVTOyBpICsrICkge1xuXHRcdHBsYW5lID0gY2xpcHBpbmdQbGFuZXNbIGkgXTtcblx0XHRpZiAoIGRvdCggdkNsaXBQb3NpdGlvbiwgcGxhbmUueHl6ICkgPiBwbGFuZS53ICkgZGlzY2FyZDtcblx0fVxuXHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHQjaWYgVU5JT05fQ0xJUFBJTkdfUExBTkVTIDwgTlVNX0NMSVBQSU5HX1BMQU5FU1xuXHRcdGJvb2wgY2xpcHBlZCA9IHRydWU7XG5cdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRcdGZvciAoIGludCBpID0gVU5JT05fQ0xJUFBJTkdfUExBTkVTOyBpIDwgTlVNX0NMSVBQSU5HX1BMQU5FUzsgaSArKyApIHtcblx0XHRcdHBsYW5lID0gY2xpcHBpbmdQbGFuZXNbIGkgXTtcblx0XHRcdGNsaXBwZWQgPSAoIGRvdCggdkNsaXBQb3NpdGlvbiwgcGxhbmUueHl6ICkgPiBwbGFuZS53ICkgJiYgY2xpcHBlZDtcblx0XHR9XG5cdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcblx0XHRpZiAoIGNsaXBwZWQgKSBkaXNjYXJkO1xuXHQjZW5kaWZcbiNlbmRpZiI7Cgp2YXIgY2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQgPSAiI2lmIE5VTV9DTElQUElOR19QTEFORVMgPiAwXG5cdHZhcnlpbmcgdmVjMyB2Q2xpcFBvc2l0aW9uO1xuXHR1bmlmb3JtIHZlYzQgY2xpcHBpbmdQbGFuZXNbIE5VTV9DTElQUElOR19QTEFORVMgXTtcbiNlbmRpZiI7Cgp2YXIgY2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4ID0gIiNpZiBOVU1fQ0xJUFBJTkdfUExBTkVTID4gMFxuXHR2YXJ5aW5nIHZlYzMgdkNsaXBQb3NpdGlvbjtcbiNlbmRpZiI7Cgp2YXIgY2xpcHBpbmdfcGxhbmVzX3ZlcnRleCA9ICIjaWYgTlVNX0NMSVBQSU5HX1BMQU5FUyA+IDBcblx0dkNsaXBQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7XG4jZW5kaWYiOwoKdmFyIGNvbG9yX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBVU0VfQ09MT1JfQUxQSEEgKVxuXHRkaWZmdXNlQ29sb3IgKj0gdkNvbG9yO1xuI2VsaWYgZGVmaW5lZCggVVNFX0NPTE9SIClcblx0ZGlmZnVzZUNvbG9yLnJnYiAqPSB2Q29sb3I7XG4jZW5kaWYiOwoKdmFyIGNvbG9yX3BhcnNfZnJhZ21lbnQgPSAiI2lmIGRlZmluZWQoIFVTRV9DT0xPUl9BTFBIQSApXG5cdHZhcnlpbmcgdmVjNCB2Q29sb3I7XG4jZWxpZiBkZWZpbmVkKCBVU0VfQ09MT1IgKVxuXHR2YXJ5aW5nIHZlYzMgdkNvbG9yO1xuI2VuZGlmIjsKCnZhciBjb2xvcl9wYXJzX3ZlcnRleCA9ICIjaWYgZGVmaW5lZCggVVNFX0NPTE9SX0FMUEhBIClcblx0dmFyeWluZyB2ZWM0IHZDb2xvcjtcbiNlbGlmIGRlZmluZWQoIFVTRV9DT0xPUiApIHx8IGRlZmluZWQoIFVTRV9JTlNUQU5DSU5HX0NPTE9SIClcblx0dmFyeWluZyB2ZWMzIHZDb2xvcjtcbiNlbmRpZiI7Cgp2YXIgY29sb3JfdmVydGV4ID0gIiNpZiBkZWZpbmVkKCBVU0VfQ09MT1JfQUxQSEEgKVxuXHR2Q29sb3IgPSB2ZWM0KCAxLjAgKTtcbiNlbGlmIGRlZmluZWQoIFVTRV9DT0xPUiApIHx8IGRlZmluZWQoIFVTRV9JTlNUQU5DSU5HX0NPTE9SIClcblx0dkNvbG9yID0gdmVjMyggMS4wICk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ09MT1Jcblx0dkNvbG9yICo9IGNvbG9yO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0lOU1RBTkNJTkdfQ09MT1Jcblx0dkNvbG9yLnh5eiAqPSBpbnN0YW5jZUNvbG9yLnh5ejtcbiNlbmRpZiI7Cgp2YXIgY29tbW9uID0gIiNkZWZpbmUgUEkgMy4xNDE1OTI2NTM1ODk3OTNcbiNkZWZpbmUgUEkyIDYuMjgzMTg1MzA3MTc5NTg2XG4jZGVmaW5lIFBJX0hBTEYgMS41NzA3OTYzMjY3OTQ4OTY2XG4jZGVmaW5lIFJFQ0lQUk9DQUxfUEkgMC4zMTgzMDk4ODYxODM3OTA3XG4jZGVmaW5lIFJFQ0lQUk9DQUxfUEkyIDAuMTU5MTU0OTQzMDkxODk1MzVcbiNkZWZpbmUgRVBTSUxPTiAxZS02XG4jaWZuZGVmIHNhdHVyYXRlXG4jZGVmaW5lIHNhdHVyYXRlKCBhICkgY2xhbXAoIGEsIDAuMCwgMS4wIClcbiNlbmRpZlxuI2RlZmluZSB3aGl0ZUNvbXBsZW1lbnQoIGEgKSAoIDEuMCAtIHNhdHVyYXRlKCBhICkgKVxuZmxvYXQgcG93MiggY29uc3QgaW4gZmxvYXQgeCApIHsgcmV0dXJuIHgqeDsgfVxudmVjMyBwb3cyKCBjb25zdCBpbiB2ZWMzIHggKSB7IHJldHVybiB4Kng7IH1cbmZsb2F0IHBvdzMoIGNvbnN0IGluIGZsb2F0IHggKSB7IHJldHVybiB4KngqeDsgfVxuZmxvYXQgcG93NCggY29uc3QgaW4gZmxvYXQgeCApIHsgZmxvYXQgeDIgPSB4Kng7IHJldHVybiB4Mip4MjsgfVxuZmxvYXQgbWF4MyggY29uc3QgaW4gdmVjMyB2ICkgeyByZXR1cm4gbWF4KCBtYXgoIHYueCwgdi55ICksIHYueiApOyB9XG5mbG9hdCBhdmVyYWdlKCBjb25zdCBpbiB2ZWMzIHYgKSB7IHJldHVybiBkb3QoIHYsIHZlYzMoIDAuMzMzMzMzMyApICk7IH1cbmhpZ2hwIGZsb2F0IHJhbmQoIGNvbnN0IGluIHZlYzIgdXYgKSB7XG5cdGNvbnN0IGhpZ2hwIGZsb2F0IGEgPSAxMi45ODk4LCBiID0gNzguMjMzLCBjID0gNDM3NTguNTQ1Mztcblx0aGlnaHAgZmxvYXQgZHQgPSBkb3QoIHV2Lnh5LCB2ZWMyKCBhLGIgKSApLCBzbiA9IG1vZCggZHQsIFBJICk7XG5cdHJldHVybiBmcmFjdCggc2luKCBzbiApICogYyApO1xufVxuI2lmZGVmIEhJR0hfUFJFQ0lTSU9OXG5cdGZsb2F0IHByZWNpc2lvblNhZmVMZW5ndGgoIHZlYzMgdiApIHsgcmV0dXJuIGxlbmd0aCggdiApOyB9XG4jZWxzZVxuXHRmbG9hdCBwcmVjaXNpb25TYWZlTGVuZ3RoKCB2ZWMzIHYgKSB7XG5cdFx0ZmxvYXQgbWF4Q29tcG9uZW50ID0gbWF4MyggYWJzKCB2ICkgKTtcblx0XHRyZXR1cm4gbGVuZ3RoKCB2IC8gbWF4Q29tcG9uZW50ICkgKiBtYXhDb21wb25lbnQ7XG5cdH1cbiNlbmRpZlxuc3RydWN0IEluY2lkZW50TGlnaHQge1xuXHR2ZWMzIGNvbG9yO1xuXHR2ZWMzIGRpcmVjdGlvbjtcblx0Ym9vbCB2aXNpYmxlO1xufTtcbnN0cnVjdCBSZWZsZWN0ZWRMaWdodCB7XG5cdHZlYzMgZGlyZWN0RGlmZnVzZTtcblx0dmVjMyBkaXJlY3RTcGVjdWxhcjtcblx0dmVjMyBpbmRpcmVjdERpZmZ1c2U7XG5cdHZlYzMgaW5kaXJlY3RTcGVjdWxhcjtcbn07XG4jaWZkZWYgVVNFX0FMUEhBSEFTSFxuXHR2YXJ5aW5nIHZlYzMgdlBvc2l0aW9uO1xuI2VuZGlmXG52ZWMzIHRyYW5zZm9ybURpcmVjdGlvbiggaW4gdmVjMyBkaXIsIGluIG1hdDQgbWF0cml4ICkge1xuXHRyZXR1cm4gbm9ybWFsaXplKCAoIG1hdHJpeCAqIHZlYzQoIGRpciwgMC4wICkgKS54eXogKTtcbn1cbnZlYzMgaW52ZXJzZVRyYW5zZm9ybURpcmVjdGlvbiggaW4gdmVjMyBkaXIsIGluIG1hdDQgbWF0cml4ICkge1xuXHRyZXR1cm4gbm9ybWFsaXplKCAoIHZlYzQoIGRpciwgMC4wICkgKiBtYXRyaXggKS54eXogKTtcbn1cbm1hdDMgdHJhbnNwb3NlTWF0MyggY29uc3QgaW4gbWF0MyBtICkge1xuXHRtYXQzIHRtcDtcblx0dG1wWyAwIF0gPSB2ZWMzKCBtWyAwIF0ueCwgbVsgMSBdLngsIG1bIDIgXS54ICk7XG5cdHRtcFsgMSBdID0gdmVjMyggbVsgMCBdLnksIG1bIDEgXS55LCBtWyAyIF0ueSApO1xuXHR0bXBbIDIgXSA9IHZlYzMoIG1bIDAgXS56LCBtWyAxIF0ueiwgbVsgMiBdLnogKTtcblx0cmV0dXJuIHRtcDtcbn1cbmZsb2F0IGx1bWluYW5jZSggY29uc3QgaW4gdmVjMyByZ2IgKSB7XG5cdGNvbnN0IHZlYzMgd2VpZ2h0cyA9IHZlYzMoIDAuMjEyNjcyOSwgMC43MTUxNTIyLCAwLjA3MjE3NTAgKTtcblx0cmV0dXJuIGRvdCggd2VpZ2h0cywgcmdiICk7XG59XG5ib29sIGlzUGVyc3BlY3RpdmVNYXRyaXgoIG1hdDQgbSApIHtcblx0cmV0dXJuIG1bIDIgXVsgMyBdID09IC0gMS4wO1xufVxudmVjMiBlcXVpcmVjdFV2KCBpbiB2ZWMzIGRpciApIHtcblx0ZmxvYXQgdSA9IGF0YW4oIGRpci56LCBkaXIueCApICogUkVDSVBST0NBTF9QSTIgKyAwLjU7XG5cdGZsb2F0IHYgPSBhc2luKCBjbGFtcCggZGlyLnksIC0gMS4wLCAxLjAgKSApICogUkVDSVBST0NBTF9QSSArIDAuNTtcblx0cmV0dXJuIHZlYzIoIHUsIHYgKTtcbn1cbnZlYzMgQlJERl9MYW1iZXJ0KCBjb25zdCBpbiB2ZWMzIGRpZmZ1c2VDb2xvciApIHtcblx0cmV0dXJuIFJFQ0lQUk9DQUxfUEkgKiBkaWZmdXNlQ29sb3I7XG59XG52ZWMzIEZfU2NobGljayggY29uc3QgaW4gdmVjMyBmMCwgY29uc3QgaW4gZmxvYXQgZjkwLCBjb25zdCBpbiBmbG9hdCBkb3RWSCApIHtcblx0ZmxvYXQgZnJlc25lbCA9IGV4cDIoICggLSA1LjU1NDczICogZG90VkggLSA2Ljk4MzE2ICkgKiBkb3RWSCApO1xuXHRyZXR1cm4gZjAgKiAoIDEuMCAtIGZyZXNuZWwgKSArICggZjkwICogZnJlc25lbCApO1xufVxuZmxvYXQgRl9TY2hsaWNrKCBjb25zdCBpbiBmbG9hdCBmMCwgY29uc3QgaW4gZmxvYXQgZjkwLCBjb25zdCBpbiBmbG9hdCBkb3RWSCApIHtcblx0ZmxvYXQgZnJlc25lbCA9IGV4cDIoICggLSA1LjU1NDczICogZG90VkggLSA2Ljk4MzE2ICkgKiBkb3RWSCApO1xuXHRyZXR1cm4gZjAgKiAoIDEuMCAtIGZyZXNuZWwgKSArICggZjkwICogZnJlc25lbCApO1xufSAvLyB2YWxpZGF0ZWQiOwoKdmFyIGN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudCA9ICIjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRV9VVlxuXHQjZGVmaW5lIGN1YmVVVl9taW5NaXBMZXZlbCA0LjBcblx0I2RlZmluZSBjdWJlVVZfbWluVGlsZVNpemUgMTYuMFxuXHRmbG9hdCBnZXRGYWNlKCB2ZWMzIGRpcmVjdGlvbiApIHtcblx0XHR2ZWMzIGFic0RpcmVjdGlvbiA9IGFicyggZGlyZWN0aW9uICk7XG5cdFx0ZmxvYXQgZmFjZSA9IC0gMS4wO1xuXHRcdGlmICggYWJzRGlyZWN0aW9uLnggPiBhYnNEaXJlY3Rpb24ueiApIHtcblx0XHRcdGlmICggYWJzRGlyZWN0aW9uLnggPiBhYnNEaXJlY3Rpb24ueSApXG5cdFx0XHRcdGZhY2UgPSBkaXJlY3Rpb24ueCA+IDAuMCA/IDAuMCA6IDMuMDtcblx0XHRcdGVsc2Vcblx0XHRcdFx0ZmFjZSA9IGRpcmVjdGlvbi55ID4gMC4wID8gMS4wIDogNC4wO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHRpZiAoIGFic0RpcmVjdGlvbi56ID4gYWJzRGlyZWN0aW9uLnkgKVxuXHRcdFx0XHRmYWNlID0gZGlyZWN0aW9uLnogPiAwLjAgPyAyLjAgOiA1LjA7XG5cdFx0XHRlbHNlXG5cdFx0XHRcdGZhY2UgPSBkaXJlY3Rpb24ueSA+IDAuMCA/IDEuMCA6IDQuMDtcblx0XHR9XG5cdFx0cmV0dXJuIGZhY2U7XG5cdH1cblx0dmVjMiBnZXRVViggdmVjMyBkaXJlY3Rpb24sIGZsb2F0IGZhY2UgKSB7XG5cdFx0dmVjMiB1djtcblx0XHRpZiAoIGZhY2UgPT0gMC4wICkge1xuXHRcdFx0dXYgPSB2ZWMyKCBkaXJlY3Rpb24ueiwgZGlyZWN0aW9uLnkgKSAvIGFicyggZGlyZWN0aW9uLnggKTtcblx0XHR9IGVsc2UgaWYgKCBmYWNlID09IDEuMCApIHtcblx0XHRcdHV2ID0gdmVjMiggLSBkaXJlY3Rpb24ueCwgLSBkaXJlY3Rpb24ueiApIC8gYWJzKCBkaXJlY3Rpb24ueSApO1xuXHRcdH0gZWxzZSBpZiAoIGZhY2UgPT0gMi4wICkge1xuXHRcdFx0dXYgPSB2ZWMyKCAtIGRpcmVjdGlvbi54LCBkaXJlY3Rpb24ueSApIC8gYWJzKCBkaXJlY3Rpb24ueiApO1xuXHRcdH0gZWxzZSBpZiAoIGZhY2UgPT0gMy4wICkge1xuXHRcdFx0dXYgPSB2ZWMyKCAtIGRpcmVjdGlvbi56LCBkaXJlY3Rpb24ueSApIC8gYWJzKCBkaXJlY3Rpb24ueCApO1xuXHRcdH0gZWxzZSBpZiAoIGZhY2UgPT0gNC4wICkge1xuXHRcdFx0dXYgPSB2ZWMyKCAtIGRpcmVjdGlvbi54LCBkaXJlY3Rpb24ueiApIC8gYWJzKCBkaXJlY3Rpb24ueSApO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR1diA9IHZlYzIoIGRpcmVjdGlvbi54LCBkaXJlY3Rpb24ueSApIC8gYWJzKCBkaXJlY3Rpb24ueiApO1xuXHRcdH1cblx0XHRyZXR1cm4gMC41ICogKCB1diArIDEuMCApO1xuXHR9XG5cdHZlYzMgYmlsaW5lYXJDdWJlVVYoIHNhbXBsZXIyRCBlbnZNYXAsIHZlYzMgZGlyZWN0aW9uLCBmbG9hdCBtaXBJbnQgKSB7XG5cdFx0ZmxvYXQgZmFjZSA9IGdldEZhY2UoIGRpcmVjdGlvbiApO1xuXHRcdGZsb2F0IGZpbHRlckludCA9IG1heCggY3ViZVVWX21pbk1pcExldmVsIC0gbWlwSW50LCAwLjAgKTtcblx0XHRtaXBJbnQgPSBtYXgoIG1pcEludCwgY3ViZVVWX21pbk1pcExldmVsICk7XG5cdFx0ZmxvYXQgZmFjZVNpemUgPSBleHAyKCBtaXBJbnQgKTtcblx0XHRoaWdocCB2ZWMyIHV2ID0gZ2V0VVYoIGRpcmVjdGlvbiwgZmFjZSApICogKCBmYWNlU2l6ZSAtIDIuMCApICsgMS4wO1xuXHRcdGlmICggZmFjZSA+IDIuMCApIHtcblx0XHRcdHV2LnkgKz0gZmFjZVNpemU7XG5cdFx0XHRmYWNlIC09IDMuMDtcblx0XHR9XG5cdFx0dXYueCArPSBmYWNlICogZmFjZVNpemU7XG5cdFx0dXYueCArPSBmaWx0ZXJJbnQgKiAzLjAgKiBjdWJlVVZfbWluVGlsZVNpemU7XG5cdFx0dXYueSArPSA0LjAgKiAoIGV4cDIoIENVQkVVVl9NQVhfTUlQICkgLSBmYWNlU2l6ZSApO1xuXHRcdHV2LnggKj0gQ1VCRVVWX1RFWEVMX1dJRFRIO1xuXHRcdHV2LnkgKj0gQ1VCRVVWX1RFWEVMX0hFSUdIVDtcblx0XHQjaWZkZWYgdGV4dHVyZTJER3JhZEVYVFxuXHRcdFx0cmV0dXJuIHRleHR1cmUyREdyYWRFWFQoIGVudk1hcCwgdXYsIHZlYzIoIDAuMCApLCB2ZWMyKCAwLjAgKSApLnJnYjtcblx0XHQjZWxzZVxuXHRcdFx0cmV0dXJuIHRleHR1cmUyRCggZW52TWFwLCB1diApLnJnYjtcblx0XHQjZW5kaWZcblx0fVxuXHQjZGVmaW5lIGN1YmVVVl9yMCAxLjBcblx0I2RlZmluZSBjdWJlVVZfdjAgMC4zMzlcblx0I2RlZmluZSBjdWJlVVZfbTAgLSAyLjBcblx0I2RlZmluZSBjdWJlVVZfcjEgMC44XG5cdCNkZWZpbmUgY3ViZVVWX3YxIDAuMjc2XG5cdCNkZWZpbmUgY3ViZVVWX20xIC0gMS4wXG5cdCNkZWZpbmUgY3ViZVVWX3I0IDAuNFxuXHQjZGVmaW5lIGN1YmVVVl92NCAwLjA0NlxuXHQjZGVmaW5lIGN1YmVVVl9tNCAyLjBcblx0I2RlZmluZSBjdWJlVVZfcjUgMC4zMDVcblx0I2RlZmluZSBjdWJlVVZfdjUgMC4wMTZcblx0I2RlZmluZSBjdWJlVVZfbTUgMy4wXG5cdCNkZWZpbmUgY3ViZVVWX3I2IDAuMjFcblx0I2RlZmluZSBjdWJlVVZfdjYgMC4wMDM4XG5cdCNkZWZpbmUgY3ViZVVWX202IDQuMFxuXHRmbG9hdCByb3VnaG5lc3NUb01pcCggZmxvYXQgcm91Z2huZXNzICkge1xuXHRcdGZsb2F0IG1pcCA9IDAuMDtcblx0XHRpZiAoIHJvdWdobmVzcyA+PSBjdWJlVVZfcjEgKSB7XG5cdFx0XHRtaXAgPSAoIGN1YmVVVl9yMCAtIHJvdWdobmVzcyApICogKCBjdWJlVVZfbTEgLSBjdWJlVVZfbTAgKSAvICggY3ViZVVWX3IwIC0gY3ViZVVWX3IxICkgKyBjdWJlVVZfbTA7XG5cdFx0fSBlbHNlIGlmICggcm91Z2huZXNzID49IGN1YmVVVl9yNCApIHtcblx0XHRcdG1pcCA9ICggY3ViZVVWX3IxIC0gcm91Z2huZXNzICkgKiAoIGN1YmVVVl9tNCAtIGN1YmVVVl9tMSApIC8gKCBjdWJlVVZfcjEgLSBjdWJlVVZfcjQgKSArIGN1YmVVVl9tMTtcblx0XHR9IGVsc2UgaWYgKCByb3VnaG5lc3MgPj0gY3ViZVVWX3I1ICkge1xuXHRcdFx0bWlwID0gKCBjdWJlVVZfcjQgLSByb3VnaG5lc3MgKSAqICggY3ViZVVWX201IC0gY3ViZVVWX200ICkgLyAoIGN1YmVVVl9yNCAtIGN1YmVVVl9yNSApICsgY3ViZVVWX200O1xuXHRcdH0gZWxzZSBpZiAoIHJvdWdobmVzcyA+PSBjdWJlVVZfcjYgKSB7XG5cdFx0XHRtaXAgPSAoIGN1YmVVVl9yNSAtIHJvdWdobmVzcyApICogKCBjdWJlVVZfbTYgLSBjdWJlVVZfbTUgKSAvICggY3ViZVVWX3I1IC0gY3ViZVVWX3I2ICkgKyBjdWJlVVZfbTU7XG5cdFx0fSBlbHNlIHtcblx0XHRcdG1pcCA9IC0gMi4wICogbG9nMiggMS4xNiAqIHJvdWdobmVzcyApO1x0XHR9XG5cdFx0cmV0dXJuIG1pcDtcblx0fVxuXHR2ZWM0IHRleHR1cmVDdWJlVVYoIHNhbXBsZXIyRCBlbnZNYXAsIHZlYzMgc2FtcGxlRGlyLCBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdFx0ZmxvYXQgbWlwID0gY2xhbXAoIHJvdWdobmVzc1RvTWlwKCByb3VnaG5lc3MgKSwgY3ViZVVWX20wLCBDVUJFVVZfTUFYX01JUCApO1xuXHRcdGZsb2F0IG1pcEYgPSBmcmFjdCggbWlwICk7XG5cdFx0ZmxvYXQgbWlwSW50ID0gZmxvb3IoIG1pcCApO1xuXHRcdHZlYzMgY29sb3IwID0gYmlsaW5lYXJDdWJlVVYoIGVudk1hcCwgc2FtcGxlRGlyLCBtaXBJbnQgKTtcblx0XHRpZiAoIG1pcEYgPT0gMC4wICkge1xuXHRcdFx0cmV0dXJuIHZlYzQoIGNvbG9yMCwgMS4wICk7XG5cdFx0fSBlbHNlIHtcblx0XHRcdHZlYzMgY29sb3IxID0gYmlsaW5lYXJDdWJlVVYoIGVudk1hcCwgc2FtcGxlRGlyLCBtaXBJbnQgKyAxLjAgKTtcblx0XHRcdHJldHVybiB2ZWM0KCBtaXgoIGNvbG9yMCwgY29sb3IxLCBtaXBGICksIDEuMCApO1xuXHRcdH1cblx0fVxuI2VuZGlmIjsKCnZhciBkZWZhdWx0bm9ybWFsX3ZlcnRleCA9ICJ2ZWMzIHRyYW5zZm9ybWVkTm9ybWFsID0gb2JqZWN0Tm9ybWFsO1xuI2lmZGVmIFVTRV9JTlNUQU5DSU5HXG5cdG1hdDMgbSA9IG1hdDMoIGluc3RhbmNlTWF0cml4ICk7XG5cdHRyYW5zZm9ybWVkTm9ybWFsIC89IHZlYzMoIGRvdCggbVsgMCBdLCBtWyAwIF0gKSwgZG90KCBtWyAxIF0sIG1bIDEgXSApLCBkb3QoIG1bIDIgXSwgbVsgMiBdICkgKTtcblx0dHJhbnNmb3JtZWROb3JtYWwgPSBtICogdHJhbnNmb3JtZWROb3JtYWw7XG4jZW5kaWZcbnRyYW5zZm9ybWVkTm9ybWFsID0gbm9ybWFsTWF0cml4ICogdHJhbnNmb3JtZWROb3JtYWw7XG4jaWZkZWYgRkxJUF9TSURFRFxuXHR0cmFuc2Zvcm1lZE5vcm1hbCA9IC0gdHJhbnNmb3JtZWROb3JtYWw7XG4jZW5kaWZcbiNpZmRlZiBVU0VfVEFOR0VOVFxuXHR2ZWMzIHRyYW5zZm9ybWVkVGFuZ2VudCA9ICggbW9kZWxWaWV3TWF0cml4ICogdmVjNCggb2JqZWN0VGFuZ2VudCwgMC4wICkgKS54eXo7XG5cdCNpZmRlZiBGTElQX1NJREVEXG5cdFx0dHJhbnNmb3JtZWRUYW5nZW50ID0gLSB0cmFuc2Zvcm1lZFRhbmdlbnQ7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCnZhciBkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgZGlzcGxhY2VtZW50TWFwO1xuXHR1bmlmb3JtIGZsb2F0IGRpc3BsYWNlbWVudFNjYWxlO1xuXHR1bmlmb3JtIGZsb2F0IGRpc3BsYWNlbWVudEJpYXM7XG4jZW5kaWYiOwoKdmFyIGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXggPSAiI2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0dHJhbnNmb3JtZWQgKz0gbm9ybWFsaXplKCBvYmplY3ROb3JtYWwgKSAqICggdGV4dHVyZTJEKCBkaXNwbGFjZW1lbnRNYXAsIHZEaXNwbGFjZW1lbnRNYXBVdiApLnggKiBkaXNwbGFjZW1lbnRTY2FsZSArIGRpc3BsYWNlbWVudEJpYXMgKTtcbiNlbmRpZiI7Cgp2YXIgZW1pc3NpdmVtYXBfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9FTUlTU0lWRU1BUFxuXHR2ZWM0IGVtaXNzaXZlQ29sb3IgPSB0ZXh0dXJlMkQoIGVtaXNzaXZlTWFwLCB2RW1pc3NpdmVNYXBVdiApO1xuXHR0b3RhbEVtaXNzaXZlUmFkaWFuY2UgKj0gZW1pc3NpdmVDb2xvci5yZ2I7XG4jZW5kaWYiOwoKdmFyIGVtaXNzaXZlbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9FTUlTU0lWRU1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBlbWlzc2l2ZU1hcDtcbiNlbmRpZiI7Cgp2YXIgY29sb3JzcGFjZV9mcmFnbWVudCA9ICJnbF9GcmFnQ29sb3IgPSBsaW5lYXJUb091dHB1dFRleGVsKCBnbF9GcmFnQ29sb3IgKTsiOwoKdmFyIGNvbG9yc3BhY2VfcGFyc19mcmFnbWVudCA9ICJcbmNvbnN0IG1hdDMgTElORUFSX1NSR0JfVE9fTElORUFSX0RJU1BMQVlfUDMgPSBtYXQzKFxuXHR2ZWMzKCAwLjgyMjQ2MjEsIDAuMTc3NTM4LCAwLjAgKSxcblx0dmVjMyggMC4wMzMxOTQxLCAwLjk2NjgwNTgsIDAuMCApLFxuXHR2ZWMzKCAwLjAxNzA4MjcsIDAuMDcyMzk3NCwgMC45MTA1MTk5IClcbik7XG5jb25zdCBtYXQzIExJTkVBUl9ESVNQTEFZX1AzX1RPX0xJTkVBUl9TUkdCID0gbWF0Myhcblx0dmVjMyggMS4yMjQ5NDAxLCAtIDAuMjI0OTQwNCwgMC4wICksXG5cdHZlYzMoIC0gMC4wNDIwNTY5LCAxLjA0MjA1NzEsIDAuMCApLFxuXHR2ZWMzKCAtIDAuMDE5NjM3NiwgLSAwLjA3ODYzNjEsIDEuMDk4MjczNSApXG4pO1xudmVjNCBMaW5lYXJTUkdCVG9MaW5lYXJEaXNwbGF5UDMoIGluIHZlYzQgdmFsdWUgKSB7XG5cdHJldHVybiB2ZWM0KCB2YWx1ZS5yZ2IgKiBMSU5FQVJfU1JHQl9UT19MSU5FQVJfRElTUExBWV9QMywgdmFsdWUuYSApO1xufVxudmVjNCBMaW5lYXJEaXNwbGF5UDNUb0xpbmVhclNSR0IoIGluIHZlYzQgdmFsdWUgKSB7XG5cdHJldHVybiB2ZWM0KCB2YWx1ZS5yZ2IgKiBMSU5FQVJfRElTUExBWV9QM19UT19MSU5FQVJfU1JHQiwgdmFsdWUuYSApO1xufVxudmVjNCBMaW5lYXJUcmFuc2Zlck9FVEYoIGluIHZlYzQgdmFsdWUgKSB7XG5cdHJldHVybiB2YWx1ZTtcbn1cbnZlYzQgc1JHQlRyYW5zZmVyT0VURiggaW4gdmVjNCB2YWx1ZSApIHtcblx0cmV0dXJuIHZlYzQoIG1peCggcG93KCB2YWx1ZS5yZ2IsIHZlYzMoIDAuNDE2NjYgKSApICogMS4wNTUgLSB2ZWMzKCAwLjA1NSApLCB2YWx1ZS5yZ2IgKiAxMi45MiwgdmVjMyggbGVzc1RoYW5FcXVhbCggdmFsdWUucmdiLCB2ZWMzKCAwLjAwMzEzMDggKSApICkgKSwgdmFsdWUuYSApO1xufVxudmVjNCBMaW5lYXJUb0xpbmVhciggaW4gdmVjNCB2YWx1ZSApIHtcblx0cmV0dXJuIHZhbHVlO1xufVxudmVjNCBMaW5lYXJUb3NSR0IoIGluIHZlYzQgdmFsdWUgKSB7XG5cdHJldHVybiBzUkdCVHJhbnNmZXJPRVRGKCB2YWx1ZSApO1xufSI7Cgp2YXIgZW52bWFwX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfRU5WTUFQXG5cdCNpZmRlZiBFTlZfV09STERQT1Ncblx0XHR2ZWMzIGNhbWVyYVRvRnJhZztcblx0XHRpZiAoIGlzT3J0aG9ncmFwaGljICkge1xuXHRcdFx0Y2FtZXJhVG9GcmFnID0gbm9ybWFsaXplKCB2ZWMzKCAtIHZpZXdNYXRyaXhbIDAgXVsgMiBdLCAtIHZpZXdNYXRyaXhbIDEgXVsgMiBdLCAtIHZpZXdNYXRyaXhbIDIgXVsgMiBdICkgKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y2FtZXJhVG9GcmFnID0gbm9ybWFsaXplKCB2V29ybGRQb3NpdGlvbiAtIGNhbWVyYVBvc2l0aW9uICk7XG5cdFx0fVxuXHRcdHZlYzMgd29ybGROb3JtYWwgPSBpbnZlcnNlVHJhbnNmb3JtRGlyZWN0aW9uKCBub3JtYWwsIHZpZXdNYXRyaXggKTtcblx0XHQjaWZkZWYgRU5WTUFQX01PREVfUkVGTEVDVElPTlxuXHRcdFx0dmVjMyByZWZsZWN0VmVjID0gcmVmbGVjdCggY2FtZXJhVG9GcmFnLCB3b3JsZE5vcm1hbCApO1xuXHRcdCNlbHNlXG5cdFx0XHR2ZWMzIHJlZmxlY3RWZWMgPSByZWZyYWN0KCBjYW1lcmFUb0ZyYWcsIHdvcmxkTm9ybWFsLCByZWZyYWN0aW9uUmF0aW8gKTtcblx0XHQjZW5kaWZcblx0I2Vsc2Vcblx0XHR2ZWMzIHJlZmxlY3RWZWMgPSB2UmVmbGVjdDtcblx0I2VuZGlmXG5cdCNpZmRlZiBFTlZNQVBfVFlQRV9DVUJFXG5cdFx0dmVjNCBlbnZDb2xvciA9IHRleHR1cmVDdWJlKCBlbnZNYXAsIHZlYzMoIGZsaXBFbnZNYXAgKiByZWZsZWN0VmVjLngsIHJlZmxlY3RWZWMueXogKSApO1xuXHQjZWxzZVxuXHRcdHZlYzQgZW52Q29sb3IgPSB2ZWM0KCAwLjAgKTtcblx0I2VuZGlmXG5cdCNpZmRlZiBFTlZNQVBfQkxFTkRJTkdfTVVMVElQTFlcblx0XHRvdXRnb2luZ0xpZ2h0ID0gbWl4KCBvdXRnb2luZ0xpZ2h0LCBvdXRnb2luZ0xpZ2h0ICogZW52Q29sb3IueHl6LCBzcGVjdWxhclN0cmVuZ3RoICogcmVmbGVjdGl2aXR5ICk7XG5cdCNlbGlmIGRlZmluZWQoIEVOVk1BUF9CTEVORElOR19NSVggKVxuXHRcdG91dGdvaW5nTGlnaHQgPSBtaXgoIG91dGdvaW5nTGlnaHQsIGVudkNvbG9yLnh5eiwgc3BlY3VsYXJTdHJlbmd0aCAqIHJlZmxlY3Rpdml0eSApO1xuXHQjZWxpZiBkZWZpbmVkKCBFTlZNQVBfQkxFTkRJTkdfQUREIClcblx0XHRvdXRnb2luZ0xpZ2h0ICs9IGVudkNvbG9yLnh5eiAqIHNwZWN1bGFyU3RyZW5ndGggKiByZWZsZWN0aXZpdHk7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCnZhciBlbnZtYXBfY29tbW9uX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9FTlZNQVBcblx0dW5pZm9ybSBmbG9hdCBlbnZNYXBJbnRlbnNpdHk7XG5cdHVuaWZvcm0gZmxvYXQgZmxpcEVudk1hcDtcblx0I2lmZGVmIEVOVk1BUF9UWVBFX0NVQkVcblx0XHR1bmlmb3JtIHNhbXBsZXJDdWJlIGVudk1hcDtcblx0I2Vsc2Vcblx0XHR1bmlmb3JtIHNhbXBsZXIyRCBlbnZNYXA7XG5cdCNlbmRpZlxuXHRcbiNlbmRpZiI7Cgp2YXIgZW52bWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9FTlZNQVBcblx0dW5pZm9ybSBmbG9hdCByZWZsZWN0aXZpdHk7XG5cdCNpZiBkZWZpbmVkKCBVU0VfQlVNUE1BUCApIHx8IGRlZmluZWQoIFVTRV9OT1JNQUxNQVAgKSB8fCBkZWZpbmVkKCBQSE9ORyApIHx8IGRlZmluZWQoIExBTUJFUlQgKVxuXHRcdCNkZWZpbmUgRU5WX1dPUkxEUE9TXG5cdCNlbmRpZlxuXHQjaWZkZWYgRU5WX1dPUkxEUE9TXG5cdFx0dmFyeWluZyB2ZWMzIHZXb3JsZFBvc2l0aW9uO1xuXHRcdHVuaWZvcm0gZmxvYXQgcmVmcmFjdGlvblJhdGlvO1xuXHQjZWxzZVxuXHRcdHZhcnlpbmcgdmVjMyB2UmVmbGVjdDtcblx0I2VuZGlmXG4jZW5kaWYiOwoKdmFyIGVudm1hcF9wYXJzX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0VOVk1BUFxuXHQjaWYgZGVmaW5lZCggVVNFX0JVTVBNQVAgKSB8fCBkZWZpbmVkKCBVU0VfTk9STUFMTUFQICkgfHwgZGVmaW5lZCggUEhPTkcgKSB8fCBkZWZpbmVkKCBMQU1CRVJUIClcblx0XHQjZGVmaW5lIEVOVl9XT1JMRFBPU1xuXHQjZW5kaWZcblx0I2lmZGVmIEVOVl9XT1JMRFBPU1xuXHRcdFxuXHRcdHZhcnlpbmcgdmVjMyB2V29ybGRQb3NpdGlvbjtcblx0I2Vsc2Vcblx0XHR2YXJ5aW5nIHZlYzMgdlJlZmxlY3Q7XG5cdFx0dW5pZm9ybSBmbG9hdCByZWZyYWN0aW9uUmF0aW87XG5cdCNlbmRpZlxuI2VuZGlmIjsKCnZhciBlbnZtYXBfdmVydGV4ID0gIiNpZmRlZiBVU0VfRU5WTUFQXG5cdCNpZmRlZiBFTlZfV09STERQT1Ncblx0XHR2V29ybGRQb3NpdGlvbiA9IHdvcmxkUG9zaXRpb24ueHl6O1xuXHQjZWxzZVxuXHRcdHZlYzMgY2FtZXJhVG9WZXJ0ZXg7XG5cdFx0aWYgKCBpc09ydGhvZ3JhcGhpYyApIHtcblx0XHRcdGNhbWVyYVRvVmVydGV4ID0gbm9ybWFsaXplKCB2ZWMzKCAtIHZpZXdNYXRyaXhbIDAgXVsgMiBdLCAtIHZpZXdNYXRyaXhbIDEgXVsgMiBdLCAtIHZpZXdNYXRyaXhbIDIgXVsgMiBdICkgKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Y2FtZXJhVG9WZXJ0ZXggPSBub3JtYWxpemUoIHdvcmxkUG9zaXRpb24ueHl6IC0gY2FtZXJhUG9zaXRpb24gKTtcblx0XHR9XG5cdFx0dmVjMyB3b3JsZE5vcm1hbCA9IGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIHRyYW5zZm9ybWVkTm9ybWFsLCB2aWV3TWF0cml4ICk7XG5cdFx0I2lmZGVmIEVOVk1BUF9NT0RFX1JFRkxFQ1RJT05cblx0XHRcdHZSZWZsZWN0ID0gcmVmbGVjdCggY2FtZXJhVG9WZXJ0ZXgsIHdvcmxkTm9ybWFsICk7XG5cdFx0I2Vsc2Vcblx0XHRcdHZSZWZsZWN0ID0gcmVmcmFjdCggY2FtZXJhVG9WZXJ0ZXgsIHdvcmxkTm9ybWFsLCByZWZyYWN0aW9uUmF0aW8gKTtcblx0XHQjZW5kaWZcblx0I2VuZGlmXG4jZW5kaWYiOwoKdmFyIGZvZ192ZXJ0ZXggPSAiI2lmZGVmIFVTRV9GT0dcblx0dkZvZ0RlcHRoID0gLSBtdlBvc2l0aW9uLno7XG4jZW5kaWYiOwoKdmFyIGZvZ19wYXJzX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0ZPR1xuXHR2YXJ5aW5nIGZsb2F0IHZGb2dEZXB0aDtcbiNlbmRpZiI7Cgp2YXIgZm9nX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfRk9HXG5cdCNpZmRlZiBGT0dfRVhQMlxuXHRcdGZsb2F0IGZvZ0ZhY3RvciA9IDEuMCAtIGV4cCggLSBmb2dEZW5zaXR5ICogZm9nRGVuc2l0eSAqIHZGb2dEZXB0aCAqIHZGb2dEZXB0aCApO1xuXHQjZWxzZVxuXHRcdGZsb2F0IGZvZ0ZhY3RvciA9IHNtb290aHN0ZXAoIGZvZ05lYXIsIGZvZ0ZhciwgdkZvZ0RlcHRoICk7XG5cdCNlbmRpZlxuXHRnbF9GcmFnQ29sb3IucmdiID0gbWl4KCBnbF9GcmFnQ29sb3IucmdiLCBmb2dDb2xvciwgZm9nRmFjdG9yICk7XG4jZW5kaWYiOwoKdmFyIGZvZ19wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfRk9HXG5cdHVuaWZvcm0gdmVjMyBmb2dDb2xvcjtcblx0dmFyeWluZyBmbG9hdCB2Rm9nRGVwdGg7XG5cdCNpZmRlZiBGT0dfRVhQMlxuXHRcdHVuaWZvcm0gZmxvYXQgZm9nRGVuc2l0eTtcblx0I2Vsc2Vcblx0XHR1bmlmb3JtIGZsb2F0IGZvZ05lYXI7XG5cdFx0dW5pZm9ybSBmbG9hdCBmb2dGYXI7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCnZhciBncmFkaWVudG1hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfR1JBRElFTlRNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgZ3JhZGllbnRNYXA7XG4jZW5kaWZcbnZlYzMgZ2V0R3JhZGllbnRJcnJhZGlhbmNlKCB2ZWMzIG5vcm1hbCwgdmVjMyBsaWdodERpcmVjdGlvbiApIHtcblx0ZmxvYXQgZG90TkwgPSBkb3QoIG5vcm1hbCwgbGlnaHREaXJlY3Rpb24gKTtcblx0dmVjMiBjb29yZCA9IHZlYzIoIGRvdE5MICogMC41ICsgMC41LCAwLjAgKTtcblx0I2lmZGVmIFVTRV9HUkFESUVOVE1BUFxuXHRcdHJldHVybiB2ZWMzKCB0ZXh0dXJlMkQoIGdyYWRpZW50TWFwLCBjb29yZCApLnIgKTtcblx0I2Vsc2Vcblx0XHR2ZWMyIGZ3ID0gZndpZHRoKCBjb29yZCApICogMC41O1xuXHRcdHJldHVybiBtaXgoIHZlYzMoIDAuNyApLCB2ZWMzKCAxLjAgKSwgc21vb3Roc3RlcCggMC43IC0gZncueCwgMC43ICsgZncueCwgY29vcmQueCApICk7XG5cdCNlbmRpZlxufSI7Cgp2YXIgbGlnaHRtYXBfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9MSUdIVE1BUFxuXHR2ZWM0IGxpZ2h0TWFwVGV4ZWwgPSB0ZXh0dXJlMkQoIGxpZ2h0TWFwLCB2TGlnaHRNYXBVdiApO1xuXHR2ZWMzIGxpZ2h0TWFwSXJyYWRpYW5jZSA9IGxpZ2h0TWFwVGV4ZWwucmdiICogbGlnaHRNYXBJbnRlbnNpdHk7XG5cdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSBsaWdodE1hcElycmFkaWFuY2U7XG4jZW5kaWYiOwoKdmFyIGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9MSUdIVE1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBsaWdodE1hcDtcblx0dW5pZm9ybSBmbG9hdCBsaWdodE1hcEludGVuc2l0eTtcbiNlbmRpZiI7Cgp2YXIgbGlnaHRzX2xhbWJlcnRfZnJhZ21lbnQgPSAiTGFtYmVydE1hdGVyaWFsIG1hdGVyaWFsO1xubWF0ZXJpYWwuZGlmZnVzZUNvbG9yID0gZGlmZnVzZUNvbG9yLnJnYjtcbm1hdGVyaWFsLnNwZWN1bGFyU3RyZW5ndGggPSBzcGVjdWxhclN0cmVuZ3RoOyI7Cgp2YXIgbGlnaHRzX2xhbWJlcnRfcGFyc19mcmFnbWVudCA9ICJ2YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbnN0cnVjdCBMYW1iZXJ0TWF0ZXJpYWwge1xuXHR2ZWMzIGRpZmZ1c2VDb2xvcjtcblx0ZmxvYXQgc3BlY3VsYXJTdHJlbmd0aDtcbn07XG52b2lkIFJFX0RpcmVjdF9MYW1iZXJ0KCBjb25zdCBpbiBJbmNpZGVudExpZ2h0IGRpcmVjdExpZ2h0LCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBMYW1iZXJ0TWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuXHRmbG9hdCBkb3ROTCA9IHNhdHVyYXRlKCBkb3QoIGdlb21ldHJ5Tm9ybWFsLCBkaXJlY3RMaWdodC5kaXJlY3Rpb24gKSApO1xuXHR2ZWMzIGlycmFkaWFuY2UgPSBkb3ROTCAqIGRpcmVjdExpZ2h0LmNvbG9yO1xuXHRyZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICs9IGlycmFkaWFuY2UgKiBCUkRGX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xufVxudm9pZCBSRV9JbmRpcmVjdERpZmZ1c2VfTGFtYmVydCggY29uc3QgaW4gdmVjMyBpcnJhZGlhbmNlLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBMYW1iZXJ0TWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuXHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKz0gaXJyYWRpYW5jZSAqIEJSREZfTGFtYmVydCggbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICk7XG59XG4jZGVmaW5lIFJFX0RpcmVjdFx0XHRcdFx0UkVfRGlyZWN0X0xhbWJlcnRcbiNkZWZpbmUgUkVfSW5kaXJlY3REaWZmdXNlXHRcdFJFX0luZGlyZWN0RGlmZnVzZV9MYW1iZXJ0IjsKCnZhciBsaWdodHNfcGFyc19iZWdpbiA9ICJ1bmlmb3JtIGJvb2wgcmVjZWl2ZVNoYWRvdztcbnVuaWZvcm0gdmVjMyBhbWJpZW50TGlnaHRDb2xvcjtcbiNpZiBkZWZpbmVkKCBVU0VfTElHSFRfUFJPQkVTIClcblx0dW5pZm9ybSB2ZWMzIGxpZ2h0UHJvYmVbIDkgXTtcbiNlbmRpZlxudmVjMyBzaEdldElycmFkaWFuY2VBdCggaW4gdmVjMyBub3JtYWwsIGluIHZlYzMgc2hDb2VmZmljaWVudHNbIDkgXSApIHtcblx0ZmxvYXQgeCA9IG5vcm1hbC54LCB5ID0gbm9ybWFsLnksIHogPSBub3JtYWwuejtcblx0dmVjMyByZXN1bHQgPSBzaENvZWZmaWNpZW50c1sgMCBdICogMC44ODYyMjc7XG5cdHJlc3VsdCArPSBzaENvZWZmaWNpZW50c1sgMSBdICogMi4wICogMC41MTE2NjQgKiB5O1xuXHRyZXN1bHQgKz0gc2hDb2VmZmljaWVudHNbIDIgXSAqIDIuMCAqIDAuNTExNjY0ICogejtcblx0cmVzdWx0ICs9IHNoQ29lZmZpY2llbnRzWyAzIF0gKiAyLjAgKiAwLjUxMTY2NCAqIHg7XG5cdHJlc3VsdCArPSBzaENvZWZmaWNpZW50c1sgNCBdICogMi4wICogMC40MjkwNDMgKiB4ICogeTtcblx0cmVzdWx0ICs9IHNoQ29lZmZpY2llbnRzWyA1IF0gKiAyLjAgKiAwLjQyOTA0MyAqIHkgKiB6O1xuXHRyZXN1bHQgKz0gc2hDb2VmZmljaWVudHNbIDYgXSAqICggMC43NDMxMjUgKiB6ICogeiAtIDAuMjQ3NzA4ICk7XG5cdHJlc3VsdCArPSBzaENvZWZmaWNpZW50c1sgNyBdICogMi4wICogMC40MjkwNDMgKiB4ICogejtcblx0cmVzdWx0ICs9IHNoQ29lZmZpY2llbnRzWyA4IF0gKiAwLjQyOTA0MyAqICggeCAqIHggLSB5ICogeSApO1xuXHRyZXR1cm4gcmVzdWx0O1xufVxudmVjMyBnZXRMaWdodFByb2JlSXJyYWRpYW5jZSggY29uc3QgaW4gdmVjMyBsaWdodFByb2JlWyA5IF0sIGNvbnN0IGluIHZlYzMgbm9ybWFsICkge1xuXHR2ZWMzIHdvcmxkTm9ybWFsID0gaW52ZXJzZVRyYW5zZm9ybURpcmVjdGlvbiggbm9ybWFsLCB2aWV3TWF0cml4ICk7XG5cdHZlYzMgaXJyYWRpYW5jZSA9IHNoR2V0SXJyYWRpYW5jZUF0KCB3b3JsZE5vcm1hbCwgbGlnaHRQcm9iZSApO1xuXHRyZXR1cm4gaXJyYWRpYW5jZTtcbn1cbnZlYzMgZ2V0QW1iaWVudExpZ2h0SXJyYWRpYW5jZSggY29uc3QgaW4gdmVjMyBhbWJpZW50TGlnaHRDb2xvciApIHtcblx0dmVjMyBpcnJhZGlhbmNlID0gYW1iaWVudExpZ2h0Q29sb3I7XG5cdHJldHVybiBpcnJhZGlhbmNlO1xufVxuZmxvYXQgZ2V0RGlzdGFuY2VBdHRlbnVhdGlvbiggY29uc3QgaW4gZmxvYXQgbGlnaHREaXN0YW5jZSwgY29uc3QgaW4gZmxvYXQgY3V0b2ZmRGlzdGFuY2UsIGNvbnN0IGluIGZsb2F0IGRlY2F5RXhwb25lbnQgKSB7XG5cdCNpZiBkZWZpbmVkICggTEVHQUNZX0xJR0hUUyApXG5cdFx0aWYgKCBjdXRvZmZEaXN0YW5jZSA+IDAuMCAmJiBkZWNheUV4cG9uZW50ID4gMC4wICkge1xuXHRcdFx0cmV0dXJuIHBvdyggc2F0dXJhdGUoIC0gbGlnaHREaXN0YW5jZSAvIGN1dG9mZkRpc3RhbmNlICsgMS4wICksIGRlY2F5RXhwb25lbnQgKTtcblx0XHR9XG5cdFx0cmV0dXJuIDEuMDtcblx0I2Vsc2Vcblx0XHRmbG9hdCBkaXN0YW5jZUZhbGxvZmYgPSAxLjAgLyBtYXgoIHBvdyggbGlnaHREaXN0YW5jZSwgZGVjYXlFeHBvbmVudCApLCAwLjAxICk7XG5cdFx0aWYgKCBjdXRvZmZEaXN0YW5jZSA+IDAuMCApIHtcblx0XHRcdGRpc3RhbmNlRmFsbG9mZiAqPSBwb3cyKCBzYXR1cmF0ZSggMS4wIC0gcG93NCggbGlnaHREaXN0YW5jZSAvIGN1dG9mZkRpc3RhbmNlICkgKSApO1xuXHRcdH1cblx0XHRyZXR1cm4gZGlzdGFuY2VGYWxsb2ZmO1xuXHQjZW5kaWZcbn1cbmZsb2F0IGdldFNwb3RBdHRlbnVhdGlvbiggY29uc3QgaW4gZmxvYXQgY29uZUNvc2luZSwgY29uc3QgaW4gZmxvYXQgcGVudW1icmFDb3NpbmUsIGNvbnN0IGluIGZsb2F0IGFuZ2xlQ29zaW5lICkge1xuXHRyZXR1cm4gc21vb3Roc3RlcCggY29uZUNvc2luZSwgcGVudW1icmFDb3NpbmUsIGFuZ2xlQ29zaW5lICk7XG59XG4jaWYgTlVNX0RJUl9MSUdIVFMgPiAwXG5cdHN0cnVjdCBEaXJlY3Rpb25hbExpZ2h0IHtcblx0XHR2ZWMzIGRpcmVjdGlvbjtcblx0XHR2ZWMzIGNvbG9yO1xuXHR9O1xuXHR1bmlmb3JtIERpcmVjdGlvbmFsTGlnaHQgZGlyZWN0aW9uYWxMaWdodHNbIE5VTV9ESVJfTElHSFRTIF07XG5cdHZvaWQgZ2V0RGlyZWN0aW9uYWxMaWdodEluZm8oIGNvbnN0IGluIERpcmVjdGlvbmFsTGlnaHQgZGlyZWN0aW9uYWxMaWdodCwgb3V0IEluY2lkZW50TGlnaHQgbGlnaHQgKSB7XG5cdFx0bGlnaHQuY29sb3IgPSBkaXJlY3Rpb25hbExpZ2h0LmNvbG9yO1xuXHRcdGxpZ2h0LmRpcmVjdGlvbiA9IGRpcmVjdGlvbmFsTGlnaHQuZGlyZWN0aW9uO1xuXHRcdGxpZ2h0LnZpc2libGUgPSB0cnVlO1xuXHR9XG4jZW5kaWZcbiNpZiBOVU1fUE9JTlRfTElHSFRTID4gMFxuXHRzdHJ1Y3QgUG9pbnRMaWdodCB7XG5cdFx0dmVjMyBwb3NpdGlvbjtcblx0XHR2ZWMzIGNvbG9yO1xuXHRcdGZsb2F0IGRpc3RhbmNlO1xuXHRcdGZsb2F0IGRlY2F5O1xuXHR9O1xuXHR1bmlmb3JtIFBvaW50TGlnaHQgcG9pbnRMaWdodHNbIE5VTV9QT0lOVF9MSUdIVFMgXTtcblx0dm9pZCBnZXRQb2ludExpZ2h0SW5mbyggY29uc3QgaW4gUG9pbnRMaWdodCBwb2ludExpZ2h0LCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIG91dCBJbmNpZGVudExpZ2h0IGxpZ2h0ICkge1xuXHRcdHZlYzMgbFZlY3RvciA9IHBvaW50TGlnaHQucG9zaXRpb24gLSBnZW9tZXRyeVBvc2l0aW9uO1xuXHRcdGxpZ2h0LmRpcmVjdGlvbiA9IG5vcm1hbGl6ZSggbFZlY3RvciApO1xuXHRcdGZsb2F0IGxpZ2h0RGlzdGFuY2UgPSBsZW5ndGgoIGxWZWN0b3IgKTtcblx0XHRsaWdodC5jb2xvciA9IHBvaW50TGlnaHQuY29sb3I7XG5cdFx0bGlnaHQuY29sb3IgKj0gZ2V0RGlzdGFuY2VBdHRlbnVhdGlvbiggbGlnaHREaXN0YW5jZSwgcG9pbnRMaWdodC5kaXN0YW5jZSwgcG9pbnRMaWdodC5kZWNheSApO1xuXHRcdGxpZ2h0LnZpc2libGUgPSAoIGxpZ2h0LmNvbG9yICE9IHZlYzMoIDAuMCApICk7XG5cdH1cbiNlbmRpZlxuI2lmIE5VTV9TUE9UX0xJR0hUUyA+IDBcblx0c3RydWN0IFNwb3RMaWdodCB7XG5cdFx0dmVjMyBwb3NpdGlvbjtcblx0XHR2ZWMzIGRpcmVjdGlvbjtcblx0XHR2ZWMzIGNvbG9yO1xuXHRcdGZsb2F0IGRpc3RhbmNlO1xuXHRcdGZsb2F0IGRlY2F5O1xuXHRcdGZsb2F0IGNvbmVDb3M7XG5cdFx0ZmxvYXQgcGVudW1icmFDb3M7XG5cdH07XG5cdHVuaWZvcm0gU3BvdExpZ2h0IHNwb3RMaWdodHNbIE5VTV9TUE9UX0xJR0hUUyBdO1xuXHR2b2lkIGdldFNwb3RMaWdodEluZm8oIGNvbnN0IGluIFNwb3RMaWdodCBzcG90TGlnaHQsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgb3V0IEluY2lkZW50TGlnaHQgbGlnaHQgKSB7XG5cdFx0dmVjMyBsVmVjdG9yID0gc3BvdExpZ2h0LnBvc2l0aW9uIC0gZ2VvbWV0cnlQb3NpdGlvbjtcblx0XHRsaWdodC5kaXJlY3Rpb24gPSBub3JtYWxpemUoIGxWZWN0b3IgKTtcblx0XHRmbG9hdCBhbmdsZUNvcyA9IGRvdCggbGlnaHQuZGlyZWN0aW9uLCBzcG90TGlnaHQuZGlyZWN0aW9uICk7XG5cdFx0ZmxvYXQgc3BvdEF0dGVudWF0aW9uID0gZ2V0U3BvdEF0dGVudWF0aW9uKCBzcG90TGlnaHQuY29uZUNvcywgc3BvdExpZ2h0LnBlbnVtYnJhQ29zLCBhbmdsZUNvcyApO1xuXHRcdGlmICggc3BvdEF0dGVudWF0aW9uID4gMC4wICkge1xuXHRcdFx0ZmxvYXQgbGlnaHREaXN0YW5jZSA9IGxlbmd0aCggbFZlY3RvciApO1xuXHRcdFx0bGlnaHQuY29sb3IgPSBzcG90TGlnaHQuY29sb3IgKiBzcG90QXR0ZW51YXRpb247XG5cdFx0XHRsaWdodC5jb2xvciAqPSBnZXREaXN0YW5jZUF0dGVudWF0aW9uKCBsaWdodERpc3RhbmNlLCBzcG90TGlnaHQuZGlzdGFuY2UsIHNwb3RMaWdodC5kZWNheSApO1xuXHRcdFx0bGlnaHQudmlzaWJsZSA9ICggbGlnaHQuY29sb3IgIT0gdmVjMyggMC4wICkgKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0bGlnaHQuY29sb3IgPSB2ZWMzKCAwLjAgKTtcblx0XHRcdGxpZ2h0LnZpc2libGUgPSBmYWxzZTtcblx0XHR9XG5cdH1cbiNlbmRpZlxuI2lmIE5VTV9SRUNUX0FSRUFfTElHSFRTID4gMFxuXHRzdHJ1Y3QgUmVjdEFyZWFMaWdodCB7XG5cdFx0dmVjMyBjb2xvcjtcblx0XHR2ZWMzIHBvc2l0aW9uO1xuXHRcdHZlYzMgaGFsZldpZHRoO1xuXHRcdHZlYzMgaGFsZkhlaWdodDtcblx0fTtcblx0dW5pZm9ybSBzYW1wbGVyMkQgbHRjXzE7XHR1bmlmb3JtIHNhbXBsZXIyRCBsdGNfMjtcblx0dW5pZm9ybSBSZWN0QXJlYUxpZ2h0IHJlY3RBcmVhTGlnaHRzWyBOVU1fUkVDVF9BUkVBX0xJR0hUUyBdO1xuI2VuZGlmXG4jaWYgTlVNX0hFTUlfTElHSFRTID4gMFxuXHRzdHJ1Y3QgSGVtaXNwaGVyZUxpZ2h0IHtcblx0XHR2ZWMzIGRpcmVjdGlvbjtcblx0XHR2ZWMzIHNreUNvbG9yO1xuXHRcdHZlYzMgZ3JvdW5kQ29sb3I7XG5cdH07XG5cdHVuaWZvcm0gSGVtaXNwaGVyZUxpZ2h0IGhlbWlzcGhlcmVMaWdodHNbIE5VTV9IRU1JX0xJR0hUUyBdO1xuXHR2ZWMzIGdldEhlbWlzcGhlcmVMaWdodElycmFkaWFuY2UoIGNvbnN0IGluIEhlbWlzcGhlcmVMaWdodCBoZW1pTGlnaHQsIGNvbnN0IGluIHZlYzMgbm9ybWFsICkge1xuXHRcdGZsb2F0IGRvdE5MID0gZG90KCBub3JtYWwsIGhlbWlMaWdodC5kaXJlY3Rpb24gKTtcblx0XHRmbG9hdCBoZW1pRGlmZnVzZVdlaWdodCA9IDAuNSAqIGRvdE5MICsgMC41O1xuXHRcdHZlYzMgaXJyYWRpYW5jZSA9IG1peCggaGVtaUxpZ2h0Lmdyb3VuZENvbG9yLCBoZW1pTGlnaHQuc2t5Q29sb3IsIGhlbWlEaWZmdXNlV2VpZ2h0ICk7XG5cdFx0cmV0dXJuIGlycmFkaWFuY2U7XG5cdH1cbiNlbmRpZiI7Cgp2YXIgZW52bWFwX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9FTlZNQVBcblx0dmVjMyBnZXRJQkxJcnJhZGlhbmNlKCBjb25zdCBpbiB2ZWMzIG5vcm1hbCApIHtcblx0XHQjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRV9VVlxuXHRcdFx0dmVjMyB3b3JsZE5vcm1hbCA9IGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIG5vcm1hbCwgdmlld01hdHJpeCApO1xuXHRcdFx0dmVjNCBlbnZNYXBDb2xvciA9IHRleHR1cmVDdWJlVVYoIGVudk1hcCwgd29ybGROb3JtYWwsIDEuMCApO1xuXHRcdFx0cmV0dXJuIFBJICogZW52TWFwQ29sb3IucmdiICogZW52TWFwSW50ZW5zaXR5O1xuXHRcdCNlbHNlXG5cdFx0XHRyZXR1cm4gdmVjMyggMC4wICk7XG5cdFx0I2VuZGlmXG5cdH1cblx0dmVjMyBnZXRJQkxSYWRpYW5jZSggY29uc3QgaW4gdmVjMyB2aWV3RGlyLCBjb25zdCBpbiB2ZWMzIG5vcm1hbCwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzICkge1xuXHRcdCNpZmRlZiBFTlZNQVBfVFlQRV9DVUJFX1VWXG5cdFx0XHR2ZWMzIHJlZmxlY3RWZWMgPSByZWZsZWN0KCAtIHZpZXdEaXIsIG5vcm1hbCApO1xuXHRcdFx0cmVmbGVjdFZlYyA9IG5vcm1hbGl6ZSggbWl4KCByZWZsZWN0VmVjLCBub3JtYWwsIHJvdWdobmVzcyAqIHJvdWdobmVzcykgKTtcblx0XHRcdHJlZmxlY3RWZWMgPSBpbnZlcnNlVHJhbnNmb3JtRGlyZWN0aW9uKCByZWZsZWN0VmVjLCB2aWV3TWF0cml4ICk7XG5cdFx0XHR2ZWM0IGVudk1hcENvbG9yID0gdGV4dHVyZUN1YmVVViggZW52TWFwLCByZWZsZWN0VmVjLCByb3VnaG5lc3MgKTtcblx0XHRcdHJldHVybiBlbnZNYXBDb2xvci5yZ2IgKiBlbnZNYXBJbnRlbnNpdHk7XG5cdFx0I2Vsc2Vcblx0XHRcdHJldHVybiB2ZWMzKCAwLjAgKTtcblx0XHQjZW5kaWZcblx0fVxuXHQjaWZkZWYgVVNFX0FOSVNPVFJPUFlcblx0XHR2ZWMzIGdldElCTEFuaXNvdHJvcHlSYWRpYW5jZSggY29uc3QgaW4gdmVjMyB2aWV3RGlyLCBjb25zdCBpbiB2ZWMzIG5vcm1hbCwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzLCBjb25zdCBpbiB2ZWMzIGJpdGFuZ2VudCwgY29uc3QgaW4gZmxvYXQgYW5pc290cm9weSApIHtcblx0XHRcdCNpZmRlZiBFTlZNQVBfVFlQRV9DVUJFX1VWXG5cdFx0XHRcdHZlYzMgYmVudE5vcm1hbCA9IGNyb3NzKCBiaXRhbmdlbnQsIHZpZXdEaXIgKTtcblx0XHRcdFx0YmVudE5vcm1hbCA9IG5vcm1hbGl6ZSggY3Jvc3MoIGJlbnROb3JtYWwsIGJpdGFuZ2VudCApICk7XG5cdFx0XHRcdGJlbnROb3JtYWwgPSBub3JtYWxpemUoIG1peCggYmVudE5vcm1hbCwgbm9ybWFsLCBwb3cyKCBwb3cyKCAxLjAgLSBhbmlzb3Ryb3B5ICogKCAxLjAgLSByb3VnaG5lc3MgKSApICkgKSApO1xuXHRcdFx0XHRyZXR1cm4gZ2V0SUJMUmFkaWFuY2UoIHZpZXdEaXIsIGJlbnROb3JtYWwsIHJvdWdobmVzcyApO1xuXHRcdFx0I2Vsc2Vcblx0XHRcdFx0cmV0dXJuIHZlYzMoIDAuMCApO1xuXHRcdFx0I2VuZGlmXG5cdFx0fVxuXHQjZW5kaWZcbiNlbmRpZiI7Cgp2YXIgbGlnaHRzX3Rvb25fZnJhZ21lbnQgPSAiVG9vbk1hdGVyaWFsIG1hdGVyaWFsO1xubWF0ZXJpYWwuZGlmZnVzZUNvbG9yID0gZGlmZnVzZUNvbG9yLnJnYjsiOwoKdmFyIGxpZ2h0c190b29uX3BhcnNfZnJhZ21lbnQgPSAidmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG5zdHJ1Y3QgVG9vbk1hdGVyaWFsIHtcblx0dmVjMyBkaWZmdXNlQ29sb3I7XG59O1xudm9pZCBSRV9EaXJlY3RfVG9vbiggY29uc3QgaW4gSW5jaWRlbnRMaWdodCBkaXJlY3RMaWdodCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Tm9ybWFsLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Vmlld0RpciwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgY29uc3QgaW4gVG9vbk1hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCApIHtcblx0dmVjMyBpcnJhZGlhbmNlID0gZ2V0R3JhZGllbnRJcnJhZGlhbmNlKCBnZW9tZXRyeU5vcm1hbCwgZGlyZWN0TGlnaHQuZGlyZWN0aW9uICkgKiBkaXJlY3RMaWdodC5jb2xvcjtcblx0cmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArPSBpcnJhZGlhbmNlICogQlJERl9MYW1iZXJ0KCBtYXRlcmlhbC5kaWZmdXNlQ29sb3IgKTtcbn1cbnZvaWQgUkVfSW5kaXJlY3REaWZmdXNlX1Rvb24oIGNvbnN0IGluIHZlYzMgaXJyYWRpYW5jZSwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Tm9ybWFsLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Vmlld0RpciwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgY29uc3QgaW4gVG9vbk1hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCApIHtcblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IGlycmFkaWFuY2UgKiBCUkRGX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xufVxuI2RlZmluZSBSRV9EaXJlY3RcdFx0XHRcdFJFX0RpcmVjdF9Ub29uXG4jZGVmaW5lIFJFX0luZGlyZWN0RGlmZnVzZVx0XHRSRV9JbmRpcmVjdERpZmZ1c2VfVG9vbiI7Cgp2YXIgbGlnaHRzX3Bob25nX2ZyYWdtZW50ID0gIkJsaW5uUGhvbmdNYXRlcmlhbCBtYXRlcmlhbDtcbm1hdGVyaWFsLmRpZmZ1c2VDb2xvciA9IGRpZmZ1c2VDb2xvci5yZ2I7XG5tYXRlcmlhbC5zcGVjdWxhckNvbG9yID0gc3BlY3VsYXI7XG5tYXRlcmlhbC5zcGVjdWxhclNoaW5pbmVzcyA9IHNoaW5pbmVzcztcbm1hdGVyaWFsLnNwZWN1bGFyU3RyZW5ndGggPSBzcGVjdWxhclN0cmVuZ3RoOyI7Cgp2YXIgbGlnaHRzX3Bob25nX3BhcnNfZnJhZ21lbnQgPSAidmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG5zdHJ1Y3QgQmxpbm5QaG9uZ01hdGVyaWFsIHtcblx0dmVjMyBkaWZmdXNlQ29sb3I7XG5cdHZlYzMgc3BlY3VsYXJDb2xvcjtcblx0ZmxvYXQgc3BlY3VsYXJTaGluaW5lc3M7XG5cdGZsb2F0IHNwZWN1bGFyU3RyZW5ndGg7XG59O1xudm9pZCBSRV9EaXJlY3RfQmxpbm5QaG9uZyggY29uc3QgaW4gSW5jaWRlbnRMaWdodCBkaXJlY3RMaWdodCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Tm9ybWFsLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Vmlld0RpciwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgY29uc3QgaW4gQmxpbm5QaG9uZ01hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCApIHtcblx0ZmxvYXQgZG90TkwgPSBzYXR1cmF0ZSggZG90KCBnZW9tZXRyeU5vcm1hbCwgZGlyZWN0TGlnaHQuZGlyZWN0aW9uICkgKTtcblx0dmVjMyBpcnJhZGlhbmNlID0gZG90TkwgKiBkaXJlY3RMaWdodC5jb2xvcjtcblx0cmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArPSBpcnJhZGlhbmNlICogQlJERl9MYW1iZXJ0KCBtYXRlcmlhbC5kaWZmdXNlQ29sb3IgKTtcblx0cmVmbGVjdGVkTGlnaHQuZGlyZWN0U3BlY3VsYXIgKz0gaXJyYWRpYW5jZSAqIEJSREZfQmxpbm5QaG9uZyggZGlyZWN0TGlnaHQuZGlyZWN0aW9uLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Tm9ybWFsLCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yLCBtYXRlcmlhbC5zcGVjdWxhclNoaW5pbmVzcyApICogbWF0ZXJpYWwuc3BlY3VsYXJTdHJlbmd0aDtcbn1cbnZvaWQgUkVfSW5kaXJlY3REaWZmdXNlX0JsaW5uUGhvbmcoIGNvbnN0IGluIHZlYzMgaXJyYWRpYW5jZSwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Tm9ybWFsLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Vmlld0RpciwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgY29uc3QgaW4gQmxpbm5QaG9uZ01hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCApIHtcblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IGlycmFkaWFuY2UgKiBCUkRGX0xhbWJlcnQoIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciApO1xufVxuI2RlZmluZSBSRV9EaXJlY3RcdFx0XHRcdFJFX0RpcmVjdF9CbGlublBob25nXG4jZGVmaW5lIFJFX0luZGlyZWN0RGlmZnVzZVx0XHRSRV9JbmRpcmVjdERpZmZ1c2VfQmxpbm5QaG9uZyI7Cgp2YXIgbGlnaHRzX3BoeXNpY2FsX2ZyYWdtZW50ID0gIlBoeXNpY2FsTWF0ZXJpYWwgbWF0ZXJpYWw7XG5tYXRlcmlhbC5kaWZmdXNlQ29sb3IgPSBkaWZmdXNlQ29sb3IucmdiICogKCAxLjAgLSBtZXRhbG5lc3NGYWN0b3IgKTtcbnZlYzMgZHh5ID0gbWF4KCBhYnMoIGRGZHgoIG5vblBlcnR1cmJlZE5vcm1hbCApICksIGFicyggZEZkeSggbm9uUGVydHVyYmVkTm9ybWFsICkgKSApO1xuZmxvYXQgZ2VvbWV0cnlSb3VnaG5lc3MgPSBtYXgoIG1heCggZHh5LngsIGR4eS55ICksIGR4eS56ICk7XG5tYXRlcmlhbC5yb3VnaG5lc3MgPSBtYXgoIHJvdWdobmVzc0ZhY3RvciwgMC4wNTI1ICk7bWF0ZXJpYWwucm91Z2huZXNzICs9IGdlb21ldHJ5Um91Z2huZXNzO1xubWF0ZXJpYWwucm91Z2huZXNzID0gbWluKCBtYXRlcmlhbC5yb3VnaG5lc3MsIDEuMCApO1xuI2lmZGVmIElPUlxuXHRtYXRlcmlhbC5pb3IgPSBpb3I7XG5cdCNpZmRlZiBVU0VfU1BFQ1VMQVJcblx0XHRmbG9hdCBzcGVjdWxhckludGVuc2l0eUZhY3RvciA9IHNwZWN1bGFySW50ZW5zaXR5O1xuXHRcdHZlYzMgc3BlY3VsYXJDb2xvckZhY3RvciA9IHNwZWN1bGFyQ29sb3I7XG5cdFx0I2lmZGVmIFVTRV9TUEVDVUxBUl9DT0xPUk1BUFxuXHRcdFx0c3BlY3VsYXJDb2xvckZhY3RvciAqPSB0ZXh0dXJlMkQoIHNwZWN1bGFyQ29sb3JNYXAsIHZTcGVjdWxhckNvbG9yTWFwVXYgKS5yZ2I7XG5cdFx0I2VuZGlmXG5cdFx0I2lmZGVmIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVBcblx0XHRcdHNwZWN1bGFySW50ZW5zaXR5RmFjdG9yICo9IHRleHR1cmUyRCggc3BlY3VsYXJJbnRlbnNpdHlNYXAsIHZTcGVjdWxhckludGVuc2l0eU1hcFV2ICkuYTtcblx0XHQjZW5kaWZcblx0XHRtYXRlcmlhbC5zcGVjdWxhckY5MCA9IG1peCggc3BlY3VsYXJJbnRlbnNpdHlGYWN0b3IsIDEuMCwgbWV0YWxuZXNzRmFjdG9yICk7XG5cdCNlbHNlXG5cdFx0ZmxvYXQgc3BlY3VsYXJJbnRlbnNpdHlGYWN0b3IgPSAxLjA7XG5cdFx0dmVjMyBzcGVjdWxhckNvbG9yRmFjdG9yID0gdmVjMyggMS4wICk7XG5cdFx0bWF0ZXJpYWwuc3BlY3VsYXJGOTAgPSAxLjA7XG5cdCNlbmRpZlxuXHRtYXRlcmlhbC5zcGVjdWxhckNvbG9yID0gbWl4KCBtaW4oIHBvdzIoICggbWF0ZXJpYWwuaW9yIC0gMS4wICkgLyAoIG1hdGVyaWFsLmlvciArIDEuMCApICkgKiBzcGVjdWxhckNvbG9yRmFjdG9yLCB2ZWMzKCAxLjAgKSApICogc3BlY3VsYXJJbnRlbnNpdHlGYWN0b3IsIGRpZmZ1c2VDb2xvci5yZ2IsIG1ldGFsbmVzc0ZhY3RvciApO1xuI2Vsc2Vcblx0bWF0ZXJpYWwuc3BlY3VsYXJDb2xvciA9IG1peCggdmVjMyggMC4wNCApLCBkaWZmdXNlQ29sb3IucmdiLCBtZXRhbG5lc3NGYWN0b3IgKTtcblx0bWF0ZXJpYWwuc3BlY3VsYXJGOTAgPSAxLjA7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUXG5cdG1hdGVyaWFsLmNsZWFyY29hdCA9IGNsZWFyY29hdDtcblx0bWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzID0gY2xlYXJjb2F0Um91Z2huZXNzO1xuXHRtYXRlcmlhbC5jbGVhcmNvYXRGMCA9IHZlYzMoIDAuMDQgKTtcblx0bWF0ZXJpYWwuY2xlYXJjb2F0RjkwID0gMS4wO1xuXHQjaWZkZWYgVVNFX0NMRUFSQ09BVE1BUFxuXHRcdG1hdGVyaWFsLmNsZWFyY29hdCAqPSB0ZXh0dXJlMkQoIGNsZWFyY29hdE1hcCwgdkNsZWFyY29hdE1hcFV2ICkueDtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfQ0xFQVJDT0FUX1JPVUdITkVTU01BUFxuXHRcdG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcyAqPSB0ZXh0dXJlMkQoIGNsZWFyY29hdFJvdWdobmVzc01hcCwgdkNsZWFyY29hdFJvdWdobmVzc01hcFV2ICkueTtcblx0I2VuZGlmXG5cdG1hdGVyaWFsLmNsZWFyY29hdCA9IHNhdHVyYXRlKCBtYXRlcmlhbC5jbGVhcmNvYXQgKTtcdG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcyA9IG1heCggbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzLCAwLjA1MjUgKTtcblx0bWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzICs9IGdlb21ldHJ5Um91Z2huZXNzO1xuXHRtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3MgPSBtaW4oIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcywgMS4wICk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0Vcblx0bWF0ZXJpYWwuaXJpZGVzY2VuY2UgPSBpcmlkZXNjZW5jZTtcblx0bWF0ZXJpYWwuaXJpZGVzY2VuY2VJT1IgPSBpcmlkZXNjZW5jZUlPUjtcblx0I2lmZGVmIFVTRV9JUklERVNDRU5DRU1BUFxuXHRcdG1hdGVyaWFsLmlyaWRlc2NlbmNlICo9IHRleHR1cmUyRCggaXJpZGVzY2VuY2VNYXAsIHZJcmlkZXNjZW5jZU1hcFV2ICkucjtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQXG5cdFx0bWF0ZXJpYWwuaXJpZGVzY2VuY2VUaGlja25lc3MgPSAoaXJpZGVzY2VuY2VUaGlja25lc3NNYXhpbXVtIC0gaXJpZGVzY2VuY2VUaGlja25lc3NNaW5pbXVtKSAqIHRleHR1cmUyRCggaXJpZGVzY2VuY2VUaGlja25lc3NNYXAsIHZJcmlkZXNjZW5jZVRoaWNrbmVzc01hcFV2ICkuZyArIGlyaWRlc2NlbmNlVGhpY2tuZXNzTWluaW11bTtcblx0I2Vsc2Vcblx0XHRtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzcyA9IGlyaWRlc2NlbmNlVGhpY2tuZXNzTWF4aW11bTtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfU0hFRU5cblx0bWF0ZXJpYWwuc2hlZW5Db2xvciA9IHNoZWVuQ29sb3I7XG5cdCNpZmRlZiBVU0VfU0hFRU5fQ09MT1JNQVBcblx0XHRtYXRlcmlhbC5zaGVlbkNvbG9yICo9IHRleHR1cmUyRCggc2hlZW5Db2xvck1hcCwgdlNoZWVuQ29sb3JNYXBVdiApLnJnYjtcblx0I2VuZGlmXG5cdG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzID0gY2xhbXAoIHNoZWVuUm91Z2huZXNzLCAwLjA3LCAxLjAgKTtcblx0I2lmZGVmIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVBcblx0XHRtYXRlcmlhbC5zaGVlblJvdWdobmVzcyAqPSB0ZXh0dXJlMkQoIHNoZWVuUm91Z2huZXNzTWFwLCB2U2hlZW5Sb3VnaG5lc3NNYXBVdiApLmE7XG5cdCNlbmRpZlxuI2VuZGlmXG4jaWZkZWYgVVNFX0FOSVNPVFJPUFlcblx0I2lmZGVmIFVTRV9BTklTT1RST1BZTUFQXG5cdFx0bWF0MiBhbmlzb3Ryb3B5TWF0ID0gbWF0MiggYW5pc290cm9weVZlY3Rvci54LCBhbmlzb3Ryb3B5VmVjdG9yLnksIC0gYW5pc290cm9weVZlY3Rvci55LCBhbmlzb3Ryb3B5VmVjdG9yLnggKTtcblx0XHR2ZWMzIGFuaXNvdHJvcHlQb2xhciA9IHRleHR1cmUyRCggYW5pc290cm9weU1hcCwgdkFuaXNvdHJvcHlNYXBVdiApLnJnYjtcblx0XHR2ZWMyIGFuaXNvdHJvcHlWID0gYW5pc290cm9weU1hdCAqIG5vcm1hbGl6ZSggMi4wICogYW5pc290cm9weVBvbGFyLnJnIC0gdmVjMiggMS4wICkgKSAqIGFuaXNvdHJvcHlQb2xhci5iO1xuXHQjZWxzZVxuXHRcdHZlYzIgYW5pc290cm9weVYgPSBhbmlzb3Ryb3B5VmVjdG9yO1xuXHQjZW5kaWZcblx0bWF0ZXJpYWwuYW5pc290cm9weSA9IGxlbmd0aCggYW5pc290cm9weVYgKTtcblx0YW5pc290cm9weVYgLz0gbWF0ZXJpYWwuYW5pc290cm9weTtcblx0bWF0ZXJpYWwuYW5pc290cm9weSA9IHNhdHVyYXRlKCBtYXRlcmlhbC5hbmlzb3Ryb3B5ICk7XG5cdG1hdGVyaWFsLmFscGhhVCA9IG1peCggcG93MiggbWF0ZXJpYWwucm91Z2huZXNzICksIDEuMCwgcG93MiggbWF0ZXJpYWwuYW5pc290cm9weSApICk7XG5cdG1hdGVyaWFsLmFuaXNvdHJvcHlUID0gdGJuWyAwIF0gKiBhbmlzb3Ryb3B5Vi54IC0gdGJuWyAxIF0gKiBhbmlzb3Ryb3B5Vi55O1xuXHRtYXRlcmlhbC5hbmlzb3Ryb3B5QiA9IHRiblsgMSBdICogYW5pc290cm9weVYueCArIHRiblsgMCBdICogYW5pc290cm9weVYueTtcbiNlbmRpZiI7Cgp2YXIgbGlnaHRzX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQgPSAic3RydWN0IFBoeXNpY2FsTWF0ZXJpYWwge1xuXHR2ZWMzIGRpZmZ1c2VDb2xvcjtcblx0ZmxvYXQgcm91Z2huZXNzO1xuXHR2ZWMzIHNwZWN1bGFyQ29sb3I7XG5cdGZsb2F0IHNwZWN1bGFyRjkwO1xuXHQjaWZkZWYgVVNFX0NMRUFSQ09BVFxuXHRcdGZsb2F0IGNsZWFyY29hdDtcblx0XHRmbG9hdCBjbGVhcmNvYXRSb3VnaG5lc3M7XG5cdFx0dmVjMyBjbGVhcmNvYXRGMDtcblx0XHRmbG9hdCBjbGVhcmNvYXRGOTA7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX0lSSURFU0NFTkNFXG5cdFx0ZmxvYXQgaXJpZGVzY2VuY2U7XG5cdFx0ZmxvYXQgaXJpZGVzY2VuY2VJT1I7XG5cdFx0ZmxvYXQgaXJpZGVzY2VuY2VUaGlja25lc3M7XG5cdFx0dmVjMyBpcmlkZXNjZW5jZUZyZXNuZWw7XG5cdFx0dmVjMyBpcmlkZXNjZW5jZUYwO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9TSEVFTlxuXHRcdHZlYzMgc2hlZW5Db2xvcjtcblx0XHRmbG9hdCBzaGVlblJvdWdobmVzcztcblx0I2VuZGlmXG5cdCNpZmRlZiBJT1Jcblx0XHRmbG9hdCBpb3I7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1RSQU5TTUlTU0lPTlxuXHRcdGZsb2F0IHRyYW5zbWlzc2lvbjtcblx0XHRmbG9hdCB0cmFuc21pc3Npb25BbHBoYTtcblx0XHRmbG9hdCB0aGlja25lc3M7XG5cdFx0ZmxvYXQgYXR0ZW51YXRpb25EaXN0YW5jZTtcblx0XHR2ZWMzIGF0dGVudWF0aW9uQ29sb3I7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX0FOSVNPVFJPUFlcblx0XHRmbG9hdCBhbmlzb3Ryb3B5O1xuXHRcdGZsb2F0IGFscGhhVDtcblx0XHR2ZWMzIGFuaXNvdHJvcHlUO1xuXHRcdHZlYzMgYW5pc290cm9weUI7XG5cdCNlbmRpZlxufTtcbnZlYzMgY2xlYXJjb2F0U3BlY3VsYXIgPSB2ZWMzKCAwLjAgKTtcbnZlYzMgc2hlZW5TcGVjdWxhciA9IHZlYzMoIDAuMCApO1xudmVjMyBTY2hsaWNrX3RvX0YwKCBjb25zdCBpbiB2ZWMzIGYsIGNvbnN0IGluIGZsb2F0IGY5MCwgY29uc3QgaW4gZmxvYXQgZG90VkggKSB7XG4gICAgZmxvYXQgeCA9IGNsYW1wKCAxLjAgLSBkb3RWSCwgMC4wLCAxLjAgKTtcbiAgICBmbG9hdCB4MiA9IHggKiB4O1xuICAgIGZsb2F0IHg1ID0gY2xhbXAoIHggKiB4MiAqIHgyLCAwLjAsIDAuOTk5OSApO1xuICAgIHJldHVybiAoIGYgLSB2ZWMzKCBmOTAgKSAqIHg1ICkgLyAoIDEuMCAtIHg1ICk7XG59XG5mbG9hdCBWX0dHWF9TbWl0aENvcnJlbGF0ZWQoIGNvbnN0IGluIGZsb2F0IGFscGhhLCBjb25zdCBpbiBmbG9hdCBkb3ROTCwgY29uc3QgaW4gZmxvYXQgZG90TlYgKSB7XG5cdGZsb2F0IGEyID0gcG93MiggYWxwaGEgKTtcblx0ZmxvYXQgZ3YgPSBkb3ROTCAqIHNxcnQoIGEyICsgKCAxLjAgLSBhMiApICogcG93MiggZG90TlYgKSApO1xuXHRmbG9hdCBnbCA9IGRvdE5WICogc3FydCggYTIgKyAoIDEuMCAtIGEyICkgKiBwb3cyKCBkb3ROTCApICk7XG5cdHJldHVybiAwLjUgLyBtYXgoIGd2ICsgZ2wsIEVQU0lMT04gKTtcbn1cbmZsb2F0IERfR0dYKCBjb25zdCBpbiBmbG9hdCBhbHBoYSwgY29uc3QgaW4gZmxvYXQgZG90TkggKSB7XG5cdGZsb2F0IGEyID0gcG93MiggYWxwaGEgKTtcblx0ZmxvYXQgZGVub20gPSBwb3cyKCBkb3ROSCApICogKCBhMiAtIDEuMCApICsgMS4wO1xuXHRyZXR1cm4gUkVDSVBST0NBTF9QSSAqIGEyIC8gcG93MiggZGVub20gKTtcbn1cbiNpZmRlZiBVU0VfQU5JU09UUk9QWVxuXHRmbG9hdCBWX0dHWF9TbWl0aENvcnJlbGF0ZWRfQW5pc290cm9waWMoIGNvbnN0IGluIGZsb2F0IGFscGhhVCwgY29uc3QgaW4gZmxvYXQgYWxwaGFCLCBjb25zdCBpbiBmbG9hdCBkb3RUViwgY29uc3QgaW4gZmxvYXQgZG90QlYsIGNvbnN0IGluIGZsb2F0IGRvdFRMLCBjb25zdCBpbiBmbG9hdCBkb3RCTCwgY29uc3QgaW4gZmxvYXQgZG90TlYsIGNvbnN0IGluIGZsb2F0IGRvdE5MICkge1xuXHRcdGZsb2F0IGd2ID0gZG90TkwgKiBsZW5ndGgoIHZlYzMoIGFscGhhVCAqIGRvdFRWLCBhbHBoYUIgKiBkb3RCViwgZG90TlYgKSApO1xuXHRcdGZsb2F0IGdsID0gZG90TlYgKiBsZW5ndGgoIHZlYzMoIGFscGhhVCAqIGRvdFRMLCBhbHBoYUIgKiBkb3RCTCwgZG90TkwgKSApO1xuXHRcdGZsb2F0IHYgPSAwLjUgLyAoIGd2ICsgZ2wgKTtcblx0XHRyZXR1cm4gc2F0dXJhdGUodik7XG5cdH1cblx0ZmxvYXQgRF9HR1hfQW5pc290cm9waWMoIGNvbnN0IGluIGZsb2F0IGFscGhhVCwgY29uc3QgaW4gZmxvYXQgYWxwaGFCLCBjb25zdCBpbiBmbG9hdCBkb3ROSCwgY29uc3QgaW4gZmxvYXQgZG90VEgsIGNvbnN0IGluIGZsb2F0IGRvdEJIICkge1xuXHRcdGZsb2F0IGEyID0gYWxwaGFUICogYWxwaGFCO1xuXHRcdGhpZ2hwIHZlYzMgdiA9IHZlYzMoIGFscGhhQiAqIGRvdFRILCBhbHBoYVQgKiBkb3RCSCwgYTIgKiBkb3ROSCApO1xuXHRcdGhpZ2hwIGZsb2F0IHYyID0gZG90KCB2LCB2ICk7XG5cdFx0ZmxvYXQgdzIgPSBhMiAvIHYyO1xuXHRcdHJldHVybiBSRUNJUFJPQ0FMX1BJICogYTIgKiBwb3cyICggdzIgKTtcblx0fVxuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVFxuXHR2ZWMzIEJSREZfR0dYX0NsZWFyY29hdCggY29uc3QgaW4gdmVjMyBsaWdodERpciwgY29uc3QgaW4gdmVjMyB2aWV3RGlyLCBjb25zdCBpbiB2ZWMzIG5vcm1hbCwgY29uc3QgaW4gUGh5c2ljYWxNYXRlcmlhbCBtYXRlcmlhbCkge1xuXHRcdHZlYzMgZjAgPSBtYXRlcmlhbC5jbGVhcmNvYXRGMDtcblx0XHRmbG9hdCBmOTAgPSBtYXRlcmlhbC5jbGVhcmNvYXRGOTA7XG5cdFx0ZmxvYXQgcm91Z2huZXNzID0gbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzO1xuXHRcdGZsb2F0IGFscGhhID0gcG93Miggcm91Z2huZXNzICk7XG5cdFx0dmVjMyBoYWxmRGlyID0gbm9ybWFsaXplKCBsaWdodERpciArIHZpZXdEaXIgKTtcblx0XHRmbG9hdCBkb3ROTCA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgbGlnaHREaXIgKSApO1xuXHRcdGZsb2F0IGRvdE5WID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCB2aWV3RGlyICkgKTtcblx0XHRmbG9hdCBkb3ROSCA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgaGFsZkRpciApICk7XG5cdFx0ZmxvYXQgZG90VkggPSBzYXR1cmF0ZSggZG90KCB2aWV3RGlyLCBoYWxmRGlyICkgKTtcblx0XHR2ZWMzIEYgPSBGX1NjaGxpY2soIGYwLCBmOTAsIGRvdFZIICk7XG5cdFx0ZmxvYXQgViA9IFZfR0dYX1NtaXRoQ29ycmVsYXRlZCggYWxwaGEsIGRvdE5MLCBkb3ROViApO1xuXHRcdGZsb2F0IEQgPSBEX0dHWCggYWxwaGEsIGRvdE5IICk7XG5cdFx0cmV0dXJuIEYgKiAoIFYgKiBEICk7XG5cdH1cbiNlbmRpZlxudmVjMyBCUkRGX0dHWCggY29uc3QgaW4gdmVjMyBsaWdodERpciwgY29uc3QgaW4gdmVjMyB2aWV3RGlyLCBjb25zdCBpbiB2ZWMzIG5vcm1hbCwgY29uc3QgaW4gUGh5c2ljYWxNYXRlcmlhbCBtYXRlcmlhbCApIHtcblx0dmVjMyBmMCA9IG1hdGVyaWFsLnNwZWN1bGFyQ29sb3I7XG5cdGZsb2F0IGY5MCA9IG1hdGVyaWFsLnNwZWN1bGFyRjkwO1xuXHRmbG9hdCByb3VnaG5lc3MgPSBtYXRlcmlhbC5yb3VnaG5lc3M7XG5cdGZsb2F0IGFscGhhID0gcG93Miggcm91Z2huZXNzICk7XG5cdHZlYzMgaGFsZkRpciA9IG5vcm1hbGl6ZSggbGlnaHREaXIgKyB2aWV3RGlyICk7XG5cdGZsb2F0IGRvdE5MID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCBsaWdodERpciApICk7XG5cdGZsb2F0IGRvdE5WID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCB2aWV3RGlyICkgKTtcblx0ZmxvYXQgZG90TkggPSBzYXR1cmF0ZSggZG90KCBub3JtYWwsIGhhbGZEaXIgKSApO1xuXHRmbG9hdCBkb3RWSCA9IHNhdHVyYXRlKCBkb3QoIHZpZXdEaXIsIGhhbGZEaXIgKSApO1xuXHR2ZWMzIEYgPSBGX1NjaGxpY2soIGYwLCBmOTAsIGRvdFZIICk7XG5cdCNpZmRlZiBVU0VfSVJJREVTQ0VOQ0Vcblx0XHRGID0gbWl4KCBGLCBtYXRlcmlhbC5pcmlkZXNjZW5jZUZyZXNuZWwsIG1hdGVyaWFsLmlyaWRlc2NlbmNlICk7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX0FOSVNPVFJPUFlcblx0XHRmbG9hdCBkb3RUTCA9IGRvdCggbWF0ZXJpYWwuYW5pc290cm9weVQsIGxpZ2h0RGlyICk7XG5cdFx0ZmxvYXQgZG90VFYgPSBkb3QoIG1hdGVyaWFsLmFuaXNvdHJvcHlULCB2aWV3RGlyICk7XG5cdFx0ZmxvYXQgZG90VEggPSBkb3QoIG1hdGVyaWFsLmFuaXNvdHJvcHlULCBoYWxmRGlyICk7XG5cdFx0ZmxvYXQgZG90QkwgPSBkb3QoIG1hdGVyaWFsLmFuaXNvdHJvcHlCLCBsaWdodERpciApO1xuXHRcdGZsb2F0IGRvdEJWID0gZG90KCBtYXRlcmlhbC5hbmlzb3Ryb3B5Qiwgdmlld0RpciApO1xuXHRcdGZsb2F0IGRvdEJIID0gZG90KCBtYXRlcmlhbC5hbmlzb3Ryb3B5QiwgaGFsZkRpciApO1xuXHRcdGZsb2F0IFYgPSBWX0dHWF9TbWl0aENvcnJlbGF0ZWRfQW5pc290cm9waWMoIG1hdGVyaWFsLmFscGhhVCwgYWxwaGEsIGRvdFRWLCBkb3RCViwgZG90VEwsIGRvdEJMLCBkb3ROViwgZG90TkwgKTtcblx0XHRmbG9hdCBEID0gRF9HR1hfQW5pc290cm9waWMoIG1hdGVyaWFsLmFscGhhVCwgYWxwaGEsIGRvdE5ILCBkb3RUSCwgZG90QkggKTtcblx0I2Vsc2Vcblx0XHRmbG9hdCBWID0gVl9HR1hfU21pdGhDb3JyZWxhdGVkKCBhbHBoYSwgZG90TkwsIGRvdE5WICk7XG5cdFx0ZmxvYXQgRCA9IERfR0dYKCBhbHBoYSwgZG90TkggKTtcblx0I2VuZGlmXG5cdHJldHVybiBGICogKCBWICogRCApO1xufVxudmVjMiBMVENfVXYoIGNvbnN0IGluIHZlYzMgTiwgY29uc3QgaW4gdmVjMyBWLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdGNvbnN0IGZsb2F0IExVVF9TSVpFID0gNjQuMDtcblx0Y29uc3QgZmxvYXQgTFVUX1NDQUxFID0gKCBMVVRfU0laRSAtIDEuMCApIC8gTFVUX1NJWkU7XG5cdGNvbnN0IGZsb2F0IExVVF9CSUFTID0gMC41IC8gTFVUX1NJWkU7XG5cdGZsb2F0IGRvdE5WID0gc2F0dXJhdGUoIGRvdCggTiwgViApICk7XG5cdHZlYzIgdXYgPSB2ZWMyKCByb3VnaG5lc3MsIHNxcnQoIDEuMCAtIGRvdE5WICkgKTtcblx0dXYgPSB1diAqIExVVF9TQ0FMRSArIExVVF9CSUFTO1xuXHRyZXR1cm4gdXY7XG59XG5mbG9hdCBMVENfQ2xpcHBlZFNwaGVyZUZvcm1GYWN0b3IoIGNvbnN0IGluIHZlYzMgZiApIHtcblx0ZmxvYXQgbCA9IGxlbmd0aCggZiApO1xuXHRyZXR1cm4gbWF4KCAoIGwgKiBsICsgZi56ICkgLyAoIGwgKyAxLjAgKSwgMC4wICk7XG59XG52ZWMzIExUQ19FZGdlVmVjdG9yRm9ybUZhY3RvciggY29uc3QgaW4gdmVjMyB2MSwgY29uc3QgaW4gdmVjMyB2MiApIHtcblx0ZmxvYXQgeCA9IGRvdCggdjEsIHYyICk7XG5cdGZsb2F0IHkgPSBhYnMoIHggKTtcblx0ZmxvYXQgYSA9IDAuODU0Mzk4NSArICggMC40OTY1MTU1ICsgMC4wMTQ1MjA2ICogeSApICogeTtcblx0ZmxvYXQgYiA9IDMuNDE3NTk0MCArICggNC4xNjE2NzI0ICsgeSApICogeTtcblx0ZmxvYXQgdiA9IGEgLyBiO1xuXHRmbG9hdCB0aGV0YV9zaW50aGV0YSA9ICggeCA+IDAuMCApID8gdiA6IDAuNSAqIGludmVyc2VzcXJ0KCBtYXgoIDEuMCAtIHggKiB4LCAxZS03ICkgKSAtIHY7XG5cdHJldHVybiBjcm9zcyggdjEsIHYyICkgKiB0aGV0YV9zaW50aGV0YTtcbn1cbnZlYzMgTFRDX0V2YWx1YXRlKCBjb25zdCBpbiB2ZWMzIE4sIGNvbnN0IGluIHZlYzMgViwgY29uc3QgaW4gdmVjMyBQLCBjb25zdCBpbiBtYXQzIG1JbnYsIGNvbnN0IGluIHZlYzMgcmVjdENvb3Jkc1sgNCBdICkge1xuXHR2ZWMzIHYxID0gcmVjdENvb3Jkc1sgMSBdIC0gcmVjdENvb3Jkc1sgMCBdO1xuXHR2ZWMzIHYyID0gcmVjdENvb3Jkc1sgMyBdIC0gcmVjdENvb3Jkc1sgMCBdO1xuXHR2ZWMzIGxpZ2h0Tm9ybWFsID0gY3Jvc3MoIHYxLCB2MiApO1xuXHRpZiggZG90KCBsaWdodE5vcm1hbCwgUCAtIHJlY3RDb29yZHNbIDAgXSApIDwgMC4wICkgcmV0dXJuIHZlYzMoIDAuMCApO1xuXHR2ZWMzIFQxLCBUMjtcblx0VDEgPSBub3JtYWxpemUoIFYgLSBOICogZG90KCBWLCBOICkgKTtcblx0VDIgPSAtIGNyb3NzKCBOLCBUMSApO1xuXHRtYXQzIG1hdCA9IG1JbnYgKiB0cmFuc3Bvc2VNYXQzKCBtYXQzKCBUMSwgVDIsIE4gKSApO1xuXHR2ZWMzIGNvb3Jkc1sgNCBdO1xuXHRjb29yZHNbIDAgXSA9IG1hdCAqICggcmVjdENvb3Jkc1sgMCBdIC0gUCApO1xuXHRjb29yZHNbIDEgXSA9IG1hdCAqICggcmVjdENvb3Jkc1sgMSBdIC0gUCApO1xuXHRjb29yZHNbIDIgXSA9IG1hdCAqICggcmVjdENvb3Jkc1sgMiBdIC0gUCApO1xuXHRjb29yZHNbIDMgXSA9IG1hdCAqICggcmVjdENvb3Jkc1sgMyBdIC0gUCApO1xuXHRjb29yZHNbIDAgXSA9IG5vcm1hbGl6ZSggY29vcmRzWyAwIF0gKTtcblx0Y29vcmRzWyAxIF0gPSBub3JtYWxpemUoIGNvb3Jkc1sgMSBdICk7XG5cdGNvb3Jkc1sgMiBdID0gbm9ybWFsaXplKCBjb29yZHNbIDIgXSApO1xuXHRjb29yZHNbIDMgXSA9IG5vcm1hbGl6ZSggY29vcmRzWyAzIF0gKTtcblx0dmVjMyB2ZWN0b3JGb3JtRmFjdG9yID0gdmVjMyggMC4wICk7XG5cdHZlY3RvckZvcm1GYWN0b3IgKz0gTFRDX0VkZ2VWZWN0b3JGb3JtRmFjdG9yKCBjb29yZHNbIDAgXSwgY29vcmRzWyAxIF0gKTtcblx0dmVjdG9yRm9ybUZhY3RvciArPSBMVENfRWRnZVZlY3RvckZvcm1GYWN0b3IoIGNvb3Jkc1sgMSBdLCBjb29yZHNbIDIgXSApO1xuXHR2ZWN0b3JGb3JtRmFjdG9yICs9IExUQ19FZGdlVmVjdG9yRm9ybUZhY3RvciggY29vcmRzWyAyIF0sIGNvb3Jkc1sgMyBdICk7XG5cdHZlY3RvckZvcm1GYWN0b3IgKz0gTFRDX0VkZ2VWZWN0b3JGb3JtRmFjdG9yKCBjb29yZHNbIDMgXSwgY29vcmRzWyAwIF0gKTtcblx0ZmxvYXQgcmVzdWx0ID0gTFRDX0NsaXBwZWRTcGhlcmVGb3JtRmFjdG9yKCB2ZWN0b3JGb3JtRmFjdG9yICk7XG5cdHJldHVybiB2ZWMzKCByZXN1bHQgKTtcbn1cbiNpZiBkZWZpbmVkKCBVU0VfU0hFRU4gKVxuZmxvYXQgRF9DaGFybGllKCBmbG9hdCByb3VnaG5lc3MsIGZsb2F0IGRvdE5IICkge1xuXHRmbG9hdCBhbHBoYSA9IHBvdzIoIHJvdWdobmVzcyApO1xuXHRmbG9hdCBpbnZBbHBoYSA9IDEuMCAvIGFscGhhO1xuXHRmbG9hdCBjb3MyaCA9IGRvdE5IICogZG90Tkg7XG5cdGZsb2F0IHNpbjJoID0gbWF4KCAxLjAgLSBjb3MyaCwgMC4wMDc4MTI1ICk7XG5cdHJldHVybiAoIDIuMCArIGludkFscGhhICkgKiBwb3coIHNpbjJoLCBpbnZBbHBoYSAqIDAuNSApIC8gKCAyLjAgKiBQSSApO1xufVxuZmxvYXQgVl9OZXViZWx0KCBmbG9hdCBkb3ROViwgZmxvYXQgZG90TkwgKSB7XG5cdHJldHVybiBzYXR1cmF0ZSggMS4wIC8gKCA0LjAgKiAoIGRvdE5MICsgZG90TlYgLSBkb3ROTCAqIGRvdE5WICkgKSApO1xufVxudmVjMyBCUkRGX1NoZWVuKCBjb25zdCBpbiB2ZWMzIGxpZ2h0RGlyLCBjb25zdCBpbiB2ZWMzIHZpZXdEaXIsIGNvbnN0IGluIHZlYzMgbm9ybWFsLCB2ZWMzIHNoZWVuQ29sb3IsIGNvbnN0IGluIGZsb2F0IHNoZWVuUm91Z2huZXNzICkge1xuXHR2ZWMzIGhhbGZEaXIgPSBub3JtYWxpemUoIGxpZ2h0RGlyICsgdmlld0RpciApO1xuXHRmbG9hdCBkb3ROTCA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgbGlnaHREaXIgKSApO1xuXHRmbG9hdCBkb3ROViA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgdmlld0RpciApICk7XG5cdGZsb2F0IGRvdE5IID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCBoYWxmRGlyICkgKTtcblx0ZmxvYXQgRCA9IERfQ2hhcmxpZSggc2hlZW5Sb3VnaG5lc3MsIGRvdE5IICk7XG5cdGZsb2F0IFYgPSBWX05ldWJlbHQoIGRvdE5WLCBkb3ROTCApO1xuXHRyZXR1cm4gc2hlZW5Db2xvciAqICggRCAqIFYgKTtcbn1cbiNlbmRpZlxuZmxvYXQgSUJMU2hlZW5CUkRGKCBjb25zdCBpbiB2ZWMzIG5vcm1hbCwgY29uc3QgaW4gdmVjMyB2aWV3RGlyLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdGZsb2F0IGRvdE5WID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCB2aWV3RGlyICkgKTtcblx0ZmxvYXQgcjIgPSByb3VnaG5lc3MgKiByb3VnaG5lc3M7XG5cdGZsb2F0IGEgPSByb3VnaG5lc3MgPCAwLjI1ID8gLTMzOS4yICogcjIgKyAxNjEuNCAqIHJvdWdobmVzcyAtIDI1LjkgOiAtOC40OCAqIHIyICsgMTQuMyAqIHJvdWdobmVzcyAtIDkuOTU7XG5cdGZsb2F0IGIgPSByb3VnaG5lc3MgPCAwLjI1ID8gNDQuMCAqIHIyIC0gMjMuNyAqIHJvdWdobmVzcyArIDMuMjYgOiAxLjk3ICogcjIgLSAzLjI3ICogcm91Z2huZXNzICsgMC43Mjtcblx0ZmxvYXQgREcgPSBleHAoIGEgKiBkb3ROViArIGIgKSArICggcm91Z2huZXNzIDwgMC4yNSA/IDAuMCA6IDAuMSAqICggcm91Z2huZXNzIC0gMC4yNSApICk7XG5cdHJldHVybiBzYXR1cmF0ZSggREcgKiBSRUNJUFJPQ0FMX1BJICk7XG59XG52ZWMyIERGR0FwcHJveCggY29uc3QgaW4gdmVjMyBub3JtYWwsIGNvbnN0IGluIHZlYzMgdmlld0RpciwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzICkge1xuXHRmbG9hdCBkb3ROViA9IHNhdHVyYXRlKCBkb3QoIG5vcm1hbCwgdmlld0RpciApICk7XG5cdGNvbnN0IHZlYzQgYzAgPSB2ZWM0KCAtIDEsIC0gMC4wMjc1LCAtIDAuNTcyLCAwLjAyMiApO1xuXHRjb25zdCB2ZWM0IGMxID0gdmVjNCggMSwgMC4wNDI1LCAxLjA0LCAtIDAuMDQgKTtcblx0dmVjNCByID0gcm91Z2huZXNzICogYzAgKyBjMTtcblx0ZmxvYXQgYTAwNCA9IG1pbiggci54ICogci54LCBleHAyKCAtIDkuMjggKiBkb3ROViApICkgKiByLnggKyByLnk7XG5cdHZlYzIgZmFiID0gdmVjMiggLSAxLjA0LCAxLjA0ICkgKiBhMDA0ICsgci56dztcblx0cmV0dXJuIGZhYjtcbn1cbnZlYzMgRW52aXJvbm1lbnRCUkRGKCBjb25zdCBpbiB2ZWMzIG5vcm1hbCwgY29uc3QgaW4gdmVjMyB2aWV3RGlyLCBjb25zdCBpbiB2ZWMzIHNwZWN1bGFyQ29sb3IsIGNvbnN0IGluIGZsb2F0IHNwZWN1bGFyRjkwLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MgKSB7XG5cdHZlYzIgZmFiID0gREZHQXBwcm94KCBub3JtYWwsIHZpZXdEaXIsIHJvdWdobmVzcyApO1xuXHRyZXR1cm4gc3BlY3VsYXJDb2xvciAqIGZhYi54ICsgc3BlY3VsYXJGOTAgKiBmYWIueTtcbn1cbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VcbnZvaWQgY29tcHV0ZU11bHRpc2NhdHRlcmluZ0lyaWRlc2NlbmNlKCBjb25zdCBpbiB2ZWMzIG5vcm1hbCwgY29uc3QgaW4gdmVjMyB2aWV3RGlyLCBjb25zdCBpbiB2ZWMzIHNwZWN1bGFyQ29sb3IsIGNvbnN0IGluIGZsb2F0IHNwZWN1bGFyRjkwLCBjb25zdCBpbiBmbG9hdCBpcmlkZXNjZW5jZSwgY29uc3QgaW4gdmVjMyBpcmlkZXNjZW5jZUYwLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MsIGlub3V0IHZlYzMgc2luZ2xlU2NhdHRlciwgaW5vdXQgdmVjMyBtdWx0aVNjYXR0ZXIgKSB7XG4jZWxzZVxudm9pZCBjb21wdXRlTXVsdGlzY2F0dGVyaW5nKCBjb25zdCBpbiB2ZWMzIG5vcm1hbCwgY29uc3QgaW4gdmVjMyB2aWV3RGlyLCBjb25zdCBpbiB2ZWMzIHNwZWN1bGFyQ29sb3IsIGNvbnN0IGluIGZsb2F0IHNwZWN1bGFyRjkwLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MsIGlub3V0IHZlYzMgc2luZ2xlU2NhdHRlciwgaW5vdXQgdmVjMyBtdWx0aVNjYXR0ZXIgKSB7XG4jZW5kaWZcblx0dmVjMiBmYWIgPSBERkdBcHByb3goIG5vcm1hbCwgdmlld0Rpciwgcm91Z2huZXNzICk7XG5cdCNpZmRlZiBVU0VfSVJJREVTQ0VOQ0Vcblx0XHR2ZWMzIEZyID0gbWl4KCBzcGVjdWxhckNvbG9yLCBpcmlkZXNjZW5jZUYwLCBpcmlkZXNjZW5jZSApO1xuXHQjZWxzZVxuXHRcdHZlYzMgRnIgPSBzcGVjdWxhckNvbG9yO1xuXHQjZW5kaWZcblx0dmVjMyBGc3NFc3MgPSBGciAqIGZhYi54ICsgc3BlY3VsYXJGOTAgKiBmYWIueTtcblx0ZmxvYXQgRXNzID0gZmFiLnggKyBmYWIueTtcblx0ZmxvYXQgRW1zID0gMS4wIC0gRXNzO1xuXHR2ZWMzIEZhdmcgPSBGciArICggMS4wIC0gRnIgKSAqIDAuMDQ3NjE5O1x0dmVjMyBGbXMgPSBGc3NFc3MgKiBGYXZnIC8gKCAxLjAgLSBFbXMgKiBGYXZnICk7XG5cdHNpbmdsZVNjYXR0ZXIgKz0gRnNzRXNzO1xuXHRtdWx0aVNjYXR0ZXIgKz0gRm1zICogRW1zO1xufVxuI2lmIE5VTV9SRUNUX0FSRUFfTElHSFRTID4gMFxuXHR2b2lkIFJFX0RpcmVjdF9SZWN0QXJlYV9QaHlzaWNhbCggY29uc3QgaW4gUmVjdEFyZWFMaWdodCByZWN0QXJlYUxpZ2h0LCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5UG9zaXRpb24sIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlOb3JtYWwsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlWaWV3RGlyLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBjb25zdCBpbiBQaHlzaWNhbE1hdGVyaWFsIG1hdGVyaWFsLCBpbm91dCBSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCApIHtcblx0XHR2ZWMzIG5vcm1hbCA9IGdlb21ldHJ5Tm9ybWFsO1xuXHRcdHZlYzMgdmlld0RpciA9IGdlb21ldHJ5Vmlld0Rpcjtcblx0XHR2ZWMzIHBvc2l0aW9uID0gZ2VvbWV0cnlQb3NpdGlvbjtcblx0XHR2ZWMzIGxpZ2h0UG9zID0gcmVjdEFyZWFMaWdodC5wb3NpdGlvbjtcblx0XHR2ZWMzIGhhbGZXaWR0aCA9IHJlY3RBcmVhTGlnaHQuaGFsZldpZHRoO1xuXHRcdHZlYzMgaGFsZkhlaWdodCA9IHJlY3RBcmVhTGlnaHQuaGFsZkhlaWdodDtcblx0XHR2ZWMzIGxpZ2h0Q29sb3IgPSByZWN0QXJlYUxpZ2h0LmNvbG9yO1xuXHRcdGZsb2F0IHJvdWdobmVzcyA9IG1hdGVyaWFsLnJvdWdobmVzcztcblx0XHR2ZWMzIHJlY3RDb29yZHNbIDQgXTtcblx0XHRyZWN0Q29vcmRzWyAwIF0gPSBsaWdodFBvcyArIGhhbGZXaWR0aCAtIGhhbGZIZWlnaHQ7XHRcdHJlY3RDb29yZHNbIDEgXSA9IGxpZ2h0UG9zIC0gaGFsZldpZHRoIC0gaGFsZkhlaWdodDtcblx0XHRyZWN0Q29vcmRzWyAyIF0gPSBsaWdodFBvcyAtIGhhbGZXaWR0aCArIGhhbGZIZWlnaHQ7XG5cdFx0cmVjdENvb3Jkc1sgMyBdID0gbGlnaHRQb3MgKyBoYWxmV2lkdGggKyBoYWxmSGVpZ2h0O1xuXHRcdHZlYzIgdXYgPSBMVENfVXYoIG5vcm1hbCwgdmlld0Rpciwgcm91Z2huZXNzICk7XG5cdFx0dmVjNCB0MSA9IHRleHR1cmUyRCggbHRjXzEsIHV2ICk7XG5cdFx0dmVjNCB0MiA9IHRleHR1cmUyRCggbHRjXzIsIHV2ICk7XG5cdFx0bWF0MyBtSW52ID0gbWF0Myhcblx0XHRcdHZlYzMoIHQxLngsIDAsIHQxLnkgKSxcblx0XHRcdHZlYzMoICAgIDAsIDEsICAgIDAgKSxcblx0XHRcdHZlYzMoIHQxLnosIDAsIHQxLncgKVxuXHRcdCk7XG5cdFx0dmVjMyBmcmVzbmVsID0gKCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yICogdDIueCArICggdmVjMyggMS4wICkgLSBtYXRlcmlhbC5zcGVjdWxhckNvbG9yICkgKiB0Mi55ICk7XG5cdFx0cmVmbGVjdGVkTGlnaHQuZGlyZWN0U3BlY3VsYXIgKz0gbGlnaHRDb2xvciAqIGZyZXNuZWwgKiBMVENfRXZhbHVhdGUoIG5vcm1hbCwgdmlld0RpciwgcG9zaXRpb24sIG1JbnYsIHJlY3RDb29yZHMgKTtcblx0XHRyZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICs9IGxpZ2h0Q29sb3IgKiBtYXRlcmlhbC5kaWZmdXNlQ29sb3IgKiBMVENfRXZhbHVhdGUoIG5vcm1hbCwgdmlld0RpciwgcG9zaXRpb24sIG1hdDMoIDEuMCApLCByZWN0Q29vcmRzICk7XG5cdH1cbiNlbmRpZlxudm9pZCBSRV9EaXJlY3RfUGh5c2ljYWwoIGNvbnN0IGluIEluY2lkZW50TGlnaHQgZGlyZWN0TGlnaHQsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeU5vcm1hbCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVZpZXdEaXIsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGNvbnN0IGluIFBoeXNpY2FsTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuXHRmbG9hdCBkb3ROTCA9IHNhdHVyYXRlKCBkb3QoIGdlb21ldHJ5Tm9ybWFsLCBkaXJlY3RMaWdodC5kaXJlY3Rpb24gKSApO1xuXHR2ZWMzIGlycmFkaWFuY2UgPSBkb3ROTCAqIGRpcmVjdExpZ2h0LmNvbG9yO1xuXHQjaWZkZWYgVVNFX0NMRUFSQ09BVFxuXHRcdGZsb2F0IGRvdE5MY2MgPSBzYXR1cmF0ZSggZG90KCBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgZGlyZWN0TGlnaHQuZGlyZWN0aW9uICkgKTtcblx0XHR2ZWMzIGNjSXJyYWRpYW5jZSA9IGRvdE5MY2MgKiBkaXJlY3RMaWdodC5jb2xvcjtcblx0XHRjbGVhcmNvYXRTcGVjdWxhciArPSBjY0lycmFkaWFuY2UgKiBCUkRGX0dHWF9DbGVhcmNvYXQoIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiwgZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgbWF0ZXJpYWwgKTtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfU0hFRU5cblx0XHRzaGVlblNwZWN1bGFyICs9IGlycmFkaWFuY2UgKiBCUkRGX1NoZWVuKCBkaXJlY3RMaWdodC5kaXJlY3Rpb24sIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlOb3JtYWwsIG1hdGVyaWFsLnNoZWVuQ29sb3IsIG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzICk7XG5cdCNlbmRpZlxuXHRyZWZsZWN0ZWRMaWdodC5kaXJlY3RTcGVjdWxhciArPSBpcnJhZGlhbmNlICogQlJERl9HR1goIGRpcmVjdExpZ2h0LmRpcmVjdGlvbiwgZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeU5vcm1hbCwgbWF0ZXJpYWwgKTtcblx0cmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArPSBpcnJhZGlhbmNlICogQlJERl9MYW1iZXJ0KCBtYXRlcmlhbC5kaWZmdXNlQ29sb3IgKTtcbn1cbnZvaWQgUkVfSW5kaXJlY3REaWZmdXNlX1BoeXNpY2FsKCBjb25zdCBpbiB2ZWMzIGlycmFkaWFuY2UsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlQb3NpdGlvbiwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeU5vcm1hbCwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVZpZXdEaXIsIGNvbnN0IGluIHZlYzMgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGNvbnN0IGluIFBoeXNpY2FsTWF0ZXJpYWwgbWF0ZXJpYWwsIGlub3V0IFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ICkge1xuXHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKz0gaXJyYWRpYW5jZSAqIEJSREZfTGFtYmVydCggbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICk7XG59XG52b2lkIFJFX0luZGlyZWN0U3BlY3VsYXJfUGh5c2ljYWwoIGNvbnN0IGluIHZlYzMgcmFkaWFuY2UsIGNvbnN0IGluIHZlYzMgaXJyYWRpYW5jZSwgY29uc3QgaW4gdmVjMyBjbGVhcmNvYXRSYWRpYW5jZSwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeVBvc2l0aW9uLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Tm9ybWFsLCBjb25zdCBpbiB2ZWMzIGdlb21ldHJ5Vmlld0RpciwgY29uc3QgaW4gdmVjMyBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgY29uc3QgaW4gUGh5c2ljYWxNYXRlcmlhbCBtYXRlcmlhbCwgaW5vdXQgUmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQpIHtcblx0I2lmZGVmIFVTRV9DTEVBUkNPQVRcblx0XHRjbGVhcmNvYXRTcGVjdWxhciArPSBjbGVhcmNvYXRSYWRpYW5jZSAqIEVudmlyb25tZW50QlJERiggZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGdlb21ldHJ5Vmlld0RpciwgbWF0ZXJpYWwuY2xlYXJjb2F0RjAsIG1hdGVyaWFsLmNsZWFyY29hdEY5MCwgbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzICk7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1NIRUVOXG5cdFx0c2hlZW5TcGVjdWxhciArPSBpcnJhZGlhbmNlICogbWF0ZXJpYWwuc2hlZW5Db2xvciAqIElCTFNoZWVuQlJERiggZ2VvbWV0cnlOb3JtYWwsIGdlb21ldHJ5Vmlld0RpciwgbWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3MgKTtcblx0I2VuZGlmXG5cdHZlYzMgc2luZ2xlU2NhdHRlcmluZyA9IHZlYzMoIDAuMCApO1xuXHR2ZWMzIG11bHRpU2NhdHRlcmluZyA9IHZlYzMoIDAuMCApO1xuXHR2ZWMzIGNvc2luZVdlaWdodGVkSXJyYWRpYW5jZSA9IGlycmFkaWFuY2UgKiBSRUNJUFJPQ0FMX1BJO1xuXHQjaWZkZWYgVVNFX0lSSURFU0NFTkNFXG5cdFx0Y29tcHV0ZU11bHRpc2NhdHRlcmluZ0lyaWRlc2NlbmNlKCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyLCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yLCBtYXRlcmlhbC5zcGVjdWxhckY5MCwgbWF0ZXJpYWwuaXJpZGVzY2VuY2UsIG1hdGVyaWFsLmlyaWRlc2NlbmNlRnJlc25lbCwgbWF0ZXJpYWwucm91Z2huZXNzLCBzaW5nbGVTY2F0dGVyaW5nLCBtdWx0aVNjYXR0ZXJpbmcgKTtcblx0I2Vsc2Vcblx0XHRjb21wdXRlTXVsdGlzY2F0dGVyaW5nKCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyLCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yLCBtYXRlcmlhbC5zcGVjdWxhckY5MCwgbWF0ZXJpYWwucm91Z2huZXNzLCBzaW5nbGVTY2F0dGVyaW5nLCBtdWx0aVNjYXR0ZXJpbmcgKTtcblx0I2VuZGlmXG5cdHZlYzMgdG90YWxTY2F0dGVyaW5nID0gc2luZ2xlU2NhdHRlcmluZyArIG11bHRpU2NhdHRlcmluZztcblx0dmVjMyBkaWZmdXNlID0gbWF0ZXJpYWwuZGlmZnVzZUNvbG9yICogKCAxLjAgLSBtYXgoIG1heCggdG90YWxTY2F0dGVyaW5nLnIsIHRvdGFsU2NhdHRlcmluZy5nICksIHRvdGFsU2NhdHRlcmluZy5iICkgKTtcblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhciArPSByYWRpYW5jZSAqIHNpbmdsZVNjYXR0ZXJpbmc7XG5cdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0U3BlY3VsYXIgKz0gbXVsdGlTY2F0dGVyaW5nICogY29zaW5lV2VpZ2h0ZWRJcnJhZGlhbmNlO1xuXHRyZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKz0gZGlmZnVzZSAqIGNvc2luZVdlaWdodGVkSXJyYWRpYW5jZTtcbn1cbiNkZWZpbmUgUkVfRGlyZWN0XHRcdFx0XHRSRV9EaXJlY3RfUGh5c2ljYWxcbiNkZWZpbmUgUkVfRGlyZWN0X1JlY3RBcmVhXHRcdFJFX0RpcmVjdF9SZWN0QXJlYV9QaHlzaWNhbFxuI2RlZmluZSBSRV9JbmRpcmVjdERpZmZ1c2VcdFx0UkVfSW5kaXJlY3REaWZmdXNlX1BoeXNpY2FsXG4jZGVmaW5lIFJFX0luZGlyZWN0U3BlY3VsYXJcdFx0UkVfSW5kaXJlY3RTcGVjdWxhcl9QaHlzaWNhbFxuZmxvYXQgY29tcHV0ZVNwZWN1bGFyT2NjbHVzaW9uKCBjb25zdCBpbiBmbG9hdCBkb3ROViwgY29uc3QgaW4gZmxvYXQgYW1iaWVudE9jY2x1c2lvbiwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzICkge1xuXHRyZXR1cm4gc2F0dXJhdGUoIHBvdyggZG90TlYgKyBhbWJpZW50T2NjbHVzaW9uLCBleHAyKCAtIDE2LjAgKiByb3VnaG5lc3MgLSAxLjAgKSApIC0gMS4wICsgYW1iaWVudE9jY2x1c2lvbiApO1xufSI7Cgp2YXIgbGlnaHRzX2ZyYWdtZW50X2JlZ2luID0gIlxudmVjMyBnZW9tZXRyeVBvc2l0aW9uID0gLSB2Vmlld1Bvc2l0aW9uO1xudmVjMyBnZW9tZXRyeU5vcm1hbCA9IG5vcm1hbDtcbnZlYzMgZ2VvbWV0cnlWaWV3RGlyID0gKCBpc09ydGhvZ3JhcGhpYyApID8gdmVjMyggMCwgMCwgMSApIDogbm9ybWFsaXplKCB2Vmlld1Bvc2l0aW9uICk7XG52ZWMzIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsO1xuI2lmZGVmIFVTRV9DTEVBUkNPQVRcblx0Z2VvbWV0cnlDbGVhcmNvYXROb3JtYWwgPSBjbGVhcmNvYXROb3JtYWw7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0Vcblx0ZmxvYXQgZG90TlZpID0gc2F0dXJhdGUoIGRvdCggbm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIgKSApO1xuXHRpZiAoIG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzID09IDAuMCApIHtcblx0XHRtYXRlcmlhbC5pcmlkZXNjZW5jZSA9IDAuMDtcblx0fSBlbHNlIHtcblx0XHRtYXRlcmlhbC5pcmlkZXNjZW5jZSA9IHNhdHVyYXRlKCBtYXRlcmlhbC5pcmlkZXNjZW5jZSApO1xuXHR9XG5cdGlmICggbWF0ZXJpYWwuaXJpZGVzY2VuY2UgPiAwLjAgKSB7XG5cdFx0bWF0ZXJpYWwuaXJpZGVzY2VuY2VGcmVzbmVsID0gZXZhbElyaWRlc2NlbmNlKCAxLjAsIG1hdGVyaWFsLmlyaWRlc2NlbmNlSU9SLCBkb3ROVmksIG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzLCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yICk7XG5cdFx0bWF0ZXJpYWwuaXJpZGVzY2VuY2VGMCA9IFNjaGxpY2tfdG9fRjAoIG1hdGVyaWFsLmlyaWRlc2NlbmNlRnJlc25lbCwgMS4wLCBkb3ROVmkgKTtcblx0fVxuI2VuZGlmXG5JbmNpZGVudExpZ2h0IGRpcmVjdExpZ2h0O1xuI2lmICggTlVNX1BPSU5UX0xJR0hUUyA+IDAgKSAmJiBkZWZpbmVkKCBSRV9EaXJlY3QgKVxuXHRQb2ludExpZ2h0IHBvaW50TGlnaHQ7XG5cdCNpZiBkZWZpbmVkKCBVU0VfU0hBRE9XTUFQICkgJiYgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgPiAwXG5cdFBvaW50TGlnaHRTaGFkb3cgcG9pbnRMaWdodFNoYWRvdztcblx0I2VuZGlmXG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX1BPSU5UX0xJR0hUUzsgaSArKyApIHtcblx0XHRwb2ludExpZ2h0ID0gcG9pbnRMaWdodHNbIGkgXTtcblx0XHRnZXRQb2ludExpZ2h0SW5mbyggcG9pbnRMaWdodCwgZ2VvbWV0cnlQb3NpdGlvbiwgZGlyZWN0TGlnaHQgKTtcblx0XHQjaWYgZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmICggVU5ST0xMRURfTE9PUF9JTkRFWCA8IE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTIClcblx0XHRwb2ludExpZ2h0U2hhZG93ID0gcG9pbnRMaWdodFNoYWRvd3NbIGkgXTtcblx0XHRkaXJlY3RMaWdodC5jb2xvciAqPSAoIGRpcmVjdExpZ2h0LnZpc2libGUgJiYgcmVjZWl2ZVNoYWRvdyApID8gZ2V0UG9pbnRTaGFkb3coIHBvaW50U2hhZG93TWFwWyBpIF0sIHBvaW50TGlnaHRTaGFkb3cuc2hhZG93TWFwU2l6ZSwgcG9pbnRMaWdodFNoYWRvdy5zaGFkb3dCaWFzLCBwb2ludExpZ2h0U2hhZG93LnNoYWRvd1JhZGl1cywgdlBvaW50U2hhZG93Q29vcmRbIGkgXSwgcG9pbnRMaWdodFNoYWRvdy5zaGFkb3dDYW1lcmFOZWFyLCBwb2ludExpZ2h0U2hhZG93LnNoYWRvd0NhbWVyYUZhciApIDogMS4wO1xuXHRcdCNlbmRpZlxuXHRcdFJFX0RpcmVjdCggZGlyZWN0TGlnaHQsIGdlb21ldHJ5UG9zaXRpb24sIGdlb21ldHJ5Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBtYXRlcmlhbCwgcmVmbGVjdGVkTGlnaHQgKTtcblx0fVxuXHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuI2VuZGlmXG4jaWYgKCBOVU1fU1BPVF9MSUdIVFMgPiAwICkgJiYgZGVmaW5lZCggUkVfRGlyZWN0IClcblx0U3BvdExpZ2h0IHNwb3RMaWdodDtcblx0dmVjNCBzcG90Q29sb3I7XG5cdHZlYzMgc3BvdExpZ2h0Q29vcmQ7XG5cdGJvb2wgaW5TcG90TGlnaHRNYXA7XG5cdCNpZiBkZWZpbmVkKCBVU0VfU0hBRE9XTUFQICkgJiYgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyA+IDBcblx0U3BvdExpZ2h0U2hhZG93IHNwb3RMaWdodFNoYWRvdztcblx0I2VuZGlmXG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX1NQT1RfTElHSFRTOyBpICsrICkge1xuXHRcdHNwb3RMaWdodCA9IHNwb3RMaWdodHNbIGkgXTtcblx0XHRnZXRTcG90TGlnaHRJbmZvKCBzcG90TGlnaHQsIGdlb21ldHJ5UG9zaXRpb24sIGRpcmVjdExpZ2h0ICk7XG5cdFx0I2lmICggVU5ST0xMRURfTE9PUF9JTkRFWCA8IE5VTV9TUE9UX0xJR0hUX1NIQURPV1NfV0lUSF9NQVBTIClcblx0XHQjZGVmaW5lIFNQT1RfTElHSFRfTUFQX0lOREVYIFVOUk9MTEVEX0xPT1BfSU5ERVhcblx0XHQjZWxpZiAoIFVOUk9MTEVEX0xPT1BfSU5ERVggPCBOVU1fU1BPVF9MSUdIVF9TSEFET1dTIClcblx0XHQjZGVmaW5lIFNQT1RfTElHSFRfTUFQX0lOREVYIE5VTV9TUE9UX0xJR0hUX01BUFNcblx0XHQjZWxzZVxuXHRcdCNkZWZpbmUgU1BPVF9MSUdIVF9NQVBfSU5ERVggKCBVTlJPTExFRF9MT09QX0lOREVYIC0gTlVNX1NQT1RfTElHSFRfU0hBRE9XUyArIE5VTV9TUE9UX0xJR0hUX1NIQURPV1NfV0lUSF9NQVBTIClcblx0XHQjZW5kaWZcblx0XHQjaWYgKCBTUE9UX0xJR0hUX01BUF9JTkRFWCA8IE5VTV9TUE9UX0xJR0hUX01BUFMgKVxuXHRcdFx0c3BvdExpZ2h0Q29vcmQgPSB2U3BvdExpZ2h0Q29vcmRbIGkgXS54eXogLyB2U3BvdExpZ2h0Q29vcmRbIGkgXS53O1xuXHRcdFx0aW5TcG90TGlnaHRNYXAgPSBhbGwoIGxlc3NUaGFuKCBhYnMoIHNwb3RMaWdodENvb3JkICogMi4gLSAxLiApLCB2ZWMzKCAxLjAgKSApICk7XG5cdFx0XHRzcG90Q29sb3IgPSB0ZXh0dXJlMkQoIHNwb3RMaWdodE1hcFsgU1BPVF9MSUdIVF9NQVBfSU5ERVggXSwgc3BvdExpZ2h0Q29vcmQueHkgKTtcblx0XHRcdGRpcmVjdExpZ2h0LmNvbG9yID0gaW5TcG90TGlnaHRNYXAgPyBkaXJlY3RMaWdodC5jb2xvciAqIHNwb3RDb2xvci5yZ2IgOiBkaXJlY3RMaWdodC5jb2xvcjtcblx0XHQjZW5kaWZcblx0XHQjdW5kZWYgU1BPVF9MSUdIVF9NQVBfSU5ERVhcblx0XHQjaWYgZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmICggVU5ST0xMRURfTE9PUF9JTkRFWCA8IE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgKVxuXHRcdHNwb3RMaWdodFNoYWRvdyA9IHNwb3RMaWdodFNoYWRvd3NbIGkgXTtcblx0XHRkaXJlY3RMaWdodC5jb2xvciAqPSAoIGRpcmVjdExpZ2h0LnZpc2libGUgJiYgcmVjZWl2ZVNoYWRvdyApID8gZ2V0U2hhZG93KCBzcG90U2hhZG93TWFwWyBpIF0sIHNwb3RMaWdodFNoYWRvdy5zaGFkb3dNYXBTaXplLCBzcG90TGlnaHRTaGFkb3cuc2hhZG93Qmlhcywgc3BvdExpZ2h0U2hhZG93LnNoYWRvd1JhZGl1cywgdlNwb3RMaWdodENvb3JkWyBpIF0gKSA6IDEuMDtcblx0XHQjZW5kaWZcblx0XHRSRV9EaXJlY3QoIGRpcmVjdExpZ2h0LCBnZW9tZXRyeVBvc2l0aW9uLCBnZW9tZXRyeU5vcm1hbCwgZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeUNsZWFyY29hdE5vcm1hbCwgbWF0ZXJpYWwsIHJlZmxlY3RlZExpZ2h0ICk7XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcbiNlbmRpZlxuI2lmICggTlVNX0RJUl9MSUdIVFMgPiAwICkgJiYgZGVmaW5lZCggUkVfRGlyZWN0IClcblx0RGlyZWN0aW9uYWxMaWdodCBkaXJlY3Rpb25hbExpZ2h0O1xuXHQjaWYgZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmIE5VTV9ESVJfTElHSFRfU0hBRE9XUyA+IDBcblx0RGlyZWN0aW9uYWxMaWdodFNoYWRvdyBkaXJlY3Rpb25hbExpZ2h0U2hhZG93O1xuXHQjZW5kaWZcblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fRElSX0xJR0hUUzsgaSArKyApIHtcblx0XHRkaXJlY3Rpb25hbExpZ2h0ID0gZGlyZWN0aW9uYWxMaWdodHNbIGkgXTtcblx0XHRnZXREaXJlY3Rpb25hbExpZ2h0SW5mbyggZGlyZWN0aW9uYWxMaWdodCwgZGlyZWN0TGlnaHQgKTtcblx0XHQjaWYgZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmICggVU5ST0xMRURfTE9PUF9JTkRFWCA8IE5VTV9ESVJfTElHSFRfU0hBRE9XUyApXG5cdFx0ZGlyZWN0aW9uYWxMaWdodFNoYWRvdyA9IGRpcmVjdGlvbmFsTGlnaHRTaGFkb3dzWyBpIF07XG5cdFx0ZGlyZWN0TGlnaHQuY29sb3IgKj0gKCBkaXJlY3RMaWdodC52aXNpYmxlICYmIHJlY2VpdmVTaGFkb3cgKSA/IGdldFNoYWRvdyggZGlyZWN0aW9uYWxTaGFkb3dNYXBbIGkgXSwgZGlyZWN0aW9uYWxMaWdodFNoYWRvdy5zaGFkb3dNYXBTaXplLCBkaXJlY3Rpb25hbExpZ2h0U2hhZG93LnNoYWRvd0JpYXMsIGRpcmVjdGlvbmFsTGlnaHRTaGFkb3cuc2hhZG93UmFkaXVzLCB2RGlyZWN0aW9uYWxTaGFkb3dDb29yZFsgaSBdICkgOiAxLjA7XG5cdFx0I2VuZGlmXG5cdFx0UkVfRGlyZWN0KCBkaXJlY3RMaWdodCwgZ2VvbWV0cnlQb3NpdGlvbiwgZ2VvbWV0cnlOb3JtYWwsIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApO1xuXHR9XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG4jZW5kaWZcbiNpZiAoIE5VTV9SRUNUX0FSRUFfTElHSFRTID4gMCApICYmIGRlZmluZWQoIFJFX0RpcmVjdF9SZWN0QXJlYSApXG5cdFJlY3RBcmVhTGlnaHQgcmVjdEFyZWFMaWdodDtcblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fUkVDVF9BUkVBX0xJR0hUUzsgaSArKyApIHtcblx0XHRyZWN0QXJlYUxpZ2h0ID0gcmVjdEFyZWFMaWdodHNbIGkgXTtcblx0XHRSRV9EaXJlY3RfUmVjdEFyZWEoIHJlY3RBcmVhTGlnaHQsIGdlb21ldHJ5UG9zaXRpb24sIGdlb21ldHJ5Tm9ybWFsLCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBtYXRlcmlhbCwgcmVmbGVjdGVkTGlnaHQgKTtcblx0fVxuXHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuI2VuZGlmXG4jaWYgZGVmaW5lZCggUkVfSW5kaXJlY3REaWZmdXNlIClcblx0dmVjMyBpYmxJcnJhZGlhbmNlID0gdmVjMyggMC4wICk7XG5cdHZlYzMgaXJyYWRpYW5jZSA9IGdldEFtYmllbnRMaWdodElycmFkaWFuY2UoIGFtYmllbnRMaWdodENvbG9yICk7XG5cdCNpZiBkZWZpbmVkKCBVU0VfTElHSFRfUFJPQkVTIClcblx0XHRpcnJhZGlhbmNlICs9IGdldExpZ2h0UHJvYmVJcnJhZGlhbmNlKCBsaWdodFByb2JlLCBnZW9tZXRyeU5vcm1hbCApO1xuXHQjZW5kaWZcblx0I2lmICggTlVNX0hFTUlfTElHSFRTID4gMCApXG5cdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRcdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9IRU1JX0xJR0hUUzsgaSArKyApIHtcblx0XHRcdGlycmFkaWFuY2UgKz0gZ2V0SGVtaXNwaGVyZUxpZ2h0SXJyYWRpYW5jZSggaGVtaXNwaGVyZUxpZ2h0c1sgaSBdLCBnZW9tZXRyeU5vcm1hbCApO1xuXHRcdH1cblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHQjZW5kaWZcbiNlbmRpZlxuI2lmIGRlZmluZWQoIFJFX0luZGlyZWN0U3BlY3VsYXIgKVxuXHR2ZWMzIHJhZGlhbmNlID0gdmVjMyggMC4wICk7XG5cdHZlYzMgY2xlYXJjb2F0UmFkaWFuY2UgPSB2ZWMzKCAwLjAgKTtcbiNlbmRpZiI7Cgp2YXIgbGlnaHRzX2ZyYWdtZW50X21hcHMgPSAiI2lmIGRlZmluZWQoIFJFX0luZGlyZWN0RGlmZnVzZSApXG5cdCNpZmRlZiBVU0VfTElHSFRNQVBcblx0XHR2ZWM0IGxpZ2h0TWFwVGV4ZWwgPSB0ZXh0dXJlMkQoIGxpZ2h0TWFwLCB2TGlnaHRNYXBVdiApO1xuXHRcdHZlYzMgbGlnaHRNYXBJcnJhZGlhbmNlID0gbGlnaHRNYXBUZXhlbC5yZ2IgKiBsaWdodE1hcEludGVuc2l0eTtcblx0XHRpcnJhZGlhbmNlICs9IGxpZ2h0TWFwSXJyYWRpYW5jZTtcblx0I2VuZGlmXG5cdCNpZiBkZWZpbmVkKCBVU0VfRU5WTUFQICkgJiYgZGVmaW5lZCggU1RBTkRBUkQgKSAmJiBkZWZpbmVkKCBFTlZNQVBfVFlQRV9DVUJFX1VWIClcblx0XHRpYmxJcnJhZGlhbmNlICs9IGdldElCTElycmFkaWFuY2UoIGdlb21ldHJ5Tm9ybWFsICk7XG5cdCNlbmRpZlxuI2VuZGlmXG4jaWYgZGVmaW5lZCggVVNFX0VOVk1BUCApICYmIGRlZmluZWQoIFJFX0luZGlyZWN0U3BlY3VsYXIgKVxuXHQjaWZkZWYgVVNFX0FOSVNPVFJPUFlcblx0XHRyYWRpYW5jZSArPSBnZXRJQkxBbmlzb3Ryb3B5UmFkaWFuY2UoIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlOb3JtYWwsIG1hdGVyaWFsLnJvdWdobmVzcywgbWF0ZXJpYWwuYW5pc290cm9weUIsIG1hdGVyaWFsLmFuaXNvdHJvcHkgKTtcblx0I2Vsc2Vcblx0XHRyYWRpYW5jZSArPSBnZXRJQkxSYWRpYW5jZSggZ2VvbWV0cnlWaWV3RGlyLCBnZW9tZXRyeU5vcm1hbCwgbWF0ZXJpYWwucm91Z2huZXNzICk7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX0NMRUFSQ09BVFxuXHRcdGNsZWFyY29hdFJhZGlhbmNlICs9IGdldElCTFJhZGlhbmNlKCBnZW9tZXRyeVZpZXdEaXIsIGdlb21ldHJ5Q2xlYXJjb2F0Tm9ybWFsLCBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3MgKTtcblx0I2VuZGlmXG4jZW5kaWYiOwoKdmFyIGxpZ2h0c19mcmFnbWVudF9lbmQgPSAiI2lmIGRlZmluZWQoIFJFX0luZGlyZWN0RGlmZnVzZSApXG5cdFJFX0luZGlyZWN0RGlmZnVzZSggaXJyYWRpYW5jZSwgZ2VvbWV0cnlQb3NpdGlvbiwgZ2VvbWV0cnlOb3JtYWwsIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApO1xuI2VuZGlmXG4jaWYgZGVmaW5lZCggUkVfSW5kaXJlY3RTcGVjdWxhciApXG5cdFJFX0luZGlyZWN0U3BlY3VsYXIoIHJhZGlhbmNlLCBpYmxJcnJhZGlhbmNlLCBjbGVhcmNvYXRSYWRpYW5jZSwgZ2VvbWV0cnlQb3NpdGlvbiwgZ2VvbWV0cnlOb3JtYWwsIGdlb21ldHJ5Vmlld0RpciwgZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIG1hdGVyaWFsLCByZWZsZWN0ZWRMaWdodCApO1xuI2VuZGlmIjsKCnZhciBsb2dkZXB0aGJ1Zl9mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVVNFX0xPR0RFUFRIQlVGICkgJiYgZGVmaW5lZCggVVNFX0xPR0RFUFRIQlVGX0VYVCApXG5cdGdsX0ZyYWdEZXB0aEVYVCA9IHZJc1BlcnNwZWN0aXZlID09IDAuMCA/IGdsX0ZyYWdDb29yZC56IDogbG9nMiggdkZyYWdEZXB0aCApICogbG9nRGVwdGhCdWZGQyAqIDAuNTtcbiNlbmRpZiI7Cgp2YXIgbG9nZGVwdGhidWZfcGFyc19mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVVNFX0xPR0RFUFRIQlVGICkgJiYgZGVmaW5lZCggVVNFX0xPR0RFUFRIQlVGX0VYVCApXG5cdHVuaWZvcm0gZmxvYXQgbG9nRGVwdGhCdWZGQztcblx0dmFyeWluZyBmbG9hdCB2RnJhZ0RlcHRoO1xuXHR2YXJ5aW5nIGZsb2F0IHZJc1BlcnNwZWN0aXZlO1xuI2VuZGlmIjsKCnZhciBsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleCA9ICIjaWZkZWYgVVNFX0xPR0RFUFRIQlVGXG5cdCNpZmRlZiBVU0VfTE9HREVQVEhCVUZfRVhUXG5cdFx0dmFyeWluZyBmbG9hdCB2RnJhZ0RlcHRoO1xuXHRcdHZhcnlpbmcgZmxvYXQgdklzUGVyc3BlY3RpdmU7XG5cdCNlbHNlXG5cdFx0dW5pZm9ybSBmbG9hdCBsb2dEZXB0aEJ1ZkZDO1xuXHQjZW5kaWZcbiNlbmRpZiI7Cgp2YXIgbG9nZGVwdGhidWZfdmVydGV4ID0gIiNpZmRlZiBVU0VfTE9HREVQVEhCVUZcblx0I2lmZGVmIFVTRV9MT0dERVBUSEJVRl9FWFRcblx0XHR2RnJhZ0RlcHRoID0gMS4wICsgZ2xfUG9zaXRpb24udztcblx0XHR2SXNQZXJzcGVjdGl2ZSA9IGZsb2F0KCBpc1BlcnNwZWN0aXZlTWF0cml4KCBwcm9qZWN0aW9uTWF0cml4ICkgKTtcblx0I2Vsc2Vcblx0XHRpZiAoIGlzUGVyc3BlY3RpdmVNYXRyaXgoIHByb2plY3Rpb25NYXRyaXggKSApIHtcblx0XHRcdGdsX1Bvc2l0aW9uLnogPSBsb2cyKCBtYXgoIEVQU0lMT04sIGdsX1Bvc2l0aW9uLncgKyAxLjAgKSApICogbG9nRGVwdGhCdWZGQyAtIDEuMDtcblx0XHRcdGdsX1Bvc2l0aW9uLnogKj0gZ2xfUG9zaXRpb24udztcblx0XHR9XG5cdCNlbmRpZlxuI2VuZGlmIjsKCnZhciBtYXBfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9NQVBcblx0dmVjNCBzYW1wbGVkRGlmZnVzZUNvbG9yID0gdGV4dHVyZTJEKCBtYXAsIHZNYXBVdiApO1xuXHQjaWZkZWYgREVDT0RFX1ZJREVPX1RFWFRVUkVcblx0XHRzYW1wbGVkRGlmZnVzZUNvbG9yID0gdmVjNCggbWl4KCBwb3coIHNhbXBsZWREaWZmdXNlQ29sb3IucmdiICogMC45NDc4NjcyOTg2ICsgdmVjMyggMC4wNTIxMzI3MDE0ICksIHZlYzMoIDIuNCApICksIHNhbXBsZWREaWZmdXNlQ29sb3IucmdiICogMC4wNzczOTkzODA4LCB2ZWMzKCBsZXNzVGhhbkVxdWFsKCBzYW1wbGVkRGlmZnVzZUNvbG9yLnJnYiwgdmVjMyggMC4wNDA0NSApICkgKSApLCBzYW1wbGVkRGlmZnVzZUNvbG9yLncgKTtcblx0XG5cdCNlbmRpZlxuXHRkaWZmdXNlQ29sb3IgKj0gc2FtcGxlZERpZmZ1c2VDb2xvcjtcbiNlbmRpZiI7Cgp2YXIgbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9NQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgbWFwO1xuI2VuZGlmIjsKCnZhciBtYXBfcGFydGljbGVfZnJhZ21lbnQgPSAiI2lmIGRlZmluZWQoIFVTRV9NQVAgKSB8fCBkZWZpbmVkKCBVU0VfQUxQSEFNQVAgKVxuXHQjaWYgZGVmaW5lZCggVVNFX1BPSU5UU19VViApXG5cdFx0dmVjMiB1diA9IHZVdjtcblx0I2Vsc2Vcblx0XHR2ZWMyIHV2ID0gKCB1dlRyYW5zZm9ybSAqIHZlYzMoIGdsX1BvaW50Q29vcmQueCwgMS4wIC0gZ2xfUG9pbnRDb29yZC55LCAxICkgKS54eTtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfTUFQXG5cdGRpZmZ1c2VDb2xvciAqPSB0ZXh0dXJlMkQoIG1hcCwgdXYgKTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTFBIQU1BUFxuXHRkaWZmdXNlQ29sb3IuYSAqPSB0ZXh0dXJlMkQoIGFscGhhTWFwLCB1diApLmc7XG4jZW5kaWYiOwoKdmFyIG1hcF9wYXJ0aWNsZV9wYXJzX2ZyYWdtZW50ID0gIiNpZiBkZWZpbmVkKCBVU0VfUE9JTlRTX1VWIClcblx0dmFyeWluZyB2ZWMyIHZVdjtcbiNlbHNlXG5cdCNpZiBkZWZpbmVkKCBVU0VfTUFQICkgfHwgZGVmaW5lZCggVVNFX0FMUEhBTUFQIClcblx0XHR1bmlmb3JtIG1hdDMgdXZUcmFuc2Zvcm07XG5cdCNlbmRpZlxuI2VuZGlmXG4jaWZkZWYgVVNFX01BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBtYXA7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQUxQSEFNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgYWxwaGFNYXA7XG4jZW5kaWYiOwoKdmFyIG1ldGFsbmVzc21hcF9mcmFnbWVudCA9ICJmbG9hdCBtZXRhbG5lc3NGYWN0b3IgPSBtZXRhbG5lc3M7XG4jaWZkZWYgVVNFX01FVEFMTkVTU01BUFxuXHR2ZWM0IHRleGVsTWV0YWxuZXNzID0gdGV4dHVyZTJEKCBtZXRhbG5lc3NNYXAsIHZNZXRhbG5lc3NNYXBVdiApO1xuXHRtZXRhbG5lc3NGYWN0b3IgKj0gdGV4ZWxNZXRhbG5lc3MuYjtcbiNlbmRpZiI7Cgp2YXIgbWV0YWxuZXNzbWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9NRVRBTE5FU1NNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgbWV0YWxuZXNzTWFwO1xuI2VuZGlmIjsKCnZhciBtb3JwaGNvbG9yX3ZlcnRleCA9ICIjaWYgZGVmaW5lZCggVVNFX01PUlBIQ09MT1JTICkgJiYgZGVmaW5lZCggTU9SUEhUQVJHRVRTX1RFWFRVUkUgKVxuXHR2Q29sb3IgKj0gbW9ycGhUYXJnZXRCYXNlSW5mbHVlbmNlO1xuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBNT1JQSFRBUkdFVFNfQ09VTlQ7IGkgKysgKSB7XG5cdFx0I2lmIGRlZmluZWQoIFVTRV9DT0xPUl9BTFBIQSApXG5cdFx0XHRpZiAoIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgaSBdICE9IDAuMCApIHZDb2xvciArPSBnZXRNb3JwaCggZ2xfVmVydGV4SUQsIGksIDIgKSAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgaSBdO1xuXHRcdCNlbGlmIGRlZmluZWQoIFVTRV9DT0xPUiApXG5cdFx0XHRpZiAoIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgaSBdICE9IDAuMCApIHZDb2xvciArPSBnZXRNb3JwaCggZ2xfVmVydGV4SUQsIGksIDIgKS5yZ2IgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIGkgXTtcblx0XHQjZW5kaWZcblx0fVxuI2VuZGlmIjsKCnZhciBtb3JwaG5vcm1hbF92ZXJ0ZXggPSAiI2lmZGVmIFVTRV9NT1JQSE5PUk1BTFNcblx0b2JqZWN0Tm9ybWFsICo9IG1vcnBoVGFyZ2V0QmFzZUluZmx1ZW5jZTtcblx0I2lmZGVmIE1PUlBIVEFSR0VUU19URVhUVVJFXG5cdFx0Zm9yICggaW50IGkgPSAwOyBpIDwgTU9SUEhUQVJHRVRTX0NPVU5UOyBpICsrICkge1xuXHRcdFx0aWYgKCBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIGkgXSAhPSAwLjAgKSBvYmplY3ROb3JtYWwgKz0gZ2V0TW9ycGgoIGdsX1ZlcnRleElELCBpLCAxICkueHl6ICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyBpIF07XG5cdFx0fVxuXHQjZWxzZVxuXHRcdG9iamVjdE5vcm1hbCArPSBtb3JwaE5vcm1hbDAgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIDAgXTtcblx0XHRvYmplY3ROb3JtYWwgKz0gbW9ycGhOb3JtYWwxICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyAxIF07XG5cdFx0b2JqZWN0Tm9ybWFsICs9IG1vcnBoTm9ybWFsMiAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgMiBdO1xuXHRcdG9iamVjdE5vcm1hbCArPSBtb3JwaE5vcm1hbDMgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIDMgXTtcblx0I2VuZGlmXG4jZW5kaWYiOwoKdmFyIG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfTU9SUEhUQVJHRVRTXG5cdHVuaWZvcm0gZmxvYXQgbW9ycGhUYXJnZXRCYXNlSW5mbHVlbmNlO1xuXHQjaWZkZWYgTU9SUEhUQVJHRVRTX1RFWFRVUkVcblx0XHR1bmlmb3JtIGZsb2F0IG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgTU9SUEhUQVJHRVRTX0NPVU5UIF07XG5cdFx0dW5pZm9ybSBzYW1wbGVyMkRBcnJheSBtb3JwaFRhcmdldHNUZXh0dXJlO1xuXHRcdHVuaWZvcm0gaXZlYzIgbW9ycGhUYXJnZXRzVGV4dHVyZVNpemU7XG5cdFx0dmVjNCBnZXRNb3JwaCggY29uc3QgaW4gaW50IHZlcnRleEluZGV4LCBjb25zdCBpbiBpbnQgbW9ycGhUYXJnZXRJbmRleCwgY29uc3QgaW4gaW50IG9mZnNldCApIHtcblx0XHRcdGludCB0ZXhlbEluZGV4ID0gdmVydGV4SW5kZXggKiBNT1JQSFRBUkdFVFNfVEVYVFVSRV9TVFJJREUgKyBvZmZzZXQ7XG5cdFx0XHRpbnQgeSA9IHRleGVsSW5kZXggLyBtb3JwaFRhcmdldHNUZXh0dXJlU2l6ZS54O1xuXHRcdFx0aW50IHggPSB0ZXhlbEluZGV4IC0geSAqIG1vcnBoVGFyZ2V0c1RleHR1cmVTaXplLng7XG5cdFx0XHRpdmVjMyBtb3JwaFVWID0gaXZlYzMoIHgsIHksIG1vcnBoVGFyZ2V0SW5kZXggKTtcblx0XHRcdHJldHVybiB0ZXhlbEZldGNoKCBtb3JwaFRhcmdldHNUZXh0dXJlLCBtb3JwaFVWLCAwICk7XG5cdFx0fVxuXHQjZWxzZVxuXHRcdCNpZm5kZWYgVVNFX01PUlBITk9STUFMU1xuXHRcdFx0dW5pZm9ybSBmbG9hdCBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIDggXTtcblx0XHQjZWxzZVxuXHRcdFx0dW5pZm9ybSBmbG9hdCBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIDQgXTtcblx0XHQjZW5kaWZcblx0I2VuZGlmXG4jZW5kaWYiOwoKdmFyIG1vcnBodGFyZ2V0X3ZlcnRleCA9ICIjaWZkZWYgVVNFX01PUlBIVEFSR0VUU1xuXHR0cmFuc2Zvcm1lZCAqPSBtb3JwaFRhcmdldEJhc2VJbmZsdWVuY2U7XG5cdCNpZmRlZiBNT1JQSFRBUkdFVFNfVEVYVFVSRVxuXHRcdGZvciAoIGludCBpID0gMDsgaSA8IE1PUlBIVEFSR0VUU19DT1VOVDsgaSArKyApIHtcblx0XHRcdGlmICggbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyBpIF0gIT0gMC4wICkgdHJhbnNmb3JtZWQgKz0gZ2V0TW9ycGgoIGdsX1ZlcnRleElELCBpLCAwICkueHl6ICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyBpIF07XG5cdFx0fVxuXHQjZWxzZVxuXHRcdHRyYW5zZm9ybWVkICs9IG1vcnBoVGFyZ2V0MCAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgMCBdO1xuXHRcdHRyYW5zZm9ybWVkICs9IG1vcnBoVGFyZ2V0MSAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgMSBdO1xuXHRcdHRyYW5zZm9ybWVkICs9IG1vcnBoVGFyZ2V0MiAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgMiBdO1xuXHRcdHRyYW5zZm9ybWVkICs9IG1vcnBoVGFyZ2V0MyAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgMyBdO1xuXHRcdCNpZm5kZWYgVVNFX01PUlBITk9STUFMU1xuXHRcdFx0dHJhbnNmb3JtZWQgKz0gbW9ycGhUYXJnZXQ0ICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyA0IF07XG5cdFx0XHR0cmFuc2Zvcm1lZCArPSBtb3JwaFRhcmdldDUgKiBtb3JwaFRhcmdldEluZmx1ZW5jZXNbIDUgXTtcblx0XHRcdHRyYW5zZm9ybWVkICs9IG1vcnBoVGFyZ2V0NiAqIG1vcnBoVGFyZ2V0SW5mbHVlbmNlc1sgNiBdO1xuXHRcdFx0dHJhbnNmb3JtZWQgKz0gbW9ycGhUYXJnZXQ3ICogbW9ycGhUYXJnZXRJbmZsdWVuY2VzWyA3IF07XG5cdFx0I2VuZGlmXG5cdCNlbmRpZlxuI2VuZGlmIjsKCnZhciBub3JtYWxfZnJhZ21lbnRfYmVnaW4gPSAiZmxvYXQgZmFjZURpcmVjdGlvbiA9IGdsX0Zyb250RmFjaW5nID8gMS4wIDogLSAxLjA7XG4jaWZkZWYgRkxBVF9TSEFERURcblx0dmVjMyBmZHggPSBkRmR4KCB2Vmlld1Bvc2l0aW9uICk7XG5cdHZlYzMgZmR5ID0gZEZkeSggdlZpZXdQb3NpdGlvbiApO1xuXHR2ZWMzIG5vcm1hbCA9IG5vcm1hbGl6ZSggY3Jvc3MoIGZkeCwgZmR5ICkgKTtcbiNlbHNlXG5cdHZlYzMgbm9ybWFsID0gbm9ybWFsaXplKCB2Tm9ybWFsICk7XG5cdCNpZmRlZiBET1VCTEVfU0lERURcblx0XHRub3JtYWwgKj0gZmFjZURpcmVjdGlvbjtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZiBkZWZpbmVkKCBVU0VfTk9STUFMTUFQX1RBTkdFTlRTUEFDRSApIHx8IGRlZmluZWQoIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQICkgfHwgZGVmaW5lZCggVVNFX0FOSVNPVFJPUFkgKVxuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHRtYXQzIHRibiA9IG1hdDMoIG5vcm1hbGl6ZSggdlRhbmdlbnQgKSwgbm9ybWFsaXplKCB2Qml0YW5nZW50ICksIG5vcm1hbCApO1xuXHQjZWxzZVxuXHRcdG1hdDMgdGJuID0gZ2V0VGFuZ2VudEZyYW1lKCAtIHZWaWV3UG9zaXRpb24sIG5vcm1hbCxcblx0XHQjaWYgZGVmaW5lZCggVVNFX05PUk1BTE1BUCApXG5cdFx0XHR2Tm9ybWFsTWFwVXZcblx0XHQjZWxpZiBkZWZpbmVkKCBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUCApXG5cdFx0XHR2Q2xlYXJjb2F0Tm9ybWFsTWFwVXZcblx0XHQjZWxzZVxuXHRcdFx0dlV2XG5cdFx0I2VuZGlmXG5cdFx0KTtcblx0I2VuZGlmXG5cdCNpZiBkZWZpbmVkKCBET1VCTEVfU0lERUQgKSAmJiAhIGRlZmluZWQoIEZMQVRfU0hBREVEIClcblx0XHR0Ym5bMF0gKj0gZmFjZURpcmVjdGlvbjtcblx0XHR0Ym5bMV0gKj0gZmFjZURpcmVjdGlvbjtcblx0I2VuZGlmXG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUFxuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHRtYXQzIHRibjIgPSBtYXQzKCBub3JtYWxpemUoIHZUYW5nZW50ICksIG5vcm1hbGl6ZSggdkJpdGFuZ2VudCApLCBub3JtYWwgKTtcblx0I2Vsc2Vcblx0XHRtYXQzIHRibjIgPSBnZXRUYW5nZW50RnJhbWUoIC0gdlZpZXdQb3NpdGlvbiwgbm9ybWFsLCB2Q2xlYXJjb2F0Tm9ybWFsTWFwVXYgKTtcblx0I2VuZGlmXG5cdCNpZiBkZWZpbmVkKCBET1VCTEVfU0lERUQgKSAmJiAhIGRlZmluZWQoIEZMQVRfU0hBREVEIClcblx0XHR0Ym4yWzBdICo9IGZhY2VEaXJlY3Rpb247XG5cdFx0dGJuMlsxXSAqPSBmYWNlRGlyZWN0aW9uO1xuXHQjZW5kaWZcbiNlbmRpZlxudmVjMyBub25QZXJ0dXJiZWROb3JtYWwgPSBub3JtYWw7IjsKCnZhciBub3JtYWxfZnJhZ21lbnRfbWFwcyA9ICIjaWZkZWYgVVNFX05PUk1BTE1BUF9PQkpFQ1RTUEFDRVxuXHRub3JtYWwgPSB0ZXh0dXJlMkQoIG5vcm1hbE1hcCwgdk5vcm1hbE1hcFV2ICkueHl6ICogMi4wIC0gMS4wO1xuXHQjaWZkZWYgRkxJUF9TSURFRFxuXHRcdG5vcm1hbCA9IC0gbm9ybWFsO1xuXHQjZW5kaWZcblx0I2lmZGVmIERPVUJMRV9TSURFRFxuXHRcdG5vcm1hbCA9IG5vcm1hbCAqIGZhY2VEaXJlY3Rpb247XG5cdCNlbmRpZlxuXHRub3JtYWwgPSBub3JtYWxpemUoIG5vcm1hbE1hdHJpeCAqIG5vcm1hbCApO1xuI2VsaWYgZGVmaW5lZCggVVNFX05PUk1BTE1BUF9UQU5HRU5UU1BBQ0UgKVxuXHR2ZWMzIG1hcE4gPSB0ZXh0dXJlMkQoIG5vcm1hbE1hcCwgdk5vcm1hbE1hcFV2ICkueHl6ICogMi4wIC0gMS4wO1xuXHRtYXBOLnh5ICo9IG5vcm1hbFNjYWxlO1xuXHRub3JtYWwgPSBub3JtYWxpemUoIHRibiAqIG1hcE4gKTtcbiNlbGlmIGRlZmluZWQoIFVTRV9CVU1QTUFQIClcblx0bm9ybWFsID0gcGVydHVyYk5vcm1hbEFyYiggLSB2Vmlld1Bvc2l0aW9uLCBub3JtYWwsIGRIZHh5X2Z3ZCgpLCBmYWNlRGlyZWN0aW9uICk7XG4jZW5kaWYiOwoKdmFyIG5vcm1hbF9wYXJzX2ZyYWdtZW50ID0gIiNpZm5kZWYgRkxBVF9TSEFERURcblx0dmFyeWluZyB2ZWMzIHZOb3JtYWw7XG5cdCNpZmRlZiBVU0VfVEFOR0VOVFxuXHRcdHZhcnlpbmcgdmVjMyB2VGFuZ2VudDtcblx0XHR2YXJ5aW5nIHZlYzMgdkJpdGFuZ2VudDtcblx0I2VuZGlmXG4jZW5kaWYiOwoKdmFyIG5vcm1hbF9wYXJzX3ZlcnRleCA9ICIjaWZuZGVmIEZMQVRfU0hBREVEXG5cdHZhcnlpbmcgdmVjMyB2Tm9ybWFsO1xuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHR2YXJ5aW5nIHZlYzMgdlRhbmdlbnQ7XG5cdFx0dmFyeWluZyB2ZWMzIHZCaXRhbmdlbnQ7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCnZhciBub3JtYWxfdmVydGV4ID0gIiNpZm5kZWYgRkxBVF9TSEFERURcblx0dk5vcm1hbCA9IG5vcm1hbGl6ZSggdHJhbnNmb3JtZWROb3JtYWwgKTtcblx0I2lmZGVmIFVTRV9UQU5HRU5UXG5cdFx0dlRhbmdlbnQgPSBub3JtYWxpemUoIHRyYW5zZm9ybWVkVGFuZ2VudCApO1xuXHRcdHZCaXRhbmdlbnQgPSBub3JtYWxpemUoIGNyb3NzKCB2Tm9ybWFsLCB2VGFuZ2VudCApICogdGFuZ2VudC53ICk7XG5cdCNlbmRpZlxuI2VuZGlmIjsKCnZhciBub3JtYWxtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX05PUk1BTE1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBub3JtYWxNYXA7XG5cdHVuaWZvcm0gdmVjMiBub3JtYWxTY2FsZTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9OT1JNQUxNQVBfT0JKRUNUU1BBQ0Vcblx0dW5pZm9ybSBtYXQzIG5vcm1hbE1hdHJpeDtcbiNlbmRpZlxuI2lmICEgZGVmaW5lZCAoIFVTRV9UQU5HRU5UICkgJiYgKCBkZWZpbmVkICggVVNFX05PUk1BTE1BUF9UQU5HRU5UU1BBQ0UgKSB8fCBkZWZpbmVkICggVVNFX0NMRUFSQ09BVF9OT1JNQUxNQVAgKSB8fCBkZWZpbmVkKCBVU0VfQU5JU09UUk9QWSApIClcblx0bWF0MyBnZXRUYW5nZW50RnJhbWUoIHZlYzMgZXllX3BvcywgdmVjMyBzdXJmX25vcm0sIHZlYzIgdXYgKSB7XG5cdFx0dmVjMyBxMCA9IGRGZHgoIGV5ZV9wb3MueHl6ICk7XG5cdFx0dmVjMyBxMSA9IGRGZHkoIGV5ZV9wb3MueHl6ICk7XG5cdFx0dmVjMiBzdDAgPSBkRmR4KCB1di5zdCApO1xuXHRcdHZlYzIgc3QxID0gZEZkeSggdXYuc3QgKTtcblx0XHR2ZWMzIE4gPSBzdXJmX25vcm07XG5cdFx0dmVjMyBxMXBlcnAgPSBjcm9zcyggcTEsIE4gKTtcblx0XHR2ZWMzIHEwcGVycCA9IGNyb3NzKCBOLCBxMCApO1xuXHRcdHZlYzMgVCA9IHExcGVycCAqIHN0MC54ICsgcTBwZXJwICogc3QxLng7XG5cdFx0dmVjMyBCID0gcTFwZXJwICogc3QwLnkgKyBxMHBlcnAgKiBzdDEueTtcblx0XHRmbG9hdCBkZXQgPSBtYXgoIGRvdCggVCwgVCApLCBkb3QoIEIsIEIgKSApO1xuXHRcdGZsb2F0IHNjYWxlID0gKCBkZXQgPT0gMC4wICkgPyAwLjAgOiBpbnZlcnNlc3FydCggZGV0ICk7XG5cdFx0cmV0dXJuIG1hdDMoIFQgKiBzY2FsZSwgQiAqIHNjYWxlLCBOICk7XG5cdH1cbiNlbmRpZiI7Cgp2YXIgY2xlYXJjb2F0X25vcm1hbF9mcmFnbWVudF9iZWdpbiA9ICIjaWZkZWYgVVNFX0NMRUFSQ09BVFxuXHR2ZWMzIGNsZWFyY29hdE5vcm1hbCA9IG5vblBlcnR1cmJlZE5vcm1hbDtcbiNlbmRpZiI7Cgp2YXIgY2xlYXJjb2F0X25vcm1hbF9mcmFnbWVudF9tYXBzID0gIiNpZmRlZiBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUFxuXHR2ZWMzIGNsZWFyY29hdE1hcE4gPSB0ZXh0dXJlMkQoIGNsZWFyY29hdE5vcm1hbE1hcCwgdkNsZWFyY29hdE5vcm1hbE1hcFV2ICkueHl6ICogMi4wIC0gMS4wO1xuXHRjbGVhcmNvYXRNYXBOLnh5ICo9IGNsZWFyY29hdE5vcm1hbFNjYWxlO1xuXHRjbGVhcmNvYXROb3JtYWwgPSBub3JtYWxpemUoIHRibjIgKiBjbGVhcmNvYXRNYXBOICk7XG4jZW5kaWYiOwoKdmFyIGNsZWFyY29hdF9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfQ0xFQVJDT0FUTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGNsZWFyY29hdE1hcDtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGNsZWFyY29hdE5vcm1hbE1hcDtcblx0dW5pZm9ybSB2ZWMyIGNsZWFyY29hdE5vcm1hbFNjYWxlO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVF9ST1VHSE5FU1NNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgY2xlYXJjb2F0Um91Z2huZXNzTWFwO1xuI2VuZGlmIjsKCnZhciBpcmlkZXNjZW5jZV9wYXJzX2ZyYWdtZW50ID0gIiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VNQVBcblx0dW5pZm9ybSBzYW1wbGVyMkQgaXJpZGVzY2VuY2VNYXA7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQXG5cdHVuaWZvcm0gc2FtcGxlcjJEIGlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwO1xuI2VuZGlmIjsKCnZhciBvcGFxdWVfZnJhZ21lbnQgPSAiI2lmZGVmIE9QQVFVRVxuZGlmZnVzZUNvbG9yLmEgPSAxLjA7XG4jZW5kaWZcbiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OXG5kaWZmdXNlQ29sb3IuYSAqPSBtYXRlcmlhbC50cmFuc21pc3Npb25BbHBoYTtcbiNlbmRpZlxuZ2xfRnJhZ0NvbG9yID0gdmVjNCggb3V0Z29pbmdMaWdodCwgZGlmZnVzZUNvbG9yLmEgKTsiOwoKdmFyIHBhY2tpbmcgPSAidmVjMyBwYWNrTm9ybWFsVG9SR0IoIGNvbnN0IGluIHZlYzMgbm9ybWFsICkge1xuXHRyZXR1cm4gbm9ybWFsaXplKCBub3JtYWwgKSAqIDAuNSArIDAuNTtcbn1cbnZlYzMgdW5wYWNrUkdCVG9Ob3JtYWwoIGNvbnN0IGluIHZlYzMgcmdiICkge1xuXHRyZXR1cm4gMi4wICogcmdiLnh5eiAtIDEuMDtcbn1cbmNvbnN0IGZsb2F0IFBhY2tVcHNjYWxlID0gMjU2LiAvIDI1NS47Y29uc3QgZmxvYXQgVW5wYWNrRG93bnNjYWxlID0gMjU1LiAvIDI1Ni47XG5jb25zdCB2ZWMzIFBhY2tGYWN0b3JzID0gdmVjMyggMjU2LiAqIDI1Ni4gKiAyNTYuLCAyNTYuICogMjU2LiwgMjU2LiApO1xuY29uc3QgdmVjNCBVbnBhY2tGYWN0b3JzID0gVW5wYWNrRG93bnNjYWxlIC8gdmVjNCggUGFja0ZhY3RvcnMsIDEuICk7XG5jb25zdCBmbG9hdCBTaGlmdFJpZ2h0OCA9IDEuIC8gMjU2LjtcbnZlYzQgcGFja0RlcHRoVG9SR0JBKCBjb25zdCBpbiBmbG9hdCB2ICkge1xuXHR2ZWM0IHIgPSB2ZWM0KCBmcmFjdCggdiAqIFBhY2tGYWN0b3JzICksIHYgKTtcblx0ci55encgLT0gci54eXogKiBTaGlmdFJpZ2h0ODtcdHJldHVybiByICogUGFja1Vwc2NhbGU7XG59XG5mbG9hdCB1bnBhY2tSR0JBVG9EZXB0aCggY29uc3QgaW4gdmVjNCB2ICkge1xuXHRyZXR1cm4gZG90KCB2LCBVbnBhY2tGYWN0b3JzICk7XG59XG52ZWMyIHBhY2tEZXB0aFRvUkcoIGluIGhpZ2hwIGZsb2F0IHYgKSB7XG5cdHJldHVybiBwYWNrRGVwdGhUb1JHQkEoIHYgKS55eDtcbn1cbmZsb2F0IHVucGFja1JHVG9EZXB0aCggY29uc3QgaW4gaGlnaHAgdmVjMiB2ICkge1xuXHRyZXR1cm4gdW5wYWNrUkdCQVRvRGVwdGgoIHZlYzQoIHYueHksIDAuMCwgMC4wICkgKTtcbn1cbnZlYzQgcGFjazJIYWxmVG9SR0JBKCB2ZWMyIHYgKSB7XG5cdHZlYzQgciA9IHZlYzQoIHYueCwgZnJhY3QoIHYueCAqIDI1NS4wICksIHYueSwgZnJhY3QoIHYueSAqIDI1NS4wICkgKTtcblx0cmV0dXJuIHZlYzQoIHIueCAtIHIueSAvIDI1NS4wLCByLnksIHIueiAtIHIudyAvIDI1NS4wLCByLncgKTtcbn1cbnZlYzIgdW5wYWNrUkdCQVRvMkhhbGYoIHZlYzQgdiApIHtcblx0cmV0dXJuIHZlYzIoIHYueCArICggdi55IC8gMjU1LjAgKSwgdi56ICsgKCB2LncgLyAyNTUuMCApICk7XG59XG5mbG9hdCB2aWV3WlRvT3J0aG9ncmFwaGljRGVwdGgoIGNvbnN0IGluIGZsb2F0IHZpZXdaLCBjb25zdCBpbiBmbG9hdCBuZWFyLCBjb25zdCBpbiBmbG9hdCBmYXIgKSB7XG5cdHJldHVybiAoIHZpZXdaICsgbmVhciApIC8gKCBuZWFyIC0gZmFyICk7XG59XG5mbG9hdCBvcnRob2dyYXBoaWNEZXB0aFRvVmlld1ooIGNvbnN0IGluIGZsb2F0IGRlcHRoLCBjb25zdCBpbiBmbG9hdCBuZWFyLCBjb25zdCBpbiBmbG9hdCBmYXIgKSB7XG5cdHJldHVybiBkZXB0aCAqICggbmVhciAtIGZhciApIC0gbmVhcjtcbn1cbmZsb2F0IHZpZXdaVG9QZXJzcGVjdGl2ZURlcHRoKCBjb25zdCBpbiBmbG9hdCB2aWV3WiwgY29uc3QgaW4gZmxvYXQgbmVhciwgY29uc3QgaW4gZmxvYXQgZmFyICkge1xuXHRyZXR1cm4gKCAoIG5lYXIgKyB2aWV3WiApICogZmFyICkgLyAoICggZmFyIC0gbmVhciApICogdmlld1ogKTtcbn1cbmZsb2F0IHBlcnNwZWN0aXZlRGVwdGhUb1ZpZXdaKCBjb25zdCBpbiBmbG9hdCBkZXB0aCwgY29uc3QgaW4gZmxvYXQgbmVhciwgY29uc3QgaW4gZmxvYXQgZmFyICkge1xuXHRyZXR1cm4gKCBuZWFyICogZmFyICkgLyAoICggZmFyIC0gbmVhciApICogZGVwdGggLSBmYXIgKTtcbn0iOwoKdmFyIHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQgPSAiI2lmZGVmIFBSRU1VTFRJUExJRURfQUxQSEFcblx0Z2xfRnJhZ0NvbG9yLnJnYiAqPSBnbF9GcmFnQ29sb3IuYTtcbiNlbmRpZiI7Cgp2YXIgcHJvamVjdF92ZXJ0ZXggPSAidmVjNCBtdlBvc2l0aW9uID0gdmVjNCggdHJhbnNmb3JtZWQsIDEuMCApO1xuI2lmZGVmIFVTRV9JTlNUQU5DSU5HXG5cdG12UG9zaXRpb24gPSBpbnN0YW5jZU1hdHJpeCAqIG12UG9zaXRpb247XG4jZW5kaWZcbm12UG9zaXRpb24gPSBtb2RlbFZpZXdNYXRyaXggKiBtdlBvc2l0aW9uO1xuZ2xfUG9zaXRpb24gPSBwcm9qZWN0aW9uTWF0cml4ICogbXZQb3NpdGlvbjsiOwoKdmFyIGRpdGhlcmluZ19mcmFnbWVudCA9ICIjaWZkZWYgRElUSEVSSU5HXG5cdGdsX0ZyYWdDb2xvci5yZ2IgPSBkaXRoZXJpbmcoIGdsX0ZyYWdDb2xvci5yZ2IgKTtcbiNlbmRpZiI7Cgp2YXIgZGl0aGVyaW5nX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIERJVEhFUklOR1xuXHR2ZWMzIGRpdGhlcmluZyggdmVjMyBjb2xvciApIHtcblx0XHRmbG9hdCBncmlkX3Bvc2l0aW9uID0gcmFuZCggZ2xfRnJhZ0Nvb3JkLnh5ICk7XG5cdFx0dmVjMyBkaXRoZXJfc2hpZnRfUkdCID0gdmVjMyggMC4yNSAvIDI1NS4wLCAtMC4yNSAvIDI1NS4wLCAwLjI1IC8gMjU1LjAgKTtcblx0XHRkaXRoZXJfc2hpZnRfUkdCID0gbWl4KCAyLjAgKiBkaXRoZXJfc2hpZnRfUkdCLCAtMi4wICogZGl0aGVyX3NoaWZ0X1JHQiwgZ3JpZF9wb3NpdGlvbiApO1xuXHRcdHJldHVybiBjb2xvciArIGRpdGhlcl9zaGlmdF9SR0I7XG5cdH1cbiNlbmRpZiI7Cgp2YXIgcm91Z2huZXNzbWFwX2ZyYWdtZW50ID0gImZsb2F0IHJvdWdobmVzc0ZhY3RvciA9IHJvdWdobmVzcztcbiNpZmRlZiBVU0VfUk9VR0hORVNTTUFQXG5cdHZlYzQgdGV4ZWxSb3VnaG5lc3MgPSB0ZXh0dXJlMkQoIHJvdWdobmVzc01hcCwgdlJvdWdobmVzc01hcFV2ICk7XG5cdHJvdWdobmVzc0ZhY3RvciAqPSB0ZXhlbFJvdWdobmVzcy5nO1xuI2VuZGlmIjsKCnZhciByb3VnaG5lc3NtYXBfcGFyc19mcmFnbWVudCA9ICIjaWZkZWYgVVNFX1JPVUdITkVTU01BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCByb3VnaG5lc3NNYXA7XG4jZW5kaWYiOwoKdmFyIHNoYWRvd21hcF9wYXJzX2ZyYWdtZW50ID0gIiNpZiBOVU1fU1BPVF9MSUdIVF9DT09SRFMgPiAwXG5cdHZhcnlpbmcgdmVjNCB2U3BvdExpZ2h0Q29vcmRbIE5VTV9TUE9UX0xJR0hUX0NPT1JEUyBdO1xuI2VuZGlmXG4jaWYgTlVNX1NQT1RfTElHSFRfTUFQUyA+IDBcblx0dW5pZm9ybSBzYW1wbGVyMkQgc3BvdExpZ2h0TWFwWyBOVU1fU1BPVF9MSUdIVF9NQVBTIF07XG4jZW5kaWZcbiNpZmRlZiBVU0VfU0hBRE9XTUFQXG5cdCNpZiBOVU1fRElSX0xJR0hUX1NIQURPV1MgPiAwXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgZGlyZWN0aW9uYWxTaGFkb3dNYXBbIE5VTV9ESVJfTElHSFRfU0hBRE9XUyBdO1xuXHRcdHZhcnlpbmcgdmVjNCB2RGlyZWN0aW9uYWxTaGFkb3dDb29yZFsgTlVNX0RJUl9MSUdIVF9TSEFET1dTIF07XG5cdFx0c3RydWN0IERpcmVjdGlvbmFsTGlnaHRTaGFkb3cge1xuXHRcdFx0ZmxvYXQgc2hhZG93Qmlhcztcblx0XHRcdGZsb2F0IHNoYWRvd05vcm1hbEJpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dSYWRpdXM7XG5cdFx0XHR2ZWMyIHNoYWRvd01hcFNpemU7XG5cdFx0fTtcblx0XHR1bmlmb3JtIERpcmVjdGlvbmFsTGlnaHRTaGFkb3cgZGlyZWN0aW9uYWxMaWdodFNoYWRvd3NbIE5VTV9ESVJfTElHSFRfU0hBRE9XUyBdO1xuXHQjZW5kaWZcblx0I2lmIE5VTV9TUE9UX0xJR0hUX1NIQURPV1MgPiAwXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgc3BvdFNoYWRvd01hcFsgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyBdO1xuXHRcdHN0cnVjdCBTcG90TGlnaHRTaGFkb3cge1xuXHRcdFx0ZmxvYXQgc2hhZG93Qmlhcztcblx0XHRcdGZsb2F0IHNoYWRvd05vcm1hbEJpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dSYWRpdXM7XG5cdFx0XHR2ZWMyIHNoYWRvd01hcFNpemU7XG5cdFx0fTtcblx0XHR1bmlmb3JtIFNwb3RMaWdodFNoYWRvdyBzcG90TGlnaHRTaGFkb3dzWyBOVU1fU1BPVF9MSUdIVF9TSEFET1dTIF07XG5cdCNlbmRpZlxuXHQjaWYgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgPiAwXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgcG9pbnRTaGFkb3dNYXBbIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTIF07XG5cdFx0dmFyeWluZyB2ZWM0IHZQb2ludFNoYWRvd0Nvb3JkWyBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUyBdO1xuXHRcdHN0cnVjdCBQb2ludExpZ2h0U2hhZG93IHtcblx0XHRcdGZsb2F0IHNoYWRvd0JpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dOb3JtYWxCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93UmFkaXVzO1xuXHRcdFx0dmVjMiBzaGFkb3dNYXBTaXplO1xuXHRcdFx0ZmxvYXQgc2hhZG93Q2FtZXJhTmVhcjtcblx0XHRcdGZsb2F0IHNoYWRvd0NhbWVyYUZhcjtcblx0XHR9O1xuXHRcdHVuaWZvcm0gUG9pbnRMaWdodFNoYWRvdyBwb2ludExpZ2h0U2hhZG93c1sgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgXTtcblx0I2VuZGlmXG5cdGZsb2F0IHRleHR1cmUyRENvbXBhcmUoIHNhbXBsZXIyRCBkZXB0aHMsIHZlYzIgdXYsIGZsb2F0IGNvbXBhcmUgKSB7XG5cdFx0cmV0dXJuIHN0ZXAoIGNvbXBhcmUsIHVucGFja1JHQkFUb0RlcHRoKCB0ZXh0dXJlMkQoIGRlcHRocywgdXYgKSApICk7XG5cdH1cblx0dmVjMiB0ZXh0dXJlMkREaXN0cmlidXRpb24oIHNhbXBsZXIyRCBzaGFkb3csIHZlYzIgdXYgKSB7XG5cdFx0cmV0dXJuIHVucGFja1JHQkFUbzJIYWxmKCB0ZXh0dXJlMkQoIHNoYWRvdywgdXYgKSApO1xuXHR9XG5cdGZsb2F0IFZTTVNoYWRvdyAoc2FtcGxlcjJEIHNoYWRvdywgdmVjMiB1diwgZmxvYXQgY29tcGFyZSApe1xuXHRcdGZsb2F0IG9jY2x1c2lvbiA9IDEuMDtcblx0XHR2ZWMyIGRpc3RyaWJ1dGlvbiA9IHRleHR1cmUyRERpc3RyaWJ1dGlvbiggc2hhZG93LCB1diApO1xuXHRcdGZsb2F0IGhhcmRfc2hhZG93ID0gc3RlcCggY29tcGFyZSAsIGRpc3RyaWJ1dGlvbi54ICk7XG5cdFx0aWYgKGhhcmRfc2hhZG93ICE9IDEuMCApIHtcblx0XHRcdGZsb2F0IGRpc3RhbmNlID0gY29tcGFyZSAtIGRpc3RyaWJ1dGlvbi54IDtcblx0XHRcdGZsb2F0IHZhcmlhbmNlID0gbWF4KCAwLjAwMDAwLCBkaXN0cmlidXRpb24ueSAqIGRpc3RyaWJ1dGlvbi55ICk7XG5cdFx0XHRmbG9hdCBzb2Z0bmVzc19wcm9iYWJpbGl0eSA9IHZhcmlhbmNlIC8gKHZhcmlhbmNlICsgZGlzdGFuY2UgKiBkaXN0YW5jZSApO1x0XHRcdHNvZnRuZXNzX3Byb2JhYmlsaXR5ID0gY2xhbXAoICggc29mdG5lc3NfcHJvYmFiaWxpdHkgLSAwLjMgKSAvICggMC45NSAtIDAuMyApLCAwLjAsIDEuMCApO1x0XHRcdG9jY2x1c2lvbiA9IGNsYW1wKCBtYXgoIGhhcmRfc2hhZG93LCBzb2Z0bmVzc19wcm9iYWJpbGl0eSApLCAwLjAsIDEuMCApO1xuXHRcdH1cblx0XHRyZXR1cm4gb2NjbHVzaW9uO1xuXHR9XG5cdGZsb2F0IGdldFNoYWRvdyggc2FtcGxlcjJEIHNoYWRvd01hcCwgdmVjMiBzaGFkb3dNYXBTaXplLCBmbG9hdCBzaGFkb3dCaWFzLCBmbG9hdCBzaGFkb3dSYWRpdXMsIHZlYzQgc2hhZG93Q29vcmQgKSB7XG5cdFx0ZmxvYXQgc2hhZG93ID0gMS4wO1xuXHRcdHNoYWRvd0Nvb3JkLnh5eiAvPSBzaGFkb3dDb29yZC53O1xuXHRcdHNoYWRvd0Nvb3JkLnogKz0gc2hhZG93Qmlhcztcblx0XHRib29sIGluRnJ1c3R1bSA9IHNoYWRvd0Nvb3JkLnggPj0gMC4wICYmIHNoYWRvd0Nvb3JkLnggPD0gMS4wICYmIHNoYWRvd0Nvb3JkLnkgPj0gMC4wICYmIHNoYWRvd0Nvb3JkLnkgPD0gMS4wO1xuXHRcdGJvb2wgZnJ1c3R1bVRlc3QgPSBpbkZydXN0dW0gJiYgc2hhZG93Q29vcmQueiA8PSAxLjA7XG5cdFx0aWYgKCBmcnVzdHVtVGVzdCApIHtcblx0XHQjaWYgZGVmaW5lZCggU0hBRE9XTUFQX1RZUEVfUENGIClcblx0XHRcdHZlYzIgdGV4ZWxTaXplID0gdmVjMiggMS4wICkgLyBzaGFkb3dNYXBTaXplO1xuXHRcdFx0ZmxvYXQgZHgwID0gLSB0ZXhlbFNpemUueCAqIHNoYWRvd1JhZGl1cztcblx0XHRcdGZsb2F0IGR5MCA9IC0gdGV4ZWxTaXplLnkgKiBzaGFkb3dSYWRpdXM7XG5cdFx0XHRmbG9hdCBkeDEgPSArIHRleGVsU2l6ZS54ICogc2hhZG93UmFkaXVzO1xuXHRcdFx0ZmxvYXQgZHkxID0gKyB0ZXhlbFNpemUueSAqIHNoYWRvd1JhZGl1cztcblx0XHRcdGZsb2F0IGR4MiA9IGR4MCAvIDIuMDtcblx0XHRcdGZsb2F0IGR5MiA9IGR5MCAvIDIuMDtcblx0XHRcdGZsb2F0IGR4MyA9IGR4MSAvIDIuMDtcblx0XHRcdGZsb2F0IGR5MyA9IGR5MSAvIDIuMDtcblx0XHRcdHNoYWRvdyA9IChcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MCwgZHkwICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCAwLjAsIGR5MCApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgxLCBkeTAgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MiwgZHkyICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCAwLjAsIGR5MiApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgzLCBkeTIgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MCwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDIsIDAuMCApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5LCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggZHgzLCAwLjAgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MSwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDIsIGR5MyApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggMC4wLCBkeTMgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MywgZHkzICksIHNoYWRvd0Nvb3JkLnogKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgc2hhZG93Q29vcmQueHkgKyB2ZWMyKCBkeDAsIGR5MSApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5ICsgdmVjMiggMC4wLCBkeTEgKSwgc2hhZG93Q29vcmQueiApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSArIHZlYzIoIGR4MSwgZHkxICksIHNoYWRvd0Nvb3JkLnogKVxuXHRcdFx0KSAqICggMS4wIC8gMTcuMCApO1xuXHRcdCNlbGlmIGRlZmluZWQoIFNIQURPV01BUF9UWVBFX1BDRl9TT0ZUIClcblx0XHRcdHZlYzIgdGV4ZWxTaXplID0gdmVjMiggMS4wICkgLyBzaGFkb3dNYXBTaXplO1xuXHRcdFx0ZmxvYXQgZHggPSB0ZXhlbFNpemUueDtcblx0XHRcdGZsb2F0IGR5ID0gdGV4ZWxTaXplLnk7XG5cdFx0XHR2ZWMyIHV2ID0gc2hhZG93Q29vcmQueHk7XG5cdFx0XHR2ZWMyIGYgPSBmcmFjdCggdXYgKiBzaGFkb3dNYXBTaXplICsgMC41ICk7XG5cdFx0XHR1diAtPSBmICogdGV4ZWxTaXplO1xuXHRcdFx0c2hhZG93ID0gKFxuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2LCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggZHgsIDAuMCApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMC4wLCBkeSApLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdGV4ZWxTaXplLCBzaGFkb3dDb29yZC56ICkgK1xuXHRcdFx0XHRtaXgoIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAtZHgsIDAuMCApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAyLjAgKiBkeCwgMC4wICksIHNoYWRvd0Nvb3JkLnogKSxcblx0XHRcdFx0XHQgZi54ICkgK1xuXHRcdFx0XHRtaXgoIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAtZHgsIGR5ICksIHNoYWRvd0Nvb3JkLnogKSxcblx0XHRcdFx0XHQgdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCB1diArIHZlYzIoIDIuMCAqIGR4LCBkeSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IGYueCApICtcblx0XHRcdFx0bWl4KCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMC4wLCAtZHkgKSwgc2hhZG93Q29vcmQueiApLFxuXHRcdFx0XHRcdCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMC4wLCAyLjAgKiBkeSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IGYueSApICtcblx0XHRcdFx0bWl4KCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggZHgsIC1keSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0IHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCBkeCwgMi4wICogZHkgKSwgc2hhZG93Q29vcmQueiApLFxuXHRcdFx0XHRcdCBmLnkgKSArXG5cdFx0XHRcdG1peCggbWl4KCB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggLWR4LCAtZHkgKSwgc2hhZG93Q29vcmQueiApLFxuXHRcdFx0XHRcdFx0ICB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHV2ICsgdmVjMiggMi4wICogZHgsIC1keSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0XHQgIGYueCApLFxuXHRcdFx0XHRcdCBtaXgoIHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgdXYgKyB2ZWMyKCAtZHgsIDIuMCAqIGR5ICksIHNoYWRvd0Nvb3JkLnogKSxcblx0XHRcdFx0XHRcdCAgdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCB1diArIHZlYzIoIDIuMCAqIGR4LCAyLjAgKiBkeSApLCBzaGFkb3dDb29yZC56ICksXG5cdFx0XHRcdFx0XHQgIGYueCApLFxuXHRcdFx0XHRcdCBmLnkgKVxuXHRcdFx0KSAqICggMS4wIC8gOS4wICk7XG5cdFx0I2VsaWYgZGVmaW5lZCggU0hBRE9XTUFQX1RZUEVfVlNNIClcblx0XHRcdHNoYWRvdyA9IFZTTVNoYWRvdyggc2hhZG93TWFwLCBzaGFkb3dDb29yZC54eSwgc2hhZG93Q29vcmQueiApO1xuXHRcdCNlbHNlXG5cdFx0XHRzaGFkb3cgPSB0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIHNoYWRvd0Nvb3JkLnh5LCBzaGFkb3dDb29yZC56ICk7XG5cdFx0I2VuZGlmXG5cdFx0fVxuXHRcdHJldHVybiBzaGFkb3c7XG5cdH1cblx0dmVjMiBjdWJlVG9VViggdmVjMyB2LCBmbG9hdCB0ZXhlbFNpemVZICkge1xuXHRcdHZlYzMgYWJzViA9IGFicyggdiApO1xuXHRcdGZsb2F0IHNjYWxlVG9DdWJlID0gMS4wIC8gbWF4KCBhYnNWLngsIG1heCggYWJzVi55LCBhYnNWLnogKSApO1xuXHRcdGFic1YgKj0gc2NhbGVUb0N1YmU7XG5cdFx0diAqPSBzY2FsZVRvQ3ViZSAqICggMS4wIC0gMi4wICogdGV4ZWxTaXplWSApO1xuXHRcdHZlYzIgcGxhbmFyID0gdi54eTtcblx0XHRmbG9hdCBhbG1vc3RBVGV4ZWwgPSAxLjUgKiB0ZXhlbFNpemVZO1xuXHRcdGZsb2F0IGFsbW9zdE9uZSA9IDEuMCAtIGFsbW9zdEFUZXhlbDtcblx0XHRpZiAoIGFic1YueiA+PSBhbG1vc3RPbmUgKSB7XG5cdFx0XHRpZiAoIHYueiA+IDAuMCApXG5cdFx0XHRcdHBsYW5hci54ID0gNC4wIC0gdi54O1xuXHRcdH0gZWxzZSBpZiAoIGFic1YueCA+PSBhbG1vc3RPbmUgKSB7XG5cdFx0XHRmbG9hdCBzaWduWCA9IHNpZ24oIHYueCApO1xuXHRcdFx0cGxhbmFyLnggPSB2LnogKiBzaWduWCArIDIuMCAqIHNpZ25YO1xuXHRcdH0gZWxzZSBpZiAoIGFic1YueSA+PSBhbG1vc3RPbmUgKSB7XG5cdFx0XHRmbG9hdCBzaWduWSA9IHNpZ24oIHYueSApO1xuXHRcdFx0cGxhbmFyLnggPSB2LnggKyAyLjAgKiBzaWduWSArIDIuMDtcblx0XHRcdHBsYW5hci55ID0gdi56ICogc2lnblkgLSAyLjA7XG5cdFx0fVxuXHRcdHJldHVybiB2ZWMyKCAwLjEyNSwgMC4yNSApICogcGxhbmFyICsgdmVjMiggMC4zNzUsIDAuNzUgKTtcblx0fVxuXHRmbG9hdCBnZXRQb2ludFNoYWRvdyggc2FtcGxlcjJEIHNoYWRvd01hcCwgdmVjMiBzaGFkb3dNYXBTaXplLCBmbG9hdCBzaGFkb3dCaWFzLCBmbG9hdCBzaGFkb3dSYWRpdXMsIHZlYzQgc2hhZG93Q29vcmQsIGZsb2F0IHNoYWRvd0NhbWVyYU5lYXIsIGZsb2F0IHNoYWRvd0NhbWVyYUZhciApIHtcblx0XHR2ZWMyIHRleGVsU2l6ZSA9IHZlYzIoIDEuMCApIC8gKCBzaGFkb3dNYXBTaXplICogdmVjMiggNC4wLCAyLjAgKSApO1xuXHRcdHZlYzMgbGlnaHRUb1Bvc2l0aW9uID0gc2hhZG93Q29vcmQueHl6O1xuXHRcdGZsb2F0IGRwID0gKCBsZW5ndGgoIGxpZ2h0VG9Qb3NpdGlvbiApIC0gc2hhZG93Q2FtZXJhTmVhciApIC8gKCBzaGFkb3dDYW1lcmFGYXIgLSBzaGFkb3dDYW1lcmFOZWFyICk7XHRcdGRwICs9IHNoYWRvd0JpYXM7XG5cdFx0dmVjMyBiZDNEID0gbm9ybWFsaXplKCBsaWdodFRvUG9zaXRpb24gKTtcblx0XHQjaWYgZGVmaW5lZCggU0hBRE9XTUFQX1RZUEVfUENGICkgfHwgZGVmaW5lZCggU0hBRE9XTUFQX1RZUEVfUENGX1NPRlQgKSB8fCBkZWZpbmVkKCBTSEFET1dNQVBfVFlQRV9WU00gKVxuXHRcdFx0dmVjMiBvZmZzZXQgPSB2ZWMyKCAtIDEsIDEgKSAqIHNoYWRvd1JhZGl1cyAqIHRleGVsU2l6ZS55O1xuXHRcdFx0cmV0dXJuIChcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCArIG9mZnNldC54eXksIHRleGVsU2l6ZS55ICksIGRwICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnl5eSwgdGV4ZWxTaXplLnkgKSwgZHAgKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QgKyBvZmZzZXQueHl4LCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCArIG9mZnNldC55eXgsIHRleGVsU2l6ZS55ICksIGRwICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNELCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCArIG9mZnNldC54eHksIHRleGVsU2l6ZS55ICksIGRwICkgK1xuXHRcdFx0XHR0ZXh0dXJlMkRDb21wYXJlKCBzaGFkb3dNYXAsIGN1YmVUb1VWKCBiZDNEICsgb2Zmc2V0Lnl4eSwgdGV4ZWxTaXplLnkgKSwgZHAgKSArXG5cdFx0XHRcdHRleHR1cmUyRENvbXBhcmUoIHNoYWRvd01hcCwgY3ViZVRvVVYoIGJkM0QgKyBvZmZzZXQueHh4LCB0ZXhlbFNpemUueSApLCBkcCApICtcblx0XHRcdFx0dGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCArIG9mZnNldC55eHgsIHRleGVsU2l6ZS55ICksIGRwIClcblx0XHRcdCkgKiAoIDEuMCAvIDkuMCApO1xuXHRcdCNlbHNlXG5cdFx0XHRyZXR1cm4gdGV4dHVyZTJEQ29tcGFyZSggc2hhZG93TWFwLCBjdWJlVG9VViggYmQzRCwgdGV4ZWxTaXplLnkgKSwgZHAgKTtcblx0XHQjZW5kaWZcblx0fVxuI2VuZGlmIjsKCnZhciBzaGFkb3dtYXBfcGFyc192ZXJ0ZXggPSAiI2lmIE5VTV9TUE9UX0xJR0hUX0NPT1JEUyA+IDBcblx0dW5pZm9ybSBtYXQ0IHNwb3RMaWdodE1hdHJpeFsgTlVNX1NQT1RfTElHSFRfQ09PUkRTIF07XG5cdHZhcnlpbmcgdmVjNCB2U3BvdExpZ2h0Q29vcmRbIE5VTV9TUE9UX0xJR0hUX0NPT1JEUyBdO1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NIQURPV01BUFxuXHQjaWYgTlVNX0RJUl9MSUdIVF9TSEFET1dTID4gMFxuXHRcdHVuaWZvcm0gbWF0NCBkaXJlY3Rpb25hbFNoYWRvd01hdHJpeFsgTlVNX0RJUl9MSUdIVF9TSEFET1dTIF07XG5cdFx0dmFyeWluZyB2ZWM0IHZEaXJlY3Rpb25hbFNoYWRvd0Nvb3JkWyBOVU1fRElSX0xJR0hUX1NIQURPV1MgXTtcblx0XHRzdHJ1Y3QgRGlyZWN0aW9uYWxMaWdodFNoYWRvdyB7XG5cdFx0XHRmbG9hdCBzaGFkb3dCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93Tm9ybWFsQmlhcztcblx0XHRcdGZsb2F0IHNoYWRvd1JhZGl1cztcblx0XHRcdHZlYzIgc2hhZG93TWFwU2l6ZTtcblx0XHR9O1xuXHRcdHVuaWZvcm0gRGlyZWN0aW9uYWxMaWdodFNoYWRvdyBkaXJlY3Rpb25hbExpZ2h0U2hhZG93c1sgTlVNX0RJUl9MSUdIVF9TSEFET1dTIF07XG5cdCNlbmRpZlxuXHQjaWYgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyA+IDBcblx0XHRzdHJ1Y3QgU3BvdExpZ2h0U2hhZG93IHtcblx0XHRcdGZsb2F0IHNoYWRvd0JpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dOb3JtYWxCaWFzO1xuXHRcdFx0ZmxvYXQgc2hhZG93UmFkaXVzO1xuXHRcdFx0dmVjMiBzaGFkb3dNYXBTaXplO1xuXHRcdH07XG5cdFx0dW5pZm9ybSBTcG90TGlnaHRTaGFkb3cgc3BvdExpZ2h0U2hhZG93c1sgTlVNX1NQT1RfTElHSFRfU0hBRE9XUyBdO1xuXHQjZW5kaWZcblx0I2lmIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTID4gMFxuXHRcdHVuaWZvcm0gbWF0NCBwb2ludFNoYWRvd01hdHJpeFsgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgXTtcblx0XHR2YXJ5aW5nIHZlYzQgdlBvaW50U2hhZG93Q29vcmRbIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTIF07XG5cdFx0c3RydWN0IFBvaW50TGlnaHRTaGFkb3cge1xuXHRcdFx0ZmxvYXQgc2hhZG93Qmlhcztcblx0XHRcdGZsb2F0IHNoYWRvd05vcm1hbEJpYXM7XG5cdFx0XHRmbG9hdCBzaGFkb3dSYWRpdXM7XG5cdFx0XHR2ZWMyIHNoYWRvd01hcFNpemU7XG5cdFx0XHRmbG9hdCBzaGFkb3dDYW1lcmFOZWFyO1xuXHRcdFx0ZmxvYXQgc2hhZG93Q2FtZXJhRmFyO1xuXHRcdH07XG5cdFx0dW5pZm9ybSBQb2ludExpZ2h0U2hhZG93IHBvaW50TGlnaHRTaGFkb3dzWyBOVU1fUE9JTlRfTElHSFRfU0hBRE9XUyBdO1xuXHQjZW5kaWZcbiNlbmRpZiI7Cgp2YXIgc2hhZG93bWFwX3ZlcnRleCA9ICIjaWYgKCBkZWZpbmVkKCBVU0VfU0hBRE9XTUFQICkgJiYgKCBOVU1fRElSX0xJR0hUX1NIQURPV1MgPiAwIHx8IE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTID4gMCApICkgfHwgKCBOVU1fU1BPVF9MSUdIVF9DT09SRFMgPiAwIClcblx0dmVjMyBzaGFkb3dXb3JsZE5vcm1hbCA9IGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIHRyYW5zZm9ybWVkTm9ybWFsLCB2aWV3TWF0cml4ICk7XG5cdHZlYzQgc2hhZG93V29ybGRQb3NpdGlvbjtcbiNlbmRpZlxuI2lmIGRlZmluZWQoIFVTRV9TSEFET1dNQVAgKVxuXHQjaWYgTlVNX0RJUl9MSUdIVF9TSEFET1dTID4gMFxuXHRcdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0XHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fRElSX0xJR0hUX1NIQURPV1M7IGkgKysgKSB7XG5cdFx0XHRzaGFkb3dXb3JsZFBvc2l0aW9uID0gd29ybGRQb3NpdGlvbiArIHZlYzQoIHNoYWRvd1dvcmxkTm9ybWFsICogZGlyZWN0aW9uYWxMaWdodFNoYWRvd3NbIGkgXS5zaGFkb3dOb3JtYWxCaWFzLCAwICk7XG5cdFx0XHR2RGlyZWN0aW9uYWxTaGFkb3dDb29yZFsgaSBdID0gZGlyZWN0aW9uYWxTaGFkb3dNYXRyaXhbIGkgXSAqIHNoYWRvd1dvcmxkUG9zaXRpb247XG5cdFx0fVxuXHRcdCNwcmFnbWEgdW5yb2xsX2xvb3BfZW5kXG5cdCNlbmRpZlxuXHQjaWYgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MgPiAwXG5cdFx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRcdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTOyBpICsrICkge1xuXHRcdFx0c2hhZG93V29ybGRQb3NpdGlvbiA9IHdvcmxkUG9zaXRpb24gKyB2ZWM0KCBzaGFkb3dXb3JsZE5vcm1hbCAqIHBvaW50TGlnaHRTaGFkb3dzWyBpIF0uc2hhZG93Tm9ybWFsQmlhcywgMCApO1xuXHRcdFx0dlBvaW50U2hhZG93Q29vcmRbIGkgXSA9IHBvaW50U2hhZG93TWF0cml4WyBpIF0gKiBzaGFkb3dXb3JsZFBvc2l0aW9uO1xuXHRcdH1cblx0XHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHQjZW5kaWZcbiNlbmRpZlxuI2lmIE5VTV9TUE9UX0xJR0hUX0NPT1JEUyA+IDBcblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9zdGFydFxuXHRmb3IgKCBpbnQgaSA9IDA7IGkgPCBOVU1fU1BPVF9MSUdIVF9DT09SRFM7IGkgKysgKSB7XG5cdFx0c2hhZG93V29ybGRQb3NpdGlvbiA9IHdvcmxkUG9zaXRpb247XG5cdFx0I2lmICggZGVmaW5lZCggVVNFX1NIQURPV01BUCApICYmIFVOUk9MTEVEX0xPT1BfSU5ERVggPCBOVU1fU1BPVF9MSUdIVF9TSEFET1dTIClcblx0XHRcdHNoYWRvd1dvcmxkUG9zaXRpb24ueHl6ICs9IHNoYWRvd1dvcmxkTm9ybWFsICogc3BvdExpZ2h0U2hhZG93c1sgaSBdLnNoYWRvd05vcm1hbEJpYXM7XG5cdFx0I2VuZGlmXG5cdFx0dlNwb3RMaWdodENvb3JkWyBpIF0gPSBzcG90TGlnaHRNYXRyaXhbIGkgXSAqIHNoYWRvd1dvcmxkUG9zaXRpb247XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcbiNlbmRpZiI7Cgp2YXIgc2hhZG93bWFza19wYXJzX2ZyYWdtZW50ID0gImZsb2F0IGdldFNoYWRvd01hc2soKSB7XG5cdGZsb2F0IHNoYWRvdyA9IDEuMDtcblx0I2lmZGVmIFVTRV9TSEFET1dNQVBcblx0I2lmIE5VTV9ESVJfTElHSFRfU0hBRE9XUyA+IDBcblx0RGlyZWN0aW9uYWxMaWdodFNoYWRvdyBkaXJlY3Rpb25hbExpZ2h0O1xuXHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9ESVJfTElHSFRfU0hBRE9XUzsgaSArKyApIHtcblx0XHRkaXJlY3Rpb25hbExpZ2h0ID0gZGlyZWN0aW9uYWxMaWdodFNoYWRvd3NbIGkgXTtcblx0XHRzaGFkb3cgKj0gcmVjZWl2ZVNoYWRvdyA/IGdldFNoYWRvdyggZGlyZWN0aW9uYWxTaGFkb3dNYXBbIGkgXSwgZGlyZWN0aW9uYWxMaWdodC5zaGFkb3dNYXBTaXplLCBkaXJlY3Rpb25hbExpZ2h0LnNoYWRvd0JpYXMsIGRpcmVjdGlvbmFsTGlnaHQuc2hhZG93UmFkaXVzLCB2RGlyZWN0aW9uYWxTaGFkb3dDb29yZFsgaSBdICkgOiAxLjA7XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcblx0I2VuZGlmXG5cdCNpZiBOVU1fU1BPVF9MSUdIVF9TSEFET1dTID4gMFxuXHRTcG90TGlnaHRTaGFkb3cgc3BvdExpZ2h0O1xuXHQjcHJhZ21hIHVucm9sbF9sb29wX3N0YXJ0XG5cdGZvciAoIGludCBpID0gMDsgaSA8IE5VTV9TUE9UX0xJR0hUX1NIQURPV1M7IGkgKysgKSB7XG5cdFx0c3BvdExpZ2h0ID0gc3BvdExpZ2h0U2hhZG93c1sgaSBdO1xuXHRcdHNoYWRvdyAqPSByZWNlaXZlU2hhZG93ID8gZ2V0U2hhZG93KCBzcG90U2hhZG93TWFwWyBpIF0sIHNwb3RMaWdodC5zaGFkb3dNYXBTaXplLCBzcG90TGlnaHQuc2hhZG93Qmlhcywgc3BvdExpZ2h0LnNoYWRvd1JhZGl1cywgdlNwb3RMaWdodENvb3JkWyBpIF0gKSA6IDEuMDtcblx0fVxuXHQjcHJhZ21hIHVucm9sbF9sb29wX2VuZFxuXHQjZW5kaWZcblx0I2lmIE5VTV9QT0lOVF9MSUdIVF9TSEFET1dTID4gMFxuXHRQb2ludExpZ2h0U2hhZG93IHBvaW50TGlnaHQ7XG5cdCNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRcblx0Zm9yICggaW50IGkgPSAwOyBpIDwgTlVNX1BPSU5UX0xJR0hUX1NIQURPV1M7IGkgKysgKSB7XG5cdFx0cG9pbnRMaWdodCA9IHBvaW50TGlnaHRTaGFkb3dzWyBpIF07XG5cdFx0c2hhZG93ICo9IHJlY2VpdmVTaGFkb3cgPyBnZXRQb2ludFNoYWRvdyggcG9pbnRTaGFkb3dNYXBbIGkgXSwgcG9pbnRMaWdodC5zaGFkb3dNYXBTaXplLCBwb2ludExpZ2h0LnNoYWRvd0JpYXMsIHBvaW50TGlnaHQuc2hhZG93UmFkaXVzLCB2UG9pbnRTaGFkb3dDb29yZFsgaSBdLCBwb2ludExpZ2h0LnNoYWRvd0NhbWVyYU5lYXIsIHBvaW50TGlnaHQuc2hhZG93Q2FtZXJhRmFyICkgOiAxLjA7XG5cdH1cblx0I3ByYWdtYSB1bnJvbGxfbG9vcF9lbmRcblx0I2VuZGlmXG5cdCNlbmRpZlxuXHRyZXR1cm4gc2hhZG93O1xufSI7Cgp2YXIgc2tpbmJhc2VfdmVydGV4ID0gIiNpZmRlZiBVU0VfU0tJTk5JTkdcblx0bWF0NCBib25lTWF0WCA9IGdldEJvbmVNYXRyaXgoIHNraW5JbmRleC54ICk7XG5cdG1hdDQgYm9uZU1hdFkgPSBnZXRCb25lTWF0cml4KCBza2luSW5kZXgueSApO1xuXHRtYXQ0IGJvbmVNYXRaID0gZ2V0Qm9uZU1hdHJpeCggc2tpbkluZGV4LnogKTtcblx0bWF0NCBib25lTWF0VyA9IGdldEJvbmVNYXRyaXgoIHNraW5JbmRleC53ICk7XG4jZW5kaWYiOwoKdmFyIHNraW5uaW5nX3BhcnNfdmVydGV4ID0gIiNpZmRlZiBVU0VfU0tJTk5JTkdcblx0dW5pZm9ybSBtYXQ0IGJpbmRNYXRyaXg7XG5cdHVuaWZvcm0gbWF0NCBiaW5kTWF0cml4SW52ZXJzZTtcblx0dW5pZm9ybSBoaWdocCBzYW1wbGVyMkQgYm9uZVRleHR1cmU7XG5cdHVuaWZvcm0gaW50IGJvbmVUZXh0dXJlU2l6ZTtcblx0bWF0NCBnZXRCb25lTWF0cml4KCBjb25zdCBpbiBmbG9hdCBpICkge1xuXHRcdGZsb2F0IGogPSBpICogNC4wO1xuXHRcdGZsb2F0IHggPSBtb2QoIGosIGZsb2F0KCBib25lVGV4dHVyZVNpemUgKSApO1xuXHRcdGZsb2F0IHkgPSBmbG9vciggaiAvIGZsb2F0KCBib25lVGV4dHVyZVNpemUgKSApO1xuXHRcdGZsb2F0IGR4ID0gMS4wIC8gZmxvYXQoIGJvbmVUZXh0dXJlU2l6ZSApO1xuXHRcdGZsb2F0IGR5ID0gMS4wIC8gZmxvYXQoIGJvbmVUZXh0dXJlU2l6ZSApO1xuXHRcdHkgPSBkeSAqICggeSArIDAuNSApO1xuXHRcdHZlYzQgdjEgPSB0ZXh0dXJlMkQoIGJvbmVUZXh0dXJlLCB2ZWMyKCBkeCAqICggeCArIDAuNSApLCB5ICkgKTtcblx0XHR2ZWM0IHYyID0gdGV4dHVyZTJEKCBib25lVGV4dHVyZSwgdmVjMiggZHggKiAoIHggKyAxLjUgKSwgeSApICk7XG5cdFx0dmVjNCB2MyA9IHRleHR1cmUyRCggYm9uZVRleHR1cmUsIHZlYzIoIGR4ICogKCB4ICsgMi41ICksIHkgKSApO1xuXHRcdHZlYzQgdjQgPSB0ZXh0dXJlMkQoIGJvbmVUZXh0dXJlLCB2ZWMyKCBkeCAqICggeCArIDMuNSApLCB5ICkgKTtcblx0XHRtYXQ0IGJvbmUgPSBtYXQ0KCB2MSwgdjIsIHYzLCB2NCApO1xuXHRcdHJldHVybiBib25lO1xuXHR9XG4jZW5kaWYiOwoKdmFyIHNraW5uaW5nX3ZlcnRleCA9ICIjaWZkZWYgVVNFX1NLSU5OSU5HXG5cdHZlYzQgc2tpblZlcnRleCA9IGJpbmRNYXRyaXggKiB2ZWM0KCB0cmFuc2Zvcm1lZCwgMS4wICk7XG5cdHZlYzQgc2tpbm5lZCA9IHZlYzQoIDAuMCApO1xuXHRza2lubmVkICs9IGJvbmVNYXRYICogc2tpblZlcnRleCAqIHNraW5XZWlnaHQueDtcblx0c2tpbm5lZCArPSBib25lTWF0WSAqIHNraW5WZXJ0ZXggKiBza2luV2VpZ2h0Lnk7XG5cdHNraW5uZWQgKz0gYm9uZU1hdFogKiBza2luVmVydGV4ICogc2tpbldlaWdodC56O1xuXHRza2lubmVkICs9IGJvbmVNYXRXICogc2tpblZlcnRleCAqIHNraW5XZWlnaHQudztcblx0dHJhbnNmb3JtZWQgPSAoIGJpbmRNYXRyaXhJbnZlcnNlICogc2tpbm5lZCApLnh5ejtcbiNlbmRpZiI7Cgp2YXIgc2tpbm5vcm1hbF92ZXJ0ZXggPSAiI2lmZGVmIFVTRV9TS0lOTklOR1xuXHRtYXQ0IHNraW5NYXRyaXggPSBtYXQ0KCAwLjAgKTtcblx0c2tpbk1hdHJpeCArPSBza2luV2VpZ2h0LnggKiBib25lTWF0WDtcblx0c2tpbk1hdHJpeCArPSBza2luV2VpZ2h0LnkgKiBib25lTWF0WTtcblx0c2tpbk1hdHJpeCArPSBza2luV2VpZ2h0LnogKiBib25lTWF0Wjtcblx0c2tpbk1hdHJpeCArPSBza2luV2VpZ2h0LncgKiBib25lTWF0Vztcblx0c2tpbk1hdHJpeCA9IGJpbmRNYXRyaXhJbnZlcnNlICogc2tpbk1hdHJpeCAqIGJpbmRNYXRyaXg7XG5cdG9iamVjdE5vcm1hbCA9IHZlYzQoIHNraW5NYXRyaXggKiB2ZWM0KCBvYmplY3ROb3JtYWwsIDAuMCApICkueHl6O1xuXHQjaWZkZWYgVVNFX1RBTkdFTlRcblx0XHRvYmplY3RUYW5nZW50ID0gdmVjNCggc2tpbk1hdHJpeCAqIHZlYzQoIG9iamVjdFRhbmdlbnQsIDAuMCApICkueHl6O1xuXHQjZW5kaWZcbiNlbmRpZiI7Cgp2YXIgc3BlY3VsYXJtYXBfZnJhZ21lbnQgPSAiZmxvYXQgc3BlY3VsYXJTdHJlbmd0aDtcbiNpZmRlZiBVU0VfU1BFQ1VMQVJNQVBcblx0dmVjNCB0ZXhlbFNwZWN1bGFyID0gdGV4dHVyZTJEKCBzcGVjdWxhck1hcCwgdlNwZWN1bGFyTWFwVXYgKTtcblx0c3BlY3VsYXJTdHJlbmd0aCA9IHRleGVsU3BlY3VsYXIucjtcbiNlbHNlXG5cdHNwZWN1bGFyU3RyZW5ndGggPSAxLjA7XG4jZW5kaWYiOwoKdmFyIHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9TUEVDVUxBUk1BUFxuXHR1bmlmb3JtIHNhbXBsZXIyRCBzcGVjdWxhck1hcDtcbiNlbmRpZiI7Cgp2YXIgdG9uZW1hcHBpbmdfZnJhZ21lbnQgPSAiI2lmIGRlZmluZWQoIFRPTkVfTUFQUElORyApXG5cdGdsX0ZyYWdDb2xvci5yZ2IgPSB0b25lTWFwcGluZyggZ2xfRnJhZ0NvbG9yLnJnYiApO1xuI2VuZGlmIjsKCnZhciB0b25lbWFwcGluZ19wYXJzX2ZyYWdtZW50ID0gIiNpZm5kZWYgc2F0dXJhdGVcbiNkZWZpbmUgc2F0dXJhdGUoIGEgKSBjbGFtcCggYSwgMC4wLCAxLjAgKVxuI2VuZGlmXG51bmlmb3JtIGZsb2F0IHRvbmVNYXBwaW5nRXhwb3N1cmU7XG52ZWMzIExpbmVhclRvbmVNYXBwaW5nKCB2ZWMzIGNvbG9yICkge1xuXHRyZXR1cm4gc2F0dXJhdGUoIHRvbmVNYXBwaW5nRXhwb3N1cmUgKiBjb2xvciApO1xufVxudmVjMyBSZWluaGFyZFRvbmVNYXBwaW5nKCB2ZWMzIGNvbG9yICkge1xuXHRjb2xvciAqPSB0b25lTWFwcGluZ0V4cG9zdXJlO1xuXHRyZXR1cm4gc2F0dXJhdGUoIGNvbG9yIC8gKCB2ZWMzKCAxLjAgKSArIGNvbG9yICkgKTtcbn1cbnZlYzMgT3B0aW1pemVkQ2luZW9uVG9uZU1hcHBpbmcoIHZlYzMgY29sb3IgKSB7XG5cdGNvbG9yICo9IHRvbmVNYXBwaW5nRXhwb3N1cmU7XG5cdGNvbG9yID0gbWF4KCB2ZWMzKCAwLjAgKSwgY29sb3IgLSAwLjAwNCApO1xuXHRyZXR1cm4gcG93KCAoIGNvbG9yICogKCA2LjIgKiBjb2xvciArIDAuNSApICkgLyAoIGNvbG9yICogKCA2LjIgKiBjb2xvciArIDEuNyApICsgMC4wNiApLCB2ZWMzKCAyLjIgKSApO1xufVxudmVjMyBSUlRBbmRPRFRGaXQoIHZlYzMgdiApIHtcblx0dmVjMyBhID0gdiAqICggdiArIDAuMDI0NTc4NiApIC0gMC4wMDAwOTA1Mzc7XG5cdHZlYzMgYiA9IHYgKiAoIDAuOTgzNzI5ICogdiArIDAuNDMyOTUxMCApICsgMC4yMzgwODE7XG5cdHJldHVybiBhIC8gYjtcbn1cbnZlYzMgQUNFU0ZpbG1pY1RvbmVNYXBwaW5nKCB2ZWMzIGNvbG9yICkge1xuXHRjb25zdCBtYXQzIEFDRVNJbnB1dE1hdCA9IG1hdDMoXG5cdFx0dmVjMyggMC41OTcxOSwgMC4wNzYwMCwgMC4wMjg0MCApLFx0XHR2ZWMzKCAwLjM1NDU4LCAwLjkwODM0LCAwLjEzMzgzICksXG5cdFx0dmVjMyggMC4wNDgyMywgMC4wMTU2NiwgMC44Mzc3NyApXG5cdCk7XG5cdGNvbnN0IG1hdDMgQUNFU091dHB1dE1hdCA9IG1hdDMoXG5cdFx0dmVjMyggIDEuNjA0NzUsIC0wLjEwMjA4LCAtMC4wMDMyNyApLFx0XHR2ZWMzKCAtMC41MzEwOCwgIDEuMTA4MTMsIC0wLjA3Mjc2ICksXG5cdFx0dmVjMyggLTAuMDczNjcsIC0wLjAwNjA1LCAgMS4wNzYwMiApXG5cdCk7XG5cdGNvbG9yICo9IHRvbmVNYXBwaW5nRXhwb3N1cmUgLyAwLjY7XG5cdGNvbG9yID0gQUNFU0lucHV0TWF0ICogY29sb3I7XG5cdGNvbG9yID0gUlJUQW5kT0RURml0KCBjb2xvciApO1xuXHRjb2xvciA9IEFDRVNPdXRwdXRNYXQgKiBjb2xvcjtcblx0cmV0dXJuIHNhdHVyYXRlKCBjb2xvciApO1xufVxudmVjMyBDdXN0b21Ub25lTWFwcGluZyggdmVjMyBjb2xvciApIHsgcmV0dXJuIGNvbG9yOyB9IjsKCnZhciB0cmFuc21pc3Npb25fZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9UUkFOU01JU1NJT05cblx0bWF0ZXJpYWwudHJhbnNtaXNzaW9uID0gdHJhbnNtaXNzaW9uO1xuXHRtYXRlcmlhbC50cmFuc21pc3Npb25BbHBoYSA9IDEuMDtcblx0bWF0ZXJpYWwudGhpY2tuZXNzID0gdGhpY2tuZXNzO1xuXHRtYXRlcmlhbC5hdHRlbnVhdGlvbkRpc3RhbmNlID0gYXR0ZW51YXRpb25EaXN0YW5jZTtcblx0bWF0ZXJpYWwuYXR0ZW51YXRpb25Db2xvciA9IGF0dGVudWF0aW9uQ29sb3I7XG5cdCNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OTUFQXG5cdFx0bWF0ZXJpYWwudHJhbnNtaXNzaW9uICo9IHRleHR1cmUyRCggdHJhbnNtaXNzaW9uTWFwLCB2VHJhbnNtaXNzaW9uTWFwVXYgKS5yO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9USElDS05FU1NNQVBcblx0XHRtYXRlcmlhbC50aGlja25lc3MgKj0gdGV4dHVyZTJEKCB0aGlja25lc3NNYXAsIHZUaGlja25lc3NNYXBVdiApLmc7XG5cdCNlbmRpZlxuXHR2ZWMzIHBvcyA9IHZXb3JsZFBvc2l0aW9uO1xuXHR2ZWMzIHYgPSBub3JtYWxpemUoIGNhbWVyYVBvc2l0aW9uIC0gcG9zICk7XG5cdHZlYzMgbiA9IGludmVyc2VUcmFuc2Zvcm1EaXJlY3Rpb24oIG5vcm1hbCwgdmlld01hdHJpeCApO1xuXHR2ZWM0IHRyYW5zbWl0dGVkID0gZ2V0SUJMVm9sdW1lUmVmcmFjdGlvbihcblx0XHRuLCB2LCBtYXRlcmlhbC5yb3VnaG5lc3MsIG1hdGVyaWFsLmRpZmZ1c2VDb2xvciwgbWF0ZXJpYWwuc3BlY3VsYXJDb2xvciwgbWF0ZXJpYWwuc3BlY3VsYXJGOTAsXG5cdFx0cG9zLCBtb2RlbE1hdHJpeCwgdmlld01hdHJpeCwgcHJvamVjdGlvbk1hdHJpeCwgbWF0ZXJpYWwuaW9yLCBtYXRlcmlhbC50aGlja25lc3MsXG5cdFx0bWF0ZXJpYWwuYXR0ZW51YXRpb25Db2xvciwgbWF0ZXJpYWwuYXR0ZW51YXRpb25EaXN0YW5jZSApO1xuXHRtYXRlcmlhbC50cmFuc21pc3Npb25BbHBoYSA9IG1peCggbWF0ZXJpYWwudHJhbnNtaXNzaW9uQWxwaGEsIHRyYW5zbWl0dGVkLmEsIG1hdGVyaWFsLnRyYW5zbWlzc2lvbiApO1xuXHR0b3RhbERpZmZ1c2UgPSBtaXgoIHRvdGFsRGlmZnVzZSwgdHJhbnNtaXR0ZWQucmdiLCBtYXRlcmlhbC50cmFuc21pc3Npb24gKTtcbiNlbmRpZiI7Cgp2YXIgdHJhbnNtaXNzaW9uX3BhcnNfZnJhZ21lbnQgPSAiI2lmZGVmIFVTRV9UUkFOU01JU1NJT05cblx0dW5pZm9ybSBmbG9hdCB0cmFuc21pc3Npb247XG5cdHVuaWZvcm0gZmxvYXQgdGhpY2tuZXNzO1xuXHR1bmlmb3JtIGZsb2F0IGF0dGVudWF0aW9uRGlzdGFuY2U7XG5cdHVuaWZvcm0gdmVjMyBhdHRlbnVhdGlvbkNvbG9yO1xuXHQjaWZkZWYgVVNFX1RSQU5TTUlTU0lPTk1BUFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHRyYW5zbWlzc2lvbk1hcDtcblx0I2VuZGlmXG5cdCNpZmRlZiBVU0VfVEhJQ0tORVNTTUFQXG5cdFx0dW5pZm9ybSBzYW1wbGVyMkQgdGhpY2tuZXNzTWFwO1xuXHQjZW5kaWZcblx0dW5pZm9ybSB2ZWMyIHRyYW5zbWlzc2lvblNhbXBsZXJTaXplO1xuXHR1bmlmb3JtIHNhbXBsZXIyRCB0cmFuc21pc3Npb25TYW1wbGVyTWFwO1xuXHR1bmlmb3JtIG1hdDQgbW9kZWxNYXRyaXg7XG5cdHVuaWZvcm0gbWF0NCBwcm9qZWN0aW9uTWF0cml4O1xuXHR2YXJ5aW5nIHZlYzMgdldvcmxkUG9zaXRpb247XG5cdGZsb2F0IHcwKCBmbG9hdCBhICkge1xuXHRcdHJldHVybiAoIDEuMCAvIDYuMCApICogKCBhICogKCBhICogKCAtIGEgKyAzLjAgKSAtIDMuMCApICsgMS4wICk7XG5cdH1cblx0ZmxvYXQgdzEoIGZsb2F0IGEgKSB7XG5cdFx0cmV0dXJuICggMS4wIC8gNi4wICkgKiAoIGEgKiAgYSAqICggMy4wICogYSAtIDYuMCApICsgNC4wICk7XG5cdH1cblx0ZmxvYXQgdzIoIGZsb2F0IGEgKXtcblx0XHRyZXR1cm4gKCAxLjAgLyA2LjAgKSAqICggYSAqICggYSAqICggLSAzLjAgKiBhICsgMy4wICkgKyAzLjAgKSArIDEuMCApO1xuXHR9XG5cdGZsb2F0IHczKCBmbG9hdCBhICkge1xuXHRcdHJldHVybiAoIDEuMCAvIDYuMCApICogKCBhICogYSAqIGEgKTtcblx0fVxuXHRmbG9hdCBnMCggZmxvYXQgYSApIHtcblx0XHRyZXR1cm4gdzAoIGEgKSArIHcxKCBhICk7XG5cdH1cblx0ZmxvYXQgZzEoIGZsb2F0IGEgKSB7XG5cdFx0cmV0dXJuIHcyKCBhICkgKyB3MyggYSApO1xuXHR9XG5cdGZsb2F0IGgwKCBmbG9hdCBhICkge1xuXHRcdHJldHVybiAtIDEuMCArIHcxKCBhICkgLyAoIHcwKCBhICkgKyB3MSggYSApICk7XG5cdH1cblx0ZmxvYXQgaDEoIGZsb2F0IGEgKSB7XG5cdFx0cmV0dXJuIDEuMCArIHczKCBhICkgLyAoIHcyKCBhICkgKyB3MyggYSApICk7XG5cdH1cblx0dmVjNCBiaWN1YmljKCBzYW1wbGVyMkQgdGV4LCB2ZWMyIHV2LCB2ZWM0IHRleGVsU2l6ZSwgZmxvYXQgbG9kICkge1xuXHRcdHV2ID0gdXYgKiB0ZXhlbFNpemUuencgKyAwLjU7XG5cdFx0dmVjMiBpdXYgPSBmbG9vciggdXYgKTtcblx0XHR2ZWMyIGZ1diA9IGZyYWN0KCB1diApO1xuXHRcdGZsb2F0IGcweCA9IGcwKCBmdXYueCApO1xuXHRcdGZsb2F0IGcxeCA9IGcxKCBmdXYueCApO1xuXHRcdGZsb2F0IGgweCA9IGgwKCBmdXYueCApO1xuXHRcdGZsb2F0IGgxeCA9IGgxKCBmdXYueCApO1xuXHRcdGZsb2F0IGgweSA9IGgwKCBmdXYueSApO1xuXHRcdGZsb2F0IGgxeSA9IGgxKCBmdXYueSApO1xuXHRcdHZlYzIgcDAgPSAoIHZlYzIoIGl1di54ICsgaDB4LCBpdXYueSArIGgweSApIC0gMC41ICkgKiB0ZXhlbFNpemUueHk7XG5cdFx0dmVjMiBwMSA9ICggdmVjMiggaXV2LnggKyBoMXgsIGl1di55ICsgaDB5ICkgLSAwLjUgKSAqIHRleGVsU2l6ZS54eTtcblx0XHR2ZWMyIHAyID0gKCB2ZWMyKCBpdXYueCArIGgweCwgaXV2LnkgKyBoMXkgKSAtIDAuNSApICogdGV4ZWxTaXplLnh5O1xuXHRcdHZlYzIgcDMgPSAoIHZlYzIoIGl1di54ICsgaDF4LCBpdXYueSArIGgxeSApIC0gMC41ICkgKiB0ZXhlbFNpemUueHk7XG5cdFx0cmV0dXJuIGcwKCBmdXYueSApICogKCBnMHggKiB0ZXh0dXJlTG9kKCB0ZXgsIHAwLCBsb2QgKSArIGcxeCAqIHRleHR1cmVMb2QoIHRleCwgcDEsIGxvZCApICkgK1xuXHRcdFx0ZzEoIGZ1di55ICkgKiAoIGcweCAqIHRleHR1cmVMb2QoIHRleCwgcDIsIGxvZCApICsgZzF4ICogdGV4dHVyZUxvZCggdGV4LCBwMywgbG9kICkgKTtcblx0fVxuXHR2ZWM0IHRleHR1cmVCaWN1YmljKCBzYW1wbGVyMkQgc2FtcGxlciwgdmVjMiB1diwgZmxvYXQgbG9kICkge1xuXHRcdHZlYzIgZkxvZFNpemUgPSB2ZWMyKCB0ZXh0dXJlU2l6ZSggc2FtcGxlciwgaW50KCBsb2QgKSApICk7XG5cdFx0dmVjMiBjTG9kU2l6ZSA9IHZlYzIoIHRleHR1cmVTaXplKCBzYW1wbGVyLCBpbnQoIGxvZCArIDEuMCApICkgKTtcblx0XHR2ZWMyIGZMb2RTaXplSW52ID0gMS4wIC8gZkxvZFNpemU7XG5cdFx0dmVjMiBjTG9kU2l6ZUludiA9IDEuMCAvIGNMb2RTaXplO1xuXHRcdHZlYzQgZlNhbXBsZSA9IGJpY3ViaWMoIHNhbXBsZXIsIHV2LCB2ZWM0KCBmTG9kU2l6ZUludiwgZkxvZFNpemUgKSwgZmxvb3IoIGxvZCApICk7XG5cdFx0dmVjNCBjU2FtcGxlID0gYmljdWJpYyggc2FtcGxlciwgdXYsIHZlYzQoIGNMb2RTaXplSW52LCBjTG9kU2l6ZSApLCBjZWlsKCBsb2QgKSApO1xuXHRcdHJldHVybiBtaXgoIGZTYW1wbGUsIGNTYW1wbGUsIGZyYWN0KCBsb2QgKSApO1xuXHR9XG5cdHZlYzMgZ2V0Vm9sdW1lVHJhbnNtaXNzaW9uUmF5KCBjb25zdCBpbiB2ZWMzIG4sIGNvbnN0IGluIHZlYzMgdiwgY29uc3QgaW4gZmxvYXQgdGhpY2tuZXNzLCBjb25zdCBpbiBmbG9hdCBpb3IsIGNvbnN0IGluIG1hdDQgbW9kZWxNYXRyaXggKSB7XG5cdFx0dmVjMyByZWZyYWN0aW9uVmVjdG9yID0gcmVmcmFjdCggLSB2LCBub3JtYWxpemUoIG4gKSwgMS4wIC8gaW9yICk7XG5cdFx0dmVjMyBtb2RlbFNjYWxlO1xuXHRcdG1vZGVsU2NhbGUueCA9IGxlbmd0aCggdmVjMyggbW9kZWxNYXRyaXhbIDAgXS54eXogKSApO1xuXHRcdG1vZGVsU2NhbGUueSA9IGxlbmd0aCggdmVjMyggbW9kZWxNYXRyaXhbIDEgXS54eXogKSApO1xuXHRcdG1vZGVsU2NhbGUueiA9IGxlbmd0aCggdmVjMyggbW9kZWxNYXRyaXhbIDIgXS54eXogKSApO1xuXHRcdHJldHVybiBub3JtYWxpemUoIHJlZnJhY3Rpb25WZWN0b3IgKSAqIHRoaWNrbmVzcyAqIG1vZGVsU2NhbGU7XG5cdH1cblx0ZmxvYXQgYXBwbHlJb3JUb1JvdWdobmVzcyggY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzLCBjb25zdCBpbiBmbG9hdCBpb3IgKSB7XG5cdFx0cmV0dXJuIHJvdWdobmVzcyAqIGNsYW1wKCBpb3IgKiAyLjAgLSAyLjAsIDAuMCwgMS4wICk7XG5cdH1cblx0dmVjNCBnZXRUcmFuc21pc3Npb25TYW1wbGUoIGNvbnN0IGluIHZlYzIgZnJhZ0Nvb3JkLCBjb25zdCBpbiBmbG9hdCByb3VnaG5lc3MsIGNvbnN0IGluIGZsb2F0IGlvciApIHtcblx0XHRmbG9hdCBsb2QgPSBsb2cyKCB0cmFuc21pc3Npb25TYW1wbGVyU2l6ZS54ICkgKiBhcHBseUlvclRvUm91Z2huZXNzKCByb3VnaG5lc3MsIGlvciApO1xuXHRcdHJldHVybiB0ZXh0dXJlQmljdWJpYyggdHJhbnNtaXNzaW9uU2FtcGxlck1hcCwgZnJhZ0Nvb3JkLnh5LCBsb2QgKTtcblx0fVxuXHR2ZWMzIHZvbHVtZUF0dGVudWF0aW9uKCBjb25zdCBpbiBmbG9hdCB0cmFuc21pc3Npb25EaXN0YW5jZSwgY29uc3QgaW4gdmVjMyBhdHRlbnVhdGlvbkNvbG9yLCBjb25zdCBpbiBmbG9hdCBhdHRlbnVhdGlvbkRpc3RhbmNlICkge1xuXHRcdGlmICggaXNpbmYoIGF0dGVudWF0aW9uRGlzdGFuY2UgKSApIHtcblx0XHRcdHJldHVybiB2ZWMzKCAxLjAgKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0dmVjMyBhdHRlbnVhdGlvbkNvZWZmaWNpZW50ID0gLWxvZyggYXR0ZW51YXRpb25Db2xvciApIC8gYXR0ZW51YXRpb25EaXN0YW5jZTtcblx0XHRcdHZlYzMgdHJhbnNtaXR0YW5jZSA9IGV4cCggLSBhdHRlbnVhdGlvbkNvZWZmaWNpZW50ICogdHJhbnNtaXNzaW9uRGlzdGFuY2UgKTtcdFx0XHRyZXR1cm4gdHJhbnNtaXR0YW5jZTtcblx0XHR9XG5cdH1cblx0dmVjNCBnZXRJQkxWb2x1bWVSZWZyYWN0aW9uKCBjb25zdCBpbiB2ZWMzIG4sIGNvbnN0IGluIHZlYzMgdiwgY29uc3QgaW4gZmxvYXQgcm91Z2huZXNzLCBjb25zdCBpbiB2ZWMzIGRpZmZ1c2VDb2xvcixcblx0XHRjb25zdCBpbiB2ZWMzIHNwZWN1bGFyQ29sb3IsIGNvbnN0IGluIGZsb2F0IHNwZWN1bGFyRjkwLCBjb25zdCBpbiB2ZWMzIHBvc2l0aW9uLCBjb25zdCBpbiBtYXQ0IG1vZGVsTWF0cml4LFxuXHRcdGNvbnN0IGluIG1hdDQgdmlld01hdHJpeCwgY29uc3QgaW4gbWF0NCBwcm9qTWF0cml4LCBjb25zdCBpbiBmbG9hdCBpb3IsIGNvbnN0IGluIGZsb2F0IHRoaWNrbmVzcyxcblx0XHRjb25zdCBpbiB2ZWMzIGF0dGVudWF0aW9uQ29sb3IsIGNvbnN0IGluIGZsb2F0IGF0dGVudWF0aW9uRGlzdGFuY2UgKSB7XG5cdFx0dmVjMyB0cmFuc21pc3Npb25SYXkgPSBnZXRWb2x1bWVUcmFuc21pc3Npb25SYXkoIG4sIHYsIHRoaWNrbmVzcywgaW9yLCBtb2RlbE1hdHJpeCApO1xuXHRcdHZlYzMgcmVmcmFjdGVkUmF5RXhpdCA9IHBvc2l0aW9uICsgdHJhbnNtaXNzaW9uUmF5O1xuXHRcdHZlYzQgbmRjUG9zID0gcHJvak1hdHJpeCAqIHZpZXdNYXRyaXggKiB2ZWM0KCByZWZyYWN0ZWRSYXlFeGl0LCAxLjAgKTtcblx0XHR2ZWMyIHJlZnJhY3Rpb25Db29yZHMgPSBuZGNQb3MueHkgLyBuZGNQb3Mudztcblx0XHRyZWZyYWN0aW9uQ29vcmRzICs9IDEuMDtcblx0XHRyZWZyYWN0aW9uQ29vcmRzIC89IDIuMDtcblx0XHR2ZWM0IHRyYW5zbWl0dGVkTGlnaHQgPSBnZXRUcmFuc21pc3Npb25TYW1wbGUoIHJlZnJhY3Rpb25Db29yZHMsIHJvdWdobmVzcywgaW9yICk7XG5cdFx0dmVjMyB0cmFuc21pdHRhbmNlID0gZGlmZnVzZUNvbG9yICogdm9sdW1lQXR0ZW51YXRpb24oIGxlbmd0aCggdHJhbnNtaXNzaW9uUmF5ICksIGF0dGVudWF0aW9uQ29sb3IsIGF0dGVudWF0aW9uRGlzdGFuY2UgKTtcblx0XHR2ZWMzIGF0dGVudWF0ZWRDb2xvciA9IHRyYW5zbWl0dGFuY2UgKiB0cmFuc21pdHRlZExpZ2h0LnJnYjtcblx0XHR2ZWMzIEYgPSBFbnZpcm9ubWVudEJSREYoIG4sIHYsIHNwZWN1bGFyQ29sb3IsIHNwZWN1bGFyRjkwLCByb3VnaG5lc3MgKTtcblx0XHRmbG9hdCB0cmFuc21pdHRhbmNlRmFjdG9yID0gKCB0cmFuc21pdHRhbmNlLnIgKyB0cmFuc21pdHRhbmNlLmcgKyB0cmFuc21pdHRhbmNlLmIgKSAvIDMuMDtcblx0XHRyZXR1cm4gdmVjNCggKCAxLjAgLSBGICkgKiBhdHRlbnVhdGVkQ29sb3IsIDEuMCAtICggMS4wIC0gdHJhbnNtaXR0ZWRMaWdodC5hICkgKiB0cmFuc21pdHRhbmNlRmFjdG9yICk7XG5cdH1cbiNlbmRpZiI7Cgp2YXIgdXZfcGFyc19mcmFnbWVudCA9ICIjaWYgZGVmaW5lZCggVVNFX1VWICkgfHwgZGVmaW5lZCggVVNFX0FOSVNPVFJPUFkgKVxuXHR2YXJ5aW5nIHZlYzIgdlV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX01BUFxuXHR2YXJ5aW5nIHZlYzIgdk1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FMUEhBTUFQXG5cdHZhcnlpbmcgdmVjMiB2QWxwaGFNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9MSUdIVE1BUFxuXHR2YXJ5aW5nIHZlYzIgdkxpZ2h0TWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQU9NQVBcblx0dmFyeWluZyB2ZWMyIHZBb01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0JVTVBNQVBcblx0dmFyeWluZyB2ZWMyIHZCdW1wTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfTk9STUFMTUFQXG5cdHZhcnlpbmcgdmVjMiB2Tm9ybWFsTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfRU1JU1NJVkVNQVBcblx0dmFyeWluZyB2ZWMyIHZFbWlzc2l2ZU1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX01FVEFMTkVTU01BUFxuXHR2YXJ5aW5nIHZlYzIgdk1ldGFsbmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1JPVUdITkVTU01BUFxuXHR2YXJ5aW5nIHZlYzIgdlJvdWdobmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FOSVNPVFJPUFlNQVBcblx0dmFyeWluZyB2ZWMyIHZBbmlzb3Ryb3B5TWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUTUFQXG5cdHZhcnlpbmcgdmVjMiB2Q2xlYXJjb2F0TWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUFxuXHR2YXJ5aW5nIHZlYzIgdkNsZWFyY29hdE5vcm1hbE1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVF9ST1VHSE5FU1NNQVBcblx0dmFyeWluZyB2ZWMyIHZDbGVhcmNvYXRSb3VnaG5lc3NNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRU1BUFxuXHR2YXJ5aW5nIHZlYzIgdklyaWRlc2NlbmNlTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQXG5cdHZhcnlpbmcgdmVjMiB2SXJpZGVzY2VuY2VUaGlja25lc3NNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTl9DT0xPUk1BUFxuXHR2YXJ5aW5nIHZlYzIgdlNoZWVuQ29sb3JNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTl9ST1VHSE5FU1NNQVBcblx0dmFyeWluZyB2ZWMyIHZTaGVlblJvdWdobmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NQRUNVTEFSTUFQXG5cdHZhcnlpbmcgdmVjMiB2U3BlY3VsYXJNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUl9DT0xPUk1BUFxuXHR2YXJ5aW5nIHZlYzIgdlNwZWN1bGFyQ29sb3JNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUl9JTlRFTlNJVFlNQVBcblx0dmFyeWluZyB2ZWMyIHZTcGVjdWxhckludGVuc2l0eU1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1RSQU5TTUlTU0lPTk1BUFxuXHR1bmlmb3JtIG1hdDMgdHJhbnNtaXNzaW9uTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlRyYW5zbWlzc2lvbk1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1RISUNLTkVTU01BUFxuXHR1bmlmb3JtIG1hdDMgdGhpY2tuZXNzTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlRoaWNrbmVzc01hcFV2O1xuI2VuZGlmIjsKCnZhciB1dl9wYXJzX3ZlcnRleCA9ICIjaWYgZGVmaW5lZCggVVNFX1VWICkgfHwgZGVmaW5lZCggVVNFX0FOSVNPVFJPUFkgKVxuXHR2YXJ5aW5nIHZlYzIgdlV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX01BUFxuXHR1bmlmb3JtIG1hdDMgbWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdk1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FMUEhBTUFQXG5cdHVuaWZvcm0gbWF0MyBhbHBoYU1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZBbHBoYU1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0xJR0hUTUFQXG5cdHVuaWZvcm0gbWF0MyBsaWdodE1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZMaWdodE1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FPTUFQXG5cdHVuaWZvcm0gbWF0MyBhb01hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZBb01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0JVTVBNQVBcblx0dW5pZm9ybSBtYXQzIGJ1bXBNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2QnVtcE1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX05PUk1BTE1BUFxuXHR1bmlmb3JtIG1hdDMgbm9ybWFsTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdk5vcm1hbE1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0RJU1BMQUNFTUVOVE1BUFxuXHR1bmlmb3JtIG1hdDMgZGlzcGxhY2VtZW50TWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdkRpc3BsYWNlbWVudE1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0VNSVNTSVZFTUFQXG5cdHVuaWZvcm0gbWF0MyBlbWlzc2l2ZU1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZFbWlzc2l2ZU1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX01FVEFMTkVTU01BUFxuXHR1bmlmb3JtIG1hdDMgbWV0YWxuZXNzTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdk1ldGFsbmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1JPVUdITkVTU01BUFxuXHR1bmlmb3JtIG1hdDMgcm91Z2huZXNzTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlJvdWdobmVzc01hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FOSVNPVFJPUFlNQVBcblx0dW5pZm9ybSBtYXQzIGFuaXNvdHJvcHlNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2QW5pc290cm9weU1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVE1BUFxuXHR1bmlmb3JtIG1hdDMgY2xlYXJjb2F0TWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdkNsZWFyY29hdE1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVF9OT1JNQUxNQVBcblx0dW5pZm9ybSBtYXQzIGNsZWFyY29hdE5vcm1hbE1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZDbGVhcmNvYXROb3JtYWxNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRfUk9VR0hORVNTTUFQXG5cdHVuaWZvcm0gbWF0MyBjbGVhcmNvYXRSb3VnaG5lc3NNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2Q2xlYXJjb2F0Um91Z2huZXNzTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU0hFRU5fQ09MT1JNQVBcblx0dW5pZm9ybSBtYXQzIHNoZWVuQ29sb3JNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2U2hlZW5Db2xvck1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NIRUVOX1JPVUdITkVTU01BUFxuXHR1bmlmb3JtIG1hdDMgc2hlZW5Sb3VnaG5lc3NNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2U2hlZW5Sb3VnaG5lc3NNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRU1BUFxuXHR1bmlmb3JtIG1hdDMgaXJpZGVzY2VuY2VNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2SXJpZGVzY2VuY2VNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9JUklERVNDRU5DRV9USElDS05FU1NNQVBcblx0dW5pZm9ybSBtYXQzIGlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdklyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU1BFQ1VMQVJNQVBcblx0dW5pZm9ybSBtYXQzIHNwZWN1bGFyTWFwVHJhbnNmb3JtO1xuXHR2YXJ5aW5nIHZlYzIgdlNwZWN1bGFyTWFwVXY7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU1BFQ1VMQVJfQ09MT1JNQVBcblx0dW5pZm9ybSBtYXQzIHNwZWN1bGFyQ29sb3JNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2U3BlY3VsYXJDb2xvck1hcFV2O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NQRUNVTEFSX0lOVEVOU0lUWU1BUFxuXHR1bmlmb3JtIG1hdDMgc3BlY3VsYXJJbnRlbnNpdHlNYXBUcmFuc2Zvcm07XG5cdHZhcnlpbmcgdmVjMiB2U3BlY3VsYXJJbnRlbnNpdHlNYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9UUkFOU01JU1NJT05NQVBcblx0dW5pZm9ybSBtYXQzIHRyYW5zbWlzc2lvbk1hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZUcmFuc21pc3Npb25NYXBVdjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9USElDS05FU1NNQVBcblx0dW5pZm9ybSBtYXQzIHRoaWNrbmVzc01hcFRyYW5zZm9ybTtcblx0dmFyeWluZyB2ZWMyIHZUaGlja25lc3NNYXBVdjtcbiNlbmRpZiI7Cgp2YXIgdXZfdmVydGV4ID0gIiNpZiBkZWZpbmVkKCBVU0VfVVYgKSB8fCBkZWZpbmVkKCBVU0VfQU5JU09UUk9QWSApXG5cdHZVdiA9IHZlYzMoIHV2LCAxICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfTUFQXG5cdHZNYXBVdiA9ICggbWFwVHJhbnNmb3JtICogdmVjMyggTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTFBIQU1BUFxuXHR2QWxwaGFNYXBVdiA9ICggYWxwaGFNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBBTFBIQU1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfTElHSFRNQVBcblx0dkxpZ2h0TWFwVXYgPSAoIGxpZ2h0TWFwVHJhbnNmb3JtICogdmVjMyggTElHSFRNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0FPTUFQXG5cdHZBb01hcFV2ID0gKCBhb01hcFRyYW5zZm9ybSAqIHZlYzMoIEFPTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9CVU1QTUFQXG5cdHZCdW1wTWFwVXYgPSAoIGJ1bXBNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBCVU1QTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9OT1JNQUxNQVBcblx0dk5vcm1hbE1hcFV2ID0gKCBub3JtYWxNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBOT1JNQUxNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0RJU1BMQUNFTUVOVE1BUFxuXHR2RGlzcGxhY2VtZW50TWFwVXYgPSAoIGRpc3BsYWNlbWVudE1hcFRyYW5zZm9ybSAqIHZlYzMoIERJU1BMQUNFTUVOVE1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfRU1JU1NJVkVNQVBcblx0dkVtaXNzaXZlTWFwVXYgPSAoIGVtaXNzaXZlTWFwVHJhbnNmb3JtICogdmVjMyggRU1JU1NJVkVNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX01FVEFMTkVTU01BUFxuXHR2TWV0YWxuZXNzTWFwVXYgPSAoIG1ldGFsbmVzc01hcFRyYW5zZm9ybSAqIHZlYzMoIE1FVEFMTkVTU01BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfUk9VR0hORVNTTUFQXG5cdHZSb3VnaG5lc3NNYXBVdiA9ICggcm91Z2huZXNzTWFwVHJhbnNmb3JtICogdmVjMyggUk9VR0hORVNTTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTklTT1RST1BZTUFQXG5cdHZBbmlzb3Ryb3B5TWFwVXYgPSAoIGFuaXNvdHJvcHlNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBBTklTT1RST1BZTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRNQVBcblx0dkNsZWFyY29hdE1hcFV2ID0gKCBjbGVhcmNvYXRNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBDTEVBUkNPQVRNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0NMRUFSQ09BVF9OT1JNQUxNQVBcblx0dkNsZWFyY29hdE5vcm1hbE1hcFV2ID0gKCBjbGVhcmNvYXROb3JtYWxNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBDTEVBUkNPQVRfTk9STUFMTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRfUk9VR0hORVNTTUFQXG5cdHZDbGVhcmNvYXRSb3VnaG5lc3NNYXBVdiA9ICggY2xlYXJjb2F0Um91Z2huZXNzTWFwVHJhbnNmb3JtICogdmVjMyggQ0xFQVJDT0FUX1JPVUdITkVTU01BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfSVJJREVTQ0VOQ0VNQVBcblx0dklyaWRlc2NlbmNlTWFwVXYgPSAoIGlyaWRlc2NlbmNlTWFwVHJhbnNmb3JtICogdmVjMyggSVJJREVTQ0VOQ0VNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX0lSSURFU0NFTkNFX1RISUNLTkVTU01BUFxuXHR2SXJpZGVzY2VuY2VUaGlja25lc3NNYXBVdiA9ICggaXJpZGVzY2VuY2VUaGlja25lc3NNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBJUklERVNDRU5DRV9USElDS05FU1NNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NIRUVOX0NPTE9STUFQXG5cdHZTaGVlbkNvbG9yTWFwVXYgPSAoIHNoZWVuQ29sb3JNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBTSEVFTl9DT0xPUk1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU0hFRU5fUk9VR0hORVNTTUFQXG5cdHZTaGVlblJvdWdobmVzc01hcFV2ID0gKCBzaGVlblJvdWdobmVzc01hcFRyYW5zZm9ybSAqIHZlYzMoIFNIRUVOX1JPVUdITkVTU01BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU1BFQ1VMQVJNQVBcblx0dlNwZWN1bGFyTWFwVXYgPSAoIHNwZWN1bGFyTWFwVHJhbnNmb3JtICogdmVjMyggU1BFQ1VMQVJNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmXG4jaWZkZWYgVVNFX1NQRUNVTEFSX0NPTE9STUFQXG5cdHZTcGVjdWxhckNvbG9yTWFwVXYgPSAoIHNwZWN1bGFyQ29sb3JNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBTUEVDVUxBUl9DT0xPUk1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfU1BFQ1VMQVJfSU5URU5TSVRZTUFQXG5cdHZTcGVjdWxhckludGVuc2l0eU1hcFV2ID0gKCBzcGVjdWxhckludGVuc2l0eU1hcFRyYW5zZm9ybSAqIHZlYzMoIFNQRUNVTEFSX0lOVEVOU0lUWU1BUF9VViwgMSApICkueHk7XG4jZW5kaWZcbiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OTUFQXG5cdHZUcmFuc21pc3Npb25NYXBVdiA9ICggdHJhbnNtaXNzaW9uTWFwVHJhbnNmb3JtICogdmVjMyggVFJBTlNNSVNTSU9OTUFQX1VWLCAxICkgKS54eTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9USElDS05FU1NNQVBcblx0dlRoaWNrbmVzc01hcFV2ID0gKCB0aGlja25lc3NNYXBUcmFuc2Zvcm0gKiB2ZWMzKCBUSElDS05FU1NNQVBfVVYsIDEgKSApLnh5O1xuI2VuZGlmIjsKCnZhciB3b3JsZHBvc192ZXJ0ZXggPSAiI2lmIGRlZmluZWQoIFVTRV9FTlZNQVAgKSB8fCBkZWZpbmVkKCBESVNUQU5DRSApIHx8IGRlZmluZWQgKCBVU0VfU0hBRE9XTUFQICkgfHwgZGVmaW5lZCAoIFVTRV9UUkFOU01JU1NJT04gKSB8fCBOVU1fU1BPVF9MSUdIVF9DT09SRFMgPiAwXG5cdHZlYzQgd29ybGRQb3NpdGlvbiA9IHZlYzQoIHRyYW5zZm9ybWVkLCAxLjAgKTtcblx0I2lmZGVmIFVTRV9JTlNUQU5DSU5HXG5cdFx0d29ybGRQb3NpdGlvbiA9IGluc3RhbmNlTWF0cml4ICogd29ybGRQb3NpdGlvbjtcblx0I2VuZGlmXG5cdHdvcmxkUG9zaXRpb24gPSBtb2RlbE1hdHJpeCAqIHdvcmxkUG9zaXRpb247XG4jZW5kaWYiOwoKY29uc3QgdmVydGV4JGggPSAidmFyeWluZyB2ZWMyIHZVdjtcbnVuaWZvcm0gbWF0MyB1dlRyYW5zZm9ybTtcbnZvaWQgbWFpbigpIHtcblx0dlV2ID0gKCB1dlRyYW5zZm9ybSAqIHZlYzMoIHV2LCAxICkgKS54eTtcblx0Z2xfUG9zaXRpb24gPSB2ZWM0KCBwb3NpdGlvbi54eSwgMS4wLCAxLjAgKTtcbn0iOwoKY29uc3QgZnJhZ21lbnQkaCA9ICJ1bmlmb3JtIHNhbXBsZXIyRCB0MkQ7XG51bmlmb3JtIGZsb2F0IGJhY2tncm91bmRJbnRlbnNpdHk7XG52YXJ5aW5nIHZlYzIgdlV2O1xudm9pZCBtYWluKCkge1xuXHR2ZWM0IHRleENvbG9yID0gdGV4dHVyZTJEKCB0MkQsIHZVdiApO1xuXHQjaWZkZWYgREVDT0RFX1ZJREVPX1RFWFRVUkVcblx0XHR0ZXhDb2xvciA9IHZlYzQoIG1peCggcG93KCB0ZXhDb2xvci5yZ2IgKiAwLjk0Nzg2NzI5ODYgKyB2ZWMzKCAwLjA1MjEzMjcwMTQgKSwgdmVjMyggMi40ICkgKSwgdGV4Q29sb3IucmdiICogMC4wNzczOTkzODA4LCB2ZWMzKCBsZXNzVGhhbkVxdWFsKCB0ZXhDb2xvci5yZ2IsIHZlYzMoIDAuMDQwNDUgKSApICkgKSwgdGV4Q29sb3IudyApO1xuXHQjZW5kaWZcblx0dGV4Q29sb3IucmdiICo9IGJhY2tncm91bmRJbnRlbnNpdHk7XG5cdGdsX0ZyYWdDb2xvciA9IHRleENvbG9yO1xuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxufSI7Cgpjb25zdCB2ZXJ0ZXgkZyA9ICJ2YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbnZvaWQgbWFpbigpIHtcblx0dldvcmxkRGlyZWN0aW9uID0gdHJhbnNmb3JtRGlyZWN0aW9uKCBwb3NpdGlvbiwgbW9kZWxNYXRyaXggKTtcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHRnbF9Qb3NpdGlvbi56ID0gZ2xfUG9zaXRpb24udztcbn0iOwoKY29uc3QgZnJhZ21lbnQkZyA9ICIjaWZkZWYgRU5WTUFQX1RZUEVfQ1VCRVxuXHR1bmlmb3JtIHNhbXBsZXJDdWJlIGVudk1hcDtcbiNlbGlmIGRlZmluZWQoIEVOVk1BUF9UWVBFX0NVQkVfVVYgKVxuXHR1bmlmb3JtIHNhbXBsZXIyRCBlbnZNYXA7XG4jZW5kaWZcbnVuaWZvcm0gZmxvYXQgZmxpcEVudk1hcDtcbnVuaWZvcm0gZmxvYXQgYmFja2dyb3VuZEJsdXJyaW5lc3M7XG51bmlmb3JtIGZsb2F0IGJhY2tncm91bmRJbnRlbnNpdHk7XG52YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uO1xuI2luY2x1ZGUgPGN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0I2lmZGVmIEVOVk1BUF9UWVBFX0NVQkVcblx0XHR2ZWM0IHRleENvbG9yID0gdGV4dHVyZUN1YmUoIGVudk1hcCwgdmVjMyggZmxpcEVudk1hcCAqIHZXb3JsZERpcmVjdGlvbi54LCB2V29ybGREaXJlY3Rpb24ueXogKSApO1xuXHQjZWxpZiBkZWZpbmVkKCBFTlZNQVBfVFlQRV9DVUJFX1VWIClcblx0XHR2ZWM0IHRleENvbG9yID0gdGV4dHVyZUN1YmVVViggZW52TWFwLCB2V29ybGREaXJlY3Rpb24sIGJhY2tncm91bmRCbHVycmluZXNzICk7XG5cdCNlbHNlXG5cdFx0dmVjNCB0ZXhDb2xvciA9IHZlYzQoIDAuMCwgMC4wLCAwLjAsIDEuMCApO1xuXHQjZW5kaWZcblx0dGV4Q29sb3IucmdiICo9IGJhY2tncm91bmRJbnRlbnNpdHk7XG5cdGdsX0ZyYWdDb2xvciA9IHRleENvbG9yO1xuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxufSI7Cgpjb25zdCB2ZXJ0ZXgkZiA9ICJ2YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbnZvaWQgbWFpbigpIHtcblx0dldvcmxkRGlyZWN0aW9uID0gdHJhbnNmb3JtRGlyZWN0aW9uKCBwb3NpdGlvbiwgbW9kZWxNYXRyaXggKTtcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHRnbF9Qb3NpdGlvbi56ID0gZ2xfUG9zaXRpb24udztcbn0iOwoKY29uc3QgZnJhZ21lbnQkZiA9ICJ1bmlmb3JtIHNhbXBsZXJDdWJlIHRDdWJlO1xudW5pZm9ybSBmbG9hdCB0RmxpcDtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbnZhcnlpbmcgdmVjMyB2V29ybGREaXJlY3Rpb247XG52b2lkIG1haW4oKSB7XG5cdHZlYzQgdGV4Q29sb3IgPSB0ZXh0dXJlQ3ViZSggdEN1YmUsIHZlYzMoIHRGbGlwICogdldvcmxkRGlyZWN0aW9uLngsIHZXb3JsZERpcmVjdGlvbi55eiApICk7XG5cdGdsX0ZyYWdDb2xvciA9IHRleENvbG9yO1xuXHRnbF9GcmFnQ29sb3IuYSAqPSBvcGFjaXR5O1xuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxufSI7Cgpjb25zdCB2ZXJ0ZXgkZSA9ICIjaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52YXJ5aW5nIHZlYzIgdkhpZ2hQcmVjaXNpb25aVztcbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2lmZGVmIFVTRV9ESVNQTEFDRU1FTlRNQVBcblx0XHQjaW5jbHVkZSA8YmVnaW5ub3JtYWxfdmVydGV4PlxuXHRcdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdFx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjZW5kaWZcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdHZIaWdoUHJlY2lzaW9uWlcgPSBnbF9Qb3NpdGlvbi56dztcbn0iOwoKY29uc3QgZnJhZ21lbnQkZSA9ICIjaWYgREVQVEhfUEFDS0lORyA9PSAzMjAwXG5cdHVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNlbmRpZlxuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxwYWNraW5nPlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50PlxudmFyeWluZyB2ZWMyIHZIaWdoUHJlY2lzaW9uWlc7XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdHZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggMS4wICk7XG5cdCNpZiBERVBUSF9QQUNLSU5HID09IDMyMDBcblx0XHRkaWZmdXNlQ29sb3IuYSA9IG9wYWNpdHk7XG5cdCNlbmRpZlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0ZmxvYXQgZnJhZ0Nvb3JkWiA9IDAuNSAqIHZIaWdoUHJlY2lzaW9uWldbMF0gLyB2SGlnaFByZWNpc2lvblpXWzFdICsgMC41O1xuXHQjaWYgREVQVEhfUEFDS0lORyA9PSAzMjAwXG5cdFx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggdmVjMyggMS4wIC0gZnJhZ0Nvb3JkWiApLCBvcGFjaXR5ICk7XG5cdCNlbGlmIERFUFRIX1BBQ0tJTkcgPT0gMzIwMVxuXHRcdGdsX0ZyYWdDb2xvciA9IHBhY2tEZXB0aFRvUkdCQSggZnJhZ0Nvb3JkWiApO1xuXHQjZW5kaWZcbn0iOwoKY29uc3QgdmVydGV4JGQgPSAiI2RlZmluZSBESVNUQU5DRVxudmFyeWluZyB2ZWMzIHZXb3JsZFBvc2l0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8c2tpbm5pbmdfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8dXZfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbmJhc2VfdmVydGV4PlxuXHQjaWZkZWYgVVNFX0RJU1BMQUNFTUVOVE1BUFxuXHRcdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdFx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0XHQjaW5jbHVkZSA8c2tpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNlbmRpZlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0dldvcmxkUG9zaXRpb24gPSB3b3JsZFBvc2l0aW9uLnh5ejtcbn0iOwoKY29uc3QgZnJhZ21lbnQkZCA9ICIjZGVmaW5lIERJU1RBTkNFXG51bmlmb3JtIHZlYzMgcmVmZXJlbmNlUG9zaXRpb247XG51bmlmb3JtIGZsb2F0IG5lYXJEaXN0YW5jZTtcbnVuaWZvcm0gZmxvYXQgZmFyRGlzdGFuY2U7XG52YXJ5aW5nIHZlYzMgdldvcmxkUG9zaXRpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYW1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhdGVzdF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhaGFzaF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluICgpIHtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCAxLjAgKTtcblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhbWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGF0ZXN0X2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFoYXNoX2ZyYWdtZW50PlxuXHRmbG9hdCBkaXN0ID0gbGVuZ3RoKCB2V29ybGRQb3NpdGlvbiAtIHJlZmVyZW5jZVBvc2l0aW9uICk7XG5cdGRpc3QgPSAoIGRpc3QgLSBuZWFyRGlzdGFuY2UgKSAvICggZmFyRGlzdGFuY2UgLSBuZWFyRGlzdGFuY2UgKTtcblx0ZGlzdCA9IHNhdHVyYXRlKCBkaXN0ICk7XG5cdGdsX0ZyYWdDb2xvciA9IHBhY2tEZXB0aFRvUkdCQSggZGlzdCApO1xufSI7Cgpjb25zdCB2ZXJ0ZXgkYyA9ICJ2YXJ5aW5nIHZlYzMgdldvcmxkRGlyZWN0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbnZvaWQgbWFpbigpIHtcblx0dldvcmxkRGlyZWN0aW9uID0gdHJhbnNmb3JtRGlyZWN0aW9uKCBwb3NpdGlvbiwgbW9kZWxNYXRyaXggKTtcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxufSI7Cgpjb25zdCBmcmFnbWVudCRjID0gInVuaWZvcm0gc2FtcGxlcjJEIHRFcXVpcmVjdDtcbnZhcnlpbmcgdmVjMyB2V29ybGREaXJlY3Rpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxudm9pZCBtYWluKCkge1xuXHR2ZWMzIGRpcmVjdGlvbiA9IG5vcm1hbGl6ZSggdldvcmxkRGlyZWN0aW9uICk7XG5cdHZlYzIgc2FtcGxlVVYgPSBlcXVpcmVjdFV2KCBkaXJlY3Rpb24gKTtcblx0Z2xfRnJhZ0NvbG9yID0gdGV4dHVyZTJEKCB0RXF1aXJlY3QsIHNhbXBsZVVWICk7XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG59IjsKCmNvbnN0IHZlcnRleCRiID0gInVuaWZvcm0gZmxvYXQgc2NhbGU7XG5hdHRyaWJ1dGUgZmxvYXQgbGluZURpc3RhbmNlO1xudmFyeWluZyBmbG9hdCB2TGluZURpc3RhbmNlO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4Plxudm9pZCBtYWluKCkge1xuXHR2TGluZURpc3RhbmNlID0gc2NhbGUgKiBsaW5lRGlzdGFuY2U7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCmNvbnN0IGZyYWdtZW50JGIgPSAidW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG51bmlmb3JtIGZsb2F0IGRhc2hTaXplO1xudW5pZm9ybSBmbG9hdCB0b3RhbFNpemU7XG52YXJ5aW5nIGZsb2F0IHZMaW5lRGlzdGFuY2U7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8dXZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHRpZiAoIG1vZCggdkxpbmVEaXN0YW5jZSwgdG90YWxTaXplICkgPiBkYXNoU2l6ZSApIHtcblx0XHRkaXNjYXJkO1xuXHR9XG5cdHZlYzMgb3V0Z29pbmdMaWdodCA9IHZlYzMoIDAuMCApO1xuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JfZnJhZ21lbnQ+XG5cdG91dGdvaW5nTGlnaHQgPSBkaWZmdXNlQ29sb3IucmdiO1xuXHQjaW5jbHVkZSA8b3BhcXVlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8cHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudD5cbn0iOwoKY29uc3QgdmVydGV4JGEgPSAiI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxlbnZtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPHV2X3ZlcnRleD5cblx0I2luY2x1ZGUgPGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBoY29sb3JfdmVydGV4PlxuXHQjaWYgZGVmaW5lZCAoIFVTRV9FTlZNQVAgKSB8fCBkZWZpbmVkICggVVNFX1NLSU5OSU5HIClcblx0XHQjaW5jbHVkZSA8YmVnaW5ub3JtYWxfdmVydGV4PlxuXHRcdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdFx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0XHQjaW5jbHVkZSA8c2tpbm5vcm1hbF92ZXJ0ZXg+XG5cdFx0I2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuXHQjZW5kaWZcblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0I2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD5cblx0I2luY2x1ZGUgPGVudm1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7Cgpjb25zdCBmcmFnbWVudCRhID0gInVuaWZvcm0gdmVjMyBkaWZmdXNlO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2lmbmRlZiBGTEFUX1NIQURFRFxuXHR2YXJ5aW5nIHZlYzMgdk5vcm1hbDtcbiNlbmRpZlxuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxkaXRoZXJpbmdfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhb21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW52bWFwX2NvbW1vbl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVudm1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxzcGVjdWxhcm1hcF9mcmFnbWVudD5cblx0UmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgPSBSZWZsZWN0ZWRMaWdodCggdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICkgKTtcblx0I2lmZGVmIFVTRV9MSUdIVE1BUFxuXHRcdHZlYzQgbGlnaHRNYXBUZXhlbCA9IHRleHR1cmUyRCggbGlnaHRNYXAsIHZMaWdodE1hcFV2ICk7XG5cdFx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICs9IGxpZ2h0TWFwVGV4ZWwucmdiICogbGlnaHRNYXBJbnRlbnNpdHkgKiBSRUNJUFJPQ0FMX1BJO1xuXHQjZWxzZVxuXHRcdHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArPSB2ZWMzKCAxLjAgKTtcblx0I2VuZGlmXG5cdCNpbmNsdWRlIDxhb21hcF9mcmFnbWVudD5cblx0cmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICo9IGRpZmZ1c2VDb2xvci5yZ2I7XG5cdHZlYzMgb3V0Z29pbmdMaWdodCA9IHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZTtcblx0I2luY2x1ZGUgPGVudm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxkaXRoZXJpbmdfZnJhZ21lbnQ+XG59IjsKCmNvbnN0IHZlcnRleCQ5ID0gIiNkZWZpbmUgTEFNQkVSVFxudmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxlbnZtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8dXZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y29sb3JfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8bm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdHZWaWV3UG9zaXRpb24gPSAtIG12UG9zaXRpb24ueHl6O1xuXHQjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZW52bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNoYWRvd21hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxmb2dfdmVydGV4PlxufSI7Cgpjb25zdCBmcmFnbWVudCQ5ID0gIiNkZWZpbmUgTEFNQkVSVFxudW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIHZlYzMgZW1pc3NpdmU7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8ZGl0aGVyaW5nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YW9tYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVtaXNzaXZlbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW52bWFwX2NvbW1vbl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVudm1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJzZGZzPlxuI2luY2x1ZGUgPGxpZ2h0c19wYXJzX2JlZ2luPlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxpZ2h0c19sYW1iZXJ0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnVtcG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ID0gUmVmbGVjdGVkTGlnaHQoIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApICk7XG5cdHZlYzMgdG90YWxFbWlzc2l2ZVJhZGlhbmNlID0gZW1pc3NpdmU7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxzcGVjdWxhcm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8ZW1pc3NpdmVtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfbGFtYmVydF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X2VuZD5cblx0I2luY2x1ZGUgPGFvbWFwX2ZyYWdtZW50PlxuXHR2ZWMzIG91dGdvaW5nTGlnaHQgPSByZWZsZWN0ZWRMaWdodC5kaXJlY3REaWZmdXNlICsgcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3REaWZmdXNlICsgdG90YWxFbWlzc2l2ZVJhZGlhbmNlO1xuXHQjaW5jbHVkZSA8ZW52bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8b3BhcXVlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8dG9uZW1hcHBpbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcnNwYWNlX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Zm9nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8cHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGRpdGhlcmluZ19mcmFnbWVudD5cbn0iOwoKY29uc3QgdmVydGV4JDggPSAiI2RlZmluZSBNQVRDQVBcbnZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG5cdHZWaWV3UG9zaXRpb24gPSAtIG12UG9zaXRpb24ueHl6O1xufSI7Cgpjb25zdCBmcmFnbWVudCQ4ID0gIiNkZWZpbmUgTUFUQ0FQXG51bmlmb3JtIHZlYzMgZGlmZnVzZTtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbnVuaWZvcm0gc2FtcGxlcjJEIG1hdGNhcDtcbnZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxkaXRoZXJpbmdfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxub3JtYWxfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxidW1wbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bm9ybWFsbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfbWFwcz5cblx0dmVjMyB2aWV3RGlyID0gbm9ybWFsaXplKCB2Vmlld1Bvc2l0aW9uICk7XG5cdHZlYzMgeCA9IG5vcm1hbGl6ZSggdmVjMyggdmlld0Rpci56LCAwLjAsIC0gdmlld0Rpci54ICkgKTtcblx0dmVjMyB5ID0gY3Jvc3MoIHZpZXdEaXIsIHggKTtcblx0dmVjMiB1diA9IHZlYzIoIGRvdCggeCwgbm9ybWFsICksIGRvdCggeSwgbm9ybWFsICkgKSAqIDAuNDk1ICsgMC41O1xuXHQjaWZkZWYgVVNFX01BVENBUFxuXHRcdHZlYzQgbWF0Y2FwQ29sb3IgPSB0ZXh0dXJlMkQoIG1hdGNhcCwgdXYgKTtcblx0I2Vsc2Vcblx0XHR2ZWM0IG1hdGNhcENvbG9yID0gdmVjNCggdmVjMyggbWl4KCAwLjIsIDAuOCwgdXYueSApICksIDEuMCApO1xuXHQjZW5kaWZcblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gZGlmZnVzZUNvbG9yLnJnYiAqIG1hdGNhcENvbG9yLnJnYjtcblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxkaXRoZXJpbmdfZnJhZ21lbnQ+XG59IjsKCmNvbnN0IHZlcnRleCQ3ID0gIiNkZWZpbmUgTk9STUFMXG4jaWYgZGVmaW5lZCggRkxBVF9TSEFERUQgKSB8fCBkZWZpbmVkKCBVU0VfQlVNUE1BUCApIHx8IGRlZmluZWQoIFVTRV9OT1JNQUxNQVBfVEFOR0VOVFNQQUNFIClcblx0dmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jZW5kaWZcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8bm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG4jaWYgZGVmaW5lZCggRkxBVF9TSEFERUQgKSB8fCBkZWZpbmVkKCBVU0VfQlVNUE1BUCApIHx8IGRlZmluZWQoIFVTRV9OT1JNQUxNQVBfVEFOR0VOVFNQQUNFIClcblx0dlZpZXdQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7XG4jZW5kaWZcbn0iOwoKY29uc3QgZnJhZ21lbnQkNyA9ICIjZGVmaW5lIE5PUk1BTFxudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2lmIGRlZmluZWQoIEZMQVRfU0hBREVEICkgfHwgZGVmaW5lZCggVVNFX0JVTVBNQVAgKSB8fCBkZWZpbmVkKCBVU0VfTk9STUFMTUFQX1RBTkdFTlRTUEFDRSApXG5cdHZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2VuZGlmXG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJ1bXBtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxub3JtYWxtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxub3JtYWxfZnJhZ21lbnRfbWFwcz5cblx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggcGFja05vcm1hbFRvUkdCKCBub3JtYWwgKSwgb3BhY2l0eSApO1xuXHQjaWZkZWYgT1BBUVVFXG5cdFx0Z2xfRnJhZ0NvbG9yLmEgPSAxLjA7XG5cdCNlbmRpZlxufSI7Cgpjb25zdCB2ZXJ0ZXgkNiA9ICIjZGVmaW5lIFBIT05HXG52YXJ5aW5nIHZlYzMgdlZpZXdQb3NpdGlvbjtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8dXZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGVudm1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0dlZpZXdQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7XG5cdCNpbmNsdWRlIDx3b3JsZHBvc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxlbnZtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2hhZG93bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCmNvbnN0IGZyYWdtZW50JDYgPSAiI2RlZmluZSBQSE9OR1xudW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIHZlYzMgZW1pc3NpdmU7XG51bmlmb3JtIHZlYzMgc3BlY3VsYXI7XG51bmlmb3JtIGZsb2F0IHNoaW5pbmVzcztcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDxkaXRoZXJpbmdfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhb21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW1pc3NpdmVtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbnZtYXBfY29tbW9uX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW52bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnNkZnM+XG4jaW5jbHVkZSA8bGlnaHRzX3BhcnNfYmVnaW4+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bGlnaHRzX3Bob25nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnVtcG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHNwZWN1bGFybWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdFJlZmxlY3RlZExpZ2h0IHJlZmxlY3RlZExpZ2h0ID0gUmVmbGVjdGVkTGlnaHQoIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApICk7XG5cdHZlYzMgdG90YWxFbWlzc2l2ZVJhZGlhbmNlID0gZW1pc3NpdmU7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYXRlc3RfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYWhhc2hfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxzcGVjdWxhcm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8ZW1pc3NpdmVtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfcGhvbmdfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfYmVnaW4+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfbWFwcz5cblx0I2luY2x1ZGUgPGxpZ2h0c19mcmFnbWVudF9lbmQ+XG5cdCNpbmNsdWRlIDxhb21hcF9mcmFnbWVudD5cblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gcmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmRpcmVjdFNwZWN1bGFyICsgcmVmbGVjdGVkTGlnaHQuaW5kaXJlY3RTcGVjdWxhciArIHRvdGFsRW1pc3NpdmVSYWRpYW5jZTtcblx0I2luY2x1ZGUgPGVudm1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPHByZW11bHRpcGxpZWRfYWxwaGFfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxkaXRoZXJpbmdfZnJhZ21lbnQ+XG59IjsKCmNvbnN0IHZlcnRleCQ1ID0gIiNkZWZpbmUgU1RBTkRBUkRcbnZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2lmZGVmIFVTRV9UUkFOU01JU1NJT05cblx0dmFyeWluZyB2ZWMzIHZXb3JsZFBvc2l0aW9uO1xuI2VuZGlmXG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHV2X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bm9ybWFsX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG1vcnBodGFyZ2V0X3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNraW5uaW5nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPHNoYWRvd21hcF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDx1dl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBobm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5iYXNlX3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5ub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGVmYXVsdG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8ZGlzcGxhY2VtZW50bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0dlZpZXdQb3NpdGlvbiA9IC0gbXZQb3NpdGlvbi54eXo7XG5cdCNpbmNsdWRlIDx3b3JsZHBvc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxzaGFkb3dtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8Zm9nX3ZlcnRleD5cbiNpZmRlZiBVU0VfVFJBTlNNSVNTSU9OXG5cdHZXb3JsZFBvc2l0aW9uID0gd29ybGRQb3NpdGlvbi54eXo7XG4jZW5kaWZcbn0iOwoKY29uc3QgZnJhZ21lbnQkNSA9ICIjZGVmaW5lIFNUQU5EQVJEXG4jaWZkZWYgUEhZU0lDQUxcblx0I2RlZmluZSBJT1Jcblx0I2RlZmluZSBVU0VfU1BFQ1VMQVJcbiNlbmRpZlxudW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIHZlYzMgZW1pc3NpdmU7XG51bmlmb3JtIGZsb2F0IHJvdWdobmVzcztcbnVuaWZvcm0gZmxvYXQgbWV0YWxuZXNzO1xudW5pZm9ybSBmbG9hdCBvcGFjaXR5O1xuI2lmZGVmIElPUlxuXHR1bmlmb3JtIGZsb2F0IGlvcjtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TUEVDVUxBUlxuXHR1bmlmb3JtIGZsb2F0IHNwZWN1bGFySW50ZW5zaXR5O1xuXHR1bmlmb3JtIHZlYzMgc3BlY3VsYXJDb2xvcjtcblx0I2lmZGVmIFVTRV9TUEVDVUxBUl9DT0xPUk1BUFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHNwZWN1bGFyQ29sb3JNYXA7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1NQRUNVTEFSX0lOVEVOU0lUWU1BUFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHNwZWN1bGFySW50ZW5zaXR5TWFwO1xuXHQjZW5kaWZcbiNlbmRpZlxuI2lmZGVmIFVTRV9DTEVBUkNPQVRcblx0dW5pZm9ybSBmbG9hdCBjbGVhcmNvYXQ7XG5cdHVuaWZvcm0gZmxvYXQgY2xlYXJjb2F0Um91Z2huZXNzO1xuI2VuZGlmXG4jaWZkZWYgVVNFX0lSSURFU0NFTkNFXG5cdHVuaWZvcm0gZmxvYXQgaXJpZGVzY2VuY2U7XG5cdHVuaWZvcm0gZmxvYXQgaXJpZGVzY2VuY2VJT1I7XG5cdHVuaWZvcm0gZmxvYXQgaXJpZGVzY2VuY2VUaGlja25lc3NNaW5pbXVtO1xuXHR1bmlmb3JtIGZsb2F0IGlyaWRlc2NlbmNlVGhpY2tuZXNzTWF4aW11bTtcbiNlbmRpZlxuI2lmZGVmIFVTRV9TSEVFTlxuXHR1bmlmb3JtIHZlYzMgc2hlZW5Db2xvcjtcblx0dW5pZm9ybSBmbG9hdCBzaGVlblJvdWdobmVzcztcblx0I2lmZGVmIFVTRV9TSEVFTl9DT0xPUk1BUFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHNoZWVuQ29sb3JNYXA7XG5cdCNlbmRpZlxuXHQjaWZkZWYgVVNFX1NIRUVOX1JPVUdITkVTU01BUFxuXHRcdHVuaWZvcm0gc2FtcGxlcjJEIHNoZWVuUm91Z2huZXNzTWFwO1xuXHQjZW5kaWZcbiNlbmRpZlxuI2lmZGVmIFVTRV9BTklTT1RST1BZXG5cdHVuaWZvcm0gdmVjMiBhbmlzb3Ryb3B5VmVjdG9yO1xuXHQjaWZkZWYgVVNFX0FOSVNPVFJPUFlNQVBcblx0XHR1bmlmb3JtIHNhbXBsZXIyRCBhbmlzb3Ryb3B5TWFwO1xuXHQjZW5kaWZcbiNlbmRpZlxudmFyeWluZyB2ZWMzIHZWaWV3UG9zaXRpb247XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8ZGl0aGVyaW5nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx1dl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGFscGhhbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YW9tYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVtaXNzaXZlbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8aXJpZGVzY2VuY2VfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y3ViZV91dl9yZWZsZWN0aW9uX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGVudm1hcF9jb21tb25fcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxlbnZtYXBfcGh5c2ljYWxfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodHNfcGFyc19iZWdpbj5cbiNpbmNsdWRlIDxub3JtYWxfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsaWdodHNfcGh5c2ljYWxfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDx0cmFuc21pc3Npb25fcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxidW1wbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bm9ybWFsbWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y2xlYXJjb2F0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8aXJpZGVzY2VuY2VfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxyb3VnaG5lc3NtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxtZXRhbG5lc3NtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHR2ZWM0IGRpZmZ1c2VDb2xvciA9IHZlYzQoIGRpZmZ1c2UsIG9wYWNpdHkgKTtcblx0UmVmbGVjdGVkTGlnaHQgcmVmbGVjdGVkTGlnaHQgPSBSZWZsZWN0ZWRMaWdodCggdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICkgKTtcblx0dmVjMyB0b3RhbEVtaXNzaXZlUmFkaWFuY2UgPSBlbWlzc2l2ZTtcblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxhbHBoYW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhaGFzaF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHJvdWdobmVzc21hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1ldGFsbmVzc21hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPG5vcm1hbF9mcmFnbWVudF9tYXBzPlxuXHQjaW5jbHVkZSA8Y2xlYXJjb2F0X25vcm1hbF9mcmFnbWVudF9iZWdpbj5cblx0I2luY2x1ZGUgPGNsZWFyY29hdF9ub3JtYWxfZnJhZ21lbnRfbWFwcz5cblx0I2luY2x1ZGUgPGVtaXNzaXZlbWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bGlnaHRzX3BoeXNpY2FsX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X2JlZ2luPlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X21hcHM+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfZW5kPlxuXHQjaW5jbHVkZSA8YW9tYXBfZnJhZ21lbnQ+XG5cdHZlYzMgdG90YWxEaWZmdXNlID0gcmVmbGVjdGVkTGlnaHQuZGlyZWN0RGlmZnVzZSArIHJlZmxlY3RlZExpZ2h0LmluZGlyZWN0RGlmZnVzZTtcblx0dmVjMyB0b3RhbFNwZWN1bGFyID0gcmVmbGVjdGVkTGlnaHQuZGlyZWN0U3BlY3VsYXIgKyByZWZsZWN0ZWRMaWdodC5pbmRpcmVjdFNwZWN1bGFyO1xuXHQjaW5jbHVkZSA8dHJhbnNtaXNzaW9uX2ZyYWdtZW50PlxuXHR2ZWMzIG91dGdvaW5nTGlnaHQgPSB0b3RhbERpZmZ1c2UgKyB0b3RhbFNwZWN1bGFyICsgdG90YWxFbWlzc2l2ZVJhZGlhbmNlO1xuXHQjaWZkZWYgVVNFX1NIRUVOXG5cdFx0ZmxvYXQgc2hlZW5FbmVyZ3lDb21wID0gMS4wIC0gMC4xNTcgKiBtYXgzKCBtYXRlcmlhbC5zaGVlbkNvbG9yICk7XG5cdFx0b3V0Z29pbmdMaWdodCA9IG91dGdvaW5nTGlnaHQgKiBzaGVlbkVuZXJneUNvbXAgKyBzaGVlblNwZWN1bGFyO1xuXHQjZW5kaWZcblx0I2lmZGVmIFVTRV9DTEVBUkNPQVRcblx0XHRmbG9hdCBkb3ROVmNjID0gc2F0dXJhdGUoIGRvdCggZ2VvbWV0cnlDbGVhcmNvYXROb3JtYWwsIGdlb21ldHJ5Vmlld0RpciApICk7XG5cdFx0dmVjMyBGY2MgPSBGX1NjaGxpY2soIG1hdGVyaWFsLmNsZWFyY29hdEYwLCBtYXRlcmlhbC5jbGVhcmNvYXRGOTAsIGRvdE5WY2MgKTtcblx0XHRvdXRnb2luZ0xpZ2h0ID0gb3V0Z29pbmdMaWdodCAqICggMS4wIC0gbWF0ZXJpYWwuY2xlYXJjb2F0ICogRmNjICkgKyBjbGVhcmNvYXRTcGVjdWxhciAqIG1hdGVyaWFsLmNsZWFyY29hdDtcblx0I2VuZGlmXG5cdCNpbmNsdWRlIDxvcGFxdWVfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxwcmVtdWx0aXBsaWVkX2FscGhhX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8ZGl0aGVyaW5nX2ZyYWdtZW50PlxufSI7Cgpjb25zdCB2ZXJ0ZXgkNCA9ICIjZGVmaW5lIFRPT05cbnZhcnlpbmcgdmVjMyB2Vmlld1Bvc2l0aW9uO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y29sb3JfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfdmVydGV4PlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8dXZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y29sb3JfdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGhjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8bm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHNraW5uaW5nX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxwcm9qZWN0X3ZlcnRleD5cblx0I2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3ZlcnRleD5cblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc192ZXJ0ZXg+XG5cdHZWaWV3UG9zaXRpb24gPSAtIG12UG9zaXRpb24ueHl6O1xuXHQjaW5jbHVkZSA8d29ybGRwb3NfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2hhZG93bWFwX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCmNvbnN0IGZyYWdtZW50JDQgPSAiI2RlZmluZSBUT09OXG51bmlmb3JtIHZlYzMgZGlmZnVzZTtcbnVuaWZvcm0gdmVjMyBlbWlzc2l2ZTtcbnVuaWZvcm0gZmxvYXQgb3BhY2l0eTtcbiNpbmNsdWRlIDxjb21tb24+XG4jaW5jbHVkZSA8cGFja2luZz5cbiNpbmNsdWRlIDxkaXRoZXJpbmdfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhb21hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8ZW1pc3NpdmVtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxncmFkaWVudG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGZvZ19wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGJzZGZzPlxuI2luY2x1ZGUgPGxpZ2h0c19wYXJzX2JlZ2luPlxuI2luY2x1ZGUgPG5vcm1hbF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxpZ2h0c190b29uX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8c2hhZG93bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnVtcG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPG5vcm1hbG1hcF9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGxvZ2RlcHRoYnVmX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ+XG5cdHZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggZGlmZnVzZSwgb3BhY2l0eSApO1xuXHRSZWZsZWN0ZWRMaWdodCByZWZsZWN0ZWRMaWdodCA9IFJlZmxlY3RlZExpZ2h0KCB2ZWMzKCAwLjAgKSwgdmVjMyggMC4wICksIHZlYzMoIDAuMCApLCB2ZWMzKCAwLjAgKSApO1xuXHR2ZWMzIHRvdGFsRW1pc3NpdmVSYWRpYW5jZSA9IGVtaXNzaXZlO1xuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxtYXBfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhbWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGF0ZXN0X2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFoYXNoX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bm9ybWFsX2ZyYWdtZW50X2JlZ2luPlxuXHQjaW5jbHVkZSA8bm9ybWFsX2ZyYWdtZW50X21hcHM+XG5cdCNpbmNsdWRlIDxlbWlzc2l2ZW1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGxpZ2h0c190b29uX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X2JlZ2luPlxuXHQjaW5jbHVkZSA8bGlnaHRzX2ZyYWdtZW50X21hcHM+XG5cdCNpbmNsdWRlIDxsaWdodHNfZnJhZ21lbnRfZW5kPlxuXHQjaW5jbHVkZSA8YW9tYXBfZnJhZ21lbnQ+XG5cdHZlYzMgb3V0Z29pbmdMaWdodCA9IHJlZmxlY3RlZExpZ2h0LmRpcmVjdERpZmZ1c2UgKyByZWZsZWN0ZWRMaWdodC5pbmRpcmVjdERpZmZ1c2UgKyB0b3RhbEVtaXNzaXZlUmFkaWFuY2U7XG5cdCNpbmNsdWRlIDxvcGFxdWVfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxwcmVtdWx0aXBsaWVkX2FscGhhX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8ZGl0aGVyaW5nX2ZyYWdtZW50PlxufSI7Cgpjb25zdCB2ZXJ0ZXgkMyA9ICJ1bmlmb3JtIGZsb2F0IHNpemU7XG51bmlmb3JtIGZsb2F0IHNjYWxlO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDxjb2xvcl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bW9ycGh0YXJnZXRfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4PlxuI2lmZGVmIFVTRV9QT0lOVFNfVVZcblx0dmFyeWluZyB2ZWMyIHZVdjtcblx0dW5pZm9ybSBtYXQzIHV2VHJhbnNmb3JtO1xuI2VuZGlmXG52b2lkIG1haW4oKSB7XG5cdCNpZmRlZiBVU0VfUE9JTlRTX1VWXG5cdFx0dlV2ID0gKCB1dlRyYW5zZm9ybSAqIHZlYzMoIHV2LCAxICkgKS54eTtcblx0I2VuZGlmXG5cdCNpbmNsdWRlIDxjb2xvcl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaGNvbG9yX3ZlcnRleD5cblx0I2luY2x1ZGUgPGJlZ2luX3ZlcnRleD5cblx0I2luY2x1ZGUgPG1vcnBodGFyZ2V0X3ZlcnRleD5cblx0I2luY2x1ZGUgPHByb2plY3RfdmVydGV4PlxuXHRnbF9Qb2ludFNpemUgPSBzaXplO1xuXHQjaWZkZWYgVVNFX1NJWkVBVFRFTlVBVElPTlxuXHRcdGJvb2wgaXNQZXJzcGVjdGl2ZSA9IGlzUGVyc3BlY3RpdmVNYXRyaXgoIHByb2plY3Rpb25NYXRyaXggKTtcblx0XHRpZiAoIGlzUGVyc3BlY3RpdmUgKSBnbF9Qb2ludFNpemUgKj0gKCBzY2FsZSAvIC0gbXZQb3NpdGlvbi56ICk7XG5cdCNlbmRpZlxuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0I2luY2x1ZGUgPHdvcmxkcG9zX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCmNvbnN0IGZyYWdtZW50JDMgPSAidW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGNvbG9yX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnRpY2xlX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGF0ZXN0X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFoYXNoX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudD5cbnZvaWQgbWFpbigpIHtcblx0I2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudD5cblx0dmVjMyBvdXRnb2luZ0xpZ2h0ID0gdmVjMyggMC4wICk7XG5cdHZlYzQgZGlmZnVzZUNvbG9yID0gdmVjNCggZGlmZnVzZSwgb3BhY2l0eSApO1xuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxtYXBfcGFydGljbGVfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxjb2xvcl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhdGVzdF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhaGFzaF9mcmFnbWVudD5cblx0b3V0Z29pbmdMaWdodCA9IGRpZmZ1c2VDb2xvci5yZ2I7XG5cdCNpbmNsdWRlIDxvcGFxdWVfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxwcmVtdWx0aXBsaWVkX2FscGhhX2ZyYWdtZW50PlxufSI7Cgpjb25zdCB2ZXJ0ZXgkMiA9ICIjaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPGZvZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxtb3JwaHRhcmdldF9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxza2lubmluZ19wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc192ZXJ0ZXg+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDxiZWdpbm5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxtb3JwaG5vcm1hbF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2luYmFzZV92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxza2lubm9ybWFsX3ZlcnRleD5cblx0I2luY2x1ZGUgPGRlZmF1bHRub3JtYWxfdmVydGV4PlxuXHQjaW5jbHVkZSA8YmVnaW5fdmVydGV4PlxuXHQjaW5jbHVkZSA8bW9ycGh0YXJnZXRfdmVydGV4PlxuXHQjaW5jbHVkZSA8c2tpbm5pbmdfdmVydGV4PlxuXHQjaW5jbHVkZSA8cHJvamVjdF92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl92ZXJ0ZXg+XG5cdCNpbmNsdWRlIDx3b3JsZHBvc192ZXJ0ZXg+XG5cdCNpbmNsdWRlIDxzaGFkb3dtYXBfdmVydGV4PlxuXHQjaW5jbHVkZSA8Zm9nX3ZlcnRleD5cbn0iOwoKY29uc3QgZnJhZ21lbnQkMiA9ICJ1bmlmb3JtIHZlYzMgY29sb3I7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHBhY2tpbmc+XG4jaW5jbHVkZSA8Zm9nX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YnNkZnM+XG4jaW5jbHVkZSA8bGlnaHRzX3BhcnNfYmVnaW4+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxzaGFkb3dtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxzaGFkb3dtYXNrX3BhcnNfZnJhZ21lbnQ+XG52b2lkIG1haW4oKSB7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0Z2xfRnJhZ0NvbG9yID0gdmVjNCggY29sb3IsIG9wYWNpdHkgKiAoIDEuMCAtIGdldFNoYWRvd01hc2soKSApICk7XG5cdCNpbmNsdWRlIDx0b25lbWFwcGluZ19mcmFnbWVudD5cblx0I2luY2x1ZGUgPGNvbG9yc3BhY2VfZnJhZ21lbnQ+XG5cdCNpbmNsdWRlIDxmb2dfZnJhZ21lbnQ+XG59IjsKCmNvbnN0IHZlcnRleCQxID0gInVuaWZvcm0gZmxvYXQgcm90YXRpb247XG51bmlmb3JtIHZlYzIgY2VudGVyO1xuI2luY2x1ZGUgPGNvbW1vbj5cbiNpbmNsdWRlIDx1dl9wYXJzX3ZlcnRleD5cbiNpbmNsdWRlIDxmb2dfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8bG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg+XG4jaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8dXZfdmVydGV4PlxuXHR2ZWM0IG12UG9zaXRpb24gPSBtb2RlbFZpZXdNYXRyaXggKiB2ZWM0KCAwLjAsIDAuMCwgMC4wLCAxLjAgKTtcblx0dmVjMiBzY2FsZTtcblx0c2NhbGUueCA9IGxlbmd0aCggdmVjMyggbW9kZWxNYXRyaXhbIDAgXS54LCBtb2RlbE1hdHJpeFsgMCBdLnksIG1vZGVsTWF0cml4WyAwIF0ueiApICk7XG5cdHNjYWxlLnkgPSBsZW5ndGgoIHZlYzMoIG1vZGVsTWF0cml4WyAxIF0ueCwgbW9kZWxNYXRyaXhbIDEgXS55LCBtb2RlbE1hdHJpeFsgMSBdLnogKSApO1xuXHQjaWZuZGVmIFVTRV9TSVpFQVRURU5VQVRJT05cblx0XHRib29sIGlzUGVyc3BlY3RpdmUgPSBpc1BlcnNwZWN0aXZlTWF0cml4KCBwcm9qZWN0aW9uTWF0cml4ICk7XG5cdFx0aWYgKCBpc1BlcnNwZWN0aXZlICkgc2NhbGUgKj0gLSBtdlBvc2l0aW9uLno7XG5cdCNlbmRpZlxuXHR2ZWMyIGFsaWduZWRQb3NpdGlvbiA9ICggcG9zaXRpb24ueHkgLSAoIGNlbnRlciAtIHZlYzIoIDAuNSApICkgKSAqIHNjYWxlO1xuXHR2ZWMyIHJvdGF0ZWRQb3NpdGlvbjtcblx0cm90YXRlZFBvc2l0aW9uLnggPSBjb3MoIHJvdGF0aW9uICkgKiBhbGlnbmVkUG9zaXRpb24ueCAtIHNpbiggcm90YXRpb24gKSAqIGFsaWduZWRQb3NpdGlvbi55O1xuXHRyb3RhdGVkUG9zaXRpb24ueSA9IHNpbiggcm90YXRpb24gKSAqIGFsaWduZWRQb3NpdGlvbi54ICsgY29zKCByb3RhdGlvbiApICogYWxpZ25lZFBvc2l0aW9uLnk7XG5cdG12UG9zaXRpb24ueHkgKz0gcm90YXRlZFBvc2l0aW9uO1xuXHRnbF9Qb3NpdGlvbiA9IHByb2plY3Rpb25NYXRyaXggKiBtdlBvc2l0aW9uO1xuXHQjaW5jbHVkZSA8bG9nZGVwdGhidWZfdmVydGV4PlxuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX3ZlcnRleD5cblx0I2luY2x1ZGUgPGZvZ192ZXJ0ZXg+XG59IjsKCmNvbnN0IGZyYWdtZW50JDEgPSAidW5pZm9ybSB2ZWMzIGRpZmZ1c2U7XG51bmlmb3JtIGZsb2F0IG9wYWNpdHk7XG4jaW5jbHVkZSA8Y29tbW9uPlxuI2luY2x1ZGUgPHV2X3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8bWFwX3BhcnNfZnJhZ21lbnQ+XG4jaW5jbHVkZSA8YWxwaGFtYXBfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYXRlc3RfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxhbHBoYWhhc2hfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxmb2dfcGFyc19mcmFnbWVudD5cbiNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50PlxuI2luY2x1ZGUgPGNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50Plxudm9pZCBtYWluKCkge1xuXHQjaW5jbHVkZSA8Y2xpcHBpbmdfcGxhbmVzX2ZyYWdtZW50PlxuXHR2ZWMzIG91dGdvaW5nTGlnaHQgPSB2ZWMzKCAwLjAgKTtcblx0dmVjNCBkaWZmdXNlQ29sb3IgPSB2ZWM0KCBkaWZmdXNlLCBvcGFjaXR5ICk7XG5cdCNpbmNsdWRlIDxsb2dkZXB0aGJ1Zl9mcmFnbWVudD5cblx0I2luY2x1ZGUgPG1hcF9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGFscGhhbWFwX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGF0ZXN0X2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8YWxwaGFoYXNoX2ZyYWdtZW50PlxuXHRvdXRnb2luZ0xpZ2h0ID0gZGlmZnVzZUNvbG9yLnJnYjtcblx0I2luY2x1ZGUgPG9wYXF1ZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPHRvbmVtYXBwaW5nX2ZyYWdtZW50PlxuXHQjaW5jbHVkZSA8Y29sb3JzcGFjZV9mcmFnbWVudD5cblx0I2luY2x1ZGUgPGZvZ19mcmFnbWVudD5cbn0iOwoKY29uc3QgU2hhZGVyQ2h1bmsgPSB7CglhbHBoYWhhc2hfZnJhZ21lbnQ6IGFscGhhaGFzaF9mcmFnbWVudCwKCWFscGhhaGFzaF9wYXJzX2ZyYWdtZW50OiBhbHBoYWhhc2hfcGFyc19mcmFnbWVudCwKCWFscGhhbWFwX2ZyYWdtZW50OiBhbHBoYW1hcF9mcmFnbWVudCwKCWFscGhhbWFwX3BhcnNfZnJhZ21lbnQ6IGFscGhhbWFwX3BhcnNfZnJhZ21lbnQsCglhbHBoYXRlc3RfZnJhZ21lbnQ6IGFscGhhdGVzdF9mcmFnbWVudCwKCWFscGhhdGVzdF9wYXJzX2ZyYWdtZW50OiBhbHBoYXRlc3RfcGFyc19mcmFnbWVudCwKCWFvbWFwX2ZyYWdtZW50OiBhb21hcF9mcmFnbWVudCwKCWFvbWFwX3BhcnNfZnJhZ21lbnQ6IGFvbWFwX3BhcnNfZnJhZ21lbnQsCgliZWdpbl92ZXJ0ZXg6IGJlZ2luX3ZlcnRleCwKCWJlZ2lubm9ybWFsX3ZlcnRleDogYmVnaW5ub3JtYWxfdmVydGV4LAoJYnNkZnM6IGJzZGZzLAoJaXJpZGVzY2VuY2VfZnJhZ21lbnQ6IGlyaWRlc2NlbmNlX2ZyYWdtZW50LAoJYnVtcG1hcF9wYXJzX2ZyYWdtZW50OiBidW1wbWFwX3BhcnNfZnJhZ21lbnQsCgljbGlwcGluZ19wbGFuZXNfZnJhZ21lbnQ6IGNsaXBwaW5nX3BsYW5lc19mcmFnbWVudCwKCWNsaXBwaW5nX3BsYW5lc19wYXJzX2ZyYWdtZW50OiBjbGlwcGluZ19wbGFuZXNfcGFyc19mcmFnbWVudCwKCWNsaXBwaW5nX3BsYW5lc19wYXJzX3ZlcnRleDogY2xpcHBpbmdfcGxhbmVzX3BhcnNfdmVydGV4LAoJY2xpcHBpbmdfcGxhbmVzX3ZlcnRleDogY2xpcHBpbmdfcGxhbmVzX3ZlcnRleCwKCWNvbG9yX2ZyYWdtZW50OiBjb2xvcl9mcmFnbWVudCwKCWNvbG9yX3BhcnNfZnJhZ21lbnQ6IGNvbG9yX3BhcnNfZnJhZ21lbnQsCgljb2xvcl9wYXJzX3ZlcnRleDogY29sb3JfcGFyc192ZXJ0ZXgsCgljb2xvcl92ZXJ0ZXg6IGNvbG9yX3ZlcnRleCwKCWNvbW1vbjogY29tbW9uLAoJY3ViZV91dl9yZWZsZWN0aW9uX2ZyYWdtZW50OiBjdWJlX3V2X3JlZmxlY3Rpb25fZnJhZ21lbnQsCglkZWZhdWx0bm9ybWFsX3ZlcnRleDogZGVmYXVsdG5vcm1hbF92ZXJ0ZXgsCglkaXNwbGFjZW1lbnRtYXBfcGFyc192ZXJ0ZXg6IGRpc3BsYWNlbWVudG1hcF9wYXJzX3ZlcnRleCwKCWRpc3BsYWNlbWVudG1hcF92ZXJ0ZXg6IGRpc3BsYWNlbWVudG1hcF92ZXJ0ZXgsCgllbWlzc2l2ZW1hcF9mcmFnbWVudDogZW1pc3NpdmVtYXBfZnJhZ21lbnQsCgllbWlzc2l2ZW1hcF9wYXJzX2ZyYWdtZW50OiBlbWlzc2l2ZW1hcF9wYXJzX2ZyYWdtZW50LAoJY29sb3JzcGFjZV9mcmFnbWVudDogY29sb3JzcGFjZV9mcmFnbWVudCwKCWNvbG9yc3BhY2VfcGFyc19mcmFnbWVudDogY29sb3JzcGFjZV9wYXJzX2ZyYWdtZW50LAoJZW52bWFwX2ZyYWdtZW50OiBlbnZtYXBfZnJhZ21lbnQsCgllbnZtYXBfY29tbW9uX3BhcnNfZnJhZ21lbnQ6IGVudm1hcF9jb21tb25fcGFyc19mcmFnbWVudCwKCWVudm1hcF9wYXJzX2ZyYWdtZW50OiBlbnZtYXBfcGFyc19mcmFnbWVudCwKCWVudm1hcF9wYXJzX3ZlcnRleDogZW52bWFwX3BhcnNfdmVydGV4LAoJZW52bWFwX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQ6IGVudm1hcF9waHlzaWNhbF9wYXJzX2ZyYWdtZW50LAoJZW52bWFwX3ZlcnRleDogZW52bWFwX3ZlcnRleCwKCWZvZ192ZXJ0ZXg6IGZvZ192ZXJ0ZXgsCglmb2dfcGFyc192ZXJ0ZXg6IGZvZ19wYXJzX3ZlcnRleCwKCWZvZ19mcmFnbWVudDogZm9nX2ZyYWdtZW50LAoJZm9nX3BhcnNfZnJhZ21lbnQ6IGZvZ19wYXJzX2ZyYWdtZW50LAoJZ3JhZGllbnRtYXBfcGFyc19mcmFnbWVudDogZ3JhZGllbnRtYXBfcGFyc19mcmFnbWVudCwKCWxpZ2h0bWFwX2ZyYWdtZW50OiBsaWdodG1hcF9mcmFnbWVudCwKCWxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQ6IGxpZ2h0bWFwX3BhcnNfZnJhZ21lbnQsCglsaWdodHNfbGFtYmVydF9mcmFnbWVudDogbGlnaHRzX2xhbWJlcnRfZnJhZ21lbnQsCglsaWdodHNfbGFtYmVydF9wYXJzX2ZyYWdtZW50OiBsaWdodHNfbGFtYmVydF9wYXJzX2ZyYWdtZW50LAoJbGlnaHRzX3BhcnNfYmVnaW46IGxpZ2h0c19wYXJzX2JlZ2luLAoJbGlnaHRzX3Rvb25fZnJhZ21lbnQ6IGxpZ2h0c190b29uX2ZyYWdtZW50LAoJbGlnaHRzX3Rvb25fcGFyc19mcmFnbWVudDogbGlnaHRzX3Rvb25fcGFyc19mcmFnbWVudCwKCWxpZ2h0c19waG9uZ19mcmFnbWVudDogbGlnaHRzX3Bob25nX2ZyYWdtZW50LAoJbGlnaHRzX3Bob25nX3BhcnNfZnJhZ21lbnQ6IGxpZ2h0c19waG9uZ19wYXJzX2ZyYWdtZW50LAoJbGlnaHRzX3BoeXNpY2FsX2ZyYWdtZW50OiBsaWdodHNfcGh5c2ljYWxfZnJhZ21lbnQsCglsaWdodHNfcGh5c2ljYWxfcGFyc19mcmFnbWVudDogbGlnaHRzX3BoeXNpY2FsX3BhcnNfZnJhZ21lbnQsCglsaWdodHNfZnJhZ21lbnRfYmVnaW46IGxpZ2h0c19mcmFnbWVudF9iZWdpbiwKCWxpZ2h0c19mcmFnbWVudF9tYXBzOiBsaWdodHNfZnJhZ21lbnRfbWFwcywKCWxpZ2h0c19mcmFnbWVudF9lbmQ6IGxpZ2h0c19mcmFnbWVudF9lbmQsCglsb2dkZXB0aGJ1Zl9mcmFnbWVudDogbG9nZGVwdGhidWZfZnJhZ21lbnQsCglsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50OiBsb2dkZXB0aGJ1Zl9wYXJzX2ZyYWdtZW50LAoJbG9nZGVwdGhidWZfcGFyc192ZXJ0ZXg6IGxvZ2RlcHRoYnVmX3BhcnNfdmVydGV4LAoJbG9nZGVwdGhidWZfdmVydGV4OiBsb2dkZXB0aGJ1Zl92ZXJ0ZXgsCgltYXBfZnJhZ21lbnQ6IG1hcF9mcmFnbWVudCwKCW1hcF9wYXJzX2ZyYWdtZW50OiBtYXBfcGFyc19mcmFnbWVudCwKCW1hcF9wYXJ0aWNsZV9mcmFnbWVudDogbWFwX3BhcnRpY2xlX2ZyYWdtZW50LAoJbWFwX3BhcnRpY2xlX3BhcnNfZnJhZ21lbnQ6IG1hcF9wYXJ0aWNsZV9wYXJzX2ZyYWdtZW50LAoJbWV0YWxuZXNzbWFwX2ZyYWdtZW50OiBtZXRhbG5lc3NtYXBfZnJhZ21lbnQsCgltZXRhbG5lc3NtYXBfcGFyc19mcmFnbWVudDogbWV0YWxuZXNzbWFwX3BhcnNfZnJhZ21lbnQsCgltb3JwaGNvbG9yX3ZlcnRleDogbW9ycGhjb2xvcl92ZXJ0ZXgsCgltb3JwaG5vcm1hbF92ZXJ0ZXg6IG1vcnBobm9ybWFsX3ZlcnRleCwKCW1vcnBodGFyZ2V0X3BhcnNfdmVydGV4OiBtb3JwaHRhcmdldF9wYXJzX3ZlcnRleCwKCW1vcnBodGFyZ2V0X3ZlcnRleDogbW9ycGh0YXJnZXRfdmVydGV4LAoJbm9ybWFsX2ZyYWdtZW50X2JlZ2luOiBub3JtYWxfZnJhZ21lbnRfYmVnaW4sCglub3JtYWxfZnJhZ21lbnRfbWFwczogbm9ybWFsX2ZyYWdtZW50X21hcHMsCglub3JtYWxfcGFyc19mcmFnbWVudDogbm9ybWFsX3BhcnNfZnJhZ21lbnQsCglub3JtYWxfcGFyc192ZXJ0ZXg6IG5vcm1hbF9wYXJzX3ZlcnRleCwKCW5vcm1hbF92ZXJ0ZXg6IG5vcm1hbF92ZXJ0ZXgsCglub3JtYWxtYXBfcGFyc19mcmFnbWVudDogbm9ybWFsbWFwX3BhcnNfZnJhZ21lbnQsCgljbGVhcmNvYXRfbm9ybWFsX2ZyYWdtZW50X2JlZ2luOiBjbGVhcmNvYXRfbm9ybWFsX2ZyYWdtZW50X2JlZ2luLAoJY2xlYXJjb2F0X25vcm1hbF9mcmFnbWVudF9tYXBzOiBjbGVhcmNvYXRfbm9ybWFsX2ZyYWdtZW50X21hcHMsCgljbGVhcmNvYXRfcGFyc19mcmFnbWVudDogY2xlYXJjb2F0X3BhcnNfZnJhZ21lbnQsCglpcmlkZXNjZW5jZV9wYXJzX2ZyYWdtZW50OiBpcmlkZXNjZW5jZV9wYXJzX2ZyYWdtZW50LAoJb3BhcXVlX2ZyYWdtZW50OiBvcGFxdWVfZnJhZ21lbnQsCglwYWNraW5nOiBwYWNraW5nLAoJcHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudDogcHJlbXVsdGlwbGllZF9hbHBoYV9mcmFnbWVudCwKCXByb2plY3RfdmVydGV4OiBwcm9qZWN0X3ZlcnRleCwKCWRpdGhlcmluZ19mcmFnbWVudDogZGl0aGVyaW5nX2ZyYWdtZW50LAoJZGl0aGVyaW5nX3BhcnNfZnJhZ21lbnQ6IGRpdGhlcmluZ19wYXJzX2ZyYWdtZW50LAoJcm91Z2huZXNzbWFwX2ZyYWdtZW50OiByb3VnaG5lc3NtYXBfZnJhZ21lbnQsCglyb3VnaG5lc3NtYXBfcGFyc19mcmFnbWVudDogcm91Z2huZXNzbWFwX3BhcnNfZnJhZ21lbnQsCglzaGFkb3dtYXBfcGFyc19mcmFnbWVudDogc2hhZG93bWFwX3BhcnNfZnJhZ21lbnQsCglzaGFkb3dtYXBfcGFyc192ZXJ0ZXg6IHNoYWRvd21hcF9wYXJzX3ZlcnRleCwKCXNoYWRvd21hcF92ZXJ0ZXg6IHNoYWRvd21hcF92ZXJ0ZXgsCglzaGFkb3dtYXNrX3BhcnNfZnJhZ21lbnQ6IHNoYWRvd21hc2tfcGFyc19mcmFnbWVudCwKCXNraW5iYXNlX3ZlcnRleDogc2tpbmJhc2VfdmVydGV4LAoJc2tpbm5pbmdfcGFyc192ZXJ0ZXg6IHNraW5uaW5nX3BhcnNfdmVydGV4LAoJc2tpbm5pbmdfdmVydGV4OiBza2lubmluZ192ZXJ0ZXgsCglza2lubm9ybWFsX3ZlcnRleDogc2tpbm5vcm1hbF92ZXJ0ZXgsCglzcGVjdWxhcm1hcF9mcmFnbWVudDogc3BlY3VsYXJtYXBfZnJhZ21lbnQsCglzcGVjdWxhcm1hcF9wYXJzX2ZyYWdtZW50OiBzcGVjdWxhcm1hcF9wYXJzX2ZyYWdtZW50LAoJdG9uZW1hcHBpbmdfZnJhZ21lbnQ6IHRvbmVtYXBwaW5nX2ZyYWdtZW50LAoJdG9uZW1hcHBpbmdfcGFyc19mcmFnbWVudDogdG9uZW1hcHBpbmdfcGFyc19mcmFnbWVudCwKCXRyYW5zbWlzc2lvbl9mcmFnbWVudDogdHJhbnNtaXNzaW9uX2ZyYWdtZW50LAoJdHJhbnNtaXNzaW9uX3BhcnNfZnJhZ21lbnQ6IHRyYW5zbWlzc2lvbl9wYXJzX2ZyYWdtZW50LAoJdXZfcGFyc19mcmFnbWVudDogdXZfcGFyc19mcmFnbWVudCwKCXV2X3BhcnNfdmVydGV4OiB1dl9wYXJzX3ZlcnRleCwKCXV2X3ZlcnRleDogdXZfdmVydGV4LAoJd29ybGRwb3NfdmVydGV4OiB3b3JsZHBvc192ZXJ0ZXgsCgoJYmFja2dyb3VuZF92ZXJ0OiB2ZXJ0ZXgkaCwKCWJhY2tncm91bmRfZnJhZzogZnJhZ21lbnQkaCwKCWJhY2tncm91bmRDdWJlX3ZlcnQ6IHZlcnRleCRnLAoJYmFja2dyb3VuZEN1YmVfZnJhZzogZnJhZ21lbnQkZywKCWN1YmVfdmVydDogdmVydGV4JGYsCgljdWJlX2ZyYWc6IGZyYWdtZW50JGYsCglkZXB0aF92ZXJ0OiB2ZXJ0ZXgkZSwKCWRlcHRoX2ZyYWc6IGZyYWdtZW50JGUsCglkaXN0YW5jZVJHQkFfdmVydDogdmVydGV4JGQsCglkaXN0YW5jZVJHQkFfZnJhZzogZnJhZ21lbnQkZCwKCWVxdWlyZWN0X3ZlcnQ6IHZlcnRleCRjLAoJZXF1aXJlY3RfZnJhZzogZnJhZ21lbnQkYywKCWxpbmVkYXNoZWRfdmVydDogdmVydGV4JGIsCglsaW5lZGFzaGVkX2ZyYWc6IGZyYWdtZW50JGIsCgltZXNoYmFzaWNfdmVydDogdmVydGV4JGEsCgltZXNoYmFzaWNfZnJhZzogZnJhZ21lbnQkYSwKCW1lc2hsYW1iZXJ0X3ZlcnQ6IHZlcnRleCQ5LAoJbWVzaGxhbWJlcnRfZnJhZzogZnJhZ21lbnQkOSwKCW1lc2htYXRjYXBfdmVydDogdmVydGV4JDgsCgltZXNobWF0Y2FwX2ZyYWc6IGZyYWdtZW50JDgsCgltZXNobm9ybWFsX3ZlcnQ6IHZlcnRleCQ3LAoJbWVzaG5vcm1hbF9mcmFnOiBmcmFnbWVudCQ3LAoJbWVzaHBob25nX3ZlcnQ6IHZlcnRleCQ2LAoJbWVzaHBob25nX2ZyYWc6IGZyYWdtZW50JDYsCgltZXNocGh5c2ljYWxfdmVydDogdmVydGV4JDUsCgltZXNocGh5c2ljYWxfZnJhZzogZnJhZ21lbnQkNSwKCW1lc2h0b29uX3ZlcnQ6IHZlcnRleCQ0LAoJbWVzaHRvb25fZnJhZzogZnJhZ21lbnQkNCwKCXBvaW50c192ZXJ0OiB2ZXJ0ZXgkMywKCXBvaW50c19mcmFnOiBmcmFnbWVudCQzLAoJc2hhZG93X3ZlcnQ6IHZlcnRleCQyLAoJc2hhZG93X2ZyYWc6IGZyYWdtZW50JDIsCglzcHJpdGVfdmVydDogdmVydGV4JDEsCglzcHJpdGVfZnJhZzogZnJhZ21lbnQkMQp9OwoKLyoqCiAqIFVuaWZvcm1zIGxpYnJhcnkgZm9yIHNoYXJlZCB3ZWJnbCBzaGFkZXJzCiAqLwoKY29uc3QgVW5pZm9ybXNMaWIgPSB7CgoJY29tbW9uOiB7CgoJCWRpZmZ1c2U6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweGZmZmZmZiApIH0sCgkJb3BhY2l0eTogeyB2YWx1ZTogMS4wIH0sCgoJCW1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCW1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgoJCWFscGhhTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJYWxwaGFNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoKCQlhbHBoYVRlc3Q6IHsgdmFsdWU6IDAgfQoKCX0sCgoJc3BlY3VsYXJtYXA6IHsKCgkJc3BlY3VsYXJNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQlzcGVjdWxhck1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0KCgl9LAoKCWVudm1hcDogewoKCQllbnZNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQlmbGlwRW52TWFwOiB7IHZhbHVlOiAtIDEgfSwKCQlyZWZsZWN0aXZpdHk6IHsgdmFsdWU6IDEuMCB9LCAvLyBiYXNpYywgbGFtYmVydCwgcGhvbmcKCQlpb3I6IHsgdmFsdWU6IDEuNSB9LCAvLyBwaHlzaWNhbAoJCXJlZnJhY3Rpb25SYXRpbzogeyB2YWx1ZTogMC45OCB9LCAvLyBiYXNpYywgbGFtYmVydCwgcGhvbmcKCgl9LAoKCWFvbWFwOiB7CgoJCWFvTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJYW9NYXBJbnRlbnNpdHk6IHsgdmFsdWU6IDEgfSwKCQlhb01hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0KCgl9LAoKCWxpZ2h0bWFwOiB7CgoJCWxpZ2h0TWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJbGlnaHRNYXBJbnRlbnNpdHk6IHsgdmFsdWU6IDEgfSwKCQlsaWdodE1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0KCgl9LAoKCWJ1bXBtYXA6IHsKCgkJYnVtcE1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCWJ1bXBNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCWJ1bXBTY2FsZTogeyB2YWx1ZTogMSB9CgoJfSwKCglub3JtYWxtYXA6IHsKCgkJbm9ybWFsTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJbm9ybWFsTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQlub3JtYWxTY2FsZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMiggMSwgMSApIH0KCgl9LAoKCWRpc3BsYWNlbWVudG1hcDogewoKCQlkaXNwbGFjZW1lbnRNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQlkaXNwbGFjZW1lbnRNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCWRpc3BsYWNlbWVudFNjYWxlOiB7IHZhbHVlOiAxIH0sCgkJZGlzcGxhY2VtZW50QmlhczogeyB2YWx1ZTogMCB9CgoJfSwKCgllbWlzc2l2ZW1hcDogewoKCQllbWlzc2l2ZU1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCWVtaXNzaXZlTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfQoKCX0sCgoJbWV0YWxuZXNzbWFwOiB7CgoJCW1ldGFsbmVzc01hcDogeyB2YWx1ZTogbnVsbCB9LAoJCW1ldGFsbmVzc01hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0KCgl9LAoKCXJvdWdobmVzc21hcDogewoKCQlyb3VnaG5lc3NNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQlyb3VnaG5lc3NNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9CgoJfSwKCglncmFkaWVudG1hcDogewoKCQlncmFkaWVudE1hcDogeyB2YWx1ZTogbnVsbCB9CgoJfSwKCglmb2c6IHsKCgkJZm9nRGVuc2l0eTogeyB2YWx1ZTogMC4wMDAyNSB9LAoJCWZvZ05lYXI6IHsgdmFsdWU6IDEgfSwKCQlmb2dGYXI6IHsgdmFsdWU6IDIwMDAgfSwKCQlmb2dDb2xvcjogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4ZmZmZmZmICkgfQoKCX0sCgoJbGlnaHRzOiB7CgoJCWFtYmllbnRMaWdodENvbG9yOiB7IHZhbHVlOiBbXSB9LAoKCQlsaWdodFByb2JlOiB7IHZhbHVlOiBbXSB9LAoKCQlkaXJlY3Rpb25hbExpZ2h0czogeyB2YWx1ZTogW10sIHByb3BlcnRpZXM6IHsKCQkJZGlyZWN0aW9uOiB7fSwKCQkJY29sb3I6IHt9CgkJfSB9LAoKCQlkaXJlY3Rpb25hbExpZ2h0U2hhZG93czogeyB2YWx1ZTogW10sIHByb3BlcnRpZXM6IHsKCQkJc2hhZG93Qmlhczoge30sCgkJCXNoYWRvd05vcm1hbEJpYXM6IHt9LAoJCQlzaGFkb3dSYWRpdXM6IHt9LAoJCQlzaGFkb3dNYXBTaXplOiB7fQoJCX0gfSwKCgkJZGlyZWN0aW9uYWxTaGFkb3dNYXA6IHsgdmFsdWU6IFtdIH0sCgkJZGlyZWN0aW9uYWxTaGFkb3dNYXRyaXg6IHsgdmFsdWU6IFtdIH0sCgoJCXNwb3RMaWdodHM6IHsgdmFsdWU6IFtdLCBwcm9wZXJ0aWVzOiB7CgkJCWNvbG9yOiB7fSwKCQkJcG9zaXRpb246IHt9LAoJCQlkaXJlY3Rpb246IHt9LAoJCQlkaXN0YW5jZToge30sCgkJCWNvbmVDb3M6IHt9LAoJCQlwZW51bWJyYUNvczoge30sCgkJCWRlY2F5OiB7fQoJCX0gfSwKCgkJc3BvdExpZ2h0U2hhZG93czogeyB2YWx1ZTogW10sIHByb3BlcnRpZXM6IHsKCQkJc2hhZG93Qmlhczoge30sCgkJCXNoYWRvd05vcm1hbEJpYXM6IHt9LAoJCQlzaGFkb3dSYWRpdXM6IHt9LAoJCQlzaGFkb3dNYXBTaXplOiB7fQoJCX0gfSwKCgkJc3BvdExpZ2h0TWFwOiB7IHZhbHVlOiBbXSB9LAoJCXNwb3RTaGFkb3dNYXA6IHsgdmFsdWU6IFtdIH0sCgkJc3BvdExpZ2h0TWF0cml4OiB7IHZhbHVlOiBbXSB9LAoKCQlwb2ludExpZ2h0czogeyB2YWx1ZTogW10sIHByb3BlcnRpZXM6IHsKCQkJY29sb3I6IHt9LAoJCQlwb3NpdGlvbjoge30sCgkJCWRlY2F5OiB7fSwKCQkJZGlzdGFuY2U6IHt9CgkJfSB9LAoKCQlwb2ludExpZ2h0U2hhZG93czogeyB2YWx1ZTogW10sIHByb3BlcnRpZXM6IHsKCQkJc2hhZG93Qmlhczoge30sCgkJCXNoYWRvd05vcm1hbEJpYXM6IHt9LAoJCQlzaGFkb3dSYWRpdXM6IHt9LAoJCQlzaGFkb3dNYXBTaXplOiB7fSwKCQkJc2hhZG93Q2FtZXJhTmVhcjoge30sCgkJCXNoYWRvd0NhbWVyYUZhcjoge30KCQl9IH0sCgoJCXBvaW50U2hhZG93TWFwOiB7IHZhbHVlOiBbXSB9LAoJCXBvaW50U2hhZG93TWF0cml4OiB7IHZhbHVlOiBbXSB9LAoKCQloZW1pc3BoZXJlTGlnaHRzOiB7IHZhbHVlOiBbXSwgcHJvcGVydGllczogewoJCQlkaXJlY3Rpb246IHt9LAoJCQlza3lDb2xvcjoge30sCgkJCWdyb3VuZENvbG9yOiB7fQoJCX0gfSwKCgkJLy8gVE9ETyAoYWJlbG5hdGlvbik6IFJlY3RBcmVhTGlnaHQgQlJERiBkYXRhIG5lZWRzIHRvIGJlIG1vdmVkIGZyb20gZXhhbXBsZSB0byBtYWluIHNyYwoJCXJlY3RBcmVhTGlnaHRzOiB7IHZhbHVlOiBbXSwgcHJvcGVydGllczogewoJCQljb2xvcjoge30sCgkJCXBvc2l0aW9uOiB7fSwKCQkJd2lkdGg6IHt9LAoJCQloZWlnaHQ6IHt9CgkJfSB9LAoKCQlsdGNfMTogeyB2YWx1ZTogbnVsbCB9LAoJCWx0Y18yOiB7IHZhbHVlOiBudWxsIH0KCgl9LAoKCXBvaW50czogewoKCQlkaWZmdXNlOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBDb2xvciggMHhmZmZmZmYgKSB9LAoJCW9wYWNpdHk6IHsgdmFsdWU6IDEuMCB9LAoJCXNpemU6IHsgdmFsdWU6IDEuMCB9LAoJCXNjYWxlOiB7IHZhbHVlOiAxLjAgfSwKCQltYXA6IHsgdmFsdWU6IG51bGwgfSwKCQlhbHBoYU1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCWFscGhhTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQlhbHBoYVRlc3Q6IHsgdmFsdWU6IDAgfSwKCQl1dlRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0KCgl9LAoKCXNwcml0ZTogewoKCQlkaWZmdXNlOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBDb2xvciggMHhmZmZmZmYgKSB9LAoJCW9wYWNpdHk6IHsgdmFsdWU6IDEuMCB9LAoJCWNlbnRlcjogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMiggMC41LCAwLjUgKSB9LAoJCXJvdGF0aW9uOiB7IHZhbHVlOiAwLjAgfSwKCQltYXA6IHsgdmFsdWU6IG51bGwgfSwKCQltYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCWFscGhhTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJYWxwaGFNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCWFscGhhVGVzdDogeyB2YWx1ZTogMCB9CgoJfQoKfTsKCmNvbnN0IFNoYWRlckxpYiA9IHsKCgliYXNpYzogewoKCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCgkJCVVuaWZvcm1zTGliLmNvbW1vbiwKCQkJVW5pZm9ybXNMaWIuc3BlY3VsYXJtYXAsCgkJCVVuaWZvcm1zTGliLmVudm1hcCwKCQkJVW5pZm9ybXNMaWIuYW9tYXAsCgkJCVVuaWZvcm1zTGliLmxpZ2h0bWFwLAoJCQlVbmlmb3Jtc0xpYi5mb2cKCQldICksCgoJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaGJhc2ljX3ZlcnQsCgkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hiYXNpY19mcmFnCgoJfSwKCglsYW1iZXJ0OiB7CgoJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKCQkJVW5pZm9ybXNMaWIuY29tbW9uLAoJCQlVbmlmb3Jtc0xpYi5zcGVjdWxhcm1hcCwKCQkJVW5pZm9ybXNMaWIuZW52bWFwLAoJCQlVbmlmb3Jtc0xpYi5hb21hcCwKCQkJVW5pZm9ybXNMaWIubGlnaHRtYXAsCgkJCVVuaWZvcm1zTGliLmVtaXNzaXZlbWFwLAoJCQlVbmlmb3Jtc0xpYi5idW1wbWFwLAoJCQlVbmlmb3Jtc0xpYi5ub3JtYWxtYXAsCgkJCVVuaWZvcm1zTGliLmRpc3BsYWNlbWVudG1hcCwKCQkJVW5pZm9ybXNMaWIuZm9nLAoJCQlVbmlmb3Jtc0xpYi5saWdodHMsCgkJCXsKCQkJCWVtaXNzaXZlOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBDb2xvciggMHgwMDAwMDAgKSB9CgkJCX0KCQldICksCgoJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaGxhbWJlcnRfdmVydCwKCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaGxhbWJlcnRfZnJhZwoKCX0sCgoJcGhvbmc6IHsKCgkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwoJCQlVbmlmb3Jtc0xpYi5jb21tb24sCgkJCVVuaWZvcm1zTGliLnNwZWN1bGFybWFwLAoJCQlVbmlmb3Jtc0xpYi5lbnZtYXAsCgkJCVVuaWZvcm1zTGliLmFvbWFwLAoJCQlVbmlmb3Jtc0xpYi5saWdodG1hcCwKCQkJVW5pZm9ybXNMaWIuZW1pc3NpdmVtYXAsCgkJCVVuaWZvcm1zTGliLmJ1bXBtYXAsCgkJCVVuaWZvcm1zTGliLm5vcm1hbG1hcCwKCQkJVW5pZm9ybXNMaWIuZGlzcGxhY2VtZW50bWFwLAoJCQlVbmlmb3Jtc0xpYi5mb2csCgkJCVVuaWZvcm1zTGliLmxpZ2h0cywKCQkJewoJCQkJZW1pc3NpdmU6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweDAwMDAwMCApIH0sCgkJCQlzcGVjdWxhcjogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4MTExMTExICkgfSwKCQkJCXNoaW5pbmVzczogeyB2YWx1ZTogMzAgfQoJCQl9CgkJXSApLAoKCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hwaG9uZ192ZXJ0LAoJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNocGhvbmdfZnJhZwoKCX0sCgoJc3RhbmRhcmQ6IHsKCgkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwoJCQlVbmlmb3Jtc0xpYi5jb21tb24sCgkJCVVuaWZvcm1zTGliLmVudm1hcCwKCQkJVW5pZm9ybXNMaWIuYW9tYXAsCgkJCVVuaWZvcm1zTGliLmxpZ2h0bWFwLAoJCQlVbmlmb3Jtc0xpYi5lbWlzc2l2ZW1hcCwKCQkJVW5pZm9ybXNMaWIuYnVtcG1hcCwKCQkJVW5pZm9ybXNMaWIubm9ybWFsbWFwLAoJCQlVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAsCgkJCVVuaWZvcm1zTGliLnJvdWdobmVzc21hcCwKCQkJVW5pZm9ybXNMaWIubWV0YWxuZXNzbWFwLAoJCQlVbmlmb3Jtc0xpYi5mb2csCgkJCVVuaWZvcm1zTGliLmxpZ2h0cywKCQkJewoJCQkJZW1pc3NpdmU6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweDAwMDAwMCApIH0sCgkJCQlyb3VnaG5lc3M6IHsgdmFsdWU6IDEuMCB9LAoJCQkJbWV0YWxuZXNzOiB7IHZhbHVlOiAwLjAgfSwKCQkJCWVudk1hcEludGVuc2l0eTogeyB2YWx1ZTogMSB9IC8vIHRlbXBvcmFyeQoJCQl9CgkJXSApLAoKCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hwaHlzaWNhbF92ZXJ0LAoJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNocGh5c2ljYWxfZnJhZwoKCX0sCgoJdG9vbjogewoKCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCgkJCVVuaWZvcm1zTGliLmNvbW1vbiwKCQkJVW5pZm9ybXNMaWIuYW9tYXAsCgkJCVVuaWZvcm1zTGliLmxpZ2h0bWFwLAoJCQlVbmlmb3Jtc0xpYi5lbWlzc2l2ZW1hcCwKCQkJVW5pZm9ybXNMaWIuYnVtcG1hcCwKCQkJVW5pZm9ybXNMaWIubm9ybWFsbWFwLAoJCQlVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAsCgkJCVVuaWZvcm1zTGliLmdyYWRpZW50bWFwLAoJCQlVbmlmb3Jtc0xpYi5mb2csCgkJCVVuaWZvcm1zTGliLmxpZ2h0cywKCQkJewoJCQkJZW1pc3NpdmU6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IENvbG9yKCAweDAwMDAwMCApIH0KCQkJfQoJCV0gKSwKCgkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNodG9vbl92ZXJ0LAoJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNodG9vbl9mcmFnCgoJfSwKCgltYXRjYXA6IHsKCgkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwoJCQlVbmlmb3Jtc0xpYi5jb21tb24sCgkJCVVuaWZvcm1zTGliLmJ1bXBtYXAsCgkJCVVuaWZvcm1zTGliLm5vcm1hbG1hcCwKCQkJVW5pZm9ybXNMaWIuZGlzcGxhY2VtZW50bWFwLAoJCQlVbmlmb3Jtc0xpYi5mb2csCgkJCXsKCQkJCW1hdGNhcDogeyB2YWx1ZTogbnVsbCB9CgkJCX0KCQldICksCgoJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaG1hdGNhcF92ZXJ0LAoJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5tZXNobWF0Y2FwX2ZyYWcKCgl9LAoKCXBvaW50czogewoKCQl1bmlmb3JtczogLypAX19QVVJFX18qLyBtZXJnZVVuaWZvcm1zKCBbCgkJCVVuaWZvcm1zTGliLnBvaW50cywKCQkJVW5pZm9ybXNMaWIuZm9nCgkJXSApLAoKCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLnBvaW50c192ZXJ0LAoJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5wb2ludHNfZnJhZwoKCX0sCgoJZGFzaGVkOiB7CgoJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKCQkJVW5pZm9ybXNMaWIuY29tbW9uLAoJCQlVbmlmb3Jtc0xpYi5mb2csCgkJCXsKCQkJCXNjYWxlOiB7IHZhbHVlOiAxIH0sCgkJCQlkYXNoU2l6ZTogeyB2YWx1ZTogMSB9LAoJCQkJdG90YWxTaXplOiB7IHZhbHVlOiAyIH0KCQkJfQoJCV0gKSwKCgkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5saW5lZGFzaGVkX3ZlcnQsCgkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLmxpbmVkYXNoZWRfZnJhZwoKCX0sCgoJZGVwdGg6IHsKCgkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwoJCQlVbmlmb3Jtc0xpYi5jb21tb24sCgkJCVVuaWZvcm1zTGliLmRpc3BsYWNlbWVudG1hcAoJCV0gKSwKCgkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5kZXB0aF92ZXJ0LAoJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5kZXB0aF9mcmFnCgoJfSwKCglub3JtYWw6IHsKCgkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwoJCQlVbmlmb3Jtc0xpYi5jb21tb24sCgkJCVVuaWZvcm1zTGliLmJ1bXBtYXAsCgkJCVVuaWZvcm1zTGliLm5vcm1hbG1hcCwKCQkJVW5pZm9ybXNMaWIuZGlzcGxhY2VtZW50bWFwLAoJCQl7CgkJCQlvcGFjaXR5OiB7IHZhbHVlOiAxLjAgfQoJCQl9CgkJXSApLAoKCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hub3JtYWxfdmVydCwKCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsubWVzaG5vcm1hbF9mcmFnCgoJfSwKCglzcHJpdGU6IHsKCgkJdW5pZm9ybXM6IC8qQF9fUFVSRV9fKi8gbWVyZ2VVbmlmb3JtcyggWwoJCQlVbmlmb3Jtc0xpYi5zcHJpdGUsCgkJCVVuaWZvcm1zTGliLmZvZwoJCV0gKSwKCgkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5zcHJpdGVfdmVydCwKCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuc3ByaXRlX2ZyYWcKCgl9LAoKCWJhY2tncm91bmQ6IHsKCgkJdW5pZm9ybXM6IHsKCQkJdXZUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCQl0MkQ6IHsgdmFsdWU6IG51bGwgfSwKCQkJYmFja2dyb3VuZEludGVuc2l0eTogeyB2YWx1ZTogMSB9CgkJfSwKCgkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5iYWNrZ3JvdW5kX3ZlcnQsCgkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLmJhY2tncm91bmRfZnJhZwoKCX0sCgoJYmFja2dyb3VuZEN1YmU6IHsKCgkJdW5pZm9ybXM6IHsKCQkJZW52TWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCWZsaXBFbnZNYXA6IHsgdmFsdWU6IC0gMSB9LAoJCQliYWNrZ3JvdW5kQmx1cnJpbmVzczogeyB2YWx1ZTogMCB9LAoJCQliYWNrZ3JvdW5kSW50ZW5zaXR5OiB7IHZhbHVlOiAxIH0KCQl9LAoKCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLmJhY2tncm91bmRDdWJlX3ZlcnQsCgkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLmJhY2tncm91bmRDdWJlX2ZyYWcKCgl9LAoKCWN1YmU6IHsKCgkJdW5pZm9ybXM6IHsKCQkJdEN1YmU6IHsgdmFsdWU6IG51bGwgfSwKCQkJdEZsaXA6IHsgdmFsdWU6IC0gMSB9LAoJCQlvcGFjaXR5OiB7IHZhbHVlOiAxLjAgfQoJCX0sCgoJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsuY3ViZV92ZXJ0LAoJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5jdWJlX2ZyYWcKCgl9LAoKCWVxdWlyZWN0OiB7CgoJCXVuaWZvcm1zOiB7CgkJCXRFcXVpcmVjdDogeyB2YWx1ZTogbnVsbCB9LAoJCX0sCgoJCXZlcnRleFNoYWRlcjogU2hhZGVyQ2h1bmsuZXF1aXJlY3RfdmVydCwKCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuZXF1aXJlY3RfZnJhZwoKCX0sCgoJZGlzdGFuY2VSR0JBOiB7CgoJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKCQkJVW5pZm9ybXNMaWIuY29tbW9uLAoJCQlVbmlmb3Jtc0xpYi5kaXNwbGFjZW1lbnRtYXAsCgkJCXsKCQkJCXJlZmVyZW5jZVBvc2l0aW9uOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCkgfSwKCQkJCW5lYXJEaXN0YW5jZTogeyB2YWx1ZTogMSB9LAoJCQkJZmFyRGlzdGFuY2U6IHsgdmFsdWU6IDEwMDAgfQoJCQl9CgkJXSApLAoKCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLmRpc3RhbmNlUkdCQV92ZXJ0LAoJCWZyYWdtZW50U2hhZGVyOiBTaGFkZXJDaHVuay5kaXN0YW5jZVJHQkFfZnJhZwoKCX0sCgoJc2hhZG93OiB7CgoJCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKCQkJVW5pZm9ybXNMaWIubGlnaHRzLAoJCQlVbmlmb3Jtc0xpYi5mb2csCgkJCXsKCQkJCWNvbG9yOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBDb2xvciggMHgwMDAwMCApIH0sCgkJCQlvcGFjaXR5OiB7IHZhbHVlOiAxLjAgfQoJCQl9LAoJCV0gKSwKCgkJdmVydGV4U2hhZGVyOiBTaGFkZXJDaHVuay5zaGFkb3dfdmVydCwKCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyQ2h1bmsuc2hhZG93X2ZyYWcKCgl9Cgp9OwoKU2hhZGVyTGliLnBoeXNpY2FsID0gewoKCXVuaWZvcm1zOiAvKkBfX1BVUkVfXyovIG1lcmdlVW5pZm9ybXMoIFsKCQlTaGFkZXJMaWIuc3RhbmRhcmQudW5pZm9ybXMsCgkJewoJCQljbGVhcmNvYXQ6IHsgdmFsdWU6IDAgfSwKCQkJY2xlYXJjb2F0TWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCWNsZWFyY29hdE1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgkJCWNsZWFyY29hdE5vcm1hbE1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQljbGVhcmNvYXROb3JtYWxNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCQljbGVhcmNvYXROb3JtYWxTY2FsZTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMiggMSwgMSApIH0sCgkJCWNsZWFyY29hdFJvdWdobmVzczogeyB2YWx1ZTogMCB9LAoJCQljbGVhcmNvYXRSb3VnaG5lc3NNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJY2xlYXJjb2F0Um91Z2huZXNzTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJaXJpZGVzY2VuY2U6IHsgdmFsdWU6IDAgfSwKCQkJaXJpZGVzY2VuY2VNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJaXJpZGVzY2VuY2VNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCQlpcmlkZXNjZW5jZUlPUjogeyB2YWx1ZTogMS4zIH0sCgkJCWlyaWRlc2NlbmNlVGhpY2tuZXNzTWluaW11bTogeyB2YWx1ZTogMTAwIH0sCgkJCWlyaWRlc2NlbmNlVGhpY2tuZXNzTWF4aW11bTogeyB2YWx1ZTogNDAwIH0sCgkJCWlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCWlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJc2hlZW46IHsgdmFsdWU6IDAgfSwKCQkJc2hlZW5Db2xvcjogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4MDAwMDAwICkgfSwKCQkJc2hlZW5Db2xvck1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQlzaGVlbkNvbG9yTWFwVHJhbnNmb3JtOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXgzKCkgfSwKCQkJc2hlZW5Sb3VnaG5lc3M6IHsgdmFsdWU6IDEgfSwKCQkJc2hlZW5Sb3VnaG5lc3NNYXA6IHsgdmFsdWU6IG51bGwgfSwKCQkJc2hlZW5Sb3VnaG5lc3NNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCQl0cmFuc21pc3Npb246IHsgdmFsdWU6IDAgfSwKCQkJdHJhbnNtaXNzaW9uTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCXRyYW5zbWlzc2lvbk1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgkJCXRyYW5zbWlzc2lvblNhbXBsZXJTaXplOiB7IHZhbHVlOiAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IyKCkgfSwKCQkJdHJhbnNtaXNzaW9uU2FtcGxlck1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQl0aGlja25lc3M6IHsgdmFsdWU6IDAgfSwKCQkJdGhpY2tuZXNzTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCXRoaWNrbmVzc01hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgkJCWF0dGVudWF0aW9uRGlzdGFuY2U6IHsgdmFsdWU6IDAgfSwKCQkJYXR0ZW51YXRpb25Db2xvcjogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDB4MDAwMDAwICkgfSwKCQkJc3BlY3VsYXJDb2xvcjogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgQ29sb3IoIDEsIDEsIDEgKSB9LAoJCQlzcGVjdWxhckNvbG9yTWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCXNwZWN1bGFyQ29sb3JNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCQlzcGVjdWxhckludGVuc2l0eTogeyB2YWx1ZTogMSB9LAoJCQlzcGVjdWxhckludGVuc2l0eU1hcDogeyB2YWx1ZTogbnVsbCB9LAoJCQlzcGVjdWxhckludGVuc2l0eU1hcFRyYW5zZm9ybTogeyB2YWx1ZTogLypAX19QVVJFX18qLyBuZXcgTWF0cml4MygpIH0sCgkJCWFuaXNvdHJvcHlWZWN0b3I6IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjIoKSB9LAoJCQlhbmlzb3Ryb3B5TWFwOiB7IHZhbHVlOiBudWxsIH0sCgkJCWFuaXNvdHJvcHlNYXBUcmFuc2Zvcm06IHsgdmFsdWU6IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDMoKSB9LAoJCX0KCV0gKSwKCgl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hwaHlzaWNhbF92ZXJ0LAoJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckNodW5rLm1lc2hwaHlzaWNhbF9mcmFnCgp9OwoKY29uc3QgX3JnYiA9IHsgcjogMCwgYjogMCwgZzogMCB9OwoKZnVuY3Rpb24gV2ViR0xCYWNrZ3JvdW5kKCByZW5kZXJlciwgY3ViZW1hcHMsIGN1YmV1dm1hcHMsIHN0YXRlLCBvYmplY3RzLCBhbHBoYSwgcHJlbXVsdGlwbGllZEFscGhhICkgewoKCWNvbnN0IGNsZWFyQ29sb3IgPSBuZXcgQ29sb3IoIDB4MDAwMDAwICk7CglsZXQgY2xlYXJBbHBoYSA9IGFscGhhID09PSB0cnVlID8gMCA6IDE7CgoJbGV0IHBsYW5lTWVzaDsKCWxldCBib3hNZXNoOwoKCWxldCBjdXJyZW50QmFja2dyb3VuZCA9IG51bGw7CglsZXQgY3VycmVudEJhY2tncm91bmRWZXJzaW9uID0gMDsKCWxldCBjdXJyZW50VG9uZW1hcHBpbmcgPSBudWxsOwoKCWZ1bmN0aW9uIHJlbmRlciggcmVuZGVyTGlzdCwgc2NlbmUgKSB7CgoJCWxldCBmb3JjZUNsZWFyID0gZmFsc2U7CgkJbGV0IGJhY2tncm91bmQgPSBzY2VuZS5pc1NjZW5lID09PSB0cnVlID8gc2NlbmUuYmFja2dyb3VuZCA6IG51bGw7CgoJCWlmICggYmFja2dyb3VuZCAmJiBiYWNrZ3JvdW5kLmlzVGV4dHVyZSApIHsKCgkJCWNvbnN0IHVzZVBNUkVNID0gc2NlbmUuYmFja2dyb3VuZEJsdXJyaW5lc3MgPiAwOyAvLyB1c2UgUE1SRU0gaWYgdGhlIHVzZXIgd2FudHMgdG8gYmx1ciB0aGUgYmFja2dyb3VuZAoJCQliYWNrZ3JvdW5kID0gKCB1c2VQTVJFTSA/IGN1YmV1dm1hcHMgOiBjdWJlbWFwcyApLmdldCggYmFja2dyb3VuZCApOwoKCQl9CgoJCWlmICggYmFja2dyb3VuZCA9PT0gbnVsbCApIHsKCgkJCXNldENsZWFyKCBjbGVhckNvbG9yLCBjbGVhckFscGhhICk7CgoJCX0gZWxzZSBpZiAoIGJhY2tncm91bmQgJiYgYmFja2dyb3VuZC5pc0NvbG9yICkgewoKCQkJc2V0Q2xlYXIoIGJhY2tncm91bmQsIDEgKTsKCQkJZm9yY2VDbGVhciA9IHRydWU7CgoJCX0KCgkJY29uc3QgZW52aXJvbm1lbnRCbGVuZE1vZGUgPSByZW5kZXJlci54ci5nZXRFbnZpcm9ubWVudEJsZW5kTW9kZSgpOwoKCQlpZiAoIGVudmlyb25tZW50QmxlbmRNb2RlID09PSAnYWRkaXRpdmUnICkgewoKCQkJc3RhdGUuYnVmZmVycy5jb2xvci5zZXRDbGVhciggMCwgMCwgMCwgMSwgcHJlbXVsdGlwbGllZEFscGhhICk7CgoJCX0gZWxzZSBpZiAoIGVudmlyb25tZW50QmxlbmRNb2RlID09PSAnYWxwaGEtYmxlbmQnICkgewoKCQkJc3RhdGUuYnVmZmVycy5jb2xvci5zZXRDbGVhciggMCwgMCwgMCwgMCwgcHJlbXVsdGlwbGllZEFscGhhICk7CgoJCX0KCgkJaWYgKCByZW5kZXJlci5hdXRvQ2xlYXIgfHwgZm9yY2VDbGVhciApIHsKCgkJCXJlbmRlcmVyLmNsZWFyKCByZW5kZXJlci5hdXRvQ2xlYXJDb2xvciwgcmVuZGVyZXIuYXV0b0NsZWFyRGVwdGgsIHJlbmRlcmVyLmF1dG9DbGVhclN0ZW5jaWwgKTsKCgkJfQoKCQlpZiAoIGJhY2tncm91bmQgJiYgKCBiYWNrZ3JvdW5kLmlzQ3ViZVRleHR1cmUgfHwgYmFja2dyb3VuZC5tYXBwaW5nID09PSBDdWJlVVZSZWZsZWN0aW9uTWFwcGluZyApICkgewoKCQkJaWYgKCBib3hNZXNoID09PSB1bmRlZmluZWQgKSB7CgoJCQkJYm94TWVzaCA9IG5ldyBNZXNoKAoJCQkJCW5ldyBCb3hHZW9tZXRyeSggMSwgMSwgMSApLAoJCQkJCW5ldyBTaGFkZXJNYXRlcmlhbCggewoJCQkJCQluYW1lOiAnQmFja2dyb3VuZEN1YmVNYXRlcmlhbCcsCgkJCQkJCXVuaWZvcm1zOiBjbG9uZVVuaWZvcm1zKCBTaGFkZXJMaWIuYmFja2dyb3VuZEN1YmUudW5pZm9ybXMgKSwKCQkJCQkJdmVydGV4U2hhZGVyOiBTaGFkZXJMaWIuYmFja2dyb3VuZEN1YmUudmVydGV4U2hhZGVyLAoJCQkJCQlmcmFnbWVudFNoYWRlcjogU2hhZGVyTGliLmJhY2tncm91bmRDdWJlLmZyYWdtZW50U2hhZGVyLAoJCQkJCQlzaWRlOiBCYWNrU2lkZSwKCQkJCQkJZGVwdGhUZXN0OiBmYWxzZSwKCQkJCQkJZGVwdGhXcml0ZTogZmFsc2UsCgkJCQkJCWZvZzogZmFsc2UKCQkJCQl9ICkKCQkJCSk7CgoJCQkJYm94TWVzaC5nZW9tZXRyeS5kZWxldGVBdHRyaWJ1dGUoICdub3JtYWwnICk7CgkJCQlib3hNZXNoLmdlb21ldHJ5LmRlbGV0ZUF0dHJpYnV0ZSggJ3V2JyApOwoKCQkJCWJveE1lc2gub25CZWZvcmVSZW5kZXIgPSBmdW5jdGlvbiAoIHJlbmRlcmVyLCBzY2VuZSwgY2FtZXJhICkgewoKCQkJCQl0aGlzLm1hdHJpeFdvcmxkLmNvcHlQb3NpdGlvbiggY2FtZXJhLm1hdHJpeFdvcmxkICk7CgoJCQkJfTsKCgkJCQkvLyBhZGQgImVudk1hcCIgbWF0ZXJpYWwgcHJvcGVydHkgc28gdGhlIHJlbmRlcmVyIGNhbiBldmFsdWF0ZSBpdCBsaWtlIGZvciBidWlsdC1pbiBtYXRlcmlhbHMKCQkJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eSggYm94TWVzaC5tYXRlcmlhbCwgJ2Vudk1hcCcsIHsKCgkJCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJCQlyZXR1cm4gdGhpcy51bmlmb3Jtcy5lbnZNYXAudmFsdWU7CgoJCQkJCX0KCgkJCQl9ICk7CgoJCQkJb2JqZWN0cy51cGRhdGUoIGJveE1lc2ggKTsKCgkJCX0KCgkJCWJveE1lc2gubWF0ZXJpYWwudW5pZm9ybXMuZW52TWFwLnZhbHVlID0gYmFja2dyb3VuZDsKCQkJYm94TWVzaC5tYXRlcmlhbC51bmlmb3Jtcy5mbGlwRW52TWFwLnZhbHVlID0gKCBiYWNrZ3JvdW5kLmlzQ3ViZVRleHR1cmUgJiYgYmFja2dyb3VuZC5pc1JlbmRlclRhcmdldFRleHR1cmUgPT09IGZhbHNlICkgPyAtIDEgOiAxOwoJCQlib3hNZXNoLm1hdGVyaWFsLnVuaWZvcm1zLmJhY2tncm91bmRCbHVycmluZXNzLnZhbHVlID0gc2NlbmUuYmFja2dyb3VuZEJsdXJyaW5lc3M7CgkJCWJveE1lc2gubWF0ZXJpYWwudW5pZm9ybXMuYmFja2dyb3VuZEludGVuc2l0eS52YWx1ZSA9IHNjZW5lLmJhY2tncm91bmRJbnRlbnNpdHk7CgkJCWJveE1lc2gubWF0ZXJpYWwudG9uZU1hcHBlZCA9IENvbG9yTWFuYWdlbWVudC5nZXRUcmFuc2ZlciggYmFja2dyb3VuZC5jb2xvclNwYWNlICkgIT09IFNSR0JUcmFuc2ZlcjsKCgkJCWlmICggY3VycmVudEJhY2tncm91bmQgIT09IGJhY2tncm91bmQgfHwKCQkJCWN1cnJlbnRCYWNrZ3JvdW5kVmVyc2lvbiAhPT0gYmFja2dyb3VuZC52ZXJzaW9uIHx8CgkJCQljdXJyZW50VG9uZW1hcHBpbmcgIT09IHJlbmRlcmVyLnRvbmVNYXBwaW5nICkgewoKCQkJCWJveE1lc2gubWF0ZXJpYWwubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCWN1cnJlbnRCYWNrZ3JvdW5kID0gYmFja2dyb3VuZDsKCQkJCWN1cnJlbnRCYWNrZ3JvdW5kVmVyc2lvbiA9IGJhY2tncm91bmQudmVyc2lvbjsKCQkJCWN1cnJlbnRUb25lbWFwcGluZyA9IHJlbmRlcmVyLnRvbmVNYXBwaW5nOwoKCQkJfQoKCQkJYm94TWVzaC5sYXllcnMuZW5hYmxlQWxsKCk7CgoJCQkvLyBwdXNoIHRvIHRoZSBwcmUtc29ydGVkIG9wYXF1ZSByZW5kZXIgbGlzdAoJCQlyZW5kZXJMaXN0LnVuc2hpZnQoIGJveE1lc2gsIGJveE1lc2guZ2VvbWV0cnksIGJveE1lc2gubWF0ZXJpYWwsIDAsIDAsIG51bGwgKTsKCgkJfSBlbHNlIGlmICggYmFja2dyb3VuZCAmJiBiYWNrZ3JvdW5kLmlzVGV4dHVyZSApIHsKCgkJCWlmICggcGxhbmVNZXNoID09PSB1bmRlZmluZWQgKSB7CgoJCQkJcGxhbmVNZXNoID0gbmV3IE1lc2goCgkJCQkJbmV3IFBsYW5lR2VvbWV0cnkoIDIsIDIgKSwKCQkJCQluZXcgU2hhZGVyTWF0ZXJpYWwoIHsKCQkJCQkJbmFtZTogJ0JhY2tncm91bmRNYXRlcmlhbCcsCgkJCQkJCXVuaWZvcm1zOiBjbG9uZVVuaWZvcm1zKCBTaGFkZXJMaWIuYmFja2dyb3VuZC51bmlmb3JtcyApLAoJCQkJCQl2ZXJ0ZXhTaGFkZXI6IFNoYWRlckxpYi5iYWNrZ3JvdW5kLnZlcnRleFNoYWRlciwKCQkJCQkJZnJhZ21lbnRTaGFkZXI6IFNoYWRlckxpYi5iYWNrZ3JvdW5kLmZyYWdtZW50U2hhZGVyLAoJCQkJCQlzaWRlOiBGcm9udFNpZGUsCgkJCQkJCWRlcHRoVGVzdDogZmFsc2UsCgkJCQkJCWRlcHRoV3JpdGU6IGZhbHNlLAoJCQkJCQlmb2c6IGZhbHNlCgkJCQkJfSApCgkJCQkpOwoKCQkJCXBsYW5lTWVzaC5nZW9tZXRyeS5kZWxldGVBdHRyaWJ1dGUoICdub3JtYWwnICk7CgoJCQkJLy8gYWRkICJtYXAiIG1hdGVyaWFsIHByb3BlcnR5IHNvIHRoZSByZW5kZXJlciBjYW4gZXZhbHVhdGUgaXQgbGlrZSBmb3IgYnVpbHQtaW4gbWF0ZXJpYWxzCgkJCQlPYmplY3QuZGVmaW5lUHJvcGVydHkoIHBsYW5lTWVzaC5tYXRlcmlhbCwgJ21hcCcsIHsKCgkJCQkJZ2V0OiBmdW5jdGlvbiAoKSB7CgoJCQkJCQlyZXR1cm4gdGhpcy51bmlmb3Jtcy50MkQudmFsdWU7CgoJCQkJCX0KCgkJCQl9ICk7CgoJCQkJb2JqZWN0cy51cGRhdGUoIHBsYW5lTWVzaCApOwoKCQkJfQoKCQkJcGxhbmVNZXNoLm1hdGVyaWFsLnVuaWZvcm1zLnQyRC52YWx1ZSA9IGJhY2tncm91bmQ7CgkJCXBsYW5lTWVzaC5tYXRlcmlhbC51bmlmb3Jtcy5iYWNrZ3JvdW5kSW50ZW5zaXR5LnZhbHVlID0gc2NlbmUuYmFja2dyb3VuZEludGVuc2l0eTsKCQkJcGxhbmVNZXNoLm1hdGVyaWFsLnRvbmVNYXBwZWQgPSBDb2xvck1hbmFnZW1lbnQuZ2V0VHJhbnNmZXIoIGJhY2tncm91bmQuY29sb3JTcGFjZSApICE9PSBTUkdCVHJhbnNmZXI7CgoJCQlpZiAoIGJhY2tncm91bmQubWF0cml4QXV0b1VwZGF0ZSA9PT0gdHJ1ZSApIHsKCgkJCQliYWNrZ3JvdW5kLnVwZGF0ZU1hdHJpeCgpOwoKCQkJfQoKCQkJcGxhbmVNZXNoLm1hdGVyaWFsLnVuaWZvcm1zLnV2VHJhbnNmb3JtLnZhbHVlLmNvcHkoIGJhY2tncm91bmQubWF0cml4ICk7CgoJCQlpZiAoIGN1cnJlbnRCYWNrZ3JvdW5kICE9PSBiYWNrZ3JvdW5kIHx8CgkJCQljdXJyZW50QmFja2dyb3VuZFZlcnNpb24gIT09IGJhY2tncm91bmQudmVyc2lvbiB8fAoJCQkJY3VycmVudFRvbmVtYXBwaW5nICE9PSByZW5kZXJlci50b25lTWFwcGluZyApIHsKCgkJCQlwbGFuZU1lc2gubWF0ZXJpYWwubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCWN1cnJlbnRCYWNrZ3JvdW5kID0gYmFja2dyb3VuZDsKCQkJCWN1cnJlbnRCYWNrZ3JvdW5kVmVyc2lvbiA9IGJhY2tncm91bmQudmVyc2lvbjsKCQkJCWN1cnJlbnRUb25lbWFwcGluZyA9IHJlbmRlcmVyLnRvbmVNYXBwaW5nOwoKCQkJfQoKCQkJcGxhbmVNZXNoLmxheWVycy5lbmFibGVBbGwoKTsKCgkJCS8vIHB1c2ggdG8gdGhlIHByZS1zb3J0ZWQgb3BhcXVlIHJlbmRlciBsaXN0CgkJCXJlbmRlckxpc3QudW5zaGlmdCggcGxhbmVNZXNoLCBwbGFuZU1lc2guZ2VvbWV0cnksIHBsYW5lTWVzaC5tYXRlcmlhbCwgMCwgMCwgbnVsbCApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHNldENsZWFyKCBjb2xvciwgYWxwaGEgKSB7CgoJCWNvbG9yLmdldFJHQiggX3JnYiwgZ2V0VW5saXRVbmlmb3JtQ29sb3JTcGFjZSggcmVuZGVyZXIgKSApOwoKCQlzdGF0ZS5idWZmZXJzLmNvbG9yLnNldENsZWFyKCBfcmdiLnIsIF9yZ2IuZywgX3JnYi5iLCBhbHBoYSwgcHJlbXVsdGlwbGllZEFscGhhICk7CgoJfQoKCXJldHVybiB7CgoJCWdldENsZWFyQ29sb3I6IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBjbGVhckNvbG9yOwoKCQl9LAoJCXNldENsZWFyQ29sb3I6IGZ1bmN0aW9uICggY29sb3IsIGFscGhhID0gMSApIHsKCgkJCWNsZWFyQ29sb3Iuc2V0KCBjb2xvciApOwoJCQljbGVhckFscGhhID0gYWxwaGE7CgkJCXNldENsZWFyKCBjbGVhckNvbG9yLCBjbGVhckFscGhhICk7CgoJCX0sCgkJZ2V0Q2xlYXJBbHBoYTogZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIGNsZWFyQWxwaGE7CgoJCX0sCgkJc2V0Q2xlYXJBbHBoYTogZnVuY3Rpb24gKCBhbHBoYSApIHsKCgkJCWNsZWFyQWxwaGEgPSBhbHBoYTsKCQkJc2V0Q2xlYXIoIGNsZWFyQ29sb3IsIGNsZWFyQWxwaGEgKTsKCgkJfSwKCQlyZW5kZXI6IHJlbmRlcgoKCX07Cgp9CgpmdW5jdGlvbiBXZWJHTEJpbmRpbmdTdGF0ZXMoIGdsLCBleHRlbnNpb25zLCBhdHRyaWJ1dGVzLCBjYXBhYmlsaXRpZXMgKSB7CgoJY29uc3QgbWF4VmVydGV4QXR0cmlidXRlcyA9IGdsLmdldFBhcmFtZXRlciggZ2wuTUFYX1ZFUlRFWF9BVFRSSUJTICk7CgoJY29uc3QgZXh0ZW5zaW9uID0gY2FwYWJpbGl0aWVzLmlzV2ViR0wyID8gbnVsbCA6IGV4dGVuc2lvbnMuZ2V0KCAnT0VTX3ZlcnRleF9hcnJheV9vYmplY3QnICk7Cgljb25zdCB2YW9BdmFpbGFibGUgPSBjYXBhYmlsaXRpZXMuaXNXZWJHTDIgfHwgZXh0ZW5zaW9uICE9PSBudWxsOwoKCWNvbnN0IGJpbmRpbmdTdGF0ZXMgPSB7fTsKCgljb25zdCBkZWZhdWx0U3RhdGUgPSBjcmVhdGVCaW5kaW5nU3RhdGUoIG51bGwgKTsKCWxldCBjdXJyZW50U3RhdGUgPSBkZWZhdWx0U3RhdGU7CglsZXQgZm9yY2VVcGRhdGUgPSBmYWxzZTsKCglmdW5jdGlvbiBzZXR1cCggb2JqZWN0LCBtYXRlcmlhbCwgcHJvZ3JhbSwgZ2VvbWV0cnksIGluZGV4ICkgewoKCQlsZXQgdXBkYXRlQnVmZmVycyA9IGZhbHNlOwoKCQlpZiAoIHZhb0F2YWlsYWJsZSApIHsKCgkJCWNvbnN0IHN0YXRlID0gZ2V0QmluZGluZ1N0YXRlKCBnZW9tZXRyeSwgcHJvZ3JhbSwgbWF0ZXJpYWwgKTsKCgkJCWlmICggY3VycmVudFN0YXRlICE9PSBzdGF0ZSApIHsKCgkJCQljdXJyZW50U3RhdGUgPSBzdGF0ZTsKCQkJCWJpbmRWZXJ0ZXhBcnJheU9iamVjdCggY3VycmVudFN0YXRlLm9iamVjdCApOwoKCQkJfQoKCQkJdXBkYXRlQnVmZmVycyA9IG5lZWRzVXBkYXRlKCBvYmplY3QsIGdlb21ldHJ5LCBwcm9ncmFtLCBpbmRleCApOwoKCQkJaWYgKCB1cGRhdGVCdWZmZXJzICkgc2F2ZUNhY2hlKCBvYmplY3QsIGdlb21ldHJ5LCBwcm9ncmFtLCBpbmRleCApOwoKCQl9IGVsc2UgewoKCQkJY29uc3Qgd2lyZWZyYW1lID0gKCBtYXRlcmlhbC53aXJlZnJhbWUgPT09IHRydWUgKTsKCgkJCWlmICggY3VycmVudFN0YXRlLmdlb21ldHJ5ICE9PSBnZW9tZXRyeS5pZCB8fAoJCQkJY3VycmVudFN0YXRlLnByb2dyYW0gIT09IHByb2dyYW0uaWQgfHwKCQkJCWN1cnJlbnRTdGF0ZS53aXJlZnJhbWUgIT09IHdpcmVmcmFtZSApIHsKCgkJCQljdXJyZW50U3RhdGUuZ2VvbWV0cnkgPSBnZW9tZXRyeS5pZDsKCQkJCWN1cnJlbnRTdGF0ZS5wcm9ncmFtID0gcHJvZ3JhbS5pZDsKCQkJCWN1cnJlbnRTdGF0ZS53aXJlZnJhbWUgPSB3aXJlZnJhbWU7CgoJCQkJdXBkYXRlQnVmZmVycyA9IHRydWU7CgoJCQl9CgoJCX0KCgkJaWYgKCBpbmRleCAhPT0gbnVsbCApIHsKCgkJCWF0dHJpYnV0ZXMudXBkYXRlKCBpbmRleCwgZ2wuRUxFTUVOVF9BUlJBWV9CVUZGRVIgKTsKCgkJfQoKCQlpZiAoIHVwZGF0ZUJ1ZmZlcnMgfHwgZm9yY2VVcGRhdGUgKSB7CgoJCQlmb3JjZVVwZGF0ZSA9IGZhbHNlOwoKCQkJc2V0dXBWZXJ0ZXhBdHRyaWJ1dGVzKCBvYmplY3QsIG1hdGVyaWFsLCBwcm9ncmFtLCBnZW9tZXRyeSApOwoKCQkJaWYgKCBpbmRleCAhPT0gbnVsbCApIHsKCgkJCQlnbC5iaW5kQnVmZmVyKCBnbC5FTEVNRU5UX0FSUkFZX0JVRkZFUiwgYXR0cmlidXRlcy5nZXQoIGluZGV4ICkuYnVmZmVyICk7CgoJCQl9CgoJCX0KCgl9CgoJZnVuY3Rpb24gY3JlYXRlVmVydGV4QXJyYXlPYmplY3QoKSB7CgoJCWlmICggY2FwYWJpbGl0aWVzLmlzV2ViR0wyICkgcmV0dXJuIGdsLmNyZWF0ZVZlcnRleEFycmF5KCk7CgoJCXJldHVybiBleHRlbnNpb24uY3JlYXRlVmVydGV4QXJyYXlPRVMoKTsKCgl9CgoJZnVuY3Rpb24gYmluZFZlcnRleEFycmF5T2JqZWN0KCB2YW8gKSB7CgoJCWlmICggY2FwYWJpbGl0aWVzLmlzV2ViR0wyICkgcmV0dXJuIGdsLmJpbmRWZXJ0ZXhBcnJheSggdmFvICk7CgoJCXJldHVybiBleHRlbnNpb24uYmluZFZlcnRleEFycmF5T0VTKCB2YW8gKTsKCgl9CgoJZnVuY3Rpb24gZGVsZXRlVmVydGV4QXJyYXlPYmplY3QoIHZhbyApIHsKCgkJaWYgKCBjYXBhYmlsaXRpZXMuaXNXZWJHTDIgKSByZXR1cm4gZ2wuZGVsZXRlVmVydGV4QXJyYXkoIHZhbyApOwoKCQlyZXR1cm4gZXh0ZW5zaW9uLmRlbGV0ZVZlcnRleEFycmF5T0VTKCB2YW8gKTsKCgl9CgoJZnVuY3Rpb24gZ2V0QmluZGluZ1N0YXRlKCBnZW9tZXRyeSwgcHJvZ3JhbSwgbWF0ZXJpYWwgKSB7CgoJCWNvbnN0IHdpcmVmcmFtZSA9ICggbWF0ZXJpYWwud2lyZWZyYW1lID09PSB0cnVlICk7CgoJCWxldCBwcm9ncmFtTWFwID0gYmluZGluZ1N0YXRlc1sgZ2VvbWV0cnkuaWQgXTsKCgkJaWYgKCBwcm9ncmFtTWFwID09PSB1bmRlZmluZWQgKSB7CgoJCQlwcm9ncmFtTWFwID0ge307CgkJCWJpbmRpbmdTdGF0ZXNbIGdlb21ldHJ5LmlkIF0gPSBwcm9ncmFtTWFwOwoKCQl9CgoJCWxldCBzdGF0ZU1hcCA9IHByb2dyYW1NYXBbIHByb2dyYW0uaWQgXTsKCgkJaWYgKCBzdGF0ZU1hcCA9PT0gdW5kZWZpbmVkICkgewoKCQkJc3RhdGVNYXAgPSB7fTsKCQkJcHJvZ3JhbU1hcFsgcHJvZ3JhbS5pZCBdID0gc3RhdGVNYXA7CgoJCX0KCgkJbGV0IHN0YXRlID0gc3RhdGVNYXBbIHdpcmVmcmFtZSBdOwoKCQlpZiAoIHN0YXRlID09PSB1bmRlZmluZWQgKSB7CgoJCQlzdGF0ZSA9IGNyZWF0ZUJpbmRpbmdTdGF0ZSggY3JlYXRlVmVydGV4QXJyYXlPYmplY3QoKSApOwoJCQlzdGF0ZU1hcFsgd2lyZWZyYW1lIF0gPSBzdGF0ZTsKCgkJfQoKCQlyZXR1cm4gc3RhdGU7CgoJfQoKCWZ1bmN0aW9uIGNyZWF0ZUJpbmRpbmdTdGF0ZSggdmFvICkgewoKCQljb25zdCBuZXdBdHRyaWJ1dGVzID0gW107CgkJY29uc3QgZW5hYmxlZEF0dHJpYnV0ZXMgPSBbXTsKCQljb25zdCBhdHRyaWJ1dGVEaXZpc29ycyA9IFtdOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBtYXhWZXJ0ZXhBdHRyaWJ1dGVzOyBpICsrICkgewoKCQkJbmV3QXR0cmlidXRlc1sgaSBdID0gMDsKCQkJZW5hYmxlZEF0dHJpYnV0ZXNbIGkgXSA9IDA7CgkJCWF0dHJpYnV0ZURpdmlzb3JzWyBpIF0gPSAwOwoKCQl9CgoJCXJldHVybiB7CgoJCQkvLyBmb3IgYmFja3dhcmQgY29tcGF0aWJpbGl0eSBvbiBub24tVkFPIHN1cHBvcnQgYnJvd3NlcgoJCQlnZW9tZXRyeTogbnVsbCwKCQkJcHJvZ3JhbTogbnVsbCwKCQkJd2lyZWZyYW1lOiBmYWxzZSwKCgkJCW5ld0F0dHJpYnV0ZXM6IG5ld0F0dHJpYnV0ZXMsCgkJCWVuYWJsZWRBdHRyaWJ1dGVzOiBlbmFibGVkQXR0cmlidXRlcywKCQkJYXR0cmlidXRlRGl2aXNvcnM6IGF0dHJpYnV0ZURpdmlzb3JzLAoJCQlvYmplY3Q6IHZhbywKCQkJYXR0cmlidXRlczoge30sCgkJCWluZGV4OiBudWxsCgoJCX07CgoJfQoKCWZ1bmN0aW9uIG5lZWRzVXBkYXRlKCBvYmplY3QsIGdlb21ldHJ5LCBwcm9ncmFtLCBpbmRleCApIHsKCgkJY29uc3QgY2FjaGVkQXR0cmlidXRlcyA9IGN1cnJlbnRTdGF0ZS5hdHRyaWJ1dGVzOwoJCWNvbnN0IGdlb21ldHJ5QXR0cmlidXRlcyA9IGdlb21ldHJ5LmF0dHJpYnV0ZXM7CgoJCWxldCBhdHRyaWJ1dGVzTnVtID0gMDsKCgkJY29uc3QgcHJvZ3JhbUF0dHJpYnV0ZXMgPSBwcm9ncmFtLmdldEF0dHJpYnV0ZXMoKTsKCgkJZm9yICggY29uc3QgbmFtZSBpbiBwcm9ncmFtQXR0cmlidXRlcyApIHsKCgkJCWNvbnN0IHByb2dyYW1BdHRyaWJ1dGUgPSBwcm9ncmFtQXR0cmlidXRlc1sgbmFtZSBdOwoKCQkJaWYgKCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uID49IDAgKSB7CgoJCQkJY29uc3QgY2FjaGVkQXR0cmlidXRlID0gY2FjaGVkQXR0cmlidXRlc1sgbmFtZSBdOwoJCQkJbGV0IGdlb21ldHJ5QXR0cmlidXRlID0gZ2VvbWV0cnlBdHRyaWJ1dGVzWyBuYW1lIF07CgoJCQkJaWYgKCBnZW9tZXRyeUF0dHJpYnV0ZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQlpZiAoIG5hbWUgPT09ICdpbnN0YW5jZU1hdHJpeCcgJiYgb2JqZWN0Lmluc3RhbmNlTWF0cml4ICkgZ2VvbWV0cnlBdHRyaWJ1dGUgPSBvYmplY3QuaW5zdGFuY2VNYXRyaXg7CgkJCQkJaWYgKCBuYW1lID09PSAnaW5zdGFuY2VDb2xvcicgJiYgb2JqZWN0Lmluc3RhbmNlQ29sb3IgKSBnZW9tZXRyeUF0dHJpYnV0ZSA9IG9iamVjdC5pbnN0YW5jZUNvbG9yOwoKCQkJCX0KCgkJCQlpZiAoIGNhY2hlZEF0dHJpYnV0ZSA9PT0gdW5kZWZpbmVkICkgcmV0dXJuIHRydWU7CgoJCQkJaWYgKCBjYWNoZWRBdHRyaWJ1dGUuYXR0cmlidXRlICE9PSBnZW9tZXRyeUF0dHJpYnV0ZSApIHJldHVybiB0cnVlOwoKCQkJCWlmICggZ2VvbWV0cnlBdHRyaWJ1dGUgJiYgY2FjaGVkQXR0cmlidXRlLmRhdGEgIT09IGdlb21ldHJ5QXR0cmlidXRlLmRhdGEgKSByZXR1cm4gdHJ1ZTsKCgkJCQlhdHRyaWJ1dGVzTnVtICsrOwoKCQkJfQoKCQl9CgoJCWlmICggY3VycmVudFN0YXRlLmF0dHJpYnV0ZXNOdW0gIT09IGF0dHJpYnV0ZXNOdW0gKSByZXR1cm4gdHJ1ZTsKCgkJaWYgKCBjdXJyZW50U3RhdGUuaW5kZXggIT09IGluZGV4ICkgcmV0dXJuIHRydWU7CgoJCXJldHVybiBmYWxzZTsKCgl9CgoJZnVuY3Rpb24gc2F2ZUNhY2hlKCBvYmplY3QsIGdlb21ldHJ5LCBwcm9ncmFtLCBpbmRleCApIHsKCgkJY29uc3QgY2FjaGUgPSB7fTsKCQljb25zdCBhdHRyaWJ1dGVzID0gZ2VvbWV0cnkuYXR0cmlidXRlczsKCQlsZXQgYXR0cmlidXRlc051bSA9IDA7CgoJCWNvbnN0IHByb2dyYW1BdHRyaWJ1dGVzID0gcHJvZ3JhbS5nZXRBdHRyaWJ1dGVzKCk7CgoJCWZvciAoIGNvbnN0IG5hbWUgaW4gcHJvZ3JhbUF0dHJpYnV0ZXMgKSB7CgoJCQljb25zdCBwcm9ncmFtQXR0cmlidXRlID0gcHJvZ3JhbUF0dHJpYnV0ZXNbIG5hbWUgXTsKCgkJCWlmICggcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiA+PSAwICkgewoKCQkJCWxldCBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzWyBuYW1lIF07CgoJCQkJaWYgKCBhdHRyaWJ1dGUgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJaWYgKCBuYW1lID09PSAnaW5zdGFuY2VNYXRyaXgnICYmIG9iamVjdC5pbnN0YW5jZU1hdHJpeCApIGF0dHJpYnV0ZSA9IG9iamVjdC5pbnN0YW5jZU1hdHJpeDsKCQkJCQlpZiAoIG5hbWUgPT09ICdpbnN0YW5jZUNvbG9yJyAmJiBvYmplY3QuaW5zdGFuY2VDb2xvciApIGF0dHJpYnV0ZSA9IG9iamVjdC5pbnN0YW5jZUNvbG9yOwoKCQkJCX0KCgkJCQljb25zdCBkYXRhID0ge307CgkJCQlkYXRhLmF0dHJpYnV0ZSA9IGF0dHJpYnV0ZTsKCgkJCQlpZiAoIGF0dHJpYnV0ZSAmJiBhdHRyaWJ1dGUuZGF0YSApIHsKCgkJCQkJZGF0YS5kYXRhID0gYXR0cmlidXRlLmRhdGE7CgoJCQkJfQoKCQkJCWNhY2hlWyBuYW1lIF0gPSBkYXRhOwoKCQkJCWF0dHJpYnV0ZXNOdW0gKys7CgoJCQl9CgoJCX0KCgkJY3VycmVudFN0YXRlLmF0dHJpYnV0ZXMgPSBjYWNoZTsKCQljdXJyZW50U3RhdGUuYXR0cmlidXRlc051bSA9IGF0dHJpYnV0ZXNOdW07CgoJCWN1cnJlbnRTdGF0ZS5pbmRleCA9IGluZGV4OwoKCX0KCglmdW5jdGlvbiBpbml0QXR0cmlidXRlcygpIHsKCgkJY29uc3QgbmV3QXR0cmlidXRlcyA9IGN1cnJlbnRTdGF0ZS5uZXdBdHRyaWJ1dGVzOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbmV3QXR0cmlidXRlcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCW5ld0F0dHJpYnV0ZXNbIGkgXSA9IDA7CgoJCX0KCgl9CgoJZnVuY3Rpb24gZW5hYmxlQXR0cmlidXRlKCBhdHRyaWJ1dGUgKSB7CgoJCWVuYWJsZUF0dHJpYnV0ZUFuZERpdmlzb3IoIGF0dHJpYnV0ZSwgMCApOwoKCX0KCglmdW5jdGlvbiBlbmFibGVBdHRyaWJ1dGVBbmREaXZpc29yKCBhdHRyaWJ1dGUsIG1lc2hQZXJBdHRyaWJ1dGUgKSB7CgoJCWNvbnN0IG5ld0F0dHJpYnV0ZXMgPSBjdXJyZW50U3RhdGUubmV3QXR0cmlidXRlczsKCQljb25zdCBlbmFibGVkQXR0cmlidXRlcyA9IGN1cnJlbnRTdGF0ZS5lbmFibGVkQXR0cmlidXRlczsKCQljb25zdCBhdHRyaWJ1dGVEaXZpc29ycyA9IGN1cnJlbnRTdGF0ZS5hdHRyaWJ1dGVEaXZpc29yczsKCgkJbmV3QXR0cmlidXRlc1sgYXR0cmlidXRlIF0gPSAxOwoKCQlpZiAoIGVuYWJsZWRBdHRyaWJ1dGVzWyBhdHRyaWJ1dGUgXSA9PT0gMCApIHsKCgkJCWdsLmVuYWJsZVZlcnRleEF0dHJpYkFycmF5KCBhdHRyaWJ1dGUgKTsKCQkJZW5hYmxlZEF0dHJpYnV0ZXNbIGF0dHJpYnV0ZSBdID0gMTsKCgkJfQoKCQlpZiAoIGF0dHJpYnV0ZURpdmlzb3JzWyBhdHRyaWJ1dGUgXSAhPT0gbWVzaFBlckF0dHJpYnV0ZSApIHsKCgkJCWNvbnN0IGV4dGVuc2lvbiA9IGNhcGFiaWxpdGllcy5pc1dlYkdMMiA/IGdsIDogZXh0ZW5zaW9ucy5nZXQoICdBTkdMRV9pbnN0YW5jZWRfYXJyYXlzJyApOwoKCQkJZXh0ZW5zaW9uWyBjYXBhYmlsaXRpZXMuaXNXZWJHTDIgPyAndmVydGV4QXR0cmliRGl2aXNvcicgOiAndmVydGV4QXR0cmliRGl2aXNvckFOR0xFJyBdKCBhdHRyaWJ1dGUsIG1lc2hQZXJBdHRyaWJ1dGUgKTsKCQkJYXR0cmlidXRlRGl2aXNvcnNbIGF0dHJpYnV0ZSBdID0gbWVzaFBlckF0dHJpYnV0ZTsKCgkJfQoKCX0KCglmdW5jdGlvbiBkaXNhYmxlVW51c2VkQXR0cmlidXRlcygpIHsKCgkJY29uc3QgbmV3QXR0cmlidXRlcyA9IGN1cnJlbnRTdGF0ZS5uZXdBdHRyaWJ1dGVzOwoJCWNvbnN0IGVuYWJsZWRBdHRyaWJ1dGVzID0gY3VycmVudFN0YXRlLmVuYWJsZWRBdHRyaWJ1dGVzOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gZW5hYmxlZEF0dHJpYnV0ZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQlpZiAoIGVuYWJsZWRBdHRyaWJ1dGVzWyBpIF0gIT09IG5ld0F0dHJpYnV0ZXNbIGkgXSApIHsKCgkJCQlnbC5kaXNhYmxlVmVydGV4QXR0cmliQXJyYXkoIGkgKTsKCQkJCWVuYWJsZWRBdHRyaWJ1dGVzWyBpIF0gPSAwOwoKCQkJfQoKCQl9CgoJfQoKCWZ1bmN0aW9uIHZlcnRleEF0dHJpYlBvaW50ZXIoIGluZGV4LCBzaXplLCB0eXBlLCBub3JtYWxpemVkLCBzdHJpZGUsIG9mZnNldCwgaW50ZWdlciApIHsKCgkJaWYgKCBpbnRlZ2VyID09PSB0cnVlICkgewoKCQkJZ2wudmVydGV4QXR0cmliSVBvaW50ZXIoIGluZGV4LCBzaXplLCB0eXBlLCBzdHJpZGUsIG9mZnNldCApOwoKCQl9IGVsc2UgewoKCQkJZ2wudmVydGV4QXR0cmliUG9pbnRlciggaW5kZXgsIHNpemUsIHR5cGUsIG5vcm1hbGl6ZWQsIHN0cmlkZSwgb2Zmc2V0ICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gc2V0dXBWZXJ0ZXhBdHRyaWJ1dGVzKCBvYmplY3QsIG1hdGVyaWFsLCBwcm9ncmFtLCBnZW9tZXRyeSApIHsKCgkJaWYgKCBjYXBhYmlsaXRpZXMuaXNXZWJHTDIgPT09IGZhbHNlICYmICggb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCB8fCBnZW9tZXRyeS5pc0luc3RhbmNlZEJ1ZmZlckdlb21ldHJ5ICkgKSB7CgoJCQlpZiAoIGV4dGVuc2lvbnMuZ2V0KCAnQU5HTEVfaW5zdGFuY2VkX2FycmF5cycgKSA9PT0gbnVsbCApIHJldHVybjsKCgkJfQoKCQlpbml0QXR0cmlidXRlcygpOwoKCQljb25zdCBnZW9tZXRyeUF0dHJpYnV0ZXMgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzOwoKCQljb25zdCBwcm9ncmFtQXR0cmlidXRlcyA9IHByb2dyYW0uZ2V0QXR0cmlidXRlcygpOwoKCQljb25zdCBtYXRlcmlhbERlZmF1bHRBdHRyaWJ1dGVWYWx1ZXMgPSBtYXRlcmlhbC5kZWZhdWx0QXR0cmlidXRlVmFsdWVzOwoKCQlmb3IgKCBjb25zdCBuYW1lIGluIHByb2dyYW1BdHRyaWJ1dGVzICkgewoKCQkJY29uc3QgcHJvZ3JhbUF0dHJpYnV0ZSA9IHByb2dyYW1BdHRyaWJ1dGVzWyBuYW1lIF07CgoJCQlpZiAoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24gPj0gMCApIHsKCgkJCQlsZXQgZ2VvbWV0cnlBdHRyaWJ1dGUgPSBnZW9tZXRyeUF0dHJpYnV0ZXNbIG5hbWUgXTsKCgkJCQlpZiAoIGdlb21ldHJ5QXR0cmlidXRlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWlmICggbmFtZSA9PT0gJ2luc3RhbmNlTWF0cml4JyAmJiBvYmplY3QuaW5zdGFuY2VNYXRyaXggKSBnZW9tZXRyeUF0dHJpYnV0ZSA9IG9iamVjdC5pbnN0YW5jZU1hdHJpeDsKCQkJCQlpZiAoIG5hbWUgPT09ICdpbnN0YW5jZUNvbG9yJyAmJiBvYmplY3QuaW5zdGFuY2VDb2xvciApIGdlb21ldHJ5QXR0cmlidXRlID0gb2JqZWN0Lmluc3RhbmNlQ29sb3I7CgoJCQkJfQoKCQkJCWlmICggZ2VvbWV0cnlBdHRyaWJ1dGUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJY29uc3Qgbm9ybWFsaXplZCA9IGdlb21ldHJ5QXR0cmlidXRlLm5vcm1hbGl6ZWQ7CgkJCQkJY29uc3Qgc2l6ZSA9IGdlb21ldHJ5QXR0cmlidXRlLml0ZW1TaXplOwoKCQkJCQljb25zdCBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzLmdldCggZ2VvbWV0cnlBdHRyaWJ1dGUgKTsKCgkJCQkJLy8gVE9ETyBBdHRyaWJ1dGUgbWF5IG5vdCBiZSBhdmFpbGFibGUgb24gY29udGV4dCByZXN0b3JlCgoJCQkJCWlmICggYXR0cmlidXRlID09PSB1bmRlZmluZWQgKSBjb250aW51ZTsKCgkJCQkJY29uc3QgYnVmZmVyID0gYXR0cmlidXRlLmJ1ZmZlcjsKCQkJCQljb25zdCB0eXBlID0gYXR0cmlidXRlLnR5cGU7CgkJCQkJY29uc3QgYnl0ZXNQZXJFbGVtZW50ID0gYXR0cmlidXRlLmJ5dGVzUGVyRWxlbWVudDsKCgkJCQkJLy8gY2hlY2sgZm9yIGludGVnZXIgYXR0cmlidXRlcyAoV2ViR0wgMiBvbmx5KQoKCQkJCQljb25zdCBpbnRlZ2VyID0gKCBjYXBhYmlsaXRpZXMuaXNXZWJHTDIgPT09IHRydWUgJiYgKCB0eXBlID09PSBnbC5JTlQgfHwgdHlwZSA9PT0gZ2wuVU5TSUdORURfSU5UIHx8IGdlb21ldHJ5QXR0cmlidXRlLmdwdVR5cGUgPT09IEludFR5cGUgKSApOwoKCQkJCQlpZiAoIGdlb21ldHJ5QXR0cmlidXRlLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUgKSB7CgoJCQkJCQljb25zdCBkYXRhID0gZ2VvbWV0cnlBdHRyaWJ1dGUuZGF0YTsKCQkJCQkJY29uc3Qgc3RyaWRlID0gZGF0YS5zdHJpZGU7CgkJCQkJCWNvbnN0IG9mZnNldCA9IGdlb21ldHJ5QXR0cmlidXRlLm9mZnNldDsKCgkJCQkJCWlmICggZGF0YS5pc0luc3RhbmNlZEludGVybGVhdmVkQnVmZmVyICkgewoKCQkJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb25TaXplOyBpICsrICkgewoKCQkJCQkJCQllbmFibGVBdHRyaWJ1dGVBbmREaXZpc29yKCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uICsgaSwgZGF0YS5tZXNoUGVyQXR0cmlidXRlICk7CgoJCQkJCQkJfQoKCQkJCQkJCWlmICggb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCAhPT0gdHJ1ZSAmJiBnZW9tZXRyeS5fbWF4SW5zdGFuY2VDb3VudCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJCQlnZW9tZXRyeS5fbWF4SW5zdGFuY2VDb3VudCA9IGRhdGEubWVzaFBlckF0dHJpYnV0ZSAqIGRhdGEuY291bnQ7CgoJCQkJCQkJfQoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uU2l6ZTsgaSArKyApIHsKCgkJCQkJCQkJZW5hYmxlQXR0cmlidXRlKCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uICsgaSApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJCWdsLmJpbmRCdWZmZXIoIGdsLkFSUkFZX0JVRkZFUiwgYnVmZmVyICk7CgoJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uU2l6ZTsgaSArKyApIHsKCgkJCQkJCQl2ZXJ0ZXhBdHRyaWJQb2ludGVyKAoJCQkJCQkJCXByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24gKyBpLAoJCQkJCQkJCXNpemUgLyBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uU2l6ZSwKCQkJCQkJCQl0eXBlLAoJCQkJCQkJCW5vcm1hbGl6ZWQsCgkJCQkJCQkJc3RyaWRlICogYnl0ZXNQZXJFbGVtZW50LAoJCQkJCQkJCSggb2Zmc2V0ICsgKCBzaXplIC8gcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemUgKSAqIGkgKSAqIGJ5dGVzUGVyRWxlbWVudCwKCQkJCQkJCQlpbnRlZ2VyCgkJCQkJCQkpOwoKCQkJCQkJfQoKCQkJCQl9IGVsc2UgewoKCQkJCQkJaWYgKCBnZW9tZXRyeUF0dHJpYnV0ZS5pc0luc3RhbmNlZEJ1ZmZlckF0dHJpYnV0ZSApIHsKCgkJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uU2l6ZTsgaSArKyApIHsKCgkJCQkJCQkJZW5hYmxlQXR0cmlidXRlQW5kRGl2aXNvciggcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiArIGksIGdlb21ldHJ5QXR0cmlidXRlLm1lc2hQZXJBdHRyaWJ1dGUgKTsKCgkJCQkJCQl9CgoJCQkJCQkJaWYgKCBvYmplY3QuaXNJbnN0YW5jZWRNZXNoICE9PSB0cnVlICYmIGdlb21ldHJ5Ll9tYXhJbnN0YW5jZUNvdW50ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQkJCWdlb21ldHJ5Ll9tYXhJbnN0YW5jZUNvdW50ID0gZ2VvbWV0cnlBdHRyaWJ1dGUubWVzaFBlckF0dHJpYnV0ZSAqIGdlb21ldHJ5QXR0cmlidXRlLmNvdW50OwoKCQkJCQkJCX0KCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemU7IGkgKysgKSB7CgoJCQkJCQkJCWVuYWJsZUF0dHJpYnV0ZSggcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiArIGkgKTsKCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCQlnbC5iaW5kQnVmZmVyKCBnbC5BUlJBWV9CVUZGRVIsIGJ1ZmZlciApOwoKCQkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemU7IGkgKysgKSB7CgoJCQkJCQkJdmVydGV4QXR0cmliUG9pbnRlcigKCQkJCQkJCQlwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uICsgaSwKCQkJCQkJCQlzaXplIC8gcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemUsCgkJCQkJCQkJdHlwZSwKCQkJCQkJCQlub3JtYWxpemVkLAoJCQkJCQkJCXNpemUgKiBieXRlc1BlckVsZW1lbnQsCgkJCQkJCQkJKCBzaXplIC8gcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvblNpemUgKSAqIGkgKiBieXRlc1BlckVsZW1lbnQsCgkJCQkJCQkJaW50ZWdlcgoJCQkJCQkJKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsRGVmYXVsdEF0dHJpYnV0ZVZhbHVlcyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQljb25zdCB2YWx1ZSA9IG1hdGVyaWFsRGVmYXVsdEF0dHJpYnV0ZVZhbHVlc1sgbmFtZSBdOwoKCQkJCQlpZiAoIHZhbHVlICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCQlzd2l0Y2ggKCB2YWx1ZS5sZW5ndGggKSB7CgoJCQkJCQkJY2FzZSAyOgoJCQkJCQkJCWdsLnZlcnRleEF0dHJpYjJmdiggcHJvZ3JhbUF0dHJpYnV0ZS5sb2NhdGlvbiwgdmFsdWUgKTsKCQkJCQkJCQlicmVhazsKCgkJCQkJCQljYXNlIDM6CgkJCQkJCQkJZ2wudmVydGV4QXR0cmliM2Z2KCBwcm9ncmFtQXR0cmlidXRlLmxvY2F0aW9uLCB2YWx1ZSApOwoJCQkJCQkJCWJyZWFrOwoKCQkJCQkJCWNhc2UgNDoKCQkJCQkJCQlnbC52ZXJ0ZXhBdHRyaWI0ZnYoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24sIHZhbHVlICk7CgkJCQkJCQkJYnJlYWs7CgoJCQkJCQkJZGVmYXVsdDoKCQkJCQkJCQlnbC52ZXJ0ZXhBdHRyaWIxZnYoIHByb2dyYW1BdHRyaWJ1dGUubG9jYXRpb24sIHZhbHVlICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCX0KCgkJZGlzYWJsZVVudXNlZEF0dHJpYnV0ZXMoKTsKCgl9CgoJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCgkJcmVzZXQoKTsKCgkJZm9yICggY29uc3QgZ2VvbWV0cnlJZCBpbiBiaW5kaW5nU3RhdGVzICkgewoKCQkJY29uc3QgcHJvZ3JhbU1hcCA9IGJpbmRpbmdTdGF0ZXNbIGdlb21ldHJ5SWQgXTsKCgkJCWZvciAoIGNvbnN0IHByb2dyYW1JZCBpbiBwcm9ncmFtTWFwICkgewoKCQkJCWNvbnN0IHN0YXRlTWFwID0gcHJvZ3JhbU1hcFsgcHJvZ3JhbUlkIF07CgoJCQkJZm9yICggY29uc3Qgd2lyZWZyYW1lIGluIHN0YXRlTWFwICkgewoKCQkJCQlkZWxldGVWZXJ0ZXhBcnJheU9iamVjdCggc3RhdGVNYXBbIHdpcmVmcmFtZSBdLm9iamVjdCApOwoKCQkJCQlkZWxldGUgc3RhdGVNYXBbIHdpcmVmcmFtZSBdOwoKCQkJCX0KCgkJCQlkZWxldGUgcHJvZ3JhbU1hcFsgcHJvZ3JhbUlkIF07CgoJCQl9CgoJCQlkZWxldGUgYmluZGluZ1N0YXRlc1sgZ2VvbWV0cnlJZCBdOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHJlbGVhc2VTdGF0ZXNPZkdlb21ldHJ5KCBnZW9tZXRyeSApIHsKCgkJaWYgKCBiaW5kaW5nU3RhdGVzWyBnZW9tZXRyeS5pZCBdID09PSB1bmRlZmluZWQgKSByZXR1cm47CgoJCWNvbnN0IHByb2dyYW1NYXAgPSBiaW5kaW5nU3RhdGVzWyBnZW9tZXRyeS5pZCBdOwoKCQlmb3IgKCBjb25zdCBwcm9ncmFtSWQgaW4gcHJvZ3JhbU1hcCApIHsKCgkJCWNvbnN0IHN0YXRlTWFwID0gcHJvZ3JhbU1hcFsgcHJvZ3JhbUlkIF07CgoJCQlmb3IgKCBjb25zdCB3aXJlZnJhbWUgaW4gc3RhdGVNYXAgKSB7CgoJCQkJZGVsZXRlVmVydGV4QXJyYXlPYmplY3QoIHN0YXRlTWFwWyB3aXJlZnJhbWUgXS5vYmplY3QgKTsKCgkJCQlkZWxldGUgc3RhdGVNYXBbIHdpcmVmcmFtZSBdOwoKCQkJfQoKCQkJZGVsZXRlIHByb2dyYW1NYXBbIHByb2dyYW1JZCBdOwoKCQl9CgoJCWRlbGV0ZSBiaW5kaW5nU3RhdGVzWyBnZW9tZXRyeS5pZCBdOwoKCX0KCglmdW5jdGlvbiByZWxlYXNlU3RhdGVzT2ZQcm9ncmFtKCBwcm9ncmFtICkgewoKCQlmb3IgKCBjb25zdCBnZW9tZXRyeUlkIGluIGJpbmRpbmdTdGF0ZXMgKSB7CgoJCQljb25zdCBwcm9ncmFtTWFwID0gYmluZGluZ1N0YXRlc1sgZ2VvbWV0cnlJZCBdOwoKCQkJaWYgKCBwcm9ncmFtTWFwWyBwcm9ncmFtLmlkIF0gPT09IHVuZGVmaW5lZCApIGNvbnRpbnVlOwoKCQkJY29uc3Qgc3RhdGVNYXAgPSBwcm9ncmFtTWFwWyBwcm9ncmFtLmlkIF07CgoJCQlmb3IgKCBjb25zdCB3aXJlZnJhbWUgaW4gc3RhdGVNYXAgKSB7CgoJCQkJZGVsZXRlVmVydGV4QXJyYXlPYmplY3QoIHN0YXRlTWFwWyB3aXJlZnJhbWUgXS5vYmplY3QgKTsKCgkJCQlkZWxldGUgc3RhdGVNYXBbIHdpcmVmcmFtZSBdOwoKCQkJfQoKCQkJZGVsZXRlIHByb2dyYW1NYXBbIHByb2dyYW0uaWQgXTsKCgkJfQoKCX0KCglmdW5jdGlvbiByZXNldCgpIHsKCgkJcmVzZXREZWZhdWx0U3RhdGUoKTsKCQlmb3JjZVVwZGF0ZSA9IHRydWU7CgoJCWlmICggY3VycmVudFN0YXRlID09PSBkZWZhdWx0U3RhdGUgKSByZXR1cm47CgoJCWN1cnJlbnRTdGF0ZSA9IGRlZmF1bHRTdGF0ZTsKCQliaW5kVmVydGV4QXJyYXlPYmplY3QoIGN1cnJlbnRTdGF0ZS5vYmplY3QgKTsKCgl9CgoJLy8gZm9yIGJhY2t3YXJkLWNvbXBhdGliaWxpdHkKCglmdW5jdGlvbiByZXNldERlZmF1bHRTdGF0ZSgpIHsKCgkJZGVmYXVsdFN0YXRlLmdlb21ldHJ5ID0gbnVsbDsKCQlkZWZhdWx0U3RhdGUucHJvZ3JhbSA9IG51bGw7CgkJZGVmYXVsdFN0YXRlLndpcmVmcmFtZSA9IGZhbHNlOwoKCX0KCglyZXR1cm4gewoKCQlzZXR1cDogc2V0dXAsCgkJcmVzZXQ6IHJlc2V0LAoJCXJlc2V0RGVmYXVsdFN0YXRlOiByZXNldERlZmF1bHRTdGF0ZSwKCQlkaXNwb3NlOiBkaXNwb3NlLAoJCXJlbGVhc2VTdGF0ZXNPZkdlb21ldHJ5OiByZWxlYXNlU3RhdGVzT2ZHZW9tZXRyeSwKCQlyZWxlYXNlU3RhdGVzT2ZQcm9ncmFtOiByZWxlYXNlU3RhdGVzT2ZQcm9ncmFtLAoKCQlpbml0QXR0cmlidXRlczogaW5pdEF0dHJpYnV0ZXMsCgkJZW5hYmxlQXR0cmlidXRlOiBlbmFibGVBdHRyaWJ1dGUsCgkJZGlzYWJsZVVudXNlZEF0dHJpYnV0ZXM6IGRpc2FibGVVbnVzZWRBdHRyaWJ1dGVzCgoJfTsKCn0KCmZ1bmN0aW9uIFdlYkdMQnVmZmVyUmVuZGVyZXIoIGdsLCBleHRlbnNpb25zLCBpbmZvLCBjYXBhYmlsaXRpZXMgKSB7CgoJY29uc3QgaXNXZWJHTDIgPSBjYXBhYmlsaXRpZXMuaXNXZWJHTDI7CgoJbGV0IG1vZGU7CgoJZnVuY3Rpb24gc2V0TW9kZSggdmFsdWUgKSB7CgoJCW1vZGUgPSB2YWx1ZTsKCgl9CgoJZnVuY3Rpb24gcmVuZGVyKCBzdGFydCwgY291bnQgKSB7CgoJCWdsLmRyYXdBcnJheXMoIG1vZGUsIHN0YXJ0LCBjb3VudCApOwoKCQlpbmZvLnVwZGF0ZSggY291bnQsIG1vZGUsIDEgKTsKCgl9CgoJZnVuY3Rpb24gcmVuZGVySW5zdGFuY2VzKCBzdGFydCwgY291bnQsIHByaW1jb3VudCApIHsKCgkJaWYgKCBwcmltY291bnQgPT09IDAgKSByZXR1cm47CgoJCWxldCBleHRlbnNpb24sIG1ldGhvZE5hbWU7CgoJCWlmICggaXNXZWJHTDIgKSB7CgoJCQlleHRlbnNpb24gPSBnbDsKCQkJbWV0aG9kTmFtZSA9ICdkcmF3QXJyYXlzSW5zdGFuY2VkJzsKCgkJfSBlbHNlIHsKCgkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnQU5HTEVfaW5zdGFuY2VkX2FycmF5cycgKTsKCQkJbWV0aG9kTmFtZSA9ICdkcmF3QXJyYXlzSW5zdGFuY2VkQU5HTEUnOwoKCQkJaWYgKCBleHRlbnNpb24gPT09IG51bGwgKSB7CgoJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMQnVmZmVyUmVuZGVyZXI6IHVzaW5nIFRIUkVFLkluc3RhbmNlZEJ1ZmZlckdlb21ldHJ5IGJ1dCBoYXJkd2FyZSBkb2VzIG5vdCBzdXBwb3J0IGV4dGVuc2lvbiBBTkdMRV9pbnN0YW5jZWRfYXJyYXlzLicgKTsKCQkJCXJldHVybjsKCgkJCX0KCgkJfQoKCQlleHRlbnNpb25bIG1ldGhvZE5hbWUgXSggbW9kZSwgc3RhcnQsIGNvdW50LCBwcmltY291bnQgKTsKCgkJaW5mby51cGRhdGUoIGNvdW50LCBtb2RlLCBwcmltY291bnQgKTsKCgl9CgoJLy8KCgl0aGlzLnNldE1vZGUgPSBzZXRNb2RlOwoJdGhpcy5yZW5kZXIgPSByZW5kZXI7Cgl0aGlzLnJlbmRlckluc3RhbmNlcyA9IHJlbmRlckluc3RhbmNlczsKCn0KCmZ1bmN0aW9uIFdlYkdMQ2FwYWJpbGl0aWVzKCBnbCwgZXh0ZW5zaW9ucywgcGFyYW1ldGVycyApIHsKCglsZXQgbWF4QW5pc290cm9weTsKCglmdW5jdGlvbiBnZXRNYXhBbmlzb3Ryb3B5KCkgewoKCQlpZiAoIG1heEFuaXNvdHJvcHkgIT09IHVuZGVmaW5lZCApIHJldHVybiBtYXhBbmlzb3Ryb3B5OwoKCQlpZiAoIGV4dGVuc2lvbnMuaGFzKCAnRVhUX3RleHR1cmVfZmlsdGVyX2FuaXNvdHJvcGljJyApID09PSB0cnVlICkgewoKCQkJY29uc3QgZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdFWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMnICk7CgoJCQltYXhBbmlzb3Ryb3B5ID0gZ2wuZ2V0UGFyYW1ldGVyKCBleHRlbnNpb24uTUFYX1RFWFRVUkVfTUFYX0FOSVNPVFJPUFlfRVhUICk7CgoJCX0gZWxzZSB7CgoJCQltYXhBbmlzb3Ryb3B5ID0gMDsKCgkJfQoKCQlyZXR1cm4gbWF4QW5pc290cm9weTsKCgl9CgoJZnVuY3Rpb24gZ2V0TWF4UHJlY2lzaW9uKCBwcmVjaXNpb24gKSB7CgoJCWlmICggcHJlY2lzaW9uID09PSAnaGlnaHAnICkgewoKCQkJaWYgKCBnbC5nZXRTaGFkZXJQcmVjaXNpb25Gb3JtYXQoIGdsLlZFUlRFWF9TSEFERVIsIGdsLkhJR0hfRkxPQVQgKS5wcmVjaXNpb24gPiAwICYmCgkJCQlnbC5nZXRTaGFkZXJQcmVjaXNpb25Gb3JtYXQoIGdsLkZSQUdNRU5UX1NIQURFUiwgZ2wuSElHSF9GTE9BVCApLnByZWNpc2lvbiA+IDAgKSB7CgoJCQkJcmV0dXJuICdoaWdocCc7CgoJCQl9CgoJCQlwcmVjaXNpb24gPSAnbWVkaXVtcCc7CgoJCX0KCgkJaWYgKCBwcmVjaXNpb24gPT09ICdtZWRpdW1wJyApIHsKCgkJCWlmICggZ2wuZ2V0U2hhZGVyUHJlY2lzaW9uRm9ybWF0KCBnbC5WRVJURVhfU0hBREVSLCBnbC5NRURJVU1fRkxPQVQgKS5wcmVjaXNpb24gPiAwICYmCgkJCQlnbC5nZXRTaGFkZXJQcmVjaXNpb25Gb3JtYXQoIGdsLkZSQUdNRU5UX1NIQURFUiwgZ2wuTUVESVVNX0ZMT0FUICkucHJlY2lzaW9uID4gMCApIHsKCgkJCQlyZXR1cm4gJ21lZGl1bXAnOwoKCQkJfQoKCQl9CgoJCXJldHVybiAnbG93cCc7CgoJfQoKCWNvbnN0IGlzV2ViR0wyID0gdHlwZW9mIFdlYkdMMlJlbmRlcmluZ0NvbnRleHQgIT09ICd1bmRlZmluZWQnICYmIGdsLmNvbnN0cnVjdG9yLm5hbWUgPT09ICdXZWJHTDJSZW5kZXJpbmdDb250ZXh0JzsKCglsZXQgcHJlY2lzaW9uID0gcGFyYW1ldGVycy5wcmVjaXNpb24gIT09IHVuZGVmaW5lZCA/IHBhcmFtZXRlcnMucHJlY2lzaW9uIDogJ2hpZ2hwJzsKCWNvbnN0IG1heFByZWNpc2lvbiA9IGdldE1heFByZWNpc2lvbiggcHJlY2lzaW9uICk7CgoJaWYgKCBtYXhQcmVjaXNpb24gIT09IHByZWNpc2lvbiApIHsKCgkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjonLCBwcmVjaXNpb24sICdub3Qgc3VwcG9ydGVkLCB1c2luZycsIG1heFByZWNpc2lvbiwgJ2luc3RlYWQuJyApOwoJCXByZWNpc2lvbiA9IG1heFByZWNpc2lvbjsKCgl9CgoJY29uc3QgZHJhd0J1ZmZlcnMgPSBpc1dlYkdMMiB8fCBleHRlbnNpb25zLmhhcyggJ1dFQkdMX2RyYXdfYnVmZmVycycgKTsKCgljb25zdCBsb2dhcml0aG1pY0RlcHRoQnVmZmVyID0gcGFyYW1ldGVycy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyID09PSB0cnVlOwoKCWNvbnN0IG1heFRleHR1cmVzID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfVEVYVFVSRV9JTUFHRV9VTklUUyApOwoJY29uc3QgbWF4VmVydGV4VGV4dHVyZXMgPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9WRVJURVhfVEVYVFVSRV9JTUFHRV9VTklUUyApOwoJY29uc3QgbWF4VGV4dHVyZVNpemUgPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9URVhUVVJFX1NJWkUgKTsKCWNvbnN0IG1heEN1YmVtYXBTaXplID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfQ1VCRV9NQVBfVEVYVFVSRV9TSVpFICk7CgoJY29uc3QgbWF4QXR0cmlidXRlcyA9IGdsLmdldFBhcmFtZXRlciggZ2wuTUFYX1ZFUlRFWF9BVFRSSUJTICk7Cgljb25zdCBtYXhWZXJ0ZXhVbmlmb3JtcyA9IGdsLmdldFBhcmFtZXRlciggZ2wuTUFYX1ZFUlRFWF9VTklGT1JNX1ZFQ1RPUlMgKTsKCWNvbnN0IG1heFZhcnlpbmdzID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfVkFSWUlOR19WRUNUT1JTICk7Cgljb25zdCBtYXhGcmFnbWVudFVuaWZvcm1zID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfRlJBR01FTlRfVU5JRk9STV9WRUNUT1JTICk7CgoJY29uc3QgdmVydGV4VGV4dHVyZXMgPSBtYXhWZXJ0ZXhUZXh0dXJlcyA+IDA7Cgljb25zdCBmbG9hdEZyYWdtZW50VGV4dHVyZXMgPSBpc1dlYkdMMiB8fCBleHRlbnNpb25zLmhhcyggJ09FU190ZXh0dXJlX2Zsb2F0JyApOwoJY29uc3QgZmxvYXRWZXJ0ZXhUZXh0dXJlcyA9IHZlcnRleFRleHR1cmVzICYmIGZsb2F0RnJhZ21lbnRUZXh0dXJlczsKCgljb25zdCBtYXhTYW1wbGVzID0gaXNXZWJHTDIgPyBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9TQU1QTEVTICkgOiAwOwoKCXJldHVybiB7CgoJCWlzV2ViR0wyOiBpc1dlYkdMMiwKCgkJZHJhd0J1ZmZlcnM6IGRyYXdCdWZmZXJzLAoKCQlnZXRNYXhBbmlzb3Ryb3B5OiBnZXRNYXhBbmlzb3Ryb3B5LAoJCWdldE1heFByZWNpc2lvbjogZ2V0TWF4UHJlY2lzaW9uLAoKCQlwcmVjaXNpb246IHByZWNpc2lvbiwKCQlsb2dhcml0aG1pY0RlcHRoQnVmZmVyOiBsb2dhcml0aG1pY0RlcHRoQnVmZmVyLAoKCQltYXhUZXh0dXJlczogbWF4VGV4dHVyZXMsCgkJbWF4VmVydGV4VGV4dHVyZXM6IG1heFZlcnRleFRleHR1cmVzLAoJCW1heFRleHR1cmVTaXplOiBtYXhUZXh0dXJlU2l6ZSwKCQltYXhDdWJlbWFwU2l6ZTogbWF4Q3ViZW1hcFNpemUsCgoJCW1heEF0dHJpYnV0ZXM6IG1heEF0dHJpYnV0ZXMsCgkJbWF4VmVydGV4VW5pZm9ybXM6IG1heFZlcnRleFVuaWZvcm1zLAoJCW1heFZhcnlpbmdzOiBtYXhWYXJ5aW5ncywKCQltYXhGcmFnbWVudFVuaWZvcm1zOiBtYXhGcmFnbWVudFVuaWZvcm1zLAoKCQl2ZXJ0ZXhUZXh0dXJlczogdmVydGV4VGV4dHVyZXMsCgkJZmxvYXRGcmFnbWVudFRleHR1cmVzOiBmbG9hdEZyYWdtZW50VGV4dHVyZXMsCgkJZmxvYXRWZXJ0ZXhUZXh0dXJlczogZmxvYXRWZXJ0ZXhUZXh0dXJlcywKCgkJbWF4U2FtcGxlczogbWF4U2FtcGxlcwoKCX07Cgp9CgpmdW5jdGlvbiBXZWJHTENsaXBwaW5nKCBwcm9wZXJ0aWVzICkgewoKCWNvbnN0IHNjb3BlID0gdGhpczsKCglsZXQgZ2xvYmFsU3RhdGUgPSBudWxsLAoJCW51bUdsb2JhbFBsYW5lcyA9IDAsCgkJbG9jYWxDbGlwcGluZ0VuYWJsZWQgPSBmYWxzZSwKCQlyZW5kZXJpbmdTaGFkb3dzID0gZmFsc2U7CgoJY29uc3QgcGxhbmUgPSBuZXcgUGxhbmUoKSwKCQl2aWV3Tm9ybWFsTWF0cml4ID0gbmV3IE1hdHJpeDMoKSwKCgkJdW5pZm9ybSA9IHsgdmFsdWU6IG51bGwsIG5lZWRzVXBkYXRlOiBmYWxzZSB9OwoKCXRoaXMudW5pZm9ybSA9IHVuaWZvcm07Cgl0aGlzLm51bVBsYW5lcyA9IDA7Cgl0aGlzLm51bUludGVyc2VjdGlvbiA9IDA7CgoJdGhpcy5pbml0ID0gZnVuY3Rpb24gKCBwbGFuZXMsIGVuYWJsZUxvY2FsQ2xpcHBpbmcgKSB7CgoJCWNvbnN0IGVuYWJsZWQgPQoJCQlwbGFuZXMubGVuZ3RoICE9PSAwIHx8CgkJCWVuYWJsZUxvY2FsQ2xpcHBpbmcgfHwKCQkJLy8gZW5hYmxlIHN0YXRlIG9mIHByZXZpb3VzIGZyYW1lIC0gdGhlIGNsaXBwaW5nIGNvZGUgaGFzIHRvCgkJCS8vIHJ1biBhbm90aGVyIGZyYW1lIGluIG9yZGVyIHRvIHJlc2V0IHRoZSBzdGF0ZToKCQkJbnVtR2xvYmFsUGxhbmVzICE9PSAwIHx8CgkJCWxvY2FsQ2xpcHBpbmdFbmFibGVkOwoKCQlsb2NhbENsaXBwaW5nRW5hYmxlZCA9IGVuYWJsZUxvY2FsQ2xpcHBpbmc7CgoJCW51bUdsb2JhbFBsYW5lcyA9IHBsYW5lcy5sZW5ndGg7CgoJCXJldHVybiBlbmFibGVkOwoKCX07CgoJdGhpcy5iZWdpblNoYWRvd3MgPSBmdW5jdGlvbiAoKSB7CgoJCXJlbmRlcmluZ1NoYWRvd3MgPSB0cnVlOwoJCXByb2plY3RQbGFuZXMoIG51bGwgKTsKCgl9OwoKCXRoaXMuZW5kU2hhZG93cyA9IGZ1bmN0aW9uICgpIHsKCgkJcmVuZGVyaW5nU2hhZG93cyA9IGZhbHNlOwoKCX07CgoJdGhpcy5zZXRHbG9iYWxTdGF0ZSA9IGZ1bmN0aW9uICggcGxhbmVzLCBjYW1lcmEgKSB7CgoJCWdsb2JhbFN0YXRlID0gcHJvamVjdFBsYW5lcyggcGxhbmVzLCBjYW1lcmEsIDAgKTsKCgl9OwoKCXRoaXMuc2V0U3RhdGUgPSBmdW5jdGlvbiAoIG1hdGVyaWFsLCBjYW1lcmEsIHVzZUNhY2hlICkgewoKCQljb25zdCBwbGFuZXMgPSBtYXRlcmlhbC5jbGlwcGluZ1BsYW5lcywKCQkJY2xpcEludGVyc2VjdGlvbiA9IG1hdGVyaWFsLmNsaXBJbnRlcnNlY3Rpb24sCgkJCWNsaXBTaGFkb3dzID0gbWF0ZXJpYWwuY2xpcFNoYWRvd3M7CgoJCWNvbnN0IG1hdGVyaWFsUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApOwoKCQlpZiAoICEgbG9jYWxDbGlwcGluZ0VuYWJsZWQgfHwgcGxhbmVzID09PSBudWxsIHx8IHBsYW5lcy5sZW5ndGggPT09IDAgfHwgcmVuZGVyaW5nU2hhZG93cyAmJiAhIGNsaXBTaGFkb3dzICkgewoKCQkJLy8gdGhlcmUncyBubyBsb2NhbCBjbGlwcGluZwoKCQkJaWYgKCByZW5kZXJpbmdTaGFkb3dzICkgewoKCQkJCS8vIHRoZXJlJ3Mgbm8gZ2xvYmFsIGNsaXBwaW5nCgoJCQkJcHJvamVjdFBsYW5lcyggbnVsbCApOwoKCQkJfSBlbHNlIHsKCgkJCQlyZXNldEdsb2JhbFN0YXRlKCk7CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQljb25zdCBuR2xvYmFsID0gcmVuZGVyaW5nU2hhZG93cyA/IDAgOiBudW1HbG9iYWxQbGFuZXMsCgkJCQlsR2xvYmFsID0gbkdsb2JhbCAqIDQ7CgoJCQlsZXQgZHN0QXJyYXkgPSBtYXRlcmlhbFByb3BlcnRpZXMuY2xpcHBpbmdTdGF0ZSB8fCBudWxsOwoKCQkJdW5pZm9ybS52YWx1ZSA9IGRzdEFycmF5OyAvLyBlbnN1cmUgdW5pcXVlIHN0YXRlCgoJCQlkc3RBcnJheSA9IHByb2plY3RQbGFuZXMoIHBsYW5lcywgY2FtZXJhLCBsR2xvYmFsLCB1c2VDYWNoZSApOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpICE9PSBsR2xvYmFsOyArKyBpICkgewoKCQkJCWRzdEFycmF5WyBpIF0gPSBnbG9iYWxTdGF0ZVsgaSBdOwoKCQkJfQoKCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmNsaXBwaW5nU3RhdGUgPSBkc3RBcnJheTsKCQkJdGhpcy5udW1JbnRlcnNlY3Rpb24gPSBjbGlwSW50ZXJzZWN0aW9uID8gdGhpcy5udW1QbGFuZXMgOiAwOwoJCQl0aGlzLm51bVBsYW5lcyArPSBuR2xvYmFsOwoKCQl9CgoKCX07CgoJZnVuY3Rpb24gcmVzZXRHbG9iYWxTdGF0ZSgpIHsKCgkJaWYgKCB1bmlmb3JtLnZhbHVlICE9PSBnbG9iYWxTdGF0ZSApIHsKCgkJCXVuaWZvcm0udmFsdWUgPSBnbG9iYWxTdGF0ZTsKCQkJdW5pZm9ybS5uZWVkc1VwZGF0ZSA9IG51bUdsb2JhbFBsYW5lcyA+IDA7CgoJCX0KCgkJc2NvcGUubnVtUGxhbmVzID0gbnVtR2xvYmFsUGxhbmVzOwoJCXNjb3BlLm51bUludGVyc2VjdGlvbiA9IDA7CgoJfQoKCWZ1bmN0aW9uIHByb2plY3RQbGFuZXMoIHBsYW5lcywgY2FtZXJhLCBkc3RPZmZzZXQsIHNraXBUcmFuc2Zvcm0gKSB7CgoJCWNvbnN0IG5QbGFuZXMgPSBwbGFuZXMgIT09IG51bGwgPyBwbGFuZXMubGVuZ3RoIDogMDsKCQlsZXQgZHN0QXJyYXkgPSBudWxsOwoKCQlpZiAoIG5QbGFuZXMgIT09IDAgKSB7CgoJCQlkc3RBcnJheSA9IHVuaWZvcm0udmFsdWU7CgoJCQlpZiAoIHNraXBUcmFuc2Zvcm0gIT09IHRydWUgfHwgZHN0QXJyYXkgPT09IG51bGwgKSB7CgoJCQkJY29uc3QgZmxhdFNpemUgPSBkc3RPZmZzZXQgKyBuUGxhbmVzICogNCwKCQkJCQl2aWV3TWF0cml4ID0gY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZTsKCgkJCQl2aWV3Tm9ybWFsTWF0cml4LmdldE5vcm1hbE1hdHJpeCggdmlld01hdHJpeCApOwoKCQkJCWlmICggZHN0QXJyYXkgPT09IG51bGwgfHwgZHN0QXJyYXkubGVuZ3RoIDwgZmxhdFNpemUgKSB7CgoJCQkJCWRzdEFycmF5ID0gbmV3IEZsb2F0MzJBcnJheSggZmxhdFNpemUgKTsKCgkJCQl9CgoJCQkJZm9yICggbGV0IGkgPSAwLCBpNCA9IGRzdE9mZnNldDsgaSAhPT0gblBsYW5lczsgKysgaSwgaTQgKz0gNCApIHsKCgkJCQkJcGxhbmUuY29weSggcGxhbmVzWyBpIF0gKS5hcHBseU1hdHJpeDQoIHZpZXdNYXRyaXgsIHZpZXdOb3JtYWxNYXRyaXggKTsKCgkJCQkJcGxhbmUubm9ybWFsLnRvQXJyYXkoIGRzdEFycmF5LCBpNCApOwoJCQkJCWRzdEFycmF5WyBpNCArIDMgXSA9IHBsYW5lLmNvbnN0YW50OwoKCQkJCX0KCgkJCX0KCgkJCXVuaWZvcm0udmFsdWUgPSBkc3RBcnJheTsKCQkJdW5pZm9ybS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCX0KCgkJc2NvcGUubnVtUGxhbmVzID0gblBsYW5lczsKCQlzY29wZS5udW1JbnRlcnNlY3Rpb24gPSAwOwoKCQlyZXR1cm4gZHN0QXJyYXk7CgoJfQoKfQoKZnVuY3Rpb24gV2ViR0xDdWJlTWFwcyggcmVuZGVyZXIgKSB7CgoJbGV0IGN1YmVtYXBzID0gbmV3IFdlYWtNYXAoKTsKCglmdW5jdGlvbiBtYXBUZXh0dXJlTWFwcGluZyggdGV4dHVyZSwgbWFwcGluZyApIHsKCgkJaWYgKCBtYXBwaW5nID09PSBFcXVpcmVjdGFuZ3VsYXJSZWZsZWN0aW9uTWFwcGluZyApIHsKCgkJCXRleHR1cmUubWFwcGluZyA9IEN1YmVSZWZsZWN0aW9uTWFwcGluZzsKCgkJfSBlbHNlIGlmICggbWFwcGluZyA9PT0gRXF1aXJlY3Rhbmd1bGFyUmVmcmFjdGlvbk1hcHBpbmcgKSB7CgoJCQl0ZXh0dXJlLm1hcHBpbmcgPSBDdWJlUmVmcmFjdGlvbk1hcHBpbmc7CgoJCX0KCgkJcmV0dXJuIHRleHR1cmU7CgoJfQoKCWZ1bmN0aW9uIGdldCggdGV4dHVyZSApIHsKCgkJaWYgKCB0ZXh0dXJlICYmIHRleHR1cmUuaXNUZXh0dXJlICYmIHRleHR1cmUuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID09PSBmYWxzZSApIHsKCgkJCWNvbnN0IG1hcHBpbmcgPSB0ZXh0dXJlLm1hcHBpbmc7CgoJCQlpZiAoIG1hcHBpbmcgPT09IEVxdWlyZWN0YW5ndWxhclJlZmxlY3Rpb25NYXBwaW5nIHx8IG1hcHBpbmcgPT09IEVxdWlyZWN0YW5ndWxhclJlZnJhY3Rpb25NYXBwaW5nICkgewoKCQkJCWlmICggY3ViZW1hcHMuaGFzKCB0ZXh0dXJlICkgKSB7CgoJCQkJCWNvbnN0IGN1YmVtYXAgPSBjdWJlbWFwcy5nZXQoIHRleHR1cmUgKS50ZXh0dXJlOwoJCQkJCXJldHVybiBtYXBUZXh0dXJlTWFwcGluZyggY3ViZW1hcCwgdGV4dHVyZS5tYXBwaW5nICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJY29uc3QgaW1hZ2UgPSB0ZXh0dXJlLmltYWdlOwoKCQkJCQlpZiAoIGltYWdlICYmIGltYWdlLmhlaWdodCA+IDAgKSB7CgoJCQkJCQljb25zdCByZW5kZXJUYXJnZXQgPSBuZXcgV2ViR0xDdWJlUmVuZGVyVGFyZ2V0KCBpbWFnZS5oZWlnaHQgLyAyICk7CgkJCQkJCXJlbmRlclRhcmdldC5mcm9tRXF1aXJlY3Rhbmd1bGFyVGV4dHVyZSggcmVuZGVyZXIsIHRleHR1cmUgKTsKCQkJCQkJY3ViZW1hcHMuc2V0KCB0ZXh0dXJlLCByZW5kZXJUYXJnZXQgKTsKCgkJCQkJCXRleHR1cmUuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvblRleHR1cmVEaXNwb3NlICk7CgoJCQkJCQlyZXR1cm4gbWFwVGV4dHVyZU1hcHBpbmcoIHJlbmRlclRhcmdldC50ZXh0dXJlLCB0ZXh0dXJlLm1hcHBpbmcgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCS8vIGltYWdlIG5vdCB5ZXQgcmVhZHkuIHRyeSB0aGUgY29udmVyc2lvbiBuZXh0IGZyYW1lCgoJCQkJCQlyZXR1cm4gbnVsbDsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJfQoKCQlyZXR1cm4gdGV4dHVyZTsKCgl9CgoJZnVuY3Rpb24gb25UZXh0dXJlRGlzcG9zZSggZXZlbnQgKSB7CgoJCWNvbnN0IHRleHR1cmUgPSBldmVudC50YXJnZXQ7CgoJCXRleHR1cmUucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvblRleHR1cmVEaXNwb3NlICk7CgoJCWNvbnN0IGN1YmVtYXAgPSBjdWJlbWFwcy5nZXQoIHRleHR1cmUgKTsKCgkJaWYgKCBjdWJlbWFwICE9PSB1bmRlZmluZWQgKSB7CgoJCQljdWJlbWFwcy5kZWxldGUoIHRleHR1cmUgKTsKCQkJY3ViZW1hcC5kaXNwb3NlKCk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCgkJY3ViZW1hcHMgPSBuZXcgV2Vha01hcCgpOwoKCX0KCglyZXR1cm4gewoJCWdldDogZ2V0LAoJCWRpc3Bvc2U6IGRpc3Bvc2UKCX07Cgp9CgpjbGFzcyBPcnRob2dyYXBoaWNDYW1lcmEgZXh0ZW5kcyBDYW1lcmEgewoKCWNvbnN0cnVjdG9yKCBsZWZ0ID0gLSAxLCByaWdodCA9IDEsIHRvcCA9IDEsIGJvdHRvbSA9IC0gMSwgbmVhciA9IDAuMSwgZmFyID0gMjAwMCApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc09ydGhvZ3JhcGhpY0NhbWVyYSA9IHRydWU7CgoJCXRoaXMudHlwZSA9ICdPcnRob2dyYXBoaWNDYW1lcmEnOwoKCQl0aGlzLnpvb20gPSAxOwoJCXRoaXMudmlldyA9IG51bGw7CgoJCXRoaXMubGVmdCA9IGxlZnQ7CgkJdGhpcy5yaWdodCA9IHJpZ2h0OwoJCXRoaXMudG9wID0gdG9wOwoJCXRoaXMuYm90dG9tID0gYm90dG9tOwoKCQl0aGlzLm5lYXIgPSBuZWFyOwoJCXRoaXMuZmFyID0gZmFyOwoKCQl0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCgl9CgoJY29weSggc291cmNlLCByZWN1cnNpdmUgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgoJCXRoaXMubGVmdCA9IHNvdXJjZS5sZWZ0OwoJCXRoaXMucmlnaHQgPSBzb3VyY2UucmlnaHQ7CgkJdGhpcy50b3AgPSBzb3VyY2UudG9wOwoJCXRoaXMuYm90dG9tID0gc291cmNlLmJvdHRvbTsKCQl0aGlzLm5lYXIgPSBzb3VyY2UubmVhcjsKCQl0aGlzLmZhciA9IHNvdXJjZS5mYXI7CgoJCXRoaXMuem9vbSA9IHNvdXJjZS56b29tOwoJCXRoaXMudmlldyA9IHNvdXJjZS52aWV3ID09PSBudWxsID8gbnVsbCA6IE9iamVjdC5hc3NpZ24oIHt9LCBzb3VyY2UudmlldyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0Vmlld09mZnNldCggZnVsbFdpZHRoLCBmdWxsSGVpZ2h0LCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICkgewoKCQlpZiAoIHRoaXMudmlldyA9PT0gbnVsbCApIHsKCgkJCXRoaXMudmlldyA9IHsKCQkJCWVuYWJsZWQ6IHRydWUsCgkJCQlmdWxsV2lkdGg6IDEsCgkJCQlmdWxsSGVpZ2h0OiAxLAoJCQkJb2Zmc2V0WDogMCwKCQkJCW9mZnNldFk6IDAsCgkJCQl3aWR0aDogMSwKCQkJCWhlaWdodDogMQoJCQl9OwoKCQl9CgoJCXRoaXMudmlldy5lbmFibGVkID0gdHJ1ZTsKCQl0aGlzLnZpZXcuZnVsbFdpZHRoID0gZnVsbFdpZHRoOwoJCXRoaXMudmlldy5mdWxsSGVpZ2h0ID0gZnVsbEhlaWdodDsKCQl0aGlzLnZpZXcub2Zmc2V0WCA9IHg7CgkJdGhpcy52aWV3Lm9mZnNldFkgPSB5OwoJCXRoaXMudmlldy53aWR0aCA9IHdpZHRoOwoJCXRoaXMudmlldy5oZWlnaHQgPSBoZWlnaHQ7CgoJCXRoaXMudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCX0KCgljbGVhclZpZXdPZmZzZXQoKSB7CgoJCWlmICggdGhpcy52aWV3ICE9PSBudWxsICkgewoKCQkJdGhpcy52aWV3LmVuYWJsZWQgPSBmYWxzZTsKCgkJfQoKCQl0aGlzLnVwZGF0ZVByb2plY3Rpb25NYXRyaXgoKTsKCgl9CgoJdXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpIHsKCgkJY29uc3QgZHggPSAoIHRoaXMucmlnaHQgLSB0aGlzLmxlZnQgKSAvICggMiAqIHRoaXMuem9vbSApOwoJCWNvbnN0IGR5ID0gKCB0aGlzLnRvcCAtIHRoaXMuYm90dG9tICkgLyAoIDIgKiB0aGlzLnpvb20gKTsKCQljb25zdCBjeCA9ICggdGhpcy5yaWdodCArIHRoaXMubGVmdCApIC8gMjsKCQljb25zdCBjeSA9ICggdGhpcy50b3AgKyB0aGlzLmJvdHRvbSApIC8gMjsKCgkJbGV0IGxlZnQgPSBjeCAtIGR4OwoJCWxldCByaWdodCA9IGN4ICsgZHg7CgkJbGV0IHRvcCA9IGN5ICsgZHk7CgkJbGV0IGJvdHRvbSA9IGN5IC0gZHk7CgoJCWlmICggdGhpcy52aWV3ICE9PSBudWxsICYmIHRoaXMudmlldy5lbmFibGVkICkgewoKCQkJY29uc3Qgc2NhbGVXID0gKCB0aGlzLnJpZ2h0IC0gdGhpcy5sZWZ0ICkgLyB0aGlzLnZpZXcuZnVsbFdpZHRoIC8gdGhpcy56b29tOwoJCQljb25zdCBzY2FsZUggPSAoIHRoaXMudG9wIC0gdGhpcy5ib3R0b20gKSAvIHRoaXMudmlldy5mdWxsSGVpZ2h0IC8gdGhpcy56b29tOwoKCQkJbGVmdCArPSBzY2FsZVcgKiB0aGlzLnZpZXcub2Zmc2V0WDsKCQkJcmlnaHQgPSBsZWZ0ICsgc2NhbGVXICogdGhpcy52aWV3LndpZHRoOwoJCQl0b3AgLT0gc2NhbGVIICogdGhpcy52aWV3Lm9mZnNldFk7CgkJCWJvdHRvbSA9IHRvcCAtIHNjYWxlSCAqIHRoaXMudmlldy5oZWlnaHQ7CgoJCX0KCgkJdGhpcy5wcm9qZWN0aW9uTWF0cml4Lm1ha2VPcnRob2dyYXBoaWMoIGxlZnQsIHJpZ2h0LCB0b3AsIGJvdHRvbSwgdGhpcy5uZWFyLCB0aGlzLmZhciwgdGhpcy5jb29yZGluYXRlU3lzdGVtICk7CgoJCXRoaXMucHJvamVjdGlvbk1hdHJpeEludmVyc2UuY29weSggdGhpcy5wcm9qZWN0aW9uTWF0cml4ICkuaW52ZXJ0KCk7CgoJfQoKCXRvSlNPTiggbWV0YSApIHsKCgkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTiggbWV0YSApOwoKCQlkYXRhLm9iamVjdC56b29tID0gdGhpcy56b29tOwoJCWRhdGEub2JqZWN0LmxlZnQgPSB0aGlzLmxlZnQ7CgkJZGF0YS5vYmplY3QucmlnaHQgPSB0aGlzLnJpZ2h0OwoJCWRhdGEub2JqZWN0LnRvcCA9IHRoaXMudG9wOwoJCWRhdGEub2JqZWN0LmJvdHRvbSA9IHRoaXMuYm90dG9tOwoJCWRhdGEub2JqZWN0Lm5lYXIgPSB0aGlzLm5lYXI7CgkJZGF0YS5vYmplY3QuZmFyID0gdGhpcy5mYXI7CgoJCWlmICggdGhpcy52aWV3ICE9PSBudWxsICkgZGF0YS5vYmplY3QudmlldyA9IE9iamVjdC5hc3NpZ24oIHt9LCB0aGlzLnZpZXcgKTsKCgkJcmV0dXJuIGRhdGE7CgoJfQoKfQoKY29uc3QgTE9EX01JTiA9IDQ7CgovLyBUaGUgc3RhbmRhcmQgZGV2aWF0aW9ucyAocmFkaWFucykgYXNzb2NpYXRlZCB3aXRoIHRoZSBleHRyYSBtaXBzLiBUaGVzZSBhcmUKLy8gY2hvc2VuIHRvIGFwcHJveGltYXRlIGEgVHJvd2JyaWRnZS1SZWl0eiBkaXN0cmlidXRpb24gZnVuY3Rpb24gdGltZXMgdGhlCi8vIGdlb21ldHJpYyBzaGFkb3dpbmcgZnVuY3Rpb24uIFRoZXNlIHNpZ21hIHZhbHVlcyBzcXVhcmVkIG11c3QgbWF0Y2ggdGhlCi8vIHZhcmlhbmNlICNkZWZpbmVzIGluIGN1YmVfdXZfcmVmbGVjdGlvbl9mcmFnbWVudC5nbHNsLmpzLgpjb25zdCBFWFRSQV9MT0RfU0lHTUEgPSBbIDAuMTI1LCAwLjIxNSwgMC4zNSwgMC40NDYsIDAuNTI2LCAwLjU4MiBdOwoKLy8gVGhlIG1heGltdW0gbGVuZ3RoIG9mIHRoZSBibHVyIGZvciBsb29wLiBTbWFsbGVyIHNpZ21hcyB3aWxsIHVzZSBmZXdlcgovLyBzYW1wbGVzIGFuZCBleGl0IGVhcmx5LCBidXQgbm90IHJlY29tcGlsZSB0aGUgc2hhZGVyLgpjb25zdCBNQVhfU0FNUExFUyA9IDIwOwoKY29uc3QgX2ZsYXRDYW1lcmEgPSAvKkBfX1BVUkVfXyovIG5ldyBPcnRob2dyYXBoaWNDYW1lcmEoKTsKY29uc3QgX2NsZWFyQ29sb3IgPSAvKkBfX1BVUkVfXyovIG5ldyBDb2xvcigpOwpsZXQgX29sZFRhcmdldCA9IG51bGw7CgovLyBHb2xkZW4gUmF0aW8KY29uc3QgUEhJID0gKCAxICsgTWF0aC5zcXJ0KCA1ICkgKSAvIDI7CmNvbnN0IElOVl9QSEkgPSAxIC8gUEhJOwoKLy8gVmVydGljZXMgb2YgYSBkb2RlY2FoZWRyb24gKGV4Y2VwdCB0aGUgb3Bwb3NpdGVzLCB3aGljaCByZXByZXNlbnQgdGhlCi8vIHNhbWUgYXhpcyksIHVzZWQgYXMgYXhpcyBkaXJlY3Rpb25zIGV2ZW5seSBzcHJlYWQgb24gYSBzcGhlcmUuCmNvbnN0IF9heGlzRGlyZWN0aW9ucyA9IFsKCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIDEsIDEsIDEgKSwKCS8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoIC0gMSwgMSwgMSApLAoJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggMSwgMSwgLSAxICksCgkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAtIDEsIDEsIC0gMSApLAoJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggMCwgUEhJLCBJTlZfUEhJICksCgkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAwLCBQSEksIC0gSU5WX1BISSApLAoJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggSU5WX1BISSwgMCwgUEhJICksCgkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAtIElOVl9QSEksIDAsIFBISSApLAoJLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMyggUEhJLCBJTlZfUEhJLCAwICksCgkvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCAtIFBISSwgSU5WX1BISSwgMCApIF07CgovKioKICogVGhpcyBjbGFzcyBnZW5lcmF0ZXMgYSBQcmVmaWx0ZXJlZCwgTWlwbWFwcGVkIFJhZGlhbmNlIEVudmlyb25tZW50IE1hcAogKiAoUE1SRU0pIGZyb20gYSBjdWJlTWFwIGVudmlyb25tZW50IHRleHR1cmUuIFRoaXMgYWxsb3dzIGRpZmZlcmVudCBsZXZlbHMgb2YKICogYmx1ciB0byBiZSBxdWlja2x5IGFjY2Vzc2VkIGJhc2VkIG9uIG1hdGVyaWFsIHJvdWdobmVzcy4gSXQgaXMgcGFja2VkIGludG8gYQogKiBzcGVjaWFsIEN1YmVVViBmb3JtYXQgdGhhdCBhbGxvd3MgdXMgdG8gcGVyZm9ybSBjdXN0b20gaW50ZXJwb2xhdGlvbiBzbyB0aGF0CiAqIHdlIGNhbiBzdXBwb3J0IG5vbmxpbmVhciBmb3JtYXRzIHN1Y2ggYXMgUkdCRS4gVW5saWtlIGEgdHJhZGl0aW9uYWwgbWlwbWFwCiAqIGNoYWluLCBpdCBvbmx5IGdvZXMgZG93biB0byB0aGUgTE9EX01JTiBsZXZlbCAoYWJvdmUpLCBhbmQgdGhlbiBjcmVhdGVzIGV4dHJhCiAqIGV2ZW4gbW9yZSBmaWx0ZXJlZCAnbWlwcycgYXQgdGhlIHNhbWUgTE9EX01JTiByZXNvbHV0aW9uLCBhc3NvY2lhdGVkIHdpdGgKICogaGlnaGVyIHJvdWdobmVzcyBsZXZlbHMuIEluIHRoaXMgd2F5IHdlIG1haW50YWluIHJlc29sdXRpb24gdG8gc21vb3RobHkKICogaW50ZXJwb2xhdGUgZGlmZnVzZSBsaWdodGluZyB3aGlsZSBsaW1pdGluZyBzYW1wbGluZyBjb21wdXRhdGlvbi4KICoKICogUGFwZXI6IEZhc3QsIEFjY3VyYXRlIEltYWdlLUJhc2VkIExpZ2h0aW5nCiAqIGh0dHBzOi8vZHJpdmUuZ29vZ2xlLmNvbS9maWxlL2QvMTV5OHJfVXBLbFU5U3ZWNElMYjBDM3FDUGVjUzhwdkx6L3ZpZXcKKi8KCmNsYXNzIFBNUkVNR2VuZXJhdG9yIHsKCgljb25zdHJ1Y3RvciggcmVuZGVyZXIgKSB7CgoJCXRoaXMuX3JlbmRlcmVyID0gcmVuZGVyZXI7CgkJdGhpcy5fcGluZ1BvbmdSZW5kZXJUYXJnZXQgPSBudWxsOwoKCQl0aGlzLl9sb2RNYXggPSAwOwoJCXRoaXMuX2N1YmVTaXplID0gMDsKCQl0aGlzLl9sb2RQbGFuZXMgPSBbXTsKCQl0aGlzLl9zaXplTG9kcyA9IFtdOwoJCXRoaXMuX3NpZ21hcyA9IFtdOwoKCQl0aGlzLl9ibHVyTWF0ZXJpYWwgPSBudWxsOwoJCXRoaXMuX2N1YmVtYXBNYXRlcmlhbCA9IG51bGw7CgkJdGhpcy5fZXF1aXJlY3RNYXRlcmlhbCA9IG51bGw7CgoJCXRoaXMuX2NvbXBpbGVNYXRlcmlhbCggdGhpcy5fYmx1ck1hdGVyaWFsICk7CgoJfQoKCS8qKgoJICogR2VuZXJhdGVzIGEgUE1SRU0gZnJvbSBhIHN1cHBsaWVkIFNjZW5lLCB3aGljaCBjYW4gYmUgZmFzdGVyIHRoYW4gdXNpbmcgYW4KCSAqIGltYWdlIGlmIG5ldHdvcmtpbmcgYmFuZHdpZHRoIGlzIGxvdy4gT3B0aW9uYWwgc2lnbWEgc3BlY2lmaWVzIGEgYmx1ciByYWRpdXMKCSAqIGluIHJhZGlhbnMgdG8gYmUgYXBwbGllZCB0byB0aGUgc2NlbmUgYmVmb3JlIFBNUkVNIGdlbmVyYXRpb24uIE9wdGlvbmFsIG5lYXIKCSAqIGFuZCBmYXIgcGxhbmVzIGVuc3VyZSB0aGUgc2NlbmUgaXMgcmVuZGVyZWQgaW4gaXRzIGVudGlyZXR5ICh0aGUgY3ViZUNhbWVyYQoJICogaXMgcGxhY2VkIGF0IHRoZSBvcmlnaW4pLgoJICovCglmcm9tU2NlbmUoIHNjZW5lLCBzaWdtYSA9IDAsIG5lYXIgPSAwLjEsIGZhciA9IDEwMCApIHsKCgkJX29sZFRhcmdldCA9IHRoaXMuX3JlbmRlcmVyLmdldFJlbmRlclRhcmdldCgpOwoKCQl0aGlzLl9zZXRTaXplKCAyNTYgKTsKCgkJY29uc3QgY3ViZVVWUmVuZGVyVGFyZ2V0ID0gdGhpcy5fYWxsb2NhdGVUYXJnZXRzKCk7CgkJY3ViZVVWUmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyID0gdHJ1ZTsKCgkJdGhpcy5fc2NlbmVUb0N1YmVVViggc2NlbmUsIG5lYXIsIGZhciwgY3ViZVVWUmVuZGVyVGFyZ2V0ICk7CgoJCWlmICggc2lnbWEgPiAwICkgewoKCQkJdGhpcy5fYmx1ciggY3ViZVVWUmVuZGVyVGFyZ2V0LCAwLCAwLCBzaWdtYSApOwoKCQl9CgoJCXRoaXMuX2FwcGx5UE1SRU0oIGN1YmVVVlJlbmRlclRhcmdldCApOwoJCXRoaXMuX2NsZWFudXAoIGN1YmVVVlJlbmRlclRhcmdldCApOwoKCQlyZXR1cm4gY3ViZVVWUmVuZGVyVGFyZ2V0OwoKCX0KCgkvKioKCSAqIEdlbmVyYXRlcyBhIFBNUkVNIGZyb20gYW4gZXF1aXJlY3Rhbmd1bGFyIHRleHR1cmUsIHdoaWNoIGNhbiBiZSBlaXRoZXIgTERSCgkgKiBvciBIRFIuIFRoZSBpZGVhbCBpbnB1dCBpbWFnZSBzaXplIGlzIDFrICgxMDI0IHggNTEyKSwKCSAqIGFzIHRoaXMgbWF0Y2hlcyBiZXN0IHdpdGggdGhlIDI1NiB4IDI1NiBjdWJlbWFwIG91dHB1dC4KCSAqLwoJZnJvbUVxdWlyZWN0YW5ndWxhciggZXF1aXJlY3Rhbmd1bGFyLCByZW5kZXJUYXJnZXQgPSBudWxsICkgewoKCQlyZXR1cm4gdGhpcy5fZnJvbVRleHR1cmUoIGVxdWlyZWN0YW5ndWxhciwgcmVuZGVyVGFyZ2V0ICk7CgoJfQoKCS8qKgoJICogR2VuZXJhdGVzIGEgUE1SRU0gZnJvbSBhbiBjdWJlbWFwIHRleHR1cmUsIHdoaWNoIGNhbiBiZSBlaXRoZXIgTERSCgkgKiBvciBIRFIuIFRoZSBpZGVhbCBpbnB1dCBjdWJlIHNpemUgaXMgMjU2IHggMjU2LAoJICogYXMgdGhpcyBtYXRjaGVzIGJlc3Qgd2l0aCB0aGUgMjU2IHggMjU2IGN1YmVtYXAgb3V0cHV0LgoJICovCglmcm9tQ3ViZW1hcCggY3ViZW1hcCwgcmVuZGVyVGFyZ2V0ID0gbnVsbCApIHsKCgkJcmV0dXJuIHRoaXMuX2Zyb21UZXh0dXJlKCBjdWJlbWFwLCByZW5kZXJUYXJnZXQgKTsKCgl9CgoJLyoqCgkgKiBQcmUtY29tcGlsZXMgdGhlIGN1YmVtYXAgc2hhZGVyLiBZb3UgY2FuIGdldCBmYXN0ZXIgc3RhcnQtdXAgYnkgaW52b2tpbmcgdGhpcyBtZXRob2QgZHVyaW5nCgkgKiB5b3VyIHRleHR1cmUncyBuZXR3b3JrIGZldGNoIGZvciBpbmNyZWFzZWQgY29uY3VycmVuY3kuCgkgKi8KCWNvbXBpbGVDdWJlbWFwU2hhZGVyKCkgewoKCQlpZiAoIHRoaXMuX2N1YmVtYXBNYXRlcmlhbCA9PT0gbnVsbCApIHsKCgkJCXRoaXMuX2N1YmVtYXBNYXRlcmlhbCA9IF9nZXRDdWJlbWFwTWF0ZXJpYWwoKTsKCQkJdGhpcy5fY29tcGlsZU1hdGVyaWFsKCB0aGlzLl9jdWJlbWFwTWF0ZXJpYWwgKTsKCgkJfQoKCX0KCgkvKioKCSAqIFByZS1jb21waWxlcyB0aGUgZXF1aXJlY3Rhbmd1bGFyIHNoYWRlci4gWW91IGNhbiBnZXQgZmFzdGVyIHN0YXJ0LXVwIGJ5IGludm9raW5nIHRoaXMgbWV0aG9kIGR1cmluZwoJICogeW91ciB0ZXh0dXJlJ3MgbmV0d29yayBmZXRjaCBmb3IgaW5jcmVhc2VkIGNvbmN1cnJlbmN5LgoJICovCgljb21waWxlRXF1aXJlY3Rhbmd1bGFyU2hhZGVyKCkgewoKCQlpZiAoIHRoaXMuX2VxdWlyZWN0TWF0ZXJpYWwgPT09IG51bGwgKSB7CgoJCQl0aGlzLl9lcXVpcmVjdE1hdGVyaWFsID0gX2dldEVxdWlyZWN0TWF0ZXJpYWwoKTsKCQkJdGhpcy5fY29tcGlsZU1hdGVyaWFsKCB0aGlzLl9lcXVpcmVjdE1hdGVyaWFsICk7CgoJCX0KCgl9CgoJLyoqCgkgKiBEaXNwb3NlcyBvZiB0aGUgUE1SRU1HZW5lcmF0b3IncyBpbnRlcm5hbCBtZW1vcnkuIE5vdGUgdGhhdCBQTVJFTUdlbmVyYXRvciBpcyBhIHN0YXRpYyBjbGFzcywKCSAqIHNvIHlvdSBzaG91bGQgbm90IG5lZWQgbW9yZSB0aGFuIG9uZSBQTVJFTUdlbmVyYXRvciBvYmplY3QuIElmIHlvdSBkbywgY2FsbGluZyBkaXNwb3NlKCkgb24KCSAqIG9uZSBvZiB0aGVtIHdpbGwgY2F1c2UgYW55IG90aGVycyB0byBhbHNvIGJlY29tZSB1bnVzYWJsZS4KCSAqLwoJZGlzcG9zZSgpIHsKCgkJdGhpcy5fZGlzcG9zZSgpOwoKCQlpZiAoIHRoaXMuX2N1YmVtYXBNYXRlcmlhbCAhPT0gbnVsbCApIHRoaXMuX2N1YmVtYXBNYXRlcmlhbC5kaXNwb3NlKCk7CgkJaWYgKCB0aGlzLl9lcXVpcmVjdE1hdGVyaWFsICE9PSBudWxsICkgdGhpcy5fZXF1aXJlY3RNYXRlcmlhbC5kaXNwb3NlKCk7CgoJfQoKCS8vIHByaXZhdGUgaW50ZXJmYWNlCgoJX3NldFNpemUoIGN1YmVTaXplICkgewoKCQl0aGlzLl9sb2RNYXggPSBNYXRoLmZsb29yKCBNYXRoLmxvZzIoIGN1YmVTaXplICkgKTsKCQl0aGlzLl9jdWJlU2l6ZSA9IE1hdGgucG93KCAyLCB0aGlzLl9sb2RNYXggKTsKCgl9CgoJX2Rpc3Bvc2UoKSB7CgoJCWlmICggdGhpcy5fYmx1ck1hdGVyaWFsICE9PSBudWxsICkgdGhpcy5fYmx1ck1hdGVyaWFsLmRpc3Bvc2UoKTsKCgkJaWYgKCB0aGlzLl9waW5nUG9uZ1JlbmRlclRhcmdldCAhPT0gbnVsbCApIHRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0LmRpc3Bvc2UoKTsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy5fbG9kUGxhbmVzLmxlbmd0aDsgaSArKyApIHsKCgkJCXRoaXMuX2xvZFBsYW5lc1sgaSBdLmRpc3Bvc2UoKTsKCgkJfQoKCX0KCglfY2xlYW51cCggb3V0cHV0VGFyZ2V0ICkgewoKCQl0aGlzLl9yZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIF9vbGRUYXJnZXQgKTsKCQlvdXRwdXRUYXJnZXQuc2Npc3NvclRlc3QgPSBmYWxzZTsKCQlfc2V0Vmlld3BvcnQoIG91dHB1dFRhcmdldCwgMCwgMCwgb3V0cHV0VGFyZ2V0LndpZHRoLCBvdXRwdXRUYXJnZXQuaGVpZ2h0ICk7CgoJfQoKCV9mcm9tVGV4dHVyZSggdGV4dHVyZSwgcmVuZGVyVGFyZ2V0ICkgewoKCQlpZiAoIHRleHR1cmUubWFwcGluZyA9PT0gQ3ViZVJlZmxlY3Rpb25NYXBwaW5nIHx8IHRleHR1cmUubWFwcGluZyA9PT0gQ3ViZVJlZnJhY3Rpb25NYXBwaW5nICkgewoKCQkJdGhpcy5fc2V0U2l6ZSggdGV4dHVyZS5pbWFnZS5sZW5ndGggPT09IDAgPyAxNiA6ICggdGV4dHVyZS5pbWFnZVsgMCBdLndpZHRoIHx8IHRleHR1cmUuaW1hZ2VbIDAgXS5pbWFnZS53aWR0aCApICk7CgoJCX0gZWxzZSB7IC8vIEVxdWlyZWN0YW5ndWxhcgoKCQkJdGhpcy5fc2V0U2l6ZSggdGV4dHVyZS5pbWFnZS53aWR0aCAvIDQgKTsKCgkJfQoKCQlfb2xkVGFyZ2V0ID0gdGhpcy5fcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CgoJCWNvbnN0IGN1YmVVVlJlbmRlclRhcmdldCA9IHJlbmRlclRhcmdldCB8fCB0aGlzLl9hbGxvY2F0ZVRhcmdldHMoKTsKCQl0aGlzLl90ZXh0dXJlVG9DdWJlVVYoIHRleHR1cmUsIGN1YmVVVlJlbmRlclRhcmdldCApOwoJCXRoaXMuX2FwcGx5UE1SRU0oIGN1YmVVVlJlbmRlclRhcmdldCApOwoJCXRoaXMuX2NsZWFudXAoIGN1YmVVVlJlbmRlclRhcmdldCApOwoKCQlyZXR1cm4gY3ViZVVWUmVuZGVyVGFyZ2V0OwoKCX0KCglfYWxsb2NhdGVUYXJnZXRzKCkgewoKCQljb25zdCB3aWR0aCA9IDMgKiBNYXRoLm1heCggdGhpcy5fY3ViZVNpemUsIDE2ICogNyApOwoJCWNvbnN0IGhlaWdodCA9IDQgKiB0aGlzLl9jdWJlU2l6ZTsKCgkJY29uc3QgcGFyYW1zID0gewoJCQltYWdGaWx0ZXI6IExpbmVhckZpbHRlciwKCQkJbWluRmlsdGVyOiBMaW5lYXJGaWx0ZXIsCgkJCWdlbmVyYXRlTWlwbWFwczogZmFsc2UsCgkJCXR5cGU6IEhhbGZGbG9hdFR5cGUsCgkJCWZvcm1hdDogUkdCQUZvcm1hdCwKCQkJY29sb3JTcGFjZTogTGluZWFyU1JHQkNvbG9yU3BhY2UsCgkJCWRlcHRoQnVmZmVyOiBmYWxzZQoJCX07CgoJCWNvbnN0IGN1YmVVVlJlbmRlclRhcmdldCA9IF9jcmVhdGVSZW5kZXJUYXJnZXQoIHdpZHRoLCBoZWlnaHQsIHBhcmFtcyApOwoKCQlpZiAoIHRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0ID09PSBudWxsIHx8IHRoaXMuX3BpbmdQb25nUmVuZGVyVGFyZ2V0LndpZHRoICE9PSB3aWR0aCB8fCB0aGlzLl9waW5nUG9uZ1JlbmRlclRhcmdldC5oZWlnaHQgIT09IGhlaWdodCApIHsKCgkJCWlmICggdGhpcy5fcGluZ1BvbmdSZW5kZXJUYXJnZXQgIT09IG51bGwgKSB7CgoJCQkJdGhpcy5fZGlzcG9zZSgpOwoKCQkJfQoKCQkJdGhpcy5fcGluZ1BvbmdSZW5kZXJUYXJnZXQgPSBfY3JlYXRlUmVuZGVyVGFyZ2V0KCB3aWR0aCwgaGVpZ2h0LCBwYXJhbXMgKTsKCgkJCWNvbnN0IHsgX2xvZE1heCB9ID0gdGhpczsKCQkJKCB7IHNpemVMb2RzOiB0aGlzLl9zaXplTG9kcywgbG9kUGxhbmVzOiB0aGlzLl9sb2RQbGFuZXMsIHNpZ21hczogdGhpcy5fc2lnbWFzIH0gPSBfY3JlYXRlUGxhbmVzKCBfbG9kTWF4ICkgKTsKCgkJCXRoaXMuX2JsdXJNYXRlcmlhbCA9IF9nZXRCbHVyU2hhZGVyKCBfbG9kTWF4LCB3aWR0aCwgaGVpZ2h0ICk7CgoJCX0KCgkJcmV0dXJuIGN1YmVVVlJlbmRlclRhcmdldDsKCgl9CgoJX2NvbXBpbGVNYXRlcmlhbCggbWF0ZXJpYWwgKSB7CgoJCWNvbnN0IHRtcE1lc2ggPSBuZXcgTWVzaCggdGhpcy5fbG9kUGxhbmVzWyAwIF0sIG1hdGVyaWFsICk7CgkJdGhpcy5fcmVuZGVyZXIuY29tcGlsZSggdG1wTWVzaCwgX2ZsYXRDYW1lcmEgKTsKCgl9CgoJX3NjZW5lVG9DdWJlVVYoIHNjZW5lLCBuZWFyLCBmYXIsIGN1YmVVVlJlbmRlclRhcmdldCApIHsKCgkJY29uc3QgZm92ID0gOTA7CgkJY29uc3QgYXNwZWN0ID0gMTsKCQljb25zdCBjdWJlQ2FtZXJhID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBmb3YsIGFzcGVjdCwgbmVhciwgZmFyICk7CgkJY29uc3QgdXBTaWduID0gWyAxLCAtIDEsIDEsIDEsIDEsIDEgXTsKCQljb25zdCBmb3J3YXJkU2lnbiA9IFsgMSwgMSwgMSwgLSAxLCAtIDEsIC0gMSBdOwoJCWNvbnN0IHJlbmRlcmVyID0gdGhpcy5fcmVuZGVyZXI7CgoJCWNvbnN0IG9yaWdpbmFsQXV0b0NsZWFyID0gcmVuZGVyZXIuYXV0b0NsZWFyOwoJCWNvbnN0IHRvbmVNYXBwaW5nID0gcmVuZGVyZXIudG9uZU1hcHBpbmc7CgkJcmVuZGVyZXIuZ2V0Q2xlYXJDb2xvciggX2NsZWFyQ29sb3IgKTsKCgkJcmVuZGVyZXIudG9uZU1hcHBpbmcgPSBOb1RvbmVNYXBwaW5nOwoJCXJlbmRlcmVyLmF1dG9DbGVhciA9IGZhbHNlOwoKCQljb25zdCBiYWNrZ3JvdW5kTWF0ZXJpYWwgPSBuZXcgTWVzaEJhc2ljTWF0ZXJpYWwoIHsKCQkJbmFtZTogJ1BNUkVNLkJhY2tncm91bmQnLAoJCQlzaWRlOiBCYWNrU2lkZSwKCQkJZGVwdGhXcml0ZTogZmFsc2UsCgkJCWRlcHRoVGVzdDogZmFsc2UsCgkJfSApOwoKCQljb25zdCBiYWNrZ3JvdW5kQm94ID0gbmV3IE1lc2goIG5ldyBCb3hHZW9tZXRyeSgpLCBiYWNrZ3JvdW5kTWF0ZXJpYWwgKTsKCgkJbGV0IHVzZVNvbGlkQ29sb3IgPSBmYWxzZTsKCQljb25zdCBiYWNrZ3JvdW5kID0gc2NlbmUuYmFja2dyb3VuZDsKCgkJaWYgKCBiYWNrZ3JvdW5kICkgewoKCQkJaWYgKCBiYWNrZ3JvdW5kLmlzQ29sb3IgKSB7CgoJCQkJYmFja2dyb3VuZE1hdGVyaWFsLmNvbG9yLmNvcHkoIGJhY2tncm91bmQgKTsKCQkJCXNjZW5lLmJhY2tncm91bmQgPSBudWxsOwoJCQkJdXNlU29saWRDb2xvciA9IHRydWU7CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQliYWNrZ3JvdW5kTWF0ZXJpYWwuY29sb3IuY29weSggX2NsZWFyQ29sb3IgKTsKCQkJdXNlU29saWRDb2xvciA9IHRydWU7CgoJCX0KCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSArKyApIHsKCgkJCWNvbnN0IGNvbCA9IGkgJSAzOwoKCQkJaWYgKCBjb2wgPT09IDAgKSB7CgoJCQkJY3ViZUNhbWVyYS51cC5zZXQoIDAsIHVwU2lnblsgaSBdLCAwICk7CgkJCQljdWJlQ2FtZXJhLmxvb2tBdCggZm9yd2FyZFNpZ25bIGkgXSwgMCwgMCApOwoKCQkJfSBlbHNlIGlmICggY29sID09PSAxICkgewoKCQkJCWN1YmVDYW1lcmEudXAuc2V0KCAwLCAwLCB1cFNpZ25bIGkgXSApOwoJCQkJY3ViZUNhbWVyYS5sb29rQXQoIDAsIGZvcndhcmRTaWduWyBpIF0sIDAgKTsKCgkJCX0gZWxzZSB7CgoJCQkJY3ViZUNhbWVyYS51cC5zZXQoIDAsIHVwU2lnblsgaSBdLCAwICk7CgkJCQljdWJlQ2FtZXJhLmxvb2tBdCggMCwgMCwgZm9yd2FyZFNpZ25bIGkgXSApOwoKCQkJfQoKCQkJY29uc3Qgc2l6ZSA9IHRoaXMuX2N1YmVTaXplOwoKCQkJX3NldFZpZXdwb3J0KCBjdWJlVVZSZW5kZXJUYXJnZXQsIGNvbCAqIHNpemUsIGkgPiAyID8gc2l6ZSA6IDAsIHNpemUsIHNpemUgKTsKCgkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggY3ViZVVWUmVuZGVyVGFyZ2V0ICk7CgoJCQlpZiAoIHVzZVNvbGlkQ29sb3IgKSB7CgoJCQkJcmVuZGVyZXIucmVuZGVyKCBiYWNrZ3JvdW5kQm94LCBjdWJlQ2FtZXJhICk7CgoJCQl9CgoJCQlyZW5kZXJlci5yZW5kZXIoIHNjZW5lLCBjdWJlQ2FtZXJhICk7CgoJCX0KCgkJYmFja2dyb3VuZEJveC5nZW9tZXRyeS5kaXNwb3NlKCk7CgkJYmFja2dyb3VuZEJveC5tYXRlcmlhbC5kaXNwb3NlKCk7CgoJCXJlbmRlcmVyLnRvbmVNYXBwaW5nID0gdG9uZU1hcHBpbmc7CgkJcmVuZGVyZXIuYXV0b0NsZWFyID0gb3JpZ2luYWxBdXRvQ2xlYXI7CgkJc2NlbmUuYmFja2dyb3VuZCA9IGJhY2tncm91bmQ7CgoJfQoKCV90ZXh0dXJlVG9DdWJlVVYoIHRleHR1cmUsIGN1YmVVVlJlbmRlclRhcmdldCApIHsKCgkJY29uc3QgcmVuZGVyZXIgPSB0aGlzLl9yZW5kZXJlcjsKCgkJY29uc3QgaXNDdWJlVGV4dHVyZSA9ICggdGV4dHVyZS5tYXBwaW5nID09PSBDdWJlUmVmbGVjdGlvbk1hcHBpbmcgfHwgdGV4dHVyZS5tYXBwaW5nID09PSBDdWJlUmVmcmFjdGlvbk1hcHBpbmcgKTsKCgkJaWYgKCBpc0N1YmVUZXh0dXJlICkgewoKCQkJaWYgKCB0aGlzLl9jdWJlbWFwTWF0ZXJpYWwgPT09IG51bGwgKSB7CgoJCQkJdGhpcy5fY3ViZW1hcE1hdGVyaWFsID0gX2dldEN1YmVtYXBNYXRlcmlhbCgpOwoKCQkJfQoKCQkJdGhpcy5fY3ViZW1hcE1hdGVyaWFsLnVuaWZvcm1zLmZsaXBFbnZNYXAudmFsdWUgPSAoIHRleHR1cmUuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID09PSBmYWxzZSApID8gLSAxIDogMTsKCgkJfSBlbHNlIHsKCgkJCWlmICggdGhpcy5fZXF1aXJlY3RNYXRlcmlhbCA9PT0gbnVsbCApIHsKCgkJCQl0aGlzLl9lcXVpcmVjdE1hdGVyaWFsID0gX2dldEVxdWlyZWN0TWF0ZXJpYWwoKTsKCgkJCX0KCgkJfQoKCQljb25zdCBtYXRlcmlhbCA9IGlzQ3ViZVRleHR1cmUgPyB0aGlzLl9jdWJlbWFwTWF0ZXJpYWwgOiB0aGlzLl9lcXVpcmVjdE1hdGVyaWFsOwoJCWNvbnN0IG1lc2ggPSBuZXcgTWVzaCggdGhpcy5fbG9kUGxhbmVzWyAwIF0sIG1hdGVyaWFsICk7CgoJCWNvbnN0IHVuaWZvcm1zID0gbWF0ZXJpYWwudW5pZm9ybXM7CgoJCXVuaWZvcm1zWyAnZW52TWFwJyBdLnZhbHVlID0gdGV4dHVyZTsKCgkJY29uc3Qgc2l6ZSA9IHRoaXMuX2N1YmVTaXplOwoKCQlfc2V0Vmlld3BvcnQoIGN1YmVVVlJlbmRlclRhcmdldCwgMCwgMCwgMyAqIHNpemUsIDIgKiBzaXplICk7CgoJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggY3ViZVVWUmVuZGVyVGFyZ2V0ICk7CgkJcmVuZGVyZXIucmVuZGVyKCBtZXNoLCBfZmxhdENhbWVyYSApOwoKCX0KCglfYXBwbHlQTVJFTSggY3ViZVVWUmVuZGVyVGFyZ2V0ICkgewoKCQljb25zdCByZW5kZXJlciA9IHRoaXMuX3JlbmRlcmVyOwoJCWNvbnN0IGF1dG9DbGVhciA9IHJlbmRlcmVyLmF1dG9DbGVhcjsKCQlyZW5kZXJlci5hdXRvQ2xlYXIgPSBmYWxzZTsKCgkJZm9yICggbGV0IGkgPSAxOyBpIDwgdGhpcy5fbG9kUGxhbmVzLmxlbmd0aDsgaSArKyApIHsKCgkJCWNvbnN0IHNpZ21hID0gTWF0aC5zcXJ0KCB0aGlzLl9zaWdtYXNbIGkgXSAqIHRoaXMuX3NpZ21hc1sgaSBdIC0gdGhpcy5fc2lnbWFzWyBpIC0gMSBdICogdGhpcy5fc2lnbWFzWyBpIC0gMSBdICk7CgoJCQljb25zdCBwb2xlQXhpcyA9IF9heGlzRGlyZWN0aW9uc1sgKCBpIC0gMSApICUgX2F4aXNEaXJlY3Rpb25zLmxlbmd0aCBdOwoKCQkJdGhpcy5fYmx1ciggY3ViZVVWUmVuZGVyVGFyZ2V0LCBpIC0gMSwgaSwgc2lnbWEsIHBvbGVBeGlzICk7CgoJCX0KCgkJcmVuZGVyZXIuYXV0b0NsZWFyID0gYXV0b0NsZWFyOwoKCX0KCgkvKioKCSAqIFRoaXMgaXMgYSB0d28tcGFzcyBHYXVzc2lhbiBibHVyIGZvciBhIGN1YmVtYXAuIE5vcm1hbGx5IHRoaXMgaXMgZG9uZQoJICogdmVydGljYWxseSBhbmQgaG9yaXpvbnRhbGx5LCBidXQgdGhpcyBicmVha3MgZG93biBvbiBhIGN1YmUuIEhlcmUgd2UgYXBwbHkKCSAqIHRoZSBibHVyIGxhdGl0dWRpbmFsbHkgKGFyb3VuZCB0aGUgcG9sZXMpLCBhbmQgdGhlbiBsb25naXR1ZGluYWxseSAodG93YXJkcwoJICogdGhlIHBvbGVzKSB0byBhcHByb3hpbWF0ZSB0aGUgb3J0aG9nb25hbGx5LXNlcGFyYWJsZSBibHVyLiBJdCBpcyBsZWFzdAoJICogYWNjdXJhdGUgYXQgdGhlIHBvbGVzLCBidXQgc3RpbGwgZG9lcyBhIGRlY2VudCBqb2IuCgkgKi8KCV9ibHVyKCBjdWJlVVZSZW5kZXJUYXJnZXQsIGxvZEluLCBsb2RPdXQsIHNpZ21hLCBwb2xlQXhpcyApIHsKCgkJY29uc3QgcGluZ1BvbmdSZW5kZXJUYXJnZXQgPSB0aGlzLl9waW5nUG9uZ1JlbmRlclRhcmdldDsKCgkJdGhpcy5faGFsZkJsdXIoCgkJCWN1YmVVVlJlbmRlclRhcmdldCwKCQkJcGluZ1BvbmdSZW5kZXJUYXJnZXQsCgkJCWxvZEluLAoJCQlsb2RPdXQsCgkJCXNpZ21hLAoJCQknbGF0aXR1ZGluYWwnLAoJCQlwb2xlQXhpcyApOwoKCQl0aGlzLl9oYWxmQmx1cigKCQkJcGluZ1BvbmdSZW5kZXJUYXJnZXQsCgkJCWN1YmVVVlJlbmRlclRhcmdldCwKCQkJbG9kT3V0LAoJCQlsb2RPdXQsCgkJCXNpZ21hLAoJCQknbG9uZ2l0dWRpbmFsJywKCQkJcG9sZUF4aXMgKTsKCgl9CgoJX2hhbGZCbHVyKCB0YXJnZXRJbiwgdGFyZ2V0T3V0LCBsb2RJbiwgbG9kT3V0LCBzaWdtYVJhZGlhbnMsIGRpcmVjdGlvbiwgcG9sZUF4aXMgKSB7CgoJCWNvbnN0IHJlbmRlcmVyID0gdGhpcy5fcmVuZGVyZXI7CgkJY29uc3QgYmx1ck1hdGVyaWFsID0gdGhpcy5fYmx1ck1hdGVyaWFsOwoKCQlpZiAoIGRpcmVjdGlvbiAhPT0gJ2xhdGl0dWRpbmFsJyAmJiBkaXJlY3Rpb24gIT09ICdsb25naXR1ZGluYWwnICkgewoKCQkJY29uc29sZS5lcnJvcigKCQkJCSdibHVyIGRpcmVjdGlvbiBtdXN0IGJlIGVpdGhlciBsYXRpdHVkaW5hbCBvciBsb25naXR1ZGluYWwhJyApOwoKCQl9CgoJCS8vIE51bWJlciBvZiBzdGFuZGFyZCBkZXZpYXRpb25zIGF0IHdoaWNoIHRvIGN1dCBvZmYgdGhlIGRpc2NyZXRlIGFwcHJveGltYXRpb24uCgkJY29uc3QgU1RBTkRBUkRfREVWSUFUSU9OUyA9IDM7CgoJCWNvbnN0IGJsdXJNZXNoID0gbmV3IE1lc2goIHRoaXMuX2xvZFBsYW5lc1sgbG9kT3V0IF0sIGJsdXJNYXRlcmlhbCApOwoJCWNvbnN0IGJsdXJVbmlmb3JtcyA9IGJsdXJNYXRlcmlhbC51bmlmb3JtczsKCgkJY29uc3QgcGl4ZWxzID0gdGhpcy5fc2l6ZUxvZHNbIGxvZEluIF0gLSAxOwoJCWNvbnN0IHJhZGlhbnNQZXJQaXhlbCA9IGlzRmluaXRlKCBzaWdtYVJhZGlhbnMgKSA/IE1hdGguUEkgLyAoIDIgKiBwaXhlbHMgKSA6IDIgKiBNYXRoLlBJIC8gKCAyICogTUFYX1NBTVBMRVMgLSAxICk7CgkJY29uc3Qgc2lnbWFQaXhlbHMgPSBzaWdtYVJhZGlhbnMgLyByYWRpYW5zUGVyUGl4ZWw7CgkJY29uc3Qgc2FtcGxlcyA9IGlzRmluaXRlKCBzaWdtYVJhZGlhbnMgKSA/IDEgKyBNYXRoLmZsb29yKCBTVEFOREFSRF9ERVZJQVRJT05TICogc2lnbWFQaXhlbHMgKSA6IE1BWF9TQU1QTEVTOwoKCQlpZiAoIHNhbXBsZXMgPiBNQVhfU0FNUExFUyApIHsKCgkJCWNvbnNvbGUud2FybiggYHNpZ21hUmFkaWFucywgJHsKCQkJCXNpZ21hUmFkaWFuc30sIGlzIHRvbyBsYXJnZSBhbmQgd2lsbCBjbGlwLCBhcyBpdCByZXF1ZXN0ZWQgJHsKCQkJCXNhbXBsZXN9IHNhbXBsZXMgd2hlbiB0aGUgbWF4aW11bSBpcyBzZXQgdG8gJHtNQVhfU0FNUExFU31gICk7CgoJCX0KCgkJY29uc3Qgd2VpZ2h0cyA9IFtdOwoJCWxldCBzdW0gPSAwOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBNQVhfU0FNUExFUzsgKysgaSApIHsKCgkJCWNvbnN0IHggPSBpIC8gc2lnbWFQaXhlbHM7CgkJCWNvbnN0IHdlaWdodCA9IE1hdGguZXhwKCAtIHggKiB4IC8gMiApOwoJCQl3ZWlnaHRzLnB1c2goIHdlaWdodCApOwoKCQkJaWYgKCBpID09PSAwICkgewoKCQkJCXN1bSArPSB3ZWlnaHQ7CgoJCQl9IGVsc2UgaWYgKCBpIDwgc2FtcGxlcyApIHsKCgkJCQlzdW0gKz0gMiAqIHdlaWdodDsKCgkJCX0KCgkJfQoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB3ZWlnaHRzLmxlbmd0aDsgaSArKyApIHsKCgkJCXdlaWdodHNbIGkgXSA9IHdlaWdodHNbIGkgXSAvIHN1bTsKCgkJfQoKCQlibHVyVW5pZm9ybXNbICdlbnZNYXAnIF0udmFsdWUgPSB0YXJnZXRJbi50ZXh0dXJlOwoJCWJsdXJVbmlmb3Jtc1sgJ3NhbXBsZXMnIF0udmFsdWUgPSBzYW1wbGVzOwoJCWJsdXJVbmlmb3Jtc1sgJ3dlaWdodHMnIF0udmFsdWUgPSB3ZWlnaHRzOwoJCWJsdXJVbmlmb3Jtc1sgJ2xhdGl0dWRpbmFsJyBdLnZhbHVlID0gZGlyZWN0aW9uID09PSAnbGF0aXR1ZGluYWwnOwoKCQlpZiAoIHBvbGVBeGlzICkgewoKCQkJYmx1clVuaWZvcm1zWyAncG9sZUF4aXMnIF0udmFsdWUgPSBwb2xlQXhpczsKCgkJfQoKCQljb25zdCB7IF9sb2RNYXggfSA9IHRoaXM7CgkJYmx1clVuaWZvcm1zWyAnZFRoZXRhJyBdLnZhbHVlID0gcmFkaWFuc1BlclBpeGVsOwoJCWJsdXJVbmlmb3Jtc1sgJ21pcEludCcgXS52YWx1ZSA9IF9sb2RNYXggLSBsb2RJbjsKCgkJY29uc3Qgb3V0cHV0U2l6ZSA9IHRoaXMuX3NpemVMb2RzWyBsb2RPdXQgXTsKCQljb25zdCB4ID0gMyAqIG91dHB1dFNpemUgKiAoIGxvZE91dCA+IF9sb2RNYXggLSBMT0RfTUlOID8gbG9kT3V0IC0gX2xvZE1heCArIExPRF9NSU4gOiAwICk7CgkJY29uc3QgeSA9IDQgKiAoIHRoaXMuX2N1YmVTaXplIC0gb3V0cHV0U2l6ZSApOwoKCQlfc2V0Vmlld3BvcnQoIHRhcmdldE91dCwgeCwgeSwgMyAqIG91dHB1dFNpemUsIDIgKiBvdXRwdXRTaXplICk7CgkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCB0YXJnZXRPdXQgKTsKCQlyZW5kZXJlci5yZW5kZXIoIGJsdXJNZXNoLCBfZmxhdENhbWVyYSApOwoKCX0KCn0KCgoKZnVuY3Rpb24gX2NyZWF0ZVBsYW5lcyggbG9kTWF4ICkgewoKCWNvbnN0IGxvZFBsYW5lcyA9IFtdOwoJY29uc3Qgc2l6ZUxvZHMgPSBbXTsKCWNvbnN0IHNpZ21hcyA9IFtdOwoKCWxldCBsb2QgPSBsb2RNYXg7CgoJY29uc3QgdG90YWxMb2RzID0gbG9kTWF4IC0gTE9EX01JTiArIDEgKyBFWFRSQV9MT0RfU0lHTUEubGVuZ3RoOwoKCWZvciAoIGxldCBpID0gMDsgaSA8IHRvdGFsTG9kczsgaSArKyApIHsKCgkJY29uc3Qgc2l6ZUxvZCA9IE1hdGgucG93KCAyLCBsb2QgKTsKCQlzaXplTG9kcy5wdXNoKCBzaXplTG9kICk7CgkJbGV0IHNpZ21hID0gMS4wIC8gc2l6ZUxvZDsKCgkJaWYgKCBpID4gbG9kTWF4IC0gTE9EX01JTiApIHsKCgkJCXNpZ21hID0gRVhUUkFfTE9EX1NJR01BWyBpIC0gbG9kTWF4ICsgTE9EX01JTiAtIDEgXTsKCgkJfSBlbHNlIGlmICggaSA9PT0gMCApIHsKCgkJCXNpZ21hID0gMDsKCgkJfQoKCQlzaWdtYXMucHVzaCggc2lnbWEgKTsKCgkJY29uc3QgdGV4ZWxTaXplID0gMS4wIC8gKCBzaXplTG9kIC0gMiApOwoJCWNvbnN0IG1pbiA9IC0gdGV4ZWxTaXplOwoJCWNvbnN0IG1heCA9IDEgKyB0ZXhlbFNpemU7CgkJY29uc3QgdXYxID0gWyBtaW4sIG1pbiwgbWF4LCBtaW4sIG1heCwgbWF4LCBtaW4sIG1pbiwgbWF4LCBtYXgsIG1pbiwgbWF4IF07CgoJCWNvbnN0IGN1YmVGYWNlcyA9IDY7CgkJY29uc3QgdmVydGljZXMgPSA2OwoJCWNvbnN0IHBvc2l0aW9uU2l6ZSA9IDM7CgkJY29uc3QgdXZTaXplID0gMjsKCQljb25zdCBmYWNlSW5kZXhTaXplID0gMTsKCgkJY29uc3QgcG9zaXRpb24gPSBuZXcgRmxvYXQzMkFycmF5KCBwb3NpdGlvblNpemUgKiB2ZXJ0aWNlcyAqIGN1YmVGYWNlcyApOwoJCWNvbnN0IHV2ID0gbmV3IEZsb2F0MzJBcnJheSggdXZTaXplICogdmVydGljZXMgKiBjdWJlRmFjZXMgKTsKCQljb25zdCBmYWNlSW5kZXggPSBuZXcgRmxvYXQzMkFycmF5KCBmYWNlSW5kZXhTaXplICogdmVydGljZXMgKiBjdWJlRmFjZXMgKTsKCgkJZm9yICggbGV0IGZhY2UgPSAwOyBmYWNlIDwgY3ViZUZhY2VzOyBmYWNlICsrICkgewoKCQkJY29uc3QgeCA9ICggZmFjZSAlIDMgKSAqIDIgLyAzIC0gMTsKCQkJY29uc3QgeSA9IGZhY2UgPiAyID8gMCA6IC0gMTsKCQkJY29uc3QgY29vcmRpbmF0ZXMgPSBbCgkJCQl4LCB5LCAwLAoJCQkJeCArIDIgLyAzLCB5LCAwLAoJCQkJeCArIDIgLyAzLCB5ICsgMSwgMCwKCQkJCXgsIHksIDAsCgkJCQl4ICsgMiAvIDMsIHkgKyAxLCAwLAoJCQkJeCwgeSArIDEsIDAKCQkJXTsKCQkJcG9zaXRpb24uc2V0KCBjb29yZGluYXRlcywgcG9zaXRpb25TaXplICogdmVydGljZXMgKiBmYWNlICk7CgkJCXV2LnNldCggdXYxLCB1dlNpemUgKiB2ZXJ0aWNlcyAqIGZhY2UgKTsKCQkJY29uc3QgZmlsbCA9IFsgZmFjZSwgZmFjZSwgZmFjZSwgZmFjZSwgZmFjZSwgZmFjZSBdOwoJCQlmYWNlSW5kZXguc2V0KCBmaWxsLCBmYWNlSW5kZXhTaXplICogdmVydGljZXMgKiBmYWNlICk7CgoJCX0KCgkJY29uc3QgcGxhbmVzID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCk7CgkJcGxhbmVzLnNldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIHBvc2l0aW9uU2l6ZSApICk7CgkJcGxhbmVzLnNldEF0dHJpYnV0ZSggJ3V2JywgbmV3IEJ1ZmZlckF0dHJpYnV0ZSggdXYsIHV2U2l6ZSApICk7CgkJcGxhbmVzLnNldEF0dHJpYnV0ZSggJ2ZhY2VJbmRleCcsIG5ldyBCdWZmZXJBdHRyaWJ1dGUoIGZhY2VJbmRleCwgZmFjZUluZGV4U2l6ZSApICk7CgkJbG9kUGxhbmVzLnB1c2goIHBsYW5lcyApOwoKCQlpZiAoIGxvZCA+IExPRF9NSU4gKSB7CgoJCQlsb2QgLS07CgoJCX0KCgl9CgoJcmV0dXJuIHsgbG9kUGxhbmVzLCBzaXplTG9kcywgc2lnbWFzIH07Cgp9CgpmdW5jdGlvbiBfY3JlYXRlUmVuZGVyVGFyZ2V0KCB3aWR0aCwgaGVpZ2h0LCBwYXJhbXMgKSB7CgoJY29uc3QgY3ViZVVWUmVuZGVyVGFyZ2V0ID0gbmV3IFdlYkdMUmVuZGVyVGFyZ2V0KCB3aWR0aCwgaGVpZ2h0LCBwYXJhbXMgKTsKCWN1YmVVVlJlbmRlclRhcmdldC50ZXh0dXJlLm1hcHBpbmcgPSBDdWJlVVZSZWZsZWN0aW9uTWFwcGluZzsKCWN1YmVVVlJlbmRlclRhcmdldC50ZXh0dXJlLm5hbWUgPSAnUE1SRU0uY3ViZVV2JzsKCWN1YmVVVlJlbmRlclRhcmdldC5zY2lzc29yVGVzdCA9IHRydWU7CglyZXR1cm4gY3ViZVVWUmVuZGVyVGFyZ2V0OwoKfQoKZnVuY3Rpb24gX3NldFZpZXdwb3J0KCB0YXJnZXQsIHgsIHksIHdpZHRoLCBoZWlnaHQgKSB7CgoJdGFyZ2V0LnZpZXdwb3J0LnNldCggeCwgeSwgd2lkdGgsIGhlaWdodCApOwoJdGFyZ2V0LnNjaXNzb3Iuc2V0KCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICk7Cgp9CgpmdW5jdGlvbiBfZ2V0Qmx1clNoYWRlciggbG9kTWF4LCB3aWR0aCwgaGVpZ2h0ICkgewoKCWNvbnN0IHdlaWdodHMgPSBuZXcgRmxvYXQzMkFycmF5KCBNQVhfU0FNUExFUyApOwoJY29uc3QgcG9sZUF4aXMgPSBuZXcgVmVjdG9yMyggMCwgMSwgMCApOwoJY29uc3Qgc2hhZGVyTWF0ZXJpYWwgPSBuZXcgU2hhZGVyTWF0ZXJpYWwoIHsKCgkJbmFtZTogJ1NwaGVyaWNhbEdhdXNzaWFuQmx1cicsCgoJCWRlZmluZXM6IHsKCQkJJ24nOiBNQVhfU0FNUExFUywKCQkJJ0NVQkVVVl9URVhFTF9XSURUSCc6IDEuMCAvIHdpZHRoLAoJCQknQ1VCRVVWX1RFWEVMX0hFSUdIVCc6IDEuMCAvIGhlaWdodCwKCQkJJ0NVQkVVVl9NQVhfTUlQJzogYCR7bG9kTWF4fS4wYCwKCQl9LAoKCQl1bmlmb3JtczogewoJCQknZW52TWFwJzogeyB2YWx1ZTogbnVsbCB9LAoJCQknc2FtcGxlcyc6IHsgdmFsdWU6IDEgfSwKCQkJJ3dlaWdodHMnOiB7IHZhbHVlOiB3ZWlnaHRzIH0sCgkJCSdsYXRpdHVkaW5hbCc6IHsgdmFsdWU6IGZhbHNlIH0sCgkJCSdkVGhldGEnOiB7IHZhbHVlOiAwIH0sCgkJCSdtaXBJbnQnOiB7IHZhbHVlOiAwIH0sCgkJCSdwb2xlQXhpcyc6IHsgdmFsdWU6IHBvbGVBeGlzIH0KCQl9LAoKCQl2ZXJ0ZXhTaGFkZXI6IF9nZXRDb21tb25WZXJ0ZXhTaGFkZXIoKSwKCgkJZnJhZ21lbnRTaGFkZXI6IC8qIGdsc2wgKi9gCgoJCQlwcmVjaXNpb24gbWVkaXVtcCBmbG9hdDsKCQkJcHJlY2lzaW9uIG1lZGl1bXAgaW50OwoKCQkJdmFyeWluZyB2ZWMzIHZPdXRwdXREaXJlY3Rpb247CgoJCQl1bmlmb3JtIHNhbXBsZXIyRCBlbnZNYXA7CgkJCXVuaWZvcm0gaW50IHNhbXBsZXM7CgkJCXVuaWZvcm0gZmxvYXQgd2VpZ2h0c1sgbiBdOwoJCQl1bmlmb3JtIGJvb2wgbGF0aXR1ZGluYWw7CgkJCXVuaWZvcm0gZmxvYXQgZFRoZXRhOwoJCQl1bmlmb3JtIGZsb2F0IG1pcEludDsKCQkJdW5pZm9ybSB2ZWMzIHBvbGVBeGlzOwoKCQkJI2RlZmluZSBFTlZNQVBfVFlQRV9DVUJFX1VWCgkJCSNpbmNsdWRlIDxjdWJlX3V2X3JlZmxlY3Rpb25fZnJhZ21lbnQ+CgoJCQl2ZWMzIGdldFNhbXBsZSggZmxvYXQgdGhldGEsIHZlYzMgYXhpcyApIHsKCgkJCQlmbG9hdCBjb3NUaGV0YSA9IGNvcyggdGhldGEgKTsKCQkJCS8vIFJvZHJpZ3VlcycgYXhpcy1hbmdsZSByb3RhdGlvbgoJCQkJdmVjMyBzYW1wbGVEaXJlY3Rpb24gPSB2T3V0cHV0RGlyZWN0aW9uICogY29zVGhldGEKCQkJCQkrIGNyb3NzKCBheGlzLCB2T3V0cHV0RGlyZWN0aW9uICkgKiBzaW4oIHRoZXRhICkKCQkJCQkrIGF4aXMgKiBkb3QoIGF4aXMsIHZPdXRwdXREaXJlY3Rpb24gKSAqICggMS4wIC0gY29zVGhldGEgKTsKCgkJCQlyZXR1cm4gYmlsaW5lYXJDdWJlVVYoIGVudk1hcCwgc2FtcGxlRGlyZWN0aW9uLCBtaXBJbnQgKTsKCgkJCX0KCgkJCXZvaWQgbWFpbigpIHsKCgkJCQl2ZWMzIGF4aXMgPSBsYXRpdHVkaW5hbCA/IHBvbGVBeGlzIDogY3Jvc3MoIHBvbGVBeGlzLCB2T3V0cHV0RGlyZWN0aW9uICk7CgoJCQkJaWYgKCBhbGwoIGVxdWFsKCBheGlzLCB2ZWMzKCAwLjAgKSApICkgKSB7CgoJCQkJCWF4aXMgPSB2ZWMzKCB2T3V0cHV0RGlyZWN0aW9uLnosIDAuMCwgLSB2T3V0cHV0RGlyZWN0aW9uLnggKTsKCgkJCQl9CgoJCQkJYXhpcyA9IG5vcm1hbGl6ZSggYXhpcyApOwoKCQkJCWdsX0ZyYWdDb2xvciA9IHZlYzQoIDAuMCwgMC4wLCAwLjAsIDEuMCApOwoJCQkJZ2xfRnJhZ0NvbG9yLnJnYiArPSB3ZWlnaHRzWyAwIF0gKiBnZXRTYW1wbGUoIDAuMCwgYXhpcyApOwoKCQkJCWZvciAoIGludCBpID0gMTsgaSA8IG47IGkrKyApIHsKCgkJCQkJaWYgKCBpID49IHNhbXBsZXMgKSB7CgoJCQkJCQlicmVhazsKCgkJCQkJfQoKCQkJCQlmbG9hdCB0aGV0YSA9IGRUaGV0YSAqIGZsb2F0KCBpICk7CgkJCQkJZ2xfRnJhZ0NvbG9yLnJnYiArPSB3ZWlnaHRzWyBpIF0gKiBnZXRTYW1wbGUoIC0xLjAgKiB0aGV0YSwgYXhpcyApOwoJCQkJCWdsX0ZyYWdDb2xvci5yZ2IgKz0gd2VpZ2h0c1sgaSBdICogZ2V0U2FtcGxlKCB0aGV0YSwgYXhpcyApOwoKCQkJCX0KCgkJCX0KCQlgLAoKCQlibGVuZGluZzogTm9CbGVuZGluZywKCQlkZXB0aFRlc3Q6IGZhbHNlLAoJCWRlcHRoV3JpdGU6IGZhbHNlCgoJfSApOwoKCXJldHVybiBzaGFkZXJNYXRlcmlhbDsKCn0KCmZ1bmN0aW9uIF9nZXRFcXVpcmVjdE1hdGVyaWFsKCkgewoKCXJldHVybiBuZXcgU2hhZGVyTWF0ZXJpYWwoIHsKCgkJbmFtZTogJ0VxdWlyZWN0YW5ndWxhclRvQ3ViZVVWJywKCgkJdW5pZm9ybXM6IHsKCQkJJ2Vudk1hcCc6IHsgdmFsdWU6IG51bGwgfQoJCX0sCgoJCXZlcnRleFNoYWRlcjogX2dldENvbW1vblZlcnRleFNoYWRlcigpLAoKCQlmcmFnbWVudFNoYWRlcjogLyogZ2xzbCAqL2AKCgkJCXByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwoJCQlwcmVjaXNpb24gbWVkaXVtcCBpbnQ7CgoJCQl2YXJ5aW5nIHZlYzMgdk91dHB1dERpcmVjdGlvbjsKCgkJCXVuaWZvcm0gc2FtcGxlcjJEIGVudk1hcDsKCgkJCSNpbmNsdWRlIDxjb21tb24+CgoJCQl2b2lkIG1haW4oKSB7CgoJCQkJdmVjMyBvdXRwdXREaXJlY3Rpb24gPSBub3JtYWxpemUoIHZPdXRwdXREaXJlY3Rpb24gKTsKCQkJCXZlYzIgdXYgPSBlcXVpcmVjdFV2KCBvdXRwdXREaXJlY3Rpb24gKTsKCgkJCQlnbF9GcmFnQ29sb3IgPSB2ZWM0KCB0ZXh0dXJlMkQgKCBlbnZNYXAsIHV2ICkucmdiLCAxLjAgKTsKCgkJCX0KCQlgLAoKCQlibGVuZGluZzogTm9CbGVuZGluZywKCQlkZXB0aFRlc3Q6IGZhbHNlLAoJCWRlcHRoV3JpdGU6IGZhbHNlCgoJfSApOwoKfQoKZnVuY3Rpb24gX2dldEN1YmVtYXBNYXRlcmlhbCgpIHsKCglyZXR1cm4gbmV3IFNoYWRlck1hdGVyaWFsKCB7CgoJCW5hbWU6ICdDdWJlbWFwVG9DdWJlVVYnLAoKCQl1bmlmb3JtczogewoJCQknZW52TWFwJzogeyB2YWx1ZTogbnVsbCB9LAoJCQknZmxpcEVudk1hcCc6IHsgdmFsdWU6IC0gMSB9CgkJfSwKCgkJdmVydGV4U2hhZGVyOiBfZ2V0Q29tbW9uVmVydGV4U2hhZGVyKCksCgoJCWZyYWdtZW50U2hhZGVyOiAvKiBnbHNsICovYAoKCQkJcHJlY2lzaW9uIG1lZGl1bXAgZmxvYXQ7CgkJCXByZWNpc2lvbiBtZWRpdW1wIGludDsKCgkJCXVuaWZvcm0gZmxvYXQgZmxpcEVudk1hcDsKCgkJCXZhcnlpbmcgdmVjMyB2T3V0cHV0RGlyZWN0aW9uOwoKCQkJdW5pZm9ybSBzYW1wbGVyQ3ViZSBlbnZNYXA7CgoJCQl2b2lkIG1haW4oKSB7CgoJCQkJZ2xfRnJhZ0NvbG9yID0gdGV4dHVyZUN1YmUoIGVudk1hcCwgdmVjMyggZmxpcEVudk1hcCAqIHZPdXRwdXREaXJlY3Rpb24ueCwgdk91dHB1dERpcmVjdGlvbi55eiApICk7CgoJCQl9CgkJYCwKCgkJYmxlbmRpbmc6IE5vQmxlbmRpbmcsCgkJZGVwdGhUZXN0OiBmYWxzZSwKCQlkZXB0aFdyaXRlOiBmYWxzZQoKCX0gKTsKCn0KCmZ1bmN0aW9uIF9nZXRDb21tb25WZXJ0ZXhTaGFkZXIoKSB7CgoJcmV0dXJuIC8qIGdsc2wgKi9gCgoJCXByZWNpc2lvbiBtZWRpdW1wIGZsb2F0OwoJCXByZWNpc2lvbiBtZWRpdW1wIGludDsKCgkJYXR0cmlidXRlIGZsb2F0IGZhY2VJbmRleDsKCgkJdmFyeWluZyB2ZWMzIHZPdXRwdXREaXJlY3Rpb247CgoJCS8vIFJIIGNvb3JkaW5hdGUgc3lzdGVtOyBQTVJFTSBmYWNlLWluZGV4aW5nIGNvbnZlbnRpb24KCQl2ZWMzIGdldERpcmVjdGlvbiggdmVjMiB1diwgZmxvYXQgZmFjZSApIHsKCgkJCXV2ID0gMi4wICogdXYgLSAxLjA7CgoJCQl2ZWMzIGRpcmVjdGlvbiA9IHZlYzMoIHV2LCAxLjAgKTsKCgkJCWlmICggZmFjZSA9PSAwLjAgKSB7CgoJCQkJZGlyZWN0aW9uID0gZGlyZWN0aW9uLnp5eDsgLy8gKCAxLCB2LCB1ICkgcG9zIHgKCgkJCX0gZWxzZSBpZiAoIGZhY2UgPT0gMS4wICkgewoKCQkJCWRpcmVjdGlvbiA9IGRpcmVjdGlvbi54enk7CgkJCQlkaXJlY3Rpb24ueHogKj0gLTEuMDsgLy8gKCAtdSwgMSwgLXYgKSBwb3MgeQoKCQkJfSBlbHNlIGlmICggZmFjZSA9PSAyLjAgKSB7CgoJCQkJZGlyZWN0aW9uLnggKj0gLTEuMDsgLy8gKCAtdSwgdiwgMSApIHBvcyB6CgoJCQl9IGVsc2UgaWYgKCBmYWNlID09IDMuMCApIHsKCgkJCQlkaXJlY3Rpb24gPSBkaXJlY3Rpb24uenl4OwoJCQkJZGlyZWN0aW9uLnh6ICo9IC0xLjA7IC8vICggLTEsIHYsIC11ICkgbmVnIHgKCgkJCX0gZWxzZSBpZiAoIGZhY2UgPT0gNC4wICkgewoKCQkJCWRpcmVjdGlvbiA9IGRpcmVjdGlvbi54enk7CgkJCQlkaXJlY3Rpb24ueHkgKj0gLTEuMDsgLy8gKCAtdSwgLTEsIHYgKSBuZWcgeQoKCQkJfSBlbHNlIGlmICggZmFjZSA9PSA1LjAgKSB7CgoJCQkJZGlyZWN0aW9uLnogKj0gLTEuMDsgLy8gKCB1LCB2LCAtMSApIG5lZyB6CgoJCQl9CgoJCQlyZXR1cm4gZGlyZWN0aW9uOwoKCQl9CgoJCXZvaWQgbWFpbigpIHsKCgkJCXZPdXRwdXREaXJlY3Rpb24gPSBnZXREaXJlY3Rpb24oIHV2LCBmYWNlSW5kZXggKTsKCQkJZ2xfUG9zaXRpb24gPSB2ZWM0KCBwb3NpdGlvbiwgMS4wICk7CgoJCX0KCWA7Cgp9CgpmdW5jdGlvbiBXZWJHTEN1YmVVVk1hcHMoIHJlbmRlcmVyICkgewoKCWxldCBjdWJlVVZtYXBzID0gbmV3IFdlYWtNYXAoKTsKCglsZXQgcG1yZW1HZW5lcmF0b3IgPSBudWxsOwoKCWZ1bmN0aW9uIGdldCggdGV4dHVyZSApIHsKCgkJaWYgKCB0ZXh0dXJlICYmIHRleHR1cmUuaXNUZXh0dXJlICkgewoKCQkJY29uc3QgbWFwcGluZyA9IHRleHR1cmUubWFwcGluZzsKCgkJCWNvbnN0IGlzRXF1aXJlY3RNYXAgPSAoIG1hcHBpbmcgPT09IEVxdWlyZWN0YW5ndWxhclJlZmxlY3Rpb25NYXBwaW5nIHx8IG1hcHBpbmcgPT09IEVxdWlyZWN0YW5ndWxhclJlZnJhY3Rpb25NYXBwaW5nICk7CgkJCWNvbnN0IGlzQ3ViZU1hcCA9ICggbWFwcGluZyA9PT0gQ3ViZVJlZmxlY3Rpb25NYXBwaW5nIHx8IG1hcHBpbmcgPT09IEN1YmVSZWZyYWN0aW9uTWFwcGluZyApOwoKCQkJLy8gZXF1aXJlY3QvY3ViZSBtYXAgdG8gY3ViZVVWIGNvbnZlcnNpb24KCgkJCWlmICggaXNFcXVpcmVjdE1hcCB8fCBpc0N1YmVNYXAgKSB7CgoJCQkJaWYgKCB0ZXh0dXJlLmlzUmVuZGVyVGFyZ2V0VGV4dHVyZSAmJiB0ZXh0dXJlLm5lZWRzUE1SRU1VcGRhdGUgPT09IHRydWUgKSB7CgoJCQkJCXRleHR1cmUubmVlZHNQTVJFTVVwZGF0ZSA9IGZhbHNlOwoKCQkJCQlsZXQgcmVuZGVyVGFyZ2V0ID0gY3ViZVVWbWFwcy5nZXQoIHRleHR1cmUgKTsKCgkJCQkJaWYgKCBwbXJlbUdlbmVyYXRvciA9PT0gbnVsbCApIHBtcmVtR2VuZXJhdG9yID0gbmV3IFBNUkVNR2VuZXJhdG9yKCByZW5kZXJlciApOwoKCQkJCQlyZW5kZXJUYXJnZXQgPSBpc0VxdWlyZWN0TWFwID8gcG1yZW1HZW5lcmF0b3IuZnJvbUVxdWlyZWN0YW5ndWxhciggdGV4dHVyZSwgcmVuZGVyVGFyZ2V0ICkgOiBwbXJlbUdlbmVyYXRvci5mcm9tQ3ViZW1hcCggdGV4dHVyZSwgcmVuZGVyVGFyZ2V0ICk7CgkJCQkJY3ViZVVWbWFwcy5zZXQoIHRleHR1cmUsIHJlbmRlclRhcmdldCApOwoKCQkJCQlyZXR1cm4gcmVuZGVyVGFyZ2V0LnRleHR1cmU7CgoJCQkJfSBlbHNlIHsKCgkJCQkJaWYgKCBjdWJlVVZtYXBzLmhhcyggdGV4dHVyZSApICkgewoKCQkJCQkJcmV0dXJuIGN1YmVVVm1hcHMuZ2V0KCB0ZXh0dXJlICkudGV4dHVyZTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWNvbnN0IGltYWdlID0gdGV4dHVyZS5pbWFnZTsKCgkJCQkJCWlmICggKCBpc0VxdWlyZWN0TWFwICYmIGltYWdlICYmIGltYWdlLmhlaWdodCA+IDAgKSB8fCAoIGlzQ3ViZU1hcCAmJiBpbWFnZSAmJiBpc0N1YmVUZXh0dXJlQ29tcGxldGUoIGltYWdlICkgKSApIHsKCgkJCQkJCQlpZiAoIHBtcmVtR2VuZXJhdG9yID09PSBudWxsICkgcG1yZW1HZW5lcmF0b3IgPSBuZXcgUE1SRU1HZW5lcmF0b3IoIHJlbmRlcmVyICk7CgoJCQkJCQkJY29uc3QgcmVuZGVyVGFyZ2V0ID0gaXNFcXVpcmVjdE1hcCA/IHBtcmVtR2VuZXJhdG9yLmZyb21FcXVpcmVjdGFuZ3VsYXIoIHRleHR1cmUgKSA6IHBtcmVtR2VuZXJhdG9yLmZyb21DdWJlbWFwKCB0ZXh0dXJlICk7CgkJCQkJCQljdWJlVVZtYXBzLnNldCggdGV4dHVyZSwgcmVuZGVyVGFyZ2V0ICk7CgoJCQkJCQkJdGV4dHVyZS5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVGV4dHVyZURpc3Bvc2UgKTsKCgkJCQkJCQlyZXR1cm4gcmVuZGVyVGFyZ2V0LnRleHR1cmU7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCS8vIGltYWdlIG5vdCB5ZXQgcmVhZHkuIHRyeSB0aGUgY29udmVyc2lvbiBuZXh0IGZyYW1lCgoJCQkJCQkJcmV0dXJuIG51bGw7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHRleHR1cmU7CgoJfQoKCWZ1bmN0aW9uIGlzQ3ViZVRleHR1cmVDb21wbGV0ZSggaW1hZ2UgKSB7CgoJCWxldCBjb3VudCA9IDA7CgkJY29uc3QgbGVuZ3RoID0gNjsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpICsrICkgewoKCQkJaWYgKCBpbWFnZVsgaSBdICE9PSB1bmRlZmluZWQgKSBjb3VudCArKzsKCgkJfQoKCQlyZXR1cm4gY291bnQgPT09IGxlbmd0aDsKCgoJfQoKCWZ1bmN0aW9uIG9uVGV4dHVyZURpc3Bvc2UoIGV2ZW50ICkgewoKCQljb25zdCB0ZXh0dXJlID0gZXZlbnQudGFyZ2V0OwoKCQl0ZXh0dXJlLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25UZXh0dXJlRGlzcG9zZSApOwoKCQljb25zdCBjdWJlbWFwVVYgPSBjdWJlVVZtYXBzLmdldCggdGV4dHVyZSApOwoKCQlpZiAoIGN1YmVtYXBVViAhPT0gdW5kZWZpbmVkICkgewoKCQkJY3ViZVVWbWFwcy5kZWxldGUoIHRleHR1cmUgKTsKCQkJY3ViZW1hcFVWLmRpc3Bvc2UoKTsKCgkJfQoKCX0KCglmdW5jdGlvbiBkaXNwb3NlKCkgewoKCQljdWJlVVZtYXBzID0gbmV3IFdlYWtNYXAoKTsKCgkJaWYgKCBwbXJlbUdlbmVyYXRvciAhPT0gbnVsbCApIHsKCgkJCXBtcmVtR2VuZXJhdG9yLmRpc3Bvc2UoKTsKCQkJcG1yZW1HZW5lcmF0b3IgPSBudWxsOwoKCQl9CgoJfQoKCXJldHVybiB7CgkJZ2V0OiBnZXQsCgkJZGlzcG9zZTogZGlzcG9zZQoJfTsKCn0KCmZ1bmN0aW9uIFdlYkdMRXh0ZW5zaW9ucyggZ2wgKSB7CgoJY29uc3QgZXh0ZW5zaW9ucyA9IHt9OwoKCWZ1bmN0aW9uIGdldEV4dGVuc2lvbiggbmFtZSApIHsKCgkJaWYgKCBleHRlbnNpb25zWyBuYW1lIF0gIT09IHVuZGVmaW5lZCApIHsKCgkJCXJldHVybiBleHRlbnNpb25zWyBuYW1lIF07CgoJCX0KCgkJbGV0IGV4dGVuc2lvbjsKCgkJc3dpdGNoICggbmFtZSApIHsKCgkJCWNhc2UgJ1dFQkdMX2RlcHRoX3RleHR1cmUnOgoJCQkJZXh0ZW5zaW9uID0gZ2wuZ2V0RXh0ZW5zaW9uKCAnV0VCR0xfZGVwdGhfdGV4dHVyZScgKSB8fCBnbC5nZXRFeHRlbnNpb24oICdNT1pfV0VCR0xfZGVwdGhfdGV4dHVyZScgKSB8fCBnbC5nZXRFeHRlbnNpb24oICdXRUJLSVRfV0VCR0xfZGVwdGhfdGV4dHVyZScgKTsKCQkJCWJyZWFrOwoKCQkJY2FzZSAnRVhUX3RleHR1cmVfZmlsdGVyX2FuaXNvdHJvcGljJzoKCQkJCWV4dGVuc2lvbiA9IGdsLmdldEV4dGVuc2lvbiggJ0VYVF90ZXh0dXJlX2ZpbHRlcl9hbmlzb3Ryb3BpYycgKSB8fCBnbC5nZXRFeHRlbnNpb24oICdNT1pfRVhUX3RleHR1cmVfZmlsdGVyX2FuaXNvdHJvcGljJyApIHx8IGdsLmdldEV4dGVuc2lvbiggJ1dFQktJVF9FWFRfdGV4dHVyZV9maWx0ZXJfYW5pc290cm9waWMnICk7CgkJCQlicmVhazsKCgkJCWNhc2UgJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9zM3RjJzoKCQkJCWV4dGVuc2lvbiA9IGdsLmdldEV4dGVuc2lvbiggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9zM3RjJyApIHx8IGdsLmdldEV4dGVuc2lvbiggJ01PWl9XRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfczN0YycgKSB8fCBnbC5nZXRFeHRlbnNpb24oICdXRUJLSVRfV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3MzdGMnICk7CgkJCQlicmVhazsKCgkJCWNhc2UgJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9wdnJ0Yyc6CgkJCQlleHRlbnNpb24gPSBnbC5nZXRFeHRlbnNpb24oICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfcHZydGMnICkgfHwgZ2wuZ2V0RXh0ZW5zaW9uKCAnV0VCS0lUX1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9wdnJ0YycgKTsKCQkJCWJyZWFrOwoKCQkJZGVmYXVsdDoKCQkJCWV4dGVuc2lvbiA9IGdsLmdldEV4dGVuc2lvbiggbmFtZSApOwoKCQl9CgoJCWV4dGVuc2lvbnNbIG5hbWUgXSA9IGV4dGVuc2lvbjsKCgkJcmV0dXJuIGV4dGVuc2lvbjsKCgl9CgoJcmV0dXJuIHsKCgkJaGFzOiBmdW5jdGlvbiAoIG5hbWUgKSB7CgoJCQlyZXR1cm4gZ2V0RXh0ZW5zaW9uKCBuYW1lICkgIT09IG51bGw7CgoJCX0sCgoJCWluaXQ6IGZ1bmN0aW9uICggY2FwYWJpbGl0aWVzICkgewoKCQkJaWYgKCBjYXBhYmlsaXRpZXMuaXNXZWJHTDIgKSB7CgoJCQkJZ2V0RXh0ZW5zaW9uKCAnRVhUX2NvbG9yX2J1ZmZlcl9mbG9hdCcgKTsKCgkJCX0gZWxzZSB7CgoJCQkJZ2V0RXh0ZW5zaW9uKCAnV0VCR0xfZGVwdGhfdGV4dHVyZScgKTsKCQkJCWdldEV4dGVuc2lvbiggJ09FU190ZXh0dXJlX2Zsb2F0JyApOwoJCQkJZ2V0RXh0ZW5zaW9uKCAnT0VTX3RleHR1cmVfaGFsZl9mbG9hdCcgKTsKCQkJCWdldEV4dGVuc2lvbiggJ09FU190ZXh0dXJlX2hhbGZfZmxvYXRfbGluZWFyJyApOwoJCQkJZ2V0RXh0ZW5zaW9uKCAnT0VTX3N0YW5kYXJkX2Rlcml2YXRpdmVzJyApOwoJCQkJZ2V0RXh0ZW5zaW9uKCAnT0VTX2VsZW1lbnRfaW5kZXhfdWludCcgKTsKCQkJCWdldEV4dGVuc2lvbiggJ09FU192ZXJ0ZXhfYXJyYXlfb2JqZWN0JyApOwoJCQkJZ2V0RXh0ZW5zaW9uKCAnQU5HTEVfaW5zdGFuY2VkX2FycmF5cycgKTsKCgkJCX0KCgkJCWdldEV4dGVuc2lvbiggJ09FU190ZXh0dXJlX2Zsb2F0X2xpbmVhcicgKTsKCQkJZ2V0RXh0ZW5zaW9uKCAnRVhUX2NvbG9yX2J1ZmZlcl9oYWxmX2Zsb2F0JyApOwoJCQlnZXRFeHRlbnNpb24oICdXRUJHTF9tdWx0aXNhbXBsZWRfcmVuZGVyX3RvX3RleHR1cmUnICk7CgoJCX0sCgoJCWdldDogZnVuY3Rpb24gKCBuYW1lICkgewoKCQkJY29uc3QgZXh0ZW5zaW9uID0gZ2V0RXh0ZW5zaW9uKCBuYW1lICk7CgoJCQlpZiAoIGV4dGVuc2lvbiA9PT0gbnVsbCApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiAnICsgbmFtZSArICcgZXh0ZW5zaW9uIG5vdCBzdXBwb3J0ZWQuJyApOwoKCQkJfQoKCQkJcmV0dXJuIGV4dGVuc2lvbjsKCgkJfQoKCX07Cgp9CgpmdW5jdGlvbiBXZWJHTEdlb21ldHJpZXMoIGdsLCBhdHRyaWJ1dGVzLCBpbmZvLCBiaW5kaW5nU3RhdGVzICkgewoKCWNvbnN0IGdlb21ldHJpZXMgPSB7fTsKCWNvbnN0IHdpcmVmcmFtZUF0dHJpYnV0ZXMgPSBuZXcgV2Vha01hcCgpOwoKCWZ1bmN0aW9uIG9uR2VvbWV0cnlEaXNwb3NlKCBldmVudCApIHsKCgkJY29uc3QgZ2VvbWV0cnkgPSBldmVudC50YXJnZXQ7CgoJCWlmICggZ2VvbWV0cnkuaW5kZXggIT09IG51bGwgKSB7CgoJCQlhdHRyaWJ1dGVzLnJlbW92ZSggZ2VvbWV0cnkuaW5kZXggKTsKCgkJfQoKCQlmb3IgKCBjb25zdCBuYW1lIGluIGdlb21ldHJ5LmF0dHJpYnV0ZXMgKSB7CgoJCQlhdHRyaWJ1dGVzLnJlbW92ZSggZ2VvbWV0cnkuYXR0cmlidXRlc1sgbmFtZSBdICk7CgoJCX0KCgkJZm9yICggY29uc3QgbmFtZSBpbiBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMgKSB7CgoJCQljb25zdCBhcnJheSA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlc1sgbmFtZSBdOwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gYXJyYXkubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQlhdHRyaWJ1dGVzLnJlbW92ZSggYXJyYXlbIGkgXSApOwoKCQkJfQoKCQl9CgoJCWdlb21ldHJ5LnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25HZW9tZXRyeURpc3Bvc2UgKTsKCgkJZGVsZXRlIGdlb21ldHJpZXNbIGdlb21ldHJ5LmlkIF07CgoJCWNvbnN0IGF0dHJpYnV0ZSA9IHdpcmVmcmFtZUF0dHJpYnV0ZXMuZ2V0KCBnZW9tZXRyeSApOwoKCQlpZiAoIGF0dHJpYnV0ZSApIHsKCgkJCWF0dHJpYnV0ZXMucmVtb3ZlKCBhdHRyaWJ1dGUgKTsKCQkJd2lyZWZyYW1lQXR0cmlidXRlcy5kZWxldGUoIGdlb21ldHJ5ICk7CgoJCX0KCgkJYmluZGluZ1N0YXRlcy5yZWxlYXNlU3RhdGVzT2ZHZW9tZXRyeSggZ2VvbWV0cnkgKTsKCgkJaWYgKCBnZW9tZXRyeS5pc0luc3RhbmNlZEJ1ZmZlckdlb21ldHJ5ID09PSB0cnVlICkgewoKCQkJZGVsZXRlIGdlb21ldHJ5Ll9tYXhJbnN0YW5jZUNvdW50OwoKCQl9CgoJCS8vCgoJCWluZm8ubWVtb3J5Lmdlb21ldHJpZXMgLS07CgoJfQoKCWZ1bmN0aW9uIGdldCggb2JqZWN0LCBnZW9tZXRyeSApIHsKCgkJaWYgKCBnZW9tZXRyaWVzWyBnZW9tZXRyeS5pZCBdID09PSB0cnVlICkgcmV0dXJuIGdlb21ldHJ5OwoKCQlnZW9tZXRyeS5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uR2VvbWV0cnlEaXNwb3NlICk7CgoJCWdlb21ldHJpZXNbIGdlb21ldHJ5LmlkIF0gPSB0cnVlOwoKCQlpbmZvLm1lbW9yeS5nZW9tZXRyaWVzICsrOwoKCQlyZXR1cm4gZ2VvbWV0cnk7CgoJfQoKCWZ1bmN0aW9uIHVwZGF0ZSggZ2VvbWV0cnkgKSB7CgoJCWNvbnN0IGdlb21ldHJ5QXR0cmlidXRlcyA9IGdlb21ldHJ5LmF0dHJpYnV0ZXM7CgoJCS8vIFVwZGF0aW5nIGluZGV4IGJ1ZmZlciBpbiBWQU8gbm93LiBTZWUgV2ViR0xCaW5kaW5nU3RhdGVzLgoKCQlmb3IgKCBjb25zdCBuYW1lIGluIGdlb21ldHJ5QXR0cmlidXRlcyApIHsKCgkJCWF0dHJpYnV0ZXMudXBkYXRlKCBnZW9tZXRyeUF0dHJpYnV0ZXNbIG5hbWUgXSwgZ2wuQVJSQVlfQlVGRkVSICk7CgoJCX0KCgkJLy8gbW9ycGggdGFyZ2V0cwoKCQljb25zdCBtb3JwaEF0dHJpYnV0ZXMgPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXM7CgoJCWZvciAoIGNvbnN0IG5hbWUgaW4gbW9ycGhBdHRyaWJ1dGVzICkgewoKCQkJY29uc3QgYXJyYXkgPSBtb3JwaEF0dHJpYnV0ZXNbIG5hbWUgXTsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IGFycmF5Lmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJYXR0cmlidXRlcy51cGRhdGUoIGFycmF5WyBpIF0sIGdsLkFSUkFZX0JVRkZFUiApOwoKCQkJfQoKCQl9CgoJfQoKCWZ1bmN0aW9uIHVwZGF0ZVdpcmVmcmFtZUF0dHJpYnV0ZSggZ2VvbWV0cnkgKSB7CgoJCWNvbnN0IGluZGljZXMgPSBbXTsKCgkJY29uc3QgZ2VvbWV0cnlJbmRleCA9IGdlb21ldHJ5LmluZGV4OwoJCWNvbnN0IGdlb21ldHJ5UG9zaXRpb24gPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uOwoJCWxldCB2ZXJzaW9uID0gMDsKCgkJaWYgKCBnZW9tZXRyeUluZGV4ICE9PSBudWxsICkgewoKCQkJY29uc3QgYXJyYXkgPSBnZW9tZXRyeUluZGV4LmFycmF5OwoJCQl2ZXJzaW9uID0gZ2VvbWV0cnlJbmRleC52ZXJzaW9uOwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gYXJyYXkubGVuZ3RoOyBpIDwgbDsgaSArPSAzICkgewoKCQkJCWNvbnN0IGEgPSBhcnJheVsgaSArIDAgXTsKCQkJCWNvbnN0IGIgPSBhcnJheVsgaSArIDEgXTsKCQkJCWNvbnN0IGMgPSBhcnJheVsgaSArIDIgXTsKCgkJCQlpbmRpY2VzLnB1c2goIGEsIGIsIGIsIGMsIGMsIGEgKTsKCgkJCX0KCgkJfSBlbHNlIGlmICggZ2VvbWV0cnlQb3NpdGlvbiAhPT0gdW5kZWZpbmVkICkgewoKCQkJY29uc3QgYXJyYXkgPSBnZW9tZXRyeVBvc2l0aW9uLmFycmF5OwoJCQl2ZXJzaW9uID0gZ2VvbWV0cnlQb3NpdGlvbi52ZXJzaW9uOwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0gKCBhcnJheS5sZW5ndGggLyAzICkgLSAxOyBpIDwgbDsgaSArPSAzICkgewoKCQkJCWNvbnN0IGEgPSBpICsgMDsKCQkJCWNvbnN0IGIgPSBpICsgMTsKCQkJCWNvbnN0IGMgPSBpICsgMjsKCgkJCQlpbmRpY2VzLnB1c2goIGEsIGIsIGIsIGMsIGMsIGEgKTsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCXJldHVybjsKCgkJfQoKCQljb25zdCBhdHRyaWJ1dGUgPSBuZXcgKCBhcnJheU5lZWRzVWludDMyKCBpbmRpY2VzICkgPyBVaW50MzJCdWZmZXJBdHRyaWJ1dGUgOiBVaW50MTZCdWZmZXJBdHRyaWJ1dGUgKSggaW5kaWNlcywgMSApOwoJCWF0dHJpYnV0ZS52ZXJzaW9uID0gdmVyc2lvbjsKCgkJLy8gVXBkYXRpbmcgaW5kZXggYnVmZmVyIGluIFZBTyBub3cuIFNlZSBXZWJHTEJpbmRpbmdTdGF0ZXMKCgkJLy8KCgkJY29uc3QgcHJldmlvdXNBdHRyaWJ1dGUgPSB3aXJlZnJhbWVBdHRyaWJ1dGVzLmdldCggZ2VvbWV0cnkgKTsKCgkJaWYgKCBwcmV2aW91c0F0dHJpYnV0ZSApIGF0dHJpYnV0ZXMucmVtb3ZlKCBwcmV2aW91c0F0dHJpYnV0ZSApOwoKCQkvLwoKCQl3aXJlZnJhbWVBdHRyaWJ1dGVzLnNldCggZ2VvbWV0cnksIGF0dHJpYnV0ZSApOwoKCX0KCglmdW5jdGlvbiBnZXRXaXJlZnJhbWVBdHRyaWJ1dGUoIGdlb21ldHJ5ICkgewoKCQljb25zdCBjdXJyZW50QXR0cmlidXRlID0gd2lyZWZyYW1lQXR0cmlidXRlcy5nZXQoIGdlb21ldHJ5ICk7CgoJCWlmICggY3VycmVudEF0dHJpYnV0ZSApIHsKCgkJCWNvbnN0IGdlb21ldHJ5SW5kZXggPSBnZW9tZXRyeS5pbmRleDsKCgkJCWlmICggZ2VvbWV0cnlJbmRleCAhPT0gbnVsbCApIHsKCgkJCQkvLyBpZiB0aGUgYXR0cmlidXRlIGlzIG9ic29sZXRlLCBjcmVhdGUgYSBuZXcgb25lCgoJCQkJaWYgKCBjdXJyZW50QXR0cmlidXRlLnZlcnNpb24gPCBnZW9tZXRyeUluZGV4LnZlcnNpb24gKSB7CgoJCQkJCXVwZGF0ZVdpcmVmcmFtZUF0dHJpYnV0ZSggZ2VvbWV0cnkgKTsKCgkJCQl9CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQl1cGRhdGVXaXJlZnJhbWVBdHRyaWJ1dGUoIGdlb21ldHJ5ICk7CgoJCX0KCgkJcmV0dXJuIHdpcmVmcmFtZUF0dHJpYnV0ZXMuZ2V0KCBnZW9tZXRyeSApOwoKCX0KCglyZXR1cm4gewoKCQlnZXQ6IGdldCwKCQl1cGRhdGU6IHVwZGF0ZSwKCgkJZ2V0V2lyZWZyYW1lQXR0cmlidXRlOiBnZXRXaXJlZnJhbWVBdHRyaWJ1dGUKCgl9OwoKfQoKZnVuY3Rpb24gV2ViR0xJbmRleGVkQnVmZmVyUmVuZGVyZXIoIGdsLCBleHRlbnNpb25zLCBpbmZvLCBjYXBhYmlsaXRpZXMgKSB7CgoJY29uc3QgaXNXZWJHTDIgPSBjYXBhYmlsaXRpZXMuaXNXZWJHTDI7CgoJbGV0IG1vZGU7CgoJZnVuY3Rpb24gc2V0TW9kZSggdmFsdWUgKSB7CgoJCW1vZGUgPSB2YWx1ZTsKCgl9CgoJbGV0IHR5cGUsIGJ5dGVzUGVyRWxlbWVudDsKCglmdW5jdGlvbiBzZXRJbmRleCggdmFsdWUgKSB7CgoJCXR5cGUgPSB2YWx1ZS50eXBlOwoJCWJ5dGVzUGVyRWxlbWVudCA9IHZhbHVlLmJ5dGVzUGVyRWxlbWVudDsKCgl9CgoJZnVuY3Rpb24gcmVuZGVyKCBzdGFydCwgY291bnQgKSB7CgoJCWdsLmRyYXdFbGVtZW50cyggbW9kZSwgY291bnQsIHR5cGUsIHN0YXJ0ICogYnl0ZXNQZXJFbGVtZW50ICk7CgoJCWluZm8udXBkYXRlKCBjb3VudCwgbW9kZSwgMSApOwoKCX0KCglmdW5jdGlvbiByZW5kZXJJbnN0YW5jZXMoIHN0YXJ0LCBjb3VudCwgcHJpbWNvdW50ICkgewoKCQlpZiAoIHByaW1jb3VudCA9PT0gMCApIHJldHVybjsKCgkJbGV0IGV4dGVuc2lvbiwgbWV0aG9kTmFtZTsKCgkJaWYgKCBpc1dlYkdMMiApIHsKCgkJCWV4dGVuc2lvbiA9IGdsOwoJCQltZXRob2ROYW1lID0gJ2RyYXdFbGVtZW50c0luc3RhbmNlZCc7CgoJCX0gZWxzZSB7CgoJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ0FOR0xFX2luc3RhbmNlZF9hcnJheXMnICk7CgkJCW1ldGhvZE5hbWUgPSAnZHJhd0VsZW1lbnRzSW5zdGFuY2VkQU5HTEUnOwoKCQkJaWYgKCBleHRlbnNpb24gPT09IG51bGwgKSB7CgoJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMSW5kZXhlZEJ1ZmZlclJlbmRlcmVyOiB1c2luZyBUSFJFRS5JbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSBidXQgaGFyZHdhcmUgZG9lcyBub3Qgc3VwcG9ydCBleHRlbnNpb24gQU5HTEVfaW5zdGFuY2VkX2FycmF5cy4nICk7CgkJCQlyZXR1cm47CgoJCQl9CgoJCX0KCgkJZXh0ZW5zaW9uWyBtZXRob2ROYW1lIF0oIG1vZGUsIGNvdW50LCB0eXBlLCBzdGFydCAqIGJ5dGVzUGVyRWxlbWVudCwgcHJpbWNvdW50ICk7CgoJCWluZm8udXBkYXRlKCBjb3VudCwgbW9kZSwgcHJpbWNvdW50ICk7CgoJfQoKCS8vCgoJdGhpcy5zZXRNb2RlID0gc2V0TW9kZTsKCXRoaXMuc2V0SW5kZXggPSBzZXRJbmRleDsKCXRoaXMucmVuZGVyID0gcmVuZGVyOwoJdGhpcy5yZW5kZXJJbnN0YW5jZXMgPSByZW5kZXJJbnN0YW5jZXM7Cgp9CgpmdW5jdGlvbiBXZWJHTEluZm8oIGdsICkgewoKCWNvbnN0IG1lbW9yeSA9IHsKCQlnZW9tZXRyaWVzOiAwLAoJCXRleHR1cmVzOiAwCgl9OwoKCWNvbnN0IHJlbmRlciA9IHsKCQlmcmFtZTogMCwKCQljYWxsczogMCwKCQl0cmlhbmdsZXM6IDAsCgkJcG9pbnRzOiAwLAoJCWxpbmVzOiAwCgl9OwoKCWZ1bmN0aW9uIHVwZGF0ZSggY291bnQsIG1vZGUsIGluc3RhbmNlQ291bnQgKSB7CgoJCXJlbmRlci5jYWxscyArKzsKCgkJc3dpdGNoICggbW9kZSApIHsKCgkJCWNhc2UgZ2wuVFJJQU5HTEVTOgoJCQkJcmVuZGVyLnRyaWFuZ2xlcyArPSBpbnN0YW5jZUNvdW50ICogKCBjb3VudCAvIDMgKTsKCQkJCWJyZWFrOwoKCQkJY2FzZSBnbC5MSU5FUzoKCQkJCXJlbmRlci5saW5lcyArPSBpbnN0YW5jZUNvdW50ICogKCBjb3VudCAvIDIgKTsKCQkJCWJyZWFrOwoKCQkJY2FzZSBnbC5MSU5FX1NUUklQOgoJCQkJcmVuZGVyLmxpbmVzICs9IGluc3RhbmNlQ291bnQgKiAoIGNvdW50IC0gMSApOwoJCQkJYnJlYWs7CgoJCQljYXNlIGdsLkxJTkVfTE9PUDoKCQkJCXJlbmRlci5saW5lcyArPSBpbnN0YW5jZUNvdW50ICogY291bnQ7CgkJCQlicmVhazsKCgkJCWNhc2UgZ2wuUE9JTlRTOgoJCQkJcmVuZGVyLnBvaW50cyArPSBpbnN0YW5jZUNvdW50ICogY291bnQ7CgkJCQlicmVhazsKCgkJCWRlZmF1bHQ6CgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xJbmZvOiBVbmtub3duIGRyYXcgbW9kZTonLCBtb2RlICk7CgkJCQlicmVhazsKCgkJfQoKCX0KCglmdW5jdGlvbiByZXNldCgpIHsKCgkJcmVuZGVyLmNhbGxzID0gMDsKCQlyZW5kZXIudHJpYW5nbGVzID0gMDsKCQlyZW5kZXIucG9pbnRzID0gMDsKCQlyZW5kZXIubGluZXMgPSAwOwoKCX0KCglyZXR1cm4gewoJCW1lbW9yeTogbWVtb3J5LAoJCXJlbmRlcjogcmVuZGVyLAoJCXByb2dyYW1zOiBudWxsLAoJCWF1dG9SZXNldDogdHJ1ZSwKCQlyZXNldDogcmVzZXQsCgkJdXBkYXRlOiB1cGRhdGUKCX07Cgp9CgpmdW5jdGlvbiBudW1lcmljYWxTb3J0KCBhLCBiICkgewoKCXJldHVybiBhWyAwIF0gLSBiWyAwIF07Cgp9CgpmdW5jdGlvbiBhYnNOdW1lcmljYWxTb3J0KCBhLCBiICkgewoKCXJldHVybiBNYXRoLmFicyggYlsgMSBdICkgLSBNYXRoLmFicyggYVsgMSBdICk7Cgp9CgpmdW5jdGlvbiBXZWJHTE1vcnBodGFyZ2V0cyggZ2wsIGNhcGFiaWxpdGllcywgdGV4dHVyZXMgKSB7CgoJY29uc3QgaW5mbHVlbmNlc0xpc3QgPSB7fTsKCWNvbnN0IG1vcnBoSW5mbHVlbmNlcyA9IG5ldyBGbG9hdDMyQXJyYXkoIDggKTsKCWNvbnN0IG1vcnBoVGV4dHVyZXMgPSBuZXcgV2Vha01hcCgpOwoJY29uc3QgbW9ycGggPSBuZXcgVmVjdG9yNCgpOwoKCWNvbnN0IHdvcmtJbmZsdWVuY2VzID0gW107CgoJZm9yICggbGV0IGkgPSAwOyBpIDwgODsgaSArKyApIHsKCgkJd29ya0luZmx1ZW5jZXNbIGkgXSA9IFsgaSwgMCBdOwoKCX0KCglmdW5jdGlvbiB1cGRhdGUoIG9iamVjdCwgZ2VvbWV0cnksIHByb2dyYW0gKSB7CgoJCWNvbnN0IG9iamVjdEluZmx1ZW5jZXMgPSBvYmplY3QubW9ycGhUYXJnZXRJbmZsdWVuY2VzOwoKCQlpZiAoIGNhcGFiaWxpdGllcy5pc1dlYkdMMiA9PT0gdHJ1ZSApIHsKCgkJCS8vIGluc3RlYWQgb2YgdXNpbmcgYXR0cmlidXRlcywgdGhlIFdlYkdMIDIgY29kZSBwYXRoIGVuY29kZXMgbW9ycGggdGFyZ2V0cwoJCQkvLyBpbnRvIGFuIGFycmF5IG9mIGRhdGEgdGV4dHVyZXMuIEVhY2ggbGF5ZXIgcmVwcmVzZW50cyBhIHNpbmdsZSBtb3JwaCB0YXJnZXQuCgoJCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbiB8fCBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMubm9ybWFsIHx8IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5jb2xvcjsKCQkJY29uc3QgbW9ycGhUYXJnZXRzQ291bnQgPSAoIG1vcnBoQXR0cmlidXRlICE9PSB1bmRlZmluZWQgKSA/IG1vcnBoQXR0cmlidXRlLmxlbmd0aCA6IDA7CgoJCQlsZXQgZW50cnkgPSBtb3JwaFRleHR1cmVzLmdldCggZ2VvbWV0cnkgKTsKCgkJCWlmICggZW50cnkgPT09IHVuZGVmaW5lZCB8fCBlbnRyeS5jb3VudCAhPT0gbW9ycGhUYXJnZXRzQ291bnQgKSB7CgoJCQkJaWYgKCBlbnRyeSAhPT0gdW5kZWZpbmVkICkgZW50cnkudGV4dHVyZS5kaXNwb3NlKCk7CgoJCQkJY29uc3QgaGFzTW9ycGhQb3NpdGlvbiA9IGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbiAhPT0gdW5kZWZpbmVkOwoJCQkJY29uc3QgaGFzTW9ycGhOb3JtYWxzID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLm5vcm1hbCAhPT0gdW5kZWZpbmVkOwoJCQkJY29uc3QgaGFzTW9ycGhDb2xvcnMgPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMuY29sb3IgIT09IHVuZGVmaW5lZDsKCgkJCQljb25zdCBtb3JwaFRhcmdldHMgPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb24gfHwgW107CgkJCQljb25zdCBtb3JwaE5vcm1hbHMgPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMubm9ybWFsIHx8IFtdOwoJCQkJY29uc3QgbW9ycGhDb2xvcnMgPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMuY29sb3IgfHwgW107CgoJCQkJbGV0IHZlcnRleERhdGFDb3VudCA9IDA7CgoJCQkJaWYgKCBoYXNNb3JwaFBvc2l0aW9uID09PSB0cnVlICkgdmVydGV4RGF0YUNvdW50ID0gMTsKCQkJCWlmICggaGFzTW9ycGhOb3JtYWxzID09PSB0cnVlICkgdmVydGV4RGF0YUNvdW50ID0gMjsKCQkJCWlmICggaGFzTW9ycGhDb2xvcnMgPT09IHRydWUgKSB2ZXJ0ZXhEYXRhQ291bnQgPSAzOwoKCQkJCWxldCB3aWR0aCA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb24uY291bnQgKiB2ZXJ0ZXhEYXRhQ291bnQ7CgkJCQlsZXQgaGVpZ2h0ID0gMTsKCgkJCQlpZiAoIHdpZHRoID4gY2FwYWJpbGl0aWVzLm1heFRleHR1cmVTaXplICkgewoKCQkJCQloZWlnaHQgPSBNYXRoLmNlaWwoIHdpZHRoIC8gY2FwYWJpbGl0aWVzLm1heFRleHR1cmVTaXplICk7CgkJCQkJd2lkdGggPSBjYXBhYmlsaXRpZXMubWF4VGV4dHVyZVNpemU7CgoJCQkJfQoKCQkJCWNvbnN0IGJ1ZmZlciA9IG5ldyBGbG9hdDMyQXJyYXkoIHdpZHRoICogaGVpZ2h0ICogNCAqIG1vcnBoVGFyZ2V0c0NvdW50ICk7CgoJCQkJY29uc3QgdGV4dHVyZSA9IG5ldyBEYXRhQXJyYXlUZXh0dXJlKCBidWZmZXIsIHdpZHRoLCBoZWlnaHQsIG1vcnBoVGFyZ2V0c0NvdW50ICk7CgkJCQl0ZXh0dXJlLnR5cGUgPSBGbG9hdFR5cGU7CgkJCQl0ZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQkvLyBmaWxsIGJ1ZmZlcgoKCQkJCWNvbnN0IHZlcnRleERhdGFTdHJpZGUgPSB2ZXJ0ZXhEYXRhQ291bnQgKiA0OwoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IG1vcnBoVGFyZ2V0c0NvdW50OyBpICsrICkgewoKCQkJCQljb25zdCBtb3JwaFRhcmdldCA9IG1vcnBoVGFyZ2V0c1sgaSBdOwoJCQkJCWNvbnN0IG1vcnBoTm9ybWFsID0gbW9ycGhOb3JtYWxzWyBpIF07CgkJCQkJY29uc3QgbW9ycGhDb2xvciA9IG1vcnBoQ29sb3JzWyBpIF07CgoJCQkJCWNvbnN0IG9mZnNldCA9IHdpZHRoICogaGVpZ2h0ICogNCAqIGk7CgoJCQkJCWZvciAoIGxldCBqID0gMDsgaiA8IG1vcnBoVGFyZ2V0LmNvdW50OyBqICsrICkgewoKCQkJCQkJY29uc3Qgc3RyaWRlID0gaiAqIHZlcnRleERhdGFTdHJpZGU7CgoJCQkJCQlpZiAoIGhhc01vcnBoUG9zaXRpb24gPT09IHRydWUgKSB7CgoJCQkJCQkJbW9ycGguZnJvbUJ1ZmZlckF0dHJpYnV0ZSggbW9ycGhUYXJnZXQsIGogKTsKCgkJCQkJCQlidWZmZXJbIG9mZnNldCArIHN0cmlkZSArIDAgXSA9IG1vcnBoLng7CgkJCQkJCQlidWZmZXJbIG9mZnNldCArIHN0cmlkZSArIDEgXSA9IG1vcnBoLnk7CgkJCQkJCQlidWZmZXJbIG9mZnNldCArIHN0cmlkZSArIDIgXSA9IG1vcnBoLno7CgkJCQkJCQlidWZmZXJbIG9mZnNldCArIHN0cmlkZSArIDMgXSA9IDA7CgoJCQkJCQl9CgoJCQkJCQlpZiAoIGhhc01vcnBoTm9ybWFscyA9PT0gdHJ1ZSApIHsKCgkJCQkJCQltb3JwaC5mcm9tQnVmZmVyQXR0cmlidXRlKCBtb3JwaE5vcm1hbCwgaiApOwoKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgNCBdID0gbW9ycGgueDsKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgNSBdID0gbW9ycGgueTsKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgNiBdID0gbW9ycGguejsKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgNyBdID0gMDsKCgkJCQkJCX0KCgkJCQkJCWlmICggaGFzTW9ycGhDb2xvcnMgPT09IHRydWUgKSB7CgoJCQkJCQkJbW9ycGguZnJvbUJ1ZmZlckF0dHJpYnV0ZSggbW9ycGhDb2xvciwgaiApOwoKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgOCBdID0gbW9ycGgueDsKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgOSBdID0gbW9ycGgueTsKCQkJCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgc3RyaWRlICsgMTAgXSA9IG1vcnBoLno7CgkJCQkJCQlidWZmZXJbIG9mZnNldCArIHN0cmlkZSArIDExIF0gPSAoIG1vcnBoQ29sb3IuaXRlbVNpemUgPT09IDQgKSA/IG1vcnBoLncgOiAxOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJCWVudHJ5ID0gewoJCQkJCWNvdW50OiBtb3JwaFRhcmdldHNDb3VudCwKCQkJCQl0ZXh0dXJlOiB0ZXh0dXJlLAoJCQkJCXNpemU6IG5ldyBWZWN0b3IyKCB3aWR0aCwgaGVpZ2h0ICkKCQkJCX07CgoJCQkJbW9ycGhUZXh0dXJlcy5zZXQoIGdlb21ldHJ5LCBlbnRyeSApOwoKCQkJCWZ1bmN0aW9uIGRpc3Bvc2VUZXh0dXJlKCkgewoKCQkJCQl0ZXh0dXJlLmRpc3Bvc2UoKTsKCgkJCQkJbW9ycGhUZXh0dXJlcy5kZWxldGUoIGdlb21ldHJ5ICk7CgoJCQkJCWdlb21ldHJ5LnJlbW92ZUV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgZGlzcG9zZVRleHR1cmUgKTsKCgkJCQl9CgoJCQkJZ2VvbWV0cnkuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBkaXNwb3NlVGV4dHVyZSApOwoKCQkJfQoKCQkJLy8KCgkJCWxldCBtb3JwaEluZmx1ZW5jZXNTdW0gPSAwOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgb2JqZWN0SW5mbHVlbmNlcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJbW9ycGhJbmZsdWVuY2VzU3VtICs9IG9iamVjdEluZmx1ZW5jZXNbIGkgXTsKCgkJCX0KCgkJCWNvbnN0IG1vcnBoQmFzZUluZmx1ZW5jZSA9IGdlb21ldHJ5Lm1vcnBoVGFyZ2V0c1JlbGF0aXZlID8gMSA6IDEgLSBtb3JwaEluZmx1ZW5jZXNTdW07CgoJCQlwcm9ncmFtLmdldFVuaWZvcm1zKCkuc2V0VmFsdWUoIGdsLCAnbW9ycGhUYXJnZXRCYXNlSW5mbHVlbmNlJywgbW9ycGhCYXNlSW5mbHVlbmNlICk7CgkJCXByb2dyYW0uZ2V0VW5pZm9ybXMoKS5zZXRWYWx1ZSggZ2wsICdtb3JwaFRhcmdldEluZmx1ZW5jZXMnLCBvYmplY3RJbmZsdWVuY2VzICk7CgoJCQlwcm9ncmFtLmdldFVuaWZvcm1zKCkuc2V0VmFsdWUoIGdsLCAnbW9ycGhUYXJnZXRzVGV4dHVyZScsIGVudHJ5LnRleHR1cmUsIHRleHR1cmVzICk7CgkJCXByb2dyYW0uZ2V0VW5pZm9ybXMoKS5zZXRWYWx1ZSggZ2wsICdtb3JwaFRhcmdldHNUZXh0dXJlU2l6ZScsIGVudHJ5LnNpemUgKTsKCgoJCX0gZWxzZSB7CgoJCQkvLyBXaGVuIG9iamVjdCBkb2Vzbid0IGhhdmUgbW9ycGggdGFyZ2V0IGluZmx1ZW5jZXMgZGVmaW5lZCwgd2UgdHJlYXQgaXQgYXMgYSAwLWxlbmd0aCBhcnJheQoJCQkvLyBUaGlzIGlzIGltcG9ydGFudCB0byBtYWtlIHN1cmUgd2Ugc2V0IHVwIG1vcnBoVGFyZ2V0QmFzZUluZmx1ZW5jZSAvIG1vcnBoVGFyZ2V0SW5mbHVlbmNlcwoKCQkJY29uc3QgbGVuZ3RoID0gb2JqZWN0SW5mbHVlbmNlcyA9PT0gdW5kZWZpbmVkID8gMCA6IG9iamVjdEluZmx1ZW5jZXMubGVuZ3RoOwoKCQkJbGV0IGluZmx1ZW5jZXMgPSBpbmZsdWVuY2VzTGlzdFsgZ2VvbWV0cnkuaWQgXTsKCgkJCWlmICggaW5mbHVlbmNlcyA9PT0gdW5kZWZpbmVkIHx8IGluZmx1ZW5jZXMubGVuZ3RoICE9PSBsZW5ndGggKSB7CgoJCQkJLy8gaW5pdGlhbGlzZSBsaXN0CgoJCQkJaW5mbHVlbmNlcyA9IFtdOwoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IGxlbmd0aDsgaSArKyApIHsKCgkJCQkJaW5mbHVlbmNlc1sgaSBdID0gWyBpLCAwIF07CgoJCQkJfQoKCQkJCWluZmx1ZW5jZXNMaXN0WyBnZW9tZXRyeS5pZCBdID0gaW5mbHVlbmNlczsKCgkJCX0KCgkJCS8vIENvbGxlY3QgaW5mbHVlbmNlcwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgbGVuZ3RoOyBpICsrICkgewoKCQkJCWNvbnN0IGluZmx1ZW5jZSA9IGluZmx1ZW5jZXNbIGkgXTsKCgkJCQlpbmZsdWVuY2VbIDAgXSA9IGk7CgkJCQlpbmZsdWVuY2VbIDEgXSA9IG9iamVjdEluZmx1ZW5jZXNbIGkgXTsKCgkJCX0KCgkJCWluZmx1ZW5jZXMuc29ydCggYWJzTnVtZXJpY2FsU29ydCApOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgODsgaSArKyApIHsKCgkJCQlpZiAoIGkgPCBsZW5ndGggJiYgaW5mbHVlbmNlc1sgaSBdWyAxIF0gKSB7CgoJCQkJCXdvcmtJbmZsdWVuY2VzWyBpIF1bIDAgXSA9IGluZmx1ZW5jZXNbIGkgXVsgMCBdOwoJCQkJCXdvcmtJbmZsdWVuY2VzWyBpIF1bIDEgXSA9IGluZmx1ZW5jZXNbIGkgXVsgMSBdOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXdvcmtJbmZsdWVuY2VzWyBpIF1bIDAgXSA9IE51bWJlci5NQVhfU0FGRV9JTlRFR0VSOwoJCQkJCXdvcmtJbmZsdWVuY2VzWyBpIF1bIDEgXSA9IDA7CgoJCQkJfQoKCQkJfQoKCQkJd29ya0luZmx1ZW5jZXMuc29ydCggbnVtZXJpY2FsU29ydCApOwoKCQkJY29uc3QgbW9ycGhUYXJnZXRzID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLnBvc2l0aW9uOwoJCQljb25zdCBtb3JwaE5vcm1hbHMgPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMubm9ybWFsOwoKCQkJbGV0IG1vcnBoSW5mbHVlbmNlc1N1bSA9IDA7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA4OyBpICsrICkgewoKCQkJCWNvbnN0IGluZmx1ZW5jZSA9IHdvcmtJbmZsdWVuY2VzWyBpIF07CgkJCQljb25zdCBpbmRleCA9IGluZmx1ZW5jZVsgMCBdOwoJCQkJY29uc3QgdmFsdWUgPSBpbmZsdWVuY2VbIDEgXTsKCgkJCQlpZiAoIGluZGV4ICE9PSBOdW1iZXIuTUFYX1NBRkVfSU5URUdFUiAmJiB2YWx1ZSApIHsKCgkJCQkJaWYgKCBtb3JwaFRhcmdldHMgJiYgZ2VvbWV0cnkuZ2V0QXR0cmlidXRlKCAnbW9ycGhUYXJnZXQnICsgaSApICE9PSBtb3JwaFRhcmdldHNbIGluZGV4IF0gKSB7CgoJCQkJCQlnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoICdtb3JwaFRhcmdldCcgKyBpLCBtb3JwaFRhcmdldHNbIGluZGV4IF0gKTsKCgkJCQkJfQoKCQkJCQlpZiAoIG1vcnBoTm9ybWFscyAmJiBnZW9tZXRyeS5nZXRBdHRyaWJ1dGUoICdtb3JwaE5vcm1hbCcgKyBpICkgIT09IG1vcnBoTm9ybWFsc1sgaW5kZXggXSApIHsKCgkJCQkJCWdlb21ldHJ5LnNldEF0dHJpYnV0ZSggJ21vcnBoTm9ybWFsJyArIGksIG1vcnBoTm9ybWFsc1sgaW5kZXggXSApOwoKCQkJCQl9CgoJCQkJCW1vcnBoSW5mbHVlbmNlc1sgaSBdID0gdmFsdWU7CgkJCQkJbW9ycGhJbmZsdWVuY2VzU3VtICs9IHZhbHVlOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWlmICggbW9ycGhUYXJnZXRzICYmIGdlb21ldHJ5Lmhhc0F0dHJpYnV0ZSggJ21vcnBoVGFyZ2V0JyArIGkgKSA9PT0gdHJ1ZSApIHsKCgkJCQkJCWdlb21ldHJ5LmRlbGV0ZUF0dHJpYnV0ZSggJ21vcnBoVGFyZ2V0JyArIGkgKTsKCgkJCQkJfQoKCQkJCQlpZiAoIG1vcnBoTm9ybWFscyAmJiBnZW9tZXRyeS5oYXNBdHRyaWJ1dGUoICdtb3JwaE5vcm1hbCcgKyBpICkgPT09IHRydWUgKSB7CgoJCQkJCQlnZW9tZXRyeS5kZWxldGVBdHRyaWJ1dGUoICdtb3JwaE5vcm1hbCcgKyBpICk7CgoJCQkJCX0KCgkJCQkJbW9ycGhJbmZsdWVuY2VzWyBpIF0gPSAwOwoKCQkJCX0KCgkJCX0KCgkJCS8vIEdMU0wgc2hhZGVyIHVzZXMgZm9ybXVsYSBiYXNlaW5mbHVlbmNlICogYmFzZSArIHN1bSh0YXJnZXQgKiBpbmZsdWVuY2UpCgkJCS8vIFRoaXMgYWxsb3dzIHVzIHRvIHN3aXRjaCBiZXR3ZWVuIGFic29sdXRlIG1vcnBocyBhbmQgcmVsYXRpdmUgbW9ycGhzIHdpdGhvdXQgY2hhbmdpbmcgc2hhZGVyIGNvZGUKCQkJLy8gV2hlbiBiYXNlaW5mbHVlbmNlID0gMSAtIHN1bShpbmZsdWVuY2UpLCB0aGUgYWJvdmUgaXMgZXF1aXZhbGVudCB0byBzdW0oKHRhcmdldCAtIGJhc2UpICogaW5mbHVlbmNlKQoJCQljb25zdCBtb3JwaEJhc2VJbmZsdWVuY2UgPSBnZW9tZXRyeS5tb3JwaFRhcmdldHNSZWxhdGl2ZSA/IDEgOiAxIC0gbW9ycGhJbmZsdWVuY2VzU3VtOwoKCQkJcHJvZ3JhbS5nZXRVbmlmb3JtcygpLnNldFZhbHVlKCBnbCwgJ21vcnBoVGFyZ2V0QmFzZUluZmx1ZW5jZScsIG1vcnBoQmFzZUluZmx1ZW5jZSApOwoJCQlwcm9ncmFtLmdldFVuaWZvcm1zKCkuc2V0VmFsdWUoIGdsLCAnbW9ycGhUYXJnZXRJbmZsdWVuY2VzJywgbW9ycGhJbmZsdWVuY2VzICk7CgoJCX0KCgl9CgoJcmV0dXJuIHsKCgkJdXBkYXRlOiB1cGRhdGUKCgl9OwoKfQoKZnVuY3Rpb24gV2ViR0xPYmplY3RzKCBnbCwgZ2VvbWV0cmllcywgYXR0cmlidXRlcywgaW5mbyApIHsKCglsZXQgdXBkYXRlTWFwID0gbmV3IFdlYWtNYXAoKTsKCglmdW5jdGlvbiB1cGRhdGUoIG9iamVjdCApIHsKCgkJY29uc3QgZnJhbWUgPSBpbmZvLnJlbmRlci5mcmFtZTsKCgkJY29uc3QgZ2VvbWV0cnkgPSBvYmplY3QuZ2VvbWV0cnk7CgkJY29uc3QgYnVmZmVyZ2VvbWV0cnkgPSBnZW9tZXRyaWVzLmdldCggb2JqZWN0LCBnZW9tZXRyeSApOwoKCQkvLyBVcGRhdGUgb25jZSBwZXIgZnJhbWUKCgkJaWYgKCB1cGRhdGVNYXAuZ2V0KCBidWZmZXJnZW9tZXRyeSApICE9PSBmcmFtZSApIHsKCgkJCWdlb21ldHJpZXMudXBkYXRlKCBidWZmZXJnZW9tZXRyeSApOwoKCQkJdXBkYXRlTWFwLnNldCggYnVmZmVyZ2VvbWV0cnksIGZyYW1lICk7CgoJCX0KCgkJaWYgKCBvYmplY3QuaXNJbnN0YW5jZWRNZXNoICkgewoKCQkJaWYgKCBvYmplY3QuaGFzRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbkluc3RhbmNlZE1lc2hEaXNwb3NlICkgPT09IGZhbHNlICkgewoKCQkJCW9iamVjdC5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uSW5zdGFuY2VkTWVzaERpc3Bvc2UgKTsKCgkJCX0KCgkJCWlmICggdXBkYXRlTWFwLmdldCggb2JqZWN0ICkgIT09IGZyYW1lICkgewoKCQkJCWF0dHJpYnV0ZXMudXBkYXRlKCBvYmplY3QuaW5zdGFuY2VNYXRyaXgsIGdsLkFSUkFZX0JVRkZFUiApOwoKCQkJCWlmICggb2JqZWN0Lmluc3RhbmNlQ29sb3IgIT09IG51bGwgKSB7CgoJCQkJCWF0dHJpYnV0ZXMudXBkYXRlKCBvYmplY3QuaW5zdGFuY2VDb2xvciwgZ2wuQVJSQVlfQlVGRkVSICk7CgoJCQkJfQoKCQkJCXVwZGF0ZU1hcC5zZXQoIG9iamVjdCwgZnJhbWUgKTsKCgkJCX0KCgkJfQoKCQlpZiAoIG9iamVjdC5pc1NraW5uZWRNZXNoICkgewoKCQkJY29uc3Qgc2tlbGV0b24gPSBvYmplY3Quc2tlbGV0b247CgoJCQlpZiAoIHVwZGF0ZU1hcC5nZXQoIHNrZWxldG9uICkgIT09IGZyYW1lICkgewoKCQkJCXNrZWxldG9uLnVwZGF0ZSgpOwoKCQkJCXVwZGF0ZU1hcC5zZXQoIHNrZWxldG9uLCBmcmFtZSApOwoKCQkJfQoKCQl9CgoJCXJldHVybiBidWZmZXJnZW9tZXRyeTsKCgl9CgoJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCgkJdXBkYXRlTWFwID0gbmV3IFdlYWtNYXAoKTsKCgl9CgoJZnVuY3Rpb24gb25JbnN0YW5jZWRNZXNoRGlzcG9zZSggZXZlbnQgKSB7CgoJCWNvbnN0IGluc3RhbmNlZE1lc2ggPSBldmVudC50YXJnZXQ7CgoJCWluc3RhbmNlZE1lc2gucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbkluc3RhbmNlZE1lc2hEaXNwb3NlICk7CgoJCWF0dHJpYnV0ZXMucmVtb3ZlKCBpbnN0YW5jZWRNZXNoLmluc3RhbmNlTWF0cml4ICk7CgoJCWlmICggaW5zdGFuY2VkTWVzaC5pbnN0YW5jZUNvbG9yICE9PSBudWxsICkgYXR0cmlidXRlcy5yZW1vdmUoIGluc3RhbmNlZE1lc2guaW5zdGFuY2VDb2xvciApOwoKCX0KCglyZXR1cm4gewoKCQl1cGRhdGU6IHVwZGF0ZSwKCQlkaXNwb3NlOiBkaXNwb3NlCgoJfTsKCn0KCi8qKgogKiBVbmlmb3JtcyBvZiBhIHByb2dyYW0uCiAqIFRob3NlIGZvcm0gYSB0cmVlIHN0cnVjdHVyZSB3aXRoIGEgc3BlY2lhbCB0b3AtbGV2ZWwgY29udGFpbmVyIGZvciB0aGUgcm9vdCwKICogd2hpY2ggeW91IGdldCBieSBjYWxsaW5nICduZXcgV2ViR0xVbmlmb3JtcyggZ2wsIHByb2dyYW0gKScuCiAqCiAqCiAqIFByb3BlcnRpZXMgb2YgaW5uZXIgbm9kZXMgaW5jbHVkaW5nIHRoZSB0b3AtbGV2ZWwgY29udGFpbmVyOgogKgogKiAuc2VxIC0gYXJyYXkgb2YgbmVzdGVkIHVuaWZvcm1zCiAqIC5tYXAgLSBuZXN0ZWQgdW5pZm9ybXMgYnkgbmFtZQogKgogKgogKiBNZXRob2RzIG9mIGFsbCBub2RlcyBleGNlcHQgdGhlIHRvcC1sZXZlbCBjb250YWluZXI6CiAqCiAqIC5zZXRWYWx1ZSggZ2wsIHZhbHVlLCBbdGV4dHVyZXNdICkKICoKICogCQl1cGxvYWRzIGEgdW5pZm9ybSB2YWx1ZShzKQogKiAgCXRoZSAndGV4dHVyZXMnIHBhcmFtZXRlciBpcyBuZWVkZWQgZm9yIHNhbXBsZXIgdW5pZm9ybXMKICoKICoKICogU3RhdGljIG1ldGhvZHMgb2YgdGhlIHRvcC1sZXZlbCBjb250YWluZXIgKHRleHR1cmVzIGZhY3Rvcml6YXRpb25zKToKICoKICogLnVwbG9hZCggZ2wsIHNlcSwgdmFsdWVzLCB0ZXh0dXJlcyApCiAqCiAqIAkJc2V0cyB1bmlmb3JtcyBpbiAnc2VxJyB0byAndmFsdWVzW2lkXS52YWx1ZScKICoKICogLnNlcVdpdGhWYWx1ZSggc2VxLCB2YWx1ZXMgKSA6IGZpbHRlcmVkU2VxCiAqCiAqIAkJZmlsdGVycyAnc2VxJyBlbnRyaWVzIHdpdGggY29ycmVzcG9uZGluZyBlbnRyeSBpbiB2YWx1ZXMKICoKICoKICogTWV0aG9kcyBvZiB0aGUgdG9wLWxldmVsIGNvbnRhaW5lciAodGV4dHVyZXMgZmFjdG9yaXphdGlvbnMpOgogKgogKiAuc2V0VmFsdWUoIGdsLCBuYW1lLCB2YWx1ZSwgdGV4dHVyZXMgKQogKgogKiAJCXNldHMgdW5pZm9ybSB3aXRoICBuYW1lICduYW1lJyB0byAndmFsdWUnCiAqCiAqIC5zZXRPcHRpb25hbCggZ2wsIG9iaiwgcHJvcCApCiAqCiAqIAkJbGlrZSAuc2V0IGZvciBhbiBvcHRpb25hbCBwcm9wZXJ0eSBvZiB0aGUgb2JqZWN0CiAqCiAqLwoKCmNvbnN0IGVtcHR5VGV4dHVyZSA9IC8qQF9fUFVSRV9fKi8gbmV3IFRleHR1cmUoKTsKY29uc3QgZW1wdHlBcnJheVRleHR1cmUgPSAvKkBfX1BVUkVfXyovIG5ldyBEYXRhQXJyYXlUZXh0dXJlKCk7CmNvbnN0IGVtcHR5M2RUZXh0dXJlID0gLypAX19QVVJFX18qLyBuZXcgRGF0YTNEVGV4dHVyZSgpOwpjb25zdCBlbXB0eUN1YmVUZXh0dXJlID0gLypAX19QVVJFX18qLyBuZXcgQ3ViZVRleHR1cmUoKTsKCi8vIC0tLSBVdGlsaXRpZXMgLS0tCgovLyBBcnJheSBDYWNoZXMgKHByb3ZpZGUgdHlwZWQgYXJyYXlzIGZvciB0ZW1wb3JhcnkgYnkgc2l6ZSkKCmNvbnN0IGFycmF5Q2FjaGVGMzIgPSBbXTsKY29uc3QgYXJyYXlDYWNoZUkzMiA9IFtdOwoKLy8gRmxvYXQzMkFycmF5IGNhY2hlcyB1c2VkIGZvciB1cGxvYWRpbmcgTWF0cml4IHVuaWZvcm1zCgpjb25zdCBtYXQ0YXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KCAxNiApOwpjb25zdCBtYXQzYXJyYXkgPSBuZXcgRmxvYXQzMkFycmF5KCA5ICk7CmNvbnN0IG1hdDJhcnJheSA9IG5ldyBGbG9hdDMyQXJyYXkoIDQgKTsKCi8vIEZsYXR0ZW5pbmcgZm9yIGFycmF5cyBvZiB2ZWN0b3JzIGFuZCBtYXRyaWNlcwoKZnVuY3Rpb24gZmxhdHRlbiggYXJyYXksIG5CbG9ja3MsIGJsb2NrU2l6ZSApIHsKCgljb25zdCBmaXJzdEVsZW0gPSBhcnJheVsgMCBdOwoKCWlmICggZmlyc3RFbGVtIDw9IDAgfHwgZmlyc3RFbGVtID4gMCApIHJldHVybiBhcnJheTsKCS8vIHVub3B0aW1pemVkOiAhIGlzTmFOKCBmaXJzdEVsZW0gKQoJLy8gc2VlIGh0dHA6Ly9qYWNrc29uZHVuc3Rhbi5jb20vYXJ0aWNsZXMvOTgzCgoJY29uc3QgbiA9IG5CbG9ja3MgKiBibG9ja1NpemU7CglsZXQgciA9IGFycmF5Q2FjaGVGMzJbIG4gXTsKCglpZiAoIHIgPT09IHVuZGVmaW5lZCApIHsKCgkJciA9IG5ldyBGbG9hdDMyQXJyYXkoIG4gKTsKCQlhcnJheUNhY2hlRjMyWyBuIF0gPSByOwoKCX0KCglpZiAoIG5CbG9ja3MgIT09IDAgKSB7CgoJCWZpcnN0RWxlbS50b0FycmF5KCByLCAwICk7CgoJCWZvciAoIGxldCBpID0gMSwgb2Zmc2V0ID0gMDsgaSAhPT0gbkJsb2NrczsgKysgaSApIHsKCgkJCW9mZnNldCArPSBibG9ja1NpemU7CgkJCWFycmF5WyBpIF0udG9BcnJheSggciwgb2Zmc2V0ICk7CgoJCX0KCgl9CgoJcmV0dXJuIHI7Cgp9CgpmdW5jdGlvbiBhcnJheXNFcXVhbCggYSwgYiApIHsKCglpZiAoIGEubGVuZ3RoICE9PSBiLmxlbmd0aCApIHJldHVybiBmYWxzZTsKCglmb3IgKCBsZXQgaSA9IDAsIGwgPSBhLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCWlmICggYVsgaSBdICE9PSBiWyBpIF0gKSByZXR1cm4gZmFsc2U7CgoJfQoKCXJldHVybiB0cnVlOwoKfQoKZnVuY3Rpb24gY29weUFycmF5KCBhLCBiICkgewoKCWZvciAoIGxldCBpID0gMCwgbCA9IGIubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJYVsgaSBdID0gYlsgaSBdOwoKCX0KCn0KCi8vIFRleHR1cmUgdW5pdCBhbGxvY2F0aW9uCgpmdW5jdGlvbiBhbGxvY1RleFVuaXRzKCB0ZXh0dXJlcywgbiApIHsKCglsZXQgciA9IGFycmF5Q2FjaGVJMzJbIG4gXTsKCglpZiAoIHIgPT09IHVuZGVmaW5lZCApIHsKCgkJciA9IG5ldyBJbnQzMkFycmF5KCBuICk7CgkJYXJyYXlDYWNoZUkzMlsgbiBdID0gcjsKCgl9CgoJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKCQlyWyBpIF0gPSB0ZXh0dXJlcy5hbGxvY2F0ZVRleHR1cmVVbml0KCk7CgoJfQoKCXJldHVybiByOwoKfQoKLy8gLS0tIFNldHRlcnMgLS0tCgovLyBOb3RlOiBEZWZpbmluZyB0aGVzZSBtZXRob2RzIGV4dGVybmFsbHksIGJlY2F1c2UgdGhleSBjb21lIGluIGEgYnVuY2gKLy8gYW5kIHRoaXMgd2F5IHRoZWlyIG5hbWVzIG1pbmlmeS4KCi8vIFNpbmdsZSBzY2FsYXIKCmZ1bmN0aW9uIHNldFZhbHVlVjFmKCBnbCwgdiApIHsKCgljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgoJaWYgKCBjYWNoZVsgMCBdID09PSB2ICkgcmV0dXJuOwoKCWdsLnVuaWZvcm0xZiggdGhpcy5hZGRyLCB2ICk7CgoJY2FjaGVbIDAgXSA9IHY7Cgp9CgovLyBTaW5nbGUgZmxvYXQgdmVjdG9yIChmcm9tIGZsYXQgYXJyYXkgb3IgVEhSRUUuVmVjdG9yTikKCmZ1bmN0aW9uIHNldFZhbHVlVjJmKCBnbCwgdiApIHsKCgljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgoJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCgkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnggfHwgY2FjaGVbIDEgXSAhPT0gdi55ICkgewoKCQkJZ2wudW5pZm9ybTJmKCB0aGlzLmFkZHIsIHYueCwgdi55ICk7CgoJCQljYWNoZVsgMCBdID0gdi54OwoJCQljYWNoZVsgMSBdID0gdi55OwoKCQl9CgoJfSBlbHNlIHsKCgkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIHYgKSApIHJldHVybjsKCgkJZ2wudW5pZm9ybTJmdiggdGhpcy5hZGRyLCB2ICk7CgoJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCgl9Cgp9CgpmdW5jdGlvbiBzZXRWYWx1ZVYzZiggZ2wsIHYgKSB7CgoJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCWlmICggdi54ICE9PSB1bmRlZmluZWQgKSB7CgoJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSB8fCBjYWNoZVsgMiBdICE9PSB2LnogKSB7CgoJCQlnbC51bmlmb3JtM2YoIHRoaXMuYWRkciwgdi54LCB2LnksIHYueiApOwoKCQkJY2FjaGVbIDAgXSA9IHYueDsKCQkJY2FjaGVbIDEgXSA9IHYueTsKCQkJY2FjaGVbIDIgXSA9IHYuejsKCgkJfQoKCX0gZWxzZSBpZiAoIHYuciAhPT0gdW5kZWZpbmVkICkgewoKCQlpZiAoIGNhY2hlWyAwIF0gIT09IHYuciB8fCBjYWNoZVsgMSBdICE9PSB2LmcgfHwgY2FjaGVbIDIgXSAhPT0gdi5iICkgewoKCQkJZ2wudW5pZm9ybTNmKCB0aGlzLmFkZHIsIHYuciwgdi5nLCB2LmIgKTsKCgkJCWNhY2hlWyAwIF0gPSB2LnI7CgkJCWNhY2hlWyAxIF0gPSB2Lmc7CgkJCWNhY2hlWyAyIF0gPSB2LmI7CgoJCX0KCgl9IGVsc2UgewoKCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQlnbC51bmlmb3JtM2Z2KCB0aGlzLmFkZHIsIHYgKTsKCgkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKCX0KCn0KCmZ1bmN0aW9uIHNldFZhbHVlVjRmKCBnbCwgdiApIHsKCgljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgoJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCgkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnggfHwgY2FjaGVbIDEgXSAhPT0gdi55IHx8IGNhY2hlWyAyIF0gIT09IHYueiB8fCBjYWNoZVsgMyBdICE9PSB2LncgKSB7CgoJCQlnbC51bmlmb3JtNGYoIHRoaXMuYWRkciwgdi54LCB2LnksIHYueiwgdi53ICk7CgoJCQljYWNoZVsgMCBdID0gdi54OwoJCQljYWNoZVsgMSBdID0gdi55OwoJCQljYWNoZVsgMiBdID0gdi56OwoJCQljYWNoZVsgMyBdID0gdi53OwoKCQl9CgoJfSBlbHNlIHsKCgkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIHYgKSApIHJldHVybjsKCgkJZ2wudW5pZm9ybTRmdiggdGhpcy5hZGRyLCB2ICk7CgoJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCgl9Cgp9CgovLyBTaW5nbGUgbWF0cml4IChmcm9tIGZsYXQgYXJyYXkgb3IgVEhSRUUuTWF0cml4TikKCmZ1bmN0aW9uIHNldFZhbHVlTTIoIGdsLCB2ICkgewoKCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCWNvbnN0IGVsZW1lbnRzID0gdi5lbGVtZW50czsKCglpZiAoIGVsZW1lbnRzID09PSB1bmRlZmluZWQgKSB7CgoJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCWdsLnVuaWZvcm1NYXRyaXgyZnYoIHRoaXMuYWRkciwgZmFsc2UsIHYgKTsKCgkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKCX0gZWxzZSB7CgoJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCBlbGVtZW50cyApICkgcmV0dXJuOwoKCQltYXQyYXJyYXkuc2V0KCBlbGVtZW50cyApOwoKCQlnbC51bmlmb3JtTWF0cml4MmZ2KCB0aGlzLmFkZHIsIGZhbHNlLCBtYXQyYXJyYXkgKTsKCgkJY29weUFycmF5KCBjYWNoZSwgZWxlbWVudHMgKTsKCgl9Cgp9CgpmdW5jdGlvbiBzZXRWYWx1ZU0zKCBnbCwgdiApIHsKCgljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7Cgljb25zdCBlbGVtZW50cyA9IHYuZWxlbWVudHM7CgoJaWYgKCBlbGVtZW50cyA9PT0gdW5kZWZpbmVkICkgewoKCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQlnbC51bmlmb3JtTWF0cml4M2Z2KCB0aGlzLmFkZHIsIGZhbHNlLCB2ICk7CgoJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCgl9IGVsc2UgewoKCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgZWxlbWVudHMgKSApIHJldHVybjsKCgkJbWF0M2FycmF5LnNldCggZWxlbWVudHMgKTsKCgkJZ2wudW5pZm9ybU1hdHJpeDNmdiggdGhpcy5hZGRyLCBmYWxzZSwgbWF0M2FycmF5ICk7CgoJCWNvcHlBcnJheSggY2FjaGUsIGVsZW1lbnRzICk7CgoJfQoKfQoKZnVuY3Rpb24gc2V0VmFsdWVNNCggZ2wsIHYgKSB7CgoJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoJY29uc3QgZWxlbWVudHMgPSB2LmVsZW1lbnRzOwoKCWlmICggZWxlbWVudHMgPT09IHVuZGVmaW5lZCApIHsKCgkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIHYgKSApIHJldHVybjsKCgkJZ2wudW5pZm9ybU1hdHJpeDRmdiggdGhpcy5hZGRyLCBmYWxzZSwgdiApOwoKCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgoJfSBlbHNlIHsKCgkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIGVsZW1lbnRzICkgKSByZXR1cm47CgoJCW1hdDRhcnJheS5zZXQoIGVsZW1lbnRzICk7CgoJCWdsLnVuaWZvcm1NYXRyaXg0ZnYoIHRoaXMuYWRkciwgZmFsc2UsIG1hdDRhcnJheSApOwoKCQljb3B5QXJyYXkoIGNhY2hlLCBlbGVtZW50cyApOwoKCX0KCn0KCi8vIFNpbmdsZSBpbnRlZ2VyIC8gYm9vbGVhbgoKZnVuY3Rpb24gc2V0VmFsdWVWMWkoIGdsLCB2ICkgewoKCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCglpZiAoIGNhY2hlWyAwIF0gPT09IHYgKSByZXR1cm47CgoJZ2wudW5pZm9ybTFpKCB0aGlzLmFkZHIsIHYgKTsKCgljYWNoZVsgMCBdID0gdjsKCn0KCi8vIFNpbmdsZSBpbnRlZ2VyIC8gYm9vbGVhbiB2ZWN0b3IgKGZyb20gZmxhdCBhcnJheSBvciBUSFJFRS5WZWN0b3JOKQoKZnVuY3Rpb24gc2V0VmFsdWVWMmkoIGdsLCB2ICkgewoKCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCglpZiAoIHYueCAhPT0gdW5kZWZpbmVkICkgewoKCQlpZiAoIGNhY2hlWyAwIF0gIT09IHYueCB8fCBjYWNoZVsgMSBdICE9PSB2LnkgKSB7CgoJCQlnbC51bmlmb3JtMmkoIHRoaXMuYWRkciwgdi54LCB2LnkgKTsKCgkJCWNhY2hlWyAwIF0gPSB2Lng7CgkJCWNhY2hlWyAxIF0gPSB2Lnk7CgoJCX0KCgl9IGVsc2UgewoKCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQlnbC51bmlmb3JtMml2KCB0aGlzLmFkZHIsIHYgKTsKCgkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKCX0KCn0KCmZ1bmN0aW9uIHNldFZhbHVlVjNpKCBnbCwgdiApIHsKCgljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgoJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCgkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnggfHwgY2FjaGVbIDEgXSAhPT0gdi55IHx8IGNhY2hlWyAyIF0gIT09IHYueiApIHsKCgkJCWdsLnVuaWZvcm0zaSggdGhpcy5hZGRyLCB2LngsIHYueSwgdi56ICk7CgoJCQljYWNoZVsgMCBdID0gdi54OwoJCQljYWNoZVsgMSBdID0gdi55OwoJCQljYWNoZVsgMiBdID0gdi56OwoKCQl9CgoJfSBlbHNlIHsKCgkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIHYgKSApIHJldHVybjsKCgkJZ2wudW5pZm9ybTNpdiggdGhpcy5hZGRyLCB2ICk7CgoJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCgl9Cgp9CgpmdW5jdGlvbiBzZXRWYWx1ZVY0aSggZ2wsIHYgKSB7CgoJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCWlmICggdi54ICE9PSB1bmRlZmluZWQgKSB7CgoJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSB8fCBjYWNoZVsgMiBdICE9PSB2LnogfHwgY2FjaGVbIDMgXSAhPT0gdi53ICkgewoKCQkJZ2wudW5pZm9ybTRpKCB0aGlzLmFkZHIsIHYueCwgdi55LCB2LnosIHYudyApOwoKCQkJY2FjaGVbIDAgXSA9IHYueDsKCQkJY2FjaGVbIDEgXSA9IHYueTsKCQkJY2FjaGVbIDIgXSA9IHYuejsKCQkJY2FjaGVbIDMgXSA9IHYudzsKCgkJfQoKCX0gZWxzZSB7CgoJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCWdsLnVuaWZvcm00aXYoIHRoaXMuYWRkciwgdiApOwoKCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgoJfQoKfQoKLy8gU2luZ2xlIHVuc2lnbmVkIGludGVnZXIKCmZ1bmN0aW9uIHNldFZhbHVlVjF1aSggZ2wsIHYgKSB7CgoJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCWlmICggY2FjaGVbIDAgXSA9PT0gdiApIHJldHVybjsKCglnbC51bmlmb3JtMXVpKCB0aGlzLmFkZHIsIHYgKTsKCgljYWNoZVsgMCBdID0gdjsKCn0KCi8vIFNpbmdsZSB1bnNpZ25lZCBpbnRlZ2VyIHZlY3RvciAoZnJvbSBmbGF0IGFycmF5IG9yIFRIUkVFLlZlY3Rvck4pCgpmdW5jdGlvbiBzZXRWYWx1ZVYydWkoIGdsLCB2ICkgewoKCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCglpZiAoIHYueCAhPT0gdW5kZWZpbmVkICkgewoKCQlpZiAoIGNhY2hlWyAwIF0gIT09IHYueCB8fCBjYWNoZVsgMSBdICE9PSB2LnkgKSB7CgoJCQlnbC51bmlmb3JtMnVpKCB0aGlzLmFkZHIsIHYueCwgdi55ICk7CgoJCQljYWNoZVsgMCBdID0gdi54OwoJCQljYWNoZVsgMSBdID0gdi55OwoKCQl9CgoJfSBlbHNlIHsKCgkJaWYgKCBhcnJheXNFcXVhbCggY2FjaGUsIHYgKSApIHJldHVybjsKCgkJZ2wudW5pZm9ybTJ1aXYoIHRoaXMuYWRkciwgdiApOwoKCQljb3B5QXJyYXkoIGNhY2hlLCB2ICk7CgoJfQoKfQoKZnVuY3Rpb24gc2V0VmFsdWVWM3VpKCBnbCwgdiApIHsKCgljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgoJaWYgKCB2LnggIT09IHVuZGVmaW5lZCApIHsKCgkJaWYgKCBjYWNoZVsgMCBdICE9PSB2LnggfHwgY2FjaGVbIDEgXSAhPT0gdi55IHx8IGNhY2hlWyAyIF0gIT09IHYueiApIHsKCgkJCWdsLnVuaWZvcm0zdWkoIHRoaXMuYWRkciwgdi54LCB2LnksIHYueiApOwoKCQkJY2FjaGVbIDAgXSA9IHYueDsKCQkJY2FjaGVbIDEgXSA9IHYueTsKCQkJY2FjaGVbIDIgXSA9IHYuejsKCgkJfQoKCX0gZWxzZSB7CgoJCWlmICggYXJyYXlzRXF1YWwoIGNhY2hlLCB2ICkgKSByZXR1cm47CgoJCWdsLnVuaWZvcm0zdWl2KCB0aGlzLmFkZHIsIHYgKTsKCgkJY29weUFycmF5KCBjYWNoZSwgdiApOwoKCX0KCn0KCmZ1bmN0aW9uIHNldFZhbHVlVjR1aSggZ2wsIHYgKSB7CgoJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoKCWlmICggdi54ICE9PSB1bmRlZmluZWQgKSB7CgoJCWlmICggY2FjaGVbIDAgXSAhPT0gdi54IHx8IGNhY2hlWyAxIF0gIT09IHYueSB8fCBjYWNoZVsgMiBdICE9PSB2LnogfHwgY2FjaGVbIDMgXSAhPT0gdi53ICkgewoKCQkJZ2wudW5pZm9ybTR1aSggdGhpcy5hZGRyLCB2LngsIHYueSwgdi56LCB2LncgKTsKCgkJCWNhY2hlWyAwIF0gPSB2Lng7CgkJCWNhY2hlWyAxIF0gPSB2Lnk7CgkJCWNhY2hlWyAyIF0gPSB2Lno7CgkJCWNhY2hlWyAzIF0gPSB2Lnc7CgoJCX0KCgl9IGVsc2UgewoKCQlpZiAoIGFycmF5c0VxdWFsKCBjYWNoZSwgdiApICkgcmV0dXJuOwoKCQlnbC51bmlmb3JtNHVpdiggdGhpcy5hZGRyLCB2ICk7CgoJCWNvcHlBcnJheSggY2FjaGUsIHYgKTsKCgl9Cgp9CgoKLy8gU2luZ2xlIHRleHR1cmUgKDJEIC8gQ3ViZSkKCmZ1bmN0aW9uIHNldFZhbHVlVDEoIGdsLCB2LCB0ZXh0dXJlcyApIHsKCgljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7Cgljb25zdCB1bml0ID0gdGV4dHVyZXMuYWxsb2NhdGVUZXh0dXJlVW5pdCgpOwoKCWlmICggY2FjaGVbIDAgXSAhPT0gdW5pdCApIHsKCgkJZ2wudW5pZm9ybTFpKCB0aGlzLmFkZHIsIHVuaXQgKTsKCQljYWNoZVsgMCBdID0gdW5pdDsKCgl9CgoJdGV4dHVyZXMuc2V0VGV4dHVyZTJEKCB2IHx8IGVtcHR5VGV4dHVyZSwgdW5pdCApOwoKfQoKZnVuY3Rpb24gc2V0VmFsdWVUM0QxKCBnbCwgdiwgdGV4dHVyZXMgKSB7CgoJY29uc3QgY2FjaGUgPSB0aGlzLmNhY2hlOwoJY29uc3QgdW5pdCA9IHRleHR1cmVzLmFsbG9jYXRlVGV4dHVyZVVuaXQoKTsKCglpZiAoIGNhY2hlWyAwIF0gIT09IHVuaXQgKSB7CgoJCWdsLnVuaWZvcm0xaSggdGhpcy5hZGRyLCB1bml0ICk7CgkJY2FjaGVbIDAgXSA9IHVuaXQ7CgoJfQoKCXRleHR1cmVzLnNldFRleHR1cmUzRCggdiB8fCBlbXB0eTNkVGV4dHVyZSwgdW5pdCApOwoKfQoKZnVuY3Rpb24gc2V0VmFsdWVUNiggZ2wsIHYsIHRleHR1cmVzICkgewoKCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCWNvbnN0IHVuaXQgPSB0ZXh0dXJlcy5hbGxvY2F0ZVRleHR1cmVVbml0KCk7CgoJaWYgKCBjYWNoZVsgMCBdICE9PSB1bml0ICkgewoKCQlnbC51bmlmb3JtMWkoIHRoaXMuYWRkciwgdW5pdCApOwoJCWNhY2hlWyAwIF0gPSB1bml0OwoKCX0KCgl0ZXh0dXJlcy5zZXRUZXh0dXJlQ3ViZSggdiB8fCBlbXB0eUN1YmVUZXh0dXJlLCB1bml0ICk7Cgp9CgpmdW5jdGlvbiBzZXRWYWx1ZVQyREFycmF5MSggZ2wsIHYsIHRleHR1cmVzICkgewoKCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCWNvbnN0IHVuaXQgPSB0ZXh0dXJlcy5hbGxvY2F0ZVRleHR1cmVVbml0KCk7CgoJaWYgKCBjYWNoZVsgMCBdICE9PSB1bml0ICkgewoKCQlnbC51bmlmb3JtMWkoIHRoaXMuYWRkciwgdW5pdCApOwoJCWNhY2hlWyAwIF0gPSB1bml0OwoKCX0KCgl0ZXh0dXJlcy5zZXRUZXh0dXJlMkRBcnJheSggdiB8fCBlbXB0eUFycmF5VGV4dHVyZSwgdW5pdCApOwoKfQoKLy8gSGVscGVyIHRvIHBpY2sgdGhlIHJpZ2h0IHNldHRlciBmb3IgdGhlIHNpbmd1bGFyIGNhc2UKCmZ1bmN0aW9uIGdldFNpbmd1bGFyU2V0dGVyKCB0eXBlICkgewoKCXN3aXRjaCAoIHR5cGUgKSB7CgoJCWNhc2UgMHgxNDA2OiByZXR1cm4gc2V0VmFsdWVWMWY7IC8vIEZMT0FUCgkJY2FzZSAweDhiNTA6IHJldHVybiBzZXRWYWx1ZVYyZjsgLy8gX1ZFQzIKCQljYXNlIDB4OGI1MTogcmV0dXJuIHNldFZhbHVlVjNmOyAvLyBfVkVDMwoJCWNhc2UgMHg4YjUyOiByZXR1cm4gc2V0VmFsdWVWNGY7IC8vIF9WRUM0CgoJCWNhc2UgMHg4YjVhOiByZXR1cm4gc2V0VmFsdWVNMjsgLy8gX01BVDIKCQljYXNlIDB4OGI1YjogcmV0dXJuIHNldFZhbHVlTTM7IC8vIF9NQVQzCgkJY2FzZSAweDhiNWM6IHJldHVybiBzZXRWYWx1ZU00OyAvLyBfTUFUNAoKCQljYXNlIDB4MTQwNDogY2FzZSAweDhiNTY6IHJldHVybiBzZXRWYWx1ZVYxaTsgLy8gSU5ULCBCT09MCgkJY2FzZSAweDhiNTM6IGNhc2UgMHg4YjU3OiByZXR1cm4gc2V0VmFsdWVWMmk7IC8vIF9WRUMyCgkJY2FzZSAweDhiNTQ6IGNhc2UgMHg4YjU4OiByZXR1cm4gc2V0VmFsdWVWM2k7IC8vIF9WRUMzCgkJY2FzZSAweDhiNTU6IGNhc2UgMHg4YjU5OiByZXR1cm4gc2V0VmFsdWVWNGk7IC8vIF9WRUM0CgoJCWNhc2UgMHgxNDA1OiByZXR1cm4gc2V0VmFsdWVWMXVpOyAvLyBVSU5UCgkJY2FzZSAweDhkYzY6IHJldHVybiBzZXRWYWx1ZVYydWk7IC8vIF9WRUMyCgkJY2FzZSAweDhkYzc6IHJldHVybiBzZXRWYWx1ZVYzdWk7IC8vIF9WRUMzCgkJY2FzZSAweDhkYzg6IHJldHVybiBzZXRWYWx1ZVY0dWk7IC8vIF9WRUM0CgoJCWNhc2UgMHg4YjVlOiAvLyBTQU1QTEVSXzJECgkJY2FzZSAweDhkNjY6IC8vIFNBTVBMRVJfRVhURVJOQUxfT0VTCgkJY2FzZSAweDhkY2E6IC8vIElOVF9TQU1QTEVSXzJECgkJY2FzZSAweDhkZDI6IC8vIFVOU0lHTkVEX0lOVF9TQU1QTEVSXzJECgkJY2FzZSAweDhiNjI6IC8vIFNBTVBMRVJfMkRfU0hBRE9XCgkJCXJldHVybiBzZXRWYWx1ZVQxOwoKCQljYXNlIDB4OGI1ZjogLy8gU0FNUExFUl8zRAoJCWNhc2UgMHg4ZGNiOiAvLyBJTlRfU0FNUExFUl8zRAoJCWNhc2UgMHg4ZGQzOiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8zRAoJCQlyZXR1cm4gc2V0VmFsdWVUM0QxOwoKCQljYXNlIDB4OGI2MDogLy8gU0FNUExFUl9DVUJFCgkJY2FzZSAweDhkY2M6IC8vIElOVF9TQU1QTEVSX0NVQkUKCQljYXNlIDB4OGRkNDogLy8gVU5TSUdORURfSU5UX1NBTVBMRVJfQ1VCRQoJCWNhc2UgMHg4ZGM1OiAvLyBTQU1QTEVSX0NVQkVfU0hBRE9XCgkJCXJldHVybiBzZXRWYWx1ZVQ2OwoKCQljYXNlIDB4OGRjMTogLy8gU0FNUExFUl8yRF9BUlJBWQoJCWNhc2UgMHg4ZGNmOiAvLyBJTlRfU0FNUExFUl8yRF9BUlJBWQoJCWNhc2UgMHg4ZGQ3OiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8yRF9BUlJBWQoJCWNhc2UgMHg4ZGM0OiAvLyBTQU1QTEVSXzJEX0FSUkFZX1NIQURPVwoJCQlyZXR1cm4gc2V0VmFsdWVUMkRBcnJheTE7CgoJfQoKfQoKCi8vIEFycmF5IG9mIHNjYWxhcnMKCmZ1bmN0aW9uIHNldFZhbHVlVjFmQXJyYXkoIGdsLCB2ICkgewoKCWdsLnVuaWZvcm0xZnYoIHRoaXMuYWRkciwgdiApOwoKfQoKLy8gQXJyYXkgb2YgdmVjdG9ycyAoZnJvbSBmbGF0IGFycmF5IG9yIGFycmF5IG9mIFRIUkVFLlZlY3Rvck4pCgpmdW5jdGlvbiBzZXRWYWx1ZVYyZkFycmF5KCBnbCwgdiApIHsKCgljb25zdCBkYXRhID0gZmxhdHRlbiggdiwgdGhpcy5zaXplLCAyICk7CgoJZ2wudW5pZm9ybTJmdiggdGhpcy5hZGRyLCBkYXRhICk7Cgp9CgpmdW5jdGlvbiBzZXRWYWx1ZVYzZkFycmF5KCBnbCwgdiApIHsKCgljb25zdCBkYXRhID0gZmxhdHRlbiggdiwgdGhpcy5zaXplLCAzICk7CgoJZ2wudW5pZm9ybTNmdiggdGhpcy5hZGRyLCBkYXRhICk7Cgp9CgpmdW5jdGlvbiBzZXRWYWx1ZVY0ZkFycmF5KCBnbCwgdiApIHsKCgljb25zdCBkYXRhID0gZmxhdHRlbiggdiwgdGhpcy5zaXplLCA0ICk7CgoJZ2wudW5pZm9ybTRmdiggdGhpcy5hZGRyLCBkYXRhICk7Cgp9CgovLyBBcnJheSBvZiBtYXRyaWNlcyAoZnJvbSBmbGF0IGFycmF5IG9yIGFycmF5IG9mIFRIUkVFLk1hdHJpeE4pCgpmdW5jdGlvbiBzZXRWYWx1ZU0yQXJyYXkoIGdsLCB2ICkgewoKCWNvbnN0IGRhdGEgPSBmbGF0dGVuKCB2LCB0aGlzLnNpemUsIDQgKTsKCglnbC51bmlmb3JtTWF0cml4MmZ2KCB0aGlzLmFkZHIsIGZhbHNlLCBkYXRhICk7Cgp9CgpmdW5jdGlvbiBzZXRWYWx1ZU0zQXJyYXkoIGdsLCB2ICkgewoKCWNvbnN0IGRhdGEgPSBmbGF0dGVuKCB2LCB0aGlzLnNpemUsIDkgKTsKCglnbC51bmlmb3JtTWF0cml4M2Z2KCB0aGlzLmFkZHIsIGZhbHNlLCBkYXRhICk7Cgp9CgpmdW5jdGlvbiBzZXRWYWx1ZU00QXJyYXkoIGdsLCB2ICkgewoKCWNvbnN0IGRhdGEgPSBmbGF0dGVuKCB2LCB0aGlzLnNpemUsIDE2ICk7CgoJZ2wudW5pZm9ybU1hdHJpeDRmdiggdGhpcy5hZGRyLCBmYWxzZSwgZGF0YSApOwoKfQoKLy8gQXJyYXkgb2YgaW50ZWdlciAvIGJvb2xlYW4KCmZ1bmN0aW9uIHNldFZhbHVlVjFpQXJyYXkoIGdsLCB2ICkgewoKCWdsLnVuaWZvcm0xaXYoIHRoaXMuYWRkciwgdiApOwoKfQoKLy8gQXJyYXkgb2YgaW50ZWdlciAvIGJvb2xlYW4gdmVjdG9ycyAoZnJvbSBmbGF0IGFycmF5KQoKZnVuY3Rpb24gc2V0VmFsdWVWMmlBcnJheSggZ2wsIHYgKSB7CgoJZ2wudW5pZm9ybTJpdiggdGhpcy5hZGRyLCB2ICk7Cgp9CgpmdW5jdGlvbiBzZXRWYWx1ZVYzaUFycmF5KCBnbCwgdiApIHsKCglnbC51bmlmb3JtM2l2KCB0aGlzLmFkZHIsIHYgKTsKCn0KCmZ1bmN0aW9uIHNldFZhbHVlVjRpQXJyYXkoIGdsLCB2ICkgewoKCWdsLnVuaWZvcm00aXYoIHRoaXMuYWRkciwgdiApOwoKfQoKLy8gQXJyYXkgb2YgdW5zaWduZWQgaW50ZWdlcgoKZnVuY3Rpb24gc2V0VmFsdWVWMXVpQXJyYXkoIGdsLCB2ICkgewoKCWdsLnVuaWZvcm0xdWl2KCB0aGlzLmFkZHIsIHYgKTsKCn0KCi8vIEFycmF5IG9mIHVuc2lnbmVkIGludGVnZXIgdmVjdG9ycyAoZnJvbSBmbGF0IGFycmF5KQoKZnVuY3Rpb24gc2V0VmFsdWVWMnVpQXJyYXkoIGdsLCB2ICkgewoKCWdsLnVuaWZvcm0ydWl2KCB0aGlzLmFkZHIsIHYgKTsKCn0KCmZ1bmN0aW9uIHNldFZhbHVlVjN1aUFycmF5KCBnbCwgdiApIHsKCglnbC51bmlmb3JtM3VpdiggdGhpcy5hZGRyLCB2ICk7Cgp9CgpmdW5jdGlvbiBzZXRWYWx1ZVY0dWlBcnJheSggZ2wsIHYgKSB7CgoJZ2wudW5pZm9ybTR1aXYoIHRoaXMuYWRkciwgdiApOwoKfQoKCi8vIEFycmF5IG9mIHRleHR1cmVzICgyRCAvIDNEIC8gQ3ViZSAvIDJEQXJyYXkpCgpmdW5jdGlvbiBzZXRWYWx1ZVQxQXJyYXkoIGdsLCB2LCB0ZXh0dXJlcyApIHsKCgljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgoJY29uc3QgbiA9IHYubGVuZ3RoOwoKCWNvbnN0IHVuaXRzID0gYWxsb2NUZXhVbml0cyggdGV4dHVyZXMsIG4gKTsKCglpZiAoICEgYXJyYXlzRXF1YWwoIGNhY2hlLCB1bml0cyApICkgewoKCQlnbC51bmlmb3JtMWl2KCB0aGlzLmFkZHIsIHVuaXRzICk7CgoJCWNvcHlBcnJheSggY2FjaGUsIHVuaXRzICk7CgoJfQoKCWZvciAoIGxldCBpID0gMDsgaSAhPT0gbjsgKysgaSApIHsKCgkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEKCB2WyBpIF0gfHwgZW1wdHlUZXh0dXJlLCB1bml0c1sgaSBdICk7CgoJfQoKfQoKZnVuY3Rpb24gc2V0VmFsdWVUM0RBcnJheSggZ2wsIHYsIHRleHR1cmVzICkgewoKCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgljb25zdCBuID0gdi5sZW5ndGg7CgoJY29uc3QgdW5pdHMgPSBhbGxvY1RleFVuaXRzKCB0ZXh0dXJlcywgbiApOwoKCWlmICggISBhcnJheXNFcXVhbCggY2FjaGUsIHVuaXRzICkgKSB7CgoJCWdsLnVuaWZvcm0xaXYoIHRoaXMuYWRkciwgdW5pdHMgKTsKCgkJY29weUFycmF5KCBjYWNoZSwgdW5pdHMgKTsKCgl9CgoJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKCQl0ZXh0dXJlcy5zZXRUZXh0dXJlM0QoIHZbIGkgXSB8fCBlbXB0eTNkVGV4dHVyZSwgdW5pdHNbIGkgXSApOwoKCX0KCn0KCmZ1bmN0aW9uIHNldFZhbHVlVDZBcnJheSggZ2wsIHYsIHRleHR1cmVzICkgewoKCWNvbnN0IGNhY2hlID0gdGhpcy5jYWNoZTsKCgljb25zdCBuID0gdi5sZW5ndGg7CgoJY29uc3QgdW5pdHMgPSBhbGxvY1RleFVuaXRzKCB0ZXh0dXJlcywgbiApOwoKCWlmICggISBhcnJheXNFcXVhbCggY2FjaGUsIHVuaXRzICkgKSB7CgoJCWdsLnVuaWZvcm0xaXYoIHRoaXMuYWRkciwgdW5pdHMgKTsKCgkJY29weUFycmF5KCBjYWNoZSwgdW5pdHMgKTsKCgl9CgoJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuOyArKyBpICkgewoKCQl0ZXh0dXJlcy5zZXRUZXh0dXJlQ3ViZSggdlsgaSBdIHx8IGVtcHR5Q3ViZVRleHR1cmUsIHVuaXRzWyBpIF0gKTsKCgl9Cgp9CgpmdW5jdGlvbiBzZXRWYWx1ZVQyREFycmF5QXJyYXkoIGdsLCB2LCB0ZXh0dXJlcyApIHsKCgljb25zdCBjYWNoZSA9IHRoaXMuY2FjaGU7CgoJY29uc3QgbiA9IHYubGVuZ3RoOwoKCWNvbnN0IHVuaXRzID0gYWxsb2NUZXhVbml0cyggdGV4dHVyZXMsIG4gKTsKCglpZiAoICEgYXJyYXlzRXF1YWwoIGNhY2hlLCB1bml0cyApICkgewoKCQlnbC51bmlmb3JtMWl2KCB0aGlzLmFkZHIsIHVuaXRzICk7CgoJCWNvcHlBcnJheSggY2FjaGUsIHVuaXRzICk7CgoJfQoKCWZvciAoIGxldCBpID0gMDsgaSAhPT0gbjsgKysgaSApIHsKCgkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEQXJyYXkoIHZbIGkgXSB8fCBlbXB0eUFycmF5VGV4dHVyZSwgdW5pdHNbIGkgXSApOwoKCX0KCn0KCgovLyBIZWxwZXIgdG8gcGljayB0aGUgcmlnaHQgc2V0dGVyIGZvciBhIHB1cmUgKGJvdHRvbS1sZXZlbCkgYXJyYXkKCmZ1bmN0aW9uIGdldFB1cmVBcnJheVNldHRlciggdHlwZSApIHsKCglzd2l0Y2ggKCB0eXBlICkgewoKCQljYXNlIDB4MTQwNjogcmV0dXJuIHNldFZhbHVlVjFmQXJyYXk7IC8vIEZMT0FUCgkJY2FzZSAweDhiNTA6IHJldHVybiBzZXRWYWx1ZVYyZkFycmF5OyAvLyBfVkVDMgoJCWNhc2UgMHg4YjUxOiByZXR1cm4gc2V0VmFsdWVWM2ZBcnJheTsgLy8gX1ZFQzMKCQljYXNlIDB4OGI1MjogcmV0dXJuIHNldFZhbHVlVjRmQXJyYXk7IC8vIF9WRUM0CgoJCWNhc2UgMHg4YjVhOiByZXR1cm4gc2V0VmFsdWVNMkFycmF5OyAvLyBfTUFUMgoJCWNhc2UgMHg4YjViOiByZXR1cm4gc2V0VmFsdWVNM0FycmF5OyAvLyBfTUFUMwoJCWNhc2UgMHg4YjVjOiByZXR1cm4gc2V0VmFsdWVNNEFycmF5OyAvLyBfTUFUNAoKCQljYXNlIDB4MTQwNDogY2FzZSAweDhiNTY6IHJldHVybiBzZXRWYWx1ZVYxaUFycmF5OyAvLyBJTlQsIEJPT0wKCQljYXNlIDB4OGI1MzogY2FzZSAweDhiNTc6IHJldHVybiBzZXRWYWx1ZVYyaUFycmF5OyAvLyBfVkVDMgoJCWNhc2UgMHg4YjU0OiBjYXNlIDB4OGI1ODogcmV0dXJuIHNldFZhbHVlVjNpQXJyYXk7IC8vIF9WRUMzCgkJY2FzZSAweDhiNTU6IGNhc2UgMHg4YjU5OiByZXR1cm4gc2V0VmFsdWVWNGlBcnJheTsgLy8gX1ZFQzQKCgkJY2FzZSAweDE0MDU6IHJldHVybiBzZXRWYWx1ZVYxdWlBcnJheTsgLy8gVUlOVAoJCWNhc2UgMHg4ZGM2OiByZXR1cm4gc2V0VmFsdWVWMnVpQXJyYXk7IC8vIF9WRUMyCgkJY2FzZSAweDhkYzc6IHJldHVybiBzZXRWYWx1ZVYzdWlBcnJheTsgLy8gX1ZFQzMKCQljYXNlIDB4OGRjODogcmV0dXJuIHNldFZhbHVlVjR1aUFycmF5OyAvLyBfVkVDNAoKCQljYXNlIDB4OGI1ZTogLy8gU0FNUExFUl8yRAoJCWNhc2UgMHg4ZDY2OiAvLyBTQU1QTEVSX0VYVEVSTkFMX09FUwoJCWNhc2UgMHg4ZGNhOiAvLyBJTlRfU0FNUExFUl8yRAoJCWNhc2UgMHg4ZGQyOiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8yRAoJCWNhc2UgMHg4YjYyOiAvLyBTQU1QTEVSXzJEX1NIQURPVwoJCQlyZXR1cm4gc2V0VmFsdWVUMUFycmF5OwoKCQljYXNlIDB4OGI1ZjogLy8gU0FNUExFUl8zRAoJCWNhc2UgMHg4ZGNiOiAvLyBJTlRfU0FNUExFUl8zRAoJCWNhc2UgMHg4ZGQzOiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8zRAoJCQlyZXR1cm4gc2V0VmFsdWVUM0RBcnJheTsKCgkJY2FzZSAweDhiNjA6IC8vIFNBTVBMRVJfQ1VCRQoJCWNhc2UgMHg4ZGNjOiAvLyBJTlRfU0FNUExFUl9DVUJFCgkJY2FzZSAweDhkZDQ6IC8vIFVOU0lHTkVEX0lOVF9TQU1QTEVSX0NVQkUKCQljYXNlIDB4OGRjNTogLy8gU0FNUExFUl9DVUJFX1NIQURPVwoJCQlyZXR1cm4gc2V0VmFsdWVUNkFycmF5OwoKCQljYXNlIDB4OGRjMTogLy8gU0FNUExFUl8yRF9BUlJBWQoJCWNhc2UgMHg4ZGNmOiAvLyBJTlRfU0FNUExFUl8yRF9BUlJBWQoJCWNhc2UgMHg4ZGQ3OiAvLyBVTlNJR05FRF9JTlRfU0FNUExFUl8yRF9BUlJBWQoJCWNhc2UgMHg4ZGM0OiAvLyBTQU1QTEVSXzJEX0FSUkFZX1NIQURPVwoJCQlyZXR1cm4gc2V0VmFsdWVUMkRBcnJheUFycmF5OwoKCX0KCn0KCi8vIC0tLSBVbmlmb3JtIENsYXNzZXMgLS0tCgpjbGFzcyBTaW5nbGVVbmlmb3JtIHsKCgljb25zdHJ1Y3RvciggaWQsIGFjdGl2ZUluZm8sIGFkZHIgKSB7CgoJCXRoaXMuaWQgPSBpZDsKCQl0aGlzLmFkZHIgPSBhZGRyOwoJCXRoaXMuY2FjaGUgPSBbXTsKCQl0aGlzLnNldFZhbHVlID0gZ2V0U2luZ3VsYXJTZXR0ZXIoIGFjdGl2ZUluZm8udHlwZSApOwoKCQkvLyB0aGlzLnBhdGggPSBhY3RpdmVJbmZvLm5hbWU7IC8vIERFQlVHCgoJfQoKfQoKY2xhc3MgUHVyZUFycmF5VW5pZm9ybSB7CgoJY29uc3RydWN0b3IoIGlkLCBhY3RpdmVJbmZvLCBhZGRyICkgewoKCQl0aGlzLmlkID0gaWQ7CgkJdGhpcy5hZGRyID0gYWRkcjsKCQl0aGlzLmNhY2hlID0gW107CgkJdGhpcy5zaXplID0gYWN0aXZlSW5mby5zaXplOwoJCXRoaXMuc2V0VmFsdWUgPSBnZXRQdXJlQXJyYXlTZXR0ZXIoIGFjdGl2ZUluZm8udHlwZSApOwoKCQkvLyB0aGlzLnBhdGggPSBhY3RpdmVJbmZvLm5hbWU7IC8vIERFQlVHCgoJfQoKfQoKY2xhc3MgU3RydWN0dXJlZFVuaWZvcm0gewoKCWNvbnN0cnVjdG9yKCBpZCApIHsKCgkJdGhpcy5pZCA9IGlkOwoKCQl0aGlzLnNlcSA9IFtdOwoJCXRoaXMubWFwID0ge307CgoJfQoKCXNldFZhbHVlKCBnbCwgdmFsdWUsIHRleHR1cmVzICkgewoKCQljb25zdCBzZXEgPSB0aGlzLnNlcTsKCgkJZm9yICggbGV0IGkgPSAwLCBuID0gc2VxLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCWNvbnN0IHUgPSBzZXFbIGkgXTsKCQkJdS5zZXRWYWx1ZSggZ2wsIHZhbHVlWyB1LmlkIF0sIHRleHR1cmVzICk7CgoJCX0KCgl9Cgp9CgovLyAtLS0gVG9wLWxldmVsIC0tLQoKLy8gUGFyc2VyIC0gYnVpbGRzIHVwIHRoZSBwcm9wZXJ0eSB0cmVlIGZyb20gdGhlIHBhdGggc3RyaW5ncwoKY29uc3QgUmVQYXRoUGFydCA9IC8oXHcrKShcXSk/KFxbfFwuKT8vZzsKCi8vIGV4dHJhY3RzCi8vIAktIHRoZSBpZGVudGlmaWVyIChtZW1iZXIgbmFtZSBvciBhcnJheSBpbmRleCkKLy8gIC0gZm9sbG93ZWQgYnkgYW4gb3B0aW9uYWwgcmlnaHQgYnJhY2tldCAoZm91bmQgd2hlbiBhcnJheSBpbmRleCkKLy8gIC0gZm9sbG93ZWQgYnkgYW4gb3B0aW9uYWwgbGVmdCBicmFja2V0IG9yIGRvdCAodHlwZSBvZiBzdWJzY3JpcHQpCi8vCi8vIE5vdGU6IFRoZXNlIHBvcnRpb25zIGNhbiBiZSByZWFkIGluIGEgbm9uLW92ZXJsYXBwaW5nIGZhc2hpb24gYW5kCi8vIGFsbG93IHN0cmFpZ2h0Zm9yd2FyZCBwYXJzaW5nIG9mIHRoZSBoaWVyYXJjaHkgdGhhdCBXZWJHTCBlbmNvZGVzCi8vIGluIHRoZSB1bmlmb3JtIG5hbWVzLgoKZnVuY3Rpb24gYWRkVW5pZm9ybSggY29udGFpbmVyLCB1bmlmb3JtT2JqZWN0ICkgewoKCWNvbnRhaW5lci5zZXEucHVzaCggdW5pZm9ybU9iamVjdCApOwoJY29udGFpbmVyLm1hcFsgdW5pZm9ybU9iamVjdC5pZCBdID0gdW5pZm9ybU9iamVjdDsKCn0KCmZ1bmN0aW9uIHBhcnNlVW5pZm9ybSggYWN0aXZlSW5mbywgYWRkciwgY29udGFpbmVyICkgewoKCWNvbnN0IHBhdGggPSBhY3RpdmVJbmZvLm5hbWUsCgkJcGF0aExlbmd0aCA9IHBhdGgubGVuZ3RoOwoKCS8vIHJlc2V0IFJlZ0V4cCBvYmplY3QsIGJlY2F1c2Ugb2YgdGhlIGVhcmx5IGV4aXQgb2YgYSBwcmV2aW91cyBydW4KCVJlUGF0aFBhcnQubGFzdEluZGV4ID0gMDsKCgl3aGlsZSAoIHRydWUgKSB7CgoJCWNvbnN0IG1hdGNoID0gUmVQYXRoUGFydC5leGVjKCBwYXRoICksCgkJCW1hdGNoRW5kID0gUmVQYXRoUGFydC5sYXN0SW5kZXg7CgoJCWxldCBpZCA9IG1hdGNoWyAxIF07CgkJY29uc3QgaWRJc0luZGV4ID0gbWF0Y2hbIDIgXSA9PT0gJ10nLAoJCQlzdWJzY3JpcHQgPSBtYXRjaFsgMyBdOwoKCQlpZiAoIGlkSXNJbmRleCApIGlkID0gaWQgfCAwOyAvLyBjb252ZXJ0IHRvIGludGVnZXIKCgkJaWYgKCBzdWJzY3JpcHQgPT09IHVuZGVmaW5lZCB8fCBzdWJzY3JpcHQgPT09ICdbJyAmJiBtYXRjaEVuZCArIDIgPT09IHBhdGhMZW5ndGggKSB7CgoJCQkvLyBiYXJlIG5hbWUgb3IgInB1cmUiIGJvdHRvbS1sZXZlbCBhcnJheSAiWzBdIiBzdWZmaXgKCgkJCWFkZFVuaWZvcm0oIGNvbnRhaW5lciwgc3Vic2NyaXB0ID09PSB1bmRlZmluZWQgPwoJCQkJbmV3IFNpbmdsZVVuaWZvcm0oIGlkLCBhY3RpdmVJbmZvLCBhZGRyICkgOgoJCQkJbmV3IFB1cmVBcnJheVVuaWZvcm0oIGlkLCBhY3RpdmVJbmZvLCBhZGRyICkgKTsKCgkJCWJyZWFrOwoKCQl9IGVsc2UgewoKCQkJLy8gc3RlcCBpbnRvIGlubmVyIG5vZGUgLyBjcmVhdGUgaXQgaW4gY2FzZSBpdCBkb2Vzbid0IGV4aXN0CgoJCQljb25zdCBtYXAgPSBjb250YWluZXIubWFwOwoJCQlsZXQgbmV4dCA9IG1hcFsgaWQgXTsKCgkJCWlmICggbmV4dCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCW5leHQgPSBuZXcgU3RydWN0dXJlZFVuaWZvcm0oIGlkICk7CgkJCQlhZGRVbmlmb3JtKCBjb250YWluZXIsIG5leHQgKTsKCgkJCX0KCgkJCWNvbnRhaW5lciA9IG5leHQ7CgoJCX0KCgl9Cgp9CgovLyBSb290IENvbnRhaW5lcgoKY2xhc3MgV2ViR0xVbmlmb3JtcyB7CgoJY29uc3RydWN0b3IoIGdsLCBwcm9ncmFtICkgewoKCQl0aGlzLnNlcSA9IFtdOwoJCXRoaXMubWFwID0ge307CgoJCWNvbnN0IG4gPSBnbC5nZXRQcm9ncmFtUGFyYW1ldGVyKCBwcm9ncmFtLCBnbC5BQ1RJVkVfVU5JRk9STVMgKTsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgbjsgKysgaSApIHsKCgkJCWNvbnN0IGluZm8gPSBnbC5nZXRBY3RpdmVVbmlmb3JtKCBwcm9ncmFtLCBpICksCgkJCQlhZGRyID0gZ2wuZ2V0VW5pZm9ybUxvY2F0aW9uKCBwcm9ncmFtLCBpbmZvLm5hbWUgKTsKCgkJCXBhcnNlVW5pZm9ybSggaW5mbywgYWRkciwgdGhpcyApOwoKCQl9CgoJfQoKCXNldFZhbHVlKCBnbCwgbmFtZSwgdmFsdWUsIHRleHR1cmVzICkgewoKCQljb25zdCB1ID0gdGhpcy5tYXBbIG5hbWUgXTsKCgkJaWYgKCB1ICE9PSB1bmRlZmluZWQgKSB1LnNldFZhbHVlKCBnbCwgdmFsdWUsIHRleHR1cmVzICk7CgoJfQoKCXNldE9wdGlvbmFsKCBnbCwgb2JqZWN0LCBuYW1lICkgewoKCQljb25zdCB2ID0gb2JqZWN0WyBuYW1lIF07CgoJCWlmICggdiAhPT0gdW5kZWZpbmVkICkgdGhpcy5zZXRWYWx1ZSggZ2wsIG5hbWUsIHYgKTsKCgl9CgoJc3RhdGljIHVwbG9hZCggZ2wsIHNlcSwgdmFsdWVzLCB0ZXh0dXJlcyApIHsKCgkJZm9yICggbGV0IGkgPSAwLCBuID0gc2VxLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCWNvbnN0IHUgPSBzZXFbIGkgXSwKCQkJCXYgPSB2YWx1ZXNbIHUuaWQgXTsKCgkJCWlmICggdi5uZWVkc1VwZGF0ZSAhPT0gZmFsc2UgKSB7CgoJCQkJLy8gbm90ZTogYWx3YXlzIHVwZGF0aW5nIHdoZW4gLm5lZWRzVXBkYXRlIGlzIHVuZGVmaW5lZAoJCQkJdS5zZXRWYWx1ZSggZ2wsIHYudmFsdWUsIHRleHR1cmVzICk7CgoJCQl9CgoJCX0KCgl9CgoJc3RhdGljIHNlcVdpdGhWYWx1ZSggc2VxLCB2YWx1ZXMgKSB7CgoJCWNvbnN0IHIgPSBbXTsKCgkJZm9yICggbGV0IGkgPSAwLCBuID0gc2VxLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCWNvbnN0IHUgPSBzZXFbIGkgXTsKCQkJaWYgKCB1LmlkIGluIHZhbHVlcyApIHIucHVzaCggdSApOwoKCQl9CgoJCXJldHVybiByOwoKCX0KCn0KCmZ1bmN0aW9uIFdlYkdMU2hhZGVyKCBnbCwgdHlwZSwgc3RyaW5nICkgewoKCWNvbnN0IHNoYWRlciA9IGdsLmNyZWF0ZVNoYWRlciggdHlwZSApOwoKCWdsLnNoYWRlclNvdXJjZSggc2hhZGVyLCBzdHJpbmcgKTsKCWdsLmNvbXBpbGVTaGFkZXIoIHNoYWRlciApOwoKCXJldHVybiBzaGFkZXI7Cgp9CgpsZXQgcHJvZ3JhbUlkQ291bnQgPSAwOwoKZnVuY3Rpb24gaGFuZGxlU291cmNlKCBzdHJpbmcsIGVycm9yTGluZSApIHsKCgljb25zdCBsaW5lcyA9IHN0cmluZy5zcGxpdCggJ1xuJyApOwoJY29uc3QgbGluZXMyID0gW107CgoJY29uc3QgZnJvbSA9IE1hdGgubWF4KCBlcnJvckxpbmUgLSA2LCAwICk7Cgljb25zdCB0byA9IE1hdGgubWluKCBlcnJvckxpbmUgKyA2LCBsaW5lcy5sZW5ndGggKTsKCglmb3IgKCBsZXQgaSA9IGZyb207IGkgPCB0bzsgaSArKyApIHsKCgkJY29uc3QgbGluZSA9IGkgKyAxOwoJCWxpbmVzMi5wdXNoKCBgJHtsaW5lID09PSBlcnJvckxpbmUgPyAnPicgOiAnICd9ICR7bGluZX06ICR7bGluZXNbIGkgXX1gICk7CgoJfQoKCXJldHVybiBsaW5lczIuam9pbiggJ1xuJyApOwoKfQoKZnVuY3Rpb24gZ2V0RW5jb2RpbmdDb21wb25lbnRzKCBjb2xvclNwYWNlICkgewoKCWNvbnN0IHdvcmtpbmdQcmltYXJpZXMgPSBDb2xvck1hbmFnZW1lbnQuZ2V0UHJpbWFyaWVzKCBDb2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2UgKTsKCWNvbnN0IGVuY29kaW5nUHJpbWFyaWVzID0gQ29sb3JNYW5hZ2VtZW50LmdldFByaW1hcmllcyggY29sb3JTcGFjZSApOwoKCWxldCBnYW11dE1hcHBpbmc7CgoJaWYgKCB3b3JraW5nUHJpbWFyaWVzID09PSBlbmNvZGluZ1ByaW1hcmllcyApIHsKCgkJZ2FtdXRNYXBwaW5nID0gJyc7CgoJfSBlbHNlIGlmICggd29ya2luZ1ByaW1hcmllcyA9PT0gUDNQcmltYXJpZXMgJiYgZW5jb2RpbmdQcmltYXJpZXMgPT09IFJlYzcwOVByaW1hcmllcyApIHsKCgkJZ2FtdXRNYXBwaW5nID0gJ0xpbmVhckRpc3BsYXlQM1RvTGluZWFyU1JHQic7CgoJfSBlbHNlIGlmICggd29ya2luZ1ByaW1hcmllcyA9PT0gUmVjNzA5UHJpbWFyaWVzICYmIGVuY29kaW5nUHJpbWFyaWVzID09PSBQM1ByaW1hcmllcyApIHsKCgkJZ2FtdXRNYXBwaW5nID0gJ0xpbmVhclNSR0JUb0xpbmVhckRpc3BsYXlQMyc7CgoJfQoKCXN3aXRjaCAoIGNvbG9yU3BhY2UgKSB7CgoJCWNhc2UgTGluZWFyU1JHQkNvbG9yU3BhY2U6CgkJY2FzZSBMaW5lYXJEaXNwbGF5UDNDb2xvclNwYWNlOgoJCQlyZXR1cm4gWyBnYW11dE1hcHBpbmcsICdMaW5lYXJUcmFuc2Zlck9FVEYnIF07CgoJCWNhc2UgU1JHQkNvbG9yU3BhY2U6CgkJY2FzZSBEaXNwbGF5UDNDb2xvclNwYWNlOgoJCQlyZXR1cm4gWyBnYW11dE1hcHBpbmcsICdzUkdCVHJhbnNmZXJPRVRGJyBdOwoKCQlkZWZhdWx0OgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFByb2dyYW06IFVuc3VwcG9ydGVkIGNvbG9yIHNwYWNlOicsIGNvbG9yU3BhY2UgKTsKCQkJcmV0dXJuIFsgZ2FtdXRNYXBwaW5nLCAnTGluZWFyVHJhbnNmZXJPRVRGJyBdOwoKCX0KCn0KCmZ1bmN0aW9uIGdldFNoYWRlckVycm9ycyggZ2wsIHNoYWRlciwgdHlwZSApIHsKCgljb25zdCBzdGF0dXMgPSBnbC5nZXRTaGFkZXJQYXJhbWV0ZXIoIHNoYWRlciwgZ2wuQ09NUElMRV9TVEFUVVMgKTsKCWNvbnN0IGVycm9ycyA9IGdsLmdldFNoYWRlckluZm9Mb2coIHNoYWRlciApLnRyaW0oKTsKCglpZiAoIHN0YXR1cyAmJiBlcnJvcnMgPT09ICcnICkgcmV0dXJuICcnOwoKCWNvbnN0IGVycm9yTWF0Y2hlcyA9IC9FUlJPUjogMDooXGQrKS8uZXhlYyggZXJyb3JzICk7CglpZiAoIGVycm9yTWF0Y2hlcyApIHsKCgkJLy8gLS1lbmFibGUtcHJpdmlsZWdlZC13ZWJnbC1leHRlbnNpb24KCQkvLyBjb25zb2xlLmxvZyggJyoqJyArIHR5cGUgKyAnKionLCBnbC5nZXRFeHRlbnNpb24oICdXRUJHTF9kZWJ1Z19zaGFkZXJzJyApLmdldFRyYW5zbGF0ZWRTaGFkZXJTb3VyY2UoIHNoYWRlciApICk7CgoJCWNvbnN0IGVycm9yTGluZSA9IHBhcnNlSW50KCBlcnJvck1hdGNoZXNbIDEgXSApOwoJCXJldHVybiB0eXBlLnRvVXBwZXJDYXNlKCkgKyAnXG5cbicgKyBlcnJvcnMgKyAnXG5cbicgKyBoYW5kbGVTb3VyY2UoIGdsLmdldFNoYWRlclNvdXJjZSggc2hhZGVyICksIGVycm9yTGluZSApOwoKCX0gZWxzZSB7CgoJCXJldHVybiBlcnJvcnM7CgoJfQoKfQoKZnVuY3Rpb24gZ2V0VGV4ZWxFbmNvZGluZ0Z1bmN0aW9uKCBmdW5jdGlvbk5hbWUsIGNvbG9yU3BhY2UgKSB7CgoJY29uc3QgY29tcG9uZW50cyA9IGdldEVuY29kaW5nQ29tcG9uZW50cyggY29sb3JTcGFjZSApOwoJcmV0dXJuIGB2ZWM0ICR7ZnVuY3Rpb25OYW1lfSggdmVjNCB2YWx1ZSApIHsgcmV0dXJuICR7Y29tcG9uZW50c1sgMCBdfSggJHtjb21wb25lbnRzWyAxIF19KCB2YWx1ZSApICk7IH1gOwoKfQoKZnVuY3Rpb24gZ2V0VG9uZU1hcHBpbmdGdW5jdGlvbiggZnVuY3Rpb25OYW1lLCB0b25lTWFwcGluZyApIHsKCglsZXQgdG9uZU1hcHBpbmdOYW1lOwoKCXN3aXRjaCAoIHRvbmVNYXBwaW5nICkgewoKCQljYXNlIExpbmVhclRvbmVNYXBwaW5nOgoJCQl0b25lTWFwcGluZ05hbWUgPSAnTGluZWFyJzsKCQkJYnJlYWs7CgoJCWNhc2UgUmVpbmhhcmRUb25lTWFwcGluZzoKCQkJdG9uZU1hcHBpbmdOYW1lID0gJ1JlaW5oYXJkJzsKCQkJYnJlYWs7CgoJCWNhc2UgQ2luZW9uVG9uZU1hcHBpbmc6CgkJCXRvbmVNYXBwaW5nTmFtZSA9ICdPcHRpbWl6ZWRDaW5lb24nOwoJCQlicmVhazsKCgkJY2FzZSBBQ0VTRmlsbWljVG9uZU1hcHBpbmc6CgkJCXRvbmVNYXBwaW5nTmFtZSA9ICdBQ0VTRmlsbWljJzsKCQkJYnJlYWs7CgoJCWNhc2UgQ3VzdG9tVG9uZU1hcHBpbmc6CgkJCXRvbmVNYXBwaW5nTmFtZSA9ICdDdXN0b20nOwoJCQlicmVhazsKCgkJZGVmYXVsdDoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xQcm9ncmFtOiBVbnN1cHBvcnRlZCB0b25lTWFwcGluZzonLCB0b25lTWFwcGluZyApOwoJCQl0b25lTWFwcGluZ05hbWUgPSAnTGluZWFyJzsKCgl9CgoJcmV0dXJuICd2ZWMzICcgKyBmdW5jdGlvbk5hbWUgKyAnKCB2ZWMzIGNvbG9yICkgeyByZXR1cm4gJyArIHRvbmVNYXBwaW5nTmFtZSArICdUb25lTWFwcGluZyggY29sb3IgKTsgfSc7Cgp9CgpmdW5jdGlvbiBnZW5lcmF0ZUV4dGVuc2lvbnMoIHBhcmFtZXRlcnMgKSB7CgoJY29uc3QgY2h1bmtzID0gWwoJCSggcGFyYW1ldGVycy5leHRlbnNpb25EZXJpdmF0aXZlcyB8fCAhISBwYXJhbWV0ZXJzLmVudk1hcEN1YmVVVkhlaWdodCB8fCBwYXJhbWV0ZXJzLmJ1bXBNYXAgfHwgcGFyYW1ldGVycy5ub3JtYWxNYXBUYW5nZW50U3BhY2UgfHwgcGFyYW1ldGVycy5jbGVhcmNvYXROb3JtYWxNYXAgfHwgcGFyYW1ldGVycy5mbGF0U2hhZGluZyB8fCBwYXJhbWV0ZXJzLnNoYWRlcklEID09PSAncGh5c2ljYWwnICkgPyAnI2V4dGVuc2lvbiBHTF9PRVNfc3RhbmRhcmRfZGVyaXZhdGl2ZXMgOiBlbmFibGUnIDogJycsCgkJKCBwYXJhbWV0ZXJzLmV4dGVuc2lvbkZyYWdEZXB0aCB8fCBwYXJhbWV0ZXJzLmxvZ2FyaXRobWljRGVwdGhCdWZmZXIgKSAmJiBwYXJhbWV0ZXJzLnJlbmRlcmVyRXh0ZW5zaW9uRnJhZ0RlcHRoID8gJyNleHRlbnNpb24gR0xfRVhUX2ZyYWdfZGVwdGggOiBlbmFibGUnIDogJycsCgkJKCBwYXJhbWV0ZXJzLmV4dGVuc2lvbkRyYXdCdWZmZXJzICYmIHBhcmFtZXRlcnMucmVuZGVyZXJFeHRlbnNpb25EcmF3QnVmZmVycyApID8gJyNleHRlbnNpb24gR0xfRVhUX2RyYXdfYnVmZmVycyA6IHJlcXVpcmUnIDogJycsCgkJKCBwYXJhbWV0ZXJzLmV4dGVuc2lvblNoYWRlclRleHR1cmVMT0QgfHwgcGFyYW1ldGVycy5lbnZNYXAgfHwgcGFyYW1ldGVycy50cmFuc21pc3Npb24gKSAmJiBwYXJhbWV0ZXJzLnJlbmRlcmVyRXh0ZW5zaW9uU2hhZGVyVGV4dHVyZUxvZCA/ICcjZXh0ZW5zaW9uIEdMX0VYVF9zaGFkZXJfdGV4dHVyZV9sb2QgOiBlbmFibGUnIDogJycKCV07CgoJcmV0dXJuIGNodW5rcy5maWx0ZXIoIGZpbHRlckVtcHR5TGluZSApLmpvaW4oICdcbicgKTsKCn0KCmZ1bmN0aW9uIGdlbmVyYXRlRGVmaW5lcyggZGVmaW5lcyApIHsKCgljb25zdCBjaHVua3MgPSBbXTsKCglmb3IgKCBjb25zdCBuYW1lIGluIGRlZmluZXMgKSB7CgoJCWNvbnN0IHZhbHVlID0gZGVmaW5lc1sgbmFtZSBdOwoKCQlpZiAoIHZhbHVlID09PSBmYWxzZSApIGNvbnRpbnVlOwoKCQljaHVua3MucHVzaCggJyNkZWZpbmUgJyArIG5hbWUgKyAnICcgKyB2YWx1ZSApOwoKCX0KCglyZXR1cm4gY2h1bmtzLmpvaW4oICdcbicgKTsKCn0KCmZ1bmN0aW9uIGZldGNoQXR0cmlidXRlTG9jYXRpb25zKCBnbCwgcHJvZ3JhbSApIHsKCgljb25zdCBhdHRyaWJ1dGVzID0ge307CgoJY29uc3QgbiA9IGdsLmdldFByb2dyYW1QYXJhbWV0ZXIoIHByb2dyYW0sIGdsLkFDVElWRV9BVFRSSUJVVEVTICk7CgoJZm9yICggbGV0IGkgPSAwOyBpIDwgbjsgaSArKyApIHsKCgkJY29uc3QgaW5mbyA9IGdsLmdldEFjdGl2ZUF0dHJpYiggcHJvZ3JhbSwgaSApOwoJCWNvbnN0IG5hbWUgPSBpbmZvLm5hbWU7CgoJCWxldCBsb2NhdGlvblNpemUgPSAxOwoJCWlmICggaW5mby50eXBlID09PSBnbC5GTE9BVF9NQVQyICkgbG9jYXRpb25TaXplID0gMjsKCQlpZiAoIGluZm8udHlwZSA9PT0gZ2wuRkxPQVRfTUFUMyApIGxvY2F0aW9uU2l6ZSA9IDM7CgkJaWYgKCBpbmZvLnR5cGUgPT09IGdsLkZMT0FUX01BVDQgKSBsb2NhdGlvblNpemUgPSA0OwoKCQkvLyBjb25zb2xlLmxvZyggJ1RIUkVFLldlYkdMUHJvZ3JhbTogQUNUSVZFIFZFUlRFWCBBVFRSSUJVVEU6JywgbmFtZSwgaSApOwoKCQlhdHRyaWJ1dGVzWyBuYW1lIF0gPSB7CgkJCXR5cGU6IGluZm8udHlwZSwKCQkJbG9jYXRpb246IGdsLmdldEF0dHJpYkxvY2F0aW9uKCBwcm9ncmFtLCBuYW1lICksCgkJCWxvY2F0aW9uU2l6ZTogbG9jYXRpb25TaXplCgkJfTsKCgl9CgoJcmV0dXJuIGF0dHJpYnV0ZXM7Cgp9CgpmdW5jdGlvbiBmaWx0ZXJFbXB0eUxpbmUoIHN0cmluZyApIHsKCglyZXR1cm4gc3RyaW5nICE9PSAnJzsKCn0KCmZ1bmN0aW9uIHJlcGxhY2VMaWdodE51bXMoIHN0cmluZywgcGFyYW1ldGVycyApIHsKCgljb25zdCBudW1TcG90TGlnaHRDb29yZHMgPSBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodFNoYWRvd3MgKyBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodE1hcHMgLSBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodFNoYWRvd3NXaXRoTWFwczsKCglyZXR1cm4gc3RyaW5nCgkJLnJlcGxhY2UoIC9OVU1fRElSX0xJR0hUUy9nLCBwYXJhbWV0ZXJzLm51bURpckxpZ2h0cyApCgkJLnJlcGxhY2UoIC9OVU1fU1BPVF9MSUdIVFMvZywgcGFyYW1ldGVycy5udW1TcG90TGlnaHRzICkKCQkucmVwbGFjZSggL05VTV9TUE9UX0xJR0hUX01BUFMvZywgcGFyYW1ldGVycy5udW1TcG90TGlnaHRNYXBzICkKCQkucmVwbGFjZSggL05VTV9TUE9UX0xJR0hUX0NPT1JEUy9nLCBudW1TcG90TGlnaHRDb29yZHMgKQoJCS5yZXBsYWNlKCAvTlVNX1JFQ1RfQVJFQV9MSUdIVFMvZywgcGFyYW1ldGVycy5udW1SZWN0QXJlYUxpZ2h0cyApCgkJLnJlcGxhY2UoIC9OVU1fUE9JTlRfTElHSFRTL2csIHBhcmFtZXRlcnMubnVtUG9pbnRMaWdodHMgKQoJCS5yZXBsYWNlKCAvTlVNX0hFTUlfTElHSFRTL2csIHBhcmFtZXRlcnMubnVtSGVtaUxpZ2h0cyApCgkJLnJlcGxhY2UoIC9OVU1fRElSX0xJR0hUX1NIQURPV1MvZywgcGFyYW1ldGVycy5udW1EaXJMaWdodFNoYWRvd3MgKQoJCS5yZXBsYWNlKCAvTlVNX1NQT1RfTElHSFRfU0hBRE9XU19XSVRIX01BUFMvZywgcGFyYW1ldGVycy5udW1TcG90TGlnaHRTaGFkb3dzV2l0aE1hcHMgKQoJCS5yZXBsYWNlKCAvTlVNX1NQT1RfTElHSFRfU0hBRE9XUy9nLCBwYXJhbWV0ZXJzLm51bVNwb3RMaWdodFNoYWRvd3MgKQoJCS5yZXBsYWNlKCAvTlVNX1BPSU5UX0xJR0hUX1NIQURPV1MvZywgcGFyYW1ldGVycy5udW1Qb2ludExpZ2h0U2hhZG93cyApOwoKfQoKZnVuY3Rpb24gcmVwbGFjZUNsaXBwaW5nUGxhbmVOdW1zKCBzdHJpbmcsIHBhcmFtZXRlcnMgKSB7CgoJcmV0dXJuIHN0cmluZwoJCS5yZXBsYWNlKCAvTlVNX0NMSVBQSU5HX1BMQU5FUy9nLCBwYXJhbWV0ZXJzLm51bUNsaXBwaW5nUGxhbmVzICkKCQkucmVwbGFjZSggL1VOSU9OX0NMSVBQSU5HX1BMQU5FUy9nLCAoIHBhcmFtZXRlcnMubnVtQ2xpcHBpbmdQbGFuZXMgLSBwYXJhbWV0ZXJzLm51bUNsaXBJbnRlcnNlY3Rpb24gKSApOwoKfQoKLy8gUmVzb2x2ZSBJbmNsdWRlcwoKY29uc3QgaW5jbHVkZVBhdHRlcm4gPSAvXlsgXHRdKiNpbmNsdWRlICs8KFtcd1xkLi9dKyk+L2dtOwoKZnVuY3Rpb24gcmVzb2x2ZUluY2x1ZGVzKCBzdHJpbmcgKSB7CgoJcmV0dXJuIHN0cmluZy5yZXBsYWNlKCBpbmNsdWRlUGF0dGVybiwgaW5jbHVkZVJlcGxhY2VyICk7Cgp9Cgpjb25zdCBzaGFkZXJDaHVua01hcCA9IG5ldyBNYXAoIFsKCVsgJ2VuY29kaW5nc19mcmFnbWVudCcsICdjb2xvcnNwYWNlX2ZyYWdtZW50JyBdLCAvLyBAZGVwcmVjYXRlZCwgcjE1NAoJWyAnZW5jb2RpbmdzX3BhcnNfZnJhZ21lbnQnLCAnY29sb3JzcGFjZV9wYXJzX2ZyYWdtZW50JyBdLCAvLyBAZGVwcmVjYXRlZCwgcjE1NAoJWyAnb3V0cHV0X2ZyYWdtZW50JywgJ29wYXF1ZV9mcmFnbWVudCcgXSwgLy8gQGRlcHJlY2F0ZWQsIHIxNTQKXSApOwoKZnVuY3Rpb24gaW5jbHVkZVJlcGxhY2VyKCBtYXRjaCwgaW5jbHVkZSApIHsKCglsZXQgc3RyaW5nID0gU2hhZGVyQ2h1bmtbIGluY2x1ZGUgXTsKCglpZiAoIHN0cmluZyA9PT0gdW5kZWZpbmVkICkgewoKCQljb25zdCBuZXdJbmNsdWRlID0gc2hhZGVyQ2h1bmtNYXAuZ2V0KCBpbmNsdWRlICk7CgoJCWlmICggbmV3SW5jbHVkZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJc3RyaW5nID0gU2hhZGVyQ2h1bmtbIG5ld0luY2x1ZGUgXTsKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogU2hhZGVyIGNodW5rICIlcyIgaGFzIGJlZW4gZGVwcmVjYXRlZC4gVXNlICIlcyIgaW5zdGVhZC4nLCBpbmNsdWRlLCBuZXdJbmNsdWRlICk7CgoJCX0gZWxzZSB7CgoJCQl0aHJvdyBuZXcgRXJyb3IoICdDYW4gbm90IHJlc29sdmUgI2luY2x1ZGUgPCcgKyBpbmNsdWRlICsgJz4nICk7CgoJCX0KCgl9CgoJcmV0dXJuIHJlc29sdmVJbmNsdWRlcyggc3RyaW5nICk7Cgp9CgovLyBVbnJvbGwgTG9vcHMKCmNvbnN0IHVucm9sbExvb3BQYXR0ZXJuID0gLyNwcmFnbWEgdW5yb2xsX2xvb3Bfc3RhcnRccytmb3JccypcKFxzKmludFxzK2lccyo9XHMqKFxkKylccyo7XHMqaVxzKjxccyooXGQrKVxzKjtccyppXHMqXCtcK1xzKlwpXHMqeyhbXHNcU10rPyl9XHMrI3ByYWdtYSB1bnJvbGxfbG9vcF9lbmQvZzsKCmZ1bmN0aW9uIHVucm9sbExvb3BzKCBzdHJpbmcgKSB7CgoJcmV0dXJuIHN0cmluZy5yZXBsYWNlKCB1bnJvbGxMb29wUGF0dGVybiwgbG9vcFJlcGxhY2VyICk7Cgp9CgpmdW5jdGlvbiBsb29wUmVwbGFjZXIoIG1hdGNoLCBzdGFydCwgZW5kLCBzbmlwcGV0ICkgewoKCWxldCBzdHJpbmcgPSAnJzsKCglmb3IgKCBsZXQgaSA9IHBhcnNlSW50KCBzdGFydCApOyBpIDwgcGFyc2VJbnQoIGVuZCApOyBpICsrICkgewoKCQlzdHJpbmcgKz0gc25pcHBldAoJCQkucmVwbGFjZSggL1xbXHMqaVxzKlxdL2csICdbICcgKyBpICsgJyBdJyApCgkJCS5yZXBsYWNlKCAvVU5ST0xMRURfTE9PUF9JTkRFWC9nLCBpICk7CgoJfQoKCXJldHVybiBzdHJpbmc7Cgp9CgovLwoKZnVuY3Rpb24gZ2VuZXJhdGVQcmVjaXNpb24oIHBhcmFtZXRlcnMgKSB7CgoJbGV0IHByZWNpc2lvbnN0cmluZyA9ICdwcmVjaXNpb24gJyArIHBhcmFtZXRlcnMucHJlY2lzaW9uICsgJyBmbG9hdDtcbnByZWNpc2lvbiAnICsgcGFyYW1ldGVycy5wcmVjaXNpb24gKyAnIGludDsnOwoKCWlmICggcGFyYW1ldGVycy5wcmVjaXNpb24gPT09ICdoaWdocCcgKSB7CgoJCXByZWNpc2lvbnN0cmluZyArPSAnXG4jZGVmaW5lIEhJR0hfUFJFQ0lTSU9OJzsKCgl9IGVsc2UgaWYgKCBwYXJhbWV0ZXJzLnByZWNpc2lvbiA9PT0gJ21lZGl1bXAnICkgewoKCQlwcmVjaXNpb25zdHJpbmcgKz0gJ1xuI2RlZmluZSBNRURJVU1fUFJFQ0lTSU9OJzsKCgl9IGVsc2UgaWYgKCBwYXJhbWV0ZXJzLnByZWNpc2lvbiA9PT0gJ2xvd3AnICkgewoKCQlwcmVjaXNpb25zdHJpbmcgKz0gJ1xuI2RlZmluZSBMT1dfUFJFQ0lTSU9OJzsKCgl9CgoJcmV0dXJuIHByZWNpc2lvbnN0cmluZzsKCn0KCmZ1bmN0aW9uIGdlbmVyYXRlU2hhZG93TWFwVHlwZURlZmluZSggcGFyYW1ldGVycyApIHsKCglsZXQgc2hhZG93TWFwVHlwZURlZmluZSA9ICdTSEFET1dNQVBfVFlQRV9CQVNJQyc7CgoJaWYgKCBwYXJhbWV0ZXJzLnNoYWRvd01hcFR5cGUgPT09IFBDRlNoYWRvd01hcCApIHsKCgkJc2hhZG93TWFwVHlwZURlZmluZSA9ICdTSEFET1dNQVBfVFlQRV9QQ0YnOwoKCX0gZWxzZSBpZiAoIHBhcmFtZXRlcnMuc2hhZG93TWFwVHlwZSA9PT0gUENGU29mdFNoYWRvd01hcCApIHsKCgkJc2hhZG93TWFwVHlwZURlZmluZSA9ICdTSEFET1dNQVBfVFlQRV9QQ0ZfU09GVCc7CgoJfSBlbHNlIGlmICggcGFyYW1ldGVycy5zaGFkb3dNYXBUeXBlID09PSBWU01TaGFkb3dNYXAgKSB7CgoJCXNoYWRvd01hcFR5cGVEZWZpbmUgPSAnU0hBRE9XTUFQX1RZUEVfVlNNJzsKCgl9CgoJcmV0dXJuIHNoYWRvd01hcFR5cGVEZWZpbmU7Cgp9CgpmdW5jdGlvbiBnZW5lcmF0ZUVudk1hcFR5cGVEZWZpbmUoIHBhcmFtZXRlcnMgKSB7CgoJbGV0IGVudk1hcFR5cGVEZWZpbmUgPSAnRU5WTUFQX1RZUEVfQ1VCRSc7CgoJaWYgKCBwYXJhbWV0ZXJzLmVudk1hcCApIHsKCgkJc3dpdGNoICggcGFyYW1ldGVycy5lbnZNYXBNb2RlICkgewoKCQkJY2FzZSBDdWJlUmVmbGVjdGlvbk1hcHBpbmc6CgkJCWNhc2UgQ3ViZVJlZnJhY3Rpb25NYXBwaW5nOgoJCQkJZW52TWFwVHlwZURlZmluZSA9ICdFTlZNQVBfVFlQRV9DVUJFJzsKCQkJCWJyZWFrOwoKCQkJY2FzZSBDdWJlVVZSZWZsZWN0aW9uTWFwcGluZzoKCQkJCWVudk1hcFR5cGVEZWZpbmUgPSAnRU5WTUFQX1RZUEVfQ1VCRV9VVic7CgkJCQlicmVhazsKCgkJfQoKCX0KCglyZXR1cm4gZW52TWFwVHlwZURlZmluZTsKCn0KCmZ1bmN0aW9uIGdlbmVyYXRlRW52TWFwTW9kZURlZmluZSggcGFyYW1ldGVycyApIHsKCglsZXQgZW52TWFwTW9kZURlZmluZSA9ICdFTlZNQVBfTU9ERV9SRUZMRUNUSU9OJzsKCglpZiAoIHBhcmFtZXRlcnMuZW52TWFwICkgewoKCQlzd2l0Y2ggKCBwYXJhbWV0ZXJzLmVudk1hcE1vZGUgKSB7CgoJCQljYXNlIEN1YmVSZWZyYWN0aW9uTWFwcGluZzoKCgkJCQllbnZNYXBNb2RlRGVmaW5lID0gJ0VOVk1BUF9NT0RFX1JFRlJBQ1RJT04nOwoJCQkJYnJlYWs7CgoJCX0KCgl9CgoJcmV0dXJuIGVudk1hcE1vZGVEZWZpbmU7Cgp9CgpmdW5jdGlvbiBnZW5lcmF0ZUVudk1hcEJsZW5kaW5nRGVmaW5lKCBwYXJhbWV0ZXJzICkgewoKCWxldCBlbnZNYXBCbGVuZGluZ0RlZmluZSA9ICdFTlZNQVBfQkxFTkRJTkdfTk9ORSc7CgoJaWYgKCBwYXJhbWV0ZXJzLmVudk1hcCApIHsKCgkJc3dpdGNoICggcGFyYW1ldGVycy5jb21iaW5lICkgewoKCQkJY2FzZSBNdWx0aXBseU9wZXJhdGlvbjoKCQkJCWVudk1hcEJsZW5kaW5nRGVmaW5lID0gJ0VOVk1BUF9CTEVORElOR19NVUxUSVBMWSc7CgkJCQlicmVhazsKCgkJCWNhc2UgTWl4T3BlcmF0aW9uOgoJCQkJZW52TWFwQmxlbmRpbmdEZWZpbmUgPSAnRU5WTUFQX0JMRU5ESU5HX01JWCc7CgkJCQlicmVhazsKCgkJCWNhc2UgQWRkT3BlcmF0aW9uOgoJCQkJZW52TWFwQmxlbmRpbmdEZWZpbmUgPSAnRU5WTUFQX0JMRU5ESU5HX0FERCc7CgkJCQlicmVhazsKCgkJfQoKCX0KCglyZXR1cm4gZW52TWFwQmxlbmRpbmdEZWZpbmU7Cgp9CgpmdW5jdGlvbiBnZW5lcmF0ZUN1YmVVVlNpemUoIHBhcmFtZXRlcnMgKSB7CgoJY29uc3QgaW1hZ2VIZWlnaHQgPSBwYXJhbWV0ZXJzLmVudk1hcEN1YmVVVkhlaWdodDsKCglpZiAoIGltYWdlSGVpZ2h0ID09PSBudWxsICkgcmV0dXJuIG51bGw7CgoJY29uc3QgbWF4TWlwID0gTWF0aC5sb2cyKCBpbWFnZUhlaWdodCApIC0gMjsKCgljb25zdCB0ZXhlbEhlaWdodCA9IDEuMCAvIGltYWdlSGVpZ2h0OwoKCWNvbnN0IHRleGVsV2lkdGggPSAxLjAgLyAoIDMgKiBNYXRoLm1heCggTWF0aC5wb3coIDIsIG1heE1pcCApLCA3ICogMTYgKSApOwoKCXJldHVybiB7IHRleGVsV2lkdGgsIHRleGVsSGVpZ2h0LCBtYXhNaXAgfTsKCn0KCmZ1bmN0aW9uIFdlYkdMUHJvZ3JhbSggcmVuZGVyZXIsIGNhY2hlS2V5LCBwYXJhbWV0ZXJzLCBiaW5kaW5nU3RhdGVzICkgewoKCS8vIFRPRE8gU2VuZCB0aGlzIGV2ZW50IHRvIFRocmVlLmpzIERldlRvb2xzCgkvLyBjb25zb2xlLmxvZyggJ1dlYkdMUHJvZ3JhbScsIGNhY2hlS2V5ICk7CgoJY29uc3QgZ2wgPSByZW5kZXJlci5nZXRDb250ZXh0KCk7CgoJY29uc3QgZGVmaW5lcyA9IHBhcmFtZXRlcnMuZGVmaW5lczsKCglsZXQgdmVydGV4U2hhZGVyID0gcGFyYW1ldGVycy52ZXJ0ZXhTaGFkZXI7CglsZXQgZnJhZ21lbnRTaGFkZXIgPSBwYXJhbWV0ZXJzLmZyYWdtZW50U2hhZGVyOwoKCWNvbnN0IHNoYWRvd01hcFR5cGVEZWZpbmUgPSBnZW5lcmF0ZVNoYWRvd01hcFR5cGVEZWZpbmUoIHBhcmFtZXRlcnMgKTsKCWNvbnN0IGVudk1hcFR5cGVEZWZpbmUgPSBnZW5lcmF0ZUVudk1hcFR5cGVEZWZpbmUoIHBhcmFtZXRlcnMgKTsKCWNvbnN0IGVudk1hcE1vZGVEZWZpbmUgPSBnZW5lcmF0ZUVudk1hcE1vZGVEZWZpbmUoIHBhcmFtZXRlcnMgKTsKCWNvbnN0IGVudk1hcEJsZW5kaW5nRGVmaW5lID0gZ2VuZXJhdGVFbnZNYXBCbGVuZGluZ0RlZmluZSggcGFyYW1ldGVycyApOwoJY29uc3QgZW52TWFwQ3ViZVVWU2l6ZSA9IGdlbmVyYXRlQ3ViZVVWU2l6ZSggcGFyYW1ldGVycyApOwoKCWNvbnN0IGN1c3RvbUV4dGVuc2lvbnMgPSBwYXJhbWV0ZXJzLmlzV2ViR0wyID8gJycgOiBnZW5lcmF0ZUV4dGVuc2lvbnMoIHBhcmFtZXRlcnMgKTsKCgljb25zdCBjdXN0b21EZWZpbmVzID0gZ2VuZXJhdGVEZWZpbmVzKCBkZWZpbmVzICk7CgoJY29uc3QgcHJvZ3JhbSA9IGdsLmNyZWF0ZVByb2dyYW0oKTsKCglsZXQgcHJlZml4VmVydGV4LCBwcmVmaXhGcmFnbWVudDsKCWxldCB2ZXJzaW9uU3RyaW5nID0gcGFyYW1ldGVycy5nbHNsVmVyc2lvbiA/ICcjdmVyc2lvbiAnICsgcGFyYW1ldGVycy5nbHNsVmVyc2lvbiArICdcbicgOiAnJzsKCglpZiAoIHBhcmFtZXRlcnMuaXNSYXdTaGFkZXJNYXRlcmlhbCApIHsKCgkJcHJlZml4VmVydGV4ID0gWwoKCQkJJyNkZWZpbmUgU0hBREVSX1RZUEUgJyArIHBhcmFtZXRlcnMuc2hhZGVyVHlwZSwKCQkJJyNkZWZpbmUgU0hBREVSX05BTUUgJyArIHBhcmFtZXRlcnMuc2hhZGVyTmFtZSwKCgkJCWN1c3RvbURlZmluZXMKCgkJXS5maWx0ZXIoIGZpbHRlckVtcHR5TGluZSApLmpvaW4oICdcbicgKTsKCgkJaWYgKCBwcmVmaXhWZXJ0ZXgubGVuZ3RoID4gMCApIHsKCgkJCXByZWZpeFZlcnRleCArPSAnXG4nOwoKCQl9CgoJCXByZWZpeEZyYWdtZW50ID0gWwoKCQkJY3VzdG9tRXh0ZW5zaW9ucywKCgkJCScjZGVmaW5lIFNIQURFUl9UWVBFICcgKyBwYXJhbWV0ZXJzLnNoYWRlclR5cGUsCgkJCScjZGVmaW5lIFNIQURFUl9OQU1FICcgKyBwYXJhbWV0ZXJzLnNoYWRlck5hbWUsCgoJCQljdXN0b21EZWZpbmVzCgoJCV0uZmlsdGVyKCBmaWx0ZXJFbXB0eUxpbmUgKS5qb2luKCAnXG4nICk7CgoJCWlmICggcHJlZml4RnJhZ21lbnQubGVuZ3RoID4gMCApIHsKCgkJCXByZWZpeEZyYWdtZW50ICs9ICdcbic7CgoJCX0KCgl9IGVsc2UgewoKCQlwcmVmaXhWZXJ0ZXggPSBbCgoJCQlnZW5lcmF0ZVByZWNpc2lvbiggcGFyYW1ldGVycyApLAoKCQkJJyNkZWZpbmUgU0hBREVSX1RZUEUgJyArIHBhcmFtZXRlcnMuc2hhZGVyVHlwZSwKCQkJJyNkZWZpbmUgU0hBREVSX05BTUUgJyArIHBhcmFtZXRlcnMuc2hhZGVyTmFtZSwKCgkJCWN1c3RvbURlZmluZXMsCgoJCQlwYXJhbWV0ZXJzLmluc3RhbmNpbmcgPyAnI2RlZmluZSBVU0VfSU5TVEFOQ0lORycgOiAnJywKCQkJcGFyYW1ldGVycy5pbnN0YW5jaW5nQ29sb3IgPyAnI2RlZmluZSBVU0VfSU5TVEFOQ0lOR19DT0xPUicgOiAnJywKCgkJCXBhcmFtZXRlcnMudXNlRm9nICYmIHBhcmFtZXRlcnMuZm9nID8gJyNkZWZpbmUgVVNFX0ZPRycgOiAnJywKCQkJcGFyYW1ldGVycy51c2VGb2cgJiYgcGFyYW1ldGVycy5mb2dFeHAyID8gJyNkZWZpbmUgRk9HX0VYUDInIDogJycsCgoJCQlwYXJhbWV0ZXJzLm1hcCA/ICcjZGVmaW5lIFVTRV9NQVAnIDogJycsCgkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgVVNFX0VOVk1BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5lbnZNYXAgPyAnI2RlZmluZSAnICsgZW52TWFwTW9kZURlZmluZSA6ICcnLAoJCQlwYXJhbWV0ZXJzLmxpZ2h0TWFwID8gJyNkZWZpbmUgVVNFX0xJR0hUTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLmFvTWFwID8gJyNkZWZpbmUgVVNFX0FPTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLmJ1bXBNYXAgPyAnI2RlZmluZSBVU0VfQlVNUE1BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5ub3JtYWxNYXAgPyAnI2RlZmluZSBVU0VfTk9STUFMTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLm5vcm1hbE1hcE9iamVjdFNwYWNlID8gJyNkZWZpbmUgVVNFX05PUk1BTE1BUF9PQkpFQ1RTUEFDRScgOiAnJywKCQkJcGFyYW1ldGVycy5ub3JtYWxNYXBUYW5nZW50U3BhY2UgPyAnI2RlZmluZSBVU0VfTk9STUFMTUFQX1RBTkdFTlRTUEFDRScgOiAnJywKCQkJcGFyYW1ldGVycy5kaXNwbGFjZW1lbnRNYXAgPyAnI2RlZmluZSBVU0VfRElTUExBQ0VNRU5UTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLmVtaXNzaXZlTWFwID8gJyNkZWZpbmUgVVNFX0VNSVNTSVZFTUFQJyA6ICcnLAoKCQkJcGFyYW1ldGVycy5hbmlzb3Ryb3B5ID8gJyNkZWZpbmUgVVNFX0FOSVNPVFJPUFknIDogJycsCgkJCXBhcmFtZXRlcnMuYW5pc290cm9weU1hcCA/ICcjZGVmaW5lIFVTRV9BTklTT1RST1BZTUFQJyA6ICcnLAoKCQkJcGFyYW1ldGVycy5jbGVhcmNvYXRNYXAgPyAnI2RlZmluZSBVU0VfQ0xFQVJDT0FUTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdFJvdWdobmVzc01hcCA/ICcjZGVmaW5lIFVTRV9DTEVBUkNPQVRfUk9VR0hORVNTTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdE5vcm1hbE1hcCA/ICcjZGVmaW5lIFVTRV9DTEVBUkNPQVRfTk9STUFMTUFQJyA6ICcnLAoKCQkJcGFyYW1ldGVycy5pcmlkZXNjZW5jZU1hcCA/ICcjZGVmaW5lIFVTRV9JUklERVNDRU5DRU1BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcCA/ICcjZGVmaW5lIFVTRV9JUklERVNDRU5DRV9USElDS05FU1NNQVAnIDogJycsCgoJCQlwYXJhbWV0ZXJzLnNwZWN1bGFyTWFwID8gJyNkZWZpbmUgVVNFX1NQRUNVTEFSTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLnNwZWN1bGFyQ29sb3JNYXAgPyAnI2RlZmluZSBVU0VfU1BFQ1VMQVJfQ09MT1JNQVAnIDogJycsCgkJCXBhcmFtZXRlcnMuc3BlY3VsYXJJbnRlbnNpdHlNYXAgPyAnI2RlZmluZSBVU0VfU1BFQ1VMQVJfSU5URU5TSVRZTUFQJyA6ICcnLAoKCQkJcGFyYW1ldGVycy5yb3VnaG5lc3NNYXAgPyAnI2RlZmluZSBVU0VfUk9VR0hORVNTTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLm1ldGFsbmVzc01hcCA/ICcjZGVmaW5lIFVTRV9NRVRBTE5FU1NNQVAnIDogJycsCgkJCXBhcmFtZXRlcnMuYWxwaGFNYXAgPyAnI2RlZmluZSBVU0VfQUxQSEFNQVAnIDogJycsCgkJCXBhcmFtZXRlcnMuYWxwaGFIYXNoID8gJyNkZWZpbmUgVVNFX0FMUEhBSEFTSCcgOiAnJywKCgkJCXBhcmFtZXRlcnMudHJhbnNtaXNzaW9uID8gJyNkZWZpbmUgVVNFX1RSQU5TTUlTU0lPTicgOiAnJywKCQkJcGFyYW1ldGVycy50cmFuc21pc3Npb25NYXAgPyAnI2RlZmluZSBVU0VfVFJBTlNNSVNTSU9OTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLnRoaWNrbmVzc01hcCA/ICcjZGVmaW5lIFVTRV9USElDS05FU1NNQVAnIDogJycsCgoJCQlwYXJhbWV0ZXJzLnNoZWVuQ29sb3JNYXAgPyAnI2RlZmluZSBVU0VfU0hFRU5fQ09MT1JNQVAnIDogJycsCgkJCXBhcmFtZXRlcnMuc2hlZW5Sb3VnaG5lc3NNYXAgPyAnI2RlZmluZSBVU0VfU0hFRU5fUk9VR0hORVNTTUFQJyA6ICcnLAoKCQkJLy8KCgkJCXBhcmFtZXRlcnMubWFwVXYgPyAnI2RlZmluZSBNQVBfVVYgJyArIHBhcmFtZXRlcnMubWFwVXYgOiAnJywKCQkJcGFyYW1ldGVycy5hbHBoYU1hcFV2ID8gJyNkZWZpbmUgQUxQSEFNQVBfVVYgJyArIHBhcmFtZXRlcnMuYWxwaGFNYXBVdiA6ICcnLAoJCQlwYXJhbWV0ZXJzLmxpZ2h0TWFwVXYgPyAnI2RlZmluZSBMSUdIVE1BUF9VViAnICsgcGFyYW1ldGVycy5saWdodE1hcFV2IDogJycsCgkJCXBhcmFtZXRlcnMuYW9NYXBVdiA/ICcjZGVmaW5lIEFPTUFQX1VWICcgKyBwYXJhbWV0ZXJzLmFvTWFwVXYgOiAnJywKCQkJcGFyYW1ldGVycy5lbWlzc2l2ZU1hcFV2ID8gJyNkZWZpbmUgRU1JU1NJVkVNQVBfVVYgJyArIHBhcmFtZXRlcnMuZW1pc3NpdmVNYXBVdiA6ICcnLAoJCQlwYXJhbWV0ZXJzLmJ1bXBNYXBVdiA/ICcjZGVmaW5lIEJVTVBNQVBfVVYgJyArIHBhcmFtZXRlcnMuYnVtcE1hcFV2IDogJycsCgkJCXBhcmFtZXRlcnMubm9ybWFsTWFwVXYgPyAnI2RlZmluZSBOT1JNQUxNQVBfVVYgJyArIHBhcmFtZXRlcnMubm9ybWFsTWFwVXYgOiAnJywKCQkJcGFyYW1ldGVycy5kaXNwbGFjZW1lbnRNYXBVdiA/ICcjZGVmaW5lIERJU1BMQUNFTUVOVE1BUF9VViAnICsgcGFyYW1ldGVycy5kaXNwbGFjZW1lbnRNYXBVdiA6ICcnLAoKCQkJcGFyYW1ldGVycy5tZXRhbG5lc3NNYXBVdiA/ICcjZGVmaW5lIE1FVEFMTkVTU01BUF9VViAnICsgcGFyYW1ldGVycy5tZXRhbG5lc3NNYXBVdiA6ICcnLAoJCQlwYXJhbWV0ZXJzLnJvdWdobmVzc01hcFV2ID8gJyNkZWZpbmUgUk9VR0hORVNTTUFQX1VWICcgKyBwYXJhbWV0ZXJzLnJvdWdobmVzc01hcFV2IDogJycsCgoJCQlwYXJhbWV0ZXJzLmFuaXNvdHJvcHlNYXBVdiA/ICcjZGVmaW5lIEFOSVNPVFJPUFlNQVBfVVYgJyArIHBhcmFtZXRlcnMuYW5pc290cm9weU1hcFV2IDogJycsCgoJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdE1hcFV2ID8gJyNkZWZpbmUgQ0xFQVJDT0FUTUFQX1VWICcgKyBwYXJhbWV0ZXJzLmNsZWFyY29hdE1hcFV2IDogJycsCgkJCXBhcmFtZXRlcnMuY2xlYXJjb2F0Tm9ybWFsTWFwVXYgPyAnI2RlZmluZSBDTEVBUkNPQVRfTk9STUFMTUFQX1VWICcgKyBwYXJhbWV0ZXJzLmNsZWFyY29hdE5vcm1hbE1hcFV2IDogJycsCgkJCXBhcmFtZXRlcnMuY2xlYXJjb2F0Um91Z2huZXNzTWFwVXYgPyAnI2RlZmluZSBDTEVBUkNPQVRfUk9VR0hORVNTTUFQX1VWICcgKyBwYXJhbWV0ZXJzLmNsZWFyY29hdFJvdWdobmVzc01hcFV2IDogJycsCgoJCQlwYXJhbWV0ZXJzLmlyaWRlc2NlbmNlTWFwVXYgPyAnI2RlZmluZSBJUklERVNDRU5DRU1BUF9VViAnICsgcGFyYW1ldGVycy5pcmlkZXNjZW5jZU1hcFV2IDogJycsCgkJCXBhcmFtZXRlcnMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXBVdiA/ICcjZGVmaW5lIElSSURFU0NFTkNFX1RISUNLTkVTU01BUF9VViAnICsgcGFyYW1ldGVycy5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcFV2IDogJycsCgoJCQlwYXJhbWV0ZXJzLnNoZWVuQ29sb3JNYXBVdiA/ICcjZGVmaW5lIFNIRUVOX0NPTE9STUFQX1VWICcgKyBwYXJhbWV0ZXJzLnNoZWVuQ29sb3JNYXBVdiA6ICcnLAoJCQlwYXJhbWV0ZXJzLnNoZWVuUm91Z2huZXNzTWFwVXYgPyAnI2RlZmluZSBTSEVFTl9ST1VHSE5FU1NNQVBfVVYgJyArIHBhcmFtZXRlcnMuc2hlZW5Sb3VnaG5lc3NNYXBVdiA6ICcnLAoKCQkJcGFyYW1ldGVycy5zcGVjdWxhck1hcFV2ID8gJyNkZWZpbmUgU1BFQ1VMQVJNQVBfVVYgJyArIHBhcmFtZXRlcnMuc3BlY3VsYXJNYXBVdiA6ICcnLAoJCQlwYXJhbWV0ZXJzLnNwZWN1bGFyQ29sb3JNYXBVdiA/ICcjZGVmaW5lIFNQRUNVTEFSX0NPTE9STUFQX1VWICcgKyBwYXJhbWV0ZXJzLnNwZWN1bGFyQ29sb3JNYXBVdiA6ICcnLAoJCQlwYXJhbWV0ZXJzLnNwZWN1bGFySW50ZW5zaXR5TWFwVXYgPyAnI2RlZmluZSBTUEVDVUxBUl9JTlRFTlNJVFlNQVBfVVYgJyArIHBhcmFtZXRlcnMuc3BlY3VsYXJJbnRlbnNpdHlNYXBVdiA6ICcnLAoKCQkJcGFyYW1ldGVycy50cmFuc21pc3Npb25NYXBVdiA/ICcjZGVmaW5lIFRSQU5TTUlTU0lPTk1BUF9VViAnICsgcGFyYW1ldGVycy50cmFuc21pc3Npb25NYXBVdiA6ICcnLAoJCQlwYXJhbWV0ZXJzLnRoaWNrbmVzc01hcFV2ID8gJyNkZWZpbmUgVEhJQ0tORVNTTUFQX1VWICcgKyBwYXJhbWV0ZXJzLnRoaWNrbmVzc01hcFV2IDogJycsCgoJCQkvLwoKCQkJcGFyYW1ldGVycy52ZXJ0ZXhUYW5nZW50cyAmJiBwYXJhbWV0ZXJzLmZsYXRTaGFkaW5nID09PSBmYWxzZSA/ICcjZGVmaW5lIFVTRV9UQU5HRU5UJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLnZlcnRleENvbG9ycyA/ICcjZGVmaW5lIFVTRV9DT0xPUicgOiAnJywKCQkJcGFyYW1ldGVycy52ZXJ0ZXhBbHBoYXMgPyAnI2RlZmluZSBVU0VfQ09MT1JfQUxQSEEnIDogJycsCgkJCXBhcmFtZXRlcnMudmVydGV4VXYxcyA/ICcjZGVmaW5lIFVTRV9VVjEnIDogJycsCgkJCXBhcmFtZXRlcnMudmVydGV4VXYycyA/ICcjZGVmaW5lIFVTRV9VVjInIDogJycsCgkJCXBhcmFtZXRlcnMudmVydGV4VXYzcyA/ICcjZGVmaW5lIFVTRV9VVjMnIDogJycsCgoJCQlwYXJhbWV0ZXJzLnBvaW50c1V2cyA/ICcjZGVmaW5lIFVTRV9QT0lOVFNfVVYnIDogJycsCgoJCQlwYXJhbWV0ZXJzLmZsYXRTaGFkaW5nID8gJyNkZWZpbmUgRkxBVF9TSEFERUQnIDogJycsCgoJCQlwYXJhbWV0ZXJzLnNraW5uaW5nID8gJyNkZWZpbmUgVVNFX1NLSU5OSU5HJyA6ICcnLAoKCQkJcGFyYW1ldGVycy5tb3JwaFRhcmdldHMgPyAnI2RlZmluZSBVU0VfTU9SUEhUQVJHRVRTJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLm1vcnBoTm9ybWFscyAmJiBwYXJhbWV0ZXJzLmZsYXRTaGFkaW5nID09PSBmYWxzZSA/ICcjZGVmaW5lIFVTRV9NT1JQSE5PUk1BTFMnIDogJycsCgkJCSggcGFyYW1ldGVycy5tb3JwaENvbG9ycyAmJiBwYXJhbWV0ZXJzLmlzV2ViR0wyICkgPyAnI2RlZmluZSBVU0VfTU9SUEhDT0xPUlMnIDogJycsCgkJCSggcGFyYW1ldGVycy5tb3JwaFRhcmdldHNDb3VudCA+IDAgJiYgcGFyYW1ldGVycy5pc1dlYkdMMiApID8gJyNkZWZpbmUgTU9SUEhUQVJHRVRTX1RFWFRVUkUnIDogJycsCgkJCSggcGFyYW1ldGVycy5tb3JwaFRhcmdldHNDb3VudCA+IDAgJiYgcGFyYW1ldGVycy5pc1dlYkdMMiApID8gJyNkZWZpbmUgTU9SUEhUQVJHRVRTX1RFWFRVUkVfU1RSSURFICcgKyBwYXJhbWV0ZXJzLm1vcnBoVGV4dHVyZVN0cmlkZSA6ICcnLAoJCQkoIHBhcmFtZXRlcnMubW9ycGhUYXJnZXRzQ291bnQgPiAwICYmIHBhcmFtZXRlcnMuaXNXZWJHTDIgKSA/ICcjZGVmaW5lIE1PUlBIVEFSR0VUU19DT1VOVCAnICsgcGFyYW1ldGVycy5tb3JwaFRhcmdldHNDb3VudCA6ICcnLAoJCQlwYXJhbWV0ZXJzLmRvdWJsZVNpZGVkID8gJyNkZWZpbmUgRE9VQkxFX1NJREVEJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLmZsaXBTaWRlZCA/ICcjZGVmaW5lIEZMSVBfU0lERUQnIDogJycsCgoJCQlwYXJhbWV0ZXJzLnNoYWRvd01hcEVuYWJsZWQgPyAnI2RlZmluZSBVU0VfU0hBRE9XTUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLnNoYWRvd01hcEVuYWJsZWQgPyAnI2RlZmluZSAnICsgc2hhZG93TWFwVHlwZURlZmluZSA6ICcnLAoKCQkJcGFyYW1ldGVycy5zaXplQXR0ZW51YXRpb24gPyAnI2RlZmluZSBVU0VfU0laRUFUVEVOVUFUSU9OJyA6ICcnLAoKCQkJcGFyYW1ldGVycy5udW1MaWdodFByb2JlcyA+IDAgPyAnI2RlZmluZSBVU0VfTElHSFRfUFJPQkVTJyA6ICcnLAoKCQkJcGFyYW1ldGVycy51c2VMZWdhY3lMaWdodHMgPyAnI2RlZmluZSBMRUdBQ1lfTElHSFRTJyA6ICcnLAoKCQkJcGFyYW1ldGVycy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyID8gJyNkZWZpbmUgVVNFX0xPR0RFUFRIQlVGJyA6ICcnLAoJCQkoIHBhcmFtZXRlcnMubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciAmJiBwYXJhbWV0ZXJzLnJlbmRlcmVyRXh0ZW5zaW9uRnJhZ0RlcHRoICkgPyAnI2RlZmluZSBVU0VfTE9HREVQVEhCVUZfRVhUJyA6ICcnLAoKCQkJJ3VuaWZvcm0gbWF0NCBtb2RlbE1hdHJpeDsnLAoJCQkndW5pZm9ybSBtYXQ0IG1vZGVsVmlld01hdHJpeDsnLAoJCQkndW5pZm9ybSBtYXQ0IHByb2plY3Rpb25NYXRyaXg7JywKCQkJJ3VuaWZvcm0gbWF0NCB2aWV3TWF0cml4OycsCgkJCSd1bmlmb3JtIG1hdDMgbm9ybWFsTWF0cml4OycsCgkJCSd1bmlmb3JtIHZlYzMgY2FtZXJhUG9zaXRpb247JywKCQkJJ3VuaWZvcm0gYm9vbCBpc09ydGhvZ3JhcGhpYzsnLAoKCQkJJyNpZmRlZiBVU0VfSU5TVEFOQ0lORycsCgoJCQknCWF0dHJpYnV0ZSBtYXQ0IGluc3RhbmNlTWF0cml4OycsCgoJCQknI2VuZGlmJywKCgkJCScjaWZkZWYgVVNFX0lOU1RBTkNJTkdfQ09MT1InLAoKCQkJJwlhdHRyaWJ1dGUgdmVjMyBpbnN0YW5jZUNvbG9yOycsCgoJCQknI2VuZGlmJywKCgkJCSdhdHRyaWJ1dGUgdmVjMyBwb3NpdGlvbjsnLAoJCQknYXR0cmlidXRlIHZlYzMgbm9ybWFsOycsCgkJCSdhdHRyaWJ1dGUgdmVjMiB1djsnLAoKCQkJJyNpZmRlZiBVU0VfVVYxJywKCgkJCScJYXR0cmlidXRlIHZlYzIgdXYxOycsCgoJCQknI2VuZGlmJywKCgkJCScjaWZkZWYgVVNFX1VWMicsCgoJCQknCWF0dHJpYnV0ZSB2ZWMyIHV2MjsnLAoKCQkJJyNlbmRpZicsCgoJCQknI2lmZGVmIFVTRV9VVjMnLAoKCQkJJwlhdHRyaWJ1dGUgdmVjMiB1djM7JywKCgkJCScjZW5kaWYnLAoKCQkJJyNpZmRlZiBVU0VfVEFOR0VOVCcsCgoJCQknCWF0dHJpYnV0ZSB2ZWM0IHRhbmdlbnQ7JywKCgkJCScjZW5kaWYnLAoKCQkJJyNpZiBkZWZpbmVkKCBVU0VfQ09MT1JfQUxQSEEgKScsCgoJCQknCWF0dHJpYnV0ZSB2ZWM0IGNvbG9yOycsCgoJCQknI2VsaWYgZGVmaW5lZCggVVNFX0NPTE9SICknLAoKCQkJJwlhdHRyaWJ1dGUgdmVjMyBjb2xvcjsnLAoKCQkJJyNlbmRpZicsCgoJCQknI2lmICggZGVmaW5lZCggVVNFX01PUlBIVEFSR0VUUyApICYmICEgZGVmaW5lZCggTU9SUEhUQVJHRVRTX1RFWFRVUkUgKSApJywKCgkJCScJYXR0cmlidXRlIHZlYzMgbW9ycGhUYXJnZXQwOycsCgkJCScJYXR0cmlidXRlIHZlYzMgbW9ycGhUYXJnZXQxOycsCgkJCScJYXR0cmlidXRlIHZlYzMgbW9ycGhUYXJnZXQyOycsCgkJCScJYXR0cmlidXRlIHZlYzMgbW9ycGhUYXJnZXQzOycsCgoJCQknCSNpZmRlZiBVU0VfTU9SUEhOT1JNQUxTJywKCgkJCScJCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoTm9ybWFsMDsnLAoJCQknCQlhdHRyaWJ1dGUgdmVjMyBtb3JwaE5vcm1hbDE7JywKCQkJJwkJYXR0cmlidXRlIHZlYzMgbW9ycGhOb3JtYWwyOycsCgkJCScJCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoTm9ybWFsMzsnLAoKCQkJJwkjZWxzZScsCgoJCQknCQlhdHRyaWJ1dGUgdmVjMyBtb3JwaFRhcmdldDQ7JywKCQkJJwkJYXR0cmlidXRlIHZlYzMgbW9ycGhUYXJnZXQ1OycsCgkJCScJCWF0dHJpYnV0ZSB2ZWMzIG1vcnBoVGFyZ2V0NjsnLAoJCQknCQlhdHRyaWJ1dGUgdmVjMyBtb3JwaFRhcmdldDc7JywKCgkJCScJI2VuZGlmJywKCgkJCScjZW5kaWYnLAoKCQkJJyNpZmRlZiBVU0VfU0tJTk5JTkcnLAoKCQkJJwlhdHRyaWJ1dGUgdmVjNCBza2luSW5kZXg7JywKCQkJJwlhdHRyaWJ1dGUgdmVjNCBza2luV2VpZ2h0OycsCgoJCQknI2VuZGlmJywKCgkJCSdcbicKCgkJXS5maWx0ZXIoIGZpbHRlckVtcHR5TGluZSApLmpvaW4oICdcbicgKTsKCgkJcHJlZml4RnJhZ21lbnQgPSBbCgoJCQljdXN0b21FeHRlbnNpb25zLAoKCQkJZ2VuZXJhdGVQcmVjaXNpb24oIHBhcmFtZXRlcnMgKSwKCgkJCScjZGVmaW5lIFNIQURFUl9UWVBFICcgKyBwYXJhbWV0ZXJzLnNoYWRlclR5cGUsCgkJCScjZGVmaW5lIFNIQURFUl9OQU1FICcgKyBwYXJhbWV0ZXJzLnNoYWRlck5hbWUsCgoJCQljdXN0b21EZWZpbmVzLAoKCQkJcGFyYW1ldGVycy51c2VGb2cgJiYgcGFyYW1ldGVycy5mb2cgPyAnI2RlZmluZSBVU0VfRk9HJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLnVzZUZvZyAmJiBwYXJhbWV0ZXJzLmZvZ0V4cDIgPyAnI2RlZmluZSBGT0dfRVhQMicgOiAnJywKCgkJCXBhcmFtZXRlcnMubWFwID8gJyNkZWZpbmUgVVNFX01BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5tYXRjYXAgPyAnI2RlZmluZSBVU0VfTUFUQ0FQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLmVudk1hcCA/ICcjZGVmaW5lIFVTRV9FTlZNQVAnIDogJycsCgkJCXBhcmFtZXRlcnMuZW52TWFwID8gJyNkZWZpbmUgJyArIGVudk1hcFR5cGVEZWZpbmUgOiAnJywKCQkJcGFyYW1ldGVycy5lbnZNYXAgPyAnI2RlZmluZSAnICsgZW52TWFwTW9kZURlZmluZSA6ICcnLAoJCQlwYXJhbWV0ZXJzLmVudk1hcCA/ICcjZGVmaW5lICcgKyBlbnZNYXBCbGVuZGluZ0RlZmluZSA6ICcnLAoJCQllbnZNYXBDdWJlVVZTaXplID8gJyNkZWZpbmUgQ1VCRVVWX1RFWEVMX1dJRFRIICcgKyBlbnZNYXBDdWJlVVZTaXplLnRleGVsV2lkdGggOiAnJywKCQkJZW52TWFwQ3ViZVVWU2l6ZSA/ICcjZGVmaW5lIENVQkVVVl9URVhFTF9IRUlHSFQgJyArIGVudk1hcEN1YmVVVlNpemUudGV4ZWxIZWlnaHQgOiAnJywKCQkJZW52TWFwQ3ViZVVWU2l6ZSA/ICcjZGVmaW5lIENVQkVVVl9NQVhfTUlQICcgKyBlbnZNYXBDdWJlVVZTaXplLm1heE1pcCArICcuMCcgOiAnJywKCQkJcGFyYW1ldGVycy5saWdodE1hcCA/ICcjZGVmaW5lIFVTRV9MSUdIVE1BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5hb01hcCA/ICcjZGVmaW5lIFVTRV9BT01BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5idW1wTWFwID8gJyNkZWZpbmUgVVNFX0JVTVBNQVAnIDogJycsCgkJCXBhcmFtZXRlcnMubm9ybWFsTWFwID8gJyNkZWZpbmUgVVNFX05PUk1BTE1BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5ub3JtYWxNYXBPYmplY3RTcGFjZSA/ICcjZGVmaW5lIFVTRV9OT1JNQUxNQVBfT0JKRUNUU1BBQ0UnIDogJycsCgkJCXBhcmFtZXRlcnMubm9ybWFsTWFwVGFuZ2VudFNwYWNlID8gJyNkZWZpbmUgVVNFX05PUk1BTE1BUF9UQU5HRU5UU1BBQ0UnIDogJycsCgkJCXBhcmFtZXRlcnMuZW1pc3NpdmVNYXAgPyAnI2RlZmluZSBVU0VfRU1JU1NJVkVNQVAnIDogJycsCgoJCQlwYXJhbWV0ZXJzLmFuaXNvdHJvcHkgPyAnI2RlZmluZSBVU0VfQU5JU09UUk9QWScgOiAnJywKCQkJcGFyYW1ldGVycy5hbmlzb3Ryb3B5TWFwID8gJyNkZWZpbmUgVVNFX0FOSVNPVFJPUFlNQVAnIDogJycsCgoJCQlwYXJhbWV0ZXJzLmNsZWFyY29hdCA/ICcjZGVmaW5lIFVTRV9DTEVBUkNPQVQnIDogJycsCgkJCXBhcmFtZXRlcnMuY2xlYXJjb2F0TWFwID8gJyNkZWZpbmUgVVNFX0NMRUFSQ09BVE1BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5jbGVhcmNvYXRSb3VnaG5lc3NNYXAgPyAnI2RlZmluZSBVU0VfQ0xFQVJDT0FUX1JPVUdITkVTU01BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5jbGVhcmNvYXROb3JtYWxNYXAgPyAnI2RlZmluZSBVU0VfQ0xFQVJDT0FUX05PUk1BTE1BUCcgOiAnJywKCgkJCXBhcmFtZXRlcnMuaXJpZGVzY2VuY2UgPyAnI2RlZmluZSBVU0VfSVJJREVTQ0VOQ0UnIDogJycsCgkJCXBhcmFtZXRlcnMuaXJpZGVzY2VuY2VNYXAgPyAnI2RlZmluZSBVU0VfSVJJREVTQ0VOQ0VNQVAnIDogJycsCgkJCXBhcmFtZXRlcnMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAgPyAnI2RlZmluZSBVU0VfSVJJREVTQ0VOQ0VfVEhJQ0tORVNTTUFQJyA6ICcnLAoKCQkJcGFyYW1ldGVycy5zcGVjdWxhck1hcCA/ICcjZGVmaW5lIFVTRV9TUEVDVUxBUk1BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5zcGVjdWxhckNvbG9yTWFwID8gJyNkZWZpbmUgVVNFX1NQRUNVTEFSX0NPTE9STUFQJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLnNwZWN1bGFySW50ZW5zaXR5TWFwID8gJyNkZWZpbmUgVVNFX1NQRUNVTEFSX0lOVEVOU0lUWU1BUCcgOiAnJywKCgkJCXBhcmFtZXRlcnMucm91Z2huZXNzTWFwID8gJyNkZWZpbmUgVVNFX1JPVUdITkVTU01BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5tZXRhbG5lc3NNYXAgPyAnI2RlZmluZSBVU0VfTUVUQUxORVNTTUFQJyA6ICcnLAoKCQkJcGFyYW1ldGVycy5hbHBoYU1hcCA/ICcjZGVmaW5lIFVTRV9BTFBIQU1BUCcgOiAnJywKCQkJcGFyYW1ldGVycy5hbHBoYVRlc3QgPyAnI2RlZmluZSBVU0VfQUxQSEFURVNUJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLmFscGhhSGFzaCA/ICcjZGVmaW5lIFVTRV9BTFBIQUhBU0gnIDogJycsCgoJCQlwYXJhbWV0ZXJzLnNoZWVuID8gJyNkZWZpbmUgVVNFX1NIRUVOJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLnNoZWVuQ29sb3JNYXAgPyAnI2RlZmluZSBVU0VfU0hFRU5fQ09MT1JNQVAnIDogJycsCgkJCXBhcmFtZXRlcnMuc2hlZW5Sb3VnaG5lc3NNYXAgPyAnI2RlZmluZSBVU0VfU0hFRU5fUk9VR0hORVNTTUFQJyA6ICcnLAoKCQkJcGFyYW1ldGVycy50cmFuc21pc3Npb24gPyAnI2RlZmluZSBVU0VfVFJBTlNNSVNTSU9OJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLnRyYW5zbWlzc2lvbk1hcCA/ICcjZGVmaW5lIFVTRV9UUkFOU01JU1NJT05NQVAnIDogJycsCgkJCXBhcmFtZXRlcnMudGhpY2tuZXNzTWFwID8gJyNkZWZpbmUgVVNFX1RISUNLTkVTU01BUCcgOiAnJywKCgkJCXBhcmFtZXRlcnMudmVydGV4VGFuZ2VudHMgJiYgcGFyYW1ldGVycy5mbGF0U2hhZGluZyA9PT0gZmFsc2UgPyAnI2RlZmluZSBVU0VfVEFOR0VOVCcgOiAnJywKCQkJcGFyYW1ldGVycy52ZXJ0ZXhDb2xvcnMgfHwgcGFyYW1ldGVycy5pbnN0YW5jaW5nQ29sb3IgPyAnI2RlZmluZSBVU0VfQ09MT1InIDogJycsCgkJCXBhcmFtZXRlcnMudmVydGV4QWxwaGFzID8gJyNkZWZpbmUgVVNFX0NPTE9SX0FMUEhBJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLnZlcnRleFV2MXMgPyAnI2RlZmluZSBVU0VfVVYxJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLnZlcnRleFV2MnMgPyAnI2RlZmluZSBVU0VfVVYyJyA6ICcnLAoJCQlwYXJhbWV0ZXJzLnZlcnRleFV2M3MgPyAnI2RlZmluZSBVU0VfVVYzJyA6ICcnLAoKCQkJcGFyYW1ldGVycy5wb2ludHNVdnMgPyAnI2RlZmluZSBVU0VfUE9JTlRTX1VWJyA6ICcnLAoKCQkJcGFyYW1ldGVycy5ncmFkaWVudE1hcCA/ICcjZGVmaW5lIFVTRV9HUkFESUVOVE1BUCcgOiAnJywKCgkJCXBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgPyAnI2RlZmluZSBGTEFUX1NIQURFRCcgOiAnJywKCgkJCXBhcmFtZXRlcnMuZG91YmxlU2lkZWQgPyAnI2RlZmluZSBET1VCTEVfU0lERUQnIDogJycsCgkJCXBhcmFtZXRlcnMuZmxpcFNpZGVkID8gJyNkZWZpbmUgRkxJUF9TSURFRCcgOiAnJywKCgkJCXBhcmFtZXRlcnMuc2hhZG93TWFwRW5hYmxlZCA/ICcjZGVmaW5lIFVTRV9TSEFET1dNQVAnIDogJycsCgkJCXBhcmFtZXRlcnMuc2hhZG93TWFwRW5hYmxlZCA/ICcjZGVmaW5lICcgKyBzaGFkb3dNYXBUeXBlRGVmaW5lIDogJycsCgoJCQlwYXJhbWV0ZXJzLnByZW11bHRpcGxpZWRBbHBoYSA/ICcjZGVmaW5lIFBSRU1VTFRJUExJRURfQUxQSEEnIDogJycsCgoJCQlwYXJhbWV0ZXJzLm51bUxpZ2h0UHJvYmVzID4gMCA/ICcjZGVmaW5lIFVTRV9MSUdIVF9QUk9CRVMnIDogJycsCgoJCQlwYXJhbWV0ZXJzLnVzZUxlZ2FjeUxpZ2h0cyA/ICcjZGVmaW5lIExFR0FDWV9MSUdIVFMnIDogJycsCgoJCQlwYXJhbWV0ZXJzLmRlY29kZVZpZGVvVGV4dHVyZSA/ICcjZGVmaW5lIERFQ09ERV9WSURFT19URVhUVVJFJyA6ICcnLAoKCQkJcGFyYW1ldGVycy5sb2dhcml0aG1pY0RlcHRoQnVmZmVyID8gJyNkZWZpbmUgVVNFX0xPR0RFUFRIQlVGJyA6ICcnLAoJCQkoIHBhcmFtZXRlcnMubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciAmJiBwYXJhbWV0ZXJzLnJlbmRlcmVyRXh0ZW5zaW9uRnJhZ0RlcHRoICkgPyAnI2RlZmluZSBVU0VfTE9HREVQVEhCVUZfRVhUJyA6ICcnLAoKCQkJJ3VuaWZvcm0gbWF0NCB2aWV3TWF0cml4OycsCgkJCSd1bmlmb3JtIHZlYzMgY2FtZXJhUG9zaXRpb247JywKCQkJJ3VuaWZvcm0gYm9vbCBpc09ydGhvZ3JhcGhpYzsnLAoKCQkJKCBwYXJhbWV0ZXJzLnRvbmVNYXBwaW5nICE9PSBOb1RvbmVNYXBwaW5nICkgPyAnI2RlZmluZSBUT05FX01BUFBJTkcnIDogJycsCgkJCSggcGFyYW1ldGVycy50b25lTWFwcGluZyAhPT0gTm9Ub25lTWFwcGluZyApID8gU2hhZGVyQ2h1bmtbICd0b25lbWFwcGluZ19wYXJzX2ZyYWdtZW50JyBdIDogJycsIC8vIHRoaXMgY29kZSBpcyByZXF1aXJlZCBoZXJlIGJlY2F1c2UgaXQgaXMgdXNlZCBieSB0aGUgdG9uZU1hcHBpbmcoKSBmdW5jdGlvbiBkZWZpbmVkIGJlbG93CgkJCSggcGFyYW1ldGVycy50b25lTWFwcGluZyAhPT0gTm9Ub25lTWFwcGluZyApID8gZ2V0VG9uZU1hcHBpbmdGdW5jdGlvbiggJ3RvbmVNYXBwaW5nJywgcGFyYW1ldGVycy50b25lTWFwcGluZyApIDogJycsCgoJCQlwYXJhbWV0ZXJzLmRpdGhlcmluZyA/ICcjZGVmaW5lIERJVEhFUklORycgOiAnJywKCQkJcGFyYW1ldGVycy5vcGFxdWUgPyAnI2RlZmluZSBPUEFRVUUnIDogJycsCgoJCQlTaGFkZXJDaHVua1sgJ2NvbG9yc3BhY2VfcGFyc19mcmFnbWVudCcgXSwgLy8gdGhpcyBjb2RlIGlzIHJlcXVpcmVkIGhlcmUgYmVjYXVzZSBpdCBpcyB1c2VkIGJ5IHRoZSB2YXJpb3VzIGVuY29kaW5nL2RlY29kaW5nIGZ1bmN0aW9uIGRlZmluZWQgYmVsb3cKCQkJZ2V0VGV4ZWxFbmNvZGluZ0Z1bmN0aW9uKCAnbGluZWFyVG9PdXRwdXRUZXhlbCcsIHBhcmFtZXRlcnMub3V0cHV0Q29sb3JTcGFjZSApLAoKCQkJcGFyYW1ldGVycy51c2VEZXB0aFBhY2tpbmcgPyAnI2RlZmluZSBERVBUSF9QQUNLSU5HICcgKyBwYXJhbWV0ZXJzLmRlcHRoUGFja2luZyA6ICcnLAoKCQkJJ1xuJwoKCQldLmZpbHRlciggZmlsdGVyRW1wdHlMaW5lICkuam9pbiggJ1xuJyApOwoKCX0KCgl2ZXJ0ZXhTaGFkZXIgPSByZXNvbHZlSW5jbHVkZXMoIHZlcnRleFNoYWRlciApOwoJdmVydGV4U2hhZGVyID0gcmVwbGFjZUxpZ2h0TnVtcyggdmVydGV4U2hhZGVyLCBwYXJhbWV0ZXJzICk7Cgl2ZXJ0ZXhTaGFkZXIgPSByZXBsYWNlQ2xpcHBpbmdQbGFuZU51bXMoIHZlcnRleFNoYWRlciwgcGFyYW1ldGVycyApOwoKCWZyYWdtZW50U2hhZGVyID0gcmVzb2x2ZUluY2x1ZGVzKCBmcmFnbWVudFNoYWRlciApOwoJZnJhZ21lbnRTaGFkZXIgPSByZXBsYWNlTGlnaHROdW1zKCBmcmFnbWVudFNoYWRlciwgcGFyYW1ldGVycyApOwoJZnJhZ21lbnRTaGFkZXIgPSByZXBsYWNlQ2xpcHBpbmdQbGFuZU51bXMoIGZyYWdtZW50U2hhZGVyLCBwYXJhbWV0ZXJzICk7CgoJdmVydGV4U2hhZGVyID0gdW5yb2xsTG9vcHMoIHZlcnRleFNoYWRlciApOwoJZnJhZ21lbnRTaGFkZXIgPSB1bnJvbGxMb29wcyggZnJhZ21lbnRTaGFkZXIgKTsKCglpZiAoIHBhcmFtZXRlcnMuaXNXZWJHTDIgJiYgcGFyYW1ldGVycy5pc1Jhd1NoYWRlck1hdGVyaWFsICE9PSB0cnVlICkgewoKCQkvLyBHTFNMIDMuMCBjb252ZXJzaW9uIGZvciBidWlsdC1pbiBtYXRlcmlhbHMgYW5kIFNoYWRlck1hdGVyaWFsCgoJCXZlcnNpb25TdHJpbmcgPSAnI3ZlcnNpb24gMzAwIGVzXG4nOwoKCQlwcmVmaXhWZXJ0ZXggPSBbCgkJCSdwcmVjaXNpb24gbWVkaXVtcCBzYW1wbGVyMkRBcnJheTsnLAoJCQknI2RlZmluZSBhdHRyaWJ1dGUgaW4nLAoJCQknI2RlZmluZSB2YXJ5aW5nIG91dCcsCgkJCScjZGVmaW5lIHRleHR1cmUyRCB0ZXh0dXJlJwoJCV0uam9pbiggJ1xuJyApICsgJ1xuJyArIHByZWZpeFZlcnRleDsKCgkJcHJlZml4RnJhZ21lbnQgPSBbCgkJCScjZGVmaW5lIHZhcnlpbmcgaW4nLAoJCQkoIHBhcmFtZXRlcnMuZ2xzbFZlcnNpb24gPT09IEdMU0wzICkgPyAnJyA6ICdsYXlvdXQobG9jYXRpb24gPSAwKSBvdXQgaGlnaHAgdmVjNCBwY19mcmFnQ29sb3I7JywKCQkJKCBwYXJhbWV0ZXJzLmdsc2xWZXJzaW9uID09PSBHTFNMMyApID8gJycgOiAnI2RlZmluZSBnbF9GcmFnQ29sb3IgcGNfZnJhZ0NvbG9yJywKCQkJJyNkZWZpbmUgZ2xfRnJhZ0RlcHRoRVhUIGdsX0ZyYWdEZXB0aCcsCgkJCScjZGVmaW5lIHRleHR1cmUyRCB0ZXh0dXJlJywKCQkJJyNkZWZpbmUgdGV4dHVyZUN1YmUgdGV4dHVyZScsCgkJCScjZGVmaW5lIHRleHR1cmUyRFByb2ogdGV4dHVyZVByb2onLAoJCQknI2RlZmluZSB0ZXh0dXJlMkRMb2RFWFQgdGV4dHVyZUxvZCcsCgkJCScjZGVmaW5lIHRleHR1cmUyRFByb2pMb2RFWFQgdGV4dHVyZVByb2pMb2QnLAoJCQknI2RlZmluZSB0ZXh0dXJlQ3ViZUxvZEVYVCB0ZXh0dXJlTG9kJywKCQkJJyNkZWZpbmUgdGV4dHVyZTJER3JhZEVYVCB0ZXh0dXJlR3JhZCcsCgkJCScjZGVmaW5lIHRleHR1cmUyRFByb2pHcmFkRVhUIHRleHR1cmVQcm9qR3JhZCcsCgkJCScjZGVmaW5lIHRleHR1cmVDdWJlR3JhZEVYVCB0ZXh0dXJlR3JhZCcKCQldLmpvaW4oICdcbicgKSArICdcbicgKyBwcmVmaXhGcmFnbWVudDsKCgl9CgoJY29uc3QgdmVydGV4R2xzbCA9IHZlcnNpb25TdHJpbmcgKyBwcmVmaXhWZXJ0ZXggKyB2ZXJ0ZXhTaGFkZXI7Cgljb25zdCBmcmFnbWVudEdsc2wgPSB2ZXJzaW9uU3RyaW5nICsgcHJlZml4RnJhZ21lbnQgKyBmcmFnbWVudFNoYWRlcjsKCgkvLyBjb25zb2xlLmxvZyggJypWRVJURVgqJywgdmVydGV4R2xzbCApOwoJLy8gY29uc29sZS5sb2coICcqRlJBR01FTlQqJywgZnJhZ21lbnRHbHNsICk7CgoJY29uc3QgZ2xWZXJ0ZXhTaGFkZXIgPSBXZWJHTFNoYWRlciggZ2wsIGdsLlZFUlRFWF9TSEFERVIsIHZlcnRleEdsc2wgKTsKCWNvbnN0IGdsRnJhZ21lbnRTaGFkZXIgPSBXZWJHTFNoYWRlciggZ2wsIGdsLkZSQUdNRU5UX1NIQURFUiwgZnJhZ21lbnRHbHNsICk7CgoJZ2wuYXR0YWNoU2hhZGVyKCBwcm9ncmFtLCBnbFZlcnRleFNoYWRlciApOwoJZ2wuYXR0YWNoU2hhZGVyKCBwcm9ncmFtLCBnbEZyYWdtZW50U2hhZGVyICk7CgoJLy8gRm9yY2UgYSBwYXJ0aWN1bGFyIGF0dHJpYnV0ZSB0byBpbmRleCAwLgoKCWlmICggcGFyYW1ldGVycy5pbmRleDBBdHRyaWJ1dGVOYW1lICE9PSB1bmRlZmluZWQgKSB7CgoJCWdsLmJpbmRBdHRyaWJMb2NhdGlvbiggcHJvZ3JhbSwgMCwgcGFyYW1ldGVycy5pbmRleDBBdHRyaWJ1dGVOYW1lICk7CgoJfSBlbHNlIGlmICggcGFyYW1ldGVycy5tb3JwaFRhcmdldHMgPT09IHRydWUgKSB7CgoJCS8vIHByb2dyYW1zIHdpdGggbW9ycGhUYXJnZXRzIGRpc3BsYWNlIHBvc2l0aW9uIG91dCBvZiBhdHRyaWJ1dGUgMAoJCWdsLmJpbmRBdHRyaWJMb2NhdGlvbiggcHJvZ3JhbSwgMCwgJ3Bvc2l0aW9uJyApOwoKCX0KCglnbC5saW5rUHJvZ3JhbSggcHJvZ3JhbSApOwoKCS8vIGNoZWNrIGZvciBsaW5rIGVycm9ycwoJaWYgKCByZW5kZXJlci5kZWJ1Zy5jaGVja1NoYWRlckVycm9ycyApIHsKCgkJY29uc3QgcHJvZ3JhbUxvZyA9IGdsLmdldFByb2dyYW1JbmZvTG9nKCBwcm9ncmFtICkudHJpbSgpOwoJCWNvbnN0IHZlcnRleExvZyA9IGdsLmdldFNoYWRlckluZm9Mb2coIGdsVmVydGV4U2hhZGVyICkudHJpbSgpOwoJCWNvbnN0IGZyYWdtZW50TG9nID0gZ2wuZ2V0U2hhZGVySW5mb0xvZyggZ2xGcmFnbWVudFNoYWRlciApLnRyaW0oKTsKCgkJbGV0IHJ1bm5hYmxlID0gdHJ1ZTsKCQlsZXQgaGF2ZURpYWdub3N0aWNzID0gdHJ1ZTsKCgkJaWYgKCBnbC5nZXRQcm9ncmFtUGFyYW1ldGVyKCBwcm9ncmFtLCBnbC5MSU5LX1NUQVRVUyApID09PSBmYWxzZSApIHsKCgkJCXJ1bm5hYmxlID0gZmFsc2U7CgoJCQlpZiAoIHR5cGVvZiByZW5kZXJlci5kZWJ1Zy5vblNoYWRlckVycm9yID09PSAnZnVuY3Rpb24nICkgewoKCQkJCXJlbmRlcmVyLmRlYnVnLm9uU2hhZGVyRXJyb3IoIGdsLCBwcm9ncmFtLCBnbFZlcnRleFNoYWRlciwgZ2xGcmFnbWVudFNoYWRlciApOwoKCQkJfSBlbHNlIHsKCgkJCQkvLyBkZWZhdWx0IGVycm9yIHJlcG9ydGluZwoKCQkJCWNvbnN0IHZlcnRleEVycm9ycyA9IGdldFNoYWRlckVycm9ycyggZ2wsIGdsVmVydGV4U2hhZGVyLCAndmVydGV4JyApOwoJCQkJY29uc3QgZnJhZ21lbnRFcnJvcnMgPSBnZXRTaGFkZXJFcnJvcnMoIGdsLCBnbEZyYWdtZW50U2hhZGVyLCAnZnJhZ21lbnQnICk7CgoJCQkJY29uc29sZS5lcnJvcigKCQkJCQknVEhSRUUuV2ViR0xQcm9ncmFtOiBTaGFkZXIgRXJyb3IgJyArIGdsLmdldEVycm9yKCkgKyAnIC0gJyArCgkJCQkJJ1ZBTElEQVRFX1NUQVRVUyAnICsgZ2wuZ2V0UHJvZ3JhbVBhcmFtZXRlciggcHJvZ3JhbSwgZ2wuVkFMSURBVEVfU1RBVFVTICkgKyAnXG5cbicgKwoJCQkJCSdQcm9ncmFtIEluZm8gTG9nOiAnICsgcHJvZ3JhbUxvZyArICdcbicgKwoJCQkJCXZlcnRleEVycm9ycyArICdcbicgKwoJCQkJCWZyYWdtZW50RXJyb3JzCgkJCQkpOwoKCQkJfQoKCQl9IGVsc2UgaWYgKCBwcm9ncmFtTG9nICE9PSAnJyApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUHJvZ3JhbTogUHJvZ3JhbSBJbmZvIExvZzonLCBwcm9ncmFtTG9nICk7CgoJCX0gZWxzZSBpZiAoIHZlcnRleExvZyA9PT0gJycgfHwgZnJhZ21lbnRMb2cgPT09ICcnICkgewoKCQkJaGF2ZURpYWdub3N0aWNzID0gZmFsc2U7CgoJCX0KCgkJaWYgKCBoYXZlRGlhZ25vc3RpY3MgKSB7CgoJCQl0aGlzLmRpYWdub3N0aWNzID0gewoKCQkJCXJ1bm5hYmxlOiBydW5uYWJsZSwKCgkJCQlwcm9ncmFtTG9nOiBwcm9ncmFtTG9nLAoKCQkJCXZlcnRleFNoYWRlcjogewoKCQkJCQlsb2c6IHZlcnRleExvZywKCQkJCQlwcmVmaXg6IHByZWZpeFZlcnRleAoKCQkJCX0sCgoJCQkJZnJhZ21lbnRTaGFkZXI6IHsKCgkJCQkJbG9nOiBmcmFnbWVudExvZywKCQkJCQlwcmVmaXg6IHByZWZpeEZyYWdtZW50CgoJCQkJfQoKCQkJfTsKCgkJfQoKCX0KCgkvLyBDbGVhbiB1cAoKCS8vIENyYXNoZXMgaW4gaU9TOSBhbmQgaU9TMTAuICMxODQwMgoJLy8gZ2wuZGV0YWNoU2hhZGVyKCBwcm9ncmFtLCBnbFZlcnRleFNoYWRlciApOwoJLy8gZ2wuZGV0YWNoU2hhZGVyKCBwcm9ncmFtLCBnbEZyYWdtZW50U2hhZGVyICk7CgoJZ2wuZGVsZXRlU2hhZGVyKCBnbFZlcnRleFNoYWRlciApOwoJZ2wuZGVsZXRlU2hhZGVyKCBnbEZyYWdtZW50U2hhZGVyICk7CgoJLy8gc2V0IHVwIGNhY2hpbmcgZm9yIHVuaWZvcm0gbG9jYXRpb25zCgoJbGV0IGNhY2hlZFVuaWZvcm1zOwoKCXRoaXMuZ2V0VW5pZm9ybXMgPSBmdW5jdGlvbiAoKSB7CgoJCWlmICggY2FjaGVkVW5pZm9ybXMgPT09IHVuZGVmaW5lZCApIHsKCgkJCWNhY2hlZFVuaWZvcm1zID0gbmV3IFdlYkdMVW5pZm9ybXMoIGdsLCBwcm9ncmFtICk7CgoJCX0KCgkJcmV0dXJuIGNhY2hlZFVuaWZvcm1zOwoKCX07CgoJLy8gc2V0IHVwIGNhY2hpbmcgZm9yIGF0dHJpYnV0ZSBsb2NhdGlvbnMKCglsZXQgY2FjaGVkQXR0cmlidXRlczsKCgl0aGlzLmdldEF0dHJpYnV0ZXMgPSBmdW5jdGlvbiAoKSB7CgoJCWlmICggY2FjaGVkQXR0cmlidXRlcyA9PT0gdW5kZWZpbmVkICkgewoKCQkJY2FjaGVkQXR0cmlidXRlcyA9IGZldGNoQXR0cmlidXRlTG9jYXRpb25zKCBnbCwgcHJvZ3JhbSApOwoKCQl9CgoJCXJldHVybiBjYWNoZWRBdHRyaWJ1dGVzOwoKCX07CgoJLy8gZnJlZSByZXNvdXJjZQoKCXRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uICgpIHsKCgkJYmluZGluZ1N0YXRlcy5yZWxlYXNlU3RhdGVzT2ZQcm9ncmFtKCB0aGlzICk7CgoJCWdsLmRlbGV0ZVByb2dyYW0oIHByb2dyYW0gKTsKCQl0aGlzLnByb2dyYW0gPSB1bmRlZmluZWQ7CgoJfTsKCgkvLwoKCXRoaXMudHlwZSA9IHBhcmFtZXRlcnMuc2hhZGVyVHlwZTsKCXRoaXMubmFtZSA9IHBhcmFtZXRlcnMuc2hhZGVyTmFtZTsKCXRoaXMuaWQgPSBwcm9ncmFtSWRDb3VudCArKzsKCXRoaXMuY2FjaGVLZXkgPSBjYWNoZUtleTsKCXRoaXMudXNlZFRpbWVzID0gMTsKCXRoaXMucHJvZ3JhbSA9IHByb2dyYW07Cgl0aGlzLnZlcnRleFNoYWRlciA9IGdsVmVydGV4U2hhZGVyOwoJdGhpcy5mcmFnbWVudFNoYWRlciA9IGdsRnJhZ21lbnRTaGFkZXI7CgoJcmV0dXJuIHRoaXM7Cgp9CgpsZXQgX2lkJDEgPSAwOwoKY2xhc3MgV2ViR0xTaGFkZXJDYWNoZSB7CgoJY29uc3RydWN0b3IoKSB7CgoJCXRoaXMuc2hhZGVyQ2FjaGUgPSBuZXcgTWFwKCk7CgkJdGhpcy5tYXRlcmlhbENhY2hlID0gbmV3IE1hcCgpOwoKCX0KCgl1cGRhdGUoIG1hdGVyaWFsICkgewoKCQljb25zdCB2ZXJ0ZXhTaGFkZXIgPSBtYXRlcmlhbC52ZXJ0ZXhTaGFkZXI7CgkJY29uc3QgZnJhZ21lbnRTaGFkZXIgPSBtYXRlcmlhbC5mcmFnbWVudFNoYWRlcjsKCgkJY29uc3QgdmVydGV4U2hhZGVyU3RhZ2UgPSB0aGlzLl9nZXRTaGFkZXJTdGFnZSggdmVydGV4U2hhZGVyICk7CgkJY29uc3QgZnJhZ21lbnRTaGFkZXJTdGFnZSA9IHRoaXMuX2dldFNoYWRlclN0YWdlKCBmcmFnbWVudFNoYWRlciApOwoKCQljb25zdCBtYXRlcmlhbFNoYWRlcnMgPSB0aGlzLl9nZXRTaGFkZXJDYWNoZUZvck1hdGVyaWFsKCBtYXRlcmlhbCApOwoKCQlpZiAoIG1hdGVyaWFsU2hhZGVycy5oYXMoIHZlcnRleFNoYWRlclN0YWdlICkgPT09IGZhbHNlICkgewoKCQkJbWF0ZXJpYWxTaGFkZXJzLmFkZCggdmVydGV4U2hhZGVyU3RhZ2UgKTsKCQkJdmVydGV4U2hhZGVyU3RhZ2UudXNlZFRpbWVzICsrOwoKCQl9CgoJCWlmICggbWF0ZXJpYWxTaGFkZXJzLmhhcyggZnJhZ21lbnRTaGFkZXJTdGFnZSApID09PSBmYWxzZSApIHsKCgkJCW1hdGVyaWFsU2hhZGVycy5hZGQoIGZyYWdtZW50U2hhZGVyU3RhZ2UgKTsKCQkJZnJhZ21lbnRTaGFkZXJTdGFnZS51c2VkVGltZXMgKys7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXJlbW92ZSggbWF0ZXJpYWwgKSB7CgoJCWNvbnN0IG1hdGVyaWFsU2hhZGVycyA9IHRoaXMubWF0ZXJpYWxDYWNoZS5nZXQoIG1hdGVyaWFsICk7CgoJCWZvciAoIGNvbnN0IHNoYWRlclN0YWdlIG9mIG1hdGVyaWFsU2hhZGVycyApIHsKCgkJCXNoYWRlclN0YWdlLnVzZWRUaW1lcyAtLTsKCgkJCWlmICggc2hhZGVyU3RhZ2UudXNlZFRpbWVzID09PSAwICkgdGhpcy5zaGFkZXJDYWNoZS5kZWxldGUoIHNoYWRlclN0YWdlLmNvZGUgKTsKCgkJfQoKCQl0aGlzLm1hdGVyaWFsQ2FjaGUuZGVsZXRlKCBtYXRlcmlhbCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0VmVydGV4U2hhZGVySUQoIG1hdGVyaWFsICkgewoKCQlyZXR1cm4gdGhpcy5fZ2V0U2hhZGVyU3RhZ2UoIG1hdGVyaWFsLnZlcnRleFNoYWRlciApLmlkOwoKCX0KCglnZXRGcmFnbWVudFNoYWRlcklEKCBtYXRlcmlhbCApIHsKCgkJcmV0dXJuIHRoaXMuX2dldFNoYWRlclN0YWdlKCBtYXRlcmlhbC5mcmFnbWVudFNoYWRlciApLmlkOwoKCX0KCglkaXNwb3NlKCkgewoKCQl0aGlzLnNoYWRlckNhY2hlLmNsZWFyKCk7CgkJdGhpcy5tYXRlcmlhbENhY2hlLmNsZWFyKCk7CgoJfQoKCV9nZXRTaGFkZXJDYWNoZUZvck1hdGVyaWFsKCBtYXRlcmlhbCApIHsKCgkJY29uc3QgY2FjaGUgPSB0aGlzLm1hdGVyaWFsQ2FjaGU7CgkJbGV0IHNldCA9IGNhY2hlLmdldCggbWF0ZXJpYWwgKTsKCgkJaWYgKCBzZXQgPT09IHVuZGVmaW5lZCApIHsKCgkJCXNldCA9IG5ldyBTZXQoKTsKCQkJY2FjaGUuc2V0KCBtYXRlcmlhbCwgc2V0ICk7CgoJCX0KCgkJcmV0dXJuIHNldDsKCgl9CgoJX2dldFNoYWRlclN0YWdlKCBjb2RlICkgewoKCQljb25zdCBjYWNoZSA9IHRoaXMuc2hhZGVyQ2FjaGU7CgkJbGV0IHN0YWdlID0gY2FjaGUuZ2V0KCBjb2RlICk7CgoJCWlmICggc3RhZ2UgPT09IHVuZGVmaW5lZCApIHsKCgkJCXN0YWdlID0gbmV3IFdlYkdMU2hhZGVyU3RhZ2UoIGNvZGUgKTsKCQkJY2FjaGUuc2V0KCBjb2RlLCBzdGFnZSApOwoKCQl9CgoJCXJldHVybiBzdGFnZTsKCgl9Cgp9CgpjbGFzcyBXZWJHTFNoYWRlclN0YWdlIHsKCgljb25zdHJ1Y3RvciggY29kZSApIHsKCgkJdGhpcy5pZCA9IF9pZCQxICsrOwoKCQl0aGlzLmNvZGUgPSBjb2RlOwoJCXRoaXMudXNlZFRpbWVzID0gMDsKCgl9Cgp9CgpmdW5jdGlvbiBXZWJHTFByb2dyYW1zKCByZW5kZXJlciwgY3ViZW1hcHMsIGN1YmV1dm1hcHMsIGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcywgYmluZGluZ1N0YXRlcywgY2xpcHBpbmcgKSB7CgoJY29uc3QgX3Byb2dyYW1MYXllcnMgPSBuZXcgTGF5ZXJzKCk7Cgljb25zdCBfY3VzdG9tU2hhZGVycyA9IG5ldyBXZWJHTFNoYWRlckNhY2hlKCk7Cgljb25zdCBwcm9ncmFtcyA9IFtdOwoKCWNvbnN0IElTX1dFQkdMMiA9IGNhcGFiaWxpdGllcy5pc1dlYkdMMjsKCWNvbnN0IGxvZ2FyaXRobWljRGVwdGhCdWZmZXIgPSBjYXBhYmlsaXRpZXMubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlcjsKCWNvbnN0IFNVUFBPUlRTX1ZFUlRFWF9URVhUVVJFUyA9IGNhcGFiaWxpdGllcy52ZXJ0ZXhUZXh0dXJlczsKCglsZXQgcHJlY2lzaW9uID0gY2FwYWJpbGl0aWVzLnByZWNpc2lvbjsKCgljb25zdCBzaGFkZXJJRHMgPSB7CgkJTWVzaERlcHRoTWF0ZXJpYWw6ICdkZXB0aCcsCgkJTWVzaERpc3RhbmNlTWF0ZXJpYWw6ICdkaXN0YW5jZVJHQkEnLAoJCU1lc2hOb3JtYWxNYXRlcmlhbDogJ25vcm1hbCcsCgkJTWVzaEJhc2ljTWF0ZXJpYWw6ICdiYXNpYycsCgkJTWVzaExhbWJlcnRNYXRlcmlhbDogJ2xhbWJlcnQnLAoJCU1lc2hQaG9uZ01hdGVyaWFsOiAncGhvbmcnLAoJCU1lc2hUb29uTWF0ZXJpYWw6ICd0b29uJywKCQlNZXNoU3RhbmRhcmRNYXRlcmlhbDogJ3BoeXNpY2FsJywKCQlNZXNoUGh5c2ljYWxNYXRlcmlhbDogJ3BoeXNpY2FsJywKCQlNZXNoTWF0Y2FwTWF0ZXJpYWw6ICdtYXRjYXAnLAoJCUxpbmVCYXNpY01hdGVyaWFsOiAnYmFzaWMnLAoJCUxpbmVEYXNoZWRNYXRlcmlhbDogJ2Rhc2hlZCcsCgkJUG9pbnRzTWF0ZXJpYWw6ICdwb2ludHMnLAoJCVNoYWRvd01hdGVyaWFsOiAnc2hhZG93JywKCQlTcHJpdGVNYXRlcmlhbDogJ3Nwcml0ZScKCX07CgoJZnVuY3Rpb24gZ2V0Q2hhbm5lbCggdmFsdWUgKSB7CgoJCWlmICggdmFsdWUgPT09IDAgKSByZXR1cm4gJ3V2JzsKCgkJcmV0dXJuIGB1diR7IHZhbHVlIH1gOwoKCX0KCglmdW5jdGlvbiBnZXRQYXJhbWV0ZXJzKCBtYXRlcmlhbCwgbGlnaHRzLCBzaGFkb3dzLCBzY2VuZSwgb2JqZWN0ICkgewoKCQljb25zdCBmb2cgPSBzY2VuZS5mb2c7CgkJY29uc3QgZ2VvbWV0cnkgPSBvYmplY3QuZ2VvbWV0cnk7CgkJY29uc3QgZW52aXJvbm1lbnQgPSBtYXRlcmlhbC5pc01lc2hTdGFuZGFyZE1hdGVyaWFsID8gc2NlbmUuZW52aXJvbm1lbnQgOiBudWxsOwoKCQljb25zdCBlbnZNYXAgPSAoIG1hdGVyaWFsLmlzTWVzaFN0YW5kYXJkTWF0ZXJpYWwgPyBjdWJldXZtYXBzIDogY3ViZW1hcHMgKS5nZXQoIG1hdGVyaWFsLmVudk1hcCB8fCBlbnZpcm9ubWVudCApOwoJCWNvbnN0IGVudk1hcEN1YmVVVkhlaWdodCA9ICggISEgZW52TWFwICkgJiYgKCBlbnZNYXAubWFwcGluZyA9PT0gQ3ViZVVWUmVmbGVjdGlvbk1hcHBpbmcgKSA/IGVudk1hcC5pbWFnZS5oZWlnaHQgOiBudWxsOwoKCQljb25zdCBzaGFkZXJJRCA9IHNoYWRlcklEc1sgbWF0ZXJpYWwudHlwZSBdOwoKCQkvLyBoZXVyaXN0aWNzIHRvIGNyZWF0ZSBzaGFkZXIgcGFyYW1ldGVycyBhY2NvcmRpbmcgdG8gbGlnaHRzIGluIHRoZSBzY2VuZQoJCS8vIChub3QgdG8gYmxvdyBvdmVyIG1heExpZ2h0cyBidWRnZXQpCgoJCWlmICggbWF0ZXJpYWwucHJlY2lzaW9uICE9PSBudWxsICkgewoKCQkJcHJlY2lzaW9uID0gY2FwYWJpbGl0aWVzLmdldE1heFByZWNpc2lvbiggbWF0ZXJpYWwucHJlY2lzaW9uICk7CgoJCQlpZiAoIHByZWNpc2lvbiAhPT0gbWF0ZXJpYWwucHJlY2lzaW9uICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUHJvZ3JhbS5nZXRQYXJhbWV0ZXJzOicsIG1hdGVyaWFsLnByZWNpc2lvbiwgJ25vdCBzdXBwb3J0ZWQsIHVzaW5nJywgcHJlY2lzaW9uLCAnaW5zdGVhZC4nICk7CgoJCQl9CgoJCX0KCgkJLy8KCgkJY29uc3QgbW9ycGhBdHRyaWJ1dGUgPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb24gfHwgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLm5vcm1hbCB8fCBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMuY29sb3I7CgkJY29uc3QgbW9ycGhUYXJnZXRzQ291bnQgPSAoIG1vcnBoQXR0cmlidXRlICE9PSB1bmRlZmluZWQgKSA/IG1vcnBoQXR0cmlidXRlLmxlbmd0aCA6IDA7CgoJCWxldCBtb3JwaFRleHR1cmVTdHJpZGUgPSAwOwoKCQlpZiAoIGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5wb3NpdGlvbiAhPT0gdW5kZWZpbmVkICkgbW9ycGhUZXh0dXJlU3RyaWRlID0gMTsKCQlpZiAoIGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWwgIT09IHVuZGVmaW5lZCApIG1vcnBoVGV4dHVyZVN0cmlkZSA9IDI7CgkJaWYgKCBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMuY29sb3IgIT09IHVuZGVmaW5lZCApIG1vcnBoVGV4dHVyZVN0cmlkZSA9IDM7CgoJCS8vCgoJCWxldCB2ZXJ0ZXhTaGFkZXIsIGZyYWdtZW50U2hhZGVyOwoJCWxldCBjdXN0b21WZXJ0ZXhTaGFkZXJJRCwgY3VzdG9tRnJhZ21lbnRTaGFkZXJJRDsKCgkJaWYgKCBzaGFkZXJJRCApIHsKCgkJCWNvbnN0IHNoYWRlciA9IFNoYWRlckxpYlsgc2hhZGVySUQgXTsKCgkJCXZlcnRleFNoYWRlciA9IHNoYWRlci52ZXJ0ZXhTaGFkZXI7CgkJCWZyYWdtZW50U2hhZGVyID0gc2hhZGVyLmZyYWdtZW50U2hhZGVyOwoKCQl9IGVsc2UgewoKCQkJdmVydGV4U2hhZGVyID0gbWF0ZXJpYWwudmVydGV4U2hhZGVyOwoJCQlmcmFnbWVudFNoYWRlciA9IG1hdGVyaWFsLmZyYWdtZW50U2hhZGVyOwoKCQkJX2N1c3RvbVNoYWRlcnMudXBkYXRlKCBtYXRlcmlhbCApOwoKCQkJY3VzdG9tVmVydGV4U2hhZGVySUQgPSBfY3VzdG9tU2hhZGVycy5nZXRWZXJ0ZXhTaGFkZXJJRCggbWF0ZXJpYWwgKTsKCQkJY3VzdG9tRnJhZ21lbnRTaGFkZXJJRCA9IF9jdXN0b21TaGFkZXJzLmdldEZyYWdtZW50U2hhZGVySUQoIG1hdGVyaWFsICk7CgoJCX0KCgkJY29uc3QgY3VycmVudFJlbmRlclRhcmdldCA9IHJlbmRlcmVyLmdldFJlbmRlclRhcmdldCgpOwoKCQljb25zdCBJU19JTlNUQU5DRURNRVNIID0gb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCA9PT0gdHJ1ZTsKCgkJY29uc3QgSEFTX01BUCA9ICEhIG1hdGVyaWFsLm1hcDsKCQljb25zdCBIQVNfTUFUQ0FQID0gISEgbWF0ZXJpYWwubWF0Y2FwOwoJCWNvbnN0IEhBU19FTlZNQVAgPSAhISBlbnZNYXA7CgkJY29uc3QgSEFTX0FPTUFQID0gISEgbWF0ZXJpYWwuYW9NYXA7CgkJY29uc3QgSEFTX0xJR0hUTUFQID0gISEgbWF0ZXJpYWwubGlnaHRNYXA7CgkJY29uc3QgSEFTX0JVTVBNQVAgPSAhISBtYXRlcmlhbC5idW1wTWFwOwoJCWNvbnN0IEhBU19OT1JNQUxNQVAgPSAhISBtYXRlcmlhbC5ub3JtYWxNYXA7CgkJY29uc3QgSEFTX0RJU1BMQUNFTUVOVE1BUCA9ICEhIG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcDsKCQljb25zdCBIQVNfRU1JU1NJVkVNQVAgPSAhISBtYXRlcmlhbC5lbWlzc2l2ZU1hcDsKCgkJY29uc3QgSEFTX01FVEFMTkVTU01BUCA9ICEhIG1hdGVyaWFsLm1ldGFsbmVzc01hcDsKCQljb25zdCBIQVNfUk9VR0hORVNTTUFQID0gISEgbWF0ZXJpYWwucm91Z2huZXNzTWFwOwoKCQljb25zdCBIQVNfQU5JU09UUk9QWSA9IG1hdGVyaWFsLmFuaXNvdHJvcHkgPiAwOwoJCWNvbnN0IEhBU19DTEVBUkNPQVQgPSBtYXRlcmlhbC5jbGVhcmNvYXQgPiAwOwoJCWNvbnN0IEhBU19JUklERVNDRU5DRSA9IG1hdGVyaWFsLmlyaWRlc2NlbmNlID4gMDsKCQljb25zdCBIQVNfU0hFRU4gPSBtYXRlcmlhbC5zaGVlbiA+IDA7CgkJY29uc3QgSEFTX1RSQU5TTUlTU0lPTiA9IG1hdGVyaWFsLnRyYW5zbWlzc2lvbiA+IDA7CgoJCWNvbnN0IEhBU19BTklTT1RST1BZTUFQID0gSEFTX0FOSVNPVFJPUFkgJiYgISEgbWF0ZXJpYWwuYW5pc290cm9weU1hcDsKCgkJY29uc3QgSEFTX0NMRUFSQ09BVE1BUCA9IEhBU19DTEVBUkNPQVQgJiYgISEgbWF0ZXJpYWwuY2xlYXJjb2F0TWFwOwoJCWNvbnN0IEhBU19DTEVBUkNPQVRfTk9STUFMTUFQID0gSEFTX0NMRUFSQ09BVCAmJiAhISBtYXRlcmlhbC5jbGVhcmNvYXROb3JtYWxNYXA7CgkJY29uc3QgSEFTX0NMRUFSQ09BVF9ST1VHSE5FU1NNQVAgPSBIQVNfQ0xFQVJDT0FUICYmICEhIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzc01hcDsKCgkJY29uc3QgSEFTX0lSSURFU0NFTkNFTUFQID0gSEFTX0lSSURFU0NFTkNFICYmICEhIG1hdGVyaWFsLmlyaWRlc2NlbmNlTWFwOwoJCWNvbnN0IEhBU19JUklERVNDRU5DRV9USElDS05FU1NNQVAgPSBIQVNfSVJJREVTQ0VOQ0UgJiYgISEgbWF0ZXJpYWwuaXJpZGVzY2VuY2VUaGlja25lc3NNYXA7CgoJCWNvbnN0IEhBU19TSEVFTl9DT0xPUk1BUCA9IEhBU19TSEVFTiAmJiAhISBtYXRlcmlhbC5zaGVlbkNvbG9yTWFwOwoJCWNvbnN0IEhBU19TSEVFTl9ST1VHSE5FU1NNQVAgPSBIQVNfU0hFRU4gJiYgISEgbWF0ZXJpYWwuc2hlZW5Sb3VnaG5lc3NNYXA7CgoJCWNvbnN0IEhBU19TUEVDVUxBUk1BUCA9ICEhIG1hdGVyaWFsLnNwZWN1bGFyTWFwOwoJCWNvbnN0IEhBU19TUEVDVUxBUl9DT0xPUk1BUCA9ICEhIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3JNYXA7CgkJY29uc3QgSEFTX1NQRUNVTEFSX0lOVEVOU0lUWU1BUCA9ICEhIG1hdGVyaWFsLnNwZWN1bGFySW50ZW5zaXR5TWFwOwoKCQljb25zdCBIQVNfVFJBTlNNSVNTSU9OTUFQID0gSEFTX1RSQU5TTUlTU0lPTiAmJiAhISBtYXRlcmlhbC50cmFuc21pc3Npb25NYXA7CgkJY29uc3QgSEFTX1RISUNLTkVTU01BUCA9IEhBU19UUkFOU01JU1NJT04gJiYgISEgbWF0ZXJpYWwudGhpY2tuZXNzTWFwOwoKCQljb25zdCBIQVNfR1JBRElFTlRNQVAgPSAhISBtYXRlcmlhbC5ncmFkaWVudE1hcDsKCgkJY29uc3QgSEFTX0FMUEhBTUFQID0gISEgbWF0ZXJpYWwuYWxwaGFNYXA7CgoJCWNvbnN0IEhBU19BTFBIQVRFU1QgPSBtYXRlcmlhbC5hbHBoYVRlc3QgPiAwOwoKCQljb25zdCBIQVNfQUxQSEFIQVNIID0gISEgbWF0ZXJpYWwuYWxwaGFIYXNoOwoKCQljb25zdCBIQVNfRVhURU5TSU9OUyA9ICEhIG1hdGVyaWFsLmV4dGVuc2lvbnM7CgoJCWNvbnN0IEhBU19BVFRSSUJVVEVfVVYxID0gISEgZ2VvbWV0cnkuYXR0cmlidXRlcy51djE7CgkJY29uc3QgSEFTX0FUVFJJQlVURV9VVjIgPSAhISBnZW9tZXRyeS5hdHRyaWJ1dGVzLnV2MjsKCQljb25zdCBIQVNfQVRUUklCVVRFX1VWMyA9ICEhIGdlb21ldHJ5LmF0dHJpYnV0ZXMudXYzOwoKCQlsZXQgdG9uZU1hcHBpbmcgPSBOb1RvbmVNYXBwaW5nOwoKCQlpZiAoIG1hdGVyaWFsLnRvbmVNYXBwZWQgKSB7CgoJCQlpZiAoIGN1cnJlbnRSZW5kZXJUYXJnZXQgPT09IG51bGwgfHwgY3VycmVudFJlbmRlclRhcmdldC5pc1hSUmVuZGVyVGFyZ2V0ID09PSB0cnVlICkgewoKCQkJCXRvbmVNYXBwaW5nID0gcmVuZGVyZXIudG9uZU1hcHBpbmc7CgoJCQl9CgoJCX0KCgkJY29uc3QgcGFyYW1ldGVycyA9IHsKCgkJCWlzV2ViR0wyOiBJU19XRUJHTDIsCgoJCQlzaGFkZXJJRDogc2hhZGVySUQsCgkJCXNoYWRlclR5cGU6IG1hdGVyaWFsLnR5cGUsCgkJCXNoYWRlck5hbWU6IG1hdGVyaWFsLm5hbWUsCgoJCQl2ZXJ0ZXhTaGFkZXI6IHZlcnRleFNoYWRlciwKCQkJZnJhZ21lbnRTaGFkZXI6IGZyYWdtZW50U2hhZGVyLAoJCQlkZWZpbmVzOiBtYXRlcmlhbC5kZWZpbmVzLAoKCQkJY3VzdG9tVmVydGV4U2hhZGVySUQ6IGN1c3RvbVZlcnRleFNoYWRlcklELAoJCQljdXN0b21GcmFnbWVudFNoYWRlcklEOiBjdXN0b21GcmFnbWVudFNoYWRlcklELAoKCQkJaXNSYXdTaGFkZXJNYXRlcmlhbDogbWF0ZXJpYWwuaXNSYXdTaGFkZXJNYXRlcmlhbCA9PT0gdHJ1ZSwKCQkJZ2xzbFZlcnNpb246IG1hdGVyaWFsLmdsc2xWZXJzaW9uLAoKCQkJcHJlY2lzaW9uOiBwcmVjaXNpb24sCgoJCQlpbnN0YW5jaW5nOiBJU19JTlNUQU5DRURNRVNILAoJCQlpbnN0YW5jaW5nQ29sb3I6IElTX0lOU1RBTkNFRE1FU0ggJiYgb2JqZWN0Lmluc3RhbmNlQ29sb3IgIT09IG51bGwsCgoJCQlzdXBwb3J0c1ZlcnRleFRleHR1cmVzOiBTVVBQT1JUU19WRVJURVhfVEVYVFVSRVMsCgkJCW91dHB1dENvbG9yU3BhY2U6ICggY3VycmVudFJlbmRlclRhcmdldCA9PT0gbnVsbCApID8gcmVuZGVyZXIub3V0cHV0Q29sb3JTcGFjZSA6ICggY3VycmVudFJlbmRlclRhcmdldC5pc1hSUmVuZGVyVGFyZ2V0ID09PSB0cnVlID8gY3VycmVudFJlbmRlclRhcmdldC50ZXh0dXJlLmNvbG9yU3BhY2UgOiBMaW5lYXJTUkdCQ29sb3JTcGFjZSApLAoKCQkJbWFwOiBIQVNfTUFQLAoJCQltYXRjYXA6IEhBU19NQVRDQVAsCgkJCWVudk1hcDogSEFTX0VOVk1BUCwKCQkJZW52TWFwTW9kZTogSEFTX0VOVk1BUCAmJiBlbnZNYXAubWFwcGluZywKCQkJZW52TWFwQ3ViZVVWSGVpZ2h0OiBlbnZNYXBDdWJlVVZIZWlnaHQsCgkJCWFvTWFwOiBIQVNfQU9NQVAsCgkJCWxpZ2h0TWFwOiBIQVNfTElHSFRNQVAsCgkJCWJ1bXBNYXA6IEhBU19CVU1QTUFQLAoJCQlub3JtYWxNYXA6IEhBU19OT1JNQUxNQVAsCgkJCWRpc3BsYWNlbWVudE1hcDogU1VQUE9SVFNfVkVSVEVYX1RFWFRVUkVTICYmIEhBU19ESVNQTEFDRU1FTlRNQVAsCgkJCWVtaXNzaXZlTWFwOiBIQVNfRU1JU1NJVkVNQVAsCgoJCQlub3JtYWxNYXBPYmplY3RTcGFjZTogSEFTX05PUk1BTE1BUCAmJiBtYXRlcmlhbC5ub3JtYWxNYXBUeXBlID09PSBPYmplY3RTcGFjZU5vcm1hbE1hcCwKCQkJbm9ybWFsTWFwVGFuZ2VudFNwYWNlOiBIQVNfTk9STUFMTUFQICYmIG1hdGVyaWFsLm5vcm1hbE1hcFR5cGUgPT09IFRhbmdlbnRTcGFjZU5vcm1hbE1hcCwKCgkJCW1ldGFsbmVzc01hcDogSEFTX01FVEFMTkVTU01BUCwKCQkJcm91Z2huZXNzTWFwOiBIQVNfUk9VR0hORVNTTUFQLAoKCQkJYW5pc290cm9weTogSEFTX0FOSVNPVFJPUFksCgkJCWFuaXNvdHJvcHlNYXA6IEhBU19BTklTT1RST1BZTUFQLAoKCQkJY2xlYXJjb2F0OiBIQVNfQ0xFQVJDT0FULAoJCQljbGVhcmNvYXRNYXA6IEhBU19DTEVBUkNPQVRNQVAsCgkJCWNsZWFyY29hdE5vcm1hbE1hcDogSEFTX0NMRUFSQ09BVF9OT1JNQUxNQVAsCgkJCWNsZWFyY29hdFJvdWdobmVzc01hcDogSEFTX0NMRUFSQ09BVF9ST1VHSE5FU1NNQVAsCgoJCQlpcmlkZXNjZW5jZTogSEFTX0lSSURFU0NFTkNFLAoJCQlpcmlkZXNjZW5jZU1hcDogSEFTX0lSSURFU0NFTkNFTUFQLAoJCQlpcmlkZXNjZW5jZVRoaWNrbmVzc01hcDogSEFTX0lSSURFU0NFTkNFX1RISUNLTkVTU01BUCwKCgkJCXNoZWVuOiBIQVNfU0hFRU4sCgkJCXNoZWVuQ29sb3JNYXA6IEhBU19TSEVFTl9DT0xPUk1BUCwKCQkJc2hlZW5Sb3VnaG5lc3NNYXA6IEhBU19TSEVFTl9ST1VHSE5FU1NNQVAsCgoJCQlzcGVjdWxhck1hcDogSEFTX1NQRUNVTEFSTUFQLAoJCQlzcGVjdWxhckNvbG9yTWFwOiBIQVNfU1BFQ1VMQVJfQ09MT1JNQVAsCgkJCXNwZWN1bGFySW50ZW5zaXR5TWFwOiBIQVNfU1BFQ1VMQVJfSU5URU5TSVRZTUFQLAoKCQkJdHJhbnNtaXNzaW9uOiBIQVNfVFJBTlNNSVNTSU9OLAoJCQl0cmFuc21pc3Npb25NYXA6IEhBU19UUkFOU01JU1NJT05NQVAsCgkJCXRoaWNrbmVzc01hcDogSEFTX1RISUNLTkVTU01BUCwKCgkJCWdyYWRpZW50TWFwOiBIQVNfR1JBRElFTlRNQVAsCgoJCQlvcGFxdWU6IG1hdGVyaWFsLnRyYW5zcGFyZW50ID09PSBmYWxzZSAmJiBtYXRlcmlhbC5ibGVuZGluZyA9PT0gTm9ybWFsQmxlbmRpbmcsCgoJCQlhbHBoYU1hcDogSEFTX0FMUEhBTUFQLAoJCQlhbHBoYVRlc3Q6IEhBU19BTFBIQVRFU1QsCgkJCWFscGhhSGFzaDogSEFTX0FMUEhBSEFTSCwKCgkJCWNvbWJpbmU6IG1hdGVyaWFsLmNvbWJpbmUsCgoJCQkvLwoKCQkJbWFwVXY6IEhBU19NQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwubWFwLmNoYW5uZWwgKSwKCQkJYW9NYXBVdjogSEFTX0FPTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmFvTWFwLmNoYW5uZWwgKSwKCQkJbGlnaHRNYXBVdjogSEFTX0xJR0hUTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmxpZ2h0TWFwLmNoYW5uZWwgKSwKCQkJYnVtcE1hcFV2OiBIQVNfQlVNUE1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5idW1wTWFwLmNoYW5uZWwgKSwKCQkJbm9ybWFsTWFwVXY6IEhBU19OT1JNQUxNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwubm9ybWFsTWFwLmNoYW5uZWwgKSwKCQkJZGlzcGxhY2VtZW50TWFwVXY6IEhBU19ESVNQTEFDRU1FTlRNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwLmNoYW5uZWwgKSwKCQkJZW1pc3NpdmVNYXBVdjogSEFTX0VNSVNTSVZFTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmVtaXNzaXZlTWFwLmNoYW5uZWwgKSwKCgkJCW1ldGFsbmVzc01hcFV2OiBIQVNfTUVUQUxORVNTTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLm1ldGFsbmVzc01hcC5jaGFubmVsICksCgkJCXJvdWdobmVzc01hcFV2OiBIQVNfUk9VR0hORVNTTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLnJvdWdobmVzc01hcC5jaGFubmVsICksCgoJCQlhbmlzb3Ryb3B5TWFwVXY6IEhBU19BTklTT1RST1BZTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmFuaXNvdHJvcHlNYXAuY2hhbm5lbCApLAoKCQkJY2xlYXJjb2F0TWFwVXY6IEhBU19DTEVBUkNPQVRNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuY2xlYXJjb2F0TWFwLmNoYW5uZWwgKSwKCQkJY2xlYXJjb2F0Tm9ybWFsTWFwVXY6IEhBU19DTEVBUkNPQVRfTk9STUFMTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmNsZWFyY29hdE5vcm1hbE1hcC5jaGFubmVsICksCgkJCWNsZWFyY29hdFJvdWdobmVzc01hcFV2OiBIQVNfQ0xFQVJDT0FUX1JPVUdITkVTU01BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5jbGVhcmNvYXRSb3VnaG5lc3NNYXAuY2hhbm5lbCApLAoKCQkJaXJpZGVzY2VuY2VNYXBVdjogSEFTX0lSSURFU0NFTkNFTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmlyaWRlc2NlbmNlTWFwLmNoYW5uZWwgKSwKCQkJaXJpZGVzY2VuY2VUaGlja25lc3NNYXBVdjogSEFTX0lSSURFU0NFTkNFX1RISUNLTkVTU01BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcC5jaGFubmVsICksCgoJCQlzaGVlbkNvbG9yTWFwVXY6IEhBU19TSEVFTl9DT0xPUk1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5zaGVlbkNvbG9yTWFwLmNoYW5uZWwgKSwKCQkJc2hlZW5Sb3VnaG5lc3NNYXBVdjogSEFTX1NIRUVOX1JPVUdITkVTU01BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5zaGVlblJvdWdobmVzc01hcC5jaGFubmVsICksCgoJCQlzcGVjdWxhck1hcFV2OiBIQVNfU1BFQ1VMQVJNQVAgJiYgZ2V0Q2hhbm5lbCggbWF0ZXJpYWwuc3BlY3VsYXJNYXAuY2hhbm5lbCApLAoJCQlzcGVjdWxhckNvbG9yTWFwVXY6IEhBU19TUEVDVUxBUl9DT0xPUk1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yTWFwLmNoYW5uZWwgKSwKCQkJc3BlY3VsYXJJbnRlbnNpdHlNYXBVdjogSEFTX1NQRUNVTEFSX0lOVEVOU0lUWU1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC5zcGVjdWxhckludGVuc2l0eU1hcC5jaGFubmVsICksCgoJCQl0cmFuc21pc3Npb25NYXBVdjogSEFTX1RSQU5TTUlTU0lPTk1BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC50cmFuc21pc3Npb25NYXAuY2hhbm5lbCApLAoJCQl0aGlja25lc3NNYXBVdjogSEFTX1RISUNLTkVTU01BUCAmJiBnZXRDaGFubmVsKCBtYXRlcmlhbC50aGlja25lc3NNYXAuY2hhbm5lbCApLAoKCQkJYWxwaGFNYXBVdjogSEFTX0FMUEhBTUFQICYmIGdldENoYW5uZWwoIG1hdGVyaWFsLmFscGhhTWFwLmNoYW5uZWwgKSwKCgkJCS8vCgoJCQl2ZXJ0ZXhUYW5nZW50czogISEgZ2VvbWV0cnkuYXR0cmlidXRlcy50YW5nZW50ICYmICggSEFTX05PUk1BTE1BUCB8fCBIQVNfQU5JU09UUk9QWSApLAoJCQl2ZXJ0ZXhDb2xvcnM6IG1hdGVyaWFsLnZlcnRleENvbG9ycywKCQkJdmVydGV4QWxwaGFzOiBtYXRlcmlhbC52ZXJ0ZXhDb2xvcnMgPT09IHRydWUgJiYgISEgZ2VvbWV0cnkuYXR0cmlidXRlcy5jb2xvciAmJiBnZW9tZXRyeS5hdHRyaWJ1dGVzLmNvbG9yLml0ZW1TaXplID09PSA0LAoJCQl2ZXJ0ZXhVdjFzOiBIQVNfQVRUUklCVVRFX1VWMSwKCQkJdmVydGV4VXYyczogSEFTX0FUVFJJQlVURV9VVjIsCgkJCXZlcnRleFV2M3M6IEhBU19BVFRSSUJVVEVfVVYzLAoKCQkJcG9pbnRzVXZzOiBvYmplY3QuaXNQb2ludHMgPT09IHRydWUgJiYgISEgZ2VvbWV0cnkuYXR0cmlidXRlcy51diAmJiAoIEhBU19NQVAgfHwgSEFTX0FMUEhBTUFQICksCgoJCQlmb2c6ICEhIGZvZywKCQkJdXNlRm9nOiBtYXRlcmlhbC5mb2cgPT09IHRydWUsCgkJCWZvZ0V4cDI6ICggZm9nICYmIGZvZy5pc0ZvZ0V4cDIgKSwKCgkJCWZsYXRTaGFkaW5nOiBtYXRlcmlhbC5mbGF0U2hhZGluZyA9PT0gdHJ1ZSwKCgkJCXNpemVBdHRlbnVhdGlvbjogbWF0ZXJpYWwuc2l6ZUF0dGVudWF0aW9uID09PSB0cnVlLAoJCQlsb2dhcml0aG1pY0RlcHRoQnVmZmVyOiBsb2dhcml0aG1pY0RlcHRoQnVmZmVyLAoKCQkJc2tpbm5pbmc6IG9iamVjdC5pc1NraW5uZWRNZXNoID09PSB0cnVlLAoKCQkJbW9ycGhUYXJnZXRzOiBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb24gIT09IHVuZGVmaW5lZCwKCQkJbW9ycGhOb3JtYWxzOiBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMubm9ybWFsICE9PSB1bmRlZmluZWQsCgkJCW1vcnBoQ29sb3JzOiBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMuY29sb3IgIT09IHVuZGVmaW5lZCwKCQkJbW9ycGhUYXJnZXRzQ291bnQ6IG1vcnBoVGFyZ2V0c0NvdW50LAoJCQltb3JwaFRleHR1cmVTdHJpZGU6IG1vcnBoVGV4dHVyZVN0cmlkZSwKCgkJCW51bURpckxpZ2h0czogbGlnaHRzLmRpcmVjdGlvbmFsLmxlbmd0aCwKCQkJbnVtUG9pbnRMaWdodHM6IGxpZ2h0cy5wb2ludC5sZW5ndGgsCgkJCW51bVNwb3RMaWdodHM6IGxpZ2h0cy5zcG90Lmxlbmd0aCwKCQkJbnVtU3BvdExpZ2h0TWFwczogbGlnaHRzLnNwb3RMaWdodE1hcC5sZW5ndGgsCgkJCW51bVJlY3RBcmVhTGlnaHRzOiBsaWdodHMucmVjdEFyZWEubGVuZ3RoLAoJCQludW1IZW1pTGlnaHRzOiBsaWdodHMuaGVtaS5sZW5ndGgsCgoJCQludW1EaXJMaWdodFNoYWRvd3M6IGxpZ2h0cy5kaXJlY3Rpb25hbFNoYWRvd01hcC5sZW5ndGgsCgkJCW51bVBvaW50TGlnaHRTaGFkb3dzOiBsaWdodHMucG9pbnRTaGFkb3dNYXAubGVuZ3RoLAoJCQludW1TcG90TGlnaHRTaGFkb3dzOiBsaWdodHMuc3BvdFNoYWRvd01hcC5sZW5ndGgsCgkJCW51bVNwb3RMaWdodFNoYWRvd3NXaXRoTWFwczogbGlnaHRzLm51bVNwb3RMaWdodFNoYWRvd3NXaXRoTWFwcywKCgkJCW51bUxpZ2h0UHJvYmVzOiBsaWdodHMubnVtTGlnaHRQcm9iZXMsCgoJCQludW1DbGlwcGluZ1BsYW5lczogY2xpcHBpbmcubnVtUGxhbmVzLAoJCQludW1DbGlwSW50ZXJzZWN0aW9uOiBjbGlwcGluZy5udW1JbnRlcnNlY3Rpb24sCgoJCQlkaXRoZXJpbmc6IG1hdGVyaWFsLmRpdGhlcmluZywKCgkJCXNoYWRvd01hcEVuYWJsZWQ6IHJlbmRlcmVyLnNoYWRvd01hcC5lbmFibGVkICYmIHNoYWRvd3MubGVuZ3RoID4gMCwKCQkJc2hhZG93TWFwVHlwZTogcmVuZGVyZXIuc2hhZG93TWFwLnR5cGUsCgoJCQl0b25lTWFwcGluZzogdG9uZU1hcHBpbmcsCgkJCXVzZUxlZ2FjeUxpZ2h0czogcmVuZGVyZXIuX3VzZUxlZ2FjeUxpZ2h0cywKCgkJCWRlY29kZVZpZGVvVGV4dHVyZTogSEFTX01BUCAmJiAoIG1hdGVyaWFsLm1hcC5pc1ZpZGVvVGV4dHVyZSA9PT0gdHJ1ZSApICYmICggQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBtYXRlcmlhbC5tYXAuY29sb3JTcGFjZSApID09PSBTUkdCVHJhbnNmZXIgKSwKCgkJCXByZW11bHRpcGxpZWRBbHBoYTogbWF0ZXJpYWwucHJlbXVsdGlwbGllZEFscGhhLAoKCQkJZG91YmxlU2lkZWQ6IG1hdGVyaWFsLnNpZGUgPT09IERvdWJsZVNpZGUsCgkJCWZsaXBTaWRlZDogbWF0ZXJpYWwuc2lkZSA9PT0gQmFja1NpZGUsCgoJCQl1c2VEZXB0aFBhY2tpbmc6IG1hdGVyaWFsLmRlcHRoUGFja2luZyA+PSAwLAoJCQlkZXB0aFBhY2tpbmc6IG1hdGVyaWFsLmRlcHRoUGFja2luZyB8fCAwLAoKCQkJaW5kZXgwQXR0cmlidXRlTmFtZTogbWF0ZXJpYWwuaW5kZXgwQXR0cmlidXRlTmFtZSwKCgkJCWV4dGVuc2lvbkRlcml2YXRpdmVzOiBIQVNfRVhURU5TSU9OUyAmJiBtYXRlcmlhbC5leHRlbnNpb25zLmRlcml2YXRpdmVzID09PSB0cnVlLAoJCQlleHRlbnNpb25GcmFnRGVwdGg6IEhBU19FWFRFTlNJT05TICYmIG1hdGVyaWFsLmV4dGVuc2lvbnMuZnJhZ0RlcHRoID09PSB0cnVlLAoJCQlleHRlbnNpb25EcmF3QnVmZmVyczogSEFTX0VYVEVOU0lPTlMgJiYgbWF0ZXJpYWwuZXh0ZW5zaW9ucy5kcmF3QnVmZmVycyA9PT0gdHJ1ZSwKCQkJZXh0ZW5zaW9uU2hhZGVyVGV4dHVyZUxPRDogSEFTX0VYVEVOU0lPTlMgJiYgbWF0ZXJpYWwuZXh0ZW5zaW9ucy5zaGFkZXJUZXh0dXJlTE9EID09PSB0cnVlLAoKCQkJcmVuZGVyZXJFeHRlbnNpb25GcmFnRGVwdGg6IElTX1dFQkdMMiB8fCBleHRlbnNpb25zLmhhcyggJ0VYVF9mcmFnX2RlcHRoJyApLAoJCQlyZW5kZXJlckV4dGVuc2lvbkRyYXdCdWZmZXJzOiBJU19XRUJHTDIgfHwgZXh0ZW5zaW9ucy5oYXMoICdXRUJHTF9kcmF3X2J1ZmZlcnMnICksCgkJCXJlbmRlcmVyRXh0ZW5zaW9uU2hhZGVyVGV4dHVyZUxvZDogSVNfV0VCR0wyIHx8IGV4dGVuc2lvbnMuaGFzKCAnRVhUX3NoYWRlcl90ZXh0dXJlX2xvZCcgKSwKCgkJCWN1c3RvbVByb2dyYW1DYWNoZUtleTogbWF0ZXJpYWwuY3VzdG9tUHJvZ3JhbUNhY2hlS2V5KCkKCgkJfTsKCgkJcmV0dXJuIHBhcmFtZXRlcnM7CgoJfQoKCWZ1bmN0aW9uIGdldFByb2dyYW1DYWNoZUtleSggcGFyYW1ldGVycyApIHsKCgkJY29uc3QgYXJyYXkgPSBbXTsKCgkJaWYgKCBwYXJhbWV0ZXJzLnNoYWRlcklEICkgewoKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5zaGFkZXJJRCApOwoKCQl9IGVsc2UgewoKCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jdXN0b21WZXJ0ZXhTaGFkZXJJRCApOwoJCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmN1c3RvbUZyYWdtZW50U2hhZGVySUQgKTsKCgkJfQoKCQlpZiAoIHBhcmFtZXRlcnMuZGVmaW5lcyAhPT0gdW5kZWZpbmVkICkgewoKCQkJZm9yICggY29uc3QgbmFtZSBpbiBwYXJhbWV0ZXJzLmRlZmluZXMgKSB7CgoJCQkJYXJyYXkucHVzaCggbmFtZSApOwoJCQkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5kZWZpbmVzWyBuYW1lIF0gKTsKCgkJCX0KCgkJfQoKCQlpZiAoIHBhcmFtZXRlcnMuaXNSYXdTaGFkZXJNYXRlcmlhbCA9PT0gZmFsc2UgKSB7CgoJCQlnZXRQcm9ncmFtQ2FjaGVLZXlQYXJhbWV0ZXJzKCBhcnJheSwgcGFyYW1ldGVycyApOwoJCQlnZXRQcm9ncmFtQ2FjaGVLZXlCb29sZWFucyggYXJyYXksIHBhcmFtZXRlcnMgKTsKCQkJYXJyYXkucHVzaCggcmVuZGVyZXIub3V0cHV0Q29sb3JTcGFjZSApOwoKCQl9CgoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuY3VzdG9tUHJvZ3JhbUNhY2hlS2V5ICk7CgoJCXJldHVybiBhcnJheS5qb2luKCk7CgoJfQoKCWZ1bmN0aW9uIGdldFByb2dyYW1DYWNoZUtleVBhcmFtZXRlcnMoIGFycmF5LCBwYXJhbWV0ZXJzICkgewoKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnByZWNpc2lvbiApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMub3V0cHV0Q29sb3JTcGFjZSApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuZW52TWFwTW9kZSApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuZW52TWFwQ3ViZVVWSGVpZ2h0ICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5tYXBVdiApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuYWxwaGFNYXBVdiApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubGlnaHRNYXBVdiApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuYW9NYXBVdiApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuYnVtcE1hcFV2ICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5ub3JtYWxNYXBVdiApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuZGlzcGxhY2VtZW50TWFwVXYgKTsKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmVtaXNzaXZlTWFwVXYgKTsKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm1ldGFsbmVzc01hcFV2ICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5yb3VnaG5lc3NNYXBVdiApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuYW5pc290cm9weU1hcFV2ICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jbGVhcmNvYXRNYXBVdiApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuY2xlYXJjb2F0Tm9ybWFsTWFwVXYgKTsKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLmNsZWFyY29hdFJvdWdobmVzc01hcFV2ICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5pcmlkZXNjZW5jZU1hcFV2ICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcFV2ICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5zaGVlbkNvbG9yTWFwVXYgKTsKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnNoZWVuUm91Z2huZXNzTWFwVXYgKTsKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnNwZWN1bGFyTWFwVXYgKTsKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnNwZWN1bGFyQ29sb3JNYXBVdiApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuc3BlY3VsYXJJbnRlbnNpdHlNYXBVdiApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMudHJhbnNtaXNzaW9uTWFwVXYgKTsKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLnRoaWNrbmVzc01hcFV2ICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5jb21iaW5lICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5mb2dFeHAyICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5zaXplQXR0ZW51YXRpb24gKTsKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm1vcnBoVGFyZ2V0c0NvdW50ICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5tb3JwaEF0dHJpYnV0ZUNvdW50ICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1EaXJMaWdodHMgKTsKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bVBvaW50TGlnaHRzICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1TcG90TGlnaHRzICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1TcG90TGlnaHRNYXBzICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1IZW1pTGlnaHRzICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1SZWN0QXJlYUxpZ2h0cyApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubnVtRGlyTGlnaHRTaGFkb3dzICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1Qb2ludExpZ2h0U2hhZG93cyApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubnVtU3BvdExpZ2h0U2hhZG93cyApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMubnVtU3BvdExpZ2h0U2hhZG93c1dpdGhNYXBzICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1MaWdodFByb2JlcyApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMuc2hhZG93TWFwVHlwZSApOwoJCWFycmF5LnB1c2goIHBhcmFtZXRlcnMudG9uZU1hcHBpbmcgKTsKCQlhcnJheS5wdXNoKCBwYXJhbWV0ZXJzLm51bUNsaXBwaW5nUGxhbmVzICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5udW1DbGlwSW50ZXJzZWN0aW9uICk7CgkJYXJyYXkucHVzaCggcGFyYW1ldGVycy5kZXB0aFBhY2tpbmcgKTsKCgl9CgoJZnVuY3Rpb24gZ2V0UHJvZ3JhbUNhY2hlS2V5Qm9vbGVhbnMoIGFycmF5LCBwYXJhbWV0ZXJzICkgewoKCQlfcHJvZ3JhbUxheWVycy5kaXNhYmxlQWxsKCk7CgoJCWlmICggcGFyYW1ldGVycy5pc1dlYkdMMiApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMCApOwoJCWlmICggcGFyYW1ldGVycy5zdXBwb3J0c1ZlcnRleFRleHR1cmVzICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxICk7CgkJaWYgKCBwYXJhbWV0ZXJzLmluc3RhbmNpbmcgKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDIgKTsKCQlpZiAoIHBhcmFtZXRlcnMuaW5zdGFuY2luZ0NvbG9yICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAzICk7CgkJaWYgKCBwYXJhbWV0ZXJzLm1hdGNhcCApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggNCApOwoJCWlmICggcGFyYW1ldGVycy5lbnZNYXAgKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDUgKTsKCQlpZiAoIHBhcmFtZXRlcnMubm9ybWFsTWFwT2JqZWN0U3BhY2UgKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDYgKTsKCQlpZiAoIHBhcmFtZXRlcnMubm9ybWFsTWFwVGFuZ2VudFNwYWNlICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA3ICk7CgkJaWYgKCBwYXJhbWV0ZXJzLmNsZWFyY29hdCApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggOCApOwoJCWlmICggcGFyYW1ldGVycy5pcmlkZXNjZW5jZSApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggOSApOwoJCWlmICggcGFyYW1ldGVycy5hbHBoYVRlc3QgKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDEwICk7CgkJaWYgKCBwYXJhbWV0ZXJzLnZlcnRleENvbG9ycyApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTEgKTsKCQlpZiAoIHBhcmFtZXRlcnMudmVydGV4QWxwaGFzICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxMiApOwoJCWlmICggcGFyYW1ldGVycy52ZXJ0ZXhVdjFzICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxMyApOwoJCWlmICggcGFyYW1ldGVycy52ZXJ0ZXhVdjJzICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxNCApOwoJCWlmICggcGFyYW1ldGVycy52ZXJ0ZXhVdjNzICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxNSApOwoJCWlmICggcGFyYW1ldGVycy52ZXJ0ZXhUYW5nZW50cyApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTYgKTsKCQlpZiAoIHBhcmFtZXRlcnMuYW5pc290cm9weSApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTcgKTsKCgkJYXJyYXkucHVzaCggX3Byb2dyYW1MYXllcnMubWFzayApOwoJCV9wcm9ncmFtTGF5ZXJzLmRpc2FibGVBbGwoKTsKCgkJaWYgKCBwYXJhbWV0ZXJzLmZvZyApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMCApOwoJCWlmICggcGFyYW1ldGVycy51c2VGb2cgKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDEgKTsKCQlpZiAoIHBhcmFtZXRlcnMuZmxhdFNoYWRpbmcgKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDIgKTsKCQlpZiAoIHBhcmFtZXRlcnMubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMyApOwoJCWlmICggcGFyYW1ldGVycy5za2lubmluZyApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggNCApOwoJCWlmICggcGFyYW1ldGVycy5tb3JwaFRhcmdldHMgKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDUgKTsKCQlpZiAoIHBhcmFtZXRlcnMubW9ycGhOb3JtYWxzICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA2ICk7CgkJaWYgKCBwYXJhbWV0ZXJzLm1vcnBoQ29sb3JzICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA3ICk7CgkJaWYgKCBwYXJhbWV0ZXJzLnByZW11bHRpcGxpZWRBbHBoYSApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggOCApOwoJCWlmICggcGFyYW1ldGVycy5zaGFkb3dNYXBFbmFibGVkICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCA5ICk7CgkJaWYgKCBwYXJhbWV0ZXJzLnVzZUxlZ2FjeUxpZ2h0cyApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTAgKTsKCQlpZiAoIHBhcmFtZXRlcnMuZG91YmxlU2lkZWQgKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDExICk7CgkJaWYgKCBwYXJhbWV0ZXJzLmZsaXBTaWRlZCApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTIgKTsKCQlpZiAoIHBhcmFtZXRlcnMudXNlRGVwdGhQYWNraW5nICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxMyApOwoJCWlmICggcGFyYW1ldGVycy5kaXRoZXJpbmcgKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE0ICk7CgkJaWYgKCBwYXJhbWV0ZXJzLnRyYW5zbWlzc2lvbiApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTUgKTsKCQlpZiAoIHBhcmFtZXRlcnMuc2hlZW4gKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE2ICk7CgkJaWYgKCBwYXJhbWV0ZXJzLm9wYXF1ZSApCgkJCV9wcm9ncmFtTGF5ZXJzLmVuYWJsZSggMTcgKTsKCQlpZiAoIHBhcmFtZXRlcnMucG9pbnRzVXZzICkKCQkJX3Byb2dyYW1MYXllcnMuZW5hYmxlKCAxOCApOwoJCWlmICggcGFyYW1ldGVycy5kZWNvZGVWaWRlb1RleHR1cmUgKQoJCQlfcHJvZ3JhbUxheWVycy5lbmFibGUoIDE5ICk7CgoJCWFycmF5LnB1c2goIF9wcm9ncmFtTGF5ZXJzLm1hc2sgKTsKCgl9CgoJZnVuY3Rpb24gZ2V0VW5pZm9ybXMoIG1hdGVyaWFsICkgewoKCQljb25zdCBzaGFkZXJJRCA9IHNoYWRlcklEc1sgbWF0ZXJpYWwudHlwZSBdOwoJCWxldCB1bmlmb3JtczsKCgkJaWYgKCBzaGFkZXJJRCApIHsKCgkJCWNvbnN0IHNoYWRlciA9IFNoYWRlckxpYlsgc2hhZGVySUQgXTsKCQkJdW5pZm9ybXMgPSBVbmlmb3Jtc1V0aWxzLmNsb25lKCBzaGFkZXIudW5pZm9ybXMgKTsKCgkJfSBlbHNlIHsKCgkJCXVuaWZvcm1zID0gbWF0ZXJpYWwudW5pZm9ybXM7CgoJCX0KCgkJcmV0dXJuIHVuaWZvcm1zOwoKCX0KCglmdW5jdGlvbiBhY3F1aXJlUHJvZ3JhbSggcGFyYW1ldGVycywgY2FjaGVLZXkgKSB7CgoJCWxldCBwcm9ncmFtOwoKCQkvLyBDaGVjayBpZiBjb2RlIGhhcyBiZWVuIGFscmVhZHkgY29tcGlsZWQKCQlmb3IgKCBsZXQgcCA9IDAsIHBsID0gcHJvZ3JhbXMubGVuZ3RoOyBwIDwgcGw7IHAgKysgKSB7CgoJCQljb25zdCBwcmVleGlzdGluZ1Byb2dyYW0gPSBwcm9ncmFtc1sgcCBdOwoKCQkJaWYgKCBwcmVleGlzdGluZ1Byb2dyYW0uY2FjaGVLZXkgPT09IGNhY2hlS2V5ICkgewoKCQkJCXByb2dyYW0gPSBwcmVleGlzdGluZ1Byb2dyYW07CgkJCQkrKyBwcm9ncmFtLnVzZWRUaW1lczsKCgkJCQlicmVhazsKCgkJCX0KCgkJfQoKCQlpZiAoIHByb2dyYW0gPT09IHVuZGVmaW5lZCApIHsKCgkJCXByb2dyYW0gPSBuZXcgV2ViR0xQcm9ncmFtKCByZW5kZXJlciwgY2FjaGVLZXksIHBhcmFtZXRlcnMsIGJpbmRpbmdTdGF0ZXMgKTsKCQkJcHJvZ3JhbXMucHVzaCggcHJvZ3JhbSApOwoKCQl9CgoJCXJldHVybiBwcm9ncmFtOwoKCX0KCglmdW5jdGlvbiByZWxlYXNlUHJvZ3JhbSggcHJvZ3JhbSApIHsKCgkJaWYgKCAtLSBwcm9ncmFtLnVzZWRUaW1lcyA9PT0gMCApIHsKCgkJCS8vIFJlbW92ZSBmcm9tIHVub3JkZXJlZCBzZXQKCQkJY29uc3QgaSA9IHByb2dyYW1zLmluZGV4T2YoIHByb2dyYW0gKTsKCQkJcHJvZ3JhbXNbIGkgXSA9IHByb2dyYW1zWyBwcm9ncmFtcy5sZW5ndGggLSAxIF07CgkJCXByb2dyYW1zLnBvcCgpOwoKCQkJLy8gRnJlZSBXZWJHTCByZXNvdXJjZXMKCQkJcHJvZ3JhbS5kZXN0cm95KCk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gcmVsZWFzZVNoYWRlckNhY2hlKCBtYXRlcmlhbCApIHsKCgkJX2N1c3RvbVNoYWRlcnMucmVtb3ZlKCBtYXRlcmlhbCApOwoKCX0KCglmdW5jdGlvbiBkaXNwb3NlKCkgewoKCQlfY3VzdG9tU2hhZGVycy5kaXNwb3NlKCk7CgoJfQoKCXJldHVybiB7CgkJZ2V0UGFyYW1ldGVyczogZ2V0UGFyYW1ldGVycywKCQlnZXRQcm9ncmFtQ2FjaGVLZXk6IGdldFByb2dyYW1DYWNoZUtleSwKCQlnZXRVbmlmb3JtczogZ2V0VW5pZm9ybXMsCgkJYWNxdWlyZVByb2dyYW06IGFjcXVpcmVQcm9ncmFtLAoJCXJlbGVhc2VQcm9ncmFtOiByZWxlYXNlUHJvZ3JhbSwKCQlyZWxlYXNlU2hhZGVyQ2FjaGU6IHJlbGVhc2VTaGFkZXJDYWNoZSwKCQkvLyBFeHBvc2VkIGZvciByZXNvdXJjZSBtb25pdG9yaW5nICYgZXJyb3IgZmVlZGJhY2sgdmlhIHJlbmRlcmVyLmluZm86CgkJcHJvZ3JhbXM6IHByb2dyYW1zLAoJCWRpc3Bvc2U6IGRpc3Bvc2UKCX07Cgp9CgpmdW5jdGlvbiBXZWJHTFByb3BlcnRpZXMoKSB7CgoJbGV0IHByb3BlcnRpZXMgPSBuZXcgV2Vha01hcCgpOwoKCWZ1bmN0aW9uIGdldCggb2JqZWN0ICkgewoKCQlsZXQgbWFwID0gcHJvcGVydGllcy5nZXQoIG9iamVjdCApOwoKCQlpZiAoIG1hcCA9PT0gdW5kZWZpbmVkICkgewoKCQkJbWFwID0ge307CgkJCXByb3BlcnRpZXMuc2V0KCBvYmplY3QsIG1hcCApOwoKCQl9CgoJCXJldHVybiBtYXA7CgoJfQoKCWZ1bmN0aW9uIHJlbW92ZSggb2JqZWN0ICkgewoKCQlwcm9wZXJ0aWVzLmRlbGV0ZSggb2JqZWN0ICk7CgoJfQoKCWZ1bmN0aW9uIHVwZGF0ZSggb2JqZWN0LCBrZXksIHZhbHVlICkgewoKCQlwcm9wZXJ0aWVzLmdldCggb2JqZWN0IClbIGtleSBdID0gdmFsdWU7CgoJfQoKCWZ1bmN0aW9uIGRpc3Bvc2UoKSB7CgoJCXByb3BlcnRpZXMgPSBuZXcgV2Vha01hcCgpOwoKCX0KCglyZXR1cm4gewoJCWdldDogZ2V0LAoJCXJlbW92ZTogcmVtb3ZlLAoJCXVwZGF0ZTogdXBkYXRlLAoJCWRpc3Bvc2U6IGRpc3Bvc2UKCX07Cgp9CgpmdW5jdGlvbiBwYWludGVyU29ydFN0YWJsZSggYSwgYiApIHsKCglpZiAoIGEuZ3JvdXBPcmRlciAhPT0gYi5ncm91cE9yZGVyICkgewoKCQlyZXR1cm4gYS5ncm91cE9yZGVyIC0gYi5ncm91cE9yZGVyOwoKCX0gZWxzZSBpZiAoIGEucmVuZGVyT3JkZXIgIT09IGIucmVuZGVyT3JkZXIgKSB7CgoJCXJldHVybiBhLnJlbmRlck9yZGVyIC0gYi5yZW5kZXJPcmRlcjsKCgl9IGVsc2UgaWYgKCBhLm1hdGVyaWFsLmlkICE9PSBiLm1hdGVyaWFsLmlkICkgewoKCQlyZXR1cm4gYS5tYXRlcmlhbC5pZCAtIGIubWF0ZXJpYWwuaWQ7CgoJfSBlbHNlIGlmICggYS56ICE9PSBiLnogKSB7CgoJCXJldHVybiBhLnogLSBiLno7CgoJfSBlbHNlIHsKCgkJcmV0dXJuIGEuaWQgLSBiLmlkOwoKCX0KCn0KCmZ1bmN0aW9uIHJldmVyc2VQYWludGVyU29ydFN0YWJsZSggYSwgYiApIHsKCglpZiAoIGEuZ3JvdXBPcmRlciAhPT0gYi5ncm91cE9yZGVyICkgewoKCQlyZXR1cm4gYS5ncm91cE9yZGVyIC0gYi5ncm91cE9yZGVyOwoKCX0gZWxzZSBpZiAoIGEucmVuZGVyT3JkZXIgIT09IGIucmVuZGVyT3JkZXIgKSB7CgoJCXJldHVybiBhLnJlbmRlck9yZGVyIC0gYi5yZW5kZXJPcmRlcjsKCgl9IGVsc2UgaWYgKCBhLnogIT09IGIueiApIHsKCgkJcmV0dXJuIGIueiAtIGEuejsKCgl9IGVsc2UgewoKCQlyZXR1cm4gYS5pZCAtIGIuaWQ7CgoJfQoKfQoKCmZ1bmN0aW9uIFdlYkdMUmVuZGVyTGlzdCgpIHsKCgljb25zdCByZW5kZXJJdGVtcyA9IFtdOwoJbGV0IHJlbmRlckl0ZW1zSW5kZXggPSAwOwoKCWNvbnN0IG9wYXF1ZSA9IFtdOwoJY29uc3QgdHJhbnNtaXNzaXZlID0gW107Cgljb25zdCB0cmFuc3BhcmVudCA9IFtdOwoKCWZ1bmN0aW9uIGluaXQoKSB7CgoJCXJlbmRlckl0ZW1zSW5kZXggPSAwOwoKCQlvcGFxdWUubGVuZ3RoID0gMDsKCQl0cmFuc21pc3NpdmUubGVuZ3RoID0gMDsKCQl0cmFuc3BhcmVudC5sZW5ndGggPSAwOwoKCX0KCglmdW5jdGlvbiBnZXROZXh0UmVuZGVySXRlbSggb2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIHosIGdyb3VwICkgewoKCQlsZXQgcmVuZGVySXRlbSA9IHJlbmRlckl0ZW1zWyByZW5kZXJJdGVtc0luZGV4IF07CgoJCWlmICggcmVuZGVySXRlbSA9PT0gdW5kZWZpbmVkICkgewoKCQkJcmVuZGVySXRlbSA9IHsKCQkJCWlkOiBvYmplY3QuaWQsCgkJCQlvYmplY3Q6IG9iamVjdCwKCQkJCWdlb21ldHJ5OiBnZW9tZXRyeSwKCQkJCW1hdGVyaWFsOiBtYXRlcmlhbCwKCQkJCWdyb3VwT3JkZXI6IGdyb3VwT3JkZXIsCgkJCQlyZW5kZXJPcmRlcjogb2JqZWN0LnJlbmRlck9yZGVyLAoJCQkJejogeiwKCQkJCWdyb3VwOiBncm91cAoJCQl9OwoKCQkJcmVuZGVySXRlbXNbIHJlbmRlckl0ZW1zSW5kZXggXSA9IHJlbmRlckl0ZW07CgoJCX0gZWxzZSB7CgoJCQlyZW5kZXJJdGVtLmlkID0gb2JqZWN0LmlkOwoJCQlyZW5kZXJJdGVtLm9iamVjdCA9IG9iamVjdDsKCQkJcmVuZGVySXRlbS5nZW9tZXRyeSA9IGdlb21ldHJ5OwoJCQlyZW5kZXJJdGVtLm1hdGVyaWFsID0gbWF0ZXJpYWw7CgkJCXJlbmRlckl0ZW0uZ3JvdXBPcmRlciA9IGdyb3VwT3JkZXI7CgkJCXJlbmRlckl0ZW0ucmVuZGVyT3JkZXIgPSBvYmplY3QucmVuZGVyT3JkZXI7CgkJCXJlbmRlckl0ZW0ueiA9IHo7CgkJCXJlbmRlckl0ZW0uZ3JvdXAgPSBncm91cDsKCgkJfQoKCQlyZW5kZXJJdGVtc0luZGV4ICsrOwoKCQlyZXR1cm4gcmVuZGVySXRlbTsKCgl9CgoJZnVuY3Rpb24gcHVzaCggb2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIHosIGdyb3VwICkgewoKCQljb25zdCByZW5kZXJJdGVtID0gZ2V0TmV4dFJlbmRlckl0ZW0oIG9iamVjdCwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cE9yZGVyLCB6LCBncm91cCApOwoKCQlpZiAoIG1hdGVyaWFsLnRyYW5zbWlzc2lvbiA+IDAuMCApIHsKCgkJCXRyYW5zbWlzc2l2ZS5wdXNoKCByZW5kZXJJdGVtICk7CgoJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLnRyYW5zcGFyZW50ID09PSB0cnVlICkgewoKCQkJdHJhbnNwYXJlbnQucHVzaCggcmVuZGVySXRlbSApOwoKCQl9IGVsc2UgewoKCQkJb3BhcXVlLnB1c2goIHJlbmRlckl0ZW0gKTsKCgkJfQoKCX0KCglmdW5jdGlvbiB1bnNoaWZ0KCBvYmplY3QsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXBPcmRlciwgeiwgZ3JvdXAgKSB7CgoJCWNvbnN0IHJlbmRlckl0ZW0gPSBnZXROZXh0UmVuZGVySXRlbSggb2JqZWN0LCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwT3JkZXIsIHosIGdyb3VwICk7CgoJCWlmICggbWF0ZXJpYWwudHJhbnNtaXNzaW9uID4gMC4wICkgewoKCQkJdHJhbnNtaXNzaXZlLnVuc2hpZnQoIHJlbmRlckl0ZW0gKTsKCgkJfSBlbHNlIGlmICggbWF0ZXJpYWwudHJhbnNwYXJlbnQgPT09IHRydWUgKSB7CgoJCQl0cmFuc3BhcmVudC51bnNoaWZ0KCByZW5kZXJJdGVtICk7CgoJCX0gZWxzZSB7CgoJCQlvcGFxdWUudW5zaGlmdCggcmVuZGVySXRlbSApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHNvcnQoIGN1c3RvbU9wYXF1ZVNvcnQsIGN1c3RvbVRyYW5zcGFyZW50U29ydCApIHsKCgkJaWYgKCBvcGFxdWUubGVuZ3RoID4gMSApIG9wYXF1ZS5zb3J0KCBjdXN0b21PcGFxdWVTb3J0IHx8IHBhaW50ZXJTb3J0U3RhYmxlICk7CgkJaWYgKCB0cmFuc21pc3NpdmUubGVuZ3RoID4gMSApIHRyYW5zbWlzc2l2ZS5zb3J0KCBjdXN0b21UcmFuc3BhcmVudFNvcnQgfHwgcmV2ZXJzZVBhaW50ZXJTb3J0U3RhYmxlICk7CgkJaWYgKCB0cmFuc3BhcmVudC5sZW5ndGggPiAxICkgdHJhbnNwYXJlbnQuc29ydCggY3VzdG9tVHJhbnNwYXJlbnRTb3J0IHx8IHJldmVyc2VQYWludGVyU29ydFN0YWJsZSApOwoKCX0KCglmdW5jdGlvbiBmaW5pc2goKSB7CgoJCS8vIENsZWFyIHJlZmVyZW5jZXMgZnJvbSBpbmFjdGl2ZSByZW5kZXJJdGVtcyBpbiB0aGUgbGlzdAoKCQlmb3IgKCBsZXQgaSA9IHJlbmRlckl0ZW1zSW5kZXgsIGlsID0gcmVuZGVySXRlbXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQljb25zdCByZW5kZXJJdGVtID0gcmVuZGVySXRlbXNbIGkgXTsKCgkJCWlmICggcmVuZGVySXRlbS5pZCA9PT0gbnVsbCApIGJyZWFrOwoKCQkJcmVuZGVySXRlbS5pZCA9IG51bGw7CgkJCXJlbmRlckl0ZW0ub2JqZWN0ID0gbnVsbDsKCQkJcmVuZGVySXRlbS5nZW9tZXRyeSA9IG51bGw7CgkJCXJlbmRlckl0ZW0ubWF0ZXJpYWwgPSBudWxsOwoJCQlyZW5kZXJJdGVtLmdyb3VwID0gbnVsbDsKCgkJfQoKCX0KCglyZXR1cm4gewoKCQlvcGFxdWU6IG9wYXF1ZSwKCQl0cmFuc21pc3NpdmU6IHRyYW5zbWlzc2l2ZSwKCQl0cmFuc3BhcmVudDogdHJhbnNwYXJlbnQsCgoJCWluaXQ6IGluaXQsCgkJcHVzaDogcHVzaCwKCQl1bnNoaWZ0OiB1bnNoaWZ0LAoJCWZpbmlzaDogZmluaXNoLAoKCQlzb3J0OiBzb3J0Cgl9OwoKfQoKZnVuY3Rpb24gV2ViR0xSZW5kZXJMaXN0cygpIHsKCglsZXQgbGlzdHMgPSBuZXcgV2Vha01hcCgpOwoKCWZ1bmN0aW9uIGdldCggc2NlbmUsIHJlbmRlckNhbGxEZXB0aCApIHsKCgkJY29uc3QgbGlzdEFycmF5ID0gbGlzdHMuZ2V0KCBzY2VuZSApOwoJCWxldCBsaXN0OwoKCQlpZiAoIGxpc3RBcnJheSA9PT0gdW5kZWZpbmVkICkgewoKCQkJbGlzdCA9IG5ldyBXZWJHTFJlbmRlckxpc3QoKTsKCQkJbGlzdHMuc2V0KCBzY2VuZSwgWyBsaXN0IF0gKTsKCgkJfSBlbHNlIHsKCgkJCWlmICggcmVuZGVyQ2FsbERlcHRoID49IGxpc3RBcnJheS5sZW5ndGggKSB7CgoJCQkJbGlzdCA9IG5ldyBXZWJHTFJlbmRlckxpc3QoKTsKCQkJCWxpc3RBcnJheS5wdXNoKCBsaXN0ICk7CgoJCQl9IGVsc2UgewoKCQkJCWxpc3QgPSBsaXN0QXJyYXlbIHJlbmRlckNhbGxEZXB0aCBdOwoKCQkJfQoKCQl9CgoJCXJldHVybiBsaXN0OwoKCX0KCglmdW5jdGlvbiBkaXNwb3NlKCkgewoKCQlsaXN0cyA9IG5ldyBXZWFrTWFwKCk7CgoJfQoKCXJldHVybiB7CgkJZ2V0OiBnZXQsCgkJZGlzcG9zZTogZGlzcG9zZQoJfTsKCn0KCmZ1bmN0aW9uIFVuaWZvcm1zQ2FjaGUoKSB7CgoJY29uc3QgbGlnaHRzID0ge307CgoJcmV0dXJuIHsKCgkJZ2V0OiBmdW5jdGlvbiAoIGxpZ2h0ICkgewoKCQkJaWYgKCBsaWdodHNbIGxpZ2h0LmlkIF0gIT09IHVuZGVmaW5lZCApIHsKCgkJCQlyZXR1cm4gbGlnaHRzWyBsaWdodC5pZCBdOwoKCQkJfQoKCQkJbGV0IHVuaWZvcm1zOwoKCQkJc3dpdGNoICggbGlnaHQudHlwZSApIHsKCgkJCQljYXNlICdEaXJlY3Rpb25hbExpZ2h0JzoKCQkJCQl1bmlmb3JtcyA9IHsKCQkJCQkJZGlyZWN0aW9uOiBuZXcgVmVjdG9yMygpLAoJCQkJCQljb2xvcjogbmV3IENvbG9yKCkKCQkJCQl9OwoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgJ1Nwb3RMaWdodCc6CgkJCQkJdW5pZm9ybXMgPSB7CgkJCQkJCXBvc2l0aW9uOiBuZXcgVmVjdG9yMygpLAoJCQkJCQlkaXJlY3Rpb246IG5ldyBWZWN0b3IzKCksCgkJCQkJCWNvbG9yOiBuZXcgQ29sb3IoKSwKCQkJCQkJZGlzdGFuY2U6IDAsCgkJCQkJCWNvbmVDb3M6IDAsCgkJCQkJCXBlbnVtYnJhQ29zOiAwLAoJCQkJCQlkZWNheTogMAoJCQkJCX07CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnUG9pbnRMaWdodCc6CgkJCQkJdW5pZm9ybXMgPSB7CgkJCQkJCXBvc2l0aW9uOiBuZXcgVmVjdG9yMygpLAoJCQkJCQljb2xvcjogbmV3IENvbG9yKCksCgkJCQkJCWRpc3RhbmNlOiAwLAoJCQkJCQlkZWNheTogMAoJCQkJCX07CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnSGVtaXNwaGVyZUxpZ2h0JzoKCQkJCQl1bmlmb3JtcyA9IHsKCQkJCQkJZGlyZWN0aW9uOiBuZXcgVmVjdG9yMygpLAoJCQkJCQlza3lDb2xvcjogbmV3IENvbG9yKCksCgkJCQkJCWdyb3VuZENvbG9yOiBuZXcgQ29sb3IoKQoJCQkJCX07CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnUmVjdEFyZWFMaWdodCc6CgkJCQkJdW5pZm9ybXMgPSB7CgkJCQkJCWNvbG9yOiBuZXcgQ29sb3IoKSwKCQkJCQkJcG9zaXRpb246IG5ldyBWZWN0b3IzKCksCgkJCQkJCWhhbGZXaWR0aDogbmV3IFZlY3RvcjMoKSwKCQkJCQkJaGFsZkhlaWdodDogbmV3IFZlY3RvcjMoKQoJCQkJCX07CgkJCQkJYnJlYWs7CgoJCQl9CgoJCQlsaWdodHNbIGxpZ2h0LmlkIF0gPSB1bmlmb3JtczsKCgkJCXJldHVybiB1bmlmb3JtczsKCgkJfQoKCX07Cgp9CgpmdW5jdGlvbiBTaGFkb3dVbmlmb3Jtc0NhY2hlKCkgewoKCWNvbnN0IGxpZ2h0cyA9IHt9OwoKCXJldHVybiB7CgoJCWdldDogZnVuY3Rpb24gKCBsaWdodCApIHsKCgkJCWlmICggbGlnaHRzWyBsaWdodC5pZCBdICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJcmV0dXJuIGxpZ2h0c1sgbGlnaHQuaWQgXTsKCgkJCX0KCgkJCWxldCB1bmlmb3JtczsKCgkJCXN3aXRjaCAoIGxpZ2h0LnR5cGUgKSB7CgoJCQkJY2FzZSAnRGlyZWN0aW9uYWxMaWdodCc6CgkJCQkJdW5pZm9ybXMgPSB7CgkJCQkJCXNoYWRvd0JpYXM6IDAsCgkJCQkJCXNoYWRvd05vcm1hbEJpYXM6IDAsCgkJCQkJCXNoYWRvd1JhZGl1czogMSwKCQkJCQkJc2hhZG93TWFwU2l6ZTogbmV3IFZlY3RvcjIoKQoJCQkJCX07CgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnU3BvdExpZ2h0JzoKCQkJCQl1bmlmb3JtcyA9IHsKCQkJCQkJc2hhZG93QmlhczogMCwKCQkJCQkJc2hhZG93Tm9ybWFsQmlhczogMCwKCQkJCQkJc2hhZG93UmFkaXVzOiAxLAoJCQkJCQlzaGFkb3dNYXBTaXplOiBuZXcgVmVjdG9yMigpCgkJCQkJfTsKCQkJCQlicmVhazsKCgkJCQljYXNlICdQb2ludExpZ2h0JzoKCQkJCQl1bmlmb3JtcyA9IHsKCQkJCQkJc2hhZG93QmlhczogMCwKCQkJCQkJc2hhZG93Tm9ybWFsQmlhczogMCwKCQkJCQkJc2hhZG93UmFkaXVzOiAxLAoJCQkJCQlzaGFkb3dNYXBTaXplOiBuZXcgVmVjdG9yMigpLAoJCQkJCQlzaGFkb3dDYW1lcmFOZWFyOiAxLAoJCQkJCQlzaGFkb3dDYW1lcmFGYXI6IDEwMDAKCQkJCQl9OwoJCQkJCWJyZWFrOwoKCQkJCS8vIFRPRE8gKGFiZWxuYXRpb24pOiBzZXQgUmVjdEFyZWFMaWdodCBzaGFkb3cgdW5pZm9ybXMKCgkJCX0KCgkJCWxpZ2h0c1sgbGlnaHQuaWQgXSA9IHVuaWZvcm1zOwoKCQkJcmV0dXJuIHVuaWZvcm1zOwoKCQl9CgoJfTsKCn0KCgoKbGV0IG5leHRWZXJzaW9uID0gMDsKCmZ1bmN0aW9uIHNoYWRvd0Nhc3RpbmdBbmRUZXh0dXJpbmdMaWdodHNGaXJzdCggbGlnaHRBLCBsaWdodEIgKSB7CgoJcmV0dXJuICggbGlnaHRCLmNhc3RTaGFkb3cgPyAyIDogMCApIC0gKCBsaWdodEEuY2FzdFNoYWRvdyA/IDIgOiAwICkgKyAoIGxpZ2h0Qi5tYXAgPyAxIDogMCApIC0gKCBsaWdodEEubWFwID8gMSA6IDAgKTsKCn0KCmZ1bmN0aW9uIFdlYkdMTGlnaHRzKCBleHRlbnNpb25zLCBjYXBhYmlsaXRpZXMgKSB7CgoJY29uc3QgY2FjaGUgPSBuZXcgVW5pZm9ybXNDYWNoZSgpOwoKCWNvbnN0IHNoYWRvd0NhY2hlID0gU2hhZG93VW5pZm9ybXNDYWNoZSgpOwoKCWNvbnN0IHN0YXRlID0gewoKCQl2ZXJzaW9uOiAwLAoKCQloYXNoOiB7CgkJCWRpcmVjdGlvbmFsTGVuZ3RoOiAtIDEsCgkJCXBvaW50TGVuZ3RoOiAtIDEsCgkJCXNwb3RMZW5ndGg6IC0gMSwKCQkJcmVjdEFyZWFMZW5ndGg6IC0gMSwKCQkJaGVtaUxlbmd0aDogLSAxLAoKCQkJbnVtRGlyZWN0aW9uYWxTaGFkb3dzOiAtIDEsCgkJCW51bVBvaW50U2hhZG93czogLSAxLAoJCQludW1TcG90U2hhZG93czogLSAxLAoJCQludW1TcG90TWFwczogLSAxLAoKCQkJbnVtTGlnaHRQcm9iZXM6IC0gMQoJCX0sCgoJCWFtYmllbnQ6IFsgMCwgMCwgMCBdLAoJCXByb2JlOiBbXSwKCQlkaXJlY3Rpb25hbDogW10sCgkJZGlyZWN0aW9uYWxTaGFkb3c6IFtdLAoJCWRpcmVjdGlvbmFsU2hhZG93TWFwOiBbXSwKCQlkaXJlY3Rpb25hbFNoYWRvd01hdHJpeDogW10sCgkJc3BvdDogW10sCgkJc3BvdExpZ2h0TWFwOiBbXSwKCQlzcG90U2hhZG93OiBbXSwKCQlzcG90U2hhZG93TWFwOiBbXSwKCQlzcG90TGlnaHRNYXRyaXg6IFtdLAoJCXJlY3RBcmVhOiBbXSwKCQlyZWN0QXJlYUxUQzE6IG51bGwsCgkJcmVjdEFyZWFMVEMyOiBudWxsLAoJCXBvaW50OiBbXSwKCQlwb2ludFNoYWRvdzogW10sCgkJcG9pbnRTaGFkb3dNYXA6IFtdLAoJCXBvaW50U2hhZG93TWF0cml4OiBbXSwKCQloZW1pOiBbXSwKCQludW1TcG90TGlnaHRTaGFkb3dzV2l0aE1hcHM6IDAsCgkJbnVtTGlnaHRQcm9iZXM6IDAKCgl9OwoKCWZvciAoIGxldCBpID0gMDsgaSA8IDk7IGkgKysgKSBzdGF0ZS5wcm9iZS5wdXNoKCBuZXcgVmVjdG9yMygpICk7CgoJY29uc3QgdmVjdG9yMyA9IG5ldyBWZWN0b3IzKCk7Cgljb25zdCBtYXRyaXg0ID0gbmV3IE1hdHJpeDQoKTsKCWNvbnN0IG1hdHJpeDQyID0gbmV3IE1hdHJpeDQoKTsKCglmdW5jdGlvbiBzZXR1cCggbGlnaHRzLCB1c2VMZWdhY3lMaWdodHMgKSB7CgoJCWxldCByID0gMCwgZyA9IDAsIGIgPSAwOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA5OyBpICsrICkgc3RhdGUucHJvYmVbIGkgXS5zZXQoIDAsIDAsIDAgKTsKCgkJbGV0IGRpcmVjdGlvbmFsTGVuZ3RoID0gMDsKCQlsZXQgcG9pbnRMZW5ndGggPSAwOwoJCWxldCBzcG90TGVuZ3RoID0gMDsKCQlsZXQgcmVjdEFyZWFMZW5ndGggPSAwOwoJCWxldCBoZW1pTGVuZ3RoID0gMDsKCgkJbGV0IG51bURpcmVjdGlvbmFsU2hhZG93cyA9IDA7CgkJbGV0IG51bVBvaW50U2hhZG93cyA9IDA7CgkJbGV0IG51bVNwb3RTaGFkb3dzID0gMDsKCQlsZXQgbnVtU3BvdE1hcHMgPSAwOwoJCWxldCBudW1TcG90U2hhZG93c1dpdGhNYXBzID0gMDsKCgkJbGV0IG51bUxpZ2h0UHJvYmVzID0gMDsKCgkJLy8gb3JkZXJpbmcgOiBbc2hhZG93IGNhc3RpbmcgKyBtYXAgdGV4dHVyaW5nLCBtYXAgdGV4dHVyaW5nLCBzaGFkb3cgY2FzdGluZywgbm9uZSBdCgkJbGlnaHRzLnNvcnQoIHNoYWRvd0Nhc3RpbmdBbmRUZXh0dXJpbmdMaWdodHNGaXJzdCApOwoKCQkvLyBhcnRpc3QtZnJpZW5kbHkgbGlnaHQgaW50ZW5zaXR5IHNjYWxpbmcgZmFjdG9yCgkJY29uc3Qgc2NhbGVGYWN0b3IgPSAoIHVzZUxlZ2FjeUxpZ2h0cyA9PT0gdHJ1ZSApID8gTWF0aC5QSSA6IDE7CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IGxpZ2h0cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJY29uc3QgbGlnaHQgPSBsaWdodHNbIGkgXTsKCgkJCWNvbnN0IGNvbG9yID0gbGlnaHQuY29sb3I7CgkJCWNvbnN0IGludGVuc2l0eSA9IGxpZ2h0LmludGVuc2l0eTsKCQkJY29uc3QgZGlzdGFuY2UgPSBsaWdodC5kaXN0YW5jZTsKCgkJCWNvbnN0IHNoYWRvd01hcCA9ICggbGlnaHQuc2hhZG93ICYmIGxpZ2h0LnNoYWRvdy5tYXAgKSA/IGxpZ2h0LnNoYWRvdy5tYXAudGV4dHVyZSA6IG51bGw7CgoJCQlpZiAoIGxpZ2h0LmlzQW1iaWVudExpZ2h0ICkgewoKCQkJCXIgKz0gY29sb3IuciAqIGludGVuc2l0eSAqIHNjYWxlRmFjdG9yOwoJCQkJZyArPSBjb2xvci5nICogaW50ZW5zaXR5ICogc2NhbGVGYWN0b3I7CgkJCQliICs9IGNvbG9yLmIgKiBpbnRlbnNpdHkgKiBzY2FsZUZhY3RvcjsKCgkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzTGlnaHRQcm9iZSApIHsKCgkJCQlmb3IgKCBsZXQgaiA9IDA7IGogPCA5OyBqICsrICkgewoKCQkJCQlzdGF0ZS5wcm9iZVsgaiBdLmFkZFNjYWxlZFZlY3RvciggbGlnaHQuc2guY29lZmZpY2llbnRzWyBqIF0sIGludGVuc2l0eSApOwoKCQkJCX0KCgkJCQludW1MaWdodFByb2JlcyArKzsKCgkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzRGlyZWN0aW9uYWxMaWdodCApIHsKCgkJCQljb25zdCB1bmlmb3JtcyA9IGNhY2hlLmdldCggbGlnaHQgKTsKCgkJCQl1bmlmb3Jtcy5jb2xvci5jb3B5KCBsaWdodC5jb2xvciApLm11bHRpcGx5U2NhbGFyKCBsaWdodC5pbnRlbnNpdHkgKiBzY2FsZUZhY3RvciApOwoKCQkJCWlmICggbGlnaHQuY2FzdFNoYWRvdyApIHsKCgkJCQkJY29uc3Qgc2hhZG93ID0gbGlnaHQuc2hhZG93OwoKCQkJCQljb25zdCBzaGFkb3dVbmlmb3JtcyA9IHNoYWRvd0NhY2hlLmdldCggbGlnaHQgKTsKCgkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93QmlhcyA9IHNoYWRvdy5iaWFzOwoJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd05vcm1hbEJpYXMgPSBzaGFkb3cubm9ybWFsQmlhczsKCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dSYWRpdXMgPSBzaGFkb3cucmFkaXVzOwoJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd01hcFNpemUgPSBzaGFkb3cubWFwU2l6ZTsKCgkJCQkJc3RhdGUuZGlyZWN0aW9uYWxTaGFkb3dbIGRpcmVjdGlvbmFsTGVuZ3RoIF0gPSBzaGFkb3dVbmlmb3JtczsKCQkJCQlzdGF0ZS5kaXJlY3Rpb25hbFNoYWRvd01hcFsgZGlyZWN0aW9uYWxMZW5ndGggXSA9IHNoYWRvd01hcDsKCQkJCQlzdGF0ZS5kaXJlY3Rpb25hbFNoYWRvd01hdHJpeFsgZGlyZWN0aW9uYWxMZW5ndGggXSA9IGxpZ2h0LnNoYWRvdy5tYXRyaXg7CgoJCQkJCW51bURpcmVjdGlvbmFsU2hhZG93cyArKzsKCgkJCQl9CgoJCQkJc3RhdGUuZGlyZWN0aW9uYWxbIGRpcmVjdGlvbmFsTGVuZ3RoIF0gPSB1bmlmb3JtczsKCgkJCQlkaXJlY3Rpb25hbExlbmd0aCArKzsKCgkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzU3BvdExpZ2h0ICkgewoKCQkJCWNvbnN0IHVuaWZvcm1zID0gY2FjaGUuZ2V0KCBsaWdodCApOwoKCQkJCXVuaWZvcm1zLnBvc2l0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQubWF0cml4V29ybGQgKTsKCgkJCQl1bmlmb3Jtcy5jb2xvci5jb3B5KCBjb2xvciApLm11bHRpcGx5U2NhbGFyKCBpbnRlbnNpdHkgKiBzY2FsZUZhY3RvciApOwoJCQkJdW5pZm9ybXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKCgkJCQl1bmlmb3Jtcy5jb25lQ29zID0gTWF0aC5jb3MoIGxpZ2h0LmFuZ2xlICk7CgkJCQl1bmlmb3Jtcy5wZW51bWJyYUNvcyA9IE1hdGguY29zKCBsaWdodC5hbmdsZSAqICggMSAtIGxpZ2h0LnBlbnVtYnJhICkgKTsKCQkJCXVuaWZvcm1zLmRlY2F5ID0gbGlnaHQuZGVjYXk7CgoJCQkJc3RhdGUuc3BvdFsgc3BvdExlbmd0aCBdID0gdW5pZm9ybXM7CgoJCQkJY29uc3Qgc2hhZG93ID0gbGlnaHQuc2hhZG93OwoKCQkJCWlmICggbGlnaHQubWFwICkgewoKCQkJCQlzdGF0ZS5zcG90TGlnaHRNYXBbIG51bVNwb3RNYXBzIF0gPSBsaWdodC5tYXA7CgkJCQkJbnVtU3BvdE1hcHMgKys7CgoJCQkJCS8vIG1ha2Ugc3VyZSB0aGUgbGlnaHRNYXRyaXggaXMgdXAgdG8gZGF0ZQoJCQkJCS8vIFRPRE8gOiBkbyBpdCBpZiByZXF1aXJlZCBvbmx5CgkJCQkJc2hhZG93LnVwZGF0ZU1hdHJpY2VzKCBsaWdodCApOwoKCQkJCQlpZiAoIGxpZ2h0LmNhc3RTaGFkb3cgKSBudW1TcG90U2hhZG93c1dpdGhNYXBzICsrOwoKCQkJCX0KCgkJCQlzdGF0ZS5zcG90TGlnaHRNYXRyaXhbIHNwb3RMZW5ndGggXSA9IHNoYWRvdy5tYXRyaXg7CgoJCQkJaWYgKCBsaWdodC5jYXN0U2hhZG93ICkgewoKCQkJCQljb25zdCBzaGFkb3dVbmlmb3JtcyA9IHNoYWRvd0NhY2hlLmdldCggbGlnaHQgKTsKCgkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93QmlhcyA9IHNoYWRvdy5iaWFzOwoJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd05vcm1hbEJpYXMgPSBzaGFkb3cubm9ybWFsQmlhczsKCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dSYWRpdXMgPSBzaGFkb3cucmFkaXVzOwoJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd01hcFNpemUgPSBzaGFkb3cubWFwU2l6ZTsKCgkJCQkJc3RhdGUuc3BvdFNoYWRvd1sgc3BvdExlbmd0aCBdID0gc2hhZG93VW5pZm9ybXM7CgkJCQkJc3RhdGUuc3BvdFNoYWRvd01hcFsgc3BvdExlbmd0aCBdID0gc2hhZG93TWFwOwoKCQkJCQludW1TcG90U2hhZG93cyArKzsKCgkJCQl9CgoJCQkJc3BvdExlbmd0aCArKzsKCgkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzUmVjdEFyZWFMaWdodCApIHsKCgkJCQljb25zdCB1bmlmb3JtcyA9IGNhY2hlLmdldCggbGlnaHQgKTsKCgkJCQl1bmlmb3Jtcy5jb2xvci5jb3B5KCBjb2xvciApLm11bHRpcGx5U2NhbGFyKCBpbnRlbnNpdHkgKTsKCgkJCQl1bmlmb3Jtcy5oYWxmV2lkdGguc2V0KCBsaWdodC53aWR0aCAqIDAuNSwgMC4wLCAwLjAgKTsKCQkJCXVuaWZvcm1zLmhhbGZIZWlnaHQuc2V0KCAwLjAsIGxpZ2h0LmhlaWdodCAqIDAuNSwgMC4wICk7CgoJCQkJc3RhdGUucmVjdEFyZWFbIHJlY3RBcmVhTGVuZ3RoIF0gPSB1bmlmb3JtczsKCgkJCQlyZWN0QXJlYUxlbmd0aCArKzsKCgkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzUG9pbnRMaWdodCApIHsKCgkJCQljb25zdCB1bmlmb3JtcyA9IGNhY2hlLmdldCggbGlnaHQgKTsKCgkJCQl1bmlmb3Jtcy5jb2xvci5jb3B5KCBsaWdodC5jb2xvciApLm11bHRpcGx5U2NhbGFyKCBsaWdodC5pbnRlbnNpdHkgKiBzY2FsZUZhY3RvciApOwoJCQkJdW5pZm9ybXMuZGlzdGFuY2UgPSBsaWdodC5kaXN0YW5jZTsKCQkJCXVuaWZvcm1zLmRlY2F5ID0gbGlnaHQuZGVjYXk7CgoJCQkJaWYgKCBsaWdodC5jYXN0U2hhZG93ICkgewoKCQkJCQljb25zdCBzaGFkb3cgPSBsaWdodC5zaGFkb3c7CgoJCQkJCWNvbnN0IHNoYWRvd1VuaWZvcm1zID0gc2hhZG93Q2FjaGUuZ2V0KCBsaWdodCApOwoKCQkJCQlzaGFkb3dVbmlmb3Jtcy5zaGFkb3dCaWFzID0gc2hhZG93LmJpYXM7CgkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93Tm9ybWFsQmlhcyA9IHNoYWRvdy5ub3JtYWxCaWFzOwoJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd1JhZGl1cyA9IHNoYWRvdy5yYWRpdXM7CgkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93TWFwU2l6ZSA9IHNoYWRvdy5tYXBTaXplOwoJCQkJCXNoYWRvd1VuaWZvcm1zLnNoYWRvd0NhbWVyYU5lYXIgPSBzaGFkb3cuY2FtZXJhLm5lYXI7CgkJCQkJc2hhZG93VW5pZm9ybXMuc2hhZG93Q2FtZXJhRmFyID0gc2hhZG93LmNhbWVyYS5mYXI7CgoJCQkJCXN0YXRlLnBvaW50U2hhZG93WyBwb2ludExlbmd0aCBdID0gc2hhZG93VW5pZm9ybXM7CgkJCQkJc3RhdGUucG9pbnRTaGFkb3dNYXBbIHBvaW50TGVuZ3RoIF0gPSBzaGFkb3dNYXA7CgkJCQkJc3RhdGUucG9pbnRTaGFkb3dNYXRyaXhbIHBvaW50TGVuZ3RoIF0gPSBsaWdodC5zaGFkb3cubWF0cml4OwoKCQkJCQludW1Qb2ludFNoYWRvd3MgKys7CgoJCQkJfQoKCQkJCXN0YXRlLnBvaW50WyBwb2ludExlbmd0aCBdID0gdW5pZm9ybXM7CgoJCQkJcG9pbnRMZW5ndGggKys7CgoJCQl9IGVsc2UgaWYgKCBsaWdodC5pc0hlbWlzcGhlcmVMaWdodCApIHsKCgkJCQljb25zdCB1bmlmb3JtcyA9IGNhY2hlLmdldCggbGlnaHQgKTsKCgkJCQl1bmlmb3Jtcy5za3lDb2xvci5jb3B5KCBsaWdodC5jb2xvciApLm11bHRpcGx5U2NhbGFyKCBpbnRlbnNpdHkgKiBzY2FsZUZhY3RvciApOwoJCQkJdW5pZm9ybXMuZ3JvdW5kQ29sb3IuY29weSggbGlnaHQuZ3JvdW5kQ29sb3IgKS5tdWx0aXBseVNjYWxhciggaW50ZW5zaXR5ICogc2NhbGVGYWN0b3IgKTsKCgkJCQlzdGF0ZS5oZW1pWyBoZW1pTGVuZ3RoIF0gPSB1bmlmb3JtczsKCgkJCQloZW1pTGVuZ3RoICsrOwoKCQkJfQoKCQl9CgoJCWlmICggcmVjdEFyZWFMZW5ndGggPiAwICkgewoKCQkJaWYgKCBjYXBhYmlsaXRpZXMuaXNXZWJHTDIgKSB7CgoJCQkJLy8gV2ViR0wgMgoKCQkJCXN0YXRlLnJlY3RBcmVhTFRDMSA9IFVuaWZvcm1zTGliLkxUQ19GTE9BVF8xOwoJCQkJc3RhdGUucmVjdEFyZWFMVEMyID0gVW5pZm9ybXNMaWIuTFRDX0ZMT0FUXzI7CgoJCQl9IGVsc2UgewoKCQkJCS8vIFdlYkdMIDEKCgkJCQlpZiAoIGV4dGVuc2lvbnMuaGFzKCAnT0VTX3RleHR1cmVfZmxvYXRfbGluZWFyJyApID09PSB0cnVlICkgewoKCQkJCQlzdGF0ZS5yZWN0QXJlYUxUQzEgPSBVbmlmb3Jtc0xpYi5MVENfRkxPQVRfMTsKCQkJCQlzdGF0ZS5yZWN0QXJlYUxUQzIgPSBVbmlmb3Jtc0xpYi5MVENfRkxPQVRfMjsKCgkJCQl9IGVsc2UgaWYgKCBleHRlbnNpb25zLmhhcyggJ09FU190ZXh0dXJlX2hhbGZfZmxvYXRfbGluZWFyJyApID09PSB0cnVlICkgewoKCQkJCQlzdGF0ZS5yZWN0QXJlYUxUQzEgPSBVbmlmb3Jtc0xpYi5MVENfSEFMRl8xOwoJCQkJCXN0YXRlLnJlY3RBcmVhTFRDMiA9IFVuaWZvcm1zTGliLkxUQ19IQUxGXzI7CgoJCQkJfSBlbHNlIHsKCgkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFVuYWJsZSB0byB1c2UgUmVjdEFyZWFMaWdodC4gTWlzc2luZyBXZWJHTCBleHRlbnNpb25zLicgKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJc3RhdGUuYW1iaWVudFsgMCBdID0gcjsKCQlzdGF0ZS5hbWJpZW50WyAxIF0gPSBnOwoJCXN0YXRlLmFtYmllbnRbIDIgXSA9IGI7CgoJCWNvbnN0IGhhc2ggPSBzdGF0ZS5oYXNoOwoKCQlpZiAoIGhhc2guZGlyZWN0aW9uYWxMZW5ndGggIT09IGRpcmVjdGlvbmFsTGVuZ3RoIHx8CgkJCWhhc2gucG9pbnRMZW5ndGggIT09IHBvaW50TGVuZ3RoIHx8CgkJCWhhc2guc3BvdExlbmd0aCAhPT0gc3BvdExlbmd0aCB8fAoJCQloYXNoLnJlY3RBcmVhTGVuZ3RoICE9PSByZWN0QXJlYUxlbmd0aCB8fAoJCQloYXNoLmhlbWlMZW5ndGggIT09IGhlbWlMZW5ndGggfHwKCQkJaGFzaC5udW1EaXJlY3Rpb25hbFNoYWRvd3MgIT09IG51bURpcmVjdGlvbmFsU2hhZG93cyB8fAoJCQloYXNoLm51bVBvaW50U2hhZG93cyAhPT0gbnVtUG9pbnRTaGFkb3dzIHx8CgkJCWhhc2gubnVtU3BvdFNoYWRvd3MgIT09IG51bVNwb3RTaGFkb3dzIHx8CgkJCWhhc2gubnVtU3BvdE1hcHMgIT09IG51bVNwb3RNYXBzIHx8CgkJCWhhc2gubnVtTGlnaHRQcm9iZXMgIT09IG51bUxpZ2h0UHJvYmVzICkgewoKCQkJc3RhdGUuZGlyZWN0aW9uYWwubGVuZ3RoID0gZGlyZWN0aW9uYWxMZW5ndGg7CgkJCXN0YXRlLnNwb3QubGVuZ3RoID0gc3BvdExlbmd0aDsKCQkJc3RhdGUucmVjdEFyZWEubGVuZ3RoID0gcmVjdEFyZWFMZW5ndGg7CgkJCXN0YXRlLnBvaW50Lmxlbmd0aCA9IHBvaW50TGVuZ3RoOwoJCQlzdGF0ZS5oZW1pLmxlbmd0aCA9IGhlbWlMZW5ndGg7CgoJCQlzdGF0ZS5kaXJlY3Rpb25hbFNoYWRvdy5sZW5ndGggPSBudW1EaXJlY3Rpb25hbFNoYWRvd3M7CgkJCXN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWFwLmxlbmd0aCA9IG51bURpcmVjdGlvbmFsU2hhZG93czsKCQkJc3RhdGUucG9pbnRTaGFkb3cubGVuZ3RoID0gbnVtUG9pbnRTaGFkb3dzOwoJCQlzdGF0ZS5wb2ludFNoYWRvd01hcC5sZW5ndGggPSBudW1Qb2ludFNoYWRvd3M7CgkJCXN0YXRlLnNwb3RTaGFkb3cubGVuZ3RoID0gbnVtU3BvdFNoYWRvd3M7CgkJCXN0YXRlLnNwb3RTaGFkb3dNYXAubGVuZ3RoID0gbnVtU3BvdFNoYWRvd3M7CgkJCXN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWF0cml4Lmxlbmd0aCA9IG51bURpcmVjdGlvbmFsU2hhZG93czsKCQkJc3RhdGUucG9pbnRTaGFkb3dNYXRyaXgubGVuZ3RoID0gbnVtUG9pbnRTaGFkb3dzOwoJCQlzdGF0ZS5zcG90TGlnaHRNYXRyaXgubGVuZ3RoID0gbnVtU3BvdFNoYWRvd3MgKyBudW1TcG90TWFwcyAtIG51bVNwb3RTaGFkb3dzV2l0aE1hcHM7CgkJCXN0YXRlLnNwb3RMaWdodE1hcC5sZW5ndGggPSBudW1TcG90TWFwczsKCQkJc3RhdGUubnVtU3BvdExpZ2h0U2hhZG93c1dpdGhNYXBzID0gbnVtU3BvdFNoYWRvd3NXaXRoTWFwczsKCQkJc3RhdGUubnVtTGlnaHRQcm9iZXMgPSBudW1MaWdodFByb2JlczsKCgkJCWhhc2guZGlyZWN0aW9uYWxMZW5ndGggPSBkaXJlY3Rpb25hbExlbmd0aDsKCQkJaGFzaC5wb2ludExlbmd0aCA9IHBvaW50TGVuZ3RoOwoJCQloYXNoLnNwb3RMZW5ndGggPSBzcG90TGVuZ3RoOwoJCQloYXNoLnJlY3RBcmVhTGVuZ3RoID0gcmVjdEFyZWFMZW5ndGg7CgkJCWhhc2guaGVtaUxlbmd0aCA9IGhlbWlMZW5ndGg7CgoJCQloYXNoLm51bURpcmVjdGlvbmFsU2hhZG93cyA9IG51bURpcmVjdGlvbmFsU2hhZG93czsKCQkJaGFzaC5udW1Qb2ludFNoYWRvd3MgPSBudW1Qb2ludFNoYWRvd3M7CgkJCWhhc2gubnVtU3BvdFNoYWRvd3MgPSBudW1TcG90U2hhZG93czsKCQkJaGFzaC5udW1TcG90TWFwcyA9IG51bVNwb3RNYXBzOwoKCQkJaGFzaC5udW1MaWdodFByb2JlcyA9IG51bUxpZ2h0UHJvYmVzOwoKCQkJc3RhdGUudmVyc2lvbiA9IG5leHRWZXJzaW9uICsrOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHNldHVwVmlldyggbGlnaHRzLCBjYW1lcmEgKSB7CgoJCWxldCBkaXJlY3Rpb25hbExlbmd0aCA9IDA7CgkJbGV0IHBvaW50TGVuZ3RoID0gMDsKCQlsZXQgc3BvdExlbmd0aCA9IDA7CgkJbGV0IHJlY3RBcmVhTGVuZ3RoID0gMDsKCQlsZXQgaGVtaUxlbmd0aCA9IDA7CgoJCWNvbnN0IHZpZXdNYXRyaXggPSBjYW1lcmEubWF0cml4V29ybGRJbnZlcnNlOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBsaWdodHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IGxpZ2h0ID0gbGlnaHRzWyBpIF07CgoJCQlpZiAoIGxpZ2h0LmlzRGlyZWN0aW9uYWxMaWdodCApIHsKCgkJCQljb25zdCB1bmlmb3JtcyA9IHN0YXRlLmRpcmVjdGlvbmFsWyBkaXJlY3Rpb25hbExlbmd0aCBdOwoKCQkJCXVuaWZvcm1zLmRpcmVjdGlvbi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0Lm1hdHJpeFdvcmxkICk7CgkJCQl2ZWN0b3IzLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQudGFyZ2V0Lm1hdHJpeFdvcmxkICk7CgkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24uc3ViKCB2ZWN0b3IzICk7CgkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24udHJhbnNmb3JtRGlyZWN0aW9uKCB2aWV3TWF0cml4ICk7CgoJCQkJZGlyZWN0aW9uYWxMZW5ndGggKys7CgoJCQl9IGVsc2UgaWYgKCBsaWdodC5pc1Nwb3RMaWdodCApIHsKCgkJCQljb25zdCB1bmlmb3JtcyA9IHN0YXRlLnNwb3RbIHNwb3RMZW5ndGggXTsKCgkJCQl1bmlmb3Jtcy5wb3NpdGlvbi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0Lm1hdHJpeFdvcmxkICk7CgkJCQl1bmlmb3Jtcy5wb3NpdGlvbi5hcHBseU1hdHJpeDQoIHZpZXdNYXRyaXggKTsKCgkJCQl1bmlmb3Jtcy5kaXJlY3Rpb24uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwoJCQkJdmVjdG9yMy5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0LnRhcmdldC5tYXRyaXhXb3JsZCApOwoJCQkJdW5pZm9ybXMuZGlyZWN0aW9uLnN1YiggdmVjdG9yMyApOwoJCQkJdW5pZm9ybXMuZGlyZWN0aW9uLnRyYW5zZm9ybURpcmVjdGlvbiggdmlld01hdHJpeCApOwoKCQkJCXNwb3RMZW5ndGggKys7CgoJCQl9IGVsc2UgaWYgKCBsaWdodC5pc1JlY3RBcmVhTGlnaHQgKSB7CgoJCQkJY29uc3QgdW5pZm9ybXMgPSBzdGF0ZS5yZWN0QXJlYVsgcmVjdEFyZWFMZW5ndGggXTsKCgkJCQl1bmlmb3Jtcy5wb3NpdGlvbi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIGxpZ2h0Lm1hdHJpeFdvcmxkICk7CgkJCQl1bmlmb3Jtcy5wb3NpdGlvbi5hcHBseU1hdHJpeDQoIHZpZXdNYXRyaXggKTsKCgkJCQkvLyBleHRyYWN0IGxvY2FsIHJvdGF0aW9uIG9mIGxpZ2h0IHRvIGRlcml2ZSB3aWR0aC9oZWlnaHQgaGFsZiB2ZWN0b3JzCgkJCQltYXRyaXg0Mi5pZGVudGl0eSgpOwoJCQkJbWF0cml4NC5jb3B5KCBsaWdodC5tYXRyaXhXb3JsZCApOwoJCQkJbWF0cml4NC5wcmVtdWx0aXBseSggdmlld01hdHJpeCApOwoJCQkJbWF0cml4NDIuZXh0cmFjdFJvdGF0aW9uKCBtYXRyaXg0ICk7CgoJCQkJdW5pZm9ybXMuaGFsZldpZHRoLnNldCggbGlnaHQud2lkdGggKiAwLjUsIDAuMCwgMC4wICk7CgkJCQl1bmlmb3Jtcy5oYWxmSGVpZ2h0LnNldCggMC4wLCBsaWdodC5oZWlnaHQgKiAwLjUsIDAuMCApOwoKCQkJCXVuaWZvcm1zLmhhbGZXaWR0aC5hcHBseU1hdHJpeDQoIG1hdHJpeDQyICk7CgkJCQl1bmlmb3Jtcy5oYWxmSGVpZ2h0LmFwcGx5TWF0cml4NCggbWF0cml4NDIgKTsKCgkJCQlyZWN0QXJlYUxlbmd0aCArKzsKCgkJCX0gZWxzZSBpZiAoIGxpZ2h0LmlzUG9pbnRMaWdodCApIHsKCgkJCQljb25zdCB1bmlmb3JtcyA9IHN0YXRlLnBvaW50WyBwb2ludExlbmd0aCBdOwoKCQkJCXVuaWZvcm1zLnBvc2l0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQubWF0cml4V29ybGQgKTsKCQkJCXVuaWZvcm1zLnBvc2l0aW9uLmFwcGx5TWF0cml4NCggdmlld01hdHJpeCApOwoKCQkJCXBvaW50TGVuZ3RoICsrOwoKCQkJfSBlbHNlIGlmICggbGlnaHQuaXNIZW1pc3BoZXJlTGlnaHQgKSB7CgoJCQkJY29uc3QgdW5pZm9ybXMgPSBzdGF0ZS5oZW1pWyBoZW1pTGVuZ3RoIF07CgoJCQkJdW5pZm9ybXMuZGlyZWN0aW9uLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQubWF0cml4V29ybGQgKTsKCQkJCXVuaWZvcm1zLmRpcmVjdGlvbi50cmFuc2Zvcm1EaXJlY3Rpb24oIHZpZXdNYXRyaXggKTsKCgkJCQloZW1pTGVuZ3RoICsrOwoKCQkJfQoKCQl9CgoJfQoKCXJldHVybiB7CgkJc2V0dXA6IHNldHVwLAoJCXNldHVwVmlldzogc2V0dXBWaWV3LAoJCXN0YXRlOiBzdGF0ZQoJfTsKCn0KCmZ1bmN0aW9uIFdlYkdMUmVuZGVyU3RhdGUoIGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcyApIHsKCgljb25zdCBsaWdodHMgPSBuZXcgV2ViR0xMaWdodHMoIGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcyApOwoKCWNvbnN0IGxpZ2h0c0FycmF5ID0gW107Cgljb25zdCBzaGFkb3dzQXJyYXkgPSBbXTsKCglmdW5jdGlvbiBpbml0KCkgewoKCQlsaWdodHNBcnJheS5sZW5ndGggPSAwOwoJCXNoYWRvd3NBcnJheS5sZW5ndGggPSAwOwoKCX0KCglmdW5jdGlvbiBwdXNoTGlnaHQoIGxpZ2h0ICkgewoKCQlsaWdodHNBcnJheS5wdXNoKCBsaWdodCApOwoKCX0KCglmdW5jdGlvbiBwdXNoU2hhZG93KCBzaGFkb3dMaWdodCApIHsKCgkJc2hhZG93c0FycmF5LnB1c2goIHNoYWRvd0xpZ2h0ICk7CgoJfQoKCWZ1bmN0aW9uIHNldHVwTGlnaHRzKCB1c2VMZWdhY3lMaWdodHMgKSB7CgoJCWxpZ2h0cy5zZXR1cCggbGlnaHRzQXJyYXksIHVzZUxlZ2FjeUxpZ2h0cyApOwoKCX0KCglmdW5jdGlvbiBzZXR1cExpZ2h0c1ZpZXcoIGNhbWVyYSApIHsKCgkJbGlnaHRzLnNldHVwVmlldyggbGlnaHRzQXJyYXksIGNhbWVyYSApOwoKCX0KCgljb25zdCBzdGF0ZSA9IHsKCQlsaWdodHNBcnJheTogbGlnaHRzQXJyYXksCgkJc2hhZG93c0FycmF5OiBzaGFkb3dzQXJyYXksCgoJCWxpZ2h0czogbGlnaHRzCgl9OwoKCXJldHVybiB7CgkJaW5pdDogaW5pdCwKCQlzdGF0ZTogc3RhdGUsCgkJc2V0dXBMaWdodHM6IHNldHVwTGlnaHRzLAoJCXNldHVwTGlnaHRzVmlldzogc2V0dXBMaWdodHNWaWV3LAoKCQlwdXNoTGlnaHQ6IHB1c2hMaWdodCwKCQlwdXNoU2hhZG93OiBwdXNoU2hhZG93Cgl9OwoKfQoKZnVuY3Rpb24gV2ViR0xSZW5kZXJTdGF0ZXMoIGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcyApIHsKCglsZXQgcmVuZGVyU3RhdGVzID0gbmV3IFdlYWtNYXAoKTsKCglmdW5jdGlvbiBnZXQoIHNjZW5lLCByZW5kZXJDYWxsRGVwdGggPSAwICkgewoKCQljb25zdCByZW5kZXJTdGF0ZUFycmF5ID0gcmVuZGVyU3RhdGVzLmdldCggc2NlbmUgKTsKCQlsZXQgcmVuZGVyU3RhdGU7CgoJCWlmICggcmVuZGVyU3RhdGVBcnJheSA9PT0gdW5kZWZpbmVkICkgewoKCQkJcmVuZGVyU3RhdGUgPSBuZXcgV2ViR0xSZW5kZXJTdGF0ZSggZXh0ZW5zaW9ucywgY2FwYWJpbGl0aWVzICk7CgkJCXJlbmRlclN0YXRlcy5zZXQoIHNjZW5lLCBbIHJlbmRlclN0YXRlIF0gKTsKCgkJfSBlbHNlIHsKCgkJCWlmICggcmVuZGVyQ2FsbERlcHRoID49IHJlbmRlclN0YXRlQXJyYXkubGVuZ3RoICkgewoKCQkJCXJlbmRlclN0YXRlID0gbmV3IFdlYkdMUmVuZGVyU3RhdGUoIGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcyApOwoJCQkJcmVuZGVyU3RhdGVBcnJheS5wdXNoKCByZW5kZXJTdGF0ZSApOwoKCQkJfSBlbHNlIHsKCgkJCQlyZW5kZXJTdGF0ZSA9IHJlbmRlclN0YXRlQXJyYXlbIHJlbmRlckNhbGxEZXB0aCBdOwoKCQkJfQoKCQl9CgoJCXJldHVybiByZW5kZXJTdGF0ZTsKCgl9CgoJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCgkJcmVuZGVyU3RhdGVzID0gbmV3IFdlYWtNYXAoKTsKCgl9CgoJcmV0dXJuIHsKCQlnZXQ6IGdldCwKCQlkaXNwb3NlOiBkaXNwb3NlCgl9OwoKfQoKY2xhc3MgTWVzaERlcHRoTWF0ZXJpYWwgZXh0ZW5kcyBNYXRlcmlhbCB7CgoJY29uc3RydWN0b3IoIHBhcmFtZXRlcnMgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMuaXNNZXNoRGVwdGhNYXRlcmlhbCA9IHRydWU7CgoJCXRoaXMudHlwZSA9ICdNZXNoRGVwdGhNYXRlcmlhbCc7CgoJCXRoaXMuZGVwdGhQYWNraW5nID0gQmFzaWNEZXB0aFBhY2tpbmc7CgoJCXRoaXMubWFwID0gbnVsbDsKCgkJdGhpcy5hbHBoYU1hcCA9IG51bGw7CgoJCXRoaXMuZGlzcGxhY2VtZW50TWFwID0gbnVsbDsKCQl0aGlzLmRpc3BsYWNlbWVudFNjYWxlID0gMTsKCQl0aGlzLmRpc3BsYWNlbWVudEJpYXMgPSAwOwoKCQl0aGlzLndpcmVmcmFtZSA9IGZhbHNlOwoJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gMTsKCgkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5kZXB0aFBhY2tpbmcgPSBzb3VyY2UuZGVwdGhQYWNraW5nOwoKCQl0aGlzLm1hcCA9IHNvdXJjZS5tYXA7CgoJCXRoaXMuYWxwaGFNYXAgPSBzb3VyY2UuYWxwaGFNYXA7CgoJCXRoaXMuZGlzcGxhY2VtZW50TWFwID0gc291cmNlLmRpc3BsYWNlbWVudE1hcDsKCQl0aGlzLmRpc3BsYWNlbWVudFNjYWxlID0gc291cmNlLmRpc3BsYWNlbWVudFNjYWxlOwoJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IHNvdXJjZS5kaXNwbGFjZW1lbnRCaWFzOwoKCQl0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CgkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSBzb3VyY2Uud2lyZWZyYW1lTGluZXdpZHRoOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpjbGFzcyBNZXNoRGlzdGFuY2VNYXRlcmlhbCBleHRlbmRzIE1hdGVyaWFsIHsKCgljb25zdHJ1Y3RvciggcGFyYW1ldGVycyApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc01lc2hEaXN0YW5jZU1hdGVyaWFsID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ01lc2hEaXN0YW5jZU1hdGVyaWFsJzsKCgkJdGhpcy5tYXAgPSBudWxsOwoKCQl0aGlzLmFscGhhTWFwID0gbnVsbDsKCgkJdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBudWxsOwoJCXRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSAxOwoJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IDA7CgoJCXRoaXMuc2V0VmFsdWVzKCBwYXJhbWV0ZXJzICk7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMubWFwID0gc291cmNlLm1hcDsKCgkJdGhpcy5hbHBoYU1hcCA9IHNvdXJjZS5hbHBoYU1hcDsKCgkJdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBzb3VyY2UuZGlzcGxhY2VtZW50TWFwOwoJCXRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSBzb3VyY2UuZGlzcGxhY2VtZW50U2NhbGU7CgkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gc291cmNlLmRpc3BsYWNlbWVudEJpYXM7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNvbnN0IHZlcnRleCA9ICJ2b2lkIG1haW4oKSB7XG5cdGdsX1Bvc2l0aW9uID0gdmVjNCggcG9zaXRpb24sIDEuMCApO1xufSI7Cgpjb25zdCBmcmFnbWVudCA9ICJ1bmlmb3JtIHNhbXBsZXIyRCBzaGFkb3dfcGFzcztcbnVuaWZvcm0gdmVjMiByZXNvbHV0aW9uO1xudW5pZm9ybSBmbG9hdCByYWRpdXM7XG4jaW5jbHVkZSA8cGFja2luZz5cbnZvaWQgbWFpbigpIHtcblx0Y29uc3QgZmxvYXQgc2FtcGxlcyA9IGZsb2F0KCBWU01fU0FNUExFUyApO1xuXHRmbG9hdCBtZWFuID0gMC4wO1xuXHRmbG9hdCBzcXVhcmVkX21lYW4gPSAwLjA7XG5cdGZsb2F0IHV2U3RyaWRlID0gc2FtcGxlcyA8PSAxLjAgPyAwLjAgOiAyLjAgLyAoIHNhbXBsZXMgLSAxLjAgKTtcblx0ZmxvYXQgdXZTdGFydCA9IHNhbXBsZXMgPD0gMS4wID8gMC4wIDogLSAxLjA7XG5cdGZvciAoIGZsb2F0IGkgPSAwLjA7IGkgPCBzYW1wbGVzOyBpICsrICkge1xuXHRcdGZsb2F0IHV2T2Zmc2V0ID0gdXZTdGFydCArIGkgKiB1dlN0cmlkZTtcblx0XHQjaWZkZWYgSE9SSVpPTlRBTF9QQVNTXG5cdFx0XHR2ZWMyIGRpc3RyaWJ1dGlvbiA9IHVucGFja1JHQkFUbzJIYWxmKCB0ZXh0dXJlMkQoIHNoYWRvd19wYXNzLCAoIGdsX0ZyYWdDb29yZC54eSArIHZlYzIoIHV2T2Zmc2V0LCAwLjAgKSAqIHJhZGl1cyApIC8gcmVzb2x1dGlvbiApICk7XG5cdFx0XHRtZWFuICs9IGRpc3RyaWJ1dGlvbi54O1xuXHRcdFx0c3F1YXJlZF9tZWFuICs9IGRpc3RyaWJ1dGlvbi55ICogZGlzdHJpYnV0aW9uLnkgKyBkaXN0cmlidXRpb24ueCAqIGRpc3RyaWJ1dGlvbi54O1xuXHRcdCNlbHNlXG5cdFx0XHRmbG9hdCBkZXB0aCA9IHVucGFja1JHQkFUb0RlcHRoKCB0ZXh0dXJlMkQoIHNoYWRvd19wYXNzLCAoIGdsX0ZyYWdDb29yZC54eSArIHZlYzIoIDAuMCwgdXZPZmZzZXQgKSAqIHJhZGl1cyApIC8gcmVzb2x1dGlvbiApICk7XG5cdFx0XHRtZWFuICs9IGRlcHRoO1xuXHRcdFx0c3F1YXJlZF9tZWFuICs9IGRlcHRoICogZGVwdGg7XG5cdFx0I2VuZGlmXG5cdH1cblx0bWVhbiA9IG1lYW4gLyBzYW1wbGVzO1xuXHRzcXVhcmVkX21lYW4gPSBzcXVhcmVkX21lYW4gLyBzYW1wbGVzO1xuXHRmbG9hdCBzdGRfZGV2ID0gc3FydCggc3F1YXJlZF9tZWFuIC0gbWVhbiAqIG1lYW4gKTtcblx0Z2xfRnJhZ0NvbG9yID0gcGFjazJIYWxmVG9SR0JBKCB2ZWMyKCBtZWFuLCBzdGRfZGV2ICkgKTtcbn0iOwoKZnVuY3Rpb24gV2ViR0xTaGFkb3dNYXAoIF9yZW5kZXJlciwgX29iamVjdHMsIF9jYXBhYmlsaXRpZXMgKSB7CgoJbGV0IF9mcnVzdHVtID0gbmV3IEZydXN0dW0oKTsKCgljb25zdCBfc2hhZG93TWFwU2l6ZSA9IG5ldyBWZWN0b3IyKCksCgkJX3ZpZXdwb3J0U2l6ZSA9IG5ldyBWZWN0b3IyKCksCgoJCV92aWV3cG9ydCA9IG5ldyBWZWN0b3I0KCksCgoJCV9kZXB0aE1hdGVyaWFsID0gbmV3IE1lc2hEZXB0aE1hdGVyaWFsKCB7IGRlcHRoUGFja2luZzogUkdCQURlcHRoUGFja2luZyB9ICksCgkJX2Rpc3RhbmNlTWF0ZXJpYWwgPSBuZXcgTWVzaERpc3RhbmNlTWF0ZXJpYWwoKSwKCgkJX21hdGVyaWFsQ2FjaGUgPSB7fSwKCgkJX21heFRleHR1cmVTaXplID0gX2NhcGFiaWxpdGllcy5tYXhUZXh0dXJlU2l6ZTsKCgljb25zdCBzaGFkb3dTaWRlID0geyBbIEZyb250U2lkZSBdOiBCYWNrU2lkZSwgWyBCYWNrU2lkZSBdOiBGcm9udFNpZGUsIFsgRG91YmxlU2lkZSBdOiBEb3VibGVTaWRlIH07CgoJY29uc3Qgc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbCA9IG5ldyBTaGFkZXJNYXRlcmlhbCggewoJCWRlZmluZXM6IHsKCQkJVlNNX1NBTVBMRVM6IDgKCQl9LAoJCXVuaWZvcm1zOiB7CgkJCXNoYWRvd19wYXNzOiB7IHZhbHVlOiBudWxsIH0sCgkJCXJlc29sdXRpb246IHsgdmFsdWU6IG5ldyBWZWN0b3IyKCkgfSwKCQkJcmFkaXVzOiB7IHZhbHVlOiA0LjAgfQoJCX0sCgoJCXZlcnRleFNoYWRlcjogdmVydGV4LAoJCWZyYWdtZW50U2hhZGVyOiBmcmFnbWVudAoKCX0gKTsKCgljb25zdCBzaGFkb3dNYXRlcmlhbEhvcml6b250YWwgPSBzaGFkb3dNYXRlcmlhbFZlcnRpY2FsLmNsb25lKCk7CglzaGFkb3dNYXRlcmlhbEhvcml6b250YWwuZGVmaW5lcy5IT1JJWk9OVEFMX1BBU1MgPSAxOwoKCWNvbnN0IGZ1bGxTY3JlZW5UcmkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCWZ1bGxTY3JlZW5Ucmkuc2V0QXR0cmlidXRlKAoJCSdwb3NpdGlvbicsCgkJbmV3IEJ1ZmZlckF0dHJpYnV0ZSgKCQkJbmV3IEZsb2F0MzJBcnJheSggWyAtIDEsIC0gMSwgMC41LCAzLCAtIDEsIDAuNSwgLSAxLCAzLCAwLjUgXSApLAoJCQkzCgkJKQoJKTsKCgljb25zdCBmdWxsU2NyZWVuTWVzaCA9IG5ldyBNZXNoKCBmdWxsU2NyZWVuVHJpLCBzaGFkb3dNYXRlcmlhbFZlcnRpY2FsICk7CgoJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCXRoaXMuZW5hYmxlZCA9IGZhbHNlOwoKCXRoaXMuYXV0b1VwZGF0ZSA9IHRydWU7Cgl0aGlzLm5lZWRzVXBkYXRlID0gZmFsc2U7CgoJdGhpcy50eXBlID0gUENGU2hhZG93TWFwOwoJbGV0IF9wcmV2aW91c1R5cGUgPSB0aGlzLnR5cGU7CgoJdGhpcy5yZW5kZXIgPSBmdW5jdGlvbiAoIGxpZ2h0cywgc2NlbmUsIGNhbWVyYSApIHsKCgkJaWYgKCBzY29wZS5lbmFibGVkID09PSBmYWxzZSApIHJldHVybjsKCQlpZiAoIHNjb3BlLmF1dG9VcGRhdGUgPT09IGZhbHNlICYmIHNjb3BlLm5lZWRzVXBkYXRlID09PSBmYWxzZSApIHJldHVybjsKCgkJaWYgKCBsaWdodHMubGVuZ3RoID09PSAwICkgcmV0dXJuOwoKCQljb25zdCBjdXJyZW50UmVuZGVyVGFyZ2V0ID0gX3JlbmRlcmVyLmdldFJlbmRlclRhcmdldCgpOwoJCWNvbnN0IGFjdGl2ZUN1YmVGYWNlID0gX3JlbmRlcmVyLmdldEFjdGl2ZUN1YmVGYWNlKCk7CgkJY29uc3QgYWN0aXZlTWlwbWFwTGV2ZWwgPSBfcmVuZGVyZXIuZ2V0QWN0aXZlTWlwbWFwTGV2ZWwoKTsKCgkJY29uc3QgX3N0YXRlID0gX3JlbmRlcmVyLnN0YXRlOwoKCQkvLyBTZXQgR0wgc3RhdGUgZm9yIGRlcHRoIG1hcC4KCQlfc3RhdGUuc2V0QmxlbmRpbmcoIE5vQmxlbmRpbmcgKTsKCQlfc3RhdGUuYnVmZmVycy5jb2xvci5zZXRDbGVhciggMSwgMSwgMSwgMSApOwoJCV9zdGF0ZS5idWZmZXJzLmRlcHRoLnNldFRlc3QoIHRydWUgKTsKCQlfc3RhdGUuc2V0U2Npc3NvclRlc3QoIGZhbHNlICk7CgoJCS8vIGNoZWNrIGZvciBzaGFkb3cgbWFwIHR5cGUgY2hhbmdlcwoKCQljb25zdCB0b1ZTTSA9ICggX3ByZXZpb3VzVHlwZSAhPT0gVlNNU2hhZG93TWFwICYmIHRoaXMudHlwZSA9PT0gVlNNU2hhZG93TWFwICk7CgkJY29uc3QgZnJvbVZTTSA9ICggX3ByZXZpb3VzVHlwZSA9PT0gVlNNU2hhZG93TWFwICYmIHRoaXMudHlwZSAhPT0gVlNNU2hhZG93TWFwICk7CgoJCS8vIHJlbmRlciBkZXB0aCBtYXAKCgkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGxpZ2h0cy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCWNvbnN0IGxpZ2h0ID0gbGlnaHRzWyBpIF07CgkJCWNvbnN0IHNoYWRvdyA9IGxpZ2h0LnNoYWRvdzsKCgkJCWlmICggc2hhZG93ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xTaGFkb3dNYXA6JywgbGlnaHQsICdoYXMgbm8gc2hhZG93LicgKTsKCQkJCWNvbnRpbnVlOwoKCQkJfQoKCQkJaWYgKCBzaGFkb3cuYXV0b1VwZGF0ZSA9PT0gZmFsc2UgJiYgc2hhZG93Lm5lZWRzVXBkYXRlID09PSBmYWxzZSApIGNvbnRpbnVlOwoKCQkJX3NoYWRvd01hcFNpemUuY29weSggc2hhZG93Lm1hcFNpemUgKTsKCgkJCWNvbnN0IHNoYWRvd0ZyYW1lRXh0ZW50cyA9IHNoYWRvdy5nZXRGcmFtZUV4dGVudHMoKTsKCgkJCV9zaGFkb3dNYXBTaXplLm11bHRpcGx5KCBzaGFkb3dGcmFtZUV4dGVudHMgKTsKCgkJCV92aWV3cG9ydFNpemUuY29weSggc2hhZG93Lm1hcFNpemUgKTsKCgkJCWlmICggX3NoYWRvd01hcFNpemUueCA+IF9tYXhUZXh0dXJlU2l6ZSB8fCBfc2hhZG93TWFwU2l6ZS55ID4gX21heFRleHR1cmVTaXplICkgewoKCQkJCWlmICggX3NoYWRvd01hcFNpemUueCA+IF9tYXhUZXh0dXJlU2l6ZSApIHsKCgkJCQkJX3ZpZXdwb3J0U2l6ZS54ID0gTWF0aC5mbG9vciggX21heFRleHR1cmVTaXplIC8gc2hhZG93RnJhbWVFeHRlbnRzLnggKTsKCQkJCQlfc2hhZG93TWFwU2l6ZS54ID0gX3ZpZXdwb3J0U2l6ZS54ICogc2hhZG93RnJhbWVFeHRlbnRzLng7CgkJCQkJc2hhZG93Lm1hcFNpemUueCA9IF92aWV3cG9ydFNpemUueDsKCgkJCQl9CgoJCQkJaWYgKCBfc2hhZG93TWFwU2l6ZS55ID4gX21heFRleHR1cmVTaXplICkgewoKCQkJCQlfdmlld3BvcnRTaXplLnkgPSBNYXRoLmZsb29yKCBfbWF4VGV4dHVyZVNpemUgLyBzaGFkb3dGcmFtZUV4dGVudHMueSApOwoJCQkJCV9zaGFkb3dNYXBTaXplLnkgPSBfdmlld3BvcnRTaXplLnkgKiBzaGFkb3dGcmFtZUV4dGVudHMueTsKCQkJCQlzaGFkb3cubWFwU2l6ZS55ID0gX3ZpZXdwb3J0U2l6ZS55OwoKCQkJCX0KCgkJCX0KCgkJCWlmICggc2hhZG93Lm1hcCA9PT0gbnVsbCB8fCB0b1ZTTSA9PT0gdHJ1ZSB8fCBmcm9tVlNNID09PSB0cnVlICkgewoKCQkJCWNvbnN0IHBhcnMgPSAoIHRoaXMudHlwZSAhPT0gVlNNU2hhZG93TWFwICkgPyB7IG1pbkZpbHRlcjogTmVhcmVzdEZpbHRlciwgbWFnRmlsdGVyOiBOZWFyZXN0RmlsdGVyIH0gOiB7fTsKCgkJCQlpZiAoIHNoYWRvdy5tYXAgIT09IG51bGwgKSB7CgoJCQkJCXNoYWRvdy5tYXAuZGlzcG9zZSgpOwoKCQkJCX0KCgkJCQlzaGFkb3cubWFwID0gbmV3IFdlYkdMUmVuZGVyVGFyZ2V0KCBfc2hhZG93TWFwU2l6ZS54LCBfc2hhZG93TWFwU2l6ZS55LCBwYXJzICk7CgkJCQlzaGFkb3cubWFwLnRleHR1cmUubmFtZSA9IGxpZ2h0Lm5hbWUgKyAnLnNoYWRvd01hcCc7CgoJCQkJc2hhZG93LmNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CgoJCQl9CgoJCQlfcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBzaGFkb3cubWFwICk7CgkJCV9yZW5kZXJlci5jbGVhcigpOwoKCQkJY29uc3Qgdmlld3BvcnRDb3VudCA9IHNoYWRvdy5nZXRWaWV3cG9ydENvdW50KCk7CgoJCQlmb3IgKCBsZXQgdnAgPSAwOyB2cCA8IHZpZXdwb3J0Q291bnQ7IHZwICsrICkgewoKCQkJCWNvbnN0IHZpZXdwb3J0ID0gc2hhZG93LmdldFZpZXdwb3J0KCB2cCApOwoKCQkJCV92aWV3cG9ydC5zZXQoCgkJCQkJX3ZpZXdwb3J0U2l6ZS54ICogdmlld3BvcnQueCwKCQkJCQlfdmlld3BvcnRTaXplLnkgKiB2aWV3cG9ydC55LAoJCQkJCV92aWV3cG9ydFNpemUueCAqIHZpZXdwb3J0LnosCgkJCQkJX3ZpZXdwb3J0U2l6ZS55ICogdmlld3BvcnQudwoJCQkJKTsKCgkJCQlfc3RhdGUudmlld3BvcnQoIF92aWV3cG9ydCApOwoKCQkJCXNoYWRvdy51cGRhdGVNYXRyaWNlcyggbGlnaHQsIHZwICk7CgoJCQkJX2ZydXN0dW0gPSBzaGFkb3cuZ2V0RnJ1c3R1bSgpOwoKCQkJCXJlbmRlck9iamVjdCggc2NlbmUsIGNhbWVyYSwgc2hhZG93LmNhbWVyYSwgbGlnaHQsIHRoaXMudHlwZSApOwoKCQkJfQoKCQkJLy8gZG8gYmx1ciBwYXNzIGZvciBWU00KCgkJCWlmICggc2hhZG93LmlzUG9pbnRMaWdodFNoYWRvdyAhPT0gdHJ1ZSAmJiB0aGlzLnR5cGUgPT09IFZTTVNoYWRvd01hcCApIHsKCgkJCQlWU01QYXNzKCBzaGFkb3csIGNhbWVyYSApOwoKCQkJfQoKCQkJc2hhZG93Lm5lZWRzVXBkYXRlID0gZmFsc2U7CgoJCX0KCgkJX3ByZXZpb3VzVHlwZSA9IHRoaXMudHlwZTsKCgkJc2NvcGUubmVlZHNVcGRhdGUgPSBmYWxzZTsKCgkJX3JlbmRlcmVyLnNldFJlbmRlclRhcmdldCggY3VycmVudFJlbmRlclRhcmdldCwgYWN0aXZlQ3ViZUZhY2UsIGFjdGl2ZU1pcG1hcExldmVsICk7CgoJfTsKCglmdW5jdGlvbiBWU01QYXNzKCBzaGFkb3csIGNhbWVyYSApIHsKCgkJY29uc3QgZ2VvbWV0cnkgPSBfb2JqZWN0cy51cGRhdGUoIGZ1bGxTY3JlZW5NZXNoICk7CgoJCWlmICggc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC5kZWZpbmVzLlZTTV9TQU1QTEVTICE9PSBzaGFkb3cuYmx1clNhbXBsZXMgKSB7CgoJCQlzaGFkb3dNYXRlcmlhbFZlcnRpY2FsLmRlZmluZXMuVlNNX1NBTVBMRVMgPSBzaGFkb3cuYmx1clNhbXBsZXM7CgkJCXNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbC5kZWZpbmVzLlZTTV9TQU1QTEVTID0gc2hhZG93LmJsdXJTYW1wbGVzOwoKCQkJc2hhZG93TWF0ZXJpYWxWZXJ0aWNhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgkJCXNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCX0KCgkJaWYgKCBzaGFkb3cubWFwUGFzcyA9PT0gbnVsbCApIHsKCgkJCXNoYWRvdy5tYXBQYXNzID0gbmV3IFdlYkdMUmVuZGVyVGFyZ2V0KCBfc2hhZG93TWFwU2l6ZS54LCBfc2hhZG93TWFwU2l6ZS55ICk7CgoJCX0KCgkJLy8gdmVydGljYWwgcGFzcwoKCQlzaGFkb3dNYXRlcmlhbFZlcnRpY2FsLnVuaWZvcm1zLnNoYWRvd19wYXNzLnZhbHVlID0gc2hhZG93Lm1hcC50ZXh0dXJlOwoJCXNoYWRvd01hdGVyaWFsVmVydGljYWwudW5pZm9ybXMucmVzb2x1dGlvbi52YWx1ZSA9IHNoYWRvdy5tYXBTaXplOwoJCXNoYWRvd01hdGVyaWFsVmVydGljYWwudW5pZm9ybXMucmFkaXVzLnZhbHVlID0gc2hhZG93LnJhZGl1czsKCQlfcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBzaGFkb3cubWFwUGFzcyApOwoJCV9yZW5kZXJlci5jbGVhcigpOwoJCV9yZW5kZXJlci5yZW5kZXJCdWZmZXJEaXJlY3QoIGNhbWVyYSwgbnVsbCwgZ2VvbWV0cnksIHNoYWRvd01hdGVyaWFsVmVydGljYWwsIGZ1bGxTY3JlZW5NZXNoLCBudWxsICk7CgoJCS8vIGhvcml6b250YWwgcGFzcwoKCQlzaGFkb3dNYXRlcmlhbEhvcml6b250YWwudW5pZm9ybXMuc2hhZG93X3Bhc3MudmFsdWUgPSBzaGFkb3cubWFwUGFzcy50ZXh0dXJlOwoJCXNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbC51bmlmb3Jtcy5yZXNvbHV0aW9uLnZhbHVlID0gc2hhZG93Lm1hcFNpemU7CgkJc2hhZG93TWF0ZXJpYWxIb3Jpem9udGFsLnVuaWZvcm1zLnJhZGl1cy52YWx1ZSA9IHNoYWRvdy5yYWRpdXM7CgkJX3JlbmRlcmVyLnNldFJlbmRlclRhcmdldCggc2hhZG93Lm1hcCApOwoJCV9yZW5kZXJlci5jbGVhcigpOwoJCV9yZW5kZXJlci5yZW5kZXJCdWZmZXJEaXJlY3QoIGNhbWVyYSwgbnVsbCwgZ2VvbWV0cnksIHNoYWRvd01hdGVyaWFsSG9yaXpvbnRhbCwgZnVsbFNjcmVlbk1lc2gsIG51bGwgKTsKCgl9CgoJZnVuY3Rpb24gZ2V0RGVwdGhNYXRlcmlhbCggb2JqZWN0LCBtYXRlcmlhbCwgbGlnaHQsIHR5cGUgKSB7CgoJCWxldCByZXN1bHQgPSBudWxsOwoKCQljb25zdCBjdXN0b21NYXRlcmlhbCA9ICggbGlnaHQuaXNQb2ludExpZ2h0ID09PSB0cnVlICkgPyBvYmplY3QuY3VzdG9tRGlzdGFuY2VNYXRlcmlhbCA6IG9iamVjdC5jdXN0b21EZXB0aE1hdGVyaWFsOwoKCQlpZiAoIGN1c3RvbU1hdGVyaWFsICE9PSB1bmRlZmluZWQgKSB7CgoJCQlyZXN1bHQgPSBjdXN0b21NYXRlcmlhbDsKCgkJfSBlbHNlIHsKCgkJCXJlc3VsdCA9ICggbGlnaHQuaXNQb2ludExpZ2h0ID09PSB0cnVlICkgPyBfZGlzdGFuY2VNYXRlcmlhbCA6IF9kZXB0aE1hdGVyaWFsOwoKCQkJaWYgKCAoIF9yZW5kZXJlci5sb2NhbENsaXBwaW5nRW5hYmxlZCAmJiBtYXRlcmlhbC5jbGlwU2hhZG93cyA9PT0gdHJ1ZSAmJiBBcnJheS5pc0FycmF5KCBtYXRlcmlhbC5jbGlwcGluZ1BsYW5lcyApICYmIG1hdGVyaWFsLmNsaXBwaW5nUGxhbmVzLmxlbmd0aCAhPT0gMCApIHx8CgkJCQkoIG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcCAmJiBtYXRlcmlhbC5kaXNwbGFjZW1lbnRTY2FsZSAhPT0gMCApIHx8CgkJCQkoIG1hdGVyaWFsLmFscGhhTWFwICYmIG1hdGVyaWFsLmFscGhhVGVzdCA+IDAgKSB8fAoJCQkJKCBtYXRlcmlhbC5tYXAgJiYgbWF0ZXJpYWwuYWxwaGFUZXN0ID4gMCApICkgewoKCQkJCS8vIGluIHRoaXMgY2FzZSB3ZSBuZWVkIGEgdW5pcXVlIG1hdGVyaWFsIGluc3RhbmNlIHJlZmxlY3RpbmcgdGhlCgkJCQkvLyBhcHByb3ByaWF0ZSBzdGF0ZQoKCQkJCWNvbnN0IGtleUEgPSByZXN1bHQudXVpZCwga2V5QiA9IG1hdGVyaWFsLnV1aWQ7CgoJCQkJbGV0IG1hdGVyaWFsc0ZvclZhcmlhbnQgPSBfbWF0ZXJpYWxDYWNoZVsga2V5QSBdOwoKCQkJCWlmICggbWF0ZXJpYWxzRm9yVmFyaWFudCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQltYXRlcmlhbHNGb3JWYXJpYW50ID0ge307CgkJCQkJX21hdGVyaWFsQ2FjaGVbIGtleUEgXSA9IG1hdGVyaWFsc0ZvclZhcmlhbnQ7CgoJCQkJfQoKCQkJCWxldCBjYWNoZWRNYXRlcmlhbCA9IG1hdGVyaWFsc0ZvclZhcmlhbnRbIGtleUIgXTsKCgkJCQlpZiAoIGNhY2hlZE1hdGVyaWFsID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCWNhY2hlZE1hdGVyaWFsID0gcmVzdWx0LmNsb25lKCk7CgkJCQkJbWF0ZXJpYWxzRm9yVmFyaWFudFsga2V5QiBdID0gY2FjaGVkTWF0ZXJpYWw7CgoJCQkJfQoKCQkJCXJlc3VsdCA9IGNhY2hlZE1hdGVyaWFsOwoKCQkJfQoKCQl9CgoJCXJlc3VsdC52aXNpYmxlID0gbWF0ZXJpYWwudmlzaWJsZTsKCQlyZXN1bHQud2lyZWZyYW1lID0gbWF0ZXJpYWwud2lyZWZyYW1lOwoKCQlpZiAoIHR5cGUgPT09IFZTTVNoYWRvd01hcCApIHsKCgkJCXJlc3VsdC5zaWRlID0gKCBtYXRlcmlhbC5zaGFkb3dTaWRlICE9PSBudWxsICkgPyBtYXRlcmlhbC5zaGFkb3dTaWRlIDogbWF0ZXJpYWwuc2lkZTsKCgkJfSBlbHNlIHsKCgkJCXJlc3VsdC5zaWRlID0gKCBtYXRlcmlhbC5zaGFkb3dTaWRlICE9PSBudWxsICkgPyBtYXRlcmlhbC5zaGFkb3dTaWRlIDogc2hhZG93U2lkZVsgbWF0ZXJpYWwuc2lkZSBdOwoKCQl9CgoJCXJlc3VsdC5hbHBoYU1hcCA9IG1hdGVyaWFsLmFscGhhTWFwOwoJCXJlc3VsdC5hbHBoYVRlc3QgPSBtYXRlcmlhbC5hbHBoYVRlc3Q7CgkJcmVzdWx0Lm1hcCA9IG1hdGVyaWFsLm1hcDsKCgkJcmVzdWx0LmNsaXBTaGFkb3dzID0gbWF0ZXJpYWwuY2xpcFNoYWRvd3M7CgkJcmVzdWx0LmNsaXBwaW5nUGxhbmVzID0gbWF0ZXJpYWwuY2xpcHBpbmdQbGFuZXM7CgkJcmVzdWx0LmNsaXBJbnRlcnNlY3Rpb24gPSBtYXRlcmlhbC5jbGlwSW50ZXJzZWN0aW9uOwoKCQlyZXN1bHQuZGlzcGxhY2VtZW50TWFwID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50TWFwOwoJCXJlc3VsdC5kaXNwbGFjZW1lbnRTY2FsZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudFNjYWxlOwoJCXJlc3VsdC5kaXNwbGFjZW1lbnRCaWFzID0gbWF0ZXJpYWwuZGlzcGxhY2VtZW50QmlhczsKCgkJcmVzdWx0LndpcmVmcmFtZUxpbmV3aWR0aCA9IG1hdGVyaWFsLndpcmVmcmFtZUxpbmV3aWR0aDsKCQlyZXN1bHQubGluZXdpZHRoID0gbWF0ZXJpYWwubGluZXdpZHRoOwoKCQlpZiAoIGxpZ2h0LmlzUG9pbnRMaWdodCA9PT0gdHJ1ZSAmJiByZXN1bHQuaXNNZXNoRGlzdGFuY2VNYXRlcmlhbCA9PT0gdHJ1ZSApIHsKCgkJCWNvbnN0IG1hdGVyaWFsUHJvcGVydGllcyA9IF9yZW5kZXJlci5wcm9wZXJ0aWVzLmdldCggcmVzdWx0ICk7CgkJCW1hdGVyaWFsUHJvcGVydGllcy5saWdodCA9IGxpZ2h0OwoKCQl9CgoJCXJldHVybiByZXN1bHQ7CgoJfQoKCWZ1bmN0aW9uIHJlbmRlck9iamVjdCggb2JqZWN0LCBjYW1lcmEsIHNoYWRvd0NhbWVyYSwgbGlnaHQsIHR5cGUgKSB7CgoJCWlmICggb2JqZWN0LnZpc2libGUgPT09IGZhbHNlICkgcmV0dXJuOwoKCQljb25zdCB2aXNpYmxlID0gb2JqZWN0LmxheWVycy50ZXN0KCBjYW1lcmEubGF5ZXJzICk7CgoJCWlmICggdmlzaWJsZSAmJiAoIG9iamVjdC5pc01lc2ggfHwgb2JqZWN0LmlzTGluZSB8fCBvYmplY3QuaXNQb2ludHMgKSApIHsKCgkJCWlmICggKCBvYmplY3QuY2FzdFNoYWRvdyB8fCAoIG9iamVjdC5yZWNlaXZlU2hhZG93ICYmIHR5cGUgPT09IFZTTVNoYWRvd01hcCApICkgJiYgKCAhIG9iamVjdC5mcnVzdHVtQ3VsbGVkIHx8IF9mcnVzdHVtLmludGVyc2VjdHNPYmplY3QoIG9iamVjdCApICkgKSB7CgoJCQkJb2JqZWN0Lm1vZGVsVmlld01hdHJpeC5tdWx0aXBseU1hdHJpY2VzKCBzaGFkb3dDYW1lcmEubWF0cml4V29ybGRJbnZlcnNlLCBvYmplY3QubWF0cml4V29ybGQgKTsKCgkJCQljb25zdCBnZW9tZXRyeSA9IF9vYmplY3RzLnVwZGF0ZSggb2JqZWN0ICk7CgkJCQljb25zdCBtYXRlcmlhbCA9IG9iamVjdC5tYXRlcmlhbDsKCgkJCQlpZiAoIEFycmF5LmlzQXJyYXkoIG1hdGVyaWFsICkgKSB7CgoJCQkJCWNvbnN0IGdyb3VwcyA9IGdlb21ldHJ5Lmdyb3VwczsKCgkJCQkJZm9yICggbGV0IGsgPSAwLCBrbCA9IGdyb3Vwcy5sZW5ndGg7IGsgPCBrbDsgayArKyApIHsKCgkJCQkJCWNvbnN0IGdyb3VwID0gZ3JvdXBzWyBrIF07CgkJCQkJCWNvbnN0IGdyb3VwTWF0ZXJpYWwgPSBtYXRlcmlhbFsgZ3JvdXAubWF0ZXJpYWxJbmRleCBdOwoKCQkJCQkJaWYgKCBncm91cE1hdGVyaWFsICYmIGdyb3VwTWF0ZXJpYWwudmlzaWJsZSApIHsKCgkJCQkJCQljb25zdCBkZXB0aE1hdGVyaWFsID0gZ2V0RGVwdGhNYXRlcmlhbCggb2JqZWN0LCBncm91cE1hdGVyaWFsLCBsaWdodCwgdHlwZSApOwoKCQkJCQkJCV9yZW5kZXJlci5yZW5kZXJCdWZmZXJEaXJlY3QoIHNoYWRvd0NhbWVyYSwgbnVsbCwgZ2VvbWV0cnksIGRlcHRoTWF0ZXJpYWwsIG9iamVjdCwgZ3JvdXAgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLnZpc2libGUgKSB7CgoJCQkJCWNvbnN0IGRlcHRoTWF0ZXJpYWwgPSBnZXREZXB0aE1hdGVyaWFsKCBvYmplY3QsIG1hdGVyaWFsLCBsaWdodCwgdHlwZSApOwoKCQkJCQlfcmVuZGVyZXIucmVuZGVyQnVmZmVyRGlyZWN0KCBzaGFkb3dDYW1lcmEsIG51bGwsIGdlb21ldHJ5LCBkZXB0aE1hdGVyaWFsLCBvYmplY3QsIG51bGwgKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJY29uc3QgY2hpbGRyZW4gPSBvYmplY3QuY2hpbGRyZW47CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IGNoaWxkcmVuLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQlyZW5kZXJPYmplY3QoIGNoaWxkcmVuWyBpIF0sIGNhbWVyYSwgc2hhZG93Q2FtZXJhLCBsaWdodCwgdHlwZSApOwoKCQl9CgoJfQoKfQoKZnVuY3Rpb24gV2ViR0xTdGF0ZSggZ2wsIGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcyApIHsKCgljb25zdCBpc1dlYkdMMiA9IGNhcGFiaWxpdGllcy5pc1dlYkdMMjsKCglmdW5jdGlvbiBDb2xvckJ1ZmZlcigpIHsKCgkJbGV0IGxvY2tlZCA9IGZhbHNlOwoKCQljb25zdCBjb2xvciA9IG5ldyBWZWN0b3I0KCk7CgkJbGV0IGN1cnJlbnRDb2xvck1hc2sgPSBudWxsOwoJCWNvbnN0IGN1cnJlbnRDb2xvckNsZWFyID0gbmV3IFZlY3RvcjQoIDAsIDAsIDAsIDAgKTsKCgkJcmV0dXJuIHsKCgkJCXNldE1hc2s6IGZ1bmN0aW9uICggY29sb3JNYXNrICkgewoKCQkJCWlmICggY3VycmVudENvbG9yTWFzayAhPT0gY29sb3JNYXNrICYmICEgbG9ja2VkICkgewoKCQkJCQlnbC5jb2xvck1hc2soIGNvbG9yTWFzaywgY29sb3JNYXNrLCBjb2xvck1hc2ssIGNvbG9yTWFzayApOwoJCQkJCWN1cnJlbnRDb2xvck1hc2sgPSBjb2xvck1hc2s7CgoJCQkJfQoKCQkJfSwKCgkJCXNldExvY2tlZDogZnVuY3Rpb24gKCBsb2NrICkgewoKCQkJCWxvY2tlZCA9IGxvY2s7CgoJCQl9LAoKCQkJc2V0Q2xlYXI6IGZ1bmN0aW9uICggciwgZywgYiwgYSwgcHJlbXVsdGlwbGllZEFscGhhICkgewoKCQkJCWlmICggcHJlbXVsdGlwbGllZEFscGhhID09PSB0cnVlICkgewoKCQkJCQlyICo9IGE7IGcgKj0gYTsgYiAqPSBhOwoKCQkJCX0KCgkJCQljb2xvci5zZXQoIHIsIGcsIGIsIGEgKTsKCgkJCQlpZiAoIGN1cnJlbnRDb2xvckNsZWFyLmVxdWFscyggY29sb3IgKSA9PT0gZmFsc2UgKSB7CgoJCQkJCWdsLmNsZWFyQ29sb3IoIHIsIGcsIGIsIGEgKTsKCQkJCQljdXJyZW50Q29sb3JDbGVhci5jb3B5KCBjb2xvciApOwoKCQkJCX0KCgkJCX0sCgoJCQlyZXNldDogZnVuY3Rpb24gKCkgewoKCQkJCWxvY2tlZCA9IGZhbHNlOwoKCQkJCWN1cnJlbnRDb2xvck1hc2sgPSBudWxsOwoJCQkJY3VycmVudENvbG9yQ2xlYXIuc2V0KCAtIDEsIDAsIDAsIDAgKTsgLy8gc2V0IHRvIGludmFsaWQgc3RhdGUKCgkJCX0KCgkJfTsKCgl9CgoJZnVuY3Rpb24gRGVwdGhCdWZmZXIoKSB7CgoJCWxldCBsb2NrZWQgPSBmYWxzZTsKCgkJbGV0IGN1cnJlbnREZXB0aE1hc2sgPSBudWxsOwoJCWxldCBjdXJyZW50RGVwdGhGdW5jID0gbnVsbDsKCQlsZXQgY3VycmVudERlcHRoQ2xlYXIgPSBudWxsOwoKCQlyZXR1cm4gewoKCQkJc2V0VGVzdDogZnVuY3Rpb24gKCBkZXB0aFRlc3QgKSB7CgoJCQkJaWYgKCBkZXB0aFRlc3QgKSB7CgoJCQkJCWVuYWJsZSggZ2wuREVQVEhfVEVTVCApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWRpc2FibGUoIGdsLkRFUFRIX1RFU1QgKTsKCgkJCQl9CgoJCQl9LAoKCQkJc2V0TWFzazogZnVuY3Rpb24gKCBkZXB0aE1hc2sgKSB7CgoJCQkJaWYgKCBjdXJyZW50RGVwdGhNYXNrICE9PSBkZXB0aE1hc2sgJiYgISBsb2NrZWQgKSB7CgoJCQkJCWdsLmRlcHRoTWFzayggZGVwdGhNYXNrICk7CgkJCQkJY3VycmVudERlcHRoTWFzayA9IGRlcHRoTWFzazsKCgkJCQl9CgoJCQl9LAoKCQkJc2V0RnVuYzogZnVuY3Rpb24gKCBkZXB0aEZ1bmMgKSB7CgoJCQkJaWYgKCBjdXJyZW50RGVwdGhGdW5jICE9PSBkZXB0aEZ1bmMgKSB7CgoJCQkJCXN3aXRjaCAoIGRlcHRoRnVuYyApIHsKCgkJCQkJCWNhc2UgTmV2ZXJEZXB0aDoKCgkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLk5FVkVSICk7CgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgQWx3YXlzRGVwdGg6CgoJCQkJCQkJZ2wuZGVwdGhGdW5jKCBnbC5BTFdBWVMgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSBMZXNzRGVwdGg6CgoJCQkJCQkJZ2wuZGVwdGhGdW5jKCBnbC5MRVNTICk7CgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgTGVzc0VxdWFsRGVwdGg6CgoJCQkJCQkJZ2wuZGVwdGhGdW5jKCBnbC5MRVFVQUwgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSBFcXVhbERlcHRoOgoKCQkJCQkJCWdsLmRlcHRoRnVuYyggZ2wuRVFVQUwgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSBHcmVhdGVyRXF1YWxEZXB0aDoKCgkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLkdFUVVBTCApOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIEdyZWF0ZXJEZXB0aDoKCgkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLkdSRUFURVIgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSBOb3RFcXVhbERlcHRoOgoKCQkJCQkJCWdsLmRlcHRoRnVuYyggZ2wuTk9URVFVQUwgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJZGVmYXVsdDoKCgkJCQkJCQlnbC5kZXB0aEZ1bmMoIGdsLkxFUVVBTCApOwoKCQkJCQl9CgoJCQkJCWN1cnJlbnREZXB0aEZ1bmMgPSBkZXB0aEZ1bmM7CgoJCQkJfQoKCQkJfSwKCgkJCXNldExvY2tlZDogZnVuY3Rpb24gKCBsb2NrICkgewoKCQkJCWxvY2tlZCA9IGxvY2s7CgoJCQl9LAoKCQkJc2V0Q2xlYXI6IGZ1bmN0aW9uICggZGVwdGggKSB7CgoJCQkJaWYgKCBjdXJyZW50RGVwdGhDbGVhciAhPT0gZGVwdGggKSB7CgoJCQkJCWdsLmNsZWFyRGVwdGgoIGRlcHRoICk7CgkJCQkJY3VycmVudERlcHRoQ2xlYXIgPSBkZXB0aDsKCgkJCQl9CgoJCQl9LAoKCQkJcmVzZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQlsb2NrZWQgPSBmYWxzZTsKCgkJCQljdXJyZW50RGVwdGhNYXNrID0gbnVsbDsKCQkJCWN1cnJlbnREZXB0aEZ1bmMgPSBudWxsOwoJCQkJY3VycmVudERlcHRoQ2xlYXIgPSBudWxsOwoKCQkJfQoKCQl9OwoKCX0KCglmdW5jdGlvbiBTdGVuY2lsQnVmZmVyKCkgewoKCQlsZXQgbG9ja2VkID0gZmFsc2U7CgoJCWxldCBjdXJyZW50U3RlbmNpbE1hc2sgPSBudWxsOwoJCWxldCBjdXJyZW50U3RlbmNpbEZ1bmMgPSBudWxsOwoJCWxldCBjdXJyZW50U3RlbmNpbFJlZiA9IG51bGw7CgkJbGV0IGN1cnJlbnRTdGVuY2lsRnVuY01hc2sgPSBudWxsOwoJCWxldCBjdXJyZW50U3RlbmNpbEZhaWwgPSBudWxsOwoJCWxldCBjdXJyZW50U3RlbmNpbFpGYWlsID0gbnVsbDsKCQlsZXQgY3VycmVudFN0ZW5jaWxaUGFzcyA9IG51bGw7CgkJbGV0IGN1cnJlbnRTdGVuY2lsQ2xlYXIgPSBudWxsOwoKCQlyZXR1cm4gewoKCQkJc2V0VGVzdDogZnVuY3Rpb24gKCBzdGVuY2lsVGVzdCApIHsKCgkJCQlpZiAoICEgbG9ja2VkICkgewoKCQkJCQlpZiAoIHN0ZW5jaWxUZXN0ICkgewoKCQkJCQkJZW5hYmxlKCBnbC5TVEVOQ0lMX1RFU1QgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWRpc2FibGUoIGdsLlNURU5DSUxfVEVTVCApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfSwKCgkJCXNldE1hc2s6IGZ1bmN0aW9uICggc3RlbmNpbE1hc2sgKSB7CgoJCQkJaWYgKCBjdXJyZW50U3RlbmNpbE1hc2sgIT09IHN0ZW5jaWxNYXNrICYmICEgbG9ja2VkICkgewoKCQkJCQlnbC5zdGVuY2lsTWFzayggc3RlbmNpbE1hc2sgKTsKCQkJCQljdXJyZW50U3RlbmNpbE1hc2sgPSBzdGVuY2lsTWFzazsKCgkJCQl9CgoJCQl9LAoKCQkJc2V0RnVuYzogZnVuY3Rpb24gKCBzdGVuY2lsRnVuYywgc3RlbmNpbFJlZiwgc3RlbmNpbE1hc2sgKSB7CgoJCQkJaWYgKCBjdXJyZW50U3RlbmNpbEZ1bmMgIT09IHN0ZW5jaWxGdW5jIHx8CgkJCQkgICAgIGN1cnJlbnRTdGVuY2lsUmVmICE9PSBzdGVuY2lsUmVmIHx8CgkJCQkgICAgIGN1cnJlbnRTdGVuY2lsRnVuY01hc2sgIT09IHN0ZW5jaWxNYXNrICkgewoKCQkJCQlnbC5zdGVuY2lsRnVuYyggc3RlbmNpbEZ1bmMsIHN0ZW5jaWxSZWYsIHN0ZW5jaWxNYXNrICk7CgoJCQkJCWN1cnJlbnRTdGVuY2lsRnVuYyA9IHN0ZW5jaWxGdW5jOwoJCQkJCWN1cnJlbnRTdGVuY2lsUmVmID0gc3RlbmNpbFJlZjsKCQkJCQljdXJyZW50U3RlbmNpbEZ1bmNNYXNrID0gc3RlbmNpbE1hc2s7CgoJCQkJfQoKCQkJfSwKCgkJCXNldE9wOiBmdW5jdGlvbiAoIHN0ZW5jaWxGYWlsLCBzdGVuY2lsWkZhaWwsIHN0ZW5jaWxaUGFzcyApIHsKCgkJCQlpZiAoIGN1cnJlbnRTdGVuY2lsRmFpbCAhPT0gc3RlbmNpbEZhaWwgfHwKCQkJCSAgICAgY3VycmVudFN0ZW5jaWxaRmFpbCAhPT0gc3RlbmNpbFpGYWlsIHx8CgkJCQkgICAgIGN1cnJlbnRTdGVuY2lsWlBhc3MgIT09IHN0ZW5jaWxaUGFzcyApIHsKCgkJCQkJZ2wuc3RlbmNpbE9wKCBzdGVuY2lsRmFpbCwgc3RlbmNpbFpGYWlsLCBzdGVuY2lsWlBhc3MgKTsKCgkJCQkJY3VycmVudFN0ZW5jaWxGYWlsID0gc3RlbmNpbEZhaWw7CgkJCQkJY3VycmVudFN0ZW5jaWxaRmFpbCA9IHN0ZW5jaWxaRmFpbDsKCQkJCQljdXJyZW50U3RlbmNpbFpQYXNzID0gc3RlbmNpbFpQYXNzOwoKCQkJCX0KCgkJCX0sCgoJCQlzZXRMb2NrZWQ6IGZ1bmN0aW9uICggbG9jayApIHsKCgkJCQlsb2NrZWQgPSBsb2NrOwoKCQkJfSwKCgkJCXNldENsZWFyOiBmdW5jdGlvbiAoIHN0ZW5jaWwgKSB7CgoJCQkJaWYgKCBjdXJyZW50U3RlbmNpbENsZWFyICE9PSBzdGVuY2lsICkgewoKCQkJCQlnbC5jbGVhclN0ZW5jaWwoIHN0ZW5jaWwgKTsKCQkJCQljdXJyZW50U3RlbmNpbENsZWFyID0gc3RlbmNpbDsKCgkJCQl9CgoJCQl9LAoKCQkJcmVzZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQlsb2NrZWQgPSBmYWxzZTsKCgkJCQljdXJyZW50U3RlbmNpbE1hc2sgPSBudWxsOwoJCQkJY3VycmVudFN0ZW5jaWxGdW5jID0gbnVsbDsKCQkJCWN1cnJlbnRTdGVuY2lsUmVmID0gbnVsbDsKCQkJCWN1cnJlbnRTdGVuY2lsRnVuY01hc2sgPSBudWxsOwoJCQkJY3VycmVudFN0ZW5jaWxGYWlsID0gbnVsbDsKCQkJCWN1cnJlbnRTdGVuY2lsWkZhaWwgPSBudWxsOwoJCQkJY3VycmVudFN0ZW5jaWxaUGFzcyA9IG51bGw7CgkJCQljdXJyZW50U3RlbmNpbENsZWFyID0gbnVsbDsKCgkJCX0KCgkJfTsKCgl9CgoJLy8KCgljb25zdCBjb2xvckJ1ZmZlciA9IG5ldyBDb2xvckJ1ZmZlcigpOwoJY29uc3QgZGVwdGhCdWZmZXIgPSBuZXcgRGVwdGhCdWZmZXIoKTsKCWNvbnN0IHN0ZW5jaWxCdWZmZXIgPSBuZXcgU3RlbmNpbEJ1ZmZlcigpOwoKCWNvbnN0IHVib0JpbmRpbmdzID0gbmV3IFdlYWtNYXAoKTsKCWNvbnN0IHVib1Byb2dyYW1NYXAgPSBuZXcgV2Vha01hcCgpOwoKCWxldCBlbmFibGVkQ2FwYWJpbGl0aWVzID0ge307CgoJbGV0IGN1cnJlbnRCb3VuZEZyYW1lYnVmZmVycyA9IHt9OwoJbGV0IGN1cnJlbnREcmF3YnVmZmVycyA9IG5ldyBXZWFrTWFwKCk7CglsZXQgZGVmYXVsdERyYXdidWZmZXJzID0gW107CgoJbGV0IGN1cnJlbnRQcm9ncmFtID0gbnVsbDsKCglsZXQgY3VycmVudEJsZW5kaW5nRW5hYmxlZCA9IGZhbHNlOwoJbGV0IGN1cnJlbnRCbGVuZGluZyA9IG51bGw7CglsZXQgY3VycmVudEJsZW5kRXF1YXRpb24gPSBudWxsOwoJbGV0IGN1cnJlbnRCbGVuZFNyYyA9IG51bGw7CglsZXQgY3VycmVudEJsZW5kRHN0ID0gbnVsbDsKCWxldCBjdXJyZW50QmxlbmRFcXVhdGlvbkFscGhhID0gbnVsbDsKCWxldCBjdXJyZW50QmxlbmRTcmNBbHBoYSA9IG51bGw7CglsZXQgY3VycmVudEJsZW5kRHN0QWxwaGEgPSBudWxsOwoJbGV0IGN1cnJlbnRQcmVtdWx0aXBsZWRBbHBoYSA9IGZhbHNlOwoKCWxldCBjdXJyZW50RmxpcFNpZGVkID0gbnVsbDsKCWxldCBjdXJyZW50Q3VsbEZhY2UgPSBudWxsOwoKCWxldCBjdXJyZW50TGluZVdpZHRoID0gbnVsbDsKCglsZXQgY3VycmVudFBvbHlnb25PZmZzZXRGYWN0b3IgPSBudWxsOwoJbGV0IGN1cnJlbnRQb2x5Z29uT2Zmc2V0VW5pdHMgPSBudWxsOwoKCWNvbnN0IG1heFRleHR1cmVzID0gZ2wuZ2V0UGFyYW1ldGVyKCBnbC5NQVhfQ09NQklORURfVEVYVFVSRV9JTUFHRV9VTklUUyApOwoKCWxldCBsaW5lV2lkdGhBdmFpbGFibGUgPSBmYWxzZTsKCWxldCB2ZXJzaW9uID0gMDsKCWNvbnN0IGdsVmVyc2lvbiA9IGdsLmdldFBhcmFtZXRlciggZ2wuVkVSU0lPTiApOwoKCWlmICggZ2xWZXJzaW9uLmluZGV4T2YoICdXZWJHTCcgKSAhPT0gLSAxICkgewoKCQl2ZXJzaW9uID0gcGFyc2VGbG9hdCggL15XZWJHTCAoXGQpLy5leGVjKCBnbFZlcnNpb24gKVsgMSBdICk7CgkJbGluZVdpZHRoQXZhaWxhYmxlID0gKCB2ZXJzaW9uID49IDEuMCApOwoKCX0gZWxzZSBpZiAoIGdsVmVyc2lvbi5pbmRleE9mKCAnT3BlbkdMIEVTJyApICE9PSAtIDEgKSB7CgoJCXZlcnNpb24gPSBwYXJzZUZsb2F0KCAvXk9wZW5HTCBFUyAoXGQpLy5leGVjKCBnbFZlcnNpb24gKVsgMSBdICk7CgkJbGluZVdpZHRoQXZhaWxhYmxlID0gKCB2ZXJzaW9uID49IDIuMCApOwoKCX0KCglsZXQgY3VycmVudFRleHR1cmVTbG90ID0gbnVsbDsKCWxldCBjdXJyZW50Qm91bmRUZXh0dXJlcyA9IHt9OwoKCWNvbnN0IHNjaXNzb3JQYXJhbSA9IGdsLmdldFBhcmFtZXRlciggZ2wuU0NJU1NPUl9CT1ggKTsKCWNvbnN0IHZpZXdwb3J0UGFyYW0gPSBnbC5nZXRQYXJhbWV0ZXIoIGdsLlZJRVdQT1JUICk7CgoJY29uc3QgY3VycmVudFNjaXNzb3IgPSBuZXcgVmVjdG9yNCgpLmZyb21BcnJheSggc2Npc3NvclBhcmFtICk7Cgljb25zdCBjdXJyZW50Vmlld3BvcnQgPSBuZXcgVmVjdG9yNCgpLmZyb21BcnJheSggdmlld3BvcnRQYXJhbSApOwoKCWZ1bmN0aW9uIGNyZWF0ZVRleHR1cmUoIHR5cGUsIHRhcmdldCwgY291bnQsIGRpbWVuc2lvbnMgKSB7CgoJCWNvbnN0IGRhdGEgPSBuZXcgVWludDhBcnJheSggNCApOyAvLyA0IGlzIHJlcXVpcmVkIHRvIG1hdGNoIGRlZmF1bHQgdW5wYWNrIGFsaWdubWVudCBvZiA0LgoJCWNvbnN0IHRleHR1cmUgPSBnbC5jcmVhdGVUZXh0dXJlKCk7CgoJCWdsLmJpbmRUZXh0dXJlKCB0eXBlLCB0ZXh0dXJlICk7CgkJZ2wudGV4UGFyYW1ldGVyaSggdHlwZSwgZ2wuVEVYVFVSRV9NSU5fRklMVEVSLCBnbC5ORUFSRVNUICk7CgkJZ2wudGV4UGFyYW1ldGVyaSggdHlwZSwgZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBnbC5ORUFSRVNUICk7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IGNvdW50OyBpICsrICkgewoKCQkJaWYgKCBpc1dlYkdMMiAmJiAoIHR5cGUgPT09IGdsLlRFWFRVUkVfM0QgfHwgdHlwZSA9PT0gZ2wuVEVYVFVSRV8yRF9BUlJBWSApICkgewoKCQkJCWdsLnRleEltYWdlM0QoIHRhcmdldCwgMCwgZ2wuUkdCQSwgMSwgMSwgZGltZW5zaW9ucywgMCwgZ2wuUkdCQSwgZ2wuVU5TSUdORURfQllURSwgZGF0YSApOwoKCQkJfSBlbHNlIHsKCgkJCQlnbC50ZXhJbWFnZTJEKCB0YXJnZXQgKyBpLCAwLCBnbC5SR0JBLCAxLCAxLCAwLCBnbC5SR0JBLCBnbC5VTlNJR05FRF9CWVRFLCBkYXRhICk7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHRleHR1cmU7CgoJfQoKCWNvbnN0IGVtcHR5VGV4dHVyZXMgPSB7fTsKCWVtcHR5VGV4dHVyZXNbIGdsLlRFWFRVUkVfMkQgXSA9IGNyZWF0ZVRleHR1cmUoIGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfMkQsIDEgKTsKCWVtcHR5VGV4dHVyZXNbIGdsLlRFWFRVUkVfQ1VCRV9NQVAgXSA9IGNyZWF0ZVRleHR1cmUoIGdsLlRFWFRVUkVfQ1VCRV9NQVAsIGdsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCwgNiApOwoKCWlmICggaXNXZWJHTDIgKSB7CgoJCWVtcHR5VGV4dHVyZXNbIGdsLlRFWFRVUkVfMkRfQVJSQVkgXSA9IGNyZWF0ZVRleHR1cmUoIGdsLlRFWFRVUkVfMkRfQVJSQVksIGdsLlRFWFRVUkVfMkRfQVJSQVksIDEsIDEgKTsKCQllbXB0eVRleHR1cmVzWyBnbC5URVhUVVJFXzNEIF0gPSBjcmVhdGVUZXh0dXJlKCBnbC5URVhUVVJFXzNELCBnbC5URVhUVVJFXzNELCAxLCAxICk7CgoJfQoKCS8vIGluaXQKCgljb2xvckJ1ZmZlci5zZXRDbGVhciggMCwgMCwgMCwgMSApOwoJZGVwdGhCdWZmZXIuc2V0Q2xlYXIoIDEgKTsKCXN0ZW5jaWxCdWZmZXIuc2V0Q2xlYXIoIDAgKTsKCgllbmFibGUoIGdsLkRFUFRIX1RFU1QgKTsKCWRlcHRoQnVmZmVyLnNldEZ1bmMoIExlc3NFcXVhbERlcHRoICk7CgoJc2V0RmxpcFNpZGVkKCBmYWxzZSApOwoJc2V0Q3VsbEZhY2UoIEN1bGxGYWNlQmFjayApOwoJZW5hYmxlKCBnbC5DVUxMX0ZBQ0UgKTsKCglzZXRCbGVuZGluZyggTm9CbGVuZGluZyApOwoKCS8vCgoJZnVuY3Rpb24gZW5hYmxlKCBpZCApIHsKCgkJaWYgKCBlbmFibGVkQ2FwYWJpbGl0aWVzWyBpZCBdICE9PSB0cnVlICkgewoKCQkJZ2wuZW5hYmxlKCBpZCApOwoJCQllbmFibGVkQ2FwYWJpbGl0aWVzWyBpZCBdID0gdHJ1ZTsKCgkJfQoKCX0KCglmdW5jdGlvbiBkaXNhYmxlKCBpZCApIHsKCgkJaWYgKCBlbmFibGVkQ2FwYWJpbGl0aWVzWyBpZCBdICE9PSBmYWxzZSApIHsKCgkJCWdsLmRpc2FibGUoIGlkICk7CgkJCWVuYWJsZWRDYXBhYmlsaXRpZXNbIGlkIF0gPSBmYWxzZTsKCgkJfQoKCX0KCglmdW5jdGlvbiBiaW5kRnJhbWVidWZmZXIoIHRhcmdldCwgZnJhbWVidWZmZXIgKSB7CgoJCWlmICggY3VycmVudEJvdW5kRnJhbWVidWZmZXJzWyB0YXJnZXQgXSAhPT0gZnJhbWVidWZmZXIgKSB7CgoJCQlnbC5iaW5kRnJhbWVidWZmZXIoIHRhcmdldCwgZnJhbWVidWZmZXIgKTsKCgkJCWN1cnJlbnRCb3VuZEZyYW1lYnVmZmVyc1sgdGFyZ2V0IF0gPSBmcmFtZWJ1ZmZlcjsKCgkJCWlmICggaXNXZWJHTDIgKSB7CgoJCQkJLy8gZ2wuRFJBV19GUkFNRUJVRkZFUiBpcyBlcXVpdmFsZW50IHRvIGdsLkZSQU1FQlVGRkVSCgoJCQkJaWYgKCB0YXJnZXQgPT09IGdsLkRSQVdfRlJBTUVCVUZGRVIgKSB7CgoJCQkJCWN1cnJlbnRCb3VuZEZyYW1lYnVmZmVyc1sgZ2wuRlJBTUVCVUZGRVIgXSA9IGZyYW1lYnVmZmVyOwoKCQkJCX0KCgkJCQlpZiAoIHRhcmdldCA9PT0gZ2wuRlJBTUVCVUZGRVIgKSB7CgoJCQkJCWN1cnJlbnRCb3VuZEZyYW1lYnVmZmVyc1sgZ2wuRFJBV19GUkFNRUJVRkZFUiBdID0gZnJhbWVidWZmZXI7CgoJCQkJfQoKCQkJfQoKCQkJcmV0dXJuIHRydWU7CgoJCX0KCgkJcmV0dXJuIGZhbHNlOwoKCX0KCglmdW5jdGlvbiBkcmF3QnVmZmVycyggcmVuZGVyVGFyZ2V0LCBmcmFtZWJ1ZmZlciApIHsKCgkJbGV0IGRyYXdCdWZmZXJzID0gZGVmYXVsdERyYXdidWZmZXJzOwoKCQlsZXQgbmVlZHNVcGRhdGUgPSBmYWxzZTsKCgkJaWYgKCByZW5kZXJUYXJnZXQgKSB7CgoJCQlkcmF3QnVmZmVycyA9IGN1cnJlbnREcmF3YnVmZmVycy5nZXQoIGZyYW1lYnVmZmVyICk7CgoJCQlpZiAoIGRyYXdCdWZmZXJzID09PSB1bmRlZmluZWQgKSB7CgoJCQkJZHJhd0J1ZmZlcnMgPSBbXTsKCQkJCWN1cnJlbnREcmF3YnVmZmVycy5zZXQoIGZyYW1lYnVmZmVyLCBkcmF3QnVmZmVycyApOwoKCQkJfQoKCQkJaWYgKCByZW5kZXJUYXJnZXQuaXNXZWJHTE11bHRpcGxlUmVuZGVyVGFyZ2V0cyApIHsKCgkJCQljb25zdCB0ZXh0dXJlcyA9IHJlbmRlclRhcmdldC50ZXh0dXJlOwoKCQkJCWlmICggZHJhd0J1ZmZlcnMubGVuZ3RoICE9PSB0ZXh0dXJlcy5sZW5ndGggfHwgZHJhd0J1ZmZlcnNbIDAgXSAhPT0gZ2wuQ09MT1JfQVRUQUNITUVOVDAgKSB7CgoJCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSB0ZXh0dXJlcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCWRyYXdCdWZmZXJzWyBpIF0gPSBnbC5DT0xPUl9BVFRBQ0hNRU5UMCArIGk7CgoJCQkJCX0KCgkJCQkJZHJhd0J1ZmZlcnMubGVuZ3RoID0gdGV4dHVyZXMubGVuZ3RoOwoKCQkJCQluZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQlpZiAoIGRyYXdCdWZmZXJzWyAwIF0gIT09IGdsLkNPTE9SX0FUVEFDSE1FTlQwICkgewoKCQkJCQlkcmF3QnVmZmVyc1sgMCBdID0gZ2wuQ09MT1JfQVRUQUNITUVOVDA7CgoJCQkJCW5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQl9CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQlpZiAoIGRyYXdCdWZmZXJzWyAwIF0gIT09IGdsLkJBQ0sgKSB7CgoJCQkJZHJhd0J1ZmZlcnNbIDAgXSA9IGdsLkJBQ0s7CgoJCQkJbmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJfQoKCQl9CgoJCWlmICggbmVlZHNVcGRhdGUgKSB7CgoJCQlpZiAoIGNhcGFiaWxpdGllcy5pc1dlYkdMMiApIHsKCgkJCQlnbC5kcmF3QnVmZmVycyggZHJhd0J1ZmZlcnMgKTsKCgkJCX0gZWxzZSB7CgoJCQkJZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9kcmF3X2J1ZmZlcnMnICkuZHJhd0J1ZmZlcnNXRUJHTCggZHJhd0J1ZmZlcnMgKTsKCgkJCX0KCgkJfQoKCgl9CgoJZnVuY3Rpb24gdXNlUHJvZ3JhbSggcHJvZ3JhbSApIHsKCgkJaWYgKCBjdXJyZW50UHJvZ3JhbSAhPT0gcHJvZ3JhbSApIHsKCgkJCWdsLnVzZVByb2dyYW0oIHByb2dyYW0gKTsKCgkJCWN1cnJlbnRQcm9ncmFtID0gcHJvZ3JhbTsKCgkJCXJldHVybiB0cnVlOwoKCQl9CgoJCXJldHVybiBmYWxzZTsKCgl9CgoJY29uc3QgZXF1YXRpb25Ub0dMID0gewoJCVsgQWRkRXF1YXRpb24gXTogZ2wuRlVOQ19BREQsCgkJWyBTdWJ0cmFjdEVxdWF0aW9uIF06IGdsLkZVTkNfU1VCVFJBQ1QsCgkJWyBSZXZlcnNlU3VidHJhY3RFcXVhdGlvbiBdOiBnbC5GVU5DX1JFVkVSU0VfU1VCVFJBQ1QKCX07CgoJaWYgKCBpc1dlYkdMMiApIHsKCgkJZXF1YXRpb25Ub0dMWyBNaW5FcXVhdGlvbiBdID0gZ2wuTUlOOwoJCWVxdWF0aW9uVG9HTFsgTWF4RXF1YXRpb24gXSA9IGdsLk1BWDsKCgl9IGVsc2UgewoKCQljb25zdCBleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ0VYVF9ibGVuZF9taW5tYXgnICk7CgoJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgewoKCQkJZXF1YXRpb25Ub0dMWyBNaW5FcXVhdGlvbiBdID0gZXh0ZW5zaW9uLk1JTl9FWFQ7CgkJCWVxdWF0aW9uVG9HTFsgTWF4RXF1YXRpb24gXSA9IGV4dGVuc2lvbi5NQVhfRVhUOwoKCQl9CgoJfQoKCWNvbnN0IGZhY3RvclRvR0wgPSB7CgkJWyBaZXJvRmFjdG9yIF06IGdsLlpFUk8sCgkJWyBPbmVGYWN0b3IgXTogZ2wuT05FLAoJCVsgU3JjQ29sb3JGYWN0b3IgXTogZ2wuU1JDX0NPTE9SLAoJCVsgU3JjQWxwaGFGYWN0b3IgXTogZ2wuU1JDX0FMUEhBLAoJCVsgU3JjQWxwaGFTYXR1cmF0ZUZhY3RvciBdOiBnbC5TUkNfQUxQSEFfU0FUVVJBVEUsCgkJWyBEc3RDb2xvckZhY3RvciBdOiBnbC5EU1RfQ09MT1IsCgkJWyBEc3RBbHBoYUZhY3RvciBdOiBnbC5EU1RfQUxQSEEsCgkJWyBPbmVNaW51c1NyY0NvbG9yRmFjdG9yIF06IGdsLk9ORV9NSU5VU19TUkNfQ09MT1IsCgkJWyBPbmVNaW51c1NyY0FscGhhRmFjdG9yIF06IGdsLk9ORV9NSU5VU19TUkNfQUxQSEEsCgkJWyBPbmVNaW51c0RzdENvbG9yRmFjdG9yIF06IGdsLk9ORV9NSU5VU19EU1RfQ09MT1IsCgkJWyBPbmVNaW51c0RzdEFscGhhRmFjdG9yIF06IGdsLk9ORV9NSU5VU19EU1RfQUxQSEEKCX07CgoJZnVuY3Rpb24gc2V0QmxlbmRpbmcoIGJsZW5kaW5nLCBibGVuZEVxdWF0aW9uLCBibGVuZFNyYywgYmxlbmREc3QsIGJsZW5kRXF1YXRpb25BbHBoYSwgYmxlbmRTcmNBbHBoYSwgYmxlbmREc3RBbHBoYSwgcHJlbXVsdGlwbGllZEFscGhhICkgewoKCQlpZiAoIGJsZW5kaW5nID09PSBOb0JsZW5kaW5nICkgewoKCQkJaWYgKCBjdXJyZW50QmxlbmRpbmdFbmFibGVkID09PSB0cnVlICkgewoKCQkJCWRpc2FibGUoIGdsLkJMRU5EICk7CgkJCQljdXJyZW50QmxlbmRpbmdFbmFibGVkID0gZmFsc2U7CgoJCQl9CgoJCQlyZXR1cm47CgoJCX0KCgkJaWYgKCBjdXJyZW50QmxlbmRpbmdFbmFibGVkID09PSBmYWxzZSApIHsKCgkJCWVuYWJsZSggZ2wuQkxFTkQgKTsKCQkJY3VycmVudEJsZW5kaW5nRW5hYmxlZCA9IHRydWU7CgoJCX0KCgkJaWYgKCBibGVuZGluZyAhPT0gQ3VzdG9tQmxlbmRpbmcgKSB7CgoJCQlpZiAoIGJsZW5kaW5nICE9PSBjdXJyZW50QmxlbmRpbmcgfHwgcHJlbXVsdGlwbGllZEFscGhhICE9PSBjdXJyZW50UHJlbXVsdGlwbGVkQWxwaGEgKSB7CgoJCQkJaWYgKCBjdXJyZW50QmxlbmRFcXVhdGlvbiAhPT0gQWRkRXF1YXRpb24gfHwgY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSAhPT0gQWRkRXF1YXRpb24gKSB7CgoJCQkJCWdsLmJsZW5kRXF1YXRpb24oIGdsLkZVTkNfQUREICk7CgoJCQkJCWN1cnJlbnRCbGVuZEVxdWF0aW9uID0gQWRkRXF1YXRpb247CgkJCQkJY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSA9IEFkZEVxdWF0aW9uOwoKCQkJCX0KCgkJCQlpZiAoIHByZW11bHRpcGxpZWRBbHBoYSApIHsKCgkJCQkJc3dpdGNoICggYmxlbmRpbmcgKSB7CgoJCQkJCQljYXNlIE5vcm1hbEJsZW5kaW5nOgoJCQkJCQkJZ2wuYmxlbmRGdW5jU2VwYXJhdGUoIGdsLk9ORSwgZ2wuT05FX01JTlVTX1NSQ19BTFBIQSwgZ2wuT05FLCBnbC5PTkVfTUlOVVNfU1JDX0FMUEhBICk7CgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgQWRkaXRpdmVCbGVuZGluZzoKCQkJCQkJCWdsLmJsZW5kRnVuYyggZ2wuT05FLCBnbC5PTkUgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSBTdWJ0cmFjdGl2ZUJsZW5kaW5nOgoJCQkJCQkJZ2wuYmxlbmRGdW5jU2VwYXJhdGUoIGdsLlpFUk8sIGdsLk9ORV9NSU5VU19TUkNfQ09MT1IsIGdsLlpFUk8sIGdsLk9ORSApOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIE11bHRpcGx5QmxlbmRpbmc6CgkJCQkJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZ2wuWkVSTywgZ2wuU1JDX0NPTE9SLCBnbC5aRVJPLCBnbC5TUkNfQUxQSEEgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJZGVmYXVsdDoKCQkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOiBJbnZhbGlkIGJsZW5kaW5nOiAnLCBibGVuZGluZyApOwoJCQkJCQkJYnJlYWs7CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQlzd2l0Y2ggKCBibGVuZGluZyApIHsKCgkJCQkJCWNhc2UgTm9ybWFsQmxlbmRpbmc6CgkJCQkJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZ2wuU1JDX0FMUEhBLCBnbC5PTkVfTUlOVVNfU1JDX0FMUEhBLCBnbC5PTkUsIGdsLk9ORV9NSU5VU19TUkNfQUxQSEEgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJY2FzZSBBZGRpdGl2ZUJsZW5kaW5nOgoJCQkJCQkJZ2wuYmxlbmRGdW5jKCBnbC5TUkNfQUxQSEEsIGdsLk9ORSApOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQljYXNlIFN1YnRyYWN0aXZlQmxlbmRpbmc6CgkJCQkJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZ2wuWkVSTywgZ2wuT05FX01JTlVTX1NSQ19DT0xPUiwgZ2wuWkVSTywgZ2wuT05FICk7CgkJCQkJCQlicmVhazsKCgkJCQkJCWNhc2UgTXVsdGlwbHlCbGVuZGluZzoKCQkJCQkJCWdsLmJsZW5kRnVuYyggZ2wuWkVSTywgZ2wuU1JDX0NPTE9SICk7CgkJCQkJCQlicmVhazsKCgkJCQkJCWRlZmF1bHQ6CgkJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTogSW52YWxpZCBibGVuZGluZzogJywgYmxlbmRpbmcgKTsKCQkJCQkJCWJyZWFrOwoKCQkJCQl9CgoJCQkJfQoKCQkJCWN1cnJlbnRCbGVuZFNyYyA9IG51bGw7CgkJCQljdXJyZW50QmxlbmREc3QgPSBudWxsOwoJCQkJY3VycmVudEJsZW5kU3JjQWxwaGEgPSBudWxsOwoJCQkJY3VycmVudEJsZW5kRHN0QWxwaGEgPSBudWxsOwoKCQkJCWN1cnJlbnRCbGVuZGluZyA9IGJsZW5kaW5nOwoJCQkJY3VycmVudFByZW11bHRpcGxlZEFscGhhID0gcHJlbXVsdGlwbGllZEFscGhhOwoKCQkJfQoKCQkJcmV0dXJuOwoKCQl9CgoJCS8vIGN1c3RvbSBibGVuZGluZwoKCQlibGVuZEVxdWF0aW9uQWxwaGEgPSBibGVuZEVxdWF0aW9uQWxwaGEgfHwgYmxlbmRFcXVhdGlvbjsKCQlibGVuZFNyY0FscGhhID0gYmxlbmRTcmNBbHBoYSB8fCBibGVuZFNyYzsKCQlibGVuZERzdEFscGhhID0gYmxlbmREc3RBbHBoYSB8fCBibGVuZERzdDsKCgkJaWYgKCBibGVuZEVxdWF0aW9uICE9PSBjdXJyZW50QmxlbmRFcXVhdGlvbiB8fCBibGVuZEVxdWF0aW9uQWxwaGEgIT09IGN1cnJlbnRCbGVuZEVxdWF0aW9uQWxwaGEgKSB7CgoJCQlnbC5ibGVuZEVxdWF0aW9uU2VwYXJhdGUoIGVxdWF0aW9uVG9HTFsgYmxlbmRFcXVhdGlvbiBdLCBlcXVhdGlvblRvR0xbIGJsZW5kRXF1YXRpb25BbHBoYSBdICk7CgoJCQljdXJyZW50QmxlbmRFcXVhdGlvbiA9IGJsZW5kRXF1YXRpb247CgkJCWN1cnJlbnRCbGVuZEVxdWF0aW9uQWxwaGEgPSBibGVuZEVxdWF0aW9uQWxwaGE7CgoJCX0KCgkJaWYgKCBibGVuZFNyYyAhPT0gY3VycmVudEJsZW5kU3JjIHx8IGJsZW5kRHN0ICE9PSBjdXJyZW50QmxlbmREc3QgfHwgYmxlbmRTcmNBbHBoYSAhPT0gY3VycmVudEJsZW5kU3JjQWxwaGEgfHwgYmxlbmREc3RBbHBoYSAhPT0gY3VycmVudEJsZW5kRHN0QWxwaGEgKSB7CgoJCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZmFjdG9yVG9HTFsgYmxlbmRTcmMgXSwgZmFjdG9yVG9HTFsgYmxlbmREc3QgXSwgZmFjdG9yVG9HTFsgYmxlbmRTcmNBbHBoYSBdLCBmYWN0b3JUb0dMWyBibGVuZERzdEFscGhhIF0gKTsKCgkJCWN1cnJlbnRCbGVuZFNyYyA9IGJsZW5kU3JjOwoJCQljdXJyZW50QmxlbmREc3QgPSBibGVuZERzdDsKCQkJY3VycmVudEJsZW5kU3JjQWxwaGEgPSBibGVuZFNyY0FscGhhOwoJCQljdXJyZW50QmxlbmREc3RBbHBoYSA9IGJsZW5kRHN0QWxwaGE7CgoJCX0KCgkJY3VycmVudEJsZW5kaW5nID0gYmxlbmRpbmc7CgkJY3VycmVudFByZW11bHRpcGxlZEFscGhhID0gZmFsc2U7CgoJfQoKCWZ1bmN0aW9uIHNldE1hdGVyaWFsKCBtYXRlcmlhbCwgZnJvbnRGYWNlQ1cgKSB7CgoJCW1hdGVyaWFsLnNpZGUgPT09IERvdWJsZVNpZGUKCQkJPyBkaXNhYmxlKCBnbC5DVUxMX0ZBQ0UgKQoJCQk6IGVuYWJsZSggZ2wuQ1VMTF9GQUNFICk7CgoJCWxldCBmbGlwU2lkZWQgPSAoIG1hdGVyaWFsLnNpZGUgPT09IEJhY2tTaWRlICk7CgkJaWYgKCBmcm9udEZhY2VDVyApIGZsaXBTaWRlZCA9ICEgZmxpcFNpZGVkOwoKCQlzZXRGbGlwU2lkZWQoIGZsaXBTaWRlZCApOwoKCQkoIG1hdGVyaWFsLmJsZW5kaW5nID09PSBOb3JtYWxCbGVuZGluZyAmJiBtYXRlcmlhbC50cmFuc3BhcmVudCA9PT0gZmFsc2UgKQoJCQk/IHNldEJsZW5kaW5nKCBOb0JsZW5kaW5nICkKCQkJOiBzZXRCbGVuZGluZyggbWF0ZXJpYWwuYmxlbmRpbmcsIG1hdGVyaWFsLmJsZW5kRXF1YXRpb24sIG1hdGVyaWFsLmJsZW5kU3JjLCBtYXRlcmlhbC5ibGVuZERzdCwgbWF0ZXJpYWwuYmxlbmRFcXVhdGlvbkFscGhhLCBtYXRlcmlhbC5ibGVuZFNyY0FscGhhLCBtYXRlcmlhbC5ibGVuZERzdEFscGhhLCBtYXRlcmlhbC5wcmVtdWx0aXBsaWVkQWxwaGEgKTsKCgkJZGVwdGhCdWZmZXIuc2V0RnVuYyggbWF0ZXJpYWwuZGVwdGhGdW5jICk7CgkJZGVwdGhCdWZmZXIuc2V0VGVzdCggbWF0ZXJpYWwuZGVwdGhUZXN0ICk7CgkJZGVwdGhCdWZmZXIuc2V0TWFzayggbWF0ZXJpYWwuZGVwdGhXcml0ZSApOwoJCWNvbG9yQnVmZmVyLnNldE1hc2soIG1hdGVyaWFsLmNvbG9yV3JpdGUgKTsKCgkJY29uc3Qgc3RlbmNpbFdyaXRlID0gbWF0ZXJpYWwuc3RlbmNpbFdyaXRlOwoJCXN0ZW5jaWxCdWZmZXIuc2V0VGVzdCggc3RlbmNpbFdyaXRlICk7CgkJaWYgKCBzdGVuY2lsV3JpdGUgKSB7CgoJCQlzdGVuY2lsQnVmZmVyLnNldE1hc2soIG1hdGVyaWFsLnN0ZW5jaWxXcml0ZU1hc2sgKTsKCQkJc3RlbmNpbEJ1ZmZlci5zZXRGdW5jKCBtYXRlcmlhbC5zdGVuY2lsRnVuYywgbWF0ZXJpYWwuc3RlbmNpbFJlZiwgbWF0ZXJpYWwuc3RlbmNpbEZ1bmNNYXNrICk7CgkJCXN0ZW5jaWxCdWZmZXIuc2V0T3AoIG1hdGVyaWFsLnN0ZW5jaWxGYWlsLCBtYXRlcmlhbC5zdGVuY2lsWkZhaWwsIG1hdGVyaWFsLnN0ZW5jaWxaUGFzcyApOwoKCQl9CgoJCXNldFBvbHlnb25PZmZzZXQoIG1hdGVyaWFsLnBvbHlnb25PZmZzZXQsIG1hdGVyaWFsLnBvbHlnb25PZmZzZXRGYWN0b3IsIG1hdGVyaWFsLnBvbHlnb25PZmZzZXRVbml0cyApOwoKCQltYXRlcmlhbC5hbHBoYVRvQ292ZXJhZ2UgPT09IHRydWUKCQkJPyBlbmFibGUoIGdsLlNBTVBMRV9BTFBIQV9UT19DT1ZFUkFHRSApCgkJCTogZGlzYWJsZSggZ2wuU0FNUExFX0FMUEhBX1RPX0NPVkVSQUdFICk7CgoJfQoKCS8vCgoJZnVuY3Rpb24gc2V0RmxpcFNpZGVkKCBmbGlwU2lkZWQgKSB7CgoJCWlmICggY3VycmVudEZsaXBTaWRlZCAhPT0gZmxpcFNpZGVkICkgewoKCQkJaWYgKCBmbGlwU2lkZWQgKSB7CgoJCQkJZ2wuZnJvbnRGYWNlKCBnbC5DVyApOwoKCQkJfSBlbHNlIHsKCgkJCQlnbC5mcm9udEZhY2UoIGdsLkNDVyApOwoKCQkJfQoKCQkJY3VycmVudEZsaXBTaWRlZCA9IGZsaXBTaWRlZDsKCgkJfQoKCX0KCglmdW5jdGlvbiBzZXRDdWxsRmFjZSggY3VsbEZhY2UgKSB7CgoJCWlmICggY3VsbEZhY2UgIT09IEN1bGxGYWNlTm9uZSApIHsKCgkJCWVuYWJsZSggZ2wuQ1VMTF9GQUNFICk7CgoJCQlpZiAoIGN1bGxGYWNlICE9PSBjdXJyZW50Q3VsbEZhY2UgKSB7CgoJCQkJaWYgKCBjdWxsRmFjZSA9PT0gQ3VsbEZhY2VCYWNrICkgewoKCQkJCQlnbC5jdWxsRmFjZSggZ2wuQkFDSyApOwoKCQkJCX0gZWxzZSBpZiAoIGN1bGxGYWNlID09PSBDdWxsRmFjZUZyb250ICkgewoKCQkJCQlnbC5jdWxsRmFjZSggZ2wuRlJPTlQgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlnbC5jdWxsRmFjZSggZ2wuRlJPTlRfQU5EX0JBQ0sgKTsKCgkJCQl9CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQlkaXNhYmxlKCBnbC5DVUxMX0ZBQ0UgKTsKCgkJfQoKCQljdXJyZW50Q3VsbEZhY2UgPSBjdWxsRmFjZTsKCgl9CgoJZnVuY3Rpb24gc2V0TGluZVdpZHRoKCB3aWR0aCApIHsKCgkJaWYgKCB3aWR0aCAhPT0gY3VycmVudExpbmVXaWR0aCApIHsKCgkJCWlmICggbGluZVdpZHRoQXZhaWxhYmxlICkgZ2wubGluZVdpZHRoKCB3aWR0aCApOwoKCQkJY3VycmVudExpbmVXaWR0aCA9IHdpZHRoOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHNldFBvbHlnb25PZmZzZXQoIHBvbHlnb25PZmZzZXQsIGZhY3RvciwgdW5pdHMgKSB7CgoJCWlmICggcG9seWdvbk9mZnNldCApIHsKCgkJCWVuYWJsZSggZ2wuUE9MWUdPTl9PRkZTRVRfRklMTCApOwoKCQkJaWYgKCBjdXJyZW50UG9seWdvbk9mZnNldEZhY3RvciAhPT0gZmFjdG9yIHx8IGN1cnJlbnRQb2x5Z29uT2Zmc2V0VW5pdHMgIT09IHVuaXRzICkgewoKCQkJCWdsLnBvbHlnb25PZmZzZXQoIGZhY3RvciwgdW5pdHMgKTsKCgkJCQljdXJyZW50UG9seWdvbk9mZnNldEZhY3RvciA9IGZhY3RvcjsKCQkJCWN1cnJlbnRQb2x5Z29uT2Zmc2V0VW5pdHMgPSB1bml0czsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCWRpc2FibGUoIGdsLlBPTFlHT05fT0ZGU0VUX0ZJTEwgKTsKCgkJfQoKCX0KCglmdW5jdGlvbiBzZXRTY2lzc29yVGVzdCggc2Npc3NvclRlc3QgKSB7CgoJCWlmICggc2Npc3NvclRlc3QgKSB7CgoJCQllbmFibGUoIGdsLlNDSVNTT1JfVEVTVCApOwoKCQl9IGVsc2UgewoKCQkJZGlzYWJsZSggZ2wuU0NJU1NPUl9URVNUICk7CgoJCX0KCgl9CgoJLy8gdGV4dHVyZQoKCWZ1bmN0aW9uIGFjdGl2ZVRleHR1cmUoIHdlYmdsU2xvdCApIHsKCgkJaWYgKCB3ZWJnbFNsb3QgPT09IHVuZGVmaW5lZCApIHdlYmdsU2xvdCA9IGdsLlRFWFRVUkUwICsgbWF4VGV4dHVyZXMgLSAxOwoKCQlpZiAoIGN1cnJlbnRUZXh0dXJlU2xvdCAhPT0gd2ViZ2xTbG90ICkgewoKCQkJZ2wuYWN0aXZlVGV4dHVyZSggd2ViZ2xTbG90ICk7CgkJCWN1cnJlbnRUZXh0dXJlU2xvdCA9IHdlYmdsU2xvdDsKCgkJfQoKCX0KCglmdW5jdGlvbiBiaW5kVGV4dHVyZSggd2ViZ2xUeXBlLCB3ZWJnbFRleHR1cmUsIHdlYmdsU2xvdCApIHsKCgkJaWYgKCB3ZWJnbFNsb3QgPT09IHVuZGVmaW5lZCApIHsKCgkJCWlmICggY3VycmVudFRleHR1cmVTbG90ID09PSBudWxsICkgewoKCQkJCXdlYmdsU2xvdCA9IGdsLlRFWFRVUkUwICsgbWF4VGV4dHVyZXMgLSAxOwoKCQkJfSBlbHNlIHsKCgkJCQl3ZWJnbFNsb3QgPSBjdXJyZW50VGV4dHVyZVNsb3Q7CgoJCQl9CgoJCX0KCgkJbGV0IGJvdW5kVGV4dHVyZSA9IGN1cnJlbnRCb3VuZFRleHR1cmVzWyB3ZWJnbFNsb3QgXTsKCgkJaWYgKCBib3VuZFRleHR1cmUgPT09IHVuZGVmaW5lZCApIHsKCgkJCWJvdW5kVGV4dHVyZSA9IHsgdHlwZTogdW5kZWZpbmVkLCB0ZXh0dXJlOiB1bmRlZmluZWQgfTsKCQkJY3VycmVudEJvdW5kVGV4dHVyZXNbIHdlYmdsU2xvdCBdID0gYm91bmRUZXh0dXJlOwoKCQl9CgoJCWlmICggYm91bmRUZXh0dXJlLnR5cGUgIT09IHdlYmdsVHlwZSB8fCBib3VuZFRleHR1cmUudGV4dHVyZSAhPT0gd2ViZ2xUZXh0dXJlICkgewoKCQkJaWYgKCBjdXJyZW50VGV4dHVyZVNsb3QgIT09IHdlYmdsU2xvdCApIHsKCgkJCQlnbC5hY3RpdmVUZXh0dXJlKCB3ZWJnbFNsb3QgKTsKCQkJCWN1cnJlbnRUZXh0dXJlU2xvdCA9IHdlYmdsU2xvdDsKCgkJCX0KCgkJCWdsLmJpbmRUZXh0dXJlKCB3ZWJnbFR5cGUsIHdlYmdsVGV4dHVyZSB8fCBlbXB0eVRleHR1cmVzWyB3ZWJnbFR5cGUgXSApOwoKCQkJYm91bmRUZXh0dXJlLnR5cGUgPSB3ZWJnbFR5cGU7CgkJCWJvdW5kVGV4dHVyZS50ZXh0dXJlID0gd2ViZ2xUZXh0dXJlOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHVuYmluZFRleHR1cmUoKSB7CgoJCWNvbnN0IGJvdW5kVGV4dHVyZSA9IGN1cnJlbnRCb3VuZFRleHR1cmVzWyBjdXJyZW50VGV4dHVyZVNsb3QgXTsKCgkJaWYgKCBib3VuZFRleHR1cmUgIT09IHVuZGVmaW5lZCAmJiBib3VuZFRleHR1cmUudHlwZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJZ2wuYmluZFRleHR1cmUoIGJvdW5kVGV4dHVyZS50eXBlLCBudWxsICk7CgoJCQlib3VuZFRleHR1cmUudHlwZSA9IHVuZGVmaW5lZDsKCQkJYm91bmRUZXh0dXJlLnRleHR1cmUgPSB1bmRlZmluZWQ7CgoJCX0KCgl9CgoJZnVuY3Rpb24gY29tcHJlc3NlZFRleEltYWdlMkQoKSB7CgoJCXRyeSB7CgoJCQlnbC5jb21wcmVzc2VkVGV4SW1hZ2UyRC5hcHBseSggZ2wsIGFyZ3VtZW50cyApOwoKCQl9IGNhdGNoICggZXJyb3IgKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTonLCBlcnJvciApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIGNvbXByZXNzZWRUZXhJbWFnZTNEKCkgewoKCQl0cnkgewoKCQkJZ2wuY29tcHJlc3NlZFRleEltYWdlM0QuYXBwbHkoIGdsLCBhcmd1bWVudHMgKTsKCgkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6JywgZXJyb3IgKTsKCgkJfQoKCX0KCglmdW5jdGlvbiB0ZXhTdWJJbWFnZTJEKCkgewoKCQl0cnkgewoKCQkJZ2wudGV4U3ViSW1hZ2UyRC5hcHBseSggZ2wsIGFyZ3VtZW50cyApOwoKCQl9IGNhdGNoICggZXJyb3IgKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTonLCBlcnJvciApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHRleFN1YkltYWdlM0QoKSB7CgoJCXRyeSB7CgoJCQlnbC50ZXhTdWJJbWFnZTNELmFwcGx5KCBnbCwgYXJndW1lbnRzICk7CgoJCX0gY2F0Y2ggKCBlcnJvciApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gY29tcHJlc3NlZFRleFN1YkltYWdlMkQoKSB7CgoJCXRyeSB7CgoJCQlnbC5jb21wcmVzc2VkVGV4U3ViSW1hZ2UyRC5hcHBseSggZ2wsIGFyZ3VtZW50cyApOwoKCQl9IGNhdGNoICggZXJyb3IgKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTonLCBlcnJvciApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIGNvbXByZXNzZWRUZXhTdWJJbWFnZTNEKCkgewoKCQl0cnkgewoKCQkJZ2wuY29tcHJlc3NlZFRleFN1YkltYWdlM0QuYXBwbHkoIGdsLCBhcmd1bWVudHMgKTsKCgkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6JywgZXJyb3IgKTsKCgkJfQoKCX0KCglmdW5jdGlvbiB0ZXhTdG9yYWdlMkQoKSB7CgoJCXRyeSB7CgoJCQlnbC50ZXhTdG9yYWdlMkQuYXBwbHkoIGdsLCBhcmd1bWVudHMgKTsKCgkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6JywgZXJyb3IgKTsKCgkJfQoKCX0KCglmdW5jdGlvbiB0ZXhTdG9yYWdlM0QoKSB7CgoJCXRyeSB7CgoJCQlnbC50ZXhTdG9yYWdlM0QuYXBwbHkoIGdsLCBhcmd1bWVudHMgKTsKCgkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMU3RhdGU6JywgZXJyb3IgKTsKCgkJfQoKCX0KCglmdW5jdGlvbiB0ZXhJbWFnZTJEKCkgewoKCQl0cnkgewoKCQkJZ2wudGV4SW1hZ2UyRC5hcHBseSggZ2wsIGFyZ3VtZW50cyApOwoKCQl9IGNhdGNoICggZXJyb3IgKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xTdGF0ZTonLCBlcnJvciApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHRleEltYWdlM0QoKSB7CgoJCXRyeSB7CgoJCQlnbC50ZXhJbWFnZTNELmFwcGx5KCBnbCwgYXJndW1lbnRzICk7CgoJCX0gY2F0Y2ggKCBlcnJvciApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFN0YXRlOicsIGVycm9yICk7CgoJCX0KCgl9CgoJLy8KCglmdW5jdGlvbiBzY2lzc29yKCBzY2lzc29yICkgewoKCQlpZiAoIGN1cnJlbnRTY2lzc29yLmVxdWFscyggc2Npc3NvciApID09PSBmYWxzZSApIHsKCgkJCWdsLnNjaXNzb3IoIHNjaXNzb3IueCwgc2Npc3Nvci55LCBzY2lzc29yLnosIHNjaXNzb3IudyApOwoJCQljdXJyZW50U2Npc3Nvci5jb3B5KCBzY2lzc29yICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gdmlld3BvcnQoIHZpZXdwb3J0ICkgewoKCQlpZiAoIGN1cnJlbnRWaWV3cG9ydC5lcXVhbHMoIHZpZXdwb3J0ICkgPT09IGZhbHNlICkgewoKCQkJZ2wudmlld3BvcnQoIHZpZXdwb3J0LngsIHZpZXdwb3J0LnksIHZpZXdwb3J0LnosIHZpZXdwb3J0LncgKTsKCQkJY3VycmVudFZpZXdwb3J0LmNvcHkoIHZpZXdwb3J0ICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gdXBkYXRlVUJPTWFwcGluZyggdW5pZm9ybXNHcm91cCwgcHJvZ3JhbSApIHsKCgkJbGV0IG1hcHBpbmcgPSB1Ym9Qcm9ncmFtTWFwLmdldCggcHJvZ3JhbSApOwoKCQlpZiAoIG1hcHBpbmcgPT09IHVuZGVmaW5lZCApIHsKCgkJCW1hcHBpbmcgPSBuZXcgV2Vha01hcCgpOwoKCQkJdWJvUHJvZ3JhbU1hcC5zZXQoIHByb2dyYW0sIG1hcHBpbmcgKTsKCgkJfQoKCQlsZXQgYmxvY2tJbmRleCA9IG1hcHBpbmcuZ2V0KCB1bmlmb3Jtc0dyb3VwICk7CgoJCWlmICggYmxvY2tJbmRleCA9PT0gdW5kZWZpbmVkICkgewoKCQkJYmxvY2tJbmRleCA9IGdsLmdldFVuaWZvcm1CbG9ja0luZGV4KCBwcm9ncmFtLCB1bmlmb3Jtc0dyb3VwLm5hbWUgKTsKCgkJCW1hcHBpbmcuc2V0KCB1bmlmb3Jtc0dyb3VwLCBibG9ja0luZGV4ICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gdW5pZm9ybUJsb2NrQmluZGluZyggdW5pZm9ybXNHcm91cCwgcHJvZ3JhbSApIHsKCgkJY29uc3QgbWFwcGluZyA9IHVib1Byb2dyYW1NYXAuZ2V0KCBwcm9ncmFtICk7CgkJY29uc3QgYmxvY2tJbmRleCA9IG1hcHBpbmcuZ2V0KCB1bmlmb3Jtc0dyb3VwICk7CgoJCWlmICggdWJvQmluZGluZ3MuZ2V0KCBwcm9ncmFtICkgIT09IGJsb2NrSW5kZXggKSB7CgoJCQkvLyBiaW5kIHNoYWRlciBzcGVjaWZpYyBibG9jayBpbmRleCB0byBnbG9iYWwgYmxvY2sgcG9pbnQKCQkJZ2wudW5pZm9ybUJsb2NrQmluZGluZyggcHJvZ3JhbSwgYmxvY2tJbmRleCwgdW5pZm9ybXNHcm91cC5fX2JpbmRpbmdQb2ludEluZGV4ICk7CgoJCQl1Ym9CaW5kaW5ncy5zZXQoIHByb2dyYW0sIGJsb2NrSW5kZXggKTsKCgkJfQoKCX0KCgkvLwoKCWZ1bmN0aW9uIHJlc2V0KCkgewoKCQkvLyByZXNldCBzdGF0ZQoKCQlnbC5kaXNhYmxlKCBnbC5CTEVORCApOwoJCWdsLmRpc2FibGUoIGdsLkNVTExfRkFDRSApOwoJCWdsLmRpc2FibGUoIGdsLkRFUFRIX1RFU1QgKTsKCQlnbC5kaXNhYmxlKCBnbC5QT0xZR09OX09GRlNFVF9GSUxMICk7CgkJZ2wuZGlzYWJsZSggZ2wuU0NJU1NPUl9URVNUICk7CgkJZ2wuZGlzYWJsZSggZ2wuU1RFTkNJTF9URVNUICk7CgkJZ2wuZGlzYWJsZSggZ2wuU0FNUExFX0FMUEhBX1RPX0NPVkVSQUdFICk7CgoJCWdsLmJsZW5kRXF1YXRpb24oIGdsLkZVTkNfQUREICk7CgkJZ2wuYmxlbmRGdW5jKCBnbC5PTkUsIGdsLlpFUk8gKTsKCQlnbC5ibGVuZEZ1bmNTZXBhcmF0ZSggZ2wuT05FLCBnbC5aRVJPLCBnbC5PTkUsIGdsLlpFUk8gKTsKCgkJZ2wuY29sb3JNYXNrKCB0cnVlLCB0cnVlLCB0cnVlLCB0cnVlICk7CgkJZ2wuY2xlYXJDb2xvciggMCwgMCwgMCwgMCApOwoKCQlnbC5kZXB0aE1hc2soIHRydWUgKTsKCQlnbC5kZXB0aEZ1bmMoIGdsLkxFU1MgKTsKCQlnbC5jbGVhckRlcHRoKCAxICk7CgoJCWdsLnN0ZW5jaWxNYXNrKCAweGZmZmZmZmZmICk7CgkJZ2wuc3RlbmNpbEZ1bmMoIGdsLkFMV0FZUywgMCwgMHhmZmZmZmZmZiApOwoJCWdsLnN0ZW5jaWxPcCggZ2wuS0VFUCwgZ2wuS0VFUCwgZ2wuS0VFUCApOwoJCWdsLmNsZWFyU3RlbmNpbCggMCApOwoKCQlnbC5jdWxsRmFjZSggZ2wuQkFDSyApOwoJCWdsLmZyb250RmFjZSggZ2wuQ0NXICk7CgoJCWdsLnBvbHlnb25PZmZzZXQoIDAsIDAgKTsKCgkJZ2wuYWN0aXZlVGV4dHVyZSggZ2wuVEVYVFVSRTAgKTsKCgkJZ2wuYmluZEZyYW1lYnVmZmVyKCBnbC5GUkFNRUJVRkZFUiwgbnVsbCApOwoKCQlpZiAoIGlzV2ViR0wyID09PSB0cnVlICkgewoKCQkJZ2wuYmluZEZyYW1lYnVmZmVyKCBnbC5EUkFXX0ZSQU1FQlVGRkVSLCBudWxsICk7CgkJCWdsLmJpbmRGcmFtZWJ1ZmZlciggZ2wuUkVBRF9GUkFNRUJVRkZFUiwgbnVsbCApOwoKCQl9CgoJCWdsLnVzZVByb2dyYW0oIG51bGwgKTsKCgkJZ2wubGluZVdpZHRoKCAxICk7CgoJCWdsLnNjaXNzb3IoIDAsIDAsIGdsLmNhbnZhcy53aWR0aCwgZ2wuY2FudmFzLmhlaWdodCApOwoJCWdsLnZpZXdwb3J0KCAwLCAwLCBnbC5jYW52YXMud2lkdGgsIGdsLmNhbnZhcy5oZWlnaHQgKTsKCgkJLy8gcmVzZXQgaW50ZXJuYWxzCgoJCWVuYWJsZWRDYXBhYmlsaXRpZXMgPSB7fTsKCgkJY3VycmVudFRleHR1cmVTbG90ID0gbnVsbDsKCQljdXJyZW50Qm91bmRUZXh0dXJlcyA9IHt9OwoKCQljdXJyZW50Qm91bmRGcmFtZWJ1ZmZlcnMgPSB7fTsKCQljdXJyZW50RHJhd2J1ZmZlcnMgPSBuZXcgV2Vha01hcCgpOwoJCWRlZmF1bHREcmF3YnVmZmVycyA9IFtdOwoKCQljdXJyZW50UHJvZ3JhbSA9IG51bGw7CgoJCWN1cnJlbnRCbGVuZGluZ0VuYWJsZWQgPSBmYWxzZTsKCQljdXJyZW50QmxlbmRpbmcgPSBudWxsOwoJCWN1cnJlbnRCbGVuZEVxdWF0aW9uID0gbnVsbDsKCQljdXJyZW50QmxlbmRTcmMgPSBudWxsOwoJCWN1cnJlbnRCbGVuZERzdCA9IG51bGw7CgkJY3VycmVudEJsZW5kRXF1YXRpb25BbHBoYSA9IG51bGw7CgkJY3VycmVudEJsZW5kU3JjQWxwaGEgPSBudWxsOwoJCWN1cnJlbnRCbGVuZERzdEFscGhhID0gbnVsbDsKCQljdXJyZW50UHJlbXVsdGlwbGVkQWxwaGEgPSBmYWxzZTsKCgkJY3VycmVudEZsaXBTaWRlZCA9IG51bGw7CgkJY3VycmVudEN1bGxGYWNlID0gbnVsbDsKCgkJY3VycmVudExpbmVXaWR0aCA9IG51bGw7CgoJCWN1cnJlbnRQb2x5Z29uT2Zmc2V0RmFjdG9yID0gbnVsbDsKCQljdXJyZW50UG9seWdvbk9mZnNldFVuaXRzID0gbnVsbDsKCgkJY3VycmVudFNjaXNzb3Iuc2V0KCAwLCAwLCBnbC5jYW52YXMud2lkdGgsIGdsLmNhbnZhcy5oZWlnaHQgKTsKCQljdXJyZW50Vmlld3BvcnQuc2V0KCAwLCAwLCBnbC5jYW52YXMud2lkdGgsIGdsLmNhbnZhcy5oZWlnaHQgKTsKCgkJY29sb3JCdWZmZXIucmVzZXQoKTsKCQlkZXB0aEJ1ZmZlci5yZXNldCgpOwoJCXN0ZW5jaWxCdWZmZXIucmVzZXQoKTsKCgl9CgoJcmV0dXJuIHsKCgkJYnVmZmVyczogewoJCQljb2xvcjogY29sb3JCdWZmZXIsCgkJCWRlcHRoOiBkZXB0aEJ1ZmZlciwKCQkJc3RlbmNpbDogc3RlbmNpbEJ1ZmZlcgoJCX0sCgoJCWVuYWJsZTogZW5hYmxlLAoJCWRpc2FibGU6IGRpc2FibGUsCgoJCWJpbmRGcmFtZWJ1ZmZlcjogYmluZEZyYW1lYnVmZmVyLAoJCWRyYXdCdWZmZXJzOiBkcmF3QnVmZmVycywKCgkJdXNlUHJvZ3JhbTogdXNlUHJvZ3JhbSwKCgkJc2V0QmxlbmRpbmc6IHNldEJsZW5kaW5nLAoJCXNldE1hdGVyaWFsOiBzZXRNYXRlcmlhbCwKCgkJc2V0RmxpcFNpZGVkOiBzZXRGbGlwU2lkZWQsCgkJc2V0Q3VsbEZhY2U6IHNldEN1bGxGYWNlLAoKCQlzZXRMaW5lV2lkdGg6IHNldExpbmVXaWR0aCwKCQlzZXRQb2x5Z29uT2Zmc2V0OiBzZXRQb2x5Z29uT2Zmc2V0LAoKCQlzZXRTY2lzc29yVGVzdDogc2V0U2Npc3NvclRlc3QsCgoJCWFjdGl2ZVRleHR1cmU6IGFjdGl2ZVRleHR1cmUsCgkJYmluZFRleHR1cmU6IGJpbmRUZXh0dXJlLAoJCXVuYmluZFRleHR1cmU6IHVuYmluZFRleHR1cmUsCgkJY29tcHJlc3NlZFRleEltYWdlMkQ6IGNvbXByZXNzZWRUZXhJbWFnZTJELAoJCWNvbXByZXNzZWRUZXhJbWFnZTNEOiBjb21wcmVzc2VkVGV4SW1hZ2UzRCwKCQl0ZXhJbWFnZTJEOiB0ZXhJbWFnZTJELAoJCXRleEltYWdlM0Q6IHRleEltYWdlM0QsCgoJCXVwZGF0ZVVCT01hcHBpbmc6IHVwZGF0ZVVCT01hcHBpbmcsCgkJdW5pZm9ybUJsb2NrQmluZGluZzogdW5pZm9ybUJsb2NrQmluZGluZywKCgkJdGV4U3RvcmFnZTJEOiB0ZXhTdG9yYWdlMkQsCgkJdGV4U3RvcmFnZTNEOiB0ZXhTdG9yYWdlM0QsCgkJdGV4U3ViSW1hZ2UyRDogdGV4U3ViSW1hZ2UyRCwKCQl0ZXhTdWJJbWFnZTNEOiB0ZXhTdWJJbWFnZTNELAoJCWNvbXByZXNzZWRUZXhTdWJJbWFnZTJEOiBjb21wcmVzc2VkVGV4U3ViSW1hZ2UyRCwKCQljb21wcmVzc2VkVGV4U3ViSW1hZ2UzRDogY29tcHJlc3NlZFRleFN1YkltYWdlM0QsCgoJCXNjaXNzb3I6IHNjaXNzb3IsCgkJdmlld3BvcnQ6IHZpZXdwb3J0LAoKCQlyZXNldDogcmVzZXQKCgl9OwoKfQoKZnVuY3Rpb24gV2ViR0xUZXh0dXJlcyggX2dsLCBleHRlbnNpb25zLCBzdGF0ZSwgcHJvcGVydGllcywgY2FwYWJpbGl0aWVzLCB1dGlscywgaW5mbyApIHsKCgljb25zdCBpc1dlYkdMMiA9IGNhcGFiaWxpdGllcy5pc1dlYkdMMjsKCWNvbnN0IG1heFRleHR1cmVzID0gY2FwYWJpbGl0aWVzLm1heFRleHR1cmVzOwoJY29uc3QgbWF4Q3ViZW1hcFNpemUgPSBjYXBhYmlsaXRpZXMubWF4Q3ViZW1hcFNpemU7Cgljb25zdCBtYXhUZXh0dXJlU2l6ZSA9IGNhcGFiaWxpdGllcy5tYXhUZXh0dXJlU2l6ZTsKCWNvbnN0IG1heFNhbXBsZXMgPSBjYXBhYmlsaXRpZXMubWF4U2FtcGxlczsKCWNvbnN0IG11bHRpc2FtcGxlZFJUVEV4dCA9IGV4dGVuc2lvbnMuaGFzKCAnV0VCR0xfbXVsdGlzYW1wbGVkX3JlbmRlcl90b190ZXh0dXJlJyApID8gZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9tdWx0aXNhbXBsZWRfcmVuZGVyX3RvX3RleHR1cmUnICkgOiBudWxsOwoJY29uc3Qgc3VwcG9ydHNJbnZhbGlkYXRlRnJhbWVidWZmZXIgPSB0eXBlb2YgbmF2aWdhdG9yID09PSAndW5kZWZpbmVkJyA/IGZhbHNlIDogL09jdWx1c0Jyb3dzZXIvZy50ZXN0KCBuYXZpZ2F0b3IudXNlckFnZW50ICk7CgoJY29uc3QgX3ZpZGVvVGV4dHVyZXMgPSBuZXcgV2Vha01hcCgpOwoJbGV0IF9jYW52YXM7CgoJY29uc3QgX3NvdXJjZXMgPSBuZXcgV2Vha01hcCgpOyAvLyBtYXBzIFdlYmdsVGV4dHVyZSBvYmplY3RzIHRvIGluc3RhbmNlcyBvZiBTb3VyY2UKCgkvLyBjb3Jkb3ZhIGlPUyAoYXMgb2YgNS4wKSBzdGlsbCB1c2VzIFVJV2ViVmlldywgd2hpY2ggcHJvdmlkZXMgT2Zmc2NyZWVuQ2FudmFzLAoJLy8gYWxzbyBPZmZzY3JlZW5DYW52YXMuZ2V0Q29udGV4dCgid2ViZ2wiKSwgYnV0IG5vdCBPZmZzY3JlZW5DYW52YXMuZ2V0Q29udGV4dCgiMmQiKSEKCS8vIFNvbWUgaW1wbGVtZW50YXRpb25zIG1heSBvbmx5IGltcGxlbWVudCBPZmZzY3JlZW5DYW52YXMgcGFydGlhbGx5IChlLmcuIGxhY2tpbmcgMmQpLgoKCWxldCB1c2VPZmZzY3JlZW5DYW52YXMgPSBmYWxzZTsKCgl0cnkgewoKCQl1c2VPZmZzY3JlZW5DYW52YXMgPSB0eXBlb2YgT2Zmc2NyZWVuQ2FudmFzICE9PSAndW5kZWZpbmVkJwoJCQkvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29tcGF0L2NvbXBhdAoJCQkmJiAoIG5ldyBPZmZzY3JlZW5DYW52YXMoIDEsIDEgKS5nZXRDb250ZXh0KCAnMmQnICkgKSAhPT0gbnVsbDsKCgl9IGNhdGNoICggZXJyICkgewoKCQkvLyBJZ25vcmUgYW55IGVycm9ycwoKCX0KCglmdW5jdGlvbiBjcmVhdGVDYW52YXMoIHdpZHRoLCBoZWlnaHQgKSB7CgoJCS8vIFVzZSBPZmZzY3JlZW5DYW52YXMgd2hlbiBhdmFpbGFibGUuIFNwZWNpYWxseSBuZWVkZWQgaW4gd2ViIHdvcmtlcnMKCgkJcmV0dXJuIHVzZU9mZnNjcmVlbkNhbnZhcyA/CgkJCS8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb21wYXQvY29tcGF0CgkJCW5ldyBPZmZzY3JlZW5DYW52YXMoIHdpZHRoLCBoZWlnaHQgKSA6IGNyZWF0ZUVsZW1lbnROUyggJ2NhbnZhcycgKTsKCgl9CgoJZnVuY3Rpb24gcmVzaXplSW1hZ2UoIGltYWdlLCBuZWVkc1Bvd2VyT2ZUd28sIG5lZWRzTmV3Q2FudmFzLCBtYXhTaXplICkgewoKCQlsZXQgc2NhbGUgPSAxOwoKCQkvLyBoYW5kbGUgY2FzZSBpZiB0ZXh0dXJlIGV4Y2VlZHMgbWF4IHNpemUKCgkJaWYgKCBpbWFnZS53aWR0aCA+IG1heFNpemUgfHwgaW1hZ2UuaGVpZ2h0ID4gbWF4U2l6ZSApIHsKCgkJCXNjYWxlID0gbWF4U2l6ZSAvIE1hdGgubWF4KCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICk7CgoJCX0KCgkJLy8gb25seSBwZXJmb3JtIHJlc2l6ZSBpZiBuZWNlc3NhcnkKCgkJaWYgKCBzY2FsZSA8IDEgfHwgbmVlZHNQb3dlck9mVHdvID09PSB0cnVlICkgewoKCQkJLy8gb25seSBwZXJmb3JtIHJlc2l6ZSBmb3IgY2VydGFpbiBpbWFnZSB0eXBlcwoKCQkJaWYgKCAoIHR5cGVvZiBIVE1MSW1hZ2VFbGVtZW50ICE9PSAndW5kZWZpbmVkJyAmJiBpbWFnZSBpbnN0YW5jZW9mIEhUTUxJbWFnZUVsZW1lbnQgKSB8fAoJCQkJKCB0eXBlb2YgSFRNTENhbnZhc0VsZW1lbnQgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSFRNTENhbnZhc0VsZW1lbnQgKSB8fAoJCQkJKCB0eXBlb2YgSW1hZ2VCaXRtYXAgIT09ICd1bmRlZmluZWQnICYmIGltYWdlIGluc3RhbmNlb2YgSW1hZ2VCaXRtYXAgKSApIHsKCgkJCQljb25zdCBmbG9vciA9IG5lZWRzUG93ZXJPZlR3byA/IGZsb29yUG93ZXJPZlR3byA6IE1hdGguZmxvb3I7CgoJCQkJY29uc3Qgd2lkdGggPSBmbG9vciggc2NhbGUgKiBpbWFnZS53aWR0aCApOwoJCQkJY29uc3QgaGVpZ2h0ID0gZmxvb3IoIHNjYWxlICogaW1hZ2UuaGVpZ2h0ICk7CgoJCQkJaWYgKCBfY2FudmFzID09PSB1bmRlZmluZWQgKSBfY2FudmFzID0gY3JlYXRlQ2FudmFzKCB3aWR0aCwgaGVpZ2h0ICk7CgoJCQkJLy8gY3ViZSB0ZXh0dXJlcyBjYW4ndCByZXVzZSB0aGUgc2FtZSBjYW52YXMKCgkJCQljb25zdCBjYW52YXMgPSBuZWVkc05ld0NhbnZhcyA/IGNyZWF0ZUNhbnZhcyggd2lkdGgsIGhlaWdodCApIDogX2NhbnZhczsKCgkJCQljYW52YXMud2lkdGggPSB3aWR0aDsKCQkJCWNhbnZhcy5oZWlnaHQgPSBoZWlnaHQ7CgoJCQkJY29uc3QgY29udGV4dCA9IGNhbnZhcy5nZXRDb250ZXh0KCAnMmQnICk7CgkJCQljb250ZXh0LmRyYXdJbWFnZSggaW1hZ2UsIDAsIDAsIHdpZHRoLCBoZWlnaHQgKTsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBUZXh0dXJlIGhhcyBiZWVuIHJlc2l6ZWQgZnJvbSAoJyArIGltYWdlLndpZHRoICsgJ3gnICsgaW1hZ2UuaGVpZ2h0ICsgJykgdG8gKCcgKyB3aWR0aCArICd4JyArIGhlaWdodCArICcpLicgKTsKCgkJCQlyZXR1cm4gY2FudmFzOwoKCQkJfSBlbHNlIHsKCgkJCQlpZiAoICdkYXRhJyBpbiBpbWFnZSApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogSW1hZ2UgaW4gRGF0YVRleHR1cmUgaXMgdG9vIGJpZyAoJyArIGltYWdlLndpZHRoICsgJ3gnICsgaW1hZ2UuaGVpZ2h0ICsgJykuJyApOwoKCQkJCX0KCgkJCQlyZXR1cm4gaW1hZ2U7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIGltYWdlOwoKCX0KCglmdW5jdGlvbiBpc1Bvd2VyT2ZUd28kMSggaW1hZ2UgKSB7CgoJCXJldHVybiBpc1Bvd2VyT2ZUd28oIGltYWdlLndpZHRoICkgJiYgaXNQb3dlck9mVHdvKCBpbWFnZS5oZWlnaHQgKTsKCgl9CgoJZnVuY3Rpb24gdGV4dHVyZU5lZWRzUG93ZXJPZlR3byggdGV4dHVyZSApIHsKCgkJaWYgKCBpc1dlYkdMMiApIHJldHVybiBmYWxzZTsKCgkJcmV0dXJuICggdGV4dHVyZS53cmFwUyAhPT0gQ2xhbXBUb0VkZ2VXcmFwcGluZyB8fCB0ZXh0dXJlLndyYXBUICE9PSBDbGFtcFRvRWRnZVdyYXBwaW5nICkgfHwKCQkJKCB0ZXh0dXJlLm1pbkZpbHRlciAhPT0gTmVhcmVzdEZpbHRlciAmJiB0ZXh0dXJlLm1pbkZpbHRlciAhPT0gTGluZWFyRmlsdGVyICk7CgoJfQoKCWZ1bmN0aW9uIHRleHR1cmVOZWVkc0dlbmVyYXRlTWlwbWFwcyggdGV4dHVyZSwgc3VwcG9ydHNNaXBzICkgewoKCQlyZXR1cm4gdGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHMgJiYgc3VwcG9ydHNNaXBzICYmCgkJCXRleHR1cmUubWluRmlsdGVyICE9PSBOZWFyZXN0RmlsdGVyICYmIHRleHR1cmUubWluRmlsdGVyICE9PSBMaW5lYXJGaWx0ZXI7CgoJfQoKCWZ1bmN0aW9uIGdlbmVyYXRlTWlwbWFwKCB0YXJnZXQgKSB7CgoJCV9nbC5nZW5lcmF0ZU1pcG1hcCggdGFyZ2V0ICk7CgoJfQoKCWZ1bmN0aW9uIGdldEludGVybmFsRm9ybWF0KCBpbnRlcm5hbEZvcm1hdE5hbWUsIGdsRm9ybWF0LCBnbFR5cGUsIGNvbG9yU3BhY2UsIGZvcmNlTGluZWFyVHJhbnNmZXIgPSBmYWxzZSApIHsKCgkJaWYgKCBpc1dlYkdMMiA9PT0gZmFsc2UgKSByZXR1cm4gZ2xGb3JtYXQ7CgoJCWlmICggaW50ZXJuYWxGb3JtYXROYW1lICE9PSBudWxsICkgewoKCQkJaWYgKCBfZ2xbIGludGVybmFsRm9ybWF0TmFtZSBdICE9PSB1bmRlZmluZWQgKSByZXR1cm4gX2dsWyBpbnRlcm5hbEZvcm1hdE5hbWUgXTsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IEF0dGVtcHQgdG8gdXNlIG5vbi1leGlzdGluZyBXZWJHTCBpbnRlcm5hbCBmb3JtYXQgXCcnICsgaW50ZXJuYWxGb3JtYXROYW1lICsgJ1wnJyApOwoKCQl9CgoJCWxldCBpbnRlcm5hbEZvcm1hdCA9IGdsRm9ybWF0OwoKCQlpZiAoIGdsRm9ybWF0ID09PSBfZ2wuUkVEICkgewoKCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5GTE9BVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlIzMkY7CgkJCWlmICggZ2xUeXBlID09PSBfZ2wuSEFMRl9GTE9BVCApIGludGVybmFsRm9ybWF0ID0gX2dsLlIxNkY7CgkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfQllURSApIGludGVybmFsRm9ybWF0ID0gX2dsLlI4OwoKCQl9CgoJCWlmICggZ2xGb3JtYXQgPT09IF9nbC5SRURfSU5URUdFUiApIHsKCgkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfQllURSApIGludGVybmFsRm9ybWF0ID0gX2dsLlI4VUk7CgkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfU0hPUlQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SMTZVSTsKCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5VTlNJR05FRF9JTlQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SMzJVSTsKCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUjhJOwoJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlNIT1JUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUjE2STsKCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5JTlQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SMzJJOwoKCQl9CgoJCWlmICggZ2xGb3JtYXQgPT09IF9nbC5SRyApIHsKCgkJCWlmICggZ2xUeXBlID09PSBfZ2wuRkxPQVQgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SRzMyRjsKCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5IQUxGX0ZMT0FUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkcxNkY7CgkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfQllURSApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHODsKCgkJfQoKCQlpZiAoIGdsRm9ybWF0ID09PSBfZ2wuUkdCQSApIHsKCgkJCWNvbnN0IHRyYW5zZmVyID0gZm9yY2VMaW5lYXJUcmFuc2ZlciA/IExpbmVhclRyYW5zZmVyIDogQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBjb2xvclNwYWNlICk7CgoJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLkZMT0FUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCQTMyRjsKCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5IQUxGX0ZMT0FUICkgaW50ZXJuYWxGb3JtYXQgPSBfZ2wuUkdCQTE2RjsKCQkJaWYgKCBnbFR5cGUgPT09IF9nbC5VTlNJR05FRF9CWVRFICkgaW50ZXJuYWxGb3JtYXQgPSAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IF9nbC5TUkdCOF9BTFBIQTggOiBfZ2wuUkdCQTg7CgkJCWlmICggZ2xUeXBlID09PSBfZ2wuVU5TSUdORURfU0hPUlRfNF80XzRfNCApIGludGVybmFsRm9ybWF0ID0gX2dsLlJHQkE0OwoJCQlpZiAoIGdsVHlwZSA9PT0gX2dsLlVOU0lHTkVEX1NIT1JUXzVfNV81XzEgKSBpbnRlcm5hbEZvcm1hdCA9IF9nbC5SR0I1X0ExOwoKCQl9CgoJCWlmICggaW50ZXJuYWxGb3JtYXQgPT09IF9nbC5SMTZGIHx8IGludGVybmFsRm9ybWF0ID09PSBfZ2wuUjMyRiB8fAoJCQlpbnRlcm5hbEZvcm1hdCA9PT0gX2dsLlJHMTZGIHx8IGludGVybmFsRm9ybWF0ID09PSBfZ2wuUkczMkYgfHwKCQkJaW50ZXJuYWxGb3JtYXQgPT09IF9nbC5SR0JBMTZGIHx8IGludGVybmFsRm9ybWF0ID09PSBfZ2wuUkdCQTMyRiApIHsKCgkJCWV4dGVuc2lvbnMuZ2V0KCAnRVhUX2NvbG9yX2J1ZmZlcl9mbG9hdCcgKTsKCgkJfQoKCQlyZXR1cm4gaW50ZXJuYWxGb3JtYXQ7CgoJfQoKCWZ1bmN0aW9uIGdldE1pcExldmVscyggdGV4dHVyZSwgaW1hZ2UsIHN1cHBvcnRzTWlwcyApIHsKCgkJaWYgKCB0ZXh0dXJlTmVlZHNHZW5lcmF0ZU1pcG1hcHMoIHRleHR1cmUsIHN1cHBvcnRzTWlwcyApID09PSB0cnVlIHx8ICggdGV4dHVyZS5pc0ZyYW1lYnVmZmVyVGV4dHVyZSAmJiB0ZXh0dXJlLm1pbkZpbHRlciAhPT0gTmVhcmVzdEZpbHRlciAmJiB0ZXh0dXJlLm1pbkZpbHRlciAhPT0gTGluZWFyRmlsdGVyICkgKSB7CgoJCQlyZXR1cm4gTWF0aC5sb2cyKCBNYXRoLm1heCggaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCApICkgKyAxOwoKCQl9IGVsc2UgaWYgKCB0ZXh0dXJlLm1pcG1hcHMgIT09IHVuZGVmaW5lZCAmJiB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoID4gMCApIHsKCgkJCS8vIHVzZXItZGVmaW5lZCBtaXBtYXBzCgoJCQlyZXR1cm4gdGV4dHVyZS5taXBtYXBzLmxlbmd0aDsKCgkJfSBlbHNlIGlmICggdGV4dHVyZS5pc0NvbXByZXNzZWRUZXh0dXJlICYmIEFycmF5LmlzQXJyYXkoIHRleHR1cmUuaW1hZ2UgKSApIHsKCgkJCXJldHVybiBpbWFnZS5taXBtYXBzLmxlbmd0aDsKCgkJfSBlbHNlIHsKCgkJCS8vIHRleHR1cmUgd2l0aG91dCBtaXBtYXBzIChvbmx5IGJhc2UgbGV2ZWwpCgoJCQlyZXR1cm4gMTsKCgkJfQoKCX0KCgkvLyBGYWxsYmFjayBmaWx0ZXJzIGZvciBub24tcG93ZXItb2YtMiB0ZXh0dXJlcwoKCWZ1bmN0aW9uIGZpbHRlckZhbGxiYWNrKCBmICkgewoKCQlpZiAoIGYgPT09IE5lYXJlc3RGaWx0ZXIgfHwgZiA9PT0gTmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXIgfHwgZiA9PT0gTmVhcmVzdE1pcG1hcExpbmVhckZpbHRlciApIHsKCgkJCXJldHVybiBfZ2wuTkVBUkVTVDsKCgkJfQoKCQlyZXR1cm4gX2dsLkxJTkVBUjsKCgl9CgoJLy8KCglmdW5jdGlvbiBvblRleHR1cmVEaXNwb3NlKCBldmVudCApIHsKCgkJY29uc3QgdGV4dHVyZSA9IGV2ZW50LnRhcmdldDsKCgkJdGV4dHVyZS5yZW1vdmVFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uVGV4dHVyZURpc3Bvc2UgKTsKCgkJZGVhbGxvY2F0ZVRleHR1cmUoIHRleHR1cmUgKTsKCgkJaWYgKCB0ZXh0dXJlLmlzVmlkZW9UZXh0dXJlICkgewoKCQkJX3ZpZGVvVGV4dHVyZXMuZGVsZXRlKCB0ZXh0dXJlICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gb25SZW5kZXJUYXJnZXREaXNwb3NlKCBldmVudCApIHsKCgkJY29uc3QgcmVuZGVyVGFyZ2V0ID0gZXZlbnQudGFyZ2V0OwoKCQlyZW5kZXJUYXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvblJlbmRlclRhcmdldERpc3Bvc2UgKTsKCgkJZGVhbGxvY2F0ZVJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0ICk7CgoJfQoKCS8vCgoJZnVuY3Rpb24gZGVhbGxvY2F0ZVRleHR1cmUoIHRleHR1cmUgKSB7CgoJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKTsKCgkJaWYgKCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsSW5pdCA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQkvLyBjaGVjayBpZiBpdCdzIG5lY2Vzc2FyeSB0byByZW1vdmUgdGhlIFdlYkdMVGV4dHVyZSBvYmplY3QKCgkJY29uc3Qgc291cmNlID0gdGV4dHVyZS5zb3VyY2U7CgkJY29uc3Qgd2ViZ2xUZXh0dXJlcyA9IF9zb3VyY2VzLmdldCggc291cmNlICk7CgoJCWlmICggd2ViZ2xUZXh0dXJlcyApIHsKCgkJCWNvbnN0IHdlYmdsVGV4dHVyZSA9IHdlYmdsVGV4dHVyZXNbIHRleHR1cmVQcm9wZXJ0aWVzLl9fY2FjaGVLZXkgXTsKCQkJd2ViZ2xUZXh0dXJlLnVzZWRUaW1lcyAtLTsKCgkJCS8vIHRoZSBXZWJHTFRleHR1cmUgb2JqZWN0IGlzIG5vdCB1c2VkIGFueW1vcmUsIHJlbW92ZSBpdAoKCQkJaWYgKCB3ZWJnbFRleHR1cmUudXNlZFRpbWVzID09PSAwICkgewoKCQkJCWRlbGV0ZVRleHR1cmUoIHRleHR1cmUgKTsKCgkJCX0KCgkJCS8vIHJlbW92ZSB0aGUgd2VhayBtYXAgZW50cnkgaWYgbm8gV2ViR0xUZXh0dXJlIHVzZXMgdGhlIHNvdXJjZSBhbnltb3JlCgoJCQlpZiAoIE9iamVjdC5rZXlzKCB3ZWJnbFRleHR1cmVzICkubGVuZ3RoID09PSAwICkgewoKCQkJCV9zb3VyY2VzLmRlbGV0ZSggc291cmNlICk7CgoJCQl9CgoJCX0KCgkJcHJvcGVydGllcy5yZW1vdmUoIHRleHR1cmUgKTsKCgl9CgoJZnVuY3Rpb24gZGVsZXRlVGV4dHVyZSggdGV4dHVyZSApIHsKCgkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApOwoJCV9nbC5kZWxldGVUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSApOwoKCQljb25zdCBzb3VyY2UgPSB0ZXh0dXJlLnNvdXJjZTsKCQljb25zdCB3ZWJnbFRleHR1cmVzID0gX3NvdXJjZXMuZ2V0KCBzb3VyY2UgKTsKCQlkZWxldGUgd2ViZ2xUZXh0dXJlc1sgdGV4dHVyZVByb3BlcnRpZXMuX19jYWNoZUtleSBdOwoKCQlpbmZvLm1lbW9yeS50ZXh0dXJlcyAtLTsKCgl9CgoJZnVuY3Rpb24gZGVhbGxvY2F0ZVJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0ICkgewoKCQljb25zdCB0ZXh0dXJlID0gcmVuZGVyVGFyZ2V0LnRleHR1cmU7CgoJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgkJY29uc3QgdGV4dHVyZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApOwoKCQlpZiAoIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlICE9PSB1bmRlZmluZWQgKSB7CgoJCQlfZ2wuZGVsZXRlVGV4dHVyZSggdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgKTsKCgkJCWluZm8ubWVtb3J5LnRleHR1cmVzIC0tOwoKCQl9CgoJCWlmICggcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSApIHsKCgkJCXJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuZGlzcG9zZSgpOwoKCQl9CgoJCWlmICggcmVuZGVyVGFyZ2V0LmlzV2ViR0xDdWJlUmVuZGVyVGFyZ2V0ICkgewoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSArKyApIHsKCgkJCQlpZiAoIEFycmF5LmlzQXJyYXkoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF0gKSApIHsKCgkJCQkJZm9yICggbGV0IGxldmVsID0gMDsgbGV2ZWwgPCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlclsgaSBdLmxlbmd0aDsgbGV2ZWwgKysgKSBfZ2wuZGVsZXRlRnJhbWVidWZmZXIoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF1bIGxldmVsIF0gKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlfZ2wuZGVsZXRlRnJhbWVidWZmZXIoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBpIF0gKTsKCgkJCQl9CgoJCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlciApIF9nbC5kZWxldGVSZW5kZXJidWZmZXIoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyWyBpIF0gKTsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCWlmICggQXJyYXkuaXNBcnJheSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgKSApIHsKCgkJCQlmb3IgKCBsZXQgbGV2ZWwgPSAwOyBsZXZlbCA8IHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyLmxlbmd0aDsgbGV2ZWwgKysgKSBfZ2wuZGVsZXRlRnJhbWVidWZmZXIoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyWyBsZXZlbCBdICk7CgoJCQl9IGVsc2UgewoKCQkJCV9nbC5kZWxldGVGcmFtZWJ1ZmZlciggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgKTsKCgkJCX0KCgkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXIgKSBfZ2wuZGVsZXRlUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlciApOwoJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbE11bHRpc2FtcGxlZEZyYW1lYnVmZmVyICkgX2dsLmRlbGV0ZUZyYW1lYnVmZmVyKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlciApOwoKCQkJaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlciApIHsKCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlci5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCWlmICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsQ29sb3JSZW5kZXJidWZmZXJbIGkgXSApIF9nbC5kZWxldGVSZW5kZXJidWZmZXIoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyWyBpIF0gKTsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoUmVuZGVyYnVmZmVyICkgX2dsLmRlbGV0ZVJlbmRlcmJ1ZmZlciggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhSZW5kZXJidWZmZXIgKTsKCgkJfQoKCQlpZiAoIHJlbmRlclRhcmdldC5pc1dlYkdMTXVsdGlwbGVSZW5kZXJUYXJnZXRzICkgewoKCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHRleHR1cmUubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJY29uc3QgYXR0YWNobWVudFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZVsgaSBdICk7CgoJCQkJaWYgKCBhdHRhY2htZW50UHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSApIHsKCgkJCQkJX2dsLmRlbGV0ZVRleHR1cmUoIGF0dGFjaG1lbnRQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlICk7CgoJCQkJCWluZm8ubWVtb3J5LnRleHR1cmVzIC0tOwoKCQkJCX0KCgkJCQlwcm9wZXJ0aWVzLnJlbW92ZSggdGV4dHVyZVsgaSBdICk7CgoJCQl9CgoJCX0KCgkJcHJvcGVydGllcy5yZW1vdmUoIHRleHR1cmUgKTsKCQlwcm9wZXJ0aWVzLnJlbW92ZSggcmVuZGVyVGFyZ2V0ICk7CgoJfQoKCS8vCgoJbGV0IHRleHR1cmVVbml0cyA9IDA7CgoJZnVuY3Rpb24gcmVzZXRUZXh0dXJlVW5pdHMoKSB7CgoJCXRleHR1cmVVbml0cyA9IDA7CgoJfQoKCWZ1bmN0aW9uIGFsbG9jYXRlVGV4dHVyZVVuaXQoKSB7CgoJCWNvbnN0IHRleHR1cmVVbml0ID0gdGV4dHVyZVVuaXRzOwoKCQlpZiAoIHRleHR1cmVVbml0ID49IG1heFRleHR1cmVzICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xUZXh0dXJlczogVHJ5aW5nIHRvIHVzZSAnICsgdGV4dHVyZVVuaXQgKyAnIHRleHR1cmUgdW5pdHMgd2hpbGUgdGhpcyBHUFUgc3VwcG9ydHMgb25seSAnICsgbWF4VGV4dHVyZXMgKTsKCgkJfQoKCQl0ZXh0dXJlVW5pdHMgKz0gMTsKCgkJcmV0dXJuIHRleHR1cmVVbml0OwoKCX0KCglmdW5jdGlvbiBnZXRUZXh0dXJlQ2FjaGVLZXkoIHRleHR1cmUgKSB7CgoJCWNvbnN0IGFycmF5ID0gW107CgoJCWFycmF5LnB1c2goIHRleHR1cmUud3JhcFMgKTsKCQlhcnJheS5wdXNoKCB0ZXh0dXJlLndyYXBUICk7CgkJYXJyYXkucHVzaCggdGV4dHVyZS53cmFwUiB8fCAwICk7CgkJYXJyYXkucHVzaCggdGV4dHVyZS5tYWdGaWx0ZXIgKTsKCQlhcnJheS5wdXNoKCB0ZXh0dXJlLm1pbkZpbHRlciApOwoJCWFycmF5LnB1c2goIHRleHR1cmUuYW5pc290cm9weSApOwoJCWFycmF5LnB1c2goIHRleHR1cmUuaW50ZXJuYWxGb3JtYXQgKTsKCQlhcnJheS5wdXNoKCB0ZXh0dXJlLmZvcm1hdCApOwoJCWFycmF5LnB1c2goIHRleHR1cmUudHlwZSApOwoJCWFycmF5LnB1c2goIHRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzICk7CgkJYXJyYXkucHVzaCggdGV4dHVyZS5wcmVtdWx0aXBseUFscGhhICk7CgkJYXJyYXkucHVzaCggdGV4dHVyZS5mbGlwWSApOwoJCWFycmF5LnB1c2goIHRleHR1cmUudW5wYWNrQWxpZ25tZW50ICk7CgkJYXJyYXkucHVzaCggdGV4dHVyZS5jb2xvclNwYWNlICk7CgoJCXJldHVybiBhcnJheS5qb2luKCk7CgoJfQoKCS8vCgoJZnVuY3Rpb24gc2V0VGV4dHVyZTJEKCB0ZXh0dXJlLCBzbG90ICkgewoKCQljb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICk7CgoJCWlmICggdGV4dHVyZS5pc1ZpZGVvVGV4dHVyZSApIHVwZGF0ZVZpZGVvVGV4dHVyZSggdGV4dHVyZSApOwoKCQlpZiAoIHRleHR1cmUuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID09PSBmYWxzZSAmJiB0ZXh0dXJlLnZlcnNpb24gPiAwICYmIHRleHR1cmVQcm9wZXJ0aWVzLl9fdmVyc2lvbiAhPT0gdGV4dHVyZS52ZXJzaW9uICkgewoKCQkJY29uc3QgaW1hZ2UgPSB0ZXh0dXJlLmltYWdlOwoKCQkJaWYgKCBpbWFnZSA9PT0gbnVsbCApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBUZXh0dXJlIG1hcmtlZCBmb3IgdXBkYXRlIGJ1dCBubyBpbWFnZSBkYXRhIGZvdW5kLicgKTsKCgkJCX0gZWxzZSBpZiAoIGltYWdlLmNvbXBsZXRlID09PSBmYWxzZSApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBUZXh0dXJlIG1hcmtlZCBmb3IgdXBkYXRlIGJ1dCBpbWFnZSBpcyBpbmNvbXBsZXRlJyApOwoKCQkJfSBlbHNlIHsKCgkJCQl1cGxvYWRUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSwgc2xvdCApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQl9CgoJCXN0YXRlLmJpbmRUZXh0dXJlKCBfZ2wuVEVYVFVSRV8yRCwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIF9nbC5URVhUVVJFMCArIHNsb3QgKTsKCgl9CgoJZnVuY3Rpb24gc2V0VGV4dHVyZTJEQXJyYXkoIHRleHR1cmUsIHNsb3QgKSB7CgoJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKTsKCgkJaWYgKCB0ZXh0dXJlLnZlcnNpb24gPiAwICYmIHRleHR1cmVQcm9wZXJ0aWVzLl9fdmVyc2lvbiAhPT0gdGV4dHVyZS52ZXJzaW9uICkgewoKCQkJdXBsb2FkVGV4dHVyZSggdGV4dHVyZVByb3BlcnRpZXMsIHRleHR1cmUsIHNsb3QgKTsKCQkJcmV0dXJuOwoKCQl9CgoJCXN0YXRlLmJpbmRUZXh0dXJlKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIF9nbC5URVhUVVJFMCArIHNsb3QgKTsKCgl9CgoJZnVuY3Rpb24gc2V0VGV4dHVyZTNEKCB0ZXh0dXJlLCBzbG90ICkgewoKCQljb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICk7CgoJCWlmICggdGV4dHVyZS52ZXJzaW9uID4gMCAmJiB0ZXh0dXJlUHJvcGVydGllcy5fX3ZlcnNpb24gIT09IHRleHR1cmUudmVyc2lvbiApIHsKCgkJCXVwbG9hZFRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlLCBzbG90ICk7CgkJCXJldHVybjsKCgkJfQoKCQlzdGF0ZS5iaW5kVGV4dHVyZSggX2dsLlRFWFRVUkVfM0QsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCBfZ2wuVEVYVFVSRTAgKyBzbG90ICk7CgoJfQoKCWZ1bmN0aW9uIHNldFRleHR1cmVDdWJlKCB0ZXh0dXJlLCBzbG90ICkgewoKCQljb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlICk7CgoJCWlmICggdGV4dHVyZS52ZXJzaW9uID4gMCAmJiB0ZXh0dXJlUHJvcGVydGllcy5fX3ZlcnNpb24gIT09IHRleHR1cmUudmVyc2lvbiApIHsKCgkJCXVwbG9hZEN1YmVUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSwgc2xvdCApOwoJCQlyZXR1cm47CgoJCX0KCgkJc3RhdGUuYmluZFRleHR1cmUoIF9nbC5URVhUVVJFX0NVQkVfTUFQLCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSwgX2dsLlRFWFRVUkUwICsgc2xvdCApOwoKCX0KCgljb25zdCB3cmFwcGluZ1RvR0wgPSB7CgkJWyBSZXBlYXRXcmFwcGluZyBdOiBfZ2wuUkVQRUFULAoJCVsgQ2xhbXBUb0VkZ2VXcmFwcGluZyBdOiBfZ2wuQ0xBTVBfVE9fRURHRSwKCQlbIE1pcnJvcmVkUmVwZWF0V3JhcHBpbmcgXTogX2dsLk1JUlJPUkVEX1JFUEVBVAoJfTsKCgljb25zdCBmaWx0ZXJUb0dMID0gewoJCVsgTmVhcmVzdEZpbHRlciBdOiBfZ2wuTkVBUkVTVCwKCQlbIE5lYXJlc3RNaXBtYXBOZWFyZXN0RmlsdGVyIF06IF9nbC5ORUFSRVNUX01JUE1BUF9ORUFSRVNULAoJCVsgTmVhcmVzdE1pcG1hcExpbmVhckZpbHRlciBdOiBfZ2wuTkVBUkVTVF9NSVBNQVBfTElORUFSLAoKCQlbIExpbmVhckZpbHRlciBdOiBfZ2wuTElORUFSLAoJCVsgTGluZWFyTWlwbWFwTmVhcmVzdEZpbHRlciBdOiBfZ2wuTElORUFSX01JUE1BUF9ORUFSRVNULAoJCVsgTGluZWFyTWlwbWFwTGluZWFyRmlsdGVyIF06IF9nbC5MSU5FQVJfTUlQTUFQX0xJTkVBUgoJfTsKCgljb25zdCBjb21wYXJlVG9HTCA9IHsKCQlbIE5ldmVyQ29tcGFyZSBdOiBfZ2wuTkVWRVIsCgkJWyBBbHdheXNDb21wYXJlIF06IF9nbC5BTFdBWVMsCgkJWyBMZXNzQ29tcGFyZSBdOiBfZ2wuTEVTUywKCQlbIExlc3NFcXVhbENvbXBhcmUgXTogX2dsLkxFUVVBTCwKCQlbIEVxdWFsQ29tcGFyZSBdOiBfZ2wuRVFVQUwsCgkJWyBHcmVhdGVyRXF1YWxDb21wYXJlIF06IF9nbC5HRVFVQUwsCgkJWyBHcmVhdGVyQ29tcGFyZSBdOiBfZ2wuR1JFQVRFUiwKCQlbIE5vdEVxdWFsQ29tcGFyZSBdOiBfZ2wuTk9URVFVQUwKCX07CgoJZnVuY3Rpb24gc2V0VGV4dHVyZVBhcmFtZXRlcnMoIHRleHR1cmVUeXBlLCB0ZXh0dXJlLCBzdXBwb3J0c01pcHMgKSB7CgoJCWlmICggc3VwcG9ydHNNaXBzICkgewoKCQkJX2dsLnRleFBhcmFtZXRlcmkoIHRleHR1cmVUeXBlLCBfZ2wuVEVYVFVSRV9XUkFQX1MsIHdyYXBwaW5nVG9HTFsgdGV4dHVyZS53cmFwUyBdICk7CgkJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgX2dsLlRFWFRVUkVfV1JBUF9ULCB3cmFwcGluZ1RvR0xbIHRleHR1cmUud3JhcFQgXSApOwoKCQkJaWYgKCB0ZXh0dXJlVHlwZSA9PT0gX2dsLlRFWFRVUkVfM0QgfHwgdGV4dHVyZVR5cGUgPT09IF9nbC5URVhUVVJFXzJEX0FSUkFZICkgewoKCQkJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgX2dsLlRFWFRVUkVfV1JBUF9SLCB3cmFwcGluZ1RvR0xbIHRleHR1cmUud3JhcFIgXSApOwoKCQkJfQoKCQkJX2dsLnRleFBhcmFtZXRlcmkoIHRleHR1cmVUeXBlLCBfZ2wuVEVYVFVSRV9NQUdfRklMVEVSLCBmaWx0ZXJUb0dMWyB0ZXh0dXJlLm1hZ0ZpbHRlciBdICk7CgkJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgX2dsLlRFWFRVUkVfTUlOX0ZJTFRFUiwgZmlsdGVyVG9HTFsgdGV4dHVyZS5taW5GaWx0ZXIgXSApOwoKCQl9IGVsc2UgewoKCQkJX2dsLnRleFBhcmFtZXRlcmkoIHRleHR1cmVUeXBlLCBfZ2wuVEVYVFVSRV9XUkFQX1MsIF9nbC5DTEFNUF9UT19FREdFICk7CgkJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgX2dsLlRFWFRVUkVfV1JBUF9ULCBfZ2wuQ0xBTVBfVE9fRURHRSApOwoKCQkJaWYgKCB0ZXh0dXJlVHlwZSA9PT0gX2dsLlRFWFRVUkVfM0QgfHwgdGV4dHVyZVR5cGUgPT09IF9nbC5URVhUVVJFXzJEX0FSUkFZICkgewoKCQkJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgX2dsLlRFWFRVUkVfV1JBUF9SLCBfZ2wuQ0xBTVBfVE9fRURHRSApOwoKCQkJfQoKCQkJaWYgKCB0ZXh0dXJlLndyYXBTICE9PSBDbGFtcFRvRWRnZVdyYXBwaW5nIHx8IHRleHR1cmUud3JhcFQgIT09IENsYW1wVG9FZGdlV3JhcHBpbmcgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVGV4dHVyZSBpcyBub3QgcG93ZXIgb2YgdHdvLiBUZXh0dXJlLndyYXBTIGFuZCBUZXh0dXJlLndyYXBUIHNob3VsZCBiZSBzZXQgdG8gVEhSRUUuQ2xhbXBUb0VkZ2VXcmFwcGluZy4nICk7CgoJCQl9CgoJCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIF9nbC5URVhUVVJFX01BR19GSUxURVIsIGZpbHRlckZhbGxiYWNrKCB0ZXh0dXJlLm1hZ0ZpbHRlciApICk7CgkJCV9nbC50ZXhQYXJhbWV0ZXJpKCB0ZXh0dXJlVHlwZSwgX2dsLlRFWFRVUkVfTUlOX0ZJTFRFUiwgZmlsdGVyRmFsbGJhY2soIHRleHR1cmUubWluRmlsdGVyICkgKTsKCgkJCWlmICggdGV4dHVyZS5taW5GaWx0ZXIgIT09IE5lYXJlc3RGaWx0ZXIgJiYgdGV4dHVyZS5taW5GaWx0ZXIgIT09IExpbmVhckZpbHRlciApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBUZXh0dXJlIGlzIG5vdCBwb3dlciBvZiB0d28uIFRleHR1cmUubWluRmlsdGVyIHNob3VsZCBiZSBzZXQgdG8gVEhSRUUuTmVhcmVzdEZpbHRlciBvciBUSFJFRS5MaW5lYXJGaWx0ZXIuJyApOwoKCQkJfQoKCQl9CgoJCWlmICggdGV4dHVyZS5jb21wYXJlRnVuY3Rpb24gKSB7CgoJCQlfZ2wudGV4UGFyYW1ldGVyaSggdGV4dHVyZVR5cGUsIF9nbC5URVhUVVJFX0NPTVBBUkVfTU9ERSwgX2dsLkNPTVBBUkVfUkVGX1RPX1RFWFRVUkUgKTsKCQkJX2dsLnRleFBhcmFtZXRlcmkoIHRleHR1cmVUeXBlLCBfZ2wuVEVYVFVSRV9DT01QQVJFX0ZVTkMsIGNvbXBhcmVUb0dMWyB0ZXh0dXJlLmNvbXBhcmVGdW5jdGlvbiBdICk7CgoJCX0KCgkJaWYgKCBleHRlbnNpb25zLmhhcyggJ0VYVF90ZXh0dXJlX2ZpbHRlcl9hbmlzb3Ryb3BpYycgKSA9PT0gdHJ1ZSApIHsKCgkJCWNvbnN0IGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnRVhUX3RleHR1cmVfZmlsdGVyX2FuaXNvdHJvcGljJyApOwoKCQkJaWYgKCB0ZXh0dXJlLm1hZ0ZpbHRlciA9PT0gTmVhcmVzdEZpbHRlciApIHJldHVybjsKCQkJaWYgKCB0ZXh0dXJlLm1pbkZpbHRlciAhPT0gTmVhcmVzdE1pcG1hcExpbmVhckZpbHRlciAmJiB0ZXh0dXJlLm1pbkZpbHRlciAhPT0gTGluZWFyTWlwbWFwTGluZWFyRmlsdGVyICkgcmV0dXJuOwoJCQlpZiAoIHRleHR1cmUudHlwZSA9PT0gRmxvYXRUeXBlICYmIGV4dGVuc2lvbnMuaGFzKCAnT0VTX3RleHR1cmVfZmxvYXRfbGluZWFyJyApID09PSBmYWxzZSApIHJldHVybjsgLy8gdmVyaWZ5IGV4dGVuc2lvbiBmb3IgV2ViR0wgMSBhbmQgV2ViR0wgMgoJCQlpZiAoIGlzV2ViR0wyID09PSBmYWxzZSAmJiAoIHRleHR1cmUudHlwZSA9PT0gSGFsZkZsb2F0VHlwZSAmJiBleHRlbnNpb25zLmhhcyggJ09FU190ZXh0dXJlX2hhbGZfZmxvYXRfbGluZWFyJyApID09PSBmYWxzZSApICkgcmV0dXJuOyAvLyB2ZXJpZnkgZXh0ZW5zaW9uIGZvciBXZWJHTCAxIG9ubHkKCgkJCWlmICggdGV4dHVyZS5hbmlzb3Ryb3B5ID4gMSB8fCBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApLl9fY3VycmVudEFuaXNvdHJvcHkgKSB7CgoJCQkJX2dsLnRleFBhcmFtZXRlcmYoIHRleHR1cmVUeXBlLCBleHRlbnNpb24uVEVYVFVSRV9NQVhfQU5JU09UUk9QWV9FWFQsIE1hdGgubWluKCB0ZXh0dXJlLmFuaXNvdHJvcHksIGNhcGFiaWxpdGllcy5nZXRNYXhBbmlzb3Ryb3B5KCkgKSApOwoJCQkJcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKS5fX2N1cnJlbnRBbmlzb3Ryb3B5ID0gdGV4dHVyZS5hbmlzb3Ryb3B5OwoKCQkJfQoKCQl9CgoJfQoKCWZ1bmN0aW9uIGluaXRUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSApIHsKCgkJbGV0IGZvcmNlVXBsb2FkID0gZmFsc2U7CgoJCWlmICggdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbEluaXQgPT09IHVuZGVmaW5lZCApIHsKCgkJCXRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xJbml0ID0gdHJ1ZTsKCgkJCXRleHR1cmUuYWRkRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvblRleHR1cmVEaXNwb3NlICk7CgoJCX0KCgkJLy8gY3JlYXRlIFNvdXJjZSA8LT4gV2ViR0xUZXh0dXJlcyBtYXBwaW5nIGlmIG5lY2Vzc2FyeQoKCQljb25zdCBzb3VyY2UgPSB0ZXh0dXJlLnNvdXJjZTsKCQlsZXQgd2ViZ2xUZXh0dXJlcyA9IF9zb3VyY2VzLmdldCggc291cmNlICk7CgoJCWlmICggd2ViZ2xUZXh0dXJlcyA9PT0gdW5kZWZpbmVkICkgewoKCQkJd2ViZ2xUZXh0dXJlcyA9IHt9OwoJCQlfc291cmNlcy5zZXQoIHNvdXJjZSwgd2ViZ2xUZXh0dXJlcyApOwoKCQl9CgoJCS8vIGNoZWNrIGlmIHRoZXJlIGlzIGFscmVhZHkgYSBXZWJHTFRleHR1cmUgb2JqZWN0IGZvciB0aGUgZ2l2ZW4gdGV4dHVyZSBwYXJhbWV0ZXJzCgoJCWNvbnN0IHRleHR1cmVDYWNoZUtleSA9IGdldFRleHR1cmVDYWNoZUtleSggdGV4dHVyZSApOwoKCQlpZiAoIHRleHR1cmVDYWNoZUtleSAhPT0gdGV4dHVyZVByb3BlcnRpZXMuX19jYWNoZUtleSApIHsKCgkJCS8vIGlmIG5vdCwgY3JlYXRlIGEgbmV3IGluc3RhbmNlIG9mIFdlYkdMVGV4dHVyZQoKCQkJaWYgKCB3ZWJnbFRleHR1cmVzWyB0ZXh0dXJlQ2FjaGVLZXkgXSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCS8vIGNyZWF0ZSBuZXcgZW50cnkKCgkJCQl3ZWJnbFRleHR1cmVzWyB0ZXh0dXJlQ2FjaGVLZXkgXSA9IHsKCQkJCQl0ZXh0dXJlOiBfZ2wuY3JlYXRlVGV4dHVyZSgpLAoJCQkJCXVzZWRUaW1lczogMAoJCQkJfTsKCgkJCQlpbmZvLm1lbW9yeS50ZXh0dXJlcyArKzsKCgkJCQkvLyB3aGVuIGEgbmV3IGluc3RhbmNlIG9mIFdlYkdMVGV4dHVyZSB3YXMgY3JlYXRlZCwgYSB0ZXh0dXJlIHVwbG9hZCBpcyByZXF1aXJlZAoJCQkJLy8gZXZlbiBpZiB0aGUgaW1hZ2UgY29udGVudHMgYXJlIGlkZW50aWNhbAoKCQkJCWZvcmNlVXBsb2FkID0gdHJ1ZTsKCgkJCX0KCgkJCXdlYmdsVGV4dHVyZXNbIHRleHR1cmVDYWNoZUtleSBdLnVzZWRUaW1lcyArKzsKCgkJCS8vIGV2ZXJ5IHRpbWUgdGhlIHRleHR1cmUgY2FjaGUga2V5IGNoYW5nZXMsIGl0J3MgbmVjZXNzYXJ5IHRvIGNoZWNrIGlmIGFuIGluc3RhbmNlIG9mCgkJCS8vIFdlYkdMVGV4dHVyZSBjYW4gYmUgZGVsZXRlZCBpbiBvcmRlciB0byBhdm9pZCBhIG1lbW9yeSBsZWFrLgoKCQkJY29uc3Qgd2ViZ2xUZXh0dXJlID0gd2ViZ2xUZXh0dXJlc1sgdGV4dHVyZVByb3BlcnRpZXMuX19jYWNoZUtleSBdOwoKCQkJaWYgKCB3ZWJnbFRleHR1cmUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQl3ZWJnbFRleHR1cmVzWyB0ZXh0dXJlUHJvcGVydGllcy5fX2NhY2hlS2V5IF0udXNlZFRpbWVzIC0tOwoKCQkJCWlmICggd2ViZ2xUZXh0dXJlLnVzZWRUaW1lcyA9PT0gMCApIHsKCgkJCQkJZGVsZXRlVGV4dHVyZSggdGV4dHVyZSApOwoKCQkJCX0KCgkJCX0KCgkJCS8vIHN0b3JlIHJlZmVyZW5jZXMgdG8gY2FjaGUga2V5IGFuZCBXZWJHTFRleHR1cmUgb2JqZWN0CgoJCQl0ZXh0dXJlUHJvcGVydGllcy5fX2NhY2hlS2V5ID0gdGV4dHVyZUNhY2hlS2V5OwoJCQl0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSA9IHdlYmdsVGV4dHVyZXNbIHRleHR1cmVDYWNoZUtleSBdLnRleHR1cmU7CgoJCX0KCgkJcmV0dXJuIGZvcmNlVXBsb2FkOwoKCX0KCglmdW5jdGlvbiB1cGxvYWRUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSwgc2xvdCApIHsKCgkJbGV0IHRleHR1cmVUeXBlID0gX2dsLlRFWFRVUkVfMkQ7CgoJCWlmICggdGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgfHwgdGV4dHVyZS5pc0NvbXByZXNzZWRBcnJheVRleHR1cmUgKSB0ZXh0dXJlVHlwZSA9IF9nbC5URVhUVVJFXzJEX0FSUkFZOwoJCWlmICggdGV4dHVyZS5pc0RhdGEzRFRleHR1cmUgKSB0ZXh0dXJlVHlwZSA9IF9nbC5URVhUVVJFXzNEOwoKCQljb25zdCBmb3JjZVVwbG9hZCA9IGluaXRUZXh0dXJlKCB0ZXh0dXJlUHJvcGVydGllcywgdGV4dHVyZSApOwoJCWNvbnN0IHNvdXJjZSA9IHRleHR1cmUuc291cmNlOwoKCQlzdGF0ZS5iaW5kVGV4dHVyZSggdGV4dHVyZVR5cGUsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCBfZ2wuVEVYVFVSRTAgKyBzbG90ICk7CgoJCWNvbnN0IHNvdXJjZVByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggc291cmNlICk7CgoJCWlmICggc291cmNlLnZlcnNpb24gIT09IHNvdXJjZVByb3BlcnRpZXMuX192ZXJzaW9uIHx8IGZvcmNlVXBsb2FkID09PSB0cnVlICkgewoKCQkJc3RhdGUuYWN0aXZlVGV4dHVyZSggX2dsLlRFWFRVUkUwICsgc2xvdCApOwoKCQkJY29uc3Qgd29ya2luZ1ByaW1hcmllcyA9IENvbG9yTWFuYWdlbWVudC5nZXRQcmltYXJpZXMoIENvbG9yTWFuYWdlbWVudC53b3JraW5nQ29sb3JTcGFjZSApOwoJCQljb25zdCB0ZXh0dXJlUHJpbWFyaWVzID0gdGV4dHVyZS5jb2xvclNwYWNlID09PSBOb0NvbG9yU3BhY2UgPyBudWxsIDogQ29sb3JNYW5hZ2VtZW50LmdldFByaW1hcmllcyggdGV4dHVyZS5jb2xvclNwYWNlICk7CgkJCWNvbnN0IHVucGFja0NvbnZlcnNpb24gPSB0ZXh0dXJlLmNvbG9yU3BhY2UgPT09IE5vQ29sb3JTcGFjZSB8fCB3b3JraW5nUHJpbWFyaWVzID09PSB0ZXh0dXJlUHJpbWFyaWVzID8gX2dsLk5PTkUgOiBfZ2wuQlJPV1NFUl9ERUZBVUxUX1dFQkdMOwoKCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgdGV4dHVyZS5mbGlwWSApOwoJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfUFJFTVVMVElQTFlfQUxQSEFfV0VCR0wsIHRleHR1cmUucHJlbXVsdGlwbHlBbHBoYSApOwoJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfQUxJR05NRU5ULCB0ZXh0dXJlLnVucGFja0FsaWdubWVudCApOwoJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfQ09MT1JTUEFDRV9DT05WRVJTSU9OX1dFQkdMLCB1bnBhY2tDb252ZXJzaW9uICk7CgoJCQljb25zdCBuZWVkc1Bvd2VyT2ZUd28gPSB0ZXh0dXJlTmVlZHNQb3dlck9mVHdvKCB0ZXh0dXJlICkgJiYgaXNQb3dlck9mVHdvJDEoIHRleHR1cmUuaW1hZ2UgKSA9PT0gZmFsc2U7CgkJCWxldCBpbWFnZSA9IHJlc2l6ZUltYWdlKCB0ZXh0dXJlLmltYWdlLCBuZWVkc1Bvd2VyT2ZUd28sIGZhbHNlLCBtYXhUZXh0dXJlU2l6ZSApOwoJCQlpbWFnZSA9IHZlcmlmeUNvbG9yU3BhY2UoIHRleHR1cmUsIGltYWdlICk7CgoJCQljb25zdCBzdXBwb3J0c01pcHMgPSBpc1Bvd2VyT2ZUd28kMSggaW1hZ2UgKSB8fCBpc1dlYkdMMiwKCQkJCWdsRm9ybWF0ID0gdXRpbHMuY29udmVydCggdGV4dHVyZS5mb3JtYXQsIHRleHR1cmUuY29sb3JTcGFjZSApOwoKCQkJbGV0IGdsVHlwZSA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUudHlwZSApLAoJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IGdldEludGVybmFsRm9ybWF0KCB0ZXh0dXJlLmludGVybmFsRm9ybWF0LCBnbEZvcm1hdCwgZ2xUeXBlLCB0ZXh0dXJlLmNvbG9yU3BhY2UsIHRleHR1cmUuaXNWaWRlb1RleHR1cmUgKTsKCgkJCXNldFRleHR1cmVQYXJhbWV0ZXJzKCB0ZXh0dXJlVHlwZSwgdGV4dHVyZSwgc3VwcG9ydHNNaXBzICk7CgoJCQlsZXQgbWlwbWFwOwoJCQljb25zdCBtaXBtYXBzID0gdGV4dHVyZS5taXBtYXBzOwoKCQkJY29uc3QgdXNlVGV4U3RvcmFnZSA9ICggaXNXZWJHTDIgJiYgdGV4dHVyZS5pc1ZpZGVvVGV4dHVyZSAhPT0gdHJ1ZSApOwoJCQljb25zdCBhbGxvY2F0ZU1lbW9yeSA9ICggc291cmNlUHJvcGVydGllcy5fX3ZlcnNpb24gPT09IHVuZGVmaW5lZCApIHx8ICggZm9yY2VVcGxvYWQgPT09IHRydWUgKTsKCQkJY29uc3QgbGV2ZWxzID0gZ2V0TWlwTGV2ZWxzKCB0ZXh0dXJlLCBpbWFnZSwgc3VwcG9ydHNNaXBzICk7CgoJCQlpZiAoIHRleHR1cmUuaXNEZXB0aFRleHR1cmUgKSB7CgoJCQkJLy8gcG9wdWxhdGUgZGVwdGggdGV4dHVyZSB3aXRoIGR1bW15IGRhdGEKCgkJCQlnbEludGVybmFsRm9ybWF0ID0gX2dsLkRFUFRIX0NPTVBPTkVOVDsKCgkJCQlpZiAoIGlzV2ViR0wyICkgewoKCQkJCQlpZiAoIHRleHR1cmUudHlwZSA9PT0gRmxvYXRUeXBlICkgewoKCQkJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IF9nbC5ERVBUSF9DT01QT05FTlQzMkY7CgoJCQkJCX0gZWxzZSBpZiAoIHRleHR1cmUudHlwZSA9PT0gVW5zaWduZWRJbnRUeXBlICkgewoKCQkJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IF9nbC5ERVBUSF9DT01QT05FTlQyNDsKCgkJCQkJfSBlbHNlIGlmICggdGV4dHVyZS50eXBlID09PSBVbnNpZ25lZEludDI0OFR5cGUgKSB7CgoJCQkJCQlnbEludGVybmFsRm9ybWF0ID0gX2dsLkRFUFRIMjRfU1RFTkNJTDg7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlnbEludGVybmFsRm9ybWF0ID0gX2dsLkRFUFRIX0NPTVBPTkVOVDE2OyAvLyBXZWJHTDIgcmVxdWlyZXMgc2l6ZWQgaW50ZXJuYWxmb3JtYXQgZm9yIGdsVGV4SW1hZ2UyRAoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJaWYgKCB0ZXh0dXJlLnR5cGUgPT09IEZsb2F0VHlwZSApIHsKCgkJCQkJCWNvbnNvbGUuZXJyb3IoICdXZWJHTFJlbmRlcmVyOiBGbG9hdGluZyBwb2ludCBkZXB0aCB0ZXh0dXJlIHJlcXVpcmVzIFdlYkdMMi4nICk7CgoJCQkJCX0KCgkJCQl9CgoJCQkJLy8gdmFsaWRhdGlvbiBjaGVja3MgZm9yIFdlYkdMIDEKCgkJCQlpZiAoIHRleHR1cmUuZm9ybWF0ID09PSBEZXB0aEZvcm1hdCAmJiBnbEludGVybmFsRm9ybWF0ID09PSBfZ2wuREVQVEhfQ09NUE9ORU5UICkgewoKCQkJCQkvLyBUaGUgZXJyb3IgSU5WQUxJRF9PUEVSQVRJT04gaXMgZ2VuZXJhdGVkIGJ5IHRleEltYWdlMkQgaWYgZm9ybWF0IGFuZCBpbnRlcm5hbGZvcm1hdCBhcmUKCQkJCQkvLyBERVBUSF9DT01QT05FTlQgYW5kIHR5cGUgaXMgbm90IFVOU0lHTkVEX1NIT1JUIG9yIFVOU0lHTkVEX0lOVAoJCQkJCS8vIChodHRwczovL3d3dy5raHJvbm9zLm9yZy9yZWdpc3RyeS93ZWJnbC9leHRlbnNpb25zL1dFQkdMX2RlcHRoX3RleHR1cmUvKQoJCQkJCWlmICggdGV4dHVyZS50eXBlICE9PSBVbnNpZ25lZFNob3J0VHlwZSAmJiB0ZXh0dXJlLnR5cGUgIT09IFVuc2lnbmVkSW50VHlwZSApIHsKCgkJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFVzZSBVbnNpZ25lZFNob3J0VHlwZSBvciBVbnNpZ25lZEludFR5cGUgZm9yIERlcHRoRm9ybWF0IERlcHRoVGV4dHVyZS4nICk7CgoJCQkJCQl0ZXh0dXJlLnR5cGUgPSBVbnNpZ25lZEludFR5cGU7CgkJCQkJCWdsVHlwZSA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUudHlwZSApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCWlmICggdGV4dHVyZS5mb3JtYXQgPT09IERlcHRoU3RlbmNpbEZvcm1hdCAmJiBnbEludGVybmFsRm9ybWF0ID09PSBfZ2wuREVQVEhfQ09NUE9ORU5UICkgewoKCQkJCQkvLyBEZXB0aCBzdGVuY2lsIHRleHR1cmVzIG5lZWQgdGhlIERFUFRIX1NURU5DSUwgaW50ZXJuYWwgZm9ybWF0CgkJCQkJLy8gKGh0dHBzOi8vd3d3Lmtocm9ub3Mub3JnL3JlZ2lzdHJ5L3dlYmdsL2V4dGVuc2lvbnMvV0VCR0xfZGVwdGhfdGV4dHVyZS8pCgkJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IF9nbC5ERVBUSF9TVEVOQ0lMOwoKCQkJCQkvLyBUaGUgZXJyb3IgSU5WQUxJRF9PUEVSQVRJT04gaXMgZ2VuZXJhdGVkIGJ5IHRleEltYWdlMkQgaWYgZm9ybWF0IGFuZCBpbnRlcm5hbGZvcm1hdCBhcmUKCQkJCQkvLyBERVBUSF9TVEVOQ0lMIGFuZCB0eXBlIGlzIG5vdCBVTlNJR05FRF9JTlRfMjRfOF9XRUJHTC4KCQkJCQkvLyAoaHR0cHM6Ly93d3cua2hyb25vcy5vcmcvcmVnaXN0cnkvd2ViZ2wvZXh0ZW5zaW9ucy9XRUJHTF9kZXB0aF90ZXh0dXJlLykKCQkJCQlpZiAoIHRleHR1cmUudHlwZSAhPT0gVW5zaWduZWRJbnQyNDhUeXBlICkgewoKCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVXNlIFVuc2lnbmVkSW50MjQ4VHlwZSBmb3IgRGVwdGhTdGVuY2lsRm9ybWF0IERlcHRoVGV4dHVyZS4nICk7CgoJCQkJCQl0ZXh0dXJlLnR5cGUgPSBVbnNpZ25lZEludDI0OFR5cGU7CgkJCQkJCWdsVHlwZSA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUudHlwZSApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCS8vCgoJCQkJaWYgKCBhbGxvY2F0ZU1lbW9yeSApIHsKCgkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKCQkJCQkJc3RhdGUudGV4U3RvcmFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgMSwgZ2xJbnRlcm5hbEZvcm1hdCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIDAsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG51bGwgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0gZWxzZSBpZiAoIHRleHR1cmUuaXNEYXRhVGV4dHVyZSApIHsKCgkJCQkvLyB1c2UgbWFudWFsbHkgY3JlYXRlZCBtaXBtYXBzIGlmIGF2YWlsYWJsZQoJCQkJLy8gaWYgdGhlcmUgYXJlIG5vIG1hbnVhbCBtaXBtYXBzCgkJCQkvLyBzZXQgMCBsZXZlbCBtaXBtYXAgYW5kIHRoZW4gdXNlIEdMIHRvIGdlbmVyYXRlIG90aGVyIG1pcG1hcCBsZXZlbHMKCgkJCQlpZiAoIG1pcG1hcHMubGVuZ3RoID4gMCAmJiBzdXBwb3J0c01pcHMgKSB7CgoJCQkJCWlmICggdXNlVGV4U3RvcmFnZSAmJiBhbGxvY2F0ZU1lbW9yeSApIHsKCgkJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwc1sgMCBdLndpZHRoLCBtaXBtYXBzWyAwIF0uaGVpZ2h0ICk7CgoJCQkJCX0KCgkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG1pcG1hcHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQltaXBtYXAgPSBtaXBtYXBzWyBpIF07CgoJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGksIDAsIDAsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmRhdGEgKTsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGksIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmRhdGEgKTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCQl0ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyA9IGZhbHNlOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCWlmICggYWxsb2NhdGVNZW1vcnkgKSB7CgoJCQkJCQkJc3RhdGUudGV4U3RvcmFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgbGV2ZWxzLCBnbEludGVybmFsRm9ybWF0LCBpbWFnZS53aWR0aCwgaW1hZ2UuaGVpZ2h0ICk7CgoJCQkJCQl9CgoJCQkJCQlzdGF0ZS50ZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgMCwgMCwgMCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UuZGF0YSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIDAsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0gZWxzZSBpZiAoIHRleHR1cmUuaXNDb21wcmVzc2VkVGV4dHVyZSApIHsKCgkJCQlpZiAoIHRleHR1cmUuaXNDb21wcmVzc2VkQXJyYXlUZXh0dXJlICkgewoKCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgJiYgYWxsb2NhdGVNZW1vcnkgKSB7CgoJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlM0QoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcHNbIDAgXS53aWR0aCwgbWlwbWFwc1sgMCBdLmhlaWdodCwgaW1hZ2UuZGVwdGggKTsKCgkJCQkJfQoKCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gbWlwbWFwcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCW1pcG1hcCA9IG1pcG1hcHNbIGkgXTsKCgkJCQkJCWlmICggdGV4dHVyZS5mb3JtYXQgIT09IFJHQkFGb3JtYXQgKSB7CgoJCQkJCQkJaWYgKCBnbEZvcm1hdCAhPT0gbnVsbCApIHsKCgkJCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKCQkJCQkJCQkJc3RhdGUuY29tcHJlc3NlZFRleFN1YkltYWdlM0QoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCBpLCAwLCAwLCAwLCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIGltYWdlLmRlcHRoLCBnbEZvcm1hdCwgbWlwbWFwLmRhdGEsIDAsIDAgKTsKCgkJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJCXN0YXRlLmNvbXByZXNzZWRUZXhJbWFnZTNEKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCBpbWFnZS5kZXB0aCwgMCwgbWlwbWFwLmRhdGEsIDAsIDAgKTsKCgkJCQkJCQkJfQoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IEF0dGVtcHQgdG8gbG9hZCB1bnN1cHBvcnRlZCBjb21wcmVzc2VkIHRleHR1cmUgZm9ybWF0IGluIC51cGxvYWRUZXh0dXJlKCknICk7CgoJCQkJCQkJfQoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlM0QoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCBpLCAwLCAwLCAwLCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIGltYWdlLmRlcHRoLCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCXN0YXRlLnRleEltYWdlM0QoIF9nbC5URVhUVVJFXzJEX0FSUkFZLCBpLCBnbEludGVybmFsRm9ybWF0LCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIGltYWdlLmRlcHRoLCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCWlmICggdXNlVGV4U3RvcmFnZSAmJiBhbGxvY2F0ZU1lbW9yeSApIHsKCgkJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwc1sgMCBdLndpZHRoLCBtaXBtYXBzWyAwIF0uaGVpZ2h0ICk7CgoJCQkJCX0KCgkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG1pcG1hcHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQltaXBtYXAgPSBtaXBtYXBzWyBpIF07CgoJCQkJCQlpZiAoIHRleHR1cmUuZm9ybWF0ICE9PSBSR0JBRm9ybWF0ICkgewoKCQkJCQkJCWlmICggZ2xGb3JtYXQgIT09IG51bGwgKSB7CgoJCQkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCQkJCXN0YXRlLmNvbXByZXNzZWRUZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgMCwgMCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCBnbEZvcm1hdCwgbWlwbWFwLmRhdGEgKTsKCgkJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJCXN0YXRlLmNvbXByZXNzZWRUZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAwLCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCQl9CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogQXR0ZW1wdCB0byBsb2FkIHVuc3VwcG9ydGVkIGNvbXByZXNzZWQgdGV4dHVyZSBmb3JtYXQgaW4gLnVwbG9hZFRleHR1cmUoKScgKTsKCgkJCQkJCQl9CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGksIDAsIDAsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmRhdGEgKTsKCgkJCQkJCQl9IGVsc2UgewoKCQkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0KCgkJCX0gZWxzZSBpZiAoIHRleHR1cmUuaXNEYXRhQXJyYXlUZXh0dXJlICkgewoKCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJaWYgKCBhbGxvY2F0ZU1lbW9yeSApIHsKCgkJCQkJCXN0YXRlLnRleFN0b3JhZ2UzRCggX2dsLlRFWFRVUkVfMkRfQVJSQVksIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgaW1hZ2UuZGVwdGggKTsKCgkJCQkJfQoKCQkJCQlzdGF0ZS50ZXhTdWJJbWFnZTNEKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgMCwgMCwgMCwgMCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgaW1hZ2UuZGVwdGgsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlzdGF0ZS50ZXhJbWFnZTNEKCBfZ2wuVEVYVFVSRV8yRF9BUlJBWSwgMCwgZ2xJbnRlcm5hbEZvcm1hdCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCwgaW1hZ2UuZGVwdGgsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCgkJCQl9CgoJCQl9IGVsc2UgaWYgKCB0ZXh0dXJlLmlzRGF0YTNEVGV4dHVyZSApIHsKCgkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCWlmICggYWxsb2NhdGVNZW1vcnkgKSB7CgoJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlM0QoIF9nbC5URVhUVVJFXzNELCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIGltYWdlLmRlcHRoICk7CgoJCQkJCX0KCgkJCQkJc3RhdGUudGV4U3ViSW1hZ2UzRCggX2dsLlRFWFRVUkVfM0QsIDAsIDAsIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIGltYWdlLmRlcHRoLCBnbEZvcm1hdCwgZ2xUeXBlLCBpbWFnZS5kYXRhICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJc3RhdGUudGV4SW1hZ2UzRCggX2dsLlRFWFRVUkVfM0QsIDAsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIGltYWdlLmRlcHRoLCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBpbWFnZS5kYXRhICk7CgoJCQkJfQoKCQkJfSBlbHNlIGlmICggdGV4dHVyZS5pc0ZyYW1lYnVmZmVyVGV4dHVyZSApIHsKCgkJCQlpZiAoIGFsbG9jYXRlTWVtb3J5ICkgewoKCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQlzdGF0ZS50ZXhTdG9yYWdlMkQoIF9nbC5URVhUVVJFXzJELCBsZXZlbHMsIGdsSW50ZXJuYWxGb3JtYXQsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQgKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWxldCB3aWR0aCA9IGltYWdlLndpZHRoLCBoZWlnaHQgPSBpbWFnZS5oZWlnaHQ7CgoJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBsZXZlbHM7IGkgKysgKSB7CgoJCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGksIGdsSW50ZXJuYWxGb3JtYXQsIHdpZHRoLCBoZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG51bGwgKTsKCgkJCQkJCQl3aWR0aCA+Pj0gMTsKCQkJCQkJCWhlaWdodCA+Pj0gMTsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJLy8gcmVndWxhciBUZXh0dXJlIChpbWFnZSwgdmlkZW8sIGNhbnZhcykKCgkJCQkvLyB1c2UgbWFudWFsbHkgY3JlYXRlZCBtaXBtYXBzIGlmIGF2YWlsYWJsZQoJCQkJLy8gaWYgdGhlcmUgYXJlIG5vIG1hbnVhbCBtaXBtYXBzCgkJCQkvLyBzZXQgMCBsZXZlbCBtaXBtYXAgYW5kIHRoZW4gdXNlIEdMIHRvIGdlbmVyYXRlIG90aGVyIG1pcG1hcCBsZXZlbHMKCgkJCQlpZiAoIG1pcG1hcHMubGVuZ3RoID4gMCAmJiBzdXBwb3J0c01pcHMgKSB7CgoJCQkJCWlmICggdXNlVGV4U3RvcmFnZSAmJiBhbGxvY2F0ZU1lbW9yeSApIHsKCgkJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwc1sgMCBdLndpZHRoLCBtaXBtYXBzWyAwIF0uaGVpZ2h0ICk7CgoJCQkJCX0KCgkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG1pcG1hcHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQltaXBtYXAgPSBtaXBtYXBzWyBpIF07CgoJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGksIDAsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcCApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgaSwgZ2xJbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQkJdGV4dHVyZS5nZW5lcmF0ZU1pcG1hcHMgPSBmYWxzZTsKCgkJCQl9IGVsc2UgewoKCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQlpZiAoIGFsbG9jYXRlTWVtb3J5ICkgewoKCQkJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCApOwoKCQkJCQkJfQoKCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIDAsIDAsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgMCwgZ2xJbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCWlmICggdGV4dHVyZU5lZWRzR2VuZXJhdGVNaXBtYXBzKCB0ZXh0dXJlLCBzdXBwb3J0c01pcHMgKSApIHsKCgkJCQlnZW5lcmF0ZU1pcG1hcCggdGV4dHVyZVR5cGUgKTsKCgkJCX0KCgkJCXNvdXJjZVByb3BlcnRpZXMuX192ZXJzaW9uID0gc291cmNlLnZlcnNpb247CgoJCQlpZiAoIHRleHR1cmUub25VcGRhdGUgKSB0ZXh0dXJlLm9uVXBkYXRlKCB0ZXh0dXJlICk7CgoJCX0KCgkJdGV4dHVyZVByb3BlcnRpZXMuX192ZXJzaW9uID0gdGV4dHVyZS52ZXJzaW9uOwoKCX0KCglmdW5jdGlvbiB1cGxvYWRDdWJlVGV4dHVyZSggdGV4dHVyZVByb3BlcnRpZXMsIHRleHR1cmUsIHNsb3QgKSB7CgoJCWlmICggdGV4dHVyZS5pbWFnZS5sZW5ndGggIT09IDYgKSByZXR1cm47CgoJCWNvbnN0IGZvcmNlVXBsb2FkID0gaW5pdFRleHR1cmUoIHRleHR1cmVQcm9wZXJ0aWVzLCB0ZXh0dXJlICk7CgkJY29uc3Qgc291cmNlID0gdGV4dHVyZS5zb3VyY2U7CgoJCXN0YXRlLmJpbmRUZXh0dXJlKCBfZ2wuVEVYVFVSRV9DVUJFX01BUCwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIF9nbC5URVhUVVJFMCArIHNsb3QgKTsKCgkJY29uc3Qgc291cmNlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBzb3VyY2UgKTsKCgkJaWYgKCBzb3VyY2UudmVyc2lvbiAhPT0gc291cmNlUHJvcGVydGllcy5fX3ZlcnNpb24gfHwgZm9yY2VVcGxvYWQgPT09IHRydWUgKSB7CgoJCQlzdGF0ZS5hY3RpdmVUZXh0dXJlKCBfZ2wuVEVYVFVSRTAgKyBzbG90ICk7CgoJCQljb25zdCB3b3JraW5nUHJpbWFyaWVzID0gQ29sb3JNYW5hZ2VtZW50LmdldFByaW1hcmllcyggQ29sb3JNYW5hZ2VtZW50LndvcmtpbmdDb2xvclNwYWNlICk7CgkJCWNvbnN0IHRleHR1cmVQcmltYXJpZXMgPSB0ZXh0dXJlLmNvbG9yU3BhY2UgPT09IE5vQ29sb3JTcGFjZSA/IG51bGwgOiBDb2xvck1hbmFnZW1lbnQuZ2V0UHJpbWFyaWVzKCB0ZXh0dXJlLmNvbG9yU3BhY2UgKTsKCQkJY29uc3QgdW5wYWNrQ29udmVyc2lvbiA9IHRleHR1cmUuY29sb3JTcGFjZSA9PT0gTm9Db2xvclNwYWNlIHx8IHdvcmtpbmdQcmltYXJpZXMgPT09IHRleHR1cmVQcmltYXJpZXMgPyBfZ2wuTk9ORSA6IF9nbC5CUk9XU0VSX0RFRkFVTFRfV0VCR0w7CgoJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfRkxJUF9ZX1dFQkdMLCB0ZXh0dXJlLmZsaXBZICk7CgkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19QUkVNVUxUSVBMWV9BTFBIQV9XRUJHTCwgdGV4dHVyZS5wcmVtdWx0aXBseUFscGhhICk7CgkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19BTElHTk1FTlQsIHRleHR1cmUudW5wYWNrQWxpZ25tZW50ICk7CgkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19DT0xPUlNQQUNFX0NPTlZFUlNJT05fV0VCR0wsIHVucGFja0NvbnZlcnNpb24gKTsKCgkJCWNvbnN0IGlzQ29tcHJlc3NlZCA9ICggdGV4dHVyZS5pc0NvbXByZXNzZWRUZXh0dXJlIHx8IHRleHR1cmUuaW1hZ2VbIDAgXS5pc0NvbXByZXNzZWRUZXh0dXJlICk7CgkJCWNvbnN0IGlzRGF0YVRleHR1cmUgPSAoIHRleHR1cmUuaW1hZ2VbIDAgXSAmJiB0ZXh0dXJlLmltYWdlWyAwIF0uaXNEYXRhVGV4dHVyZSApOwoKCQkJY29uc3QgY3ViZUltYWdlID0gW107CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKCQkJCWlmICggISBpc0NvbXByZXNzZWQgJiYgISBpc0RhdGFUZXh0dXJlICkgewoKCQkJCQljdWJlSW1hZ2VbIGkgXSA9IHJlc2l6ZUltYWdlKCB0ZXh0dXJlLmltYWdlWyBpIF0sIGZhbHNlLCB0cnVlLCBtYXhDdWJlbWFwU2l6ZSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWN1YmVJbWFnZVsgaSBdID0gaXNEYXRhVGV4dHVyZSA/IHRleHR1cmUuaW1hZ2VbIGkgXS5pbWFnZSA6IHRleHR1cmUuaW1hZ2VbIGkgXTsKCgkJCQl9CgoJCQkJY3ViZUltYWdlWyBpIF0gPSB2ZXJpZnlDb2xvclNwYWNlKCB0ZXh0dXJlLCBjdWJlSW1hZ2VbIGkgXSApOwoKCQkJfQoKCQkJY29uc3QgaW1hZ2UgPSBjdWJlSW1hZ2VbIDAgXSwKCQkJCXN1cHBvcnRzTWlwcyA9IGlzUG93ZXJPZlR3byQxKCBpbWFnZSApIHx8IGlzV2ViR0wyLAoJCQkJZ2xGb3JtYXQgPSB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLmZvcm1hdCwgdGV4dHVyZS5jb2xvclNwYWNlICksCgkJCQlnbFR5cGUgPSB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlLnR5cGUgKSwKCQkJCWdsSW50ZXJuYWxGb3JtYXQgPSBnZXRJbnRlcm5hbEZvcm1hdCggdGV4dHVyZS5pbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgdGV4dHVyZS5jb2xvclNwYWNlICk7CgoJCQljb25zdCB1c2VUZXhTdG9yYWdlID0gKCBpc1dlYkdMMiAmJiB0ZXh0dXJlLmlzVmlkZW9UZXh0dXJlICE9PSB0cnVlICk7CgkJCWNvbnN0IGFsbG9jYXRlTWVtb3J5ID0gKCBzb3VyY2VQcm9wZXJ0aWVzLl9fdmVyc2lvbiA9PT0gdW5kZWZpbmVkICkgfHwgKCBmb3JjZVVwbG9hZCA9PT0gdHJ1ZSApOwoJCQlsZXQgbGV2ZWxzID0gZ2V0TWlwTGV2ZWxzKCB0ZXh0dXJlLCBpbWFnZSwgc3VwcG9ydHNNaXBzICk7CgoJCQlzZXRUZXh0dXJlUGFyYW1ldGVycyggX2dsLlRFWFRVUkVfQ1VCRV9NQVAsIHRleHR1cmUsIHN1cHBvcnRzTWlwcyApOwoKCQkJbGV0IG1pcG1hcHM7CgoJCQlpZiAoIGlzQ29tcHJlc3NlZCApIHsKCgkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgJiYgYWxsb2NhdGVNZW1vcnkgKSB7CgoJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVAsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgaW1hZ2Uud2lkdGgsIGltYWdlLmhlaWdodCApOwoKCQkJCX0KCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKCQkJCQltaXBtYXBzID0gY3ViZUltYWdlWyBpIF0ubWlwbWFwczsKCgkJCQkJZm9yICggbGV0IGogPSAwOyBqIDwgbWlwbWFwcy5sZW5ndGg7IGogKysgKSB7CgoJCQkJCQljb25zdCBtaXBtYXAgPSBtaXBtYXBzWyBqIF07CgoJCQkJCQlpZiAoIHRleHR1cmUuZm9ybWF0ICE9PSBSR0JBRm9ybWF0ICkgewoKCQkJCQkJCWlmICggZ2xGb3JtYXQgIT09IG51bGwgKSB7CgoJCQkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCQkJCXN0YXRlLmNvbXByZXNzZWRUZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgaSwgaiwgMCwgMCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCBnbEZvcm1hdCwgbWlwbWFwLmRhdGEgKTsKCgkJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJCXN0YXRlLmNvbXByZXNzZWRUZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgaSwgaiwgZ2xJbnRlcm5hbEZvcm1hdCwgbWlwbWFwLndpZHRoLCBtaXBtYXAuaGVpZ2h0LCAwLCBtaXBtYXAuZGF0YSApOwoKCQkJCQkJCQl9CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogQXR0ZW1wdCB0byBsb2FkIHVuc3VwcG9ydGVkIGNvbXByZXNzZWQgdGV4dHVyZSBmb3JtYXQgaW4gLnNldFRleHR1cmVDdWJlKCknICk7CgoJCQkJCQkJfQoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJCXN0YXRlLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBqLCAwLCAwLCBtaXBtYXAud2lkdGgsIG1pcG1hcC5oZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcC5kYXRhICk7CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIGosIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcC53aWR0aCwgbWlwbWFwLmhlaWdodCwgMCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmRhdGEgKTsKCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCW1pcG1hcHMgPSB0ZXh0dXJlLm1pcG1hcHM7CgoJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICYmIGFsbG9jYXRlTWVtb3J5ICkgewoKCQkJCQkvLyBUT0RPOiBVbmlmb3JtbHkgaGFuZGxlIG1pcG1hcCBkZWZpbml0aW9ucwoJCQkJCS8vIE5vcm1hbCB0ZXh0dXJlcyBhbmQgY29tcHJlc3NlZCBjdWJlIHRleHR1cmVzIGRlZmluZSBiYXNlIGxldmVsICsgbWlwcyB3aXRoIHRoZWlyIG1pcG1hcCBhcnJheQoJCQkJCS8vIFVuY29tcHJlc3NlZCBjdWJlIHRleHR1cmVzIHVzZSB0aGVpciBtaXBtYXAgYXJyYXkgb25seSBmb3IgbWlwcyAobm8gYmFzZSBsZXZlbCkKCgkJCQkJaWYgKCBtaXBtYXBzLmxlbmd0aCA+IDAgKSBsZXZlbHMgKys7CgoJCQkJCXN0YXRlLnRleFN0b3JhZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVAsIGxldmVscywgZ2xJbnRlcm5hbEZvcm1hdCwgY3ViZUltYWdlWyAwIF0ud2lkdGgsIGN1YmVJbWFnZVsgMCBdLmhlaWdodCApOwoKCQkJCX0KCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKCQkJCQlpZiAoIGlzRGF0YVRleHR1cmUgKSB7CgoJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIDAsIDAsIDAsIGN1YmVJbWFnZVsgaSBdLndpZHRoLCBjdWJlSW1hZ2VbIGkgXS5oZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIGN1YmVJbWFnZVsgaSBdLmRhdGEgKTsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJc3RhdGUudGV4SW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIDAsIGdsSW50ZXJuYWxGb3JtYXQsIGN1YmVJbWFnZVsgaSBdLndpZHRoLCBjdWJlSW1hZ2VbIGkgXS5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIGN1YmVJbWFnZVsgaSBdLmRhdGEgKTsKCgkJCQkJCX0KCgkJCQkJCWZvciAoIGxldCBqID0gMDsgaiA8IG1pcG1hcHMubGVuZ3RoOyBqICsrICkgewoKCQkJCQkJCWNvbnN0IG1pcG1hcCA9IG1pcG1hcHNbIGogXTsKCQkJCQkJCWNvbnN0IG1pcG1hcEltYWdlID0gbWlwbWFwLmltYWdlWyBpIF0uaW1hZ2U7CgoJCQkJCQkJaWYgKCB1c2VUZXhTdG9yYWdlICkgewoKCQkJCQkJCQlzdGF0ZS50ZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgaSwgaiArIDEsIDAsIDAsIG1pcG1hcEltYWdlLndpZHRoLCBtaXBtYXBJbWFnZS5oZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcEltYWdlLmRhdGEgKTsKCgkJCQkJCQl9IGVsc2UgewoKCQkJCQkJCQlzdGF0ZS50ZXhJbWFnZTJEKCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgaSwgaiArIDEsIGdsSW50ZXJuYWxGb3JtYXQsIG1pcG1hcEltYWdlLndpZHRoLCBtaXBtYXBJbWFnZS5oZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG1pcG1hcEltYWdlLmRhdGEgKTsKCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlpZiAoIHVzZVRleFN0b3JhZ2UgKSB7CgoJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIDAsIDAsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIGN1YmVJbWFnZVsgaSBdICk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCXN0YXRlLnRleEltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCAwLCBnbEludGVybmFsRm9ybWF0LCBnbEZvcm1hdCwgZ2xUeXBlLCBjdWJlSW1hZ2VbIGkgXSApOwoKCQkJCQkJfQoKCQkJCQkJZm9yICggbGV0IGogPSAwOyBqIDwgbWlwbWFwcy5sZW5ndGg7IGogKysgKSB7CgoJCQkJCQkJY29uc3QgbWlwbWFwID0gbWlwbWFwc1sgaiBdOwoKCQkJCQkJCWlmICggdXNlVGV4U3RvcmFnZSApIHsKCgkJCQkJCQkJc3RhdGUudGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIGogKyAxLCAwLCAwLCBnbEZvcm1hdCwgZ2xUeXBlLCBtaXBtYXAuaW1hZ2VbIGkgXSApOwoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCXN0YXRlLnRleEltYWdlMkQoIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCBqICsgMSwgZ2xJbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgbWlwbWFwLmltYWdlWyBpIF0gKTsKCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHRleHR1cmVOZWVkc0dlbmVyYXRlTWlwbWFwcyggdGV4dHVyZSwgc3VwcG9ydHNNaXBzICkgKSB7CgoJCQkJLy8gV2UgYXNzdW1lIGltYWdlcyBmb3IgY3ViZSBtYXAgaGF2ZSB0aGUgc2FtZSBzaXplLgoJCQkJZ2VuZXJhdGVNaXBtYXAoIF9nbC5URVhUVVJFX0NVQkVfTUFQICk7CgoJCQl9CgoJCQlzb3VyY2VQcm9wZXJ0aWVzLl9fdmVyc2lvbiA9IHNvdXJjZS52ZXJzaW9uOwoKCQkJaWYgKCB0ZXh0dXJlLm9uVXBkYXRlICkgdGV4dHVyZS5vblVwZGF0ZSggdGV4dHVyZSApOwoKCQl9CgoJCXRleHR1cmVQcm9wZXJ0aWVzLl9fdmVyc2lvbiA9IHRleHR1cmUudmVyc2lvbjsKCgl9CgoJLy8gUmVuZGVyIHRhcmdldHMKCgkvLyBTZXR1cCBzdG9yYWdlIGZvciB0YXJnZXQgdGV4dHVyZSBhbmQgYmluZCBpdCB0byBjb3JyZWN0IGZyYW1lYnVmZmVyCglmdW5jdGlvbiBzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZSggZnJhbWVidWZmZXIsIHJlbmRlclRhcmdldCwgdGV4dHVyZSwgYXR0YWNobWVudCwgdGV4dHVyZVRhcmdldCwgbGV2ZWwgKSB7CgoJCWNvbnN0IGdsRm9ybWF0ID0gdXRpbHMuY29udmVydCggdGV4dHVyZS5mb3JtYXQsIHRleHR1cmUuY29sb3JTcGFjZSApOwoJCWNvbnN0IGdsVHlwZSA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUudHlwZSApOwoJCWNvbnN0IGdsSW50ZXJuYWxGb3JtYXQgPSBnZXRJbnRlcm5hbEZvcm1hdCggdGV4dHVyZS5pbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgdGV4dHVyZS5jb2xvclNwYWNlICk7CgkJY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKCgkJaWYgKCAhIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19oYXNFeHRlcm5hbFRleHR1cmVzICkgewoKCQkJY29uc3Qgd2lkdGggPSBNYXRoLm1heCggMSwgcmVuZGVyVGFyZ2V0LndpZHRoID4+IGxldmVsICk7CgkJCWNvbnN0IGhlaWdodCA9IE1hdGgubWF4KCAxLCByZW5kZXJUYXJnZXQuaGVpZ2h0ID4+IGxldmVsICk7CgoJCQlpZiAoIHRleHR1cmVUYXJnZXQgPT09IF9nbC5URVhUVVJFXzNEIHx8IHRleHR1cmVUYXJnZXQgPT09IF9nbC5URVhUVVJFXzJEX0FSUkFZICkgewoKCQkJCXN0YXRlLnRleEltYWdlM0QoIHRleHR1cmVUYXJnZXQsIGxldmVsLCBnbEludGVybmFsRm9ybWF0LCB3aWR0aCwgaGVpZ2h0LCByZW5kZXJUYXJnZXQuZGVwdGgsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG51bGwgKTsKCgkJCX0gZWxzZSB7CgoJCQkJc3RhdGUudGV4SW1hZ2UyRCggdGV4dHVyZVRhcmdldCwgbGV2ZWwsIGdsSW50ZXJuYWxGb3JtYXQsIHdpZHRoLCBoZWlnaHQsIDAsIGdsRm9ybWF0LCBnbFR5cGUsIG51bGwgKTsKCgkJCX0KCgkJfQoKCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZnJhbWVidWZmZXIgKTsKCgkJaWYgKCB1c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApICkgewoKCQkJbXVsdGlzYW1wbGVkUlRURXh0LmZyYW1lYnVmZmVyVGV4dHVyZTJETXVsdGlzYW1wbGVFWFQoIF9nbC5GUkFNRUJVRkZFUiwgYXR0YWNobWVudCwgdGV4dHVyZVRhcmdldCwgcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKS5fX3dlYmdsVGV4dHVyZSwgMCwgZ2V0UmVuZGVyVGFyZ2V0U2FtcGxlcyggcmVuZGVyVGFyZ2V0ICkgKTsKCgkJfSBlbHNlIGlmICggdGV4dHVyZVRhcmdldCA9PT0gX2dsLlRFWFRVUkVfMkQgfHwgKCB0ZXh0dXJlVGFyZ2V0ID49IF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggJiYgdGV4dHVyZVRhcmdldCA8PSBfZ2wuVEVYVFVSRV9DVUJFX01BUF9ORUdBVElWRV9aICkgKSB7IC8vIHNlZSAjMjQ3NTMKCgkJCV9nbC5mcmFtZWJ1ZmZlclRleHR1cmUyRCggX2dsLkZSQU1FQlVGRkVSLCBhdHRhY2htZW50LCB0ZXh0dXJlVGFyZ2V0LCBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZSApLl9fd2ViZ2xUZXh0dXJlLCBsZXZlbCApOwoKCQl9CgoJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBudWxsICk7CgoJfQoKCgkvLyBTZXR1cCBzdG9yYWdlIGZvciBpbnRlcm5hbCBkZXB0aC9zdGVuY2lsIGJ1ZmZlcnMgYW5kIGJpbmQgdG8gY29ycmVjdCBmcmFtZWJ1ZmZlcgoJZnVuY3Rpb24gc2V0dXBSZW5kZXJCdWZmZXJTdG9yYWdlKCByZW5kZXJidWZmZXIsIHJlbmRlclRhcmdldCwgaXNNdWx0aXNhbXBsZSApIHsKCgkJX2dsLmJpbmRSZW5kZXJidWZmZXIoIF9nbC5SRU5ERVJCVUZGRVIsIHJlbmRlcmJ1ZmZlciApOwoKCQlpZiAoIHJlbmRlclRhcmdldC5kZXB0aEJ1ZmZlciAmJiAhIHJlbmRlclRhcmdldC5zdGVuY2lsQnVmZmVyICkgewoKCQkJbGV0IGdsSW50ZXJuYWxGb3JtYXQgPSAoIGlzV2ViR0wyID09PSB0cnVlICkgPyBfZ2wuREVQVEhfQ09NUE9ORU5UMjQgOiBfZ2wuREVQVEhfQ09NUE9ORU5UMTY7CgoJCQlpZiAoIGlzTXVsdGlzYW1wbGUgfHwgdXNlTXVsdGlzYW1wbGVkUlRUKCByZW5kZXJUYXJnZXQgKSApIHsKCgkJCQljb25zdCBkZXB0aFRleHR1cmUgPSByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlOwoKCQkJCWlmICggZGVwdGhUZXh0dXJlICYmIGRlcHRoVGV4dHVyZS5pc0RlcHRoVGV4dHVyZSApIHsKCgkJCQkJaWYgKCBkZXB0aFRleHR1cmUudHlwZSA9PT0gRmxvYXRUeXBlICkgewoKCQkJCQkJZ2xJbnRlcm5hbEZvcm1hdCA9IF9nbC5ERVBUSF9DT01QT05FTlQzMkY7CgoJCQkJCX0gZWxzZSBpZiAoIGRlcHRoVGV4dHVyZS50eXBlID09PSBVbnNpZ25lZEludFR5cGUgKSB7CgoJCQkJCQlnbEludGVybmFsRm9ybWF0ID0gX2dsLkRFUFRIX0NPTVBPTkVOVDI0OwoKCQkJCQl9CgoJCQkJfQoKCQkJCWNvbnN0IHNhbXBsZXMgPSBnZXRSZW5kZXJUYXJnZXRTYW1wbGVzKCByZW5kZXJUYXJnZXQgKTsKCgkJCQlpZiAoIHVzZU11bHRpc2FtcGxlZFJUVCggcmVuZGVyVGFyZ2V0ICkgKSB7CgoJCQkJCW11bHRpc2FtcGxlZFJUVEV4dC5yZW5kZXJidWZmZXJTdG9yYWdlTXVsdGlzYW1wbGVFWFQoIF9nbC5SRU5ERVJCVUZGRVIsIHNhbXBsZXMsIGdsSW50ZXJuYWxGb3JtYXQsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCV9nbC5yZW5kZXJidWZmZXJTdG9yYWdlTXVsdGlzYW1wbGUoIF9nbC5SRU5ERVJCVUZGRVIsIHNhbXBsZXMsIGdsSW50ZXJuYWxGb3JtYXQsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJX2dsLnJlbmRlcmJ1ZmZlclN0b3JhZ2UoIF9nbC5SRU5ERVJCVUZGRVIsIGdsSW50ZXJuYWxGb3JtYXQsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKCQkJfQoKCQkJX2dsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIF9nbC5ERVBUSF9BVFRBQ0hNRU5ULCBfZ2wuUkVOREVSQlVGRkVSLCByZW5kZXJidWZmZXIgKTsKCgkJfSBlbHNlIGlmICggcmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyICYmIHJlbmRlclRhcmdldC5zdGVuY2lsQnVmZmVyICkgewoKCQkJY29uc3Qgc2FtcGxlcyA9IGdldFJlbmRlclRhcmdldFNhbXBsZXMoIHJlbmRlclRhcmdldCApOwoKCQkJaWYgKCBpc011bHRpc2FtcGxlICYmIHVzZU11bHRpc2FtcGxlZFJUVCggcmVuZGVyVGFyZ2V0ICkgPT09IGZhbHNlICkgewoKCQkJCV9nbC5yZW5kZXJidWZmZXJTdG9yYWdlTXVsdGlzYW1wbGUoIF9nbC5SRU5ERVJCVUZGRVIsIHNhbXBsZXMsIF9nbC5ERVBUSDI0X1NURU5DSUw4LCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQgKTsKCgkJCX0gZWxzZSBpZiAoIHVzZU11bHRpc2FtcGxlZFJUVCggcmVuZGVyVGFyZ2V0ICkgKSB7CgoJCQkJbXVsdGlzYW1wbGVkUlRURXh0LnJlbmRlcmJ1ZmZlclN0b3JhZ2VNdWx0aXNhbXBsZUVYVCggX2dsLlJFTkRFUkJVRkZFUiwgc2FtcGxlcywgX2dsLkRFUFRIMjRfU1RFTkNJTDgsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKCQkJfSBlbHNlIHsKCgkJCQlfZ2wucmVuZGVyYnVmZmVyU3RvcmFnZSggX2dsLlJFTkRFUkJVRkZFUiwgX2dsLkRFUFRIX1NURU5DSUwsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKCQkJfQoKCgkJCV9nbC5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBfZ2wuREVQVEhfU1RFTkNJTF9BVFRBQ0hNRU5ULCBfZ2wuUkVOREVSQlVGRkVSLCByZW5kZXJidWZmZXIgKTsKCgkJfSBlbHNlIHsKCgkJCWNvbnN0IHRleHR1cmVzID0gcmVuZGVyVGFyZ2V0LmlzV2ViR0xNdWx0aXBsZVJlbmRlclRhcmdldHMgPT09IHRydWUgPyByZW5kZXJUYXJnZXQudGV4dHVyZSA6IFsgcmVuZGVyVGFyZ2V0LnRleHR1cmUgXTsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IHRleHR1cmVzLmxlbmd0aDsgaSArKyApIHsKCgkJCQljb25zdCB0ZXh0dXJlID0gdGV4dHVyZXNbIGkgXTsKCgkJCQljb25zdCBnbEZvcm1hdCA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUuZm9ybWF0LCB0ZXh0dXJlLmNvbG9yU3BhY2UgKTsKCQkJCWNvbnN0IGdsVHlwZSA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUudHlwZSApOwoJCQkJY29uc3QgZ2xJbnRlcm5hbEZvcm1hdCA9IGdldEludGVybmFsRm9ybWF0KCB0ZXh0dXJlLmludGVybmFsRm9ybWF0LCBnbEZvcm1hdCwgZ2xUeXBlLCB0ZXh0dXJlLmNvbG9yU3BhY2UgKTsKCQkJCWNvbnN0IHNhbXBsZXMgPSBnZXRSZW5kZXJUYXJnZXRTYW1wbGVzKCByZW5kZXJUYXJnZXQgKTsKCgkJCQlpZiAoIGlzTXVsdGlzYW1wbGUgJiYgdXNlTXVsdGlzYW1wbGVkUlRUKCByZW5kZXJUYXJnZXQgKSA9PT0gZmFsc2UgKSB7CgoJCQkJCV9nbC5yZW5kZXJidWZmZXJTdG9yYWdlTXVsdGlzYW1wbGUoIF9nbC5SRU5ERVJCVUZGRVIsIHNhbXBsZXMsIGdsSW50ZXJuYWxGb3JtYXQsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKCQkJCX0gZWxzZSBpZiAoIHVzZU11bHRpc2FtcGxlZFJUVCggcmVuZGVyVGFyZ2V0ICkgKSB7CgoJCQkJCW11bHRpc2FtcGxlZFJUVEV4dC5yZW5kZXJidWZmZXJTdG9yYWdlTXVsdGlzYW1wbGVFWFQoIF9nbC5SRU5ERVJCVUZGRVIsIHNhbXBsZXMsIGdsSW50ZXJuYWxGb3JtYXQsIHJlbmRlclRhcmdldC53aWR0aCwgcmVuZGVyVGFyZ2V0LmhlaWdodCApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCV9nbC5yZW5kZXJidWZmZXJTdG9yYWdlKCBfZ2wuUkVOREVSQlVGRkVSLCBnbEludGVybmFsRm9ybWF0LCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQgKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJX2dsLmJpbmRSZW5kZXJidWZmZXIoIF9nbC5SRU5ERVJCVUZGRVIsIG51bGwgKTsKCgl9CgoJLy8gU2V0dXAgcmVzb3VyY2VzIGZvciBhIERlcHRoIFRleHR1cmUgZm9yIGEgRkJPIChuZWVkcyBhbiBleHRlbnNpb24pCglmdW5jdGlvbiBzZXR1cERlcHRoVGV4dHVyZSggZnJhbWVidWZmZXIsIHJlbmRlclRhcmdldCApIHsKCgkJY29uc3QgaXNDdWJlID0gKCByZW5kZXJUYXJnZXQgJiYgcmVuZGVyVGFyZ2V0LmlzV2ViR0xDdWJlUmVuZGVyVGFyZ2V0ICk7CgkJaWYgKCBpc0N1YmUgKSB0aHJvdyBuZXcgRXJyb3IoICdEZXB0aCBUZXh0dXJlIHdpdGggY3ViZSByZW5kZXIgdGFyZ2V0cyBpcyBub3Qgc3VwcG9ydGVkJyApOwoKCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZnJhbWVidWZmZXIgKTsKCgkJaWYgKCAhICggcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSAmJiByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLmlzRGVwdGhUZXh0dXJlICkgKSB7CgoJCQl0aHJvdyBuZXcgRXJyb3IoICdyZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlIG11c3QgYmUgYW4gaW5zdGFuY2Ugb2YgVEhSRUUuRGVwdGhUZXh0dXJlJyApOwoKCQl9CgoJCS8vIHVwbG9hZCBhbiBlbXB0eSBkZXB0aCB0ZXh0dXJlIHdpdGggZnJhbWVidWZmZXIgc2l6ZQoJCWlmICggISBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSApLl9fd2ViZ2xUZXh0dXJlIHx8CgkJCQlyZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLmltYWdlLndpZHRoICE9PSByZW5kZXJUYXJnZXQud2lkdGggfHwKCQkJCXJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUuaW1hZ2UuaGVpZ2h0ICE9PSByZW5kZXJUYXJnZXQuaGVpZ2h0ICkgewoKCQkJcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5pbWFnZS53aWR0aCA9IHJlbmRlclRhcmdldC53aWR0aDsKCQkJcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZS5pbWFnZS5oZWlnaHQgPSByZW5kZXJUYXJnZXQuaGVpZ2h0OwoJCQlyZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJfQoKCQlzZXRUZXh0dXJlMkQoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUsIDAgKTsKCgkJY29uc3Qgd2ViZ2xEZXB0aFRleHR1cmUgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSApLl9fd2ViZ2xUZXh0dXJlOwoJCWNvbnN0IHNhbXBsZXMgPSBnZXRSZW5kZXJUYXJnZXRTYW1wbGVzKCByZW5kZXJUYXJnZXQgKTsKCgkJaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLmZvcm1hdCA9PT0gRGVwdGhGb3JtYXQgKSB7CgoJCQlpZiAoIHVzZU11bHRpc2FtcGxlZFJUVCggcmVuZGVyVGFyZ2V0ICkgKSB7CgoJCQkJbXVsdGlzYW1wbGVkUlRURXh0LmZyYW1lYnVmZmVyVGV4dHVyZTJETXVsdGlzYW1wbGVFWFQoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkRFUFRIX0FUVEFDSE1FTlQsIF9nbC5URVhUVVJFXzJELCB3ZWJnbERlcHRoVGV4dHVyZSwgMCwgc2FtcGxlcyApOwoKCQkJfSBlbHNlIHsKCgkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkRFUFRIX0FUVEFDSE1FTlQsIF9nbC5URVhUVVJFXzJELCB3ZWJnbERlcHRoVGV4dHVyZSwgMCApOwoKCQkJfQoKCQl9IGVsc2UgaWYgKCByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlLmZvcm1hdCA9PT0gRGVwdGhTdGVuY2lsRm9ybWF0ICkgewoKCQkJaWYgKCB1c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApICkgewoKCQkJCW11bHRpc2FtcGxlZFJUVEV4dC5mcmFtZWJ1ZmZlclRleHR1cmUyRE11bHRpc2FtcGxlRVhUKCBfZ2wuRlJBTUVCVUZGRVIsIF9nbC5ERVBUSF9TVEVOQ0lMX0FUVEFDSE1FTlQsIF9nbC5URVhUVVJFXzJELCB3ZWJnbERlcHRoVGV4dHVyZSwgMCwgc2FtcGxlcyApOwoKCQkJfSBlbHNlIHsKCgkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkRFUFRIX1NURU5DSUxfQVRUQUNITUVOVCwgX2dsLlRFWFRVUkVfMkQsIHdlYmdsRGVwdGhUZXh0dXJlLCAwICk7CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQl0aHJvdyBuZXcgRXJyb3IoICdVbmtub3duIGRlcHRoVGV4dHVyZSBmb3JtYXQnICk7CgoJCX0KCgl9CgoJLy8gU2V0dXAgR0wgcmVzb3VyY2VzIGZvciBhIG5vbi10ZXh0dXJlIGRlcHRoIGJ1ZmZlcgoJZnVuY3Rpb24gc2V0dXBEZXB0aFJlbmRlcmJ1ZmZlciggcmVuZGVyVGFyZ2V0ICkgewoKCQljb25zdCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApOwoJCWNvbnN0IGlzQ3ViZSA9ICggcmVuZGVyVGFyZ2V0LmlzV2ViR0xDdWJlUmVuZGVyVGFyZ2V0ID09PSB0cnVlICk7CgoJCWlmICggcmVuZGVyVGFyZ2V0LmRlcHRoVGV4dHVyZSAmJiAhIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19hdXRvQWxsb2NhdGVEZXB0aEJ1ZmZlciApIHsKCgkJCWlmICggaXNDdWJlICkgdGhyb3cgbmV3IEVycm9yKCAndGFyZ2V0LmRlcHRoVGV4dHVyZSBub3Qgc3VwcG9ydGVkIGluIEN1YmUgcmVuZGVyIHRhcmdldHMnICk7CgoJCQlzZXR1cERlcHRoVGV4dHVyZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIsIHJlbmRlclRhcmdldCApOwoKCQl9IGVsc2UgewoKCQkJaWYgKCBpc0N1YmUgKSB7CgoJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhidWZmZXIgPSBbXTsKCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA2OyBpICsrICkgewoKCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXSApOwoJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyWyBpIF0gPSBfZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CgkJCQkJc2V0dXBSZW5kZXJCdWZmZXJTdG9yYWdlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlclsgaSBdLCByZW5kZXJUYXJnZXQsIGZhbHNlICk7CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgKTsKCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbERlcHRoYnVmZmVyID0gX2dsLmNyZWF0ZVJlbmRlcmJ1ZmZlcigpOwoJCQkJc2V0dXBSZW5kZXJCdWZmZXJTdG9yYWdlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aGJ1ZmZlciwgcmVuZGVyVGFyZ2V0LCBmYWxzZSApOwoKCQkJfQoKCQl9CgoJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBudWxsICk7CgoJfQoKCS8vIHJlYmluZCBmcmFtZWJ1ZmZlciB3aXRoIGV4dGVybmFsIHRleHR1cmVzCglmdW5jdGlvbiByZWJpbmRUZXh0dXJlcyggcmVuZGVyVGFyZ2V0LCBjb2xvclRleHR1cmUsIGRlcHRoVGV4dHVyZSApIHsKCgkJY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKCgkJaWYgKCBjb2xvclRleHR1cmUgIT09IHVuZGVmaW5lZCApIHsKCgkJCXNldHVwRnJhbWVCdWZmZXJUZXh0dXJlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciwgcmVuZGVyVGFyZ2V0LCByZW5kZXJUYXJnZXQudGV4dHVyZSwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBfZ2wuVEVYVFVSRV8yRCwgMCApOwoKCQl9CgoJCWlmICggZGVwdGhUZXh0dXJlICE9PSB1bmRlZmluZWQgKSB7CgoJCQlzZXR1cERlcHRoUmVuZGVyYnVmZmVyKCByZW5kZXJUYXJnZXQgKTsKCgkJfQoKCX0KCgkvLyBTZXQgdXAgR0wgcmVzb3VyY2VzIGZvciB0aGUgcmVuZGVyIHRhcmdldAoJZnVuY3Rpb24gc2V0dXBSZW5kZXJUYXJnZXQoIHJlbmRlclRhcmdldCApIHsKCgkJY29uc3QgdGV4dHVyZSA9IHJlbmRlclRhcmdldC50ZXh0dXJlOwoKCQljb25zdCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApOwoJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKTsKCgkJcmVuZGVyVGFyZ2V0LmFkZEV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25SZW5kZXJUYXJnZXREaXNwb3NlICk7CgoJCWlmICggcmVuZGVyVGFyZ2V0LmlzV2ViR0xNdWx0aXBsZVJlbmRlclRhcmdldHMgIT09IHRydWUgKSB7CgoJCQlpZiAoIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgPSBfZ2wuY3JlYXRlVGV4dHVyZSgpOwoKCQkJfQoKCQkJdGV4dHVyZVByb3BlcnRpZXMuX192ZXJzaW9uID0gdGV4dHVyZS52ZXJzaW9uOwoJCQlpbmZvLm1lbW9yeS50ZXh0dXJlcyArKzsKCgkJfQoKCQljb25zdCBpc0N1YmUgPSAoIHJlbmRlclRhcmdldC5pc1dlYkdMQ3ViZVJlbmRlclRhcmdldCA9PT0gdHJ1ZSApOwoJCWNvbnN0IGlzTXVsdGlwbGVSZW5kZXJUYXJnZXRzID0gKCByZW5kZXJUYXJnZXQuaXNXZWJHTE11bHRpcGxlUmVuZGVyVGFyZ2V0cyA9PT0gdHJ1ZSApOwoJCWNvbnN0IHN1cHBvcnRzTWlwcyA9IGlzUG93ZXJPZlR3byQxKCByZW5kZXJUYXJnZXQgKSB8fCBpc1dlYkdMMjsKCgkJLy8gU2V0dXAgZnJhbWVidWZmZXIKCgkJaWYgKCBpc0N1YmUgKSB7CgoJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciA9IFtdOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSArKyApIHsKCgkJCQlpZiAoIGlzV2ViR0wyICYmIHRleHR1cmUubWlwbWFwcyAmJiB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoID4gMCApIHsKCgkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXSA9IFtdOwoKCQkJCQlmb3IgKCBsZXQgbGV2ZWwgPSAwOyBsZXZlbCA8IHRleHR1cmUubWlwbWFwcy5sZW5ndGg7IGxldmVsICsrICkgewoKCQkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXVsgbGV2ZWwgXSA9IF9nbC5jcmVhdGVGcmFtZWJ1ZmZlcigpOwoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXSA9IF9nbC5jcmVhdGVGcmFtZWJ1ZmZlcigpOwoKCQkJCX0KCgkJCX0KCgkJfSBlbHNlIHsKCgkJCWlmICggaXNXZWJHTDIgJiYgdGV4dHVyZS5taXBtYXBzICYmIHRleHR1cmUubWlwbWFwcy5sZW5ndGggPiAwICkgewoKCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyID0gW107CgoJCQkJZm9yICggbGV0IGxldmVsID0gMDsgbGV2ZWwgPCB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoOyBsZXZlbCArKyApIHsKCgkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGxldmVsIF0gPSBfZ2wuY3JlYXRlRnJhbWVidWZmZXIoKTsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyID0gX2dsLmNyZWF0ZUZyYW1lYnVmZmVyKCk7CgoJCQl9CgoJCQlpZiAoIGlzTXVsdGlwbGVSZW5kZXJUYXJnZXRzICkgewoKCQkJCWlmICggY2FwYWJpbGl0aWVzLmRyYXdCdWZmZXJzICkgewoKCQkJCQljb25zdCB0ZXh0dXJlcyA9IHJlbmRlclRhcmdldC50ZXh0dXJlOwoKCQkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gdGV4dHVyZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCQljb25zdCBhdHRhY2htZW50UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlc1sgaSBdICk7CgoJCQkJCQlpZiAoIGF0dGFjaG1lbnRQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQkJYXR0YWNobWVudFByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUgPSBfZ2wuY3JlYXRlVGV4dHVyZSgpOwoKCQkJCQkJCWluZm8ubWVtb3J5LnRleHR1cmVzICsrOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogV2ViR0xNdWx0aXBsZVJlbmRlclRhcmdldHMgY2FuIG9ubHkgYmUgdXNlZCB3aXRoIFdlYkdMMiBvciBXRUJHTF9kcmF3X2J1ZmZlcnMgZXh0ZW5zaW9uLicgKTsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoICggaXNXZWJHTDIgJiYgcmVuZGVyVGFyZ2V0LnNhbXBsZXMgPiAwICkgJiYgdXNlTXVsdGlzYW1wbGVkUlRUKCByZW5kZXJUYXJnZXQgKSA9PT0gZmFsc2UgKSB7CgoJCQkJY29uc3QgdGV4dHVyZXMgPSBpc011bHRpcGxlUmVuZGVyVGFyZ2V0cyA/IHRleHR1cmUgOiBbIHRleHR1cmUgXTsKCgkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlciA9IF9nbC5jcmVhdGVGcmFtZWJ1ZmZlcigpOwoJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsQ29sb3JSZW5kZXJidWZmZXIgPSBbXTsKCgkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsTXVsdGlzYW1wbGVkRnJhbWVidWZmZXIgKTsKCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0ZXh0dXJlcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCWNvbnN0IHRleHR1cmUgPSB0ZXh0dXJlc1sgaSBdOwoJCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyWyBpIF0gPSBfZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CgoJCQkJCV9nbC5iaW5kUmVuZGVyYnVmZmVyKCBfZ2wuUkVOREVSQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlclsgaSBdICk7CgoJCQkJCWNvbnN0IGdsRm9ybWF0ID0gdXRpbHMuY29udmVydCggdGV4dHVyZS5mb3JtYXQsIHRleHR1cmUuY29sb3JTcGFjZSApOwoJCQkJCWNvbnN0IGdsVHlwZSA9IHV0aWxzLmNvbnZlcnQoIHRleHR1cmUudHlwZSApOwoJCQkJCWNvbnN0IGdsSW50ZXJuYWxGb3JtYXQgPSBnZXRJbnRlcm5hbEZvcm1hdCggdGV4dHVyZS5pbnRlcm5hbEZvcm1hdCwgZ2xGb3JtYXQsIGdsVHlwZSwgdGV4dHVyZS5jb2xvclNwYWNlLCByZW5kZXJUYXJnZXQuaXNYUlJlbmRlclRhcmdldCA9PT0gdHJ1ZSApOwoJCQkJCWNvbnN0IHNhbXBsZXMgPSBnZXRSZW5kZXJUYXJnZXRTYW1wbGVzKCByZW5kZXJUYXJnZXQgKTsKCQkJCQlfZ2wucmVuZGVyYnVmZmVyU3RvcmFnZU11bHRpc2FtcGxlKCBfZ2wuUkVOREVSQlVGRkVSLCBzYW1wbGVzLCBnbEludGVybmFsRm9ybWF0LCByZW5kZXJUYXJnZXQud2lkdGgsIHJlbmRlclRhcmdldC5oZWlnaHQgKTsKCgkJCQkJX2dsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCArIGksIF9nbC5SRU5ERVJCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbENvbG9yUmVuZGVyYnVmZmVyWyBpIF0gKTsKCgkJCQl9CgoJCQkJX2dsLmJpbmRSZW5kZXJidWZmZXIoIF9nbC5SRU5ERVJCVUZGRVIsIG51bGwgKTsKCgkJCQlpZiAoIHJlbmRlclRhcmdldC5kZXB0aEJ1ZmZlciApIHsKCgkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRGVwdGhSZW5kZXJidWZmZXIgPSBfZ2wuY3JlYXRlUmVuZGVyYnVmZmVyKCk7CgkJCQkJc2V0dXBSZW5kZXJCdWZmZXJTdG9yYWdlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xEZXB0aFJlbmRlcmJ1ZmZlciwgcmVuZGVyVGFyZ2V0LCB0cnVlICk7CgoJCQkJfQoKCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBudWxsICk7CgoJCQl9CgoJCX0KCgkJLy8gU2V0dXAgY29sb3IgYnVmZmVyCgoJCWlmICggaXNDdWJlICkgewoKCQkJc3RhdGUuYmluZFRleHR1cmUoIF9nbC5URVhUVVJFX0NVQkVfTUFQLCB0ZXh0dXJlUHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSApOwoJCQlzZXRUZXh0dXJlUGFyYW1ldGVycyggX2dsLlRFWFRVUkVfQ1VCRV9NQVAsIHRleHR1cmUsIHN1cHBvcnRzTWlwcyApOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgNjsgaSArKyApIHsKCgkJCQlpZiAoIGlzV2ViR0wyICYmIHRleHR1cmUubWlwbWFwcyAmJiB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoID4gMCApIHsKCgkJCQkJZm9yICggbGV0IGxldmVsID0gMDsgbGV2ZWwgPCB0ZXh0dXJlLm1pcG1hcHMubGVuZ3RoOyBsZXZlbCArKyApIHsKCgkJCQkJCXNldHVwRnJhbWVCdWZmZXJUZXh0dXJlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlclsgaSBdWyBsZXZlbCBdLCByZW5kZXJUYXJnZXQsIHRleHR1cmUsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCwgX2dsLlRFWFRVUkVfQ1VCRV9NQVBfUE9TSVRJVkVfWCArIGksIGxldmVsICk7CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQlzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXJbIGkgXSwgcmVuZGVyVGFyZ2V0LCB0ZXh0dXJlLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIF9nbC5URVhUVVJFX0NVQkVfTUFQX1BPU0lUSVZFX1ggKyBpLCAwICk7CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCB0ZXh0dXJlTmVlZHNHZW5lcmF0ZU1pcG1hcHMoIHRleHR1cmUsIHN1cHBvcnRzTWlwcyApICkgewoKCQkJCWdlbmVyYXRlTWlwbWFwKCBfZ2wuVEVYVFVSRV9DVUJFX01BUCApOwoKCQkJfQoKCQkJc3RhdGUudW5iaW5kVGV4dHVyZSgpOwoKCQl9IGVsc2UgaWYgKCBpc011bHRpcGxlUmVuZGVyVGFyZ2V0cyApIHsKCgkJCWNvbnN0IHRleHR1cmVzID0gcmVuZGVyVGFyZ2V0LnRleHR1cmU7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gdGV4dHVyZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJY29uc3QgYXR0YWNobWVudCA9IHRleHR1cmVzWyBpIF07CgkJCQljb25zdCBhdHRhY2htZW50UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBhdHRhY2htZW50ICk7CgoJCQkJc3RhdGUuYmluZFRleHR1cmUoIF9nbC5URVhUVVJFXzJELCBhdHRhY2htZW50UHJvcGVydGllcy5fX3dlYmdsVGV4dHVyZSApOwoJCQkJc2V0VGV4dHVyZVBhcmFtZXRlcnMoIF9nbC5URVhUVVJFXzJELCBhdHRhY2htZW50LCBzdXBwb3J0c01pcHMgKTsKCQkJCXNldHVwRnJhbWVCdWZmZXJUZXh0dXJlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciwgcmVuZGVyVGFyZ2V0LCBhdHRhY2htZW50LCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyBpLCBfZ2wuVEVYVFVSRV8yRCwgMCApOwoKCQkJCWlmICggdGV4dHVyZU5lZWRzR2VuZXJhdGVNaXBtYXBzKCBhdHRhY2htZW50LCBzdXBwb3J0c01pcHMgKSApIHsKCgkJCQkJZ2VuZXJhdGVNaXBtYXAoIF9nbC5URVhUVVJFXzJEICk7CgoJCQkJfQoKCQkJfQoKCQkJc3RhdGUudW5iaW5kVGV4dHVyZSgpOwoKCQl9IGVsc2UgewoKCQkJbGV0IGdsVGV4dHVyZVR5cGUgPSBfZ2wuVEVYVFVSRV8yRDsKCgkJCWlmICggcmVuZGVyVGFyZ2V0LmlzV2ViR0wzRFJlbmRlclRhcmdldCB8fCByZW5kZXJUYXJnZXQuaXNXZWJHTEFycmF5UmVuZGVyVGFyZ2V0ICkgewoKCQkJCWlmICggaXNXZWJHTDIgKSB7CgoJCQkJCWdsVGV4dHVyZVR5cGUgPSByZW5kZXJUYXJnZXQuaXNXZWJHTDNEUmVuZGVyVGFyZ2V0ID8gX2dsLlRFWFRVUkVfM0QgOiBfZ2wuVEVYVFVSRV8yRF9BUlJBWTsKCgkJCQl9IGVsc2UgewoKCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xUZXh0dXJlczogVEhSRUUuRGF0YTNEVGV4dHVyZSBhbmQgVEhSRUUuRGF0YUFycmF5VGV4dHVyZSBvbmx5IHN1cHBvcnRlZCB3aXRoIFdlYkdMMi4nICk7CgoJCQkJfQoKCQkJfQoKCQkJc3RhdGUuYmluZFRleHR1cmUoIGdsVGV4dHVyZVR5cGUsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlICk7CgkJCXNldFRleHR1cmVQYXJhbWV0ZXJzKCBnbFRleHR1cmVUeXBlLCB0ZXh0dXJlLCBzdXBwb3J0c01pcHMgKTsKCgkJCWlmICggaXNXZWJHTDIgJiYgdGV4dHVyZS5taXBtYXBzICYmIHRleHR1cmUubWlwbWFwcy5sZW5ndGggPiAwICkgewoKCQkJCWZvciAoIGxldCBsZXZlbCA9IDA7IGxldmVsIDwgdGV4dHVyZS5taXBtYXBzLmxlbmd0aDsgbGV2ZWwgKysgKSB7CgoJCQkJCXNldHVwRnJhbWVCdWZmZXJUZXh0dXJlKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlclsgbGV2ZWwgXSwgcmVuZGVyVGFyZ2V0LCB0ZXh0dXJlLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAsIGdsVGV4dHVyZVR5cGUsIGxldmVsICk7CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQlzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZSggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIsIHJlbmRlclRhcmdldCwgdGV4dHVyZSwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBnbFRleHR1cmVUeXBlLCAwICk7CgoJCQl9CgoJCQlpZiAoIHRleHR1cmVOZWVkc0dlbmVyYXRlTWlwbWFwcyggdGV4dHVyZSwgc3VwcG9ydHNNaXBzICkgKSB7CgoJCQkJZ2VuZXJhdGVNaXBtYXAoIGdsVGV4dHVyZVR5cGUgKTsKCgkJCX0KCgkJCXN0YXRlLnVuYmluZFRleHR1cmUoKTsKCgkJfQoKCQkvLyBTZXR1cCBkZXB0aCBhbmQgc3RlbmNpbCBidWZmZXJzCgoJCWlmICggcmVuZGVyVGFyZ2V0LmRlcHRoQnVmZmVyICkgewoKCQkJc2V0dXBEZXB0aFJlbmRlcmJ1ZmZlciggcmVuZGVyVGFyZ2V0ICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gdXBkYXRlUmVuZGVyVGFyZ2V0TWlwbWFwKCByZW5kZXJUYXJnZXQgKSB7CgoJCWNvbnN0IHN1cHBvcnRzTWlwcyA9IGlzUG93ZXJPZlR3byQxKCByZW5kZXJUYXJnZXQgKSB8fCBpc1dlYkdMMjsKCgkJY29uc3QgdGV4dHVyZXMgPSByZW5kZXJUYXJnZXQuaXNXZWJHTE11bHRpcGxlUmVuZGVyVGFyZ2V0cyA9PT0gdHJ1ZSA/IHJlbmRlclRhcmdldC50ZXh0dXJlIDogWyByZW5kZXJUYXJnZXQudGV4dHVyZSBdOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gdGV4dHVyZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQljb25zdCB0ZXh0dXJlID0gdGV4dHVyZXNbIGkgXTsKCgkJCWlmICggdGV4dHVyZU5lZWRzR2VuZXJhdGVNaXBtYXBzKCB0ZXh0dXJlLCBzdXBwb3J0c01pcHMgKSApIHsKCgkJCQljb25zdCB0YXJnZXQgPSByZW5kZXJUYXJnZXQuaXNXZWJHTEN1YmVSZW5kZXJUYXJnZXQgPyBfZ2wuVEVYVFVSRV9DVUJFX01BUCA6IF9nbC5URVhUVVJFXzJEOwoJCQkJY29uc3Qgd2ViZ2xUZXh0dXJlID0gcHJvcGVydGllcy5nZXQoIHRleHR1cmUgKS5fX3dlYmdsVGV4dHVyZTsKCgkJCQlzdGF0ZS5iaW5kVGV4dHVyZSggdGFyZ2V0LCB3ZWJnbFRleHR1cmUgKTsKCQkJCWdlbmVyYXRlTWlwbWFwKCB0YXJnZXQgKTsKCQkJCXN0YXRlLnVuYmluZFRleHR1cmUoKTsKCgkJCX0KCgkJfQoKCX0KCglmdW5jdGlvbiB1cGRhdGVNdWx0aXNhbXBsZVJlbmRlclRhcmdldCggcmVuZGVyVGFyZ2V0ICkgewoKCQlpZiAoICggaXNXZWJHTDIgJiYgcmVuZGVyVGFyZ2V0LnNhbXBsZXMgPiAwICkgJiYgdXNlTXVsdGlzYW1wbGVkUlRUKCByZW5kZXJUYXJnZXQgKSA9PT0gZmFsc2UgKSB7CgoJCQljb25zdCB0ZXh0dXJlcyA9IHJlbmRlclRhcmdldC5pc1dlYkdMTXVsdGlwbGVSZW5kZXJUYXJnZXRzID8gcmVuZGVyVGFyZ2V0LnRleHR1cmUgOiBbIHJlbmRlclRhcmdldC50ZXh0dXJlIF07CgkJCWNvbnN0IHdpZHRoID0gcmVuZGVyVGFyZ2V0LndpZHRoOwoJCQljb25zdCBoZWlnaHQgPSByZW5kZXJUYXJnZXQuaGVpZ2h0OwoJCQlsZXQgbWFzayA9IF9nbC5DT0xPUl9CVUZGRVJfQklUOwoJCQljb25zdCBpbnZhbGlkYXRpb25BcnJheSA9IFtdOwoJCQljb25zdCBkZXB0aFN0eWxlID0gcmVuZGVyVGFyZ2V0LnN0ZW5jaWxCdWZmZXIgPyBfZ2wuREVQVEhfU1RFTkNJTF9BVFRBQ0hNRU5UIDogX2dsLkRFUFRIX0FUVEFDSE1FTlQ7CgkJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICk7CgkJCWNvbnN0IGlzTXVsdGlwbGVSZW5kZXJUYXJnZXRzID0gKCByZW5kZXJUYXJnZXQuaXNXZWJHTE11bHRpcGxlUmVuZGVyVGFyZ2V0cyA9PT0gdHJ1ZSApOwoKCQkJLy8gSWYgTVJUIHdlIG5lZWQgdG8gcmVtb3ZlIEZCTyBhdHRhY2htZW50cwoJCQlpZiAoIGlzTXVsdGlwbGVSZW5kZXJUYXJnZXRzICkgewoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHRleHR1cmVzLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbE11bHRpc2FtcGxlZEZyYW1lYnVmZmVyICk7CgkJCQkJX2dsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCArIGksIF9nbC5SRU5ERVJCVUZGRVIsIG51bGwgKTsKCgkJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyICk7CgkJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZTJEKCBfZ2wuRFJBV19GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwICsgaSwgX2dsLlRFWFRVUkVfMkQsIG51bGwsIDAgKTsKCgkJCQl9CgoJCQl9CgoJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5SRUFEX0ZSQU1FQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlciApOwoJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciApOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGV4dHVyZXMubGVuZ3RoOyBpICsrICkgewoKCQkJCWludmFsaWRhdGlvbkFycmF5LnB1c2goIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCArIGkgKTsKCgkJCQlpZiAoIHJlbmRlclRhcmdldC5kZXB0aEJ1ZmZlciApIHsKCgkJCQkJaW52YWxpZGF0aW9uQXJyYXkucHVzaCggZGVwdGhTdHlsZSApOwoKCQkJCX0KCgkJCQljb25zdCBpZ25vcmVEZXB0aFZhbHVlcyA9ICggcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2lnbm9yZURlcHRoVmFsdWVzICE9PSB1bmRlZmluZWQgKSA/IHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19pZ25vcmVEZXB0aFZhbHVlcyA6IGZhbHNlOwoKCQkJCWlmICggaWdub3JlRGVwdGhWYWx1ZXMgPT09IGZhbHNlICkgewoKCQkJCQlpZiAoIHJlbmRlclRhcmdldC5kZXB0aEJ1ZmZlciApIG1hc2sgfD0gX2dsLkRFUFRIX0JVRkZFUl9CSVQ7CgkJCQkJaWYgKCByZW5kZXJUYXJnZXQuc3RlbmNpbEJ1ZmZlciApIG1hc2sgfD0gX2dsLlNURU5DSUxfQlVGRkVSX0JJVDsKCgkJCQl9CgoJCQkJaWYgKCBpc011bHRpcGxlUmVuZGVyVGFyZ2V0cyApIHsKCgkJCQkJX2dsLmZyYW1lYnVmZmVyUmVuZGVyYnVmZmVyKCBfZ2wuUkVBRF9GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBfZ2wuUkVOREVSQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlclsgaSBdICk7CgoJCQkJfQoKCQkJCWlmICggaWdub3JlRGVwdGhWYWx1ZXMgPT09IHRydWUgKSB7CgoJCQkJCV9nbC5pbnZhbGlkYXRlRnJhbWVidWZmZXIoIF9nbC5SRUFEX0ZSQU1FQlVGRkVSLCBbIGRlcHRoU3R5bGUgXSApOwoJCQkJCV9nbC5pbnZhbGlkYXRlRnJhbWVidWZmZXIoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCBbIGRlcHRoU3R5bGUgXSApOwoKCQkJCX0KCgkJCQlpZiAoIGlzTXVsdGlwbGVSZW5kZXJUYXJnZXRzICkgewoKCQkJCQljb25zdCB3ZWJnbFRleHR1cmUgPSBwcm9wZXJ0aWVzLmdldCggdGV4dHVyZXNbIGkgXSApLl9fd2ViZ2xUZXh0dXJlOwoJCQkJCV9nbC5mcmFtZWJ1ZmZlclRleHR1cmUyRCggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCwgX2dsLlRFWFRVUkVfMkQsIHdlYmdsVGV4dHVyZSwgMCApOwoKCQkJCX0KCgkJCQlfZ2wuYmxpdEZyYW1lYnVmZmVyKCAwLCAwLCB3aWR0aCwgaGVpZ2h0LCAwLCAwLCB3aWR0aCwgaGVpZ2h0LCBtYXNrLCBfZ2wuTkVBUkVTVCApOwoKCQkJCWlmICggc3VwcG9ydHNJbnZhbGlkYXRlRnJhbWVidWZmZXIgKSB7CgoJCQkJCV9nbC5pbnZhbGlkYXRlRnJhbWVidWZmZXIoIF9nbC5SRUFEX0ZSQU1FQlVGRkVSLCBpbnZhbGlkYXRpb25BcnJheSApOwoKCQkJCX0KCgoJCQl9CgoJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5SRUFEX0ZSQU1FQlVGRkVSLCBudWxsICk7CgkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIG51bGwgKTsKCgkJCS8vIElmIE1SVCBzaW5jZSBwcmUtYmxpdCB3ZSByZW1vdmVkIHRoZSBGQk8gd2UgbmVlZCB0byByZWNvbnN0cnVjdCB0aGUgYXR0YWNobWVudHMKCQkJaWYgKCBpc011bHRpcGxlUmVuZGVyVGFyZ2V0cyApIHsKCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0ZXh0dXJlcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlciApOwoJCQkJCV9nbC5mcmFtZWJ1ZmZlclJlbmRlcmJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCBfZ2wuQ09MT1JfQVRUQUNITUVOVDAgKyBpLCBfZ2wuUkVOREVSQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xDb2xvclJlbmRlcmJ1ZmZlclsgaSBdICk7CgoJCQkJCWNvbnN0IHdlYmdsVGV4dHVyZSA9IHByb3BlcnRpZXMuZ2V0KCB0ZXh0dXJlc1sgaSBdICkuX193ZWJnbFRleHR1cmU7CgoJCQkJCXN0YXRlLmJpbmRGcmFtZWJ1ZmZlciggX2dsLkZSQU1FQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xGcmFtZWJ1ZmZlciApOwoJCQkJCV9nbC5mcmFtZWJ1ZmZlclRleHR1cmUyRCggX2dsLkRSQVdfRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCArIGksIF9nbC5URVhUVVJFXzJELCB3ZWJnbFRleHR1cmUsIDAgKTsKCgkJCQl9CgoJCQl9CgoJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5EUkFXX0ZSQU1FQlVGRkVSLCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlciApOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIGdldFJlbmRlclRhcmdldFNhbXBsZXMoIHJlbmRlclRhcmdldCApIHsKCgkJcmV0dXJuIE1hdGgubWluKCBtYXhTYW1wbGVzLCByZW5kZXJUYXJnZXQuc2FtcGxlcyApOwoKCX0KCglmdW5jdGlvbiB1c2VNdWx0aXNhbXBsZWRSVFQoIHJlbmRlclRhcmdldCApIHsKCgkJY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKCgkJcmV0dXJuIGlzV2ViR0wyICYmIHJlbmRlclRhcmdldC5zYW1wbGVzID4gMCAmJiBleHRlbnNpb25zLmhhcyggJ1dFQkdMX211bHRpc2FtcGxlZF9yZW5kZXJfdG9fdGV4dHVyZScgKSA9PT0gdHJ1ZSAmJiByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fdXNlUmVuZGVyVG9UZXh0dXJlICE9PSBmYWxzZTsKCgl9CgoJZnVuY3Rpb24gdXBkYXRlVmlkZW9UZXh0dXJlKCB0ZXh0dXJlICkgewoKCQljb25zdCBmcmFtZSA9IGluZm8ucmVuZGVyLmZyYW1lOwoKCQkvLyBDaGVjayB0aGUgbGFzdCBmcmFtZSB3ZSB1cGRhdGVkIHRoZSBWaWRlb1RleHR1cmUKCgkJaWYgKCBfdmlkZW9UZXh0dXJlcy5nZXQoIHRleHR1cmUgKSAhPT0gZnJhbWUgKSB7CgoJCQlfdmlkZW9UZXh0dXJlcy5zZXQoIHRleHR1cmUsIGZyYW1lICk7CgkJCXRleHR1cmUudXBkYXRlKCk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gdmVyaWZ5Q29sb3JTcGFjZSggdGV4dHVyZSwgaW1hZ2UgKSB7CgoJCWNvbnN0IGNvbG9yU3BhY2UgPSB0ZXh0dXJlLmNvbG9yU3BhY2U7CgkJY29uc3QgZm9ybWF0ID0gdGV4dHVyZS5mb3JtYXQ7CgkJY29uc3QgdHlwZSA9IHRleHR1cmUudHlwZTsKCgkJaWYgKCB0ZXh0dXJlLmlzQ29tcHJlc3NlZFRleHR1cmUgPT09IHRydWUgfHwgdGV4dHVyZS5pc1ZpZGVvVGV4dHVyZSA9PT0gdHJ1ZSB8fCB0ZXh0dXJlLmZvcm1hdCA9PT0gX1NSR0JBRm9ybWF0ICkgcmV0dXJuIGltYWdlOwoKCQlpZiAoIGNvbG9yU3BhY2UgIT09IExpbmVhclNSR0JDb2xvclNwYWNlICYmIGNvbG9yU3BhY2UgIT09IE5vQ29sb3JTcGFjZSApIHsKCgkJCS8vIHNSR0IKCgkJCWlmICggQ29sb3JNYW5hZ2VtZW50LmdldFRyYW5zZmVyKCBjb2xvclNwYWNlICkgPT09IFNSR0JUcmFuc2ZlciApIHsKCgkJCQlpZiAoIGlzV2ViR0wyID09PSBmYWxzZSApIHsKCgkJCQkJLy8gaW4gV2ViR0wgMSwgdHJ5IHRvIHVzZSBFWFRfc1JHQiBleHRlbnNpb24gYW5kIHVuc2l6ZWQgZm9ybWF0cwoKCQkJCQlpZiAoIGV4dGVuc2lvbnMuaGFzKCAnRVhUX3NSR0InICkgPT09IHRydWUgJiYgZm9ybWF0ID09PSBSR0JBRm9ybWF0ICkgewoKCQkJCQkJdGV4dHVyZS5mb3JtYXQgPSBfU1JHQkFGb3JtYXQ7CgoJCQkJCQkvLyBpdCdzIG5vdCBwb3NzaWJsZSB0byBnZW5lcmF0ZSBtaXBzIGluIFdlYkdMIDEgd2l0aCB0aGlzIGV4dGVuc2lvbgoKCQkJCQkJdGV4dHVyZS5taW5GaWx0ZXIgPSBMaW5lYXJGaWx0ZXI7CgkJCQkJCXRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQkvLyBzbG93IGZhbGxiYWNrIChDUFUgZGVjb2RlKQoKCQkJCQkJaW1hZ2UgPSBJbWFnZVV0aWxzLnNSR0JUb0xpbmVhciggaW1hZ2UgKTsKCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCS8vIGluIFdlYkdMIDIgdW5jb21wcmVzc2VkIHRleHR1cmVzIGNhbiBvbmx5IGJlIHNSR0IgZW5jb2RlZCBpZiB0aGV5IGhhdmUgdGhlIFJHQkE4IGZvcm1hdAoKCQkJCQlpZiAoIGZvcm1hdCAhPT0gUkdCQUZvcm1hdCB8fCB0eXBlICE9PSBVbnNpZ25lZEJ5dGVUeXBlICkgewoKCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xUZXh0dXJlczogc1JHQiBlbmNvZGVkIHRleHR1cmVzIGhhdmUgdG8gdXNlIFJHQkFGb3JtYXQgYW5kIFVuc2lnbmVkQnl0ZVR5cGUuJyApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xUZXh0dXJlczogVW5zdXBwb3J0ZWQgdGV4dHVyZSBjb2xvciBzcGFjZTonLCBjb2xvclNwYWNlICk7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIGltYWdlOwoKCX0KCgkvLwoKCXRoaXMuYWxsb2NhdGVUZXh0dXJlVW5pdCA9IGFsbG9jYXRlVGV4dHVyZVVuaXQ7Cgl0aGlzLnJlc2V0VGV4dHVyZVVuaXRzID0gcmVzZXRUZXh0dXJlVW5pdHM7CgoJdGhpcy5zZXRUZXh0dXJlMkQgPSBzZXRUZXh0dXJlMkQ7Cgl0aGlzLnNldFRleHR1cmUyREFycmF5ID0gc2V0VGV4dHVyZTJEQXJyYXk7Cgl0aGlzLnNldFRleHR1cmUzRCA9IHNldFRleHR1cmUzRDsKCXRoaXMuc2V0VGV4dHVyZUN1YmUgPSBzZXRUZXh0dXJlQ3ViZTsKCXRoaXMucmViaW5kVGV4dHVyZXMgPSByZWJpbmRUZXh0dXJlczsKCXRoaXMuc2V0dXBSZW5kZXJUYXJnZXQgPSBzZXR1cFJlbmRlclRhcmdldDsKCXRoaXMudXBkYXRlUmVuZGVyVGFyZ2V0TWlwbWFwID0gdXBkYXRlUmVuZGVyVGFyZ2V0TWlwbWFwOwoJdGhpcy51cGRhdGVNdWx0aXNhbXBsZVJlbmRlclRhcmdldCA9IHVwZGF0ZU11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0OwoJdGhpcy5zZXR1cERlcHRoUmVuZGVyYnVmZmVyID0gc2V0dXBEZXB0aFJlbmRlcmJ1ZmZlcjsKCXRoaXMuc2V0dXBGcmFtZUJ1ZmZlclRleHR1cmUgPSBzZXR1cEZyYW1lQnVmZmVyVGV4dHVyZTsKCXRoaXMudXNlTXVsdGlzYW1wbGVkUlRUID0gdXNlTXVsdGlzYW1wbGVkUlRUOwoKfQoKZnVuY3Rpb24gV2ViR0xVdGlscyggZ2wsIGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcyApIHsKCgljb25zdCBpc1dlYkdMMiA9IGNhcGFiaWxpdGllcy5pc1dlYkdMMjsKCglmdW5jdGlvbiBjb252ZXJ0KCBwLCBjb2xvclNwYWNlID0gTm9Db2xvclNwYWNlICkgewoKCQlsZXQgZXh0ZW5zaW9uOwoKCQljb25zdCB0cmFuc2ZlciA9IENvbG9yTWFuYWdlbWVudC5nZXRUcmFuc2ZlciggY29sb3JTcGFjZSApOwoKCQlpZiAoIHAgPT09IFVuc2lnbmVkQnl0ZVR5cGUgKSByZXR1cm4gZ2wuVU5TSUdORURfQllURTsKCQlpZiAoIHAgPT09IFVuc2lnbmVkU2hvcnQ0NDQ0VHlwZSApIHJldHVybiBnbC5VTlNJR05FRF9TSE9SVF80XzRfNF80OwoJCWlmICggcCA9PT0gVW5zaWduZWRTaG9ydDU1NTFUeXBlICkgcmV0dXJuIGdsLlVOU0lHTkVEX1NIT1JUXzVfNV81XzE7CgoJCWlmICggcCA9PT0gQnl0ZVR5cGUgKSByZXR1cm4gZ2wuQllURTsKCQlpZiAoIHAgPT09IFNob3J0VHlwZSApIHJldHVybiBnbC5TSE9SVDsKCQlpZiAoIHAgPT09IFVuc2lnbmVkU2hvcnRUeXBlICkgcmV0dXJuIGdsLlVOU0lHTkVEX1NIT1JUOwoJCWlmICggcCA9PT0gSW50VHlwZSApIHJldHVybiBnbC5JTlQ7CgkJaWYgKCBwID09PSBVbnNpZ25lZEludFR5cGUgKSByZXR1cm4gZ2wuVU5TSUdORURfSU5UOwoJCWlmICggcCA9PT0gRmxvYXRUeXBlICkgcmV0dXJuIGdsLkZMT0FUOwoKCQlpZiAoIHAgPT09IEhhbGZGbG9hdFR5cGUgKSB7CgoJCQlpZiAoIGlzV2ViR0wyICkgcmV0dXJuIGdsLkhBTEZfRkxPQVQ7CgoJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ09FU190ZXh0dXJlX2hhbGZfZmxvYXQnICk7CgoJCQlpZiAoIGV4dGVuc2lvbiAhPT0gbnVsbCApIHsKCgkJCQlyZXR1cm4gZXh0ZW5zaW9uLkhBTEZfRkxPQVRfT0VTOwoKCQkJfSBlbHNlIHsKCgkJCQlyZXR1cm4gbnVsbDsKCgkJCX0KCgkJfQoKCQlpZiAoIHAgPT09IEFscGhhRm9ybWF0ICkgcmV0dXJuIGdsLkFMUEhBOwoJCWlmICggcCA9PT0gUkdCQUZvcm1hdCApIHJldHVybiBnbC5SR0JBOwoJCWlmICggcCA9PT0gTHVtaW5hbmNlRm9ybWF0ICkgcmV0dXJuIGdsLkxVTUlOQU5DRTsKCQlpZiAoIHAgPT09IEx1bWluYW5jZUFscGhhRm9ybWF0ICkgcmV0dXJuIGdsLkxVTUlOQU5DRV9BTFBIQTsKCQlpZiAoIHAgPT09IERlcHRoRm9ybWF0ICkgcmV0dXJuIGdsLkRFUFRIX0NPTVBPTkVOVDsKCQlpZiAoIHAgPT09IERlcHRoU3RlbmNpbEZvcm1hdCApIHJldHVybiBnbC5ERVBUSF9TVEVOQ0lMOwoKCQkvLyBXZWJHTCAxIHNSR0IgZmFsbGJhY2sKCgkJaWYgKCBwID09PSBfU1JHQkFGb3JtYXQgKSB7CgoJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ0VYVF9zUkdCJyApOwoKCQkJaWYgKCBleHRlbnNpb24gIT09IG51bGwgKSB7CgoJCQkJcmV0dXJuIGV4dGVuc2lvbi5TUkdCX0FMUEhBX0VYVDsKCgkJCX0gZWxzZSB7CgoJCQkJcmV0dXJuIG51bGw7CgoJCQl9CgoJCX0KCgkJLy8gV2ViR0wyIGZvcm1hdHMuCgoJCWlmICggcCA9PT0gUmVkRm9ybWF0ICkgcmV0dXJuIGdsLlJFRDsKCQlpZiAoIHAgPT09IFJlZEludGVnZXJGb3JtYXQgKSByZXR1cm4gZ2wuUkVEX0lOVEVHRVI7CgkJaWYgKCBwID09PSBSR0Zvcm1hdCApIHJldHVybiBnbC5SRzsKCQlpZiAoIHAgPT09IFJHSW50ZWdlckZvcm1hdCApIHJldHVybiBnbC5SR19JTlRFR0VSOwoJCWlmICggcCA9PT0gUkdCQUludGVnZXJGb3JtYXQgKSByZXR1cm4gZ2wuUkdCQV9JTlRFR0VSOwoKCQkvLyBTM1RDCgoJCWlmICggcCA9PT0gUkdCX1MzVENfRFhUMV9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9TM1RDX0RYVDFfRm9ybWF0IHx8IHAgPT09IFJHQkFfUzNUQ19EWFQzX0Zvcm1hdCB8fCBwID09PSBSR0JBX1MzVENfRFhUNV9Gb3JtYXQgKSB7CgoJCQlpZiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSB7CgoJCQkJZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfczN0Y19zcmdiJyApOwoKCQkJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgewoKCQkJCQlpZiAoIHAgPT09IFJHQl9TM1RDX0RYVDFfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0JfUzNUQ19EWFQxX0VYVDsKCQkJCQlpZiAoIHAgPT09IFJHQkFfUzNUQ19EWFQxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCX0FMUEhBX1MzVENfRFhUMV9FWFQ7CgkJCQkJaWYgKCBwID09PSBSR0JBX1MzVENfRFhUM19Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQl9BTFBIQV9TM1RDX0RYVDNfRVhUOwoJCQkJCWlmICggcCA9PT0gUkdCQV9TM1RDX0RYVDVfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0JfQUxQSEFfUzNUQ19EWFQ1X0VYVDsKCgkJCQl9IGVsc2UgewoKCQkJCQlyZXR1cm4gbnVsbDsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3MzdGMnICk7CgoJCQkJaWYgKCBleHRlbnNpb24gIT09IG51bGwgKSB7CgoJCQkJCWlmICggcCA9PT0gUkdCX1MzVENfRFhUMV9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCX1MzVENfRFhUMV9FWFQ7CgkJCQkJaWYgKCBwID09PSBSR0JBX1MzVENfRFhUMV9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9TM1RDX0RYVDFfRVhUOwoJCQkJCWlmICggcCA9PT0gUkdCQV9TM1RDX0RYVDNfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfUzNUQ19EWFQzX0VYVDsKCQkJCQlpZiAoIHAgPT09IFJHQkFfUzNUQ19EWFQ1X0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX1MzVENfRFhUNV9FWFQ7CgoJCQkJfSBlbHNlIHsKCgkJCQkJcmV0dXJuIG51bGw7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCS8vIFBWUlRDCgoJCWlmICggcCA9PT0gUkdCX1BWUlRDXzRCUFBWMV9Gb3JtYXQgfHwgcCA9PT0gUkdCX1BWUlRDXzJCUFBWMV9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9QVlJUQ180QlBQVjFfRm9ybWF0IHx8IHAgPT09IFJHQkFfUFZSVENfMkJQUFYxX0Zvcm1hdCApIHsKCgkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfY29tcHJlc3NlZF90ZXh0dXJlX3B2cnRjJyApOwoKCQkJaWYgKCBleHRlbnNpb24gIT09IG51bGwgKSB7CgoJCQkJaWYgKCBwID09PSBSR0JfUFZSVENfNEJQUFYxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JfUFZSVENfNEJQUFYxX0lNRzsKCQkJCWlmICggcCA9PT0gUkdCX1BWUlRDXzJCUFBWMV9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCX1BWUlRDXzJCUFBWMV9JTUc7CgkJCQlpZiAoIHAgPT09IFJHQkFfUFZSVENfNEJQUFYxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX1BWUlRDXzRCUFBWMV9JTUc7CgkJCQlpZiAoIHAgPT09IFJHQkFfUFZSVENfMkJQUFYxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX1BWUlRDXzJCUFBWMV9JTUc7CgoJCQl9IGVsc2UgewoKCQkJCXJldHVybiBudWxsOwoKCQkJfQoKCQl9CgoJCS8vIEVUQzEKCgkJaWYgKCBwID09PSBSR0JfRVRDMV9Gb3JtYXQgKSB7CgoJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9ldGMxJyApOwoKCQkJaWYgKCBleHRlbnNpb24gIT09IG51bGwgKSB7CgoJCQkJcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQl9FVEMxX1dFQkdMOwoKCQkJfSBlbHNlIHsKCgkJCQlyZXR1cm4gbnVsbDsKCgkJCX0KCgkJfQoKCQkvLyBFVEMyCgoJCWlmICggcCA9PT0gUkdCX0VUQzJfRm9ybWF0IHx8IHAgPT09IFJHQkFfRVRDMl9FQUNfRm9ybWF0ICkgewoKCQkJZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9jb21wcmVzc2VkX3RleHR1cmVfZXRjJyApOwoKCQkJaWYgKCBleHRlbnNpb24gIT09IG51bGwgKSB7CgoJCQkJaWYgKCBwID09PSBSR0JfRVRDMl9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9FVEMyIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCOF9FVEMyOwoJCQkJaWYgKCBwID09PSBSR0JBX0VUQzJfRUFDX0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9FVEMyX0VBQyA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkE4X0VUQzJfRUFDOwoKCQkJfSBlbHNlIHsKCgkJCQlyZXR1cm4gbnVsbDsKCgkJCX0KCgkJfQoKCQkvLyBBU1RDCgoJCWlmICggcCA9PT0gUkdCQV9BU1RDXzR4NF9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzV4NF9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzV4NV9Gb3JtYXQgfHwKCQkJcCA9PT0gUkdCQV9BU1RDXzZ4NV9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzZ4Nl9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzh4NV9Gb3JtYXQgfHwKCQkJcCA9PT0gUkdCQV9BU1RDXzh4Nl9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzh4OF9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzEweDVfRm9ybWF0IHx8CgkJCXAgPT09IFJHQkFfQVNUQ18xMHg2X0Zvcm1hdCB8fCBwID09PSBSR0JBX0FTVENfMTB4OF9Gb3JtYXQgfHwgcCA9PT0gUkdCQV9BU1RDXzEweDEwX0Zvcm1hdCB8fAoJCQlwID09PSBSR0JBX0FTVENfMTJ4MTBfRm9ybWF0IHx8IHAgPT09IFJHQkFfQVNUQ18xMngxMl9Gb3JtYXQgKSB7CgoJCQlleHRlbnNpb24gPSBleHRlbnNpb25zLmdldCggJ1dFQkdMX2NvbXByZXNzZWRfdGV4dHVyZV9hc3RjJyApOwoKCQkJaWYgKCBleHRlbnNpb24gIT09IG51bGwgKSB7CgoJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfNHg0X0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzR4NF9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfNHg0X0tIUjsKCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzV4NF9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ181eDRfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzV4NF9LSFI7CgkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ181eDVfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfNXg1X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ181eDVfS0hSOwoJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfNng1X0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzZ4NV9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfNng1X0tIUjsKCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzZ4Nl9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ182eDZfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzZ4Nl9LSFI7CgkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ184eDVfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfOHg1X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ184eDVfS0hSOwoJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfOHg2X0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzh4Nl9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfOHg2X0tIUjsKCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzh4OF9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ184eDhfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzh4OF9LSFI7CgkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ18xMHg1X0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzEweDVfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzEweDVfS0hSOwoJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfMTB4Nl9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ18xMHg2X0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ18xMHg2X0tIUjsKCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzEweDhfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfMTB4OF9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfMTB4OF9LSFI7CgkJCQlpZiAoIHAgPT09IFJHQkFfQVNUQ18xMHgxMF9Gb3JtYXQgKSByZXR1cm4gKCB0cmFuc2ZlciA9PT0gU1JHQlRyYW5zZmVyICkgPyBleHRlbnNpb24uQ09NUFJFU1NFRF9TUkdCOF9BTFBIQThfQVNUQ18xMHgxMF9LSFIgOiBleHRlbnNpb24uQ09NUFJFU1NFRF9SR0JBX0FTVENfMTB4MTBfS0hSOwoJCQkJaWYgKCBwID09PSBSR0JBX0FTVENfMTJ4MTBfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQjhfQUxQSEE4X0FTVENfMTJ4MTBfS0hSIDogZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCQV9BU1RDXzEyeDEwX0tIUjsKCQkJCWlmICggcCA9PT0gUkdCQV9BU1RDXzEyeDEyX0Zvcm1hdCApIHJldHVybiAoIHRyYW5zZmVyID09PSBTUkdCVHJhbnNmZXIgKSA/IGV4dGVuc2lvbi5DT01QUkVTU0VEX1NSR0I4X0FMUEhBOF9BU1RDXzEyeDEyX0tIUiA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQVNUQ18xMngxMl9LSFI7CgoJCQl9IGVsc2UgewoKCQkJCXJldHVybiBudWxsOwoKCQkJfQoKCQl9CgoJCS8vIEJQVEMKCgkJaWYgKCBwID09PSBSR0JBX0JQVENfRm9ybWF0IHx8IHAgPT09IFJHQl9CUFRDX1NJR05FRF9Gb3JtYXQgfHwgcCA9PT0gUkdCX0JQVENfVU5TSUdORURfRm9ybWF0ICkgewoKCQkJZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdFWFRfdGV4dHVyZV9jb21wcmVzc2lvbl9icHRjJyApOwoKCQkJaWYgKCBleHRlbnNpb24gIT09IG51bGwgKSB7CgoJCQkJaWYgKCBwID09PSBSR0JBX0JQVENfRm9ybWF0ICkgcmV0dXJuICggdHJhbnNmZXIgPT09IFNSR0JUcmFuc2ZlciApID8gZXh0ZW5zaW9uLkNPTVBSRVNTRURfU1JHQl9BTFBIQV9CUFRDX1VOT1JNX0VYVCA6IGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQkFfQlBUQ19VTk9STV9FWFQ7CgkJCQlpZiAoIHAgPT09IFJHQl9CUFRDX1NJR05FRF9Gb3JtYXQgKSByZXR1cm4gZXh0ZW5zaW9uLkNPTVBSRVNTRURfUkdCX0JQVENfU0lHTkVEX0ZMT0FUX0VYVDsKCQkJCWlmICggcCA9PT0gUkdCX0JQVENfVU5TSUdORURfRm9ybWF0ICkgcmV0dXJuIGV4dGVuc2lvbi5DT01QUkVTU0VEX1JHQl9CUFRDX1VOU0lHTkVEX0ZMT0FUX0VYVDsKCgkJCX0gZWxzZSB7CgoJCQkJcmV0dXJuIG51bGw7CgoJCQl9CgoJCX0KCgkJLy8gUkdUQwoKCQlpZiAoIHAgPT09IFJFRF9SR1RDMV9Gb3JtYXQgfHwgcCA9PT0gU0lHTkVEX1JFRF9SR1RDMV9Gb3JtYXQgfHwgcCA9PT0gUkVEX0dSRUVOX1JHVEMyX0Zvcm1hdCB8fCBwID09PSBTSUdORURfUkVEX0dSRUVOX1JHVEMyX0Zvcm1hdCApIHsKCgkJCWV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnRVhUX3RleHR1cmVfY29tcHJlc3Npb25fcmd0YycgKTsKCgkJCWlmICggZXh0ZW5zaW9uICE9PSBudWxsICkgewoKCQkJCWlmICggcCA9PT0gUkdCQV9CUFRDX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SRURfUkdUQzFfRVhUOwoJCQkJaWYgKCBwID09PSBTSUdORURfUkVEX1JHVEMxX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9TSUdORURfUkVEX1JHVEMxX0VYVDsKCQkJCWlmICggcCA9PT0gUkVEX0dSRUVOX1JHVEMyX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9SRURfR1JFRU5fUkdUQzJfRVhUOwoJCQkJaWYgKCBwID09PSBTSUdORURfUkVEX0dSRUVOX1JHVEMyX0Zvcm1hdCApIHJldHVybiBleHRlbnNpb24uQ09NUFJFU1NFRF9TSUdORURfUkVEX0dSRUVOX1JHVEMyX0VYVDsKCgkJCX0gZWxzZSB7CgoJCQkJcmV0dXJuIG51bGw7CgoJCQl9CgoJCX0KCgkJLy8KCgkJaWYgKCBwID09PSBVbnNpZ25lZEludDI0OFR5cGUgKSB7CgoJCQlpZiAoIGlzV2ViR0wyICkgcmV0dXJuIGdsLlVOU0lHTkVEX0lOVF8yNF84OwoKCQkJZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9kZXB0aF90ZXh0dXJlJyApOwoKCQkJaWYgKCBleHRlbnNpb24gIT09IG51bGwgKSB7CgoJCQkJcmV0dXJuIGV4dGVuc2lvbi5VTlNJR05FRF9JTlRfMjRfOF9XRUJHTDsKCgkJCX0gZWxzZSB7CgoJCQkJcmV0dXJuIG51bGw7CgoJCQl9CgoJCX0KCgkJLy8gaWYgInAiIGNhbid0IGJlIHJlc29sdmVkLCBhc3N1bWUgdGhlIHVzZXIgZGVmaW5lcyBhIFdlYkdMIGNvbnN0YW50IGFzIGEgc3RyaW5nIChmYWxsYmFjay93b3JrYXJvdW5kIGZvciBwYWNrZWQgUkdCIGZvcm1hdHMpCgoJCXJldHVybiAoIGdsWyBwIF0gIT09IHVuZGVmaW5lZCApID8gZ2xbIHAgXSA6IG51bGw7CgoJfQoKCXJldHVybiB7IGNvbnZlcnQ6IGNvbnZlcnQgfTsKCn0KCmNsYXNzIEFycmF5Q2FtZXJhIGV4dGVuZHMgUGVyc3BlY3RpdmVDYW1lcmEgewoKCWNvbnN0cnVjdG9yKCBhcnJheSA9IFtdICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzQXJyYXlDYW1lcmEgPSB0cnVlOwoKCQl0aGlzLmNhbWVyYXMgPSBhcnJheTsKCgl9Cgp9CgpjbGFzcyBHcm91cCBleHRlbmRzIE9iamVjdDNEIHsKCgljb25zdHJ1Y3RvcigpIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc0dyb3VwID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ0dyb3VwJzsKCgl9Cgp9Cgpjb25zdCBfbW92ZUV2ZW50ID0geyB0eXBlOiAnbW92ZScgfTsKCmNsYXNzIFdlYlhSQ29udHJvbGxlciB7CgoJY29uc3RydWN0b3IoKSB7CgoJCXRoaXMuX3RhcmdldFJheSA9IG51bGw7CgkJdGhpcy5fZ3JpcCA9IG51bGw7CgkJdGhpcy5faGFuZCA9IG51bGw7CgoJfQoKCWdldEhhbmRTcGFjZSgpIHsKCgkJaWYgKCB0aGlzLl9oYW5kID09PSBudWxsICkgewoKCQkJdGhpcy5faGFuZCA9IG5ldyBHcm91cCgpOwoJCQl0aGlzLl9oYW5kLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCQkJdGhpcy5faGFuZC52aXNpYmxlID0gZmFsc2U7CgoJCQl0aGlzLl9oYW5kLmpvaW50cyA9IHt9OwoJCQl0aGlzLl9oYW5kLmlucHV0U3RhdGUgPSB7IHBpbmNoaW5nOiBmYWxzZSB9OwoKCQl9CgoJCXJldHVybiB0aGlzLl9oYW5kOwoKCX0KCglnZXRUYXJnZXRSYXlTcGFjZSgpIHsKCgkJaWYgKCB0aGlzLl90YXJnZXRSYXkgPT09IG51bGwgKSB7CgoJCQl0aGlzLl90YXJnZXRSYXkgPSBuZXcgR3JvdXAoKTsKCQkJdGhpcy5fdGFyZ2V0UmF5Lm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCQkJdGhpcy5fdGFyZ2V0UmF5LnZpc2libGUgPSBmYWxzZTsKCQkJdGhpcy5fdGFyZ2V0UmF5Lmhhc0xpbmVhclZlbG9jaXR5ID0gZmFsc2U7CgkJCXRoaXMuX3RhcmdldFJheS5saW5lYXJWZWxvY2l0eSA9IG5ldyBWZWN0b3IzKCk7CgkJCXRoaXMuX3RhcmdldFJheS5oYXNBbmd1bGFyVmVsb2NpdHkgPSBmYWxzZTsKCQkJdGhpcy5fdGFyZ2V0UmF5LmFuZ3VsYXJWZWxvY2l0eSA9IG5ldyBWZWN0b3IzKCk7CgoJCX0KCgkJcmV0dXJuIHRoaXMuX3RhcmdldFJheTsKCgl9CgoJZ2V0R3JpcFNwYWNlKCkgewoKCQlpZiAoIHRoaXMuX2dyaXAgPT09IG51bGwgKSB7CgoJCQl0aGlzLl9ncmlwID0gbmV3IEdyb3VwKCk7CgkJCXRoaXMuX2dyaXAubWF0cml4QXV0b1VwZGF0ZSA9IGZhbHNlOwoJCQl0aGlzLl9ncmlwLnZpc2libGUgPSBmYWxzZTsKCQkJdGhpcy5fZ3JpcC5oYXNMaW5lYXJWZWxvY2l0eSA9IGZhbHNlOwoJCQl0aGlzLl9ncmlwLmxpbmVhclZlbG9jaXR5ID0gbmV3IFZlY3RvcjMoKTsKCQkJdGhpcy5fZ3JpcC5oYXNBbmd1bGFyVmVsb2NpdHkgPSBmYWxzZTsKCQkJdGhpcy5fZ3JpcC5hbmd1bGFyVmVsb2NpdHkgPSBuZXcgVmVjdG9yMygpOwoKCQl9CgoJCXJldHVybiB0aGlzLl9ncmlwOwoKCX0KCglkaXNwYXRjaEV2ZW50KCBldmVudCApIHsKCgkJaWYgKCB0aGlzLl90YXJnZXRSYXkgIT09IG51bGwgKSB7CgoJCQl0aGlzLl90YXJnZXRSYXkuZGlzcGF0Y2hFdmVudCggZXZlbnQgKTsKCgkJfQoKCQlpZiAoIHRoaXMuX2dyaXAgIT09IG51bGwgKSB7CgoJCQl0aGlzLl9ncmlwLmRpc3BhdGNoRXZlbnQoIGV2ZW50ICk7CgoJCX0KCgkJaWYgKCB0aGlzLl9oYW5kICE9PSBudWxsICkgewoKCQkJdGhpcy5faGFuZC5kaXNwYXRjaEV2ZW50KCBldmVudCApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgljb25uZWN0KCBpbnB1dFNvdXJjZSApIHsKCgkJaWYgKCBpbnB1dFNvdXJjZSAmJiBpbnB1dFNvdXJjZS5oYW5kICkgewoKCQkJY29uc3QgaGFuZCA9IHRoaXMuX2hhbmQ7CgoJCQlpZiAoIGhhbmQgKSB7CgoJCQkJZm9yICggY29uc3QgaW5wdXRqb2ludCBvZiBpbnB1dFNvdXJjZS5oYW5kLnZhbHVlcygpICkgewoKCQkJCQkvLyBJbml0aWFsaXplIGhhbmQgd2l0aCBqb2ludHMgd2hlbiBjb25uZWN0ZWQKCQkJCQl0aGlzLl9nZXRIYW5kSm9pbnQoIGhhbmQsIGlucHV0am9pbnQgKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJdGhpcy5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdjb25uZWN0ZWQnLCBkYXRhOiBpbnB1dFNvdXJjZSB9ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglkaXNjb25uZWN0KCBpbnB1dFNvdXJjZSApIHsKCgkJdGhpcy5kaXNwYXRjaEV2ZW50KCB7IHR5cGU6ICdkaXNjb25uZWN0ZWQnLCBkYXRhOiBpbnB1dFNvdXJjZSB9ICk7CgoJCWlmICggdGhpcy5fdGFyZ2V0UmF5ICE9PSBudWxsICkgewoKCQkJdGhpcy5fdGFyZ2V0UmF5LnZpc2libGUgPSBmYWxzZTsKCgkJfQoKCQlpZiAoIHRoaXMuX2dyaXAgIT09IG51bGwgKSB7CgoJCQl0aGlzLl9ncmlwLnZpc2libGUgPSBmYWxzZTsKCgkJfQoKCQlpZiAoIHRoaXMuX2hhbmQgIT09IG51bGwgKSB7CgoJCQl0aGlzLl9oYW5kLnZpc2libGUgPSBmYWxzZTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdXBkYXRlKCBpbnB1dFNvdXJjZSwgZnJhbWUsIHJlZmVyZW5jZVNwYWNlICkgewoKCQlsZXQgaW5wdXRQb3NlID0gbnVsbDsKCQlsZXQgZ3JpcFBvc2UgPSBudWxsOwoJCWxldCBoYW5kUG9zZSA9IG51bGw7CgoJCWNvbnN0IHRhcmdldFJheSA9IHRoaXMuX3RhcmdldFJheTsKCQljb25zdCBncmlwID0gdGhpcy5fZ3JpcDsKCQljb25zdCBoYW5kID0gdGhpcy5faGFuZDsKCgkJaWYgKCBpbnB1dFNvdXJjZSAmJiBmcmFtZS5zZXNzaW9uLnZpc2liaWxpdHlTdGF0ZSAhPT0gJ3Zpc2libGUtYmx1cnJlZCcgKSB7CgoJCQlpZiAoIGhhbmQgJiYgaW5wdXRTb3VyY2UuaGFuZCApIHsKCgkJCQloYW5kUG9zZSA9IHRydWU7CgoJCQkJZm9yICggY29uc3QgaW5wdXRqb2ludCBvZiBpbnB1dFNvdXJjZS5oYW5kLnZhbHVlcygpICkgewoKCQkJCQkvLyBVcGRhdGUgdGhlIGpvaW50cyBncm91cHMgd2l0aCB0aGUgWFJKb2ludCBwb3NlcwoJCQkJCWNvbnN0IGpvaW50UG9zZSA9IGZyYW1lLmdldEpvaW50UG9zZSggaW5wdXRqb2ludCwgcmVmZXJlbmNlU3BhY2UgKTsKCgkJCQkJLy8gVGhlIHRyYW5zZm9ybSBvZiB0aGlzIGpvaW50IHdpbGwgYmUgdXBkYXRlZCB3aXRoIHRoZSBqb2ludCBwb3NlIG9uIGVhY2ggZnJhbWUKCQkJCQljb25zdCBqb2ludCA9IHRoaXMuX2dldEhhbmRKb2ludCggaGFuZCwgaW5wdXRqb2ludCApOwoKCQkJCQlpZiAoIGpvaW50UG9zZSAhPT0gbnVsbCApIHsKCgkJCQkJCWpvaW50Lm1hdHJpeC5mcm9tQXJyYXkoIGpvaW50UG9zZS50cmFuc2Zvcm0ubWF0cml4ICk7CgkJCQkJCWpvaW50Lm1hdHJpeC5kZWNvbXBvc2UoIGpvaW50LnBvc2l0aW9uLCBqb2ludC5yb3RhdGlvbiwgam9pbnQuc2NhbGUgKTsKCQkJCQkJam9pbnQubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IHRydWU7CgkJCQkJCWpvaW50LmpvaW50UmFkaXVzID0gam9pbnRQb3NlLnJhZGl1czsKCgkJCQkJfQoKCQkJCQlqb2ludC52aXNpYmxlID0gam9pbnRQb3NlICE9PSBudWxsOwoKCQkJCX0KCgkJCQkvLyBDdXN0b20gZXZlbnRzCgoJCQkJLy8gQ2hlY2sgcGluY2h6CgkJCQljb25zdCBpbmRleFRpcCA9IGhhbmQuam9pbnRzWyAnaW5kZXgtZmluZ2VyLXRpcCcgXTsKCQkJCWNvbnN0IHRodW1iVGlwID0gaGFuZC5qb2ludHNbICd0aHVtYi10aXAnIF07CgkJCQljb25zdCBkaXN0YW5jZSA9IGluZGV4VGlwLnBvc2l0aW9uLmRpc3RhbmNlVG8oIHRodW1iVGlwLnBvc2l0aW9uICk7CgoJCQkJY29uc3QgZGlzdGFuY2VUb1BpbmNoID0gMC4wMjsKCQkJCWNvbnN0IHRocmVzaG9sZCA9IDAuMDA1OwoKCQkJCWlmICggaGFuZC5pbnB1dFN0YXRlLnBpbmNoaW5nICYmIGRpc3RhbmNlID4gZGlzdGFuY2VUb1BpbmNoICsgdGhyZXNob2xkICkgewoKCQkJCQloYW5kLmlucHV0U3RhdGUucGluY2hpbmcgPSBmYWxzZTsKCQkJCQl0aGlzLmRpc3BhdGNoRXZlbnQoIHsKCQkJCQkJdHlwZTogJ3BpbmNoZW5kJywKCQkJCQkJaGFuZGVkbmVzczogaW5wdXRTb3VyY2UuaGFuZGVkbmVzcywKCQkJCQkJdGFyZ2V0OiB0aGlzCgkJCQkJfSApOwoKCQkJCX0gZWxzZSBpZiAoICEgaGFuZC5pbnB1dFN0YXRlLnBpbmNoaW5nICYmIGRpc3RhbmNlIDw9IGRpc3RhbmNlVG9QaW5jaCAtIHRocmVzaG9sZCApIHsKCgkJCQkJaGFuZC5pbnB1dFN0YXRlLnBpbmNoaW5nID0gdHJ1ZTsKCQkJCQl0aGlzLmRpc3BhdGNoRXZlbnQoIHsKCQkJCQkJdHlwZTogJ3BpbmNoc3RhcnQnLAoJCQkJCQloYW5kZWRuZXNzOiBpbnB1dFNvdXJjZS5oYW5kZWRuZXNzLAoJCQkJCQl0YXJnZXQ6IHRoaXMKCQkJCQl9ICk7CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQlpZiAoIGdyaXAgIT09IG51bGwgJiYgaW5wdXRTb3VyY2UuZ3JpcFNwYWNlICkgewoKCQkJCQlncmlwUG9zZSA9IGZyYW1lLmdldFBvc2UoIGlucHV0U291cmNlLmdyaXBTcGFjZSwgcmVmZXJlbmNlU3BhY2UgKTsKCgkJCQkJaWYgKCBncmlwUG9zZSAhPT0gbnVsbCApIHsKCgkJCQkJCWdyaXAubWF0cml4LmZyb21BcnJheSggZ3JpcFBvc2UudHJhbnNmb3JtLm1hdHJpeCApOwoJCQkJCQlncmlwLm1hdHJpeC5kZWNvbXBvc2UoIGdyaXAucG9zaXRpb24sIGdyaXAucm90YXRpb24sIGdyaXAuc2NhbGUgKTsKCQkJCQkJZ3JpcC5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQkJCWlmICggZ3JpcFBvc2UubGluZWFyVmVsb2NpdHkgKSB7CgoJCQkJCQkJZ3JpcC5oYXNMaW5lYXJWZWxvY2l0eSA9IHRydWU7CgkJCQkJCQlncmlwLmxpbmVhclZlbG9jaXR5LmNvcHkoIGdyaXBQb3NlLmxpbmVhclZlbG9jaXR5ICk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCWdyaXAuaGFzTGluZWFyVmVsb2NpdHkgPSBmYWxzZTsKCgkJCQkJCX0KCgkJCQkJCWlmICggZ3JpcFBvc2UuYW5ndWxhclZlbG9jaXR5ICkgewoKCQkJCQkJCWdyaXAuaGFzQW5ndWxhclZlbG9jaXR5ID0gdHJ1ZTsKCQkJCQkJCWdyaXAuYW5ndWxhclZlbG9jaXR5LmNvcHkoIGdyaXBQb3NlLmFuZ3VsYXJWZWxvY2l0eSApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQlncmlwLmhhc0FuZ3VsYXJWZWxvY2l0eSA9IGZhbHNlOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJaWYgKCB0YXJnZXRSYXkgIT09IG51bGwgKSB7CgoJCQkJaW5wdXRQb3NlID0gZnJhbWUuZ2V0UG9zZSggaW5wdXRTb3VyY2UudGFyZ2V0UmF5U3BhY2UsIHJlZmVyZW5jZVNwYWNlICk7CgoJCQkJLy8gU29tZSBydW50aW1lcyAobmFtZWx5IFZpdmUgQ29zbW9zIHdpdGggVml2ZSBPcGVuWFIgUnVudGltZSkgaGF2ZSBvbmx5IGdyaXAgc3BhY2UgYW5kIHJheSBzcGFjZSBpcyBlcXVhbCB0byBpdAoJCQkJaWYgKCBpbnB1dFBvc2UgPT09IG51bGwgJiYgZ3JpcFBvc2UgIT09IG51bGwgKSB7CgoJCQkJCWlucHV0UG9zZSA9IGdyaXBQb3NlOwoKCQkJCX0KCgkJCQlpZiAoIGlucHV0UG9zZSAhPT0gbnVsbCApIHsKCgkJCQkJdGFyZ2V0UmF5Lm1hdHJpeC5mcm9tQXJyYXkoIGlucHV0UG9zZS50cmFuc2Zvcm0ubWF0cml4ICk7CgkJCQkJdGFyZ2V0UmF5Lm1hdHJpeC5kZWNvbXBvc2UoIHRhcmdldFJheS5wb3NpdGlvbiwgdGFyZ2V0UmF5LnJvdGF0aW9uLCB0YXJnZXRSYXkuc2NhbGUgKTsKCQkJCQl0YXJnZXRSYXkubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQkJCWlmICggaW5wdXRQb3NlLmxpbmVhclZlbG9jaXR5ICkgewoKCQkJCQkJdGFyZ2V0UmF5Lmhhc0xpbmVhclZlbG9jaXR5ID0gdHJ1ZTsKCQkJCQkJdGFyZ2V0UmF5LmxpbmVhclZlbG9jaXR5LmNvcHkoIGlucHV0UG9zZS5saW5lYXJWZWxvY2l0eSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdGFyZ2V0UmF5Lmhhc0xpbmVhclZlbG9jaXR5ID0gZmFsc2U7CgoJCQkJCX0KCgkJCQkJaWYgKCBpbnB1dFBvc2UuYW5ndWxhclZlbG9jaXR5ICkgewoKCQkJCQkJdGFyZ2V0UmF5Lmhhc0FuZ3VsYXJWZWxvY2l0eSA9IHRydWU7CgkJCQkJCXRhcmdldFJheS5hbmd1bGFyVmVsb2NpdHkuY29weSggaW5wdXRQb3NlLmFuZ3VsYXJWZWxvY2l0eSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdGFyZ2V0UmF5Lmhhc0FuZ3VsYXJWZWxvY2l0eSA9IGZhbHNlOwoKCQkJCQl9CgoJCQkJCXRoaXMuZGlzcGF0Y2hFdmVudCggX21vdmVFdmVudCApOwoKCQkJCX0KCgkJCX0KCgoJCX0KCgkJaWYgKCB0YXJnZXRSYXkgIT09IG51bGwgKSB7CgoJCQl0YXJnZXRSYXkudmlzaWJsZSA9ICggaW5wdXRQb3NlICE9PSBudWxsICk7CgoJCX0KCgkJaWYgKCBncmlwICE9PSBudWxsICkgewoKCQkJZ3JpcC52aXNpYmxlID0gKCBncmlwUG9zZSAhPT0gbnVsbCApOwoKCQl9CgoJCWlmICggaGFuZCAhPT0gbnVsbCApIHsKCgkJCWhhbmQudmlzaWJsZSA9ICggaGFuZFBvc2UgIT09IG51bGwgKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJLy8gcHJpdmF0ZSBtZXRob2QKCglfZ2V0SGFuZEpvaW50KCBoYW5kLCBpbnB1dGpvaW50ICkgewoKCQlpZiAoIGhhbmQuam9pbnRzWyBpbnB1dGpvaW50LmpvaW50TmFtZSBdID09PSB1bmRlZmluZWQgKSB7CgoJCQljb25zdCBqb2ludCA9IG5ldyBHcm91cCgpOwoJCQlqb2ludC5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgkJCWpvaW50LnZpc2libGUgPSBmYWxzZTsKCQkJaGFuZC5qb2ludHNbIGlucHV0am9pbnQuam9pbnROYW1lIF0gPSBqb2ludDsKCgkJCWhhbmQuYWRkKCBqb2ludCApOwoKCQl9CgoJCXJldHVybiBoYW5kLmpvaW50c1sgaW5wdXRqb2ludC5qb2ludE5hbWUgXTsKCgl9Cgp9CgpjbGFzcyBEZXB0aFRleHR1cmUgZXh0ZW5kcyBUZXh0dXJlIHsKCgljb25zdHJ1Y3Rvciggd2lkdGgsIGhlaWdodCwgdHlwZSwgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgYW5pc290cm9weSwgZm9ybWF0ICkgewoKCQlmb3JtYXQgPSBmb3JtYXQgIT09IHVuZGVmaW5lZCA/IGZvcm1hdCA6IERlcHRoRm9ybWF0OwoKCQlpZiAoIGZvcm1hdCAhPT0gRGVwdGhGb3JtYXQgJiYgZm9ybWF0ICE9PSBEZXB0aFN0ZW5jaWxGb3JtYXQgKSB7CgoJCQl0aHJvdyBuZXcgRXJyb3IoICdEZXB0aFRleHR1cmUgZm9ybWF0IG11c3QgYmUgZWl0aGVyIFRIUkVFLkRlcHRoRm9ybWF0IG9yIFRIUkVFLkRlcHRoU3RlbmNpbEZvcm1hdCcgKTsKCgkJfQoKCQlpZiAoIHR5cGUgPT09IHVuZGVmaW5lZCAmJiBmb3JtYXQgPT09IERlcHRoRm9ybWF0ICkgdHlwZSA9IFVuc2lnbmVkSW50VHlwZTsKCQlpZiAoIHR5cGUgPT09IHVuZGVmaW5lZCAmJiBmb3JtYXQgPT09IERlcHRoU3RlbmNpbEZvcm1hdCApIHR5cGUgPSBVbnNpZ25lZEludDI0OFR5cGU7CgoJCXN1cGVyKCBudWxsLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciwgbWluRmlsdGVyLCBmb3JtYXQsIHR5cGUsIGFuaXNvdHJvcHkgKTsKCgkJdGhpcy5pc0RlcHRoVGV4dHVyZSA9IHRydWU7CgoJCXRoaXMuaW1hZ2UgPSB7IHdpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHQgfTsKCgkJdGhpcy5tYWdGaWx0ZXIgPSBtYWdGaWx0ZXIgIT09IHVuZGVmaW5lZCA/IG1hZ0ZpbHRlciA6IE5lYXJlc3RGaWx0ZXI7CgkJdGhpcy5taW5GaWx0ZXIgPSBtaW5GaWx0ZXIgIT09IHVuZGVmaW5lZCA/IG1pbkZpbHRlciA6IE5lYXJlc3RGaWx0ZXI7CgoJCXRoaXMuZmxpcFkgPSBmYWxzZTsKCQl0aGlzLmdlbmVyYXRlTWlwbWFwcyA9IGZhbHNlOwoKCQl0aGlzLmNvbXBhcmVGdW5jdGlvbiA9IG51bGw7CgoJfQoKCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLmNvbXBhcmVGdW5jdGlvbiA9IHNvdXJjZS5jb21wYXJlRnVuY3Rpb247CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0pTT04oIG1ldGEgKSB7CgoJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oIG1ldGEgKTsKCgkJaWYgKCB0aGlzLmNvbXBhcmVGdW5jdGlvbiAhPT0gbnVsbCApIGRhdGEuY29tcGFyZUZ1bmN0aW9uID0gdGhpcy5jb21wYXJlRnVuY3Rpb247CgoJCXJldHVybiBkYXRhOwoKCX0KCn0KCmNsYXNzIFdlYlhSTWFuYWdlciBleHRlbmRzIEV2ZW50RGlzcGF0Y2hlciB7CgoJY29uc3RydWN0b3IoIHJlbmRlcmVyLCBnbCApIHsKCgkJc3VwZXIoKTsKCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQlsZXQgc2Vzc2lvbiA9IG51bGw7CgoJCWxldCBmcmFtZWJ1ZmZlclNjYWxlRmFjdG9yID0gMS4wOwoKCQlsZXQgcmVmZXJlbmNlU3BhY2UgPSBudWxsOwoJCWxldCByZWZlcmVuY2VTcGFjZVR5cGUgPSAnbG9jYWwtZmxvb3InOwoJCS8vIFNldCBkZWZhdWx0IGZvdmVhdGlvbiB0byBtYXhpbXVtLgoJCWxldCBmb3ZlYXRpb24gPSAxLjA7CgkJbGV0IGN1c3RvbVJlZmVyZW5jZVNwYWNlID0gbnVsbDsKCgkJbGV0IHBvc2UgPSBudWxsOwoJCWxldCBnbEJpbmRpbmcgPSBudWxsOwoJCWxldCBnbFByb2pMYXllciA9IG51bGw7CgkJbGV0IGdsQmFzZUxheWVyID0gbnVsbDsKCQlsZXQgeHJGcmFtZSA9IG51bGw7CgkJY29uc3QgYXR0cmlidXRlcyA9IGdsLmdldENvbnRleHRBdHRyaWJ1dGVzKCk7CgkJbGV0IGluaXRpYWxSZW5kZXJUYXJnZXQgPSBudWxsOwoJCWxldCBuZXdSZW5kZXJUYXJnZXQgPSBudWxsOwoKCQljb25zdCBjb250cm9sbGVycyA9IFtdOwoJCWNvbnN0IGNvbnRyb2xsZXJJbnB1dFNvdXJjZXMgPSBbXTsKCgkJLy8KCgkJY29uc3QgY2FtZXJhTCA9IG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSgpOwoJCWNhbWVyYUwubGF5ZXJzLmVuYWJsZSggMSApOwoJCWNhbWVyYUwudmlld3BvcnQgPSBuZXcgVmVjdG9yNCgpOwoKCQljb25zdCBjYW1lcmFSID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCk7CgkJY2FtZXJhUi5sYXllcnMuZW5hYmxlKCAyICk7CgkJY2FtZXJhUi52aWV3cG9ydCA9IG5ldyBWZWN0b3I0KCk7CgoJCWNvbnN0IGNhbWVyYXMgPSBbIGNhbWVyYUwsIGNhbWVyYVIgXTsKCgkJY29uc3QgY2FtZXJhWFIgPSBuZXcgQXJyYXlDYW1lcmEoKTsKCQljYW1lcmFYUi5sYXllcnMuZW5hYmxlKCAxICk7CgkJY2FtZXJhWFIubGF5ZXJzLmVuYWJsZSggMiApOwoKCQlsZXQgX2N1cnJlbnREZXB0aE5lYXIgPSBudWxsOwoJCWxldCBfY3VycmVudERlcHRoRmFyID0gbnVsbDsKCgkJLy8KCgkJdGhpcy5jYW1lcmFBdXRvVXBkYXRlID0gdHJ1ZTsKCQl0aGlzLmVuYWJsZWQgPSBmYWxzZTsKCgkJdGhpcy5pc1ByZXNlbnRpbmcgPSBmYWxzZTsKCgkJdGhpcy5nZXRDb250cm9sbGVyID0gZnVuY3Rpb24gKCBpbmRleCApIHsKCgkJCWxldCBjb250cm9sbGVyID0gY29udHJvbGxlcnNbIGluZGV4IF07CgoJCQlpZiAoIGNvbnRyb2xsZXIgPT09IHVuZGVmaW5lZCApIHsKCgkJCQljb250cm9sbGVyID0gbmV3IFdlYlhSQ29udHJvbGxlcigpOwoJCQkJY29udHJvbGxlcnNbIGluZGV4IF0gPSBjb250cm9sbGVyOwoKCQkJfQoKCQkJcmV0dXJuIGNvbnRyb2xsZXIuZ2V0VGFyZ2V0UmF5U3BhY2UoKTsKCgkJfTsKCgkJdGhpcy5nZXRDb250cm9sbGVyR3JpcCA9IGZ1bmN0aW9uICggaW5kZXggKSB7CgoJCQlsZXQgY29udHJvbGxlciA9IGNvbnRyb2xsZXJzWyBpbmRleCBdOwoKCQkJaWYgKCBjb250cm9sbGVyID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29udHJvbGxlciA9IG5ldyBXZWJYUkNvbnRyb2xsZXIoKTsKCQkJCWNvbnRyb2xsZXJzWyBpbmRleCBdID0gY29udHJvbGxlcjsKCgkJCX0KCgkJCXJldHVybiBjb250cm9sbGVyLmdldEdyaXBTcGFjZSgpOwoKCQl9OwoKCQl0aGlzLmdldEhhbmQgPSBmdW5jdGlvbiAoIGluZGV4ICkgewoKCQkJbGV0IGNvbnRyb2xsZXIgPSBjb250cm9sbGVyc1sgaW5kZXggXTsKCgkJCWlmICggY29udHJvbGxlciA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnRyb2xsZXIgPSBuZXcgV2ViWFJDb250cm9sbGVyKCk7CgkJCQljb250cm9sbGVyc1sgaW5kZXggXSA9IGNvbnRyb2xsZXI7CgoJCQl9CgoJCQlyZXR1cm4gY29udHJvbGxlci5nZXRIYW5kU3BhY2UoKTsKCgkJfTsKCgkJLy8KCgkJZnVuY3Rpb24gb25TZXNzaW9uRXZlbnQoIGV2ZW50ICkgewoKCQkJY29uc3QgY29udHJvbGxlckluZGV4ID0gY29udHJvbGxlcklucHV0U291cmNlcy5pbmRleE9mKCBldmVudC5pbnB1dFNvdXJjZSApOwoKCQkJaWYgKCBjb250cm9sbGVySW5kZXggPT09IC0gMSApIHsKCgkJCQlyZXR1cm47CgoJCQl9CgoJCQljb25zdCBjb250cm9sbGVyID0gY29udHJvbGxlcnNbIGNvbnRyb2xsZXJJbmRleCBdOwoKCQkJaWYgKCBjb250cm9sbGVyICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJY29udHJvbGxlci51cGRhdGUoIGV2ZW50LmlucHV0U291cmNlLCBldmVudC5mcmFtZSwgY3VzdG9tUmVmZXJlbmNlU3BhY2UgfHwgcmVmZXJlbmNlU3BhY2UgKTsKCQkJCWNvbnRyb2xsZXIuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiBldmVudC50eXBlLCBkYXRhOiBldmVudC5pbnB1dFNvdXJjZSB9ICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gb25TZXNzaW9uRW5kKCkgewoKCQkJc2Vzc2lvbi5yZW1vdmVFdmVudExpc3RlbmVyKCAnc2VsZWN0Jywgb25TZXNzaW9uRXZlbnQgKTsKCQkJc2Vzc2lvbi5yZW1vdmVFdmVudExpc3RlbmVyKCAnc2VsZWN0c3RhcnQnLCBvblNlc3Npb25FdmVudCApOwoJCQlzZXNzaW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdzZWxlY3RlbmQnLCBvblNlc3Npb25FdmVudCApOwoJCQlzZXNzaW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdzcXVlZXplJywgb25TZXNzaW9uRXZlbnQgKTsKCQkJc2Vzc2lvbi5yZW1vdmVFdmVudExpc3RlbmVyKCAnc3F1ZWV6ZXN0YXJ0Jywgb25TZXNzaW9uRXZlbnQgKTsKCQkJc2Vzc2lvbi5yZW1vdmVFdmVudExpc3RlbmVyKCAnc3F1ZWV6ZWVuZCcsIG9uU2Vzc2lvbkV2ZW50ICk7CgkJCXNlc3Npb24ucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2VuZCcsIG9uU2Vzc2lvbkVuZCApOwoJCQlzZXNzaW9uLnJlbW92ZUV2ZW50TGlzdGVuZXIoICdpbnB1dHNvdXJjZXNjaGFuZ2UnLCBvbklucHV0U291cmNlc0NoYW5nZSApOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgY29udHJvbGxlcnMubGVuZ3RoOyBpICsrICkgewoKCQkJCWNvbnN0IGlucHV0U291cmNlID0gY29udHJvbGxlcklucHV0U291cmNlc1sgaSBdOwoKCQkJCWlmICggaW5wdXRTb3VyY2UgPT09IG51bGwgKSBjb250aW51ZTsKCgkJCQljb250cm9sbGVySW5wdXRTb3VyY2VzWyBpIF0gPSBudWxsOwoKCQkJCWNvbnRyb2xsZXJzWyBpIF0uZGlzY29ubmVjdCggaW5wdXRTb3VyY2UgKTsKCgkJCX0KCgkJCV9jdXJyZW50RGVwdGhOZWFyID0gbnVsbDsKCQkJX2N1cnJlbnREZXB0aEZhciA9IG51bGw7CgoJCQkvLyByZXN0b3JlIGZyYW1lYnVmZmVyL3JlbmRlcmluZyBzdGF0ZQoKCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0KCBpbml0aWFsUmVuZGVyVGFyZ2V0ICk7CgoJCQlnbEJhc2VMYXllciA9IG51bGw7CgkJCWdsUHJvakxheWVyID0gbnVsbDsKCQkJZ2xCaW5kaW5nID0gbnVsbDsKCQkJc2Vzc2lvbiA9IG51bGw7CgkJCW5ld1JlbmRlclRhcmdldCA9IG51bGw7CgoJCQkvLwoKCQkJYW5pbWF0aW9uLnN0b3AoKTsKCgkJCXNjb3BlLmlzUHJlc2VudGluZyA9IGZhbHNlOwoKCQkJc2NvcGUuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnc2Vzc2lvbmVuZCcgfSApOwoKCQl9CgoJCXRoaXMuc2V0RnJhbWVidWZmZXJTY2FsZUZhY3RvciA9IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQlmcmFtZWJ1ZmZlclNjYWxlRmFjdG9yID0gdmFsdWU7CgoJCQlpZiAoIHNjb3BlLmlzUHJlc2VudGluZyA9PT0gdHJ1ZSApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJYUk1hbmFnZXI6IENhbm5vdCBjaGFuZ2UgZnJhbWVidWZmZXIgc2NhbGUgd2hpbGUgcHJlc2VudGluZy4nICk7CgoJCQl9CgoJCX07CgoJCXRoaXMuc2V0UmVmZXJlbmNlU3BhY2VUeXBlID0gZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCXJlZmVyZW5jZVNwYWNlVHlwZSA9IHZhbHVlOwoKCQkJaWYgKCBzY29wZS5pc1ByZXNlbnRpbmcgPT09IHRydWUgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViWFJNYW5hZ2VyOiBDYW5ub3QgY2hhbmdlIHJlZmVyZW5jZSBzcGFjZSB0eXBlIHdoaWxlIHByZXNlbnRpbmcuJyApOwoKCQkJfQoKCQl9OwoKCQl0aGlzLmdldFJlZmVyZW5jZVNwYWNlID0gZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIGN1c3RvbVJlZmVyZW5jZVNwYWNlIHx8IHJlZmVyZW5jZVNwYWNlOwoKCQl9OwoKCQl0aGlzLnNldFJlZmVyZW5jZVNwYWNlID0gZnVuY3Rpb24gKCBzcGFjZSApIHsKCgkJCWN1c3RvbVJlZmVyZW5jZVNwYWNlID0gc3BhY2U7CgoJCX07CgoJCXRoaXMuZ2V0QmFzZUxheWVyID0gZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIGdsUHJvakxheWVyICE9PSBudWxsID8gZ2xQcm9qTGF5ZXIgOiBnbEJhc2VMYXllcjsKCgkJfTsKCgkJdGhpcy5nZXRCaW5kaW5nID0gZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIGdsQmluZGluZzsKCgkJfTsKCgkJdGhpcy5nZXRGcmFtZSA9IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiB4ckZyYW1lOwoKCQl9OwoKCQl0aGlzLmdldFNlc3Npb24gPSBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gc2Vzc2lvbjsKCgkJfTsKCgkJdGhpcy5zZXRTZXNzaW9uID0gYXN5bmMgZnVuY3Rpb24gKCB2YWx1ZSApIHsKCgkJCXNlc3Npb24gPSB2YWx1ZTsKCgkJCWlmICggc2Vzc2lvbiAhPT0gbnVsbCApIHsKCgkJCQlpbml0aWFsUmVuZGVyVGFyZ2V0ID0gcmVuZGVyZXIuZ2V0UmVuZGVyVGFyZ2V0KCk7CgoJCQkJc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKCAnc2VsZWN0Jywgb25TZXNzaW9uRXZlbnQgKTsKCQkJCXNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lciggJ3NlbGVjdHN0YXJ0Jywgb25TZXNzaW9uRXZlbnQgKTsKCQkJCXNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lciggJ3NlbGVjdGVuZCcsIG9uU2Vzc2lvbkV2ZW50ICk7CgkJCQlzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoICdzcXVlZXplJywgb25TZXNzaW9uRXZlbnQgKTsKCQkJCXNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lciggJ3NxdWVlemVzdGFydCcsIG9uU2Vzc2lvbkV2ZW50ICk7CgkJCQlzZXNzaW9uLmFkZEV2ZW50TGlzdGVuZXIoICdzcXVlZXplZW5kJywgb25TZXNzaW9uRXZlbnQgKTsKCQkJCXNlc3Npb24uYWRkRXZlbnRMaXN0ZW5lciggJ2VuZCcsIG9uU2Vzc2lvbkVuZCApOwoJCQkJc2Vzc2lvbi5hZGRFdmVudExpc3RlbmVyKCAnaW5wdXRzb3VyY2VzY2hhbmdlJywgb25JbnB1dFNvdXJjZXNDaGFuZ2UgKTsKCgkJCQlpZiAoIGF0dHJpYnV0ZXMueHJDb21wYXRpYmxlICE9PSB0cnVlICkgewoKCQkJCQlhd2FpdCBnbC5tYWtlWFJDb21wYXRpYmxlKCk7CgoJCQkJfQoKCQkJCWlmICggKCBzZXNzaW9uLnJlbmRlclN0YXRlLmxheWVycyA9PT0gdW5kZWZpbmVkICkgfHwgKCByZW5kZXJlci5jYXBhYmlsaXRpZXMuaXNXZWJHTDIgPT09IGZhbHNlICkgKSB7CgoJCQkJCWNvbnN0IGxheWVySW5pdCA9IHsKCQkJCQkJYW50aWFsaWFzOiAoIHNlc3Npb24ucmVuZGVyU3RhdGUubGF5ZXJzID09PSB1bmRlZmluZWQgKSA/IGF0dHJpYnV0ZXMuYW50aWFsaWFzIDogdHJ1ZSwKCQkJCQkJYWxwaGE6IHRydWUsCgkJCQkJCWRlcHRoOiBhdHRyaWJ1dGVzLmRlcHRoLAoJCQkJCQlzdGVuY2lsOiBhdHRyaWJ1dGVzLnN0ZW5jaWwsCgkJCQkJCWZyYW1lYnVmZmVyU2NhbGVGYWN0b3I6IGZyYW1lYnVmZmVyU2NhbGVGYWN0b3IKCQkJCQl9OwoKCQkJCQlnbEJhc2VMYXllciA9IG5ldyBYUldlYkdMTGF5ZXIoIHNlc3Npb24sIGdsLCBsYXllckluaXQgKTsKCgkJCQkJc2Vzc2lvbi51cGRhdGVSZW5kZXJTdGF0ZSggeyBiYXNlTGF5ZXI6IGdsQmFzZUxheWVyIH0gKTsKCgkJCQkJbmV3UmVuZGVyVGFyZ2V0ID0gbmV3IFdlYkdMUmVuZGVyVGFyZ2V0KAoJCQkJCQlnbEJhc2VMYXllci5mcmFtZWJ1ZmZlcldpZHRoLAoJCQkJCQlnbEJhc2VMYXllci5mcmFtZWJ1ZmZlckhlaWdodCwKCQkJCQkJewoJCQkJCQkJZm9ybWF0OiBSR0JBRm9ybWF0LAoJCQkJCQkJdHlwZTogVW5zaWduZWRCeXRlVHlwZSwKCQkJCQkJCWNvbG9yU3BhY2U6IHJlbmRlcmVyLm91dHB1dENvbG9yU3BhY2UsCgkJCQkJCQlzdGVuY2lsQnVmZmVyOiBhdHRyaWJ1dGVzLnN0ZW5jaWwKCQkJCQkJfQoJCQkJCSk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJbGV0IGRlcHRoRm9ybWF0ID0gbnVsbDsKCQkJCQlsZXQgZGVwdGhUeXBlID0gbnVsbDsKCQkJCQlsZXQgZ2xEZXB0aEZvcm1hdCA9IG51bGw7CgoJCQkJCWlmICggYXR0cmlidXRlcy5kZXB0aCApIHsKCgkJCQkJCWdsRGVwdGhGb3JtYXQgPSBhdHRyaWJ1dGVzLnN0ZW5jaWwgPyBnbC5ERVBUSDI0X1NURU5DSUw4IDogZ2wuREVQVEhfQ09NUE9ORU5UMjQ7CgkJCQkJCWRlcHRoRm9ybWF0ID0gYXR0cmlidXRlcy5zdGVuY2lsID8gRGVwdGhTdGVuY2lsRm9ybWF0IDogRGVwdGhGb3JtYXQ7CgkJCQkJCWRlcHRoVHlwZSA9IGF0dHJpYnV0ZXMuc3RlbmNpbCA/IFVuc2lnbmVkSW50MjQ4VHlwZSA6IFVuc2lnbmVkSW50VHlwZTsKCgkJCQkJfQoKCQkJCQljb25zdCBwcm9qZWN0aW9ubGF5ZXJJbml0ID0gewoJCQkJCQljb2xvckZvcm1hdDogZ2wuUkdCQTgsCgkJCQkJCWRlcHRoRm9ybWF0OiBnbERlcHRoRm9ybWF0LAoJCQkJCQlzY2FsZUZhY3RvcjogZnJhbWVidWZmZXJTY2FsZUZhY3RvcgoJCQkJCX07CgoJCQkJCWdsQmluZGluZyA9IG5ldyBYUldlYkdMQmluZGluZyggc2Vzc2lvbiwgZ2wgKTsKCgkJCQkJZ2xQcm9qTGF5ZXIgPSBnbEJpbmRpbmcuY3JlYXRlUHJvamVjdGlvbkxheWVyKCBwcm9qZWN0aW9ubGF5ZXJJbml0ICk7CgoJCQkJCXNlc3Npb24udXBkYXRlUmVuZGVyU3RhdGUoIHsgbGF5ZXJzOiBbIGdsUHJvakxheWVyIF0gfSApOwoKCQkJCQluZXdSZW5kZXJUYXJnZXQgPSBuZXcgV2ViR0xSZW5kZXJUYXJnZXQoCgkJCQkJCWdsUHJvakxheWVyLnRleHR1cmVXaWR0aCwKCQkJCQkJZ2xQcm9qTGF5ZXIudGV4dHVyZUhlaWdodCwKCQkJCQkJewoJCQkJCQkJZm9ybWF0OiBSR0JBRm9ybWF0LAoJCQkJCQkJdHlwZTogVW5zaWduZWRCeXRlVHlwZSwKCQkJCQkJCWRlcHRoVGV4dHVyZTogbmV3IERlcHRoVGV4dHVyZSggZ2xQcm9qTGF5ZXIudGV4dHVyZVdpZHRoLCBnbFByb2pMYXllci50ZXh0dXJlSGVpZ2h0LCBkZXB0aFR5cGUsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIHVuZGVmaW5lZCwgdW5kZWZpbmVkLCB1bmRlZmluZWQsIGRlcHRoRm9ybWF0ICksCgkJCQkJCQlzdGVuY2lsQnVmZmVyOiBhdHRyaWJ1dGVzLnN0ZW5jaWwsCgkJCQkJCQljb2xvclNwYWNlOiByZW5kZXJlci5vdXRwdXRDb2xvclNwYWNlLAoJCQkJCQkJc2FtcGxlczogYXR0cmlidXRlcy5hbnRpYWxpYXMgPyA0IDogMAoJCQkJCQl9ICk7CgoJCQkJCWNvbnN0IHJlbmRlclRhcmdldFByb3BlcnRpZXMgPSByZW5kZXJlci5wcm9wZXJ0aWVzLmdldCggbmV3UmVuZGVyVGFyZ2V0ICk7CgkJCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX2lnbm9yZURlcHRoVmFsdWVzID0gZ2xQcm9qTGF5ZXIuaWdub3JlRGVwdGhWYWx1ZXM7CgoJCQkJfQoKCQkJCW5ld1JlbmRlclRhcmdldC5pc1hSUmVuZGVyVGFyZ2V0ID0gdHJ1ZTsgLy8gVE9ETyBSZW1vdmUgdGhpcyB3aGVuIHBvc3NpYmxlLCBzZWUgIzIzMjc4CgoJCQkJdGhpcy5zZXRGb3ZlYXRpb24oIGZvdmVhdGlvbiApOwoKCQkJCWN1c3RvbVJlZmVyZW5jZVNwYWNlID0gbnVsbDsKCQkJCXJlZmVyZW5jZVNwYWNlID0gYXdhaXQgc2Vzc2lvbi5yZXF1ZXN0UmVmZXJlbmNlU3BhY2UoIHJlZmVyZW5jZVNwYWNlVHlwZSApOwoKCQkJCWFuaW1hdGlvbi5zZXRDb250ZXh0KCBzZXNzaW9uICk7CgkJCQlhbmltYXRpb24uc3RhcnQoKTsKCgkJCQlzY29wZS5pc1ByZXNlbnRpbmcgPSB0cnVlOwoKCQkJCXNjb3BlLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ3Nlc3Npb25zdGFydCcgfSApOwoKCQkJfQoKCQl9OwoKCQl0aGlzLmdldEVudmlyb25tZW50QmxlbmRNb2RlID0gZnVuY3Rpb24gKCkgewoKCQkJaWYgKCBzZXNzaW9uICE9PSBudWxsICkgewoKCQkJCXJldHVybiBzZXNzaW9uLmVudmlyb25tZW50QmxlbmRNb2RlOwoKCQkJfQoKCQl9OwoKCQlmdW5jdGlvbiBvbklucHV0U291cmNlc0NoYW5nZSggZXZlbnQgKSB7CgoJCQkvLyBOb3RpZnkgZGlzY29ubmVjdGVkCgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBldmVudC5yZW1vdmVkLmxlbmd0aDsgaSArKyApIHsKCgkJCQljb25zdCBpbnB1dFNvdXJjZSA9IGV2ZW50LnJlbW92ZWRbIGkgXTsKCQkJCWNvbnN0IGluZGV4ID0gY29udHJvbGxlcklucHV0U291cmNlcy5pbmRleE9mKCBpbnB1dFNvdXJjZSApOwoKCQkJCWlmICggaW5kZXggPj0gMCApIHsKCgkJCQkJY29udHJvbGxlcklucHV0U291cmNlc1sgaW5kZXggXSA9IG51bGw7CgkJCQkJY29udHJvbGxlcnNbIGluZGV4IF0uZGlzY29ubmVjdCggaW5wdXRTb3VyY2UgKTsKCgkJCQl9CgoJCQl9CgoJCQkvLyBOb3RpZnkgY29ubmVjdGVkCgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBldmVudC5hZGRlZC5sZW5ndGg7IGkgKysgKSB7CgoJCQkJY29uc3QgaW5wdXRTb3VyY2UgPSBldmVudC5hZGRlZFsgaSBdOwoKCQkJCWxldCBjb250cm9sbGVySW5kZXggPSBjb250cm9sbGVySW5wdXRTb3VyY2VzLmluZGV4T2YoIGlucHV0U291cmNlICk7CgoJCQkJaWYgKCBjb250cm9sbGVySW5kZXggPT09IC0gMSApIHsKCgkJCQkJLy8gQXNzaWduIGlucHV0IHNvdXJjZSBhIGNvbnRyb2xsZXIgdGhhdCBjdXJyZW50bHkgaGFzIG5vIGlucHV0IHNvdXJjZQoKCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBjb250cm9sbGVycy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCQlpZiAoIGkgPj0gY29udHJvbGxlcklucHV0U291cmNlcy5sZW5ndGggKSB7CgoJCQkJCQkJY29udHJvbGxlcklucHV0U291cmNlcy5wdXNoKCBpbnB1dFNvdXJjZSApOwoJCQkJCQkJY29udHJvbGxlckluZGV4ID0gaTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJfSBlbHNlIGlmICggY29udHJvbGxlcklucHV0U291cmNlc1sgaSBdID09PSBudWxsICkgewoKCQkJCQkJCWNvbnRyb2xsZXJJbnB1dFNvdXJjZXNbIGkgXSA9IGlucHV0U291cmNlOwoJCQkJCQkJY29udHJvbGxlckluZGV4ID0gaTsKCQkJCQkJCWJyZWFrOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCS8vIElmIGFsbCBjb250cm9sbGVycyBkbyBjdXJyZW50bHkgcmVjZWl2ZSBpbnB1dCB3ZSBpZ25vcmUgbmV3IG9uZXMKCgkJCQkJaWYgKCBjb250cm9sbGVySW5kZXggPT09IC0gMSApIGJyZWFrOwoKCQkJCX0KCgkJCQljb25zdCBjb250cm9sbGVyID0gY29udHJvbGxlcnNbIGNvbnRyb2xsZXJJbmRleCBdOwoKCQkJCWlmICggY29udHJvbGxlciApIHsKCgkJCQkJY29udHJvbGxlci5jb25uZWN0KCBpbnB1dFNvdXJjZSApOwoKCQkJCX0KCgkJCX0KCgkJfQoKCQkvLwoKCQljb25zdCBjYW1lcmFMUG9zID0gbmV3IFZlY3RvcjMoKTsKCQljb25zdCBjYW1lcmFSUG9zID0gbmV3IFZlY3RvcjMoKTsKCgkJLyoqCgkJICogQXNzdW1lcyAyIGNhbWVyYXMgdGhhdCBhcmUgcGFyYWxsZWwgYW5kIHNoYXJlIGFuIFgtYXhpcywgYW5kIHRoYXQKCQkgKiB0aGUgY2FtZXJhcycgcHJvamVjdGlvbiBhbmQgd29ybGQgbWF0cmljZXMgaGF2ZSBhbHJlYWR5IGJlZW4gc2V0LgoJCSAqIEFuZCB0aGF0IG5lYXIgYW5kIGZhciBwbGFuZXMgYXJlIGlkZW50aWNhbCBmb3IgYm90aCBjYW1lcmFzLgoJCSAqIFZpc3VhbGl6YXRpb24gb2YgdGhpcyB0ZWNobmlxdWU6IGh0dHBzOi8vY29tcHV0ZXJncmFwaGljcy5zdGFja2V4Y2hhbmdlLmNvbS9hLzQ3NjUKCQkgKi8KCQlmdW5jdGlvbiBzZXRQcm9qZWN0aW9uRnJvbVVuaW9uKCBjYW1lcmEsIGNhbWVyYUwsIGNhbWVyYVIgKSB7CgoJCQljYW1lcmFMUG9zLnNldEZyb21NYXRyaXhQb3NpdGlvbiggY2FtZXJhTC5tYXRyaXhXb3JsZCApOwoJCQljYW1lcmFSUG9zLnNldEZyb21NYXRyaXhQb3NpdGlvbiggY2FtZXJhUi5tYXRyaXhXb3JsZCApOwoKCQkJY29uc3QgaXBkID0gY2FtZXJhTFBvcy5kaXN0YW5jZVRvKCBjYW1lcmFSUG9zICk7CgoJCQljb25zdCBwcm9qTCA9IGNhbWVyYUwucHJvamVjdGlvbk1hdHJpeC5lbGVtZW50czsKCQkJY29uc3QgcHJvalIgPSBjYW1lcmFSLnByb2plY3Rpb25NYXRyaXguZWxlbWVudHM7CgoJCQkvLyBWUiBzeXN0ZW1zIHdpbGwgaGF2ZSBpZGVudGljYWwgZmFyIGFuZCBuZWFyIHBsYW5lcywgYW5kCgkJCS8vIG1vc3QgbGlrZWx5IGlkZW50aWNhbCB0b3AgYW5kIGJvdHRvbSBmcnVzdHVtIGV4dGVudHMuCgkJCS8vIFVzZSB0aGUgbGVmdCBjYW1lcmEgZm9yIHRoZXNlIHZhbHVlcy4KCQkJY29uc3QgbmVhciA9IHByb2pMWyAxNCBdIC8gKCBwcm9qTFsgMTAgXSAtIDEgKTsKCQkJY29uc3QgZmFyID0gcHJvakxbIDE0IF0gLyAoIHByb2pMWyAxMCBdICsgMSApOwoJCQljb25zdCB0b3BGb3YgPSAoIHByb2pMWyA5IF0gKyAxICkgLyBwcm9qTFsgNSBdOwoJCQljb25zdCBib3R0b21Gb3YgPSAoIHByb2pMWyA5IF0gLSAxICkgLyBwcm9qTFsgNSBdOwoKCQkJY29uc3QgbGVmdEZvdiA9ICggcHJvakxbIDggXSAtIDEgKSAvIHByb2pMWyAwIF07CgkJCWNvbnN0IHJpZ2h0Rm92ID0gKCBwcm9qUlsgOCBdICsgMSApIC8gcHJvalJbIDAgXTsKCQkJY29uc3QgbGVmdCA9IG5lYXIgKiBsZWZ0Rm92OwoJCQljb25zdCByaWdodCA9IG5lYXIgKiByaWdodEZvdjsKCgkJCS8vIENhbGN1bGF0ZSB0aGUgbmV3IGNhbWVyYSdzIHBvc2l0aW9uIG9mZnNldCBmcm9tIHRoZQoJCQkvLyBsZWZ0IGNhbWVyYS4geE9mZnNldCBzaG91bGQgYmUgcm91Z2hseSBoYWxmIGBpcGRgLgoJCQljb25zdCB6T2Zmc2V0ID0gaXBkIC8gKCAtIGxlZnRGb3YgKyByaWdodEZvdiApOwoJCQljb25zdCB4T2Zmc2V0ID0gek9mZnNldCAqIC0gbGVmdEZvdjsKCgkJCS8vIFRPRE86IEJldHRlciB3YXkgdG8gYXBwbHkgdGhpcyBvZmZzZXQ/CgkJCWNhbWVyYUwubWF0cml4V29ybGQuZGVjb21wb3NlKCBjYW1lcmEucG9zaXRpb24sIGNhbWVyYS5xdWF0ZXJuaW9uLCBjYW1lcmEuc2NhbGUgKTsKCQkJY2FtZXJhLnRyYW5zbGF0ZVgoIHhPZmZzZXQgKTsKCQkJY2FtZXJhLnRyYW5zbGF0ZVooIHpPZmZzZXQgKTsKCQkJY2FtZXJhLm1hdHJpeFdvcmxkLmNvbXBvc2UoIGNhbWVyYS5wb3NpdGlvbiwgY2FtZXJhLnF1YXRlcm5pb24sIGNhbWVyYS5zY2FsZSApOwoJCQljYW1lcmEubWF0cml4V29ybGRJbnZlcnNlLmNvcHkoIGNhbWVyYS5tYXRyaXhXb3JsZCApLmludmVydCgpOwoKCQkJLy8gRmluZCB0aGUgdW5pb24gb2YgdGhlIGZydXN0dW0gdmFsdWVzIG9mIHRoZSBjYW1lcmFzIGFuZCBzY2FsZQoJCQkvLyB0aGUgdmFsdWVzIHNvIHRoYXQgdGhlIG5lYXIgcGxhbmUncyBwb3NpdGlvbiBkb2VzIG5vdCBjaGFuZ2UgaW4gd29ybGQgc3BhY2UsCgkJCS8vIGFsdGhvdWdoIG11c3Qgbm93IGJlIHJlbGF0aXZlIHRvIHRoZSBuZXcgdW5pb24gY2FtZXJhLgoJCQljb25zdCBuZWFyMiA9IG5lYXIgKyB6T2Zmc2V0OwoJCQljb25zdCBmYXIyID0gZmFyICsgek9mZnNldDsKCQkJY29uc3QgbGVmdDIgPSBsZWZ0IC0geE9mZnNldDsKCQkJY29uc3QgcmlnaHQyID0gcmlnaHQgKyAoIGlwZCAtIHhPZmZzZXQgKTsKCQkJY29uc3QgdG9wMiA9IHRvcEZvdiAqIGZhciAvIGZhcjIgKiBuZWFyMjsKCQkJY29uc3QgYm90dG9tMiA9IGJvdHRvbUZvdiAqIGZhciAvIGZhcjIgKiBuZWFyMjsKCgkJCWNhbWVyYS5wcm9qZWN0aW9uTWF0cml4Lm1ha2VQZXJzcGVjdGl2ZSggbGVmdDIsIHJpZ2h0MiwgdG9wMiwgYm90dG9tMiwgbmVhcjIsIGZhcjIgKTsKCQkJY2FtZXJhLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlLmNvcHkoIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4ICkuaW52ZXJ0KCk7CgoJCX0KCgkJZnVuY3Rpb24gdXBkYXRlQ2FtZXJhKCBjYW1lcmEsIHBhcmVudCApIHsKCgkJCWlmICggcGFyZW50ID09PSBudWxsICkgewoKCQkJCWNhbWVyYS5tYXRyaXhXb3JsZC5jb3B5KCBjYW1lcmEubWF0cml4ICk7CgoJCQl9IGVsc2UgewoKCQkJCWNhbWVyYS5tYXRyaXhXb3JsZC5tdWx0aXBseU1hdHJpY2VzKCBwYXJlbnQubWF0cml4V29ybGQsIGNhbWVyYS5tYXRyaXggKTsKCgkJCX0KCgkJCWNhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UuY29weSggY2FtZXJhLm1hdHJpeFdvcmxkICkuaW52ZXJ0KCk7CgoJCX0KCgkJdGhpcy51cGRhdGVDYW1lcmEgPSBmdW5jdGlvbiAoIGNhbWVyYSApIHsKCgkJCWlmICggc2Vzc2lvbiA9PT0gbnVsbCApIHJldHVybjsKCgkJCWNhbWVyYVhSLm5lYXIgPSBjYW1lcmFSLm5lYXIgPSBjYW1lcmFMLm5lYXIgPSBjYW1lcmEubmVhcjsKCQkJY2FtZXJhWFIuZmFyID0gY2FtZXJhUi5mYXIgPSBjYW1lcmFMLmZhciA9IGNhbWVyYS5mYXI7CgoJCQlpZiAoIF9jdXJyZW50RGVwdGhOZWFyICE9PSBjYW1lcmFYUi5uZWFyIHx8IF9jdXJyZW50RGVwdGhGYXIgIT09IGNhbWVyYVhSLmZhciApIHsKCgkJCQkvLyBOb3RlIHRoYXQgdGhlIG5ldyByZW5kZXJTdGF0ZSB3b24ndCBhcHBseSB1bnRpbCB0aGUgbmV4dCBmcmFtZS4gU2VlICMxODMyMAoKCQkJCXNlc3Npb24udXBkYXRlUmVuZGVyU3RhdGUoIHsKCQkJCQlkZXB0aE5lYXI6IGNhbWVyYVhSLm5lYXIsCgkJCQkJZGVwdGhGYXI6IGNhbWVyYVhSLmZhcgoJCQkJfSApOwoKCQkJCV9jdXJyZW50RGVwdGhOZWFyID0gY2FtZXJhWFIubmVhcjsKCQkJCV9jdXJyZW50RGVwdGhGYXIgPSBjYW1lcmFYUi5mYXI7CgoJCQl9CgoJCQljb25zdCBwYXJlbnQgPSBjYW1lcmEucGFyZW50OwoJCQljb25zdCBjYW1lcmFzID0gY2FtZXJhWFIuY2FtZXJhczsKCgkJCXVwZGF0ZUNhbWVyYSggY2FtZXJhWFIsIHBhcmVudCApOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgY2FtZXJhcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJdXBkYXRlQ2FtZXJhKCBjYW1lcmFzWyBpIF0sIHBhcmVudCApOwoKCQkJfQoKCQkJLy8gdXBkYXRlIHByb2plY3Rpb24gbWF0cml4IGZvciBwcm9wZXIgdmlldyBmcnVzdHVtIGN1bGxpbmcKCgkJCWlmICggY2FtZXJhcy5sZW5ndGggPT09IDIgKSB7CgoJCQkJc2V0UHJvamVjdGlvbkZyb21VbmlvbiggY2FtZXJhWFIsIGNhbWVyYUwsIGNhbWVyYVIgKTsKCgkJCX0gZWxzZSB7CgoJCQkJLy8gYXNzdW1lIHNpbmdsZSBjYW1lcmEgc2V0dXAgKEFSKQoKCQkJCWNhbWVyYVhSLnByb2plY3Rpb25NYXRyaXguY29weSggY2FtZXJhTC5wcm9qZWN0aW9uTWF0cml4ICk7CgoJCQl9CgoJCQkvLyB1cGRhdGUgdXNlciBjYW1lcmEgYW5kIGl0cyBjaGlsZHJlbgoKCQkJdXBkYXRlVXNlckNhbWVyYSggY2FtZXJhLCBjYW1lcmFYUiwgcGFyZW50ICk7CgoJCX07CgoJCWZ1bmN0aW9uIHVwZGF0ZVVzZXJDYW1lcmEoIGNhbWVyYSwgY2FtZXJhWFIsIHBhcmVudCApIHsKCgkJCWlmICggcGFyZW50ID09PSBudWxsICkgewoKCQkJCWNhbWVyYS5tYXRyaXguY29weSggY2FtZXJhWFIubWF0cml4V29ybGQgKTsKCgkJCX0gZWxzZSB7CgoJCQkJY2FtZXJhLm1hdHJpeC5jb3B5KCBwYXJlbnQubWF0cml4V29ybGQgKTsKCQkJCWNhbWVyYS5tYXRyaXguaW52ZXJ0KCk7CgkJCQljYW1lcmEubWF0cml4Lm11bHRpcGx5KCBjYW1lcmFYUi5tYXRyaXhXb3JsZCApOwoKCQkJfQoKCQkJY2FtZXJhLm1hdHJpeC5kZWNvbXBvc2UoIGNhbWVyYS5wb3NpdGlvbiwgY2FtZXJhLnF1YXRlcm5pb24sIGNhbWVyYS5zY2FsZSApOwoJCQljYW1lcmEudXBkYXRlTWF0cml4V29ybGQoIHRydWUgKTsKCgkJCWNhbWVyYS5wcm9qZWN0aW9uTWF0cml4LmNvcHkoIGNhbWVyYVhSLnByb2plY3Rpb25NYXRyaXggKTsKCQkJY2FtZXJhLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlLmNvcHkoIGNhbWVyYVhSLnByb2plY3Rpb25NYXRyaXhJbnZlcnNlICk7CgoJCQlpZiAoIGNhbWVyYS5pc1BlcnNwZWN0aXZlQ2FtZXJhICkgewoKCQkJCWNhbWVyYS5mb3YgPSBSQUQyREVHICogMiAqIE1hdGguYXRhbiggMSAvIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4LmVsZW1lbnRzWyA1IF0gKTsKCQkJCWNhbWVyYS56b29tID0gMTsKCgkJCX0KCgkJfQoKCQl0aGlzLmdldENhbWVyYSA9IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBjYW1lcmFYUjsKCgkJfTsKCgkJdGhpcy5nZXRGb3ZlYXRpb24gPSBmdW5jdGlvbiAoKSB7CgoJCQlpZiAoIGdsUHJvakxheWVyID09PSBudWxsICYmIGdsQmFzZUxheWVyID09PSBudWxsICkgewoKCQkJCXJldHVybiB1bmRlZmluZWQ7CgoJCQl9CgoJCQlyZXR1cm4gZm92ZWF0aW9uOwoKCQl9OwoKCQl0aGlzLnNldEZvdmVhdGlvbiA9IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQkvLyAwID0gbm8gZm92ZWF0aW9uID0gZnVsbCByZXNvbHV0aW9uCgkJCS8vIDEgPSBtYXhpbXVtIGZvdmVhdGlvbiA9IHRoZSBlZGdlcyByZW5kZXIgYXQgbG93ZXIgcmVzb2x1dGlvbgoKCQkJZm92ZWF0aW9uID0gdmFsdWU7CgoJCQlpZiAoIGdsUHJvakxheWVyICE9PSBudWxsICkgewoKCQkJCWdsUHJvakxheWVyLmZpeGVkRm92ZWF0aW9uID0gdmFsdWU7CgoJCQl9CgoJCQlpZiAoIGdsQmFzZUxheWVyICE9PSBudWxsICYmIGdsQmFzZUxheWVyLmZpeGVkRm92ZWF0aW9uICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJZ2xCYXNlTGF5ZXIuZml4ZWRGb3ZlYXRpb24gPSB2YWx1ZTsKCgkJCX0KCgkJfTsKCgkJLy8gQW5pbWF0aW9uIExvb3AKCgkJbGV0IG9uQW5pbWF0aW9uRnJhbWVDYWxsYmFjayA9IG51bGw7CgoJCWZ1bmN0aW9uIG9uQW5pbWF0aW9uRnJhbWUoIHRpbWUsIGZyYW1lICkgewoKCQkJcG9zZSA9IGZyYW1lLmdldFZpZXdlclBvc2UoIGN1c3RvbVJlZmVyZW5jZVNwYWNlIHx8IHJlZmVyZW5jZVNwYWNlICk7CgkJCXhyRnJhbWUgPSBmcmFtZTsKCgkJCWlmICggcG9zZSAhPT0gbnVsbCApIHsKCgkJCQljb25zdCB2aWV3cyA9IHBvc2Uudmlld3M7CgoJCQkJaWYgKCBnbEJhc2VMYXllciAhPT0gbnVsbCApIHsKCgkJCQkJcmVuZGVyZXIuc2V0UmVuZGVyVGFyZ2V0RnJhbWVidWZmZXIoIG5ld1JlbmRlclRhcmdldCwgZ2xCYXNlTGF5ZXIuZnJhbWVidWZmZXIgKTsKCQkJCQlyZW5kZXJlci5zZXRSZW5kZXJUYXJnZXQoIG5ld1JlbmRlclRhcmdldCApOwoKCQkJCX0KCgkJCQlsZXQgY2FtZXJhWFJOZWVkc1VwZGF0ZSA9IGZhbHNlOwoKCQkJCS8vIGNoZWNrIGlmIGl0J3MgbmVjZXNzYXJ5IHRvIHJlYnVpbGQgY2FtZXJhWFIncyBjYW1lcmEgbGlzdAoKCQkJCWlmICggdmlld3MubGVuZ3RoICE9PSBjYW1lcmFYUi5jYW1lcmFzLmxlbmd0aCApIHsKCgkJCQkJY2FtZXJhWFIuY2FtZXJhcy5sZW5ndGggPSAwOwoJCQkJCWNhbWVyYVhSTmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCX0KCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB2aWV3cy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCWNvbnN0IHZpZXcgPSB2aWV3c1sgaSBdOwoKCQkJCQlsZXQgdmlld3BvcnQgPSBudWxsOwoKCQkJCQlpZiAoIGdsQmFzZUxheWVyICE9PSBudWxsICkgewoKCQkJCQkJdmlld3BvcnQgPSBnbEJhc2VMYXllci5nZXRWaWV3cG9ydCggdmlldyApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJY29uc3QgZ2xTdWJJbWFnZSA9IGdsQmluZGluZy5nZXRWaWV3U3ViSW1hZ2UoIGdsUHJvakxheWVyLCB2aWV3ICk7CgkJCQkJCXZpZXdwb3J0ID0gZ2xTdWJJbWFnZS52aWV3cG9ydDsKCgkJCQkJCS8vIEZvciBzaWRlLWJ5LXNpZGUgcHJvamVjdGlvbiwgd2Ugb25seSBwcm9kdWNlIGEgc2luZ2xlIHRleHR1cmUgZm9yIGJvdGggZXllcy4KCQkJCQkJaWYgKCBpID09PSAwICkgewoKCQkJCQkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldFRleHR1cmVzKAoJCQkJCQkJCW5ld1JlbmRlclRhcmdldCwKCQkJCQkJCQlnbFN1YkltYWdlLmNvbG9yVGV4dHVyZSwKCQkJCQkJCQlnbFByb2pMYXllci5pZ25vcmVEZXB0aFZhbHVlcyA/IHVuZGVmaW5lZCA6IGdsU3ViSW1hZ2UuZGVwdGhTdGVuY2lsVGV4dHVyZSApOwoKCQkJCQkJCXJlbmRlcmVyLnNldFJlbmRlclRhcmdldCggbmV3UmVuZGVyVGFyZ2V0ICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQkJbGV0IGNhbWVyYSA9IGNhbWVyYXNbIGkgXTsKCgkJCQkJaWYgKCBjYW1lcmEgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCWNhbWVyYSA9IG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSgpOwoJCQkJCQljYW1lcmEubGF5ZXJzLmVuYWJsZSggaSApOwoJCQkJCQljYW1lcmEudmlld3BvcnQgPSBuZXcgVmVjdG9yNCgpOwoJCQkJCQljYW1lcmFzWyBpIF0gPSBjYW1lcmE7CgoJCQkJCX0KCgkJCQkJY2FtZXJhLm1hdHJpeC5mcm9tQXJyYXkoIHZpZXcudHJhbnNmb3JtLm1hdHJpeCApOwoJCQkJCWNhbWVyYS5tYXRyaXguZGVjb21wb3NlKCBjYW1lcmEucG9zaXRpb24sIGNhbWVyYS5xdWF0ZXJuaW9uLCBjYW1lcmEuc2NhbGUgKTsKCQkJCQljYW1lcmEucHJvamVjdGlvbk1hdHJpeC5mcm9tQXJyYXkoIHZpZXcucHJvamVjdGlvbk1hdHJpeCApOwoJCQkJCWNhbWVyYS5wcm9qZWN0aW9uTWF0cml4SW52ZXJzZS5jb3B5KCBjYW1lcmEucHJvamVjdGlvbk1hdHJpeCApLmludmVydCgpOwoJCQkJCWNhbWVyYS52aWV3cG9ydC5zZXQoIHZpZXdwb3J0LngsIHZpZXdwb3J0LnksIHZpZXdwb3J0LndpZHRoLCB2aWV3cG9ydC5oZWlnaHQgKTsKCgkJCQkJaWYgKCBpID09PSAwICkgewoKCQkJCQkJY2FtZXJhWFIubWF0cml4LmNvcHkoIGNhbWVyYS5tYXRyaXggKTsKCQkJCQkJY2FtZXJhWFIubWF0cml4LmRlY29tcG9zZSggY2FtZXJhWFIucG9zaXRpb24sIGNhbWVyYVhSLnF1YXRlcm5pb24sIGNhbWVyYVhSLnNjYWxlICk7CgoJCQkJCX0KCgkJCQkJaWYgKCBjYW1lcmFYUk5lZWRzVXBkYXRlID09PSB0cnVlICkgewoKCQkJCQkJY2FtZXJhWFIuY2FtZXJhcy5wdXNoKCBjYW1lcmEgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgkJCS8vCgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBjb250cm9sbGVycy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJY29uc3QgaW5wdXRTb3VyY2UgPSBjb250cm9sbGVySW5wdXRTb3VyY2VzWyBpIF07CgkJCQljb25zdCBjb250cm9sbGVyID0gY29udHJvbGxlcnNbIGkgXTsKCgkJCQlpZiAoIGlucHV0U291cmNlICE9PSBudWxsICYmIGNvbnRyb2xsZXIgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJY29udHJvbGxlci51cGRhdGUoIGlucHV0U291cmNlLCBmcmFtZSwgY3VzdG9tUmVmZXJlbmNlU3BhY2UgfHwgcmVmZXJlbmNlU3BhY2UgKTsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIG9uQW5pbWF0aW9uRnJhbWVDYWxsYmFjayApIG9uQW5pbWF0aW9uRnJhbWVDYWxsYmFjayggdGltZSwgZnJhbWUgKTsKCgkJCWlmICggZnJhbWUuZGV0ZWN0ZWRQbGFuZXMgKSB7CgoJCQkJc2NvcGUuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAncGxhbmVzZGV0ZWN0ZWQnLCBkYXRhOiBmcmFtZSB9ICk7CgoJCQl9CgoJCQl4ckZyYW1lID0gbnVsbDsKCgkJfQoKCQljb25zdCBhbmltYXRpb24gPSBuZXcgV2ViR0xBbmltYXRpb24oKTsKCgkJYW5pbWF0aW9uLnNldEFuaW1hdGlvbkxvb3AoIG9uQW5pbWF0aW9uRnJhbWUgKTsKCgkJdGhpcy5zZXRBbmltYXRpb25Mb29wID0gZnVuY3Rpb24gKCBjYWxsYmFjayApIHsKCgkJCW9uQW5pbWF0aW9uRnJhbWVDYWxsYmFjayA9IGNhbGxiYWNrOwoKCQl9OwoKCQl0aGlzLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7fTsKCgl9Cgp9CgpmdW5jdGlvbiBXZWJHTE1hdGVyaWFscyggcmVuZGVyZXIsIHByb3BlcnRpZXMgKSB7CgoJZnVuY3Rpb24gcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hcCwgdW5pZm9ybSApIHsKCgkJaWYgKCBtYXAubWF0cml4QXV0b1VwZGF0ZSA9PT0gdHJ1ZSApIHsKCgkJCW1hcC51cGRhdGVNYXRyaXgoKTsKCgkJfQoKCQl1bmlmb3JtLnZhbHVlLmNvcHkoIG1hcC5tYXRyaXggKTsKCgl9CgoJZnVuY3Rpb24gcmVmcmVzaEZvZ1VuaWZvcm1zKCB1bmlmb3JtcywgZm9nICkgewoKCQlmb2cuY29sb3IuZ2V0UkdCKCB1bmlmb3Jtcy5mb2dDb2xvci52YWx1ZSwgZ2V0VW5saXRVbmlmb3JtQ29sb3JTcGFjZSggcmVuZGVyZXIgKSApOwoKCQlpZiAoIGZvZy5pc0ZvZyApIHsKCgkJCXVuaWZvcm1zLmZvZ05lYXIudmFsdWUgPSBmb2cubmVhcjsKCQkJdW5pZm9ybXMuZm9nRmFyLnZhbHVlID0gZm9nLmZhcjsKCgkJfSBlbHNlIGlmICggZm9nLmlzRm9nRXhwMiApIHsKCgkJCXVuaWZvcm1zLmZvZ0RlbnNpdHkudmFsdWUgPSBmb2cuZGVuc2l0eTsKCgkJfQoKCX0KCglmdW5jdGlvbiByZWZyZXNoTWF0ZXJpYWxVbmlmb3JtcyggdW5pZm9ybXMsIG1hdGVyaWFsLCBwaXhlbFJhdGlvLCBoZWlnaHQsIHRyYW5zbWlzc2lvblJlbmRlclRhcmdldCApIHsKCgkJaWYgKCBtYXRlcmlhbC5pc01lc2hCYXNpY01hdGVyaWFsICkgewoKCQkJcmVmcmVzaFVuaWZvcm1zQ29tbW9uKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCgkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNNZXNoTGFtYmVydE1hdGVyaWFsICkgewoKCQkJcmVmcmVzaFVuaWZvcm1zQ29tbW9uKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCgkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNNZXNoVG9vbk1hdGVyaWFsICkgewoKCQkJcmVmcmVzaFVuaWZvcm1zQ29tbW9uKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCQkJcmVmcmVzaFVuaWZvcm1zVG9vbiggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzTWVzaFBob25nTWF0ZXJpYWwgKSB7CgoJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoJCQlyZWZyZXNoVW5pZm9ybXNQaG9uZyggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzTWVzaFN0YW5kYXJkTWF0ZXJpYWwgKSB7CgoJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoJCQlyZWZyZXNoVW5pZm9ybXNTdGFuZGFyZCggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCQlpZiAoIG1hdGVyaWFsLmlzTWVzaFBoeXNpY2FsTWF0ZXJpYWwgKSB7CgoJCQkJcmVmcmVzaFVuaWZvcm1zUGh5c2ljYWwoIHVuaWZvcm1zLCBtYXRlcmlhbCwgdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ICk7CgoJCQl9CgoJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzTWVzaE1hdGNhcE1hdGVyaWFsICkgewoKCQkJcmVmcmVzaFVuaWZvcm1zQ29tbW9uKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCQkJcmVmcmVzaFVuaWZvcm1zTWF0Y2FwKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCgkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNNZXNoRGVwdGhNYXRlcmlhbCApIHsKCgkJCXJlZnJlc2hVbmlmb3Jtc0NvbW1vbiggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzTWVzaERpc3RhbmNlTWF0ZXJpYWwgKSB7CgoJCQlyZWZyZXNoVW5pZm9ybXNDb21tb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoJCQlyZWZyZXNoVW5pZm9ybXNEaXN0YW5jZSggdW5pZm9ybXMsIG1hdGVyaWFsICk7CgoJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzTWVzaE5vcm1hbE1hdGVyaWFsICkgewoKCQkJcmVmcmVzaFVuaWZvcm1zQ29tbW9uKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCgkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNMaW5lQmFzaWNNYXRlcmlhbCApIHsKCgkJCXJlZnJlc2hVbmlmb3Jtc0xpbmUoIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQkJaWYgKCBtYXRlcmlhbC5pc0xpbmVEYXNoZWRNYXRlcmlhbCApIHsKCgkJCQlyZWZyZXNoVW5pZm9ybXNEYXNoKCB1bmlmb3JtcywgbWF0ZXJpYWwgKTsKCgkJCX0KCgkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNQb2ludHNNYXRlcmlhbCApIHsKCgkJCXJlZnJlc2hVbmlmb3Jtc1BvaW50cyggdW5pZm9ybXMsIG1hdGVyaWFsLCBwaXhlbFJhdGlvLCBoZWlnaHQgKTsKCgkJfSBlbHNlIGlmICggbWF0ZXJpYWwuaXNTcHJpdGVNYXRlcmlhbCApIHsKCgkJCXJlZnJlc2hVbmlmb3Jtc1Nwcml0ZXMoIHVuaWZvcm1zLCBtYXRlcmlhbCApOwoKCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5pc1NoYWRvd01hdGVyaWFsICkgewoKCQkJdW5pZm9ybXMuY29sb3IudmFsdWUuY29weSggbWF0ZXJpYWwuY29sb3IgKTsKCQkJdW5pZm9ybXMub3BhY2l0eS52YWx1ZSA9IG1hdGVyaWFsLm9wYWNpdHk7CgoJCX0gZWxzZSBpZiAoIG1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgKSB7CgoJCQltYXRlcmlhbC51bmlmb3Jtc05lZWRVcGRhdGUgPSBmYWxzZTsgLy8gIzE1NTgxCgoJCX0KCgl9CgoJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zQ29tbW9uKCB1bmlmb3JtcywgbWF0ZXJpYWwgKSB7CgoJCXVuaWZvcm1zLm9wYWNpdHkudmFsdWUgPSBtYXRlcmlhbC5vcGFjaXR5OwoKCQlpZiAoIG1hdGVyaWFsLmNvbG9yICkgewoKCQkJdW5pZm9ybXMuZGlmZnVzZS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5jb2xvciApOwoKCQl9CgoJCWlmICggbWF0ZXJpYWwuZW1pc3NpdmUgKSB7CgoJCQl1bmlmb3Jtcy5lbWlzc2l2ZS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5lbWlzc2l2ZSApLm11bHRpcGx5U2NhbGFyKCBtYXRlcmlhbC5lbWlzc2l2ZUludGVuc2l0eSApOwoKCQl9CgoJCWlmICggbWF0ZXJpYWwubWFwICkgewoKCQkJdW5pZm9ybXMubWFwLnZhbHVlID0gbWF0ZXJpYWwubWFwOwoKCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLm1hcCwgdW5pZm9ybXMubWFwVHJhbnNmb3JtICk7CgoJCX0KCgkJaWYgKCBtYXRlcmlhbC5hbHBoYU1hcCApIHsKCgkJCXVuaWZvcm1zLmFscGhhTWFwLnZhbHVlID0gbWF0ZXJpYWwuYWxwaGFNYXA7CgoJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuYWxwaGFNYXAsIHVuaWZvcm1zLmFscGhhTWFwVHJhbnNmb3JtICk7CgoJCX0KCgkJaWYgKCBtYXRlcmlhbC5idW1wTWFwICkgewoKCQkJdW5pZm9ybXMuYnVtcE1hcC52YWx1ZSA9IG1hdGVyaWFsLmJ1bXBNYXA7CgoJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuYnVtcE1hcCwgdW5pZm9ybXMuYnVtcE1hcFRyYW5zZm9ybSApOwoKCQkJdW5pZm9ybXMuYnVtcFNjYWxlLnZhbHVlID0gbWF0ZXJpYWwuYnVtcFNjYWxlOwoKCQkJaWYgKCBtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSApIHsKCgkJCQl1bmlmb3Jtcy5idW1wU2NhbGUudmFsdWUgKj0gLSAxOwoKCQkJfQoKCQl9CgoJCWlmICggbWF0ZXJpYWwubm9ybWFsTWFwICkgewoKCQkJdW5pZm9ybXMubm9ybWFsTWFwLnZhbHVlID0gbWF0ZXJpYWwubm9ybWFsTWFwOwoKCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLm5vcm1hbE1hcCwgdW5pZm9ybXMubm9ybWFsTWFwVHJhbnNmb3JtICk7CgoJCQl1bmlmb3Jtcy5ub3JtYWxTY2FsZS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5ub3JtYWxTY2FsZSApOwoKCQkJaWYgKCBtYXRlcmlhbC5zaWRlID09PSBCYWNrU2lkZSApIHsKCgkJCQl1bmlmb3Jtcy5ub3JtYWxTY2FsZS52YWx1ZS5uZWdhdGUoKTsKCgkJCX0KCgkJfQoKCQlpZiAoIG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcCApIHsKCgkJCXVuaWZvcm1zLmRpc3BsYWNlbWVudE1hcC52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcDsKCgkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5kaXNwbGFjZW1lbnRNYXAsIHVuaWZvcm1zLmRpc3BsYWNlbWVudE1hcFRyYW5zZm9ybSApOwoKCQkJdW5pZm9ybXMuZGlzcGxhY2VtZW50U2NhbGUudmFsdWUgPSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRTY2FsZTsKCQkJdW5pZm9ybXMuZGlzcGxhY2VtZW50Qmlhcy52YWx1ZSA9IG1hdGVyaWFsLmRpc3BsYWNlbWVudEJpYXM7CgoJCX0KCgkJaWYgKCBtYXRlcmlhbC5lbWlzc2l2ZU1hcCApIHsKCgkJCXVuaWZvcm1zLmVtaXNzaXZlTWFwLnZhbHVlID0gbWF0ZXJpYWwuZW1pc3NpdmVNYXA7CgoJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuZW1pc3NpdmVNYXAsIHVuaWZvcm1zLmVtaXNzaXZlTWFwVHJhbnNmb3JtICk7CgoJCX0KCgkJaWYgKCBtYXRlcmlhbC5zcGVjdWxhck1hcCApIHsKCgkJCXVuaWZvcm1zLnNwZWN1bGFyTWFwLnZhbHVlID0gbWF0ZXJpYWwuc3BlY3VsYXJNYXA7CgoJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuc3BlY3VsYXJNYXAsIHVuaWZvcm1zLnNwZWN1bGFyTWFwVHJhbnNmb3JtICk7CgoJCX0KCgkJaWYgKCBtYXRlcmlhbC5hbHBoYVRlc3QgPiAwICkgewoKCQkJdW5pZm9ybXMuYWxwaGFUZXN0LnZhbHVlID0gbWF0ZXJpYWwuYWxwaGFUZXN0OwoKCQl9CgoJCWNvbnN0IGVudk1hcCA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApLmVudk1hcDsKCgkJaWYgKCBlbnZNYXAgKSB7CgoJCQl1bmlmb3Jtcy5lbnZNYXAudmFsdWUgPSBlbnZNYXA7CgoJCQl1bmlmb3Jtcy5mbGlwRW52TWFwLnZhbHVlID0gKCBlbnZNYXAuaXNDdWJlVGV4dHVyZSAmJiBlbnZNYXAuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID09PSBmYWxzZSApID8gLSAxIDogMTsKCgkJCXVuaWZvcm1zLnJlZmxlY3Rpdml0eS52YWx1ZSA9IG1hdGVyaWFsLnJlZmxlY3Rpdml0eTsKCQkJdW5pZm9ybXMuaW9yLnZhbHVlID0gbWF0ZXJpYWwuaW9yOwoJCQl1bmlmb3Jtcy5yZWZyYWN0aW9uUmF0aW8udmFsdWUgPSBtYXRlcmlhbC5yZWZyYWN0aW9uUmF0aW87CgoJCX0KCgkJaWYgKCBtYXRlcmlhbC5saWdodE1hcCApIHsKCgkJCXVuaWZvcm1zLmxpZ2h0TWFwLnZhbHVlID0gbWF0ZXJpYWwubGlnaHRNYXA7CgoJCQkvLyBhcnRpc3QtZnJpZW5kbHkgbGlnaHQgaW50ZW5zaXR5IHNjYWxpbmcgZmFjdG9yCgkJCWNvbnN0IHNjYWxlRmFjdG9yID0gKCByZW5kZXJlci5fdXNlTGVnYWN5TGlnaHRzID09PSB0cnVlICkgPyBNYXRoLlBJIDogMTsKCgkJCXVuaWZvcm1zLmxpZ2h0TWFwSW50ZW5zaXR5LnZhbHVlID0gbWF0ZXJpYWwubGlnaHRNYXBJbnRlbnNpdHkgKiBzY2FsZUZhY3RvcjsKCgkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5saWdodE1hcCwgdW5pZm9ybXMubGlnaHRNYXBUcmFuc2Zvcm0gKTsKCgkJfQoKCQlpZiAoIG1hdGVyaWFsLmFvTWFwICkgewoKCQkJdW5pZm9ybXMuYW9NYXAudmFsdWUgPSBtYXRlcmlhbC5hb01hcDsKCQkJdW5pZm9ybXMuYW9NYXBJbnRlbnNpdHkudmFsdWUgPSBtYXRlcmlhbC5hb01hcEludGVuc2l0eTsKCgkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5hb01hcCwgdW5pZm9ybXMuYW9NYXBUcmFuc2Zvcm0gKTsKCgkJfQoKCX0KCglmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNMaW5lKCB1bmlmb3JtcywgbWF0ZXJpYWwgKSB7CgoJCXVuaWZvcm1zLmRpZmZ1c2UudmFsdWUuY29weSggbWF0ZXJpYWwuY29sb3IgKTsKCQl1bmlmb3Jtcy5vcGFjaXR5LnZhbHVlID0gbWF0ZXJpYWwub3BhY2l0eTsKCgkJaWYgKCBtYXRlcmlhbC5tYXAgKSB7CgoJCQl1bmlmb3Jtcy5tYXAudmFsdWUgPSBtYXRlcmlhbC5tYXA7CgoJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwubWFwLCB1bmlmb3Jtcy5tYXBUcmFuc2Zvcm0gKTsKCgkJfQoKCX0KCglmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNEYXNoKCB1bmlmb3JtcywgbWF0ZXJpYWwgKSB7CgoJCXVuaWZvcm1zLmRhc2hTaXplLnZhbHVlID0gbWF0ZXJpYWwuZGFzaFNpemU7CgkJdW5pZm9ybXMudG90YWxTaXplLnZhbHVlID0gbWF0ZXJpYWwuZGFzaFNpemUgKyBtYXRlcmlhbC5nYXBTaXplOwoJCXVuaWZvcm1zLnNjYWxlLnZhbHVlID0gbWF0ZXJpYWwuc2NhbGU7CgoJfQoKCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc1BvaW50cyggdW5pZm9ybXMsIG1hdGVyaWFsLCBwaXhlbFJhdGlvLCBoZWlnaHQgKSB7CgoJCXVuaWZvcm1zLmRpZmZ1c2UudmFsdWUuY29weSggbWF0ZXJpYWwuY29sb3IgKTsKCQl1bmlmb3Jtcy5vcGFjaXR5LnZhbHVlID0gbWF0ZXJpYWwub3BhY2l0eTsKCQl1bmlmb3Jtcy5zaXplLnZhbHVlID0gbWF0ZXJpYWwuc2l6ZSAqIHBpeGVsUmF0aW87CgkJdW5pZm9ybXMuc2NhbGUudmFsdWUgPSBoZWlnaHQgKiAwLjU7CgoJCWlmICggbWF0ZXJpYWwubWFwICkgewoKCQkJdW5pZm9ybXMubWFwLnZhbHVlID0gbWF0ZXJpYWwubWFwOwoKCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLm1hcCwgdW5pZm9ybXMudXZUcmFuc2Zvcm0gKTsKCgkJfQoKCQlpZiAoIG1hdGVyaWFsLmFscGhhTWFwICkgewoKCQkJdW5pZm9ybXMuYWxwaGFNYXAudmFsdWUgPSBtYXRlcmlhbC5hbHBoYU1hcDsKCgkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5hbHBoYU1hcCwgdW5pZm9ybXMuYWxwaGFNYXBUcmFuc2Zvcm0gKTsKCgkJfQoKCQlpZiAoIG1hdGVyaWFsLmFscGhhVGVzdCA+IDAgKSB7CgoJCQl1bmlmb3Jtcy5hbHBoYVRlc3QudmFsdWUgPSBtYXRlcmlhbC5hbHBoYVRlc3Q7CgoJCX0KCgl9CgoJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zU3ByaXRlcyggdW5pZm9ybXMsIG1hdGVyaWFsICkgewoKCQl1bmlmb3Jtcy5kaWZmdXNlLnZhbHVlLmNvcHkoIG1hdGVyaWFsLmNvbG9yICk7CgkJdW5pZm9ybXMub3BhY2l0eS52YWx1ZSA9IG1hdGVyaWFsLm9wYWNpdHk7CgkJdW5pZm9ybXMucm90YXRpb24udmFsdWUgPSBtYXRlcmlhbC5yb3RhdGlvbjsKCgkJaWYgKCBtYXRlcmlhbC5tYXAgKSB7CgoJCQl1bmlmb3Jtcy5tYXAudmFsdWUgPSBtYXRlcmlhbC5tYXA7CgoJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwubWFwLCB1bmlmb3Jtcy5tYXBUcmFuc2Zvcm0gKTsKCgkJfQoKCQlpZiAoIG1hdGVyaWFsLmFscGhhTWFwICkgewoKCQkJdW5pZm9ybXMuYWxwaGFNYXAudmFsdWUgPSBtYXRlcmlhbC5hbHBoYU1hcDsKCgkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5hbHBoYU1hcCwgdW5pZm9ybXMuYWxwaGFNYXBUcmFuc2Zvcm0gKTsKCgkJfQoKCQlpZiAoIG1hdGVyaWFsLmFscGhhVGVzdCA+IDAgKSB7CgoJCQl1bmlmb3Jtcy5hbHBoYVRlc3QudmFsdWUgPSBtYXRlcmlhbC5hbHBoYVRlc3Q7CgoJCX0KCgl9CgoJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zUGhvbmcoIHVuaWZvcm1zLCBtYXRlcmlhbCApIHsKCgkJdW5pZm9ybXMuc3BlY3VsYXIudmFsdWUuY29weSggbWF0ZXJpYWwuc3BlY3VsYXIgKTsKCQl1bmlmb3Jtcy5zaGluaW5lc3MudmFsdWUgPSBNYXRoLm1heCggbWF0ZXJpYWwuc2hpbmluZXNzLCAxZS00ICk7IC8vIHRvIHByZXZlbnQgcG93KCAwLjAsIDAuMCApCgoJfQoKCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc1Rvb24oIHVuaWZvcm1zLCBtYXRlcmlhbCApIHsKCgkJaWYgKCBtYXRlcmlhbC5ncmFkaWVudE1hcCApIHsKCgkJCXVuaWZvcm1zLmdyYWRpZW50TWFwLnZhbHVlID0gbWF0ZXJpYWwuZ3JhZGllbnRNYXA7CgoJCX0KCgl9CgoJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zU3RhbmRhcmQoIHVuaWZvcm1zLCBtYXRlcmlhbCApIHsKCgkJdW5pZm9ybXMubWV0YWxuZXNzLnZhbHVlID0gbWF0ZXJpYWwubWV0YWxuZXNzOwoKCQlpZiAoIG1hdGVyaWFsLm1ldGFsbmVzc01hcCApIHsKCgkJCXVuaWZvcm1zLm1ldGFsbmVzc01hcC52YWx1ZSA9IG1hdGVyaWFsLm1ldGFsbmVzc01hcDsKCgkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5tZXRhbG5lc3NNYXAsIHVuaWZvcm1zLm1ldGFsbmVzc01hcFRyYW5zZm9ybSApOwoKCQl9CgoJCXVuaWZvcm1zLnJvdWdobmVzcy52YWx1ZSA9IG1hdGVyaWFsLnJvdWdobmVzczsKCgkJaWYgKCBtYXRlcmlhbC5yb3VnaG5lc3NNYXAgKSB7CgoJCQl1bmlmb3Jtcy5yb3VnaG5lc3NNYXAudmFsdWUgPSBtYXRlcmlhbC5yb3VnaG5lc3NNYXA7CgoJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwucm91Z2huZXNzTWFwLCB1bmlmb3Jtcy5yb3VnaG5lc3NNYXBUcmFuc2Zvcm0gKTsKCgkJfQoKCQljb25zdCBlbnZNYXAgPSBwcm9wZXJ0aWVzLmdldCggbWF0ZXJpYWwgKS5lbnZNYXA7CgoJCWlmICggZW52TWFwICkgewoKCQkJLy91bmlmb3Jtcy5lbnZNYXAudmFsdWUgPSBtYXRlcmlhbC5lbnZNYXA7IC8vIHBhcnQgb2YgdW5pZm9ybXMgY29tbW9uCgkJCXVuaWZvcm1zLmVudk1hcEludGVuc2l0eS52YWx1ZSA9IG1hdGVyaWFsLmVudk1hcEludGVuc2l0eTsKCgkJfQoKCX0KCglmdW5jdGlvbiByZWZyZXNoVW5pZm9ybXNQaHlzaWNhbCggdW5pZm9ybXMsIG1hdGVyaWFsLCB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQgKSB7CgoJCXVuaWZvcm1zLmlvci52YWx1ZSA9IG1hdGVyaWFsLmlvcjsgLy8gYWxzbyBwYXJ0IG9mIHVuaWZvcm1zIGNvbW1vbgoKCQlpZiAoIG1hdGVyaWFsLnNoZWVuID4gMCApIHsKCgkJCXVuaWZvcm1zLnNoZWVuQ29sb3IudmFsdWUuY29weSggbWF0ZXJpYWwuc2hlZW5Db2xvciApLm11bHRpcGx5U2NhbGFyKCBtYXRlcmlhbC5zaGVlbiApOwoKCQkJdW5pZm9ybXMuc2hlZW5Sb3VnaG5lc3MudmFsdWUgPSBtYXRlcmlhbC5zaGVlblJvdWdobmVzczsKCgkJCWlmICggbWF0ZXJpYWwuc2hlZW5Db2xvck1hcCApIHsKCgkJCQl1bmlmb3Jtcy5zaGVlbkNvbG9yTWFwLnZhbHVlID0gbWF0ZXJpYWwuc2hlZW5Db2xvck1hcDsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuc2hlZW5Db2xvck1hcCwgdW5pZm9ybXMuc2hlZW5Db2xvck1hcFRyYW5zZm9ybSApOwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5zaGVlblJvdWdobmVzc01hcCApIHsKCgkJCQl1bmlmb3Jtcy5zaGVlblJvdWdobmVzc01hcC52YWx1ZSA9IG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzTWFwOwoKCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5zaGVlblJvdWdobmVzc01hcCwgdW5pZm9ybXMuc2hlZW5Sb3VnaG5lc3NNYXBUcmFuc2Zvcm0gKTsKCgkJCX0KCgkJfQoKCQlpZiAoIG1hdGVyaWFsLmNsZWFyY29hdCA+IDAgKSB7CgoJCQl1bmlmb3Jtcy5jbGVhcmNvYXQudmFsdWUgPSBtYXRlcmlhbC5jbGVhcmNvYXQ7CgkJCXVuaWZvcm1zLmNsZWFyY29hdFJvdWdobmVzcy52YWx1ZSA9IG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzczsKCgkJCWlmICggbWF0ZXJpYWwuY2xlYXJjb2F0TWFwICkgewoKCQkJCXVuaWZvcm1zLmNsZWFyY29hdE1hcC52YWx1ZSA9IG1hdGVyaWFsLmNsZWFyY29hdE1hcDsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuY2xlYXJjb2F0TWFwLCB1bmlmb3Jtcy5jbGVhcmNvYXRNYXBUcmFuc2Zvcm0gKTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzTWFwICkgewoKCQkJCXVuaWZvcm1zLmNsZWFyY29hdFJvdWdobmVzc01hcC52YWx1ZSA9IG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzc01hcDsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuY2xlYXJjb2F0Um91Z2huZXNzTWFwLCB1bmlmb3Jtcy5jbGVhcmNvYXRSb3VnaG5lc3NNYXBUcmFuc2Zvcm0gKTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuY2xlYXJjb2F0Tm9ybWFsTWFwICkgewoKCQkJCXVuaWZvcm1zLmNsZWFyY29hdE5vcm1hbE1hcC52YWx1ZSA9IG1hdGVyaWFsLmNsZWFyY29hdE5vcm1hbE1hcDsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuY2xlYXJjb2F0Tm9ybWFsTWFwLCB1bmlmb3Jtcy5jbGVhcmNvYXROb3JtYWxNYXBUcmFuc2Zvcm0gKTsKCgkJCQl1bmlmb3Jtcy5jbGVhcmNvYXROb3JtYWxTY2FsZS52YWx1ZS5jb3B5KCBtYXRlcmlhbC5jbGVhcmNvYXROb3JtYWxTY2FsZSApOwoKCQkJCWlmICggbWF0ZXJpYWwuc2lkZSA9PT0gQmFja1NpZGUgKSB7CgoJCQkJCXVuaWZvcm1zLmNsZWFyY29hdE5vcm1hbFNjYWxlLnZhbHVlLm5lZ2F0ZSgpOwoKCQkJCX0KCgkJCX0KCgkJfQoKCQlpZiAoIG1hdGVyaWFsLmlyaWRlc2NlbmNlID4gMCApIHsKCgkJCXVuaWZvcm1zLmlyaWRlc2NlbmNlLnZhbHVlID0gbWF0ZXJpYWwuaXJpZGVzY2VuY2U7CgkJCXVuaWZvcm1zLmlyaWRlc2NlbmNlSU9SLnZhbHVlID0gbWF0ZXJpYWwuaXJpZGVzY2VuY2VJT1I7CgkJCXVuaWZvcm1zLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWluaW11bS52YWx1ZSA9IG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzUmFuZ2VbIDAgXTsKCQkJdW5pZm9ybXMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXhpbXVtLnZhbHVlID0gbWF0ZXJpYWwuaXJpZGVzY2VuY2VUaGlja25lc3NSYW5nZVsgMSBdOwoKCQkJaWYgKCBtYXRlcmlhbC5pcmlkZXNjZW5jZU1hcCApIHsKCgkJCQl1bmlmb3Jtcy5pcmlkZXNjZW5jZU1hcC52YWx1ZSA9IG1hdGVyaWFsLmlyaWRlc2NlbmNlTWFwOwoKCQkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5pcmlkZXNjZW5jZU1hcCwgdW5pZm9ybXMuaXJpZGVzY2VuY2VNYXBUcmFuc2Zvcm0gKTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAgKSB7CgoJCQkJdW5pZm9ybXMuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAudmFsdWUgPSBtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcDsKCgkJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuaXJpZGVzY2VuY2VUaGlja25lc3NNYXAsIHVuaWZvcm1zLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwVHJhbnNmb3JtICk7CgoJCQl9CgoJCX0KCgkJaWYgKCBtYXRlcmlhbC50cmFuc21pc3Npb24gPiAwICkgewoKCQkJdW5pZm9ybXMudHJhbnNtaXNzaW9uLnZhbHVlID0gbWF0ZXJpYWwudHJhbnNtaXNzaW9uOwoJCQl1bmlmb3Jtcy50cmFuc21pc3Npb25TYW1wbGVyTWFwLnZhbHVlID0gdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0LnRleHR1cmU7CgkJCXVuaWZvcm1zLnRyYW5zbWlzc2lvblNhbXBsZXJTaXplLnZhbHVlLnNldCggdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0LndpZHRoLCB0cmFuc21pc3Npb25SZW5kZXJUYXJnZXQuaGVpZ2h0ICk7CgoJCQlpZiAoIG1hdGVyaWFsLnRyYW5zbWlzc2lvbk1hcCApIHsKCgkJCQl1bmlmb3Jtcy50cmFuc21pc3Npb25NYXAudmFsdWUgPSBtYXRlcmlhbC50cmFuc21pc3Npb25NYXA7CgoJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLnRyYW5zbWlzc2lvbk1hcCwgdW5pZm9ybXMudHJhbnNtaXNzaW9uTWFwVHJhbnNmb3JtICk7CgoJCQl9CgoJCQl1bmlmb3Jtcy50aGlja25lc3MudmFsdWUgPSBtYXRlcmlhbC50aGlja25lc3M7CgoJCQlpZiAoIG1hdGVyaWFsLnRoaWNrbmVzc01hcCApIHsKCgkJCQl1bmlmb3Jtcy50aGlja25lc3NNYXAudmFsdWUgPSBtYXRlcmlhbC50aGlja25lc3NNYXA7CgoJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLnRoaWNrbmVzc01hcCwgdW5pZm9ybXMudGhpY2tuZXNzTWFwVHJhbnNmb3JtICk7CgoJCQl9CgoJCQl1bmlmb3Jtcy5hdHRlbnVhdGlvbkRpc3RhbmNlLnZhbHVlID0gbWF0ZXJpYWwuYXR0ZW51YXRpb25EaXN0YW5jZTsKCQkJdW5pZm9ybXMuYXR0ZW51YXRpb25Db2xvci52YWx1ZS5jb3B5KCBtYXRlcmlhbC5hdHRlbnVhdGlvbkNvbG9yICk7CgoJCX0KCgkJaWYgKCBtYXRlcmlhbC5hbmlzb3Ryb3B5ID4gMCApIHsKCgkJCXVuaWZvcm1zLmFuaXNvdHJvcHlWZWN0b3IudmFsdWUuc2V0KCBtYXRlcmlhbC5hbmlzb3Ryb3B5ICogTWF0aC5jb3MoIG1hdGVyaWFsLmFuaXNvdHJvcHlSb3RhdGlvbiApLCBtYXRlcmlhbC5hbmlzb3Ryb3B5ICogTWF0aC5zaW4oIG1hdGVyaWFsLmFuaXNvdHJvcHlSb3RhdGlvbiApICk7CgoJCQlpZiAoIG1hdGVyaWFsLmFuaXNvdHJvcHlNYXAgKSB7CgoJCQkJdW5pZm9ybXMuYW5pc290cm9weU1hcC52YWx1ZSA9IG1hdGVyaWFsLmFuaXNvdHJvcHlNYXA7CgoJCQkJcmVmcmVzaFRyYW5zZm9ybVVuaWZvcm0oIG1hdGVyaWFsLmFuaXNvdHJvcHlNYXAsIHVuaWZvcm1zLmFuaXNvdHJvcHlNYXBUcmFuc2Zvcm0gKTsKCgkJCX0KCgkJfQoKCQl1bmlmb3Jtcy5zcGVjdWxhckludGVuc2l0eS52YWx1ZSA9IG1hdGVyaWFsLnNwZWN1bGFySW50ZW5zaXR5OwoJCXVuaWZvcm1zLnNwZWN1bGFyQ29sb3IudmFsdWUuY29weSggbWF0ZXJpYWwuc3BlY3VsYXJDb2xvciApOwoKCQlpZiAoIG1hdGVyaWFsLnNwZWN1bGFyQ29sb3JNYXAgKSB7CgoJCQl1bmlmb3Jtcy5zcGVjdWxhckNvbG9yTWFwLnZhbHVlID0gbWF0ZXJpYWwuc3BlY3VsYXJDb2xvck1hcDsKCgkJCXJlZnJlc2hUcmFuc2Zvcm1Vbmlmb3JtKCBtYXRlcmlhbC5zcGVjdWxhckNvbG9yTWFwLCB1bmlmb3Jtcy5zcGVjdWxhckNvbG9yTWFwVHJhbnNmb3JtICk7CgoJCX0KCgkJaWYgKCBtYXRlcmlhbC5zcGVjdWxhckludGVuc2l0eU1hcCApIHsKCgkJCXVuaWZvcm1zLnNwZWN1bGFySW50ZW5zaXR5TWFwLnZhbHVlID0gbWF0ZXJpYWwuc3BlY3VsYXJJbnRlbnNpdHlNYXA7CgoJCQlyZWZyZXNoVHJhbnNmb3JtVW5pZm9ybSggbWF0ZXJpYWwuc3BlY3VsYXJJbnRlbnNpdHlNYXAsIHVuaWZvcm1zLnNwZWN1bGFySW50ZW5zaXR5TWFwVHJhbnNmb3JtICk7CgoJCX0KCgl9CgoJZnVuY3Rpb24gcmVmcmVzaFVuaWZvcm1zTWF0Y2FwKCB1bmlmb3JtcywgbWF0ZXJpYWwgKSB7CgoJCWlmICggbWF0ZXJpYWwubWF0Y2FwICkgewoKCQkJdW5pZm9ybXMubWF0Y2FwLnZhbHVlID0gbWF0ZXJpYWwubWF0Y2FwOwoKCQl9CgoJfQoKCWZ1bmN0aW9uIHJlZnJlc2hVbmlmb3Jtc0Rpc3RhbmNlKCB1bmlmb3JtcywgbWF0ZXJpYWwgKSB7CgoJCWNvbnN0IGxpZ2h0ID0gcHJvcGVydGllcy5nZXQoIG1hdGVyaWFsICkubGlnaHQ7CgoJCXVuaWZvcm1zLnJlZmVyZW5jZVBvc2l0aW9uLnZhbHVlLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQubWF0cml4V29ybGQgKTsKCQl1bmlmb3Jtcy5uZWFyRGlzdGFuY2UudmFsdWUgPSBsaWdodC5zaGFkb3cuY2FtZXJhLm5lYXI7CgkJdW5pZm9ybXMuZmFyRGlzdGFuY2UudmFsdWUgPSBsaWdodC5zaGFkb3cuY2FtZXJhLmZhcjsKCgl9CgoJcmV0dXJuIHsKCQlyZWZyZXNoRm9nVW5pZm9ybXM6IHJlZnJlc2hGb2dVbmlmb3JtcywKCQlyZWZyZXNoTWF0ZXJpYWxVbmlmb3JtczogcmVmcmVzaE1hdGVyaWFsVW5pZm9ybXMKCX07Cgp9CgpmdW5jdGlvbiBXZWJHTFVuaWZvcm1zR3JvdXBzKCBnbCwgaW5mbywgY2FwYWJpbGl0aWVzLCBzdGF0ZSApIHsKCglsZXQgYnVmZmVycyA9IHt9OwoJbGV0IHVwZGF0ZUxpc3QgPSB7fTsKCWxldCBhbGxvY2F0ZWRCaW5kaW5nUG9pbnRzID0gW107CgoJY29uc3QgbWF4QmluZGluZ1BvaW50cyA9ICggY2FwYWJpbGl0aWVzLmlzV2ViR0wyICkgPyBnbC5nZXRQYXJhbWV0ZXIoIGdsLk1BWF9VTklGT1JNX0JVRkZFUl9CSU5ESU5HUyApIDogMDsgLy8gYmluZGluZyBwb2ludHMgYXJlIGdsb2JhbCB3aGVyZWFzIGJsb2NrIGluZGljZXMgYXJlIHBlciBzaGFkZXIgcHJvZ3JhbQoKCWZ1bmN0aW9uIGJpbmQoIHVuaWZvcm1zR3JvdXAsIHByb2dyYW0gKSB7CgoJCWNvbnN0IHdlYmdsUHJvZ3JhbSA9IHByb2dyYW0ucHJvZ3JhbTsKCQlzdGF0ZS51bmlmb3JtQmxvY2tCaW5kaW5nKCB1bmlmb3Jtc0dyb3VwLCB3ZWJnbFByb2dyYW0gKTsKCgl9CgoJZnVuY3Rpb24gdXBkYXRlKCB1bmlmb3Jtc0dyb3VwLCBwcm9ncmFtICkgewoKCQlsZXQgYnVmZmVyID0gYnVmZmVyc1sgdW5pZm9ybXNHcm91cC5pZCBdOwoKCQlpZiAoIGJ1ZmZlciA9PT0gdW5kZWZpbmVkICkgewoKCQkJcHJlcGFyZVVuaWZvcm1zR3JvdXAoIHVuaWZvcm1zR3JvdXAgKTsKCgkJCWJ1ZmZlciA9IGNyZWF0ZUJ1ZmZlciggdW5pZm9ybXNHcm91cCApOwoJCQlidWZmZXJzWyB1bmlmb3Jtc0dyb3VwLmlkIF0gPSBidWZmZXI7CgoJCQl1bmlmb3Jtc0dyb3VwLmFkZEV2ZW50TGlzdGVuZXIoICdkaXNwb3NlJywgb25Vbmlmb3Jtc0dyb3Vwc0Rpc3Bvc2UgKTsKCgkJfQoKCQkvLyBlbnN1cmUgdG8gdXBkYXRlIHRoZSBiaW5kaW5nIHBvaW50cy9ibG9jayBpbmRpY2VzIG1hcHBpbmcgZm9yIHRoaXMgcHJvZ3JhbQoKCQljb25zdCB3ZWJnbFByb2dyYW0gPSBwcm9ncmFtLnByb2dyYW07CgkJc3RhdGUudXBkYXRlVUJPTWFwcGluZyggdW5pZm9ybXNHcm91cCwgd2ViZ2xQcm9ncmFtICk7CgoJCS8vIHVwZGF0ZSBVQk8gb25jZSBwZXIgZnJhbWUKCgkJY29uc3QgZnJhbWUgPSBpbmZvLnJlbmRlci5mcmFtZTsKCgkJaWYgKCB1cGRhdGVMaXN0WyB1bmlmb3Jtc0dyb3VwLmlkIF0gIT09IGZyYW1lICkgewoKCQkJdXBkYXRlQnVmZmVyRGF0YSggdW5pZm9ybXNHcm91cCApOwoKCQkJdXBkYXRlTGlzdFsgdW5pZm9ybXNHcm91cC5pZCBdID0gZnJhbWU7CgoJCX0KCgl9CgoJZnVuY3Rpb24gY3JlYXRlQnVmZmVyKCB1bmlmb3Jtc0dyb3VwICkgewoKCQkvLyB0aGUgc2V0dXAgb2YgYW4gVUJPIGlzIGluZGVwZW5kZW50IG9mIGEgcGFydGljdWxhciBzaGFkZXIgcHJvZ3JhbSBidXQgZ2xvYmFsCgoJCWNvbnN0IGJpbmRpbmdQb2ludEluZGV4ID0gYWxsb2NhdGVCaW5kaW5nUG9pbnRJbmRleCgpOwoJCXVuaWZvcm1zR3JvdXAuX19iaW5kaW5nUG9pbnRJbmRleCA9IGJpbmRpbmdQb2ludEluZGV4OwoKCQljb25zdCBidWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTsKCQljb25zdCBzaXplID0gdW5pZm9ybXNHcm91cC5fX3NpemU7CgkJY29uc3QgdXNhZ2UgPSB1bmlmb3Jtc0dyb3VwLnVzYWdlOwoKCQlnbC5iaW5kQnVmZmVyKCBnbC5VTklGT1JNX0JVRkZFUiwgYnVmZmVyICk7CgkJZ2wuYnVmZmVyRGF0YSggZ2wuVU5JRk9STV9CVUZGRVIsIHNpemUsIHVzYWdlICk7CgkJZ2wuYmluZEJ1ZmZlciggZ2wuVU5JRk9STV9CVUZGRVIsIG51bGwgKTsKCQlnbC5iaW5kQnVmZmVyQmFzZSggZ2wuVU5JRk9STV9CVUZGRVIsIGJpbmRpbmdQb2ludEluZGV4LCBidWZmZXIgKTsKCgkJcmV0dXJuIGJ1ZmZlcjsKCgl9CgoJZnVuY3Rpb24gYWxsb2NhdGVCaW5kaW5nUG9pbnRJbmRleCgpIHsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgbWF4QmluZGluZ1BvaW50czsgaSArKyApIHsKCgkJCWlmICggYWxsb2NhdGVkQmluZGluZ1BvaW50cy5pbmRleE9mKCBpICkgPT09IC0gMSApIHsKCgkJCQlhbGxvY2F0ZWRCaW5kaW5nUG9pbnRzLnB1c2goIGkgKTsKCQkJCXJldHVybiBpOwoKCQkJfQoKCQl9CgoJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBNYXhpbXVtIG51bWJlciBvZiBzaW11bHRhbmVvdXNseSB1c2FibGUgdW5pZm9ybXMgZ3JvdXBzIHJlYWNoZWQuJyApOwoKCQlyZXR1cm4gMDsKCgl9CgoJZnVuY3Rpb24gdXBkYXRlQnVmZmVyRGF0YSggdW5pZm9ybXNHcm91cCApIHsKCgkJY29uc3QgYnVmZmVyID0gYnVmZmVyc1sgdW5pZm9ybXNHcm91cC5pZCBdOwoJCWNvbnN0IHVuaWZvcm1zID0gdW5pZm9ybXNHcm91cC51bmlmb3JtczsKCQljb25zdCBjYWNoZSA9IHVuaWZvcm1zR3JvdXAuX19jYWNoZTsKCgkJZ2wuYmluZEJ1ZmZlciggZ2wuVU5JRk9STV9CVUZGRVIsIGJ1ZmZlciApOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gdW5pZm9ybXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQljb25zdCB1bmlmb3JtID0gdW5pZm9ybXNbIGkgXTsKCgkJCS8vIHBhcnRseSB1cGRhdGUgdGhlIGJ1ZmZlciBpZiBuZWNlc3NhcnkKCgkJCWlmICggaGFzVW5pZm9ybUNoYW5nZWQoIHVuaWZvcm0sIGksIGNhY2hlICkgPT09IHRydWUgKSB7CgoJCQkJY29uc3Qgb2Zmc2V0ID0gdW5pZm9ybS5fX29mZnNldDsKCgkJCQljb25zdCB2YWx1ZXMgPSBBcnJheS5pc0FycmF5KCB1bmlmb3JtLnZhbHVlICkgPyB1bmlmb3JtLnZhbHVlIDogWyB1bmlmb3JtLnZhbHVlIF07CgoJCQkJbGV0IGFycmF5T2Zmc2V0ID0gMDsKCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB2YWx1ZXMubGVuZ3RoOyBpICsrICkgewoKCQkJCQljb25zdCB2YWx1ZSA9IHZhbHVlc1sgaSBdOwoKCQkJCQljb25zdCBpbmZvID0gZ2V0VW5pZm9ybVNpemUoIHZhbHVlICk7CgoJCQkJCWlmICggdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyApIHsKCgkJCQkJCXVuaWZvcm0uX19kYXRhWyAwIF0gPSB2YWx1ZTsKCQkJCQkJZ2wuYnVmZmVyU3ViRGF0YSggZ2wuVU5JRk9STV9CVUZGRVIsIG9mZnNldCArIGFycmF5T2Zmc2V0LCB1bmlmb3JtLl9fZGF0YSApOwoKCQkJCQl9IGVsc2UgaWYgKCB2YWx1ZS5pc01hdHJpeDMgKSB7CgoJCQkJCQkvLyBtYW51YWxseSBjb252ZXJ0aW5nIDN4MyB0byAzeDQKCgkJCQkJCXVuaWZvcm0uX19kYXRhWyAwIF0gPSB2YWx1ZS5lbGVtZW50c1sgMCBdOwoJCQkJCQl1bmlmb3JtLl9fZGF0YVsgMSBdID0gdmFsdWUuZWxlbWVudHNbIDEgXTsKCQkJCQkJdW5pZm9ybS5fX2RhdGFbIDIgXSA9IHZhbHVlLmVsZW1lbnRzWyAyIF07CgkJCQkJCXVuaWZvcm0uX19kYXRhWyAzIF0gPSB2YWx1ZS5lbGVtZW50c1sgMCBdOwoJCQkJCQl1bmlmb3JtLl9fZGF0YVsgNCBdID0gdmFsdWUuZWxlbWVudHNbIDMgXTsKCQkJCQkJdW5pZm9ybS5fX2RhdGFbIDUgXSA9IHZhbHVlLmVsZW1lbnRzWyA0IF07CgkJCQkJCXVuaWZvcm0uX19kYXRhWyA2IF0gPSB2YWx1ZS5lbGVtZW50c1sgNSBdOwoJCQkJCQl1bmlmb3JtLl9fZGF0YVsgNyBdID0gdmFsdWUuZWxlbWVudHNbIDAgXTsKCQkJCQkJdW5pZm9ybS5fX2RhdGFbIDggXSA9IHZhbHVlLmVsZW1lbnRzWyA2IF07CgkJCQkJCXVuaWZvcm0uX19kYXRhWyA5IF0gPSB2YWx1ZS5lbGVtZW50c1sgNyBdOwoJCQkJCQl1bmlmb3JtLl9fZGF0YVsgMTAgXSA9IHZhbHVlLmVsZW1lbnRzWyA4IF07CgkJCQkJCXVuaWZvcm0uX19kYXRhWyAxMSBdID0gdmFsdWUuZWxlbWVudHNbIDAgXTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXZhbHVlLnRvQXJyYXkoIHVuaWZvcm0uX19kYXRhLCBhcnJheU9mZnNldCApOwoKCQkJCQkJYXJyYXlPZmZzZXQgKz0gaW5mby5zdG9yYWdlIC8gRmxvYXQzMkFycmF5LkJZVEVTX1BFUl9FTEVNRU5UOwoKCQkJCQl9CgoJCQkJfQoKCQkJCWdsLmJ1ZmZlclN1YkRhdGEoIGdsLlVOSUZPUk1fQlVGRkVSLCBvZmZzZXQsIHVuaWZvcm0uX19kYXRhICk7CgoJCQl9CgoJCX0KCgkJZ2wuYmluZEJ1ZmZlciggZ2wuVU5JRk9STV9CVUZGRVIsIG51bGwgKTsKCgl9CgoJZnVuY3Rpb24gaGFzVW5pZm9ybUNoYW5nZWQoIHVuaWZvcm0sIGluZGV4LCBjYWNoZSApIHsKCgkJY29uc3QgdmFsdWUgPSB1bmlmb3JtLnZhbHVlOwoKCQlpZiAoIGNhY2hlWyBpbmRleCBdID09PSB1bmRlZmluZWQgKSB7CgoJCQkvLyBjYWNoZSBlbnRyeSBkb2VzIG5vdCBleGlzdCBzbyBmYXIKCgkJCWlmICggdHlwZW9mIHZhbHVlID09PSAnbnVtYmVyJyApIHsKCgkJCQljYWNoZVsgaW5kZXggXSA9IHZhbHVlOwoKCQkJfSBlbHNlIHsKCgkJCQljb25zdCB2YWx1ZXMgPSBBcnJheS5pc0FycmF5KCB2YWx1ZSApID8gdmFsdWUgOiBbIHZhbHVlIF07CgoJCQkJY29uc3QgdGVtcFZhbHVlcyA9IFtdOwoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHZhbHVlcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCXRlbXBWYWx1ZXMucHVzaCggdmFsdWVzWyBpIF0uY2xvbmUoKSApOwoKCQkJCX0KCgkJCQljYWNoZVsgaW5kZXggXSA9IHRlbXBWYWx1ZXM7CgoJCQl9CgoJCQlyZXR1cm4gdHJ1ZTsKCgkJfSBlbHNlIHsKCgkJCS8vIGNvbXBhcmUgY3VycmVudCB2YWx1ZSB3aXRoIGNhY2hlZCBlbnRyeQoKCQkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInICkgewoKCQkJCWlmICggY2FjaGVbIGluZGV4IF0gIT09IHZhbHVlICkgewoKCQkJCQljYWNoZVsgaW5kZXggXSA9IHZhbHVlOwoJCQkJCXJldHVybiB0cnVlOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJY29uc3QgY2FjaGVkT2JqZWN0cyA9IEFycmF5LmlzQXJyYXkoIGNhY2hlWyBpbmRleCBdICkgPyBjYWNoZVsgaW5kZXggXSA6IFsgY2FjaGVbIGluZGV4IF0gXTsKCQkJCWNvbnN0IHZhbHVlcyA9IEFycmF5LmlzQXJyYXkoIHZhbHVlICkgPyB2YWx1ZSA6IFsgdmFsdWUgXTsKCgkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBjYWNoZWRPYmplY3RzLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJY29uc3QgY2FjaGVkT2JqZWN0ID0gY2FjaGVkT2JqZWN0c1sgaSBdOwoKCQkJCQlpZiAoIGNhY2hlZE9iamVjdC5lcXVhbHMoIHZhbHVlc1sgaSBdICkgPT09IGZhbHNlICkgewoKCQkJCQkJY2FjaGVkT2JqZWN0LmNvcHkoIHZhbHVlc1sgaSBdICk7CgkJCQkJCXJldHVybiB0cnVlOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQl9CgoJCXJldHVybiBmYWxzZTsKCgl9CgoJZnVuY3Rpb24gcHJlcGFyZVVuaWZvcm1zR3JvdXAoIHVuaWZvcm1zR3JvdXAgKSB7CgoJCS8vIGRldGVybWluZSB0b3RhbCBidWZmZXIgc2l6ZSBhY2NvcmRpbmcgdG8gdGhlIFNURDE0MCBsYXlvdXQKCQkvLyBIaW50OiBTVEQxNDAgaXMgdGhlIG9ubHkgc3VwcG9ydGVkIGxheW91dCBpbiBXZWJHTCAyCgoJCWNvbnN0IHVuaWZvcm1zID0gdW5pZm9ybXNHcm91cC51bmlmb3JtczsKCgkJbGV0IG9mZnNldCA9IDA7IC8vIGdsb2JhbCBidWZmZXIgb2Zmc2V0IGluIGJ5dGVzCgkJY29uc3QgY2h1bmtTaXplID0gMTY7IC8vIHNpemUgb2YgYSBjaHVuayBpbiBieXRlcwoJCWxldCBjaHVua09mZnNldCA9IDA7IC8vIG9mZnNldCB3aXRoaW4gYSBzaW5nbGUgY2h1bmsgaW4gYnl0ZXMKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gdW5pZm9ybXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IHVuaWZvcm0gPSB1bmlmb3Jtc1sgaSBdOwoKCQkJY29uc3QgaW5mb3MgPSB7CgkJCQlib3VuZGFyeTogMCwgLy8gYnl0ZXMKCQkJCXN0b3JhZ2U6IDAgLy8gYnl0ZXMKCQkJfTsKCgkJCWNvbnN0IHZhbHVlcyA9IEFycmF5LmlzQXJyYXkoIHVuaWZvcm0udmFsdWUgKSA/IHVuaWZvcm0udmFsdWUgOiBbIHVuaWZvcm0udmFsdWUgXTsKCgkJCWZvciAoIGxldCBqID0gMCwgamwgPSB2YWx1ZXMubGVuZ3RoOyBqIDwgamw7IGogKysgKSB7CgoJCQkJY29uc3QgdmFsdWUgPSB2YWx1ZXNbIGogXTsKCgkJCQljb25zdCBpbmZvID0gZ2V0VW5pZm9ybVNpemUoIHZhbHVlICk7CgoJCQkJaW5mb3MuYm91bmRhcnkgKz0gaW5mby5ib3VuZGFyeTsKCQkJCWluZm9zLnN0b3JhZ2UgKz0gaW5mby5zdG9yYWdlOwoKCQkJfQoKCQkJLy8gdGhlIGZvbGxvd2luZyB0d28gcHJvcGVydGllcyB3aWxsIGJlIHVzZWQgZm9yIHBhcnRpYWwgYnVmZmVyIHVwZGF0ZXMKCgkJCXVuaWZvcm0uX19kYXRhID0gbmV3IEZsb2F0MzJBcnJheSggaW5mb3Muc3RvcmFnZSAvIEZsb2F0MzJBcnJheS5CWVRFU19QRVJfRUxFTUVOVCApOwoJCQl1bmlmb3JtLl9fb2Zmc2V0ID0gb2Zmc2V0OwoKCQkJLy8KCgkJCWlmICggaSA+IDAgKSB7CgoJCQkJY2h1bmtPZmZzZXQgPSBvZmZzZXQgJSBjaHVua1NpemU7CgoJCQkJY29uc3QgcmVtYWluaW5nU2l6ZUluQ2h1bmsgPSBjaHVua1NpemUgLSBjaHVua09mZnNldDsKCgkJCQkvLyBjaGVjayBmb3IgY2h1bmsgb3ZlcmZsb3cKCgkJCQlpZiAoIGNodW5rT2Zmc2V0ICE9PSAwICYmICggcmVtYWluaW5nU2l6ZUluQ2h1bmsgLSBpbmZvcy5ib3VuZGFyeSApIDwgMCApIHsKCgkJCQkJLy8gYWRkIHBhZGRpbmcgYW5kIGFkanVzdCBvZmZzZXQKCgkJCQkJb2Zmc2V0ICs9ICggY2h1bmtTaXplIC0gY2h1bmtPZmZzZXQgKTsKCQkJCQl1bmlmb3JtLl9fb2Zmc2V0ID0gb2Zmc2V0OwoKCQkJCX0KCgkJCX0KCgkJCW9mZnNldCArPSBpbmZvcy5zdG9yYWdlOwoKCQl9CgoJCS8vIGVuc3VyZSBjb3JyZWN0IGZpbmFsIHBhZGRpbmcKCgkJY2h1bmtPZmZzZXQgPSBvZmZzZXQgJSBjaHVua1NpemU7CgoJCWlmICggY2h1bmtPZmZzZXQgPiAwICkgb2Zmc2V0ICs9ICggY2h1bmtTaXplIC0gY2h1bmtPZmZzZXQgKTsKCgkJLy8KCgkJdW5pZm9ybXNHcm91cC5fX3NpemUgPSBvZmZzZXQ7CgkJdW5pZm9ybXNHcm91cC5fX2NhY2hlID0ge307CgoJCXJldHVybiB0aGlzOwoKCX0KCglmdW5jdGlvbiBnZXRVbmlmb3JtU2l6ZSggdmFsdWUgKSB7CgoJCWNvbnN0IGluZm8gPSB7CgkJCWJvdW5kYXJ5OiAwLCAvLyBieXRlcwoJCQlzdG9yYWdlOiAwIC8vIGJ5dGVzCgkJfTsKCgkJLy8gZGV0ZXJtaW5lIHNpemVzIGFjY29yZGluZyB0byBTVEQxNDAKCgkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInICkgewoKCQkJLy8gZmxvYXQvaW50CgoJCQlpbmZvLmJvdW5kYXJ5ID0gNDsKCQkJaW5mby5zdG9yYWdlID0gNDsKCgkJfSBlbHNlIGlmICggdmFsdWUuaXNWZWN0b3IyICkgewoKCQkJLy8gdmVjMgoKCQkJaW5mby5ib3VuZGFyeSA9IDg7CgkJCWluZm8uc3RvcmFnZSA9IDg7CgoJCX0gZWxzZSBpZiAoIHZhbHVlLmlzVmVjdG9yMyB8fCB2YWx1ZS5pc0NvbG9yICkgewoKCQkJLy8gdmVjMwoKCQkJaW5mby5ib3VuZGFyeSA9IDE2OwoJCQlpbmZvLnN0b3JhZ2UgPSAxMjsgLy8gZXZpbDogdmVjMyBtdXN0IHN0YXJ0IG9uIGEgMTYtYnl0ZSBib3VuZGFyeSBidXQgaXQgb25seSBjb25zdW1lcyAxMiBieXRlcwoKCQl9IGVsc2UgaWYgKCB2YWx1ZS5pc1ZlY3RvcjQgKSB7CgoJCQkvLyB2ZWM0CgoJCQlpbmZvLmJvdW5kYXJ5ID0gMTY7CgkJCWluZm8uc3RvcmFnZSA9IDE2OwoKCQl9IGVsc2UgaWYgKCB2YWx1ZS5pc01hdHJpeDMgKSB7CgoJCQkvLyBtYXQzIChpbiBTVEQxNDAgYSAzeDMgbWF0cml4IGlzIHJlcHJlc2VudGVkIGFzIDN4NCkKCgkJCWluZm8uYm91bmRhcnkgPSA0ODsKCQkJaW5mby5zdG9yYWdlID0gNDg7CgoJCX0gZWxzZSBpZiAoIHZhbHVlLmlzTWF0cml4NCApIHsKCgkJCS8vIG1hdDQKCgkJCWluZm8uYm91bmRhcnkgPSA2NDsKCQkJaW5mby5zdG9yYWdlID0gNjQ7CgoJCX0gZWxzZSBpZiAoIHZhbHVlLmlzVGV4dHVyZSApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFRleHR1cmUgc2FtcGxlcnMgY2FuIG5vdCBiZSBwYXJ0IG9mIGFuIHVuaWZvcm1zIGdyb3VwLicgKTsKCgkJfSBlbHNlIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFVuc3VwcG9ydGVkIHVuaWZvcm0gdmFsdWUgdHlwZS4nLCB2YWx1ZSApOwoKCQl9CgoJCXJldHVybiBpbmZvOwoKCX0KCglmdW5jdGlvbiBvblVuaWZvcm1zR3JvdXBzRGlzcG9zZSggZXZlbnQgKSB7CgoJCWNvbnN0IHVuaWZvcm1zR3JvdXAgPSBldmVudC50YXJnZXQ7CgoJCXVuaWZvcm1zR3JvdXAucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvblVuaWZvcm1zR3JvdXBzRGlzcG9zZSApOwoKCQljb25zdCBpbmRleCA9IGFsbG9jYXRlZEJpbmRpbmdQb2ludHMuaW5kZXhPZiggdW5pZm9ybXNHcm91cC5fX2JpbmRpbmdQb2ludEluZGV4ICk7CgkJYWxsb2NhdGVkQmluZGluZ1BvaW50cy5zcGxpY2UoIGluZGV4LCAxICk7CgoJCWdsLmRlbGV0ZUJ1ZmZlciggYnVmZmVyc1sgdW5pZm9ybXNHcm91cC5pZCBdICk7CgoJCWRlbGV0ZSBidWZmZXJzWyB1bmlmb3Jtc0dyb3VwLmlkIF07CgkJZGVsZXRlIHVwZGF0ZUxpc3RbIHVuaWZvcm1zR3JvdXAuaWQgXTsKCgl9CgoJZnVuY3Rpb24gZGlzcG9zZSgpIHsKCgkJZm9yICggY29uc3QgaWQgaW4gYnVmZmVycyApIHsKCgkJCWdsLmRlbGV0ZUJ1ZmZlciggYnVmZmVyc1sgaWQgXSApOwoKCQl9CgoJCWFsbG9jYXRlZEJpbmRpbmdQb2ludHMgPSBbXTsKCQlidWZmZXJzID0ge307CgkJdXBkYXRlTGlzdCA9IHt9OwoKCX0KCglyZXR1cm4gewoKCQliaW5kOiBiaW5kLAoJCXVwZGF0ZTogdXBkYXRlLAoKCQlkaXNwb3NlOiBkaXNwb3NlCgoJfTsKCn0KCmNsYXNzIFdlYkdMUmVuZGVyZXIgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJzID0ge30gKSB7CgoJCWNvbnN0IHsKCQkJY2FudmFzID0gY3JlYXRlQ2FudmFzRWxlbWVudCgpLAoJCQljb250ZXh0ID0gbnVsbCwKCQkJZGVwdGggPSB0cnVlLAoJCQlzdGVuY2lsID0gdHJ1ZSwKCQkJYWxwaGEgPSBmYWxzZSwKCQkJYW50aWFsaWFzID0gZmFsc2UsCgkJCXByZW11bHRpcGxpZWRBbHBoYSA9IHRydWUsCgkJCXByZXNlcnZlRHJhd2luZ0J1ZmZlciA9IGZhbHNlLAoJCQlwb3dlclByZWZlcmVuY2UgPSAnZGVmYXVsdCcsCgkJCWZhaWxJZk1ham9yUGVyZm9ybWFuY2VDYXZlYXQgPSBmYWxzZSwKCQl9ID0gcGFyYW1ldGVyczsKCgkJdGhpcy5pc1dlYkdMUmVuZGVyZXIgPSB0cnVlOwoKCQlsZXQgX2FscGhhOwoKCQlpZiAoIGNvbnRleHQgIT09IG51bGwgKSB7CgoJCQlfYWxwaGEgPSBjb250ZXh0LmdldENvbnRleHRBdHRyaWJ1dGVzKCkuYWxwaGE7CgoJCX0gZWxzZSB7CgoJCQlfYWxwaGEgPSBhbHBoYTsKCgkJfQoKCQljb25zdCB1aW50Q2xlYXJDb2xvciA9IG5ldyBVaW50MzJBcnJheSggNCApOwoJCWNvbnN0IGludENsZWFyQ29sb3IgPSBuZXcgSW50MzJBcnJheSggNCApOwoKCQlsZXQgY3VycmVudFJlbmRlckxpc3QgPSBudWxsOwoJCWxldCBjdXJyZW50UmVuZGVyU3RhdGUgPSBudWxsOwoKCQkvLyByZW5kZXIoKSBjYW4gYmUgY2FsbGVkIGZyb20gd2l0aGluIGEgY2FsbGJhY2sgdHJpZ2dlcmVkIGJ5IGFub3RoZXIgcmVuZGVyLgoJCS8vIFdlIHRyYWNrIHRoaXMgc28gdGhhdCB0aGUgbmVzdGVkIHJlbmRlciBjYWxsIGdldHMgaXRzIGxpc3QgYW5kIHN0YXRlIGlzb2xhdGVkIGZyb20gdGhlIHBhcmVudCByZW5kZXIgY2FsbC4KCgkJY29uc3QgcmVuZGVyTGlzdFN0YWNrID0gW107CgkJY29uc3QgcmVuZGVyU3RhdGVTdGFjayA9IFtdOwoKCQkvLyBwdWJsaWMgcHJvcGVydGllcwoKCQl0aGlzLmRvbUVsZW1lbnQgPSBjYW52YXM7CgoJCS8vIERlYnVnIGNvbmZpZ3VyYXRpb24gY29udGFpbmVyCgkJdGhpcy5kZWJ1ZyA9IHsKCgkJCS8qKgoJCQkgKiBFbmFibGVzIGVycm9yIGNoZWNraW5nIGFuZCByZXBvcnRpbmcgd2hlbiBzaGFkZXIgcHJvZ3JhbXMgYXJlIGJlaW5nIGNvbXBpbGVkCgkJCSAqIEB0eXBlIHtib29sZWFufQoJCQkgKi8KCQkJY2hlY2tTaGFkZXJFcnJvcnM6IHRydWUsCgkJCS8qKgoJCQkgKiBDYWxsYmFjayBmb3IgY3VzdG9tIGVycm9yIHJlcG9ydGluZy4KCQkJICogQHR5cGUgez9GdW5jdGlvbn0KCQkJICovCgkJCW9uU2hhZGVyRXJyb3I6IG51bGwKCQl9OwoKCQkvLyBjbGVhcmluZwoKCQl0aGlzLmF1dG9DbGVhciA9IHRydWU7CgkJdGhpcy5hdXRvQ2xlYXJDb2xvciA9IHRydWU7CgkJdGhpcy5hdXRvQ2xlYXJEZXB0aCA9IHRydWU7CgkJdGhpcy5hdXRvQ2xlYXJTdGVuY2lsID0gdHJ1ZTsKCgkJLy8gc2NlbmUgZ3JhcGgKCgkJdGhpcy5zb3J0T2JqZWN0cyA9IHRydWU7CgoJCS8vIHVzZXItZGVmaW5lZCBjbGlwcGluZwoKCQl0aGlzLmNsaXBwaW5nUGxhbmVzID0gW107CgkJdGhpcy5sb2NhbENsaXBwaW5nRW5hYmxlZCA9IGZhbHNlOwoKCQkvLyBwaHlzaWNhbGx5IGJhc2VkIHNoYWRpbmcKCgkJdGhpcy5fb3V0cHV0Q29sb3JTcGFjZSA9IFNSR0JDb2xvclNwYWNlOwoKCQkvLyBwaHlzaWNhbCBsaWdodHMKCgkJdGhpcy5fdXNlTGVnYWN5TGlnaHRzID0gZmFsc2U7CgoJCS8vIHRvbmUgbWFwcGluZwoKCQl0aGlzLnRvbmVNYXBwaW5nID0gTm9Ub25lTWFwcGluZzsKCQl0aGlzLnRvbmVNYXBwaW5nRXhwb3N1cmUgPSAxLjA7CgoJCS8vIGludGVybmFsIHByb3BlcnRpZXMKCgkJY29uc3QgX3RoaXMgPSB0aGlzOwoKCQlsZXQgX2lzQ29udGV4dExvc3QgPSBmYWxzZTsKCgkJLy8gaW50ZXJuYWwgc3RhdGUgY2FjaGUKCgkJbGV0IF9jdXJyZW50QWN0aXZlQ3ViZUZhY2UgPSAwOwoJCWxldCBfY3VycmVudEFjdGl2ZU1pcG1hcExldmVsID0gMDsKCQlsZXQgX2N1cnJlbnRSZW5kZXJUYXJnZXQgPSBudWxsOwoJCWxldCBfY3VycmVudE1hdGVyaWFsSWQgPSAtIDE7CgoJCWxldCBfY3VycmVudENhbWVyYSA9IG51bGw7CgoJCWNvbnN0IF9jdXJyZW50Vmlld3BvcnQgPSBuZXcgVmVjdG9yNCgpOwoJCWNvbnN0IF9jdXJyZW50U2Npc3NvciA9IG5ldyBWZWN0b3I0KCk7CgkJbGV0IF9jdXJyZW50U2Npc3NvclRlc3QgPSBudWxsOwoKCQljb25zdCBfY3VycmVudENsZWFyQ29sb3IgPSBuZXcgQ29sb3IoIDB4MDAwMDAwICk7CgkJbGV0IF9jdXJyZW50Q2xlYXJBbHBoYSA9IDA7CgoJCS8vCgoJCWxldCBfd2lkdGggPSBjYW52YXMud2lkdGg7CgkJbGV0IF9oZWlnaHQgPSBjYW52YXMuaGVpZ2h0OwoKCQlsZXQgX3BpeGVsUmF0aW8gPSAxOwoJCWxldCBfb3BhcXVlU29ydCA9IG51bGw7CgkJbGV0IF90cmFuc3BhcmVudFNvcnQgPSBudWxsOwoKCQljb25zdCBfdmlld3BvcnQgPSBuZXcgVmVjdG9yNCggMCwgMCwgX3dpZHRoLCBfaGVpZ2h0ICk7CgkJY29uc3QgX3NjaXNzb3IgPSBuZXcgVmVjdG9yNCggMCwgMCwgX3dpZHRoLCBfaGVpZ2h0ICk7CgkJbGV0IF9zY2lzc29yVGVzdCA9IGZhbHNlOwoKCQkvLyBmcnVzdHVtCgoJCWNvbnN0IF9mcnVzdHVtID0gbmV3IEZydXN0dW0oKTsKCgkJLy8gY2xpcHBpbmcKCgkJbGV0IF9jbGlwcGluZ0VuYWJsZWQgPSBmYWxzZTsKCQlsZXQgX2xvY2FsQ2xpcHBpbmdFbmFibGVkID0gZmFsc2U7CgoJCS8vIHRyYW5zbWlzc2lvbgoKCQlsZXQgX3RyYW5zbWlzc2lvblJlbmRlclRhcmdldCA9IG51bGw7CgoJCS8vIGNhbWVyYSBtYXRyaWNlcyBjYWNoZQoKCQljb25zdCBfcHJvalNjcmVlbk1hdHJpeCA9IG5ldyBNYXRyaXg0KCk7CgoJCWNvbnN0IF92ZWN0b3IyID0gbmV3IFZlY3RvcjIoKTsKCQljb25zdCBfdmVjdG9yMyA9IG5ldyBWZWN0b3IzKCk7CgoJCWNvbnN0IF9lbXB0eVNjZW5lID0geyBiYWNrZ3JvdW5kOiBudWxsLCBmb2c6IG51bGwsIGVudmlyb25tZW50OiBudWxsLCBvdmVycmlkZU1hdGVyaWFsOiBudWxsLCBpc1NjZW5lOiB0cnVlIH07CgoJCWZ1bmN0aW9uIGdldFRhcmdldFBpeGVsUmF0aW8oKSB7CgoJCQlyZXR1cm4gX2N1cnJlbnRSZW5kZXJUYXJnZXQgPT09IG51bGwgPyBfcGl4ZWxSYXRpbyA6IDE7CgoJCX0KCgkJLy8gaW5pdGlhbGl6ZQoKCQlsZXQgX2dsID0gY29udGV4dDsKCgkJZnVuY3Rpb24gZ2V0Q29udGV4dCggY29udGV4dE5hbWVzLCBjb250ZXh0QXR0cmlidXRlcyApIHsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IGNvbnRleHROYW1lcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJY29uc3QgY29udGV4dE5hbWUgPSBjb250ZXh0TmFtZXNbIGkgXTsKCQkJCWNvbnN0IGNvbnRleHQgPSBjYW52YXMuZ2V0Q29udGV4dCggY29udGV4dE5hbWUsIGNvbnRleHRBdHRyaWJ1dGVzICk7CgkJCQlpZiAoIGNvbnRleHQgIT09IG51bGwgKSByZXR1cm4gY29udGV4dDsKCgkJCX0KCgkJCXJldHVybiBudWxsOwoKCQl9CgoJCXRyeSB7CgoJCQljb25zdCBjb250ZXh0QXR0cmlidXRlcyA9IHsKCQkJCWFscGhhOiB0cnVlLAoJCQkJZGVwdGgsCgkJCQlzdGVuY2lsLAoJCQkJYW50aWFsaWFzLAoJCQkJcHJlbXVsdGlwbGllZEFscGhhLAoJCQkJcHJlc2VydmVEcmF3aW5nQnVmZmVyLAoJCQkJcG93ZXJQcmVmZXJlbmNlLAoJCQkJZmFpbElmTWFqb3JQZXJmb3JtYW5jZUNhdmVhdCwKCQkJfTsKCgkJCS8vIE9mZnNjcmVlbkNhbnZhcyBkb2VzIG5vdCBoYXZlIHNldEF0dHJpYnV0ZSwgc2VlICMyMjgxMQoJCQlpZiAoICdzZXRBdHRyaWJ1dGUnIGluIGNhbnZhcyApIGNhbnZhcy5zZXRBdHRyaWJ1dGUoICdkYXRhLWVuZ2luZScsIGB0aHJlZS5qcyByJHtSRVZJU0lPTn1gICk7CgoJCQkvLyBldmVudCBsaXN0ZW5lcnMgbXVzdCBiZSByZWdpc3RlcmVkIGJlZm9yZSBXZWJHTCBjb250ZXh0IGlzIGNyZWF0ZWQsIHNlZSAjMTI3NTMKCQkJY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoICd3ZWJnbGNvbnRleHRsb3N0Jywgb25Db250ZXh0TG9zdCwgZmFsc2UgKTsKCQkJY2FudmFzLmFkZEV2ZW50TGlzdGVuZXIoICd3ZWJnbGNvbnRleHRyZXN0b3JlZCcsIG9uQ29udGV4dFJlc3RvcmUsIGZhbHNlICk7CgkJCWNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCAnd2ViZ2xjb250ZXh0Y3JlYXRpb25lcnJvcicsIG9uQ29udGV4dENyZWF0aW9uRXJyb3IsIGZhbHNlICk7CgoJCQlpZiAoIF9nbCA9PT0gbnVsbCApIHsKCgkJCQljb25zdCBjb250ZXh0TmFtZXMgPSBbICd3ZWJnbDInLCAnd2ViZ2wnLCAnZXhwZXJpbWVudGFsLXdlYmdsJyBdOwoKCQkJCWlmICggX3RoaXMuaXNXZWJHTDFSZW5kZXJlciA9PT0gdHJ1ZSApIHsKCgkJCQkJY29udGV4dE5hbWVzLnNoaWZ0KCk7CgoJCQkJfQoKCQkJCV9nbCA9IGdldENvbnRleHQoIGNvbnRleHROYW1lcywgY29udGV4dEF0dHJpYnV0ZXMgKTsKCgkJCQlpZiAoIF9nbCA9PT0gbnVsbCApIHsKCgkJCQkJaWYgKCBnZXRDb250ZXh0KCBjb250ZXh0TmFtZXMgKSApIHsKCgkJCQkJCXRocm93IG5ldyBFcnJvciggJ0Vycm9yIGNyZWF0aW5nIFdlYkdMIGNvbnRleHQgd2l0aCB5b3VyIHNlbGVjdGVkIGF0dHJpYnV0ZXMuJyApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdGhyb3cgbmV3IEVycm9yKCAnRXJyb3IgY3JlYXRpbmcgV2ViR0wgY29udGV4dC4nICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHR5cGVvZiBXZWJHTFJlbmRlcmluZ0NvbnRleHQgIT09ICd1bmRlZmluZWQnICYmIF9nbCBpbnN0YW5jZW9mIFdlYkdMUmVuZGVyaW5nQ29udGV4dCApIHsgLy8gQGRlcHJlY2F0ZWQsIHIxNTMKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBXZWJHTCAxIHN1cHBvcnQgd2FzIGRlcHJlY2F0ZWQgaW4gcjE1MyBhbmQgd2lsbCBiZSByZW1vdmVkIGluIHIxNjMuJyApOwoKCQkJfQoKCQkJLy8gU29tZSBleHBlcmltZW50YWwtd2ViZ2wgaW1wbGVtZW50YXRpb25zIGRvIG5vdCBoYXZlIGdldFNoYWRlclByZWNpc2lvbkZvcm1hdAoKCQkJaWYgKCBfZ2wuZ2V0U2hhZGVyUHJlY2lzaW9uRm9ybWF0ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJX2dsLmdldFNoYWRlclByZWNpc2lvbkZvcm1hdCA9IGZ1bmN0aW9uICgpIHsKCgkJCQkJcmV0dXJuIHsgJ3JhbmdlTWluJzogMSwgJ3JhbmdlTWF4JzogMSwgJ3ByZWNpc2lvbic6IDEgfTsKCgkJCQl9OwoKCQkJfQoKCQl9IGNhdGNoICggZXJyb3IgKSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogJyArIGVycm9yLm1lc3NhZ2UgKTsKCQkJdGhyb3cgZXJyb3I7CgoJCX0KCgkJbGV0IGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcywgc3RhdGUsIGluZm87CgkJbGV0IHByb3BlcnRpZXMsIHRleHR1cmVzLCBjdWJlbWFwcywgY3ViZXV2bWFwcywgYXR0cmlidXRlcywgZ2VvbWV0cmllcywgb2JqZWN0czsKCQlsZXQgcHJvZ3JhbUNhY2hlLCBtYXRlcmlhbHMsIHJlbmRlckxpc3RzLCByZW5kZXJTdGF0ZXMsIGNsaXBwaW5nLCBzaGFkb3dNYXA7CgoJCWxldCBiYWNrZ3JvdW5kLCBtb3JwaHRhcmdldHMsIGJ1ZmZlclJlbmRlcmVyLCBpbmRleGVkQnVmZmVyUmVuZGVyZXI7CgoJCWxldCB1dGlscywgYmluZGluZ1N0YXRlcywgdW5pZm9ybXNHcm91cHM7CgoJCWZ1bmN0aW9uIGluaXRHTENvbnRleHQoKSB7CgoJCQlleHRlbnNpb25zID0gbmV3IFdlYkdMRXh0ZW5zaW9ucyggX2dsICk7CgoJCQljYXBhYmlsaXRpZXMgPSBuZXcgV2ViR0xDYXBhYmlsaXRpZXMoIF9nbCwgZXh0ZW5zaW9ucywgcGFyYW1ldGVycyApOwoKCQkJZXh0ZW5zaW9ucy5pbml0KCBjYXBhYmlsaXRpZXMgKTsKCgkJCXV0aWxzID0gbmV3IFdlYkdMVXRpbHMoIF9nbCwgZXh0ZW5zaW9ucywgY2FwYWJpbGl0aWVzICk7CgoJCQlzdGF0ZSA9IG5ldyBXZWJHTFN0YXRlKCBfZ2wsIGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcyApOwoKCQkJaW5mbyA9IG5ldyBXZWJHTEluZm8oIF9nbCApOwoJCQlwcm9wZXJ0aWVzID0gbmV3IFdlYkdMUHJvcGVydGllcygpOwoJCQl0ZXh0dXJlcyA9IG5ldyBXZWJHTFRleHR1cmVzKCBfZ2wsIGV4dGVuc2lvbnMsIHN0YXRlLCBwcm9wZXJ0aWVzLCBjYXBhYmlsaXRpZXMsIHV0aWxzLCBpbmZvICk7CgkJCWN1YmVtYXBzID0gbmV3IFdlYkdMQ3ViZU1hcHMoIF90aGlzICk7CgkJCWN1YmV1dm1hcHMgPSBuZXcgV2ViR0xDdWJlVVZNYXBzKCBfdGhpcyApOwoJCQlhdHRyaWJ1dGVzID0gbmV3IFdlYkdMQXR0cmlidXRlcyggX2dsLCBjYXBhYmlsaXRpZXMgKTsKCQkJYmluZGluZ1N0YXRlcyA9IG5ldyBXZWJHTEJpbmRpbmdTdGF0ZXMoIF9nbCwgZXh0ZW5zaW9ucywgYXR0cmlidXRlcywgY2FwYWJpbGl0aWVzICk7CgkJCWdlb21ldHJpZXMgPSBuZXcgV2ViR0xHZW9tZXRyaWVzKCBfZ2wsIGF0dHJpYnV0ZXMsIGluZm8sIGJpbmRpbmdTdGF0ZXMgKTsKCQkJb2JqZWN0cyA9IG5ldyBXZWJHTE9iamVjdHMoIF9nbCwgZ2VvbWV0cmllcywgYXR0cmlidXRlcywgaW5mbyApOwoJCQltb3JwaHRhcmdldHMgPSBuZXcgV2ViR0xNb3JwaHRhcmdldHMoIF9nbCwgY2FwYWJpbGl0aWVzLCB0ZXh0dXJlcyApOwoJCQljbGlwcGluZyA9IG5ldyBXZWJHTENsaXBwaW5nKCBwcm9wZXJ0aWVzICk7CgkJCXByb2dyYW1DYWNoZSA9IG5ldyBXZWJHTFByb2dyYW1zKCBfdGhpcywgY3ViZW1hcHMsIGN1YmV1dm1hcHMsIGV4dGVuc2lvbnMsIGNhcGFiaWxpdGllcywgYmluZGluZ1N0YXRlcywgY2xpcHBpbmcgKTsKCQkJbWF0ZXJpYWxzID0gbmV3IFdlYkdMTWF0ZXJpYWxzKCBfdGhpcywgcHJvcGVydGllcyApOwoJCQlyZW5kZXJMaXN0cyA9IG5ldyBXZWJHTFJlbmRlckxpc3RzKCk7CgkJCXJlbmRlclN0YXRlcyA9IG5ldyBXZWJHTFJlbmRlclN0YXRlcyggZXh0ZW5zaW9ucywgY2FwYWJpbGl0aWVzICk7CgkJCWJhY2tncm91bmQgPSBuZXcgV2ViR0xCYWNrZ3JvdW5kKCBfdGhpcywgY3ViZW1hcHMsIGN1YmV1dm1hcHMsIHN0YXRlLCBvYmplY3RzLCBfYWxwaGEsIHByZW11bHRpcGxpZWRBbHBoYSApOwoJCQlzaGFkb3dNYXAgPSBuZXcgV2ViR0xTaGFkb3dNYXAoIF90aGlzLCBvYmplY3RzLCBjYXBhYmlsaXRpZXMgKTsKCQkJdW5pZm9ybXNHcm91cHMgPSBuZXcgV2ViR0xVbmlmb3Jtc0dyb3VwcyggX2dsLCBpbmZvLCBjYXBhYmlsaXRpZXMsIHN0YXRlICk7CgoJCQlidWZmZXJSZW5kZXJlciA9IG5ldyBXZWJHTEJ1ZmZlclJlbmRlcmVyKCBfZ2wsIGV4dGVuc2lvbnMsIGluZm8sIGNhcGFiaWxpdGllcyApOwoJCQlpbmRleGVkQnVmZmVyUmVuZGVyZXIgPSBuZXcgV2ViR0xJbmRleGVkQnVmZmVyUmVuZGVyZXIoIF9nbCwgZXh0ZW5zaW9ucywgaW5mbywgY2FwYWJpbGl0aWVzICk7CgoJCQlpbmZvLnByb2dyYW1zID0gcHJvZ3JhbUNhY2hlLnByb2dyYW1zOwoKCQkJX3RoaXMuY2FwYWJpbGl0aWVzID0gY2FwYWJpbGl0aWVzOwoJCQlfdGhpcy5leHRlbnNpb25zID0gZXh0ZW5zaW9uczsKCQkJX3RoaXMucHJvcGVydGllcyA9IHByb3BlcnRpZXM7CgkJCV90aGlzLnJlbmRlckxpc3RzID0gcmVuZGVyTGlzdHM7CgkJCV90aGlzLnNoYWRvd01hcCA9IHNoYWRvd01hcDsKCQkJX3RoaXMuc3RhdGUgPSBzdGF0ZTsKCQkJX3RoaXMuaW5mbyA9IGluZm87CgoJCX0KCgkJaW5pdEdMQ29udGV4dCgpOwoKCQkvLyB4cgoKCQljb25zdCB4ciA9IG5ldyBXZWJYUk1hbmFnZXIoIF90aGlzLCBfZ2wgKTsKCgkJdGhpcy54ciA9IHhyOwoKCQkvLyBBUEkKCgkJdGhpcy5nZXRDb250ZXh0ID0gZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIF9nbDsKCgkJfTsKCgkJdGhpcy5nZXRDb250ZXh0QXR0cmlidXRlcyA9IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBfZ2wuZ2V0Q29udGV4dEF0dHJpYnV0ZXMoKTsKCgkJfTsKCgkJdGhpcy5mb3JjZUNvbnRleHRMb3NzID0gZnVuY3Rpb24gKCkgewoKCQkJY29uc3QgZXh0ZW5zaW9uID0gZXh0ZW5zaW9ucy5nZXQoICdXRUJHTF9sb3NlX2NvbnRleHQnICk7CgkJCWlmICggZXh0ZW5zaW9uICkgZXh0ZW5zaW9uLmxvc2VDb250ZXh0KCk7CgoJCX07CgoJCXRoaXMuZm9yY2VDb250ZXh0UmVzdG9yZSA9IGZ1bmN0aW9uICgpIHsKCgkJCWNvbnN0IGV4dGVuc2lvbiA9IGV4dGVuc2lvbnMuZ2V0KCAnV0VCR0xfbG9zZV9jb250ZXh0JyApOwoJCQlpZiAoIGV4dGVuc2lvbiApIGV4dGVuc2lvbi5yZXN0b3JlQ29udGV4dCgpOwoKCQl9OwoKCQl0aGlzLmdldFBpeGVsUmF0aW8gPSBmdW5jdGlvbiAoKSB7CgoJCQlyZXR1cm4gX3BpeGVsUmF0aW87CgoJCX07CgoJCXRoaXMuc2V0UGl4ZWxSYXRpbyA9IGZ1bmN0aW9uICggdmFsdWUgKSB7CgoJCQlpZiAoIHZhbHVlID09PSB1bmRlZmluZWQgKSByZXR1cm47CgoJCQlfcGl4ZWxSYXRpbyA9IHZhbHVlOwoKCQkJdGhpcy5zZXRTaXplKCBfd2lkdGgsIF9oZWlnaHQsIGZhbHNlICk7CgoJCX07CgoJCXRoaXMuZ2V0U2l6ZSA9IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKCQkJcmV0dXJuIHRhcmdldC5zZXQoIF93aWR0aCwgX2hlaWdodCApOwoKCQl9OwoKCQl0aGlzLnNldFNpemUgPSBmdW5jdGlvbiAoIHdpZHRoLCBoZWlnaHQsIHVwZGF0ZVN0eWxlID0gdHJ1ZSApIHsKCgkJCWlmICggeHIuaXNQcmVzZW50aW5nICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IENhblwndCBjaGFuZ2Ugc2l6ZSB3aGlsZSBWUiBkZXZpY2UgaXMgcHJlc2VudGluZy4nICk7CgkJCQlyZXR1cm47CgoJCQl9CgoJCQlfd2lkdGggPSB3aWR0aDsKCQkJX2hlaWdodCA9IGhlaWdodDsKCgkJCWNhbnZhcy53aWR0aCA9IE1hdGguZmxvb3IoIHdpZHRoICogX3BpeGVsUmF0aW8gKTsKCQkJY2FudmFzLmhlaWdodCA9IE1hdGguZmxvb3IoIGhlaWdodCAqIF9waXhlbFJhdGlvICk7CgoJCQlpZiAoIHVwZGF0ZVN0eWxlID09PSB0cnVlICkgewoKCQkJCWNhbnZhcy5zdHlsZS53aWR0aCA9IHdpZHRoICsgJ3B4JzsKCQkJCWNhbnZhcy5zdHlsZS5oZWlnaHQgPSBoZWlnaHQgKyAncHgnOwoKCQkJfQoKCQkJdGhpcy5zZXRWaWV3cG9ydCggMCwgMCwgd2lkdGgsIGhlaWdodCApOwoKCQl9OwoKCQl0aGlzLmdldERyYXdpbmdCdWZmZXJTaXplID0gZnVuY3Rpb24gKCB0YXJnZXQgKSB7CgoJCQlyZXR1cm4gdGFyZ2V0LnNldCggX3dpZHRoICogX3BpeGVsUmF0aW8sIF9oZWlnaHQgKiBfcGl4ZWxSYXRpbyApLmZsb29yKCk7CgoJCX07CgoJCXRoaXMuc2V0RHJhd2luZ0J1ZmZlclNpemUgPSBmdW5jdGlvbiAoIHdpZHRoLCBoZWlnaHQsIHBpeGVsUmF0aW8gKSB7CgoJCQlfd2lkdGggPSB3aWR0aDsKCQkJX2hlaWdodCA9IGhlaWdodDsKCgkJCV9waXhlbFJhdGlvID0gcGl4ZWxSYXRpbzsKCgkJCWNhbnZhcy53aWR0aCA9IE1hdGguZmxvb3IoIHdpZHRoICogcGl4ZWxSYXRpbyApOwoJCQljYW52YXMuaGVpZ2h0ID0gTWF0aC5mbG9vciggaGVpZ2h0ICogcGl4ZWxSYXRpbyApOwoKCQkJdGhpcy5zZXRWaWV3cG9ydCggMCwgMCwgd2lkdGgsIGhlaWdodCApOwoKCQl9OwoKCQl0aGlzLmdldEN1cnJlbnRWaWV3cG9ydCA9IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBfY3VycmVudFZpZXdwb3J0ICk7CgoJCX07CgoJCXRoaXMuZ2V0Vmlld3BvcnQgPSBmdW5jdGlvbiAoIHRhcmdldCApIHsKCgkJCXJldHVybiB0YXJnZXQuY29weSggX3ZpZXdwb3J0ICk7CgoJCX07CgoJCXRoaXMuc2V0Vmlld3BvcnQgPSBmdW5jdGlvbiAoIHgsIHksIHdpZHRoLCBoZWlnaHQgKSB7CgoJCQlpZiAoIHguaXNWZWN0b3I0ICkgewoKCQkJCV92aWV3cG9ydC5zZXQoIHgueCwgeC55LCB4LnosIHgudyApOwoKCQkJfSBlbHNlIHsKCgkJCQlfdmlld3BvcnQuc2V0KCB4LCB5LCB3aWR0aCwgaGVpZ2h0ICk7CgoJCQl9CgoJCQlzdGF0ZS52aWV3cG9ydCggX2N1cnJlbnRWaWV3cG9ydC5jb3B5KCBfdmlld3BvcnQgKS5tdWx0aXBseVNjYWxhciggX3BpeGVsUmF0aW8gKS5mbG9vcigpICk7CgoJCX07CgoJCXRoaXMuZ2V0U2Npc3NvciA9IGZ1bmN0aW9uICggdGFyZ2V0ICkgewoKCQkJcmV0dXJuIHRhcmdldC5jb3B5KCBfc2Npc3NvciApOwoKCQl9OwoKCQl0aGlzLnNldFNjaXNzb3IgPSBmdW5jdGlvbiAoIHgsIHksIHdpZHRoLCBoZWlnaHQgKSB7CgoJCQlpZiAoIHguaXNWZWN0b3I0ICkgewoKCQkJCV9zY2lzc29yLnNldCggeC54LCB4LnksIHgueiwgeC53ICk7CgoJCQl9IGVsc2UgewoKCQkJCV9zY2lzc29yLnNldCggeCwgeSwgd2lkdGgsIGhlaWdodCApOwoKCQkJfQoKCQkJc3RhdGUuc2Npc3NvciggX2N1cnJlbnRTY2lzc29yLmNvcHkoIF9zY2lzc29yICkubXVsdGlwbHlTY2FsYXIoIF9waXhlbFJhdGlvICkuZmxvb3IoKSApOwoKCQl9OwoKCQl0aGlzLmdldFNjaXNzb3JUZXN0ID0gZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIF9zY2lzc29yVGVzdDsKCgkJfTsKCgkJdGhpcy5zZXRTY2lzc29yVGVzdCA9IGZ1bmN0aW9uICggYm9vbGVhbiApIHsKCgkJCXN0YXRlLnNldFNjaXNzb3JUZXN0KCBfc2Npc3NvclRlc3QgPSBib29sZWFuICk7CgoJCX07CgoJCXRoaXMuc2V0T3BhcXVlU29ydCA9IGZ1bmN0aW9uICggbWV0aG9kICkgewoKCQkJX29wYXF1ZVNvcnQgPSBtZXRob2Q7CgoJCX07CgoJCXRoaXMuc2V0VHJhbnNwYXJlbnRTb3J0ID0gZnVuY3Rpb24gKCBtZXRob2QgKSB7CgoJCQlfdHJhbnNwYXJlbnRTb3J0ID0gbWV0aG9kOwoKCQl9OwoKCQkvLyBDbGVhcmluZwoKCQl0aGlzLmdldENsZWFyQ29sb3IgPSBmdW5jdGlvbiAoIHRhcmdldCApIHsKCgkJCXJldHVybiB0YXJnZXQuY29weSggYmFja2dyb3VuZC5nZXRDbGVhckNvbG9yKCkgKTsKCgkJfTsKCgkJdGhpcy5zZXRDbGVhckNvbG9yID0gZnVuY3Rpb24gKCkgewoKCQkJYmFja2dyb3VuZC5zZXRDbGVhckNvbG9yLmFwcGx5KCBiYWNrZ3JvdW5kLCBhcmd1bWVudHMgKTsKCgkJfTsKCgkJdGhpcy5nZXRDbGVhckFscGhhID0gZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIGJhY2tncm91bmQuZ2V0Q2xlYXJBbHBoYSgpOwoKCQl9OwoKCQl0aGlzLnNldENsZWFyQWxwaGEgPSBmdW5jdGlvbiAoKSB7CgoJCQliYWNrZ3JvdW5kLnNldENsZWFyQWxwaGEuYXBwbHkoIGJhY2tncm91bmQsIGFyZ3VtZW50cyApOwoKCQl9OwoKCQl0aGlzLmNsZWFyID0gZnVuY3Rpb24gKCBjb2xvciA9IHRydWUsIGRlcHRoID0gdHJ1ZSwgc3RlbmNpbCA9IHRydWUgKSB7CgoJCQlsZXQgYml0cyA9IDA7CgoJCQlpZiAoIGNvbG9yICkgewoKCQkJCS8vIGNoZWNrIGlmIHdlJ3JlIHRyeWluZyB0byBjbGVhciBhbiBpbnRlZ2VyIHRhcmdldAoJCQkJbGV0IGlzSW50ZWdlckZvcm1hdCA9IGZhbHNlOwoJCQkJaWYgKCBfY3VycmVudFJlbmRlclRhcmdldCAhPT0gbnVsbCApIHsKCgkJCQkJY29uc3QgdGFyZ2V0Rm9ybWF0ID0gX2N1cnJlbnRSZW5kZXJUYXJnZXQudGV4dHVyZS5mb3JtYXQ7CgkJCQkJaXNJbnRlZ2VyRm9ybWF0ID0gdGFyZ2V0Rm9ybWF0ID09PSBSR0JBSW50ZWdlckZvcm1hdCB8fAoJCQkJCQl0YXJnZXRGb3JtYXQgPT09IFJHSW50ZWdlckZvcm1hdCB8fAoJCQkJCQl0YXJnZXRGb3JtYXQgPT09IFJlZEludGVnZXJGb3JtYXQ7CgoJCQkJfQoKCQkJCS8vIHVzZSB0aGUgYXBwcm9wcmlhdGUgY2xlYXIgZnVuY3Rpb25zIHRvIGNsZWFyIHRoZSB0YXJnZXQgaWYgaXQncyBhIHNpZ25lZAoJCQkJLy8gb3IgdW5zaWduZWQgaW50ZWdlciB0YXJnZXQKCQkJCWlmICggaXNJbnRlZ2VyRm9ybWF0ICkgewoKCQkJCQljb25zdCB0YXJnZXRUeXBlID0gX2N1cnJlbnRSZW5kZXJUYXJnZXQudGV4dHVyZS50eXBlOwoJCQkJCWNvbnN0IGlzVW5zaWduZWRUeXBlID0gdGFyZ2V0VHlwZSA9PT0gVW5zaWduZWRCeXRlVHlwZSB8fAoJCQkJCQl0YXJnZXRUeXBlID09PSBVbnNpZ25lZEludFR5cGUgfHwKCQkJCQkJdGFyZ2V0VHlwZSA9PT0gVW5zaWduZWRTaG9ydFR5cGUgfHwKCQkJCQkJdGFyZ2V0VHlwZSA9PT0gVW5zaWduZWRJbnQyNDhUeXBlIHx8CgkJCQkJCXRhcmdldFR5cGUgPT09IFVuc2lnbmVkU2hvcnQ0NDQ0VHlwZSB8fAoJCQkJCQl0YXJnZXRUeXBlID09PSBVbnNpZ25lZFNob3J0NTU1MVR5cGU7CgoJCQkJCWNvbnN0IGNsZWFyQ29sb3IgPSBiYWNrZ3JvdW5kLmdldENsZWFyQ29sb3IoKTsKCQkJCQljb25zdCBhID0gYmFja2dyb3VuZC5nZXRDbGVhckFscGhhKCk7CgkJCQkJY29uc3QgciA9IGNsZWFyQ29sb3IucjsKCQkJCQljb25zdCBnID0gY2xlYXJDb2xvci5nOwoJCQkJCWNvbnN0IGIgPSBjbGVhckNvbG9yLmI7CgoJCQkJCWlmICggaXNVbnNpZ25lZFR5cGUgKSB7CgoJCQkJCQl1aW50Q2xlYXJDb2xvclsgMCBdID0gcjsKCQkJCQkJdWludENsZWFyQ29sb3JbIDEgXSA9IGc7CgkJCQkJCXVpbnRDbGVhckNvbG9yWyAyIF0gPSBiOwoJCQkJCQl1aW50Q2xlYXJDb2xvclsgMyBdID0gYTsKCQkJCQkJX2dsLmNsZWFyQnVmZmVydWl2KCBfZ2wuQ09MT1IsIDAsIHVpbnRDbGVhckNvbG9yICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlpbnRDbGVhckNvbG9yWyAwIF0gPSByOwoJCQkJCQlpbnRDbGVhckNvbG9yWyAxIF0gPSBnOwoJCQkJCQlpbnRDbGVhckNvbG9yWyAyIF0gPSBiOwoJCQkJCQlpbnRDbGVhckNvbG9yWyAzIF0gPSBhOwoJCQkJCQlfZ2wuY2xlYXJCdWZmZXJpdiggX2dsLkNPTE9SLCAwLCBpbnRDbGVhckNvbG9yICk7CgoJCQkJCX0KCgkJCQl9IGVsc2UgewoKCQkJCQliaXRzIHw9IF9nbC5DT0xPUl9CVUZGRVJfQklUOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggZGVwdGggKSBiaXRzIHw9IF9nbC5ERVBUSF9CVUZGRVJfQklUOwoJCQlpZiAoIHN0ZW5jaWwgKSBiaXRzIHw9IF9nbC5TVEVOQ0lMX0JVRkZFUl9CSVQ7CgoJCQlfZ2wuY2xlYXIoIGJpdHMgKTsKCgkJfTsKCgkJdGhpcy5jbGVhckNvbG9yID0gZnVuY3Rpb24gKCkgewoKCQkJdGhpcy5jbGVhciggdHJ1ZSwgZmFsc2UsIGZhbHNlICk7CgoJCX07CgoJCXRoaXMuY2xlYXJEZXB0aCA9IGZ1bmN0aW9uICgpIHsKCgkJCXRoaXMuY2xlYXIoIGZhbHNlLCB0cnVlLCBmYWxzZSApOwoKCQl9OwoKCQl0aGlzLmNsZWFyU3RlbmNpbCA9IGZ1bmN0aW9uICgpIHsKCgkJCXRoaXMuY2xlYXIoIGZhbHNlLCBmYWxzZSwgdHJ1ZSApOwoKCQl9OwoKCQkvLwoKCQl0aGlzLmRpc3Bvc2UgPSBmdW5jdGlvbiAoKSB7CgoJCQljYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3dlYmdsY29udGV4dGxvc3QnLCBvbkNvbnRleHRMb3N0LCBmYWxzZSApOwoJCQljYW52YXMucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3dlYmdsY29udGV4dHJlc3RvcmVkJywgb25Db250ZXh0UmVzdG9yZSwgZmFsc2UgKTsKCQkJY2FudmFzLnJlbW92ZUV2ZW50TGlzdGVuZXIoICd3ZWJnbGNvbnRleHRjcmVhdGlvbmVycm9yJywgb25Db250ZXh0Q3JlYXRpb25FcnJvciwgZmFsc2UgKTsKCgkJCXJlbmRlckxpc3RzLmRpc3Bvc2UoKTsKCQkJcmVuZGVyU3RhdGVzLmRpc3Bvc2UoKTsKCQkJcHJvcGVydGllcy5kaXNwb3NlKCk7CgkJCWN1YmVtYXBzLmRpc3Bvc2UoKTsKCQkJY3ViZXV2bWFwcy5kaXNwb3NlKCk7CgkJCW9iamVjdHMuZGlzcG9zZSgpOwoJCQliaW5kaW5nU3RhdGVzLmRpc3Bvc2UoKTsKCQkJdW5pZm9ybXNHcm91cHMuZGlzcG9zZSgpOwoJCQlwcm9ncmFtQ2FjaGUuZGlzcG9zZSgpOwoKCQkJeHIuZGlzcG9zZSgpOwoKCQkJeHIucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3Nlc3Npb25zdGFydCcsIG9uWFJTZXNzaW9uU3RhcnQgKTsKCQkJeHIucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ3Nlc3Npb25lbmQnLCBvblhSU2Vzc2lvbkVuZCApOwoKCQkJaWYgKCBfdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ICkgewoKCQkJCV90cmFuc21pc3Npb25SZW5kZXJUYXJnZXQuZGlzcG9zZSgpOwoJCQkJX3RyYW5zbWlzc2lvblJlbmRlclRhcmdldCA9IG51bGw7CgoJCQl9CgoJCQlhbmltYXRpb24uc3RvcCgpOwoKCQl9OwoKCQkvLyBFdmVudHMKCgkJZnVuY3Rpb24gb25Db250ZXh0TG9zdCggZXZlbnQgKSB7CgoJCQlldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoKCQkJY29uc29sZS5sb2coICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBDb250ZXh0IExvc3QuJyApOwoKCQkJX2lzQ29udGV4dExvc3QgPSB0cnVlOwoKCQl9CgoJCWZ1bmN0aW9uIG9uQ29udGV4dFJlc3RvcmUoIC8qIGV2ZW50ICovICkgewoKCQkJY29uc29sZS5sb2coICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBDb250ZXh0IFJlc3RvcmVkLicgKTsKCgkJCV9pc0NvbnRleHRMb3N0ID0gZmFsc2U7CgoJCQljb25zdCBpbmZvQXV0b1Jlc2V0ID0gaW5mby5hdXRvUmVzZXQ7CgkJCWNvbnN0IHNoYWRvd01hcEVuYWJsZWQgPSBzaGFkb3dNYXAuZW5hYmxlZDsKCQkJY29uc3Qgc2hhZG93TWFwQXV0b1VwZGF0ZSA9IHNoYWRvd01hcC5hdXRvVXBkYXRlOwoJCQljb25zdCBzaGFkb3dNYXBOZWVkc1VwZGF0ZSA9IHNoYWRvd01hcC5uZWVkc1VwZGF0ZTsKCQkJY29uc3Qgc2hhZG93TWFwVHlwZSA9IHNoYWRvd01hcC50eXBlOwoKCQkJaW5pdEdMQ29udGV4dCgpOwoKCQkJaW5mby5hdXRvUmVzZXQgPSBpbmZvQXV0b1Jlc2V0OwoJCQlzaGFkb3dNYXAuZW5hYmxlZCA9IHNoYWRvd01hcEVuYWJsZWQ7CgkJCXNoYWRvd01hcC5hdXRvVXBkYXRlID0gc2hhZG93TWFwQXV0b1VwZGF0ZTsKCQkJc2hhZG93TWFwLm5lZWRzVXBkYXRlID0gc2hhZG93TWFwTmVlZHNVcGRhdGU7CgkJCXNoYWRvd01hcC50eXBlID0gc2hhZG93TWFwVHlwZTsKCgkJfQoKCQlmdW5jdGlvbiBvbkNvbnRleHRDcmVhdGlvbkVycm9yKCBldmVudCApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBBIFdlYkdMIGNvbnRleHQgY291bGQgbm90IGJlIGNyZWF0ZWQuIFJlYXNvbjogJywgZXZlbnQuc3RhdHVzTWVzc2FnZSApOwoKCQl9CgoJCWZ1bmN0aW9uIG9uTWF0ZXJpYWxEaXNwb3NlKCBldmVudCApIHsKCgkJCWNvbnN0IG1hdGVyaWFsID0gZXZlbnQudGFyZ2V0OwoKCQkJbWF0ZXJpYWwucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Rpc3Bvc2UnLCBvbk1hdGVyaWFsRGlzcG9zZSApOwoKCQkJZGVhbGxvY2F0ZU1hdGVyaWFsKCBtYXRlcmlhbCApOwoKCQl9CgoJCS8vIEJ1ZmZlciBkZWFsbG9jYXRpb24KCgkJZnVuY3Rpb24gZGVhbGxvY2F0ZU1hdGVyaWFsKCBtYXRlcmlhbCApIHsKCgkJCXJlbGVhc2VNYXRlcmlhbFByb2dyYW1SZWZlcmVuY2VzKCBtYXRlcmlhbCApOwoKCQkJcHJvcGVydGllcy5yZW1vdmUoIG1hdGVyaWFsICk7CgoJCX0KCgoJCWZ1bmN0aW9uIHJlbGVhc2VNYXRlcmlhbFByb2dyYW1SZWZlcmVuY2VzKCBtYXRlcmlhbCApIHsKCgkJCWNvbnN0IHByb2dyYW1zID0gcHJvcGVydGllcy5nZXQoIG1hdGVyaWFsICkucHJvZ3JhbXM7CgoJCQlpZiAoIHByb2dyYW1zICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJcHJvZ3JhbXMuZm9yRWFjaCggZnVuY3Rpb24gKCBwcm9ncmFtICkgewoKCQkJCQlwcm9ncmFtQ2FjaGUucmVsZWFzZVByb2dyYW0oIHByb2dyYW0gKTsKCgkJCQl9ICk7CgoJCQkJaWYgKCBtYXRlcmlhbC5pc1NoYWRlck1hdGVyaWFsICkgewoKCQkJCQlwcm9ncmFtQ2FjaGUucmVsZWFzZVNoYWRlckNhY2hlKCBtYXRlcmlhbCApOwoKCQkJCX0KCgkJCX0KCgkJfQoKCQkvLyBCdWZmZXIgcmVuZGVyaW5nCgoJCXRoaXMucmVuZGVyQnVmZmVyRGlyZWN0ID0gZnVuY3Rpb24gKCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCwgZ3JvdXAgKSB7CgoJCQlpZiAoIHNjZW5lID09PSBudWxsICkgc2NlbmUgPSBfZW1wdHlTY2VuZTsgLy8gcmVuZGVyQnVmZmVyRGlyZWN0IHNlY29uZCBwYXJhbWV0ZXIgdXNlZCB0byBiZSBmb2cgKGNvdWxkIGJlIG51bGwpCgoJCQljb25zdCBmcm9udEZhY2VDVyA9ICggb2JqZWN0LmlzTWVzaCAmJiBvYmplY3QubWF0cml4V29ybGQuZGV0ZXJtaW5hbnQoKSA8IDAgKTsKCgkJCWNvbnN0IHByb2dyYW0gPSBzZXRQcm9ncmFtKCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCApOwoKCQkJc3RhdGUuc2V0TWF0ZXJpYWwoIG1hdGVyaWFsLCBmcm9udEZhY2VDVyApOwoKCQkJLy8KCgkJCWxldCBpbmRleCA9IGdlb21ldHJ5LmluZGV4OwoJCQlsZXQgcmFuZ2VGYWN0b3IgPSAxOwoKCQkJaWYgKCBtYXRlcmlhbC53aXJlZnJhbWUgPT09IHRydWUgKSB7CgoJCQkJaW5kZXggPSBnZW9tZXRyaWVzLmdldFdpcmVmcmFtZUF0dHJpYnV0ZSggZ2VvbWV0cnkgKTsKCgkJCQlpZiAoIGluZGV4ID09PSB1bmRlZmluZWQgKSByZXR1cm47CgoJCQkJcmFuZ2VGYWN0b3IgPSAyOwoKCQkJfQoKCQkJLy8KCgkJCWNvbnN0IGRyYXdSYW5nZSA9IGdlb21ldHJ5LmRyYXdSYW5nZTsKCQkJY29uc3QgcG9zaXRpb24gPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uOwoKCQkJbGV0IGRyYXdTdGFydCA9IGRyYXdSYW5nZS5zdGFydCAqIHJhbmdlRmFjdG9yOwoJCQlsZXQgZHJhd0VuZCA9ICggZHJhd1JhbmdlLnN0YXJ0ICsgZHJhd1JhbmdlLmNvdW50ICkgKiByYW5nZUZhY3RvcjsKCgkJCWlmICggZ3JvdXAgIT09IG51bGwgKSB7CgoJCQkJZHJhd1N0YXJ0ID0gTWF0aC5tYXgoIGRyYXdTdGFydCwgZ3JvdXAuc3RhcnQgKiByYW5nZUZhY3RvciApOwoJCQkJZHJhd0VuZCA9IE1hdGgubWluKCBkcmF3RW5kLCAoIGdyb3VwLnN0YXJ0ICsgZ3JvdXAuY291bnQgKSAqIHJhbmdlRmFjdG9yICk7CgoJCQl9CgoJCQlpZiAoIGluZGV4ICE9PSBudWxsICkgewoKCQkJCWRyYXdTdGFydCA9IE1hdGgubWF4KCBkcmF3U3RhcnQsIDAgKTsKCQkJCWRyYXdFbmQgPSBNYXRoLm1pbiggZHJhd0VuZCwgaW5kZXguY291bnQgKTsKCgkJCX0gZWxzZSBpZiAoIHBvc2l0aW9uICE9PSB1bmRlZmluZWQgJiYgcG9zaXRpb24gIT09IG51bGwgKSB7CgoJCQkJZHJhd1N0YXJ0ID0gTWF0aC5tYXgoIGRyYXdTdGFydCwgMCApOwoJCQkJZHJhd0VuZCA9IE1hdGgubWluKCBkcmF3RW5kLCBwb3NpdGlvbi5jb3VudCApOwoKCQkJfQoKCQkJY29uc3QgZHJhd0NvdW50ID0gZHJhd0VuZCAtIGRyYXdTdGFydDsKCgkJCWlmICggZHJhd0NvdW50IDwgMCB8fCBkcmF3Q291bnQgPT09IEluZmluaXR5ICkgcmV0dXJuOwoKCQkJLy8KCgkJCWJpbmRpbmdTdGF0ZXMuc2V0dXAoIG9iamVjdCwgbWF0ZXJpYWwsIHByb2dyYW0sIGdlb21ldHJ5LCBpbmRleCApOwoKCQkJbGV0IGF0dHJpYnV0ZTsKCQkJbGV0IHJlbmRlcmVyID0gYnVmZmVyUmVuZGVyZXI7CgoJCQlpZiAoIGluZGV4ICE9PSBudWxsICkgewoKCQkJCWF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXMuZ2V0KCBpbmRleCApOwoKCQkJCXJlbmRlcmVyID0gaW5kZXhlZEJ1ZmZlclJlbmRlcmVyOwoJCQkJcmVuZGVyZXIuc2V0SW5kZXgoIGF0dHJpYnV0ZSApOwoKCQkJfQoKCQkJLy8KCgkJCWlmICggb2JqZWN0LmlzTWVzaCApIHsKCgkJCQlpZiAoIG1hdGVyaWFsLndpcmVmcmFtZSA9PT0gdHJ1ZSApIHsKCgkJCQkJc3RhdGUuc2V0TGluZVdpZHRoKCBtYXRlcmlhbC53aXJlZnJhbWVMaW5ld2lkdGggKiBnZXRUYXJnZXRQaXhlbFJhdGlvKCkgKTsKCQkJCQlyZW5kZXJlci5zZXRNb2RlKCBfZ2wuTElORVMgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlyZW5kZXJlci5zZXRNb2RlKCBfZ2wuVFJJQU5HTEVTICk7CgoJCQkJfQoKCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzTGluZSApIHsKCgkJCQlsZXQgbGluZVdpZHRoID0gbWF0ZXJpYWwubGluZXdpZHRoOwoKCQkJCWlmICggbGluZVdpZHRoID09PSB1bmRlZmluZWQgKSBsaW5lV2lkdGggPSAxOyAvLyBOb3QgdXNpbmcgTGluZSpNYXRlcmlhbAoKCQkJCXN0YXRlLnNldExpbmVXaWR0aCggbGluZVdpZHRoICogZ2V0VGFyZ2V0UGl4ZWxSYXRpbygpICk7CgoJCQkJaWYgKCBvYmplY3QuaXNMaW5lU2VnbWVudHMgKSB7CgoJCQkJCXJlbmRlcmVyLnNldE1vZGUoIF9nbC5MSU5FUyApOwoKCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0xpbmVMb29wICkgewoKCQkJCQlyZW5kZXJlci5zZXRNb2RlKCBfZ2wuTElORV9MT09QICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLkxJTkVfU1RSSVAgKTsKCgkJCQl9CgoJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNQb2ludHMgKSB7CgoJCQkJcmVuZGVyZXIuc2V0TW9kZSggX2dsLlBPSU5UUyApOwoKCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzU3ByaXRlICkgewoKCQkJCXJlbmRlcmVyLnNldE1vZGUoIF9nbC5UUklBTkdMRVMgKTsKCgkJCX0KCgkJCWlmICggb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCApIHsKCgkJCQlyZW5kZXJlci5yZW5kZXJJbnN0YW5jZXMoIGRyYXdTdGFydCwgZHJhd0NvdW50LCBvYmplY3QuY291bnQgKTsKCgkJCX0gZWxzZSBpZiAoIGdlb21ldHJ5LmlzSW5zdGFuY2VkQnVmZmVyR2VvbWV0cnkgKSB7CgoJCQkJY29uc3QgbWF4SW5zdGFuY2VDb3VudCA9IGdlb21ldHJ5Ll9tYXhJbnN0YW5jZUNvdW50ICE9PSB1bmRlZmluZWQgPyBnZW9tZXRyeS5fbWF4SW5zdGFuY2VDb3VudCA6IEluZmluaXR5OwoJCQkJY29uc3QgaW5zdGFuY2VDb3VudCA9IE1hdGgubWluKCBnZW9tZXRyeS5pbnN0YW5jZUNvdW50LCBtYXhJbnN0YW5jZUNvdW50ICk7CgoJCQkJcmVuZGVyZXIucmVuZGVySW5zdGFuY2VzKCBkcmF3U3RhcnQsIGRyYXdDb3VudCwgaW5zdGFuY2VDb3VudCApOwoKCQkJfSBlbHNlIHsKCgkJCQlyZW5kZXJlci5yZW5kZXIoIGRyYXdTdGFydCwgZHJhd0NvdW50ICk7CgoJCQl9CgoJCX07CgoJCS8vIENvbXBpbGUKCgkJdGhpcy5jb21waWxlID0gZnVuY3Rpb24gKCBzY2VuZSwgY2FtZXJhICkgewoKCQkJZnVuY3Rpb24gcHJlcGFyZSggbWF0ZXJpYWwsIHNjZW5lLCBvYmplY3QgKSB7CgoJCQkJaWYgKCBtYXRlcmlhbC50cmFuc3BhcmVudCA9PT0gdHJ1ZSAmJiBtYXRlcmlhbC5zaWRlID09PSBEb3VibGVTaWRlICYmIG1hdGVyaWFsLmZvcmNlU2luZ2xlUGFzcyA9PT0gZmFsc2UgKSB7CgoJCQkJCW1hdGVyaWFsLnNpZGUgPSBCYWNrU2lkZTsKCQkJCQltYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgkJCQkJZ2V0UHJvZ3JhbSggbWF0ZXJpYWwsIHNjZW5lLCBvYmplY3QgKTsKCgkJCQkJbWF0ZXJpYWwuc2lkZSA9IEZyb250U2lkZTsKCQkJCQltYXRlcmlhbC5uZWVkc1VwZGF0ZSA9IHRydWU7CgkJCQkJZ2V0UHJvZ3JhbSggbWF0ZXJpYWwsIHNjZW5lLCBvYmplY3QgKTsKCgkJCQkJbWF0ZXJpYWwuc2lkZSA9IERvdWJsZVNpZGU7CgoJCQkJfSBlbHNlIHsKCgkJCQkJZ2V0UHJvZ3JhbSggbWF0ZXJpYWwsIHNjZW5lLCBvYmplY3QgKTsKCgkJCQl9CgoJCQl9CgoJCQljdXJyZW50UmVuZGVyU3RhdGUgPSByZW5kZXJTdGF0ZXMuZ2V0KCBzY2VuZSApOwoJCQljdXJyZW50UmVuZGVyU3RhdGUuaW5pdCgpOwoKCQkJcmVuZGVyU3RhdGVTdGFjay5wdXNoKCBjdXJyZW50UmVuZGVyU3RhdGUgKTsKCgkJCXNjZW5lLnRyYXZlcnNlVmlzaWJsZSggZnVuY3Rpb24gKCBvYmplY3QgKSB7CgoJCQkJaWYgKCBvYmplY3QuaXNMaWdodCAmJiBvYmplY3QubGF5ZXJzLnRlc3QoIGNhbWVyYS5sYXllcnMgKSApIHsKCgkJCQkJY3VycmVudFJlbmRlclN0YXRlLnB1c2hMaWdodCggb2JqZWN0ICk7CgoJCQkJCWlmICggb2JqZWN0LmNhc3RTaGFkb3cgKSB7CgoJCQkJCQljdXJyZW50UmVuZGVyU3RhdGUucHVzaFNoYWRvdyggb2JqZWN0ICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9ICk7CgoJCQljdXJyZW50UmVuZGVyU3RhdGUuc2V0dXBMaWdodHMoIF90aGlzLl91c2VMZWdhY3lMaWdodHMgKTsKCgkJCXNjZW5lLnRyYXZlcnNlKCBmdW5jdGlvbiAoIG9iamVjdCApIHsKCgkJCQljb25zdCBtYXRlcmlhbCA9IG9iamVjdC5tYXRlcmlhbDsKCgkJCQlpZiAoIG1hdGVyaWFsICkgewoKCQkJCQlpZiAoIEFycmF5LmlzQXJyYXkoIG1hdGVyaWFsICkgKSB7CgoJCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBtYXRlcmlhbC5sZW5ndGg7IGkgKysgKSB7CgoJCQkJCQkJY29uc3QgbWF0ZXJpYWwyID0gbWF0ZXJpYWxbIGkgXTsKCgkJCQkJCQlwcmVwYXJlKCBtYXRlcmlhbDIsIHNjZW5lLCBvYmplY3QgKTsKCgkJCQkJCX0KCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXByZXBhcmUoIG1hdGVyaWFsLCBzY2VuZSwgb2JqZWN0ICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9ICk7CgoJCQlyZW5kZXJTdGF0ZVN0YWNrLnBvcCgpOwoJCQljdXJyZW50UmVuZGVyU3RhdGUgPSBudWxsOwoKCQl9OwoKCQkvLyBBbmltYXRpb24gTG9vcAoKCQlsZXQgb25BbmltYXRpb25GcmFtZUNhbGxiYWNrID0gbnVsbDsKCgkJZnVuY3Rpb24gb25BbmltYXRpb25GcmFtZSggdGltZSApIHsKCgkJCWlmICggb25BbmltYXRpb25GcmFtZUNhbGxiYWNrICkgb25BbmltYXRpb25GcmFtZUNhbGxiYWNrKCB0aW1lICk7CgoJCX0KCgkJZnVuY3Rpb24gb25YUlNlc3Npb25TdGFydCgpIHsKCgkJCWFuaW1hdGlvbi5zdG9wKCk7CgoJCX0KCgkJZnVuY3Rpb24gb25YUlNlc3Npb25FbmQoKSB7CgoJCQlhbmltYXRpb24uc3RhcnQoKTsKCgkJfQoKCQljb25zdCBhbmltYXRpb24gPSBuZXcgV2ViR0xBbmltYXRpb24oKTsKCQlhbmltYXRpb24uc2V0QW5pbWF0aW9uTG9vcCggb25BbmltYXRpb25GcmFtZSApOwoKCQlpZiAoIHR5cGVvZiBzZWxmICE9PSAndW5kZWZpbmVkJyApIGFuaW1hdGlvbi5zZXRDb250ZXh0KCBzZWxmICk7CgoJCXRoaXMuc2V0QW5pbWF0aW9uTG9vcCA9IGZ1bmN0aW9uICggY2FsbGJhY2sgKSB7CgoJCQlvbkFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sgPSBjYWxsYmFjazsKCQkJeHIuc2V0QW5pbWF0aW9uTG9vcCggY2FsbGJhY2sgKTsKCgkJCSggY2FsbGJhY2sgPT09IG51bGwgKSA/IGFuaW1hdGlvbi5zdG9wKCkgOiBhbmltYXRpb24uc3RhcnQoKTsKCgkJfTsKCgkJeHIuYWRkRXZlbnRMaXN0ZW5lciggJ3Nlc3Npb25zdGFydCcsIG9uWFJTZXNzaW9uU3RhcnQgKTsKCQl4ci5hZGRFdmVudExpc3RlbmVyKCAnc2Vzc2lvbmVuZCcsIG9uWFJTZXNzaW9uRW5kICk7CgoJCS8vIFJlbmRlcmluZwoKCQl0aGlzLnJlbmRlciA9IGZ1bmN0aW9uICggc2NlbmUsIGNhbWVyYSApIHsKCgkJCWlmICggY2FtZXJhICE9PSB1bmRlZmluZWQgJiYgY2FtZXJhLmlzQ2FtZXJhICE9PSB0cnVlICkgewoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5XZWJHTFJlbmRlcmVyLnJlbmRlcjogY2FtZXJhIGlzIG5vdCBhbiBpbnN0YW5jZSBvZiBUSFJFRS5DYW1lcmEuJyApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJaWYgKCBfaXNDb250ZXh0TG9zdCA9PT0gdHJ1ZSApIHJldHVybjsKCgkJCS8vIHVwZGF0ZSBzY2VuZSBncmFwaAoKCQkJaWYgKCBzY2VuZS5tYXRyaXhXb3JsZEF1dG9VcGRhdGUgPT09IHRydWUgKSBzY2VuZS51cGRhdGVNYXRyaXhXb3JsZCgpOwoKCQkJLy8gdXBkYXRlIGNhbWVyYSBtYXRyaWNlcyBhbmQgZnJ1c3R1bQoKCQkJaWYgKCBjYW1lcmEucGFyZW50ID09PSBudWxsICYmIGNhbWVyYS5tYXRyaXhXb3JsZEF1dG9VcGRhdGUgPT09IHRydWUgKSBjYW1lcmEudXBkYXRlTWF0cml4V29ybGQoKTsKCgkJCWlmICggeHIuZW5hYmxlZCA9PT0gdHJ1ZSAmJiB4ci5pc1ByZXNlbnRpbmcgPT09IHRydWUgKSB7CgoJCQkJaWYgKCB4ci5jYW1lcmFBdXRvVXBkYXRlID09PSB0cnVlICkgeHIudXBkYXRlQ2FtZXJhKCBjYW1lcmEgKTsKCgkJCQljYW1lcmEgPSB4ci5nZXRDYW1lcmEoKTsgLy8gdXNlIFhSIGNhbWVyYSBmb3IgcmVuZGVyaW5nCgoJCQl9CgoJCQkvLwoJCQlpZiAoIHNjZW5lLmlzU2NlbmUgPT09IHRydWUgKSBzY2VuZS5vbkJlZm9yZVJlbmRlciggX3RoaXMsIHNjZW5lLCBjYW1lcmEsIF9jdXJyZW50UmVuZGVyVGFyZ2V0ICk7CgoJCQljdXJyZW50UmVuZGVyU3RhdGUgPSByZW5kZXJTdGF0ZXMuZ2V0KCBzY2VuZSwgcmVuZGVyU3RhdGVTdGFjay5sZW5ndGggKTsKCQkJY3VycmVudFJlbmRlclN0YXRlLmluaXQoKTsKCgkJCXJlbmRlclN0YXRlU3RhY2sucHVzaCggY3VycmVudFJlbmRlclN0YXRlICk7CgoJCQlfcHJvalNjcmVlbk1hdHJpeC5tdWx0aXBseU1hdHJpY2VzKCBjYW1lcmEucHJvamVjdGlvbk1hdHJpeCwgY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZSApOwoJCQlfZnJ1c3R1bS5zZXRGcm9tUHJvamVjdGlvbk1hdHJpeCggX3Byb2pTY3JlZW5NYXRyaXggKTsKCgkJCV9sb2NhbENsaXBwaW5nRW5hYmxlZCA9IHRoaXMubG9jYWxDbGlwcGluZ0VuYWJsZWQ7CgkJCV9jbGlwcGluZ0VuYWJsZWQgPSBjbGlwcGluZy5pbml0KCB0aGlzLmNsaXBwaW5nUGxhbmVzLCBfbG9jYWxDbGlwcGluZ0VuYWJsZWQgKTsKCgkJCWN1cnJlbnRSZW5kZXJMaXN0ID0gcmVuZGVyTGlzdHMuZ2V0KCBzY2VuZSwgcmVuZGVyTGlzdFN0YWNrLmxlbmd0aCApOwoJCQljdXJyZW50UmVuZGVyTGlzdC5pbml0KCk7CgoJCQlyZW5kZXJMaXN0U3RhY2sucHVzaCggY3VycmVudFJlbmRlckxpc3QgKTsKCgkJCXByb2plY3RPYmplY3QoIHNjZW5lLCBjYW1lcmEsIDAsIF90aGlzLnNvcnRPYmplY3RzICk7CgoJCQljdXJyZW50UmVuZGVyTGlzdC5maW5pc2goKTsKCgkJCWlmICggX3RoaXMuc29ydE9iamVjdHMgPT09IHRydWUgKSB7CgoJCQkJY3VycmVudFJlbmRlckxpc3Quc29ydCggX29wYXF1ZVNvcnQsIF90cmFuc3BhcmVudFNvcnQgKTsKCgkJCX0KCgkJCS8vCgoJCQl0aGlzLmluZm8ucmVuZGVyLmZyYW1lICsrOwoKCQkJaWYgKCBfY2xpcHBpbmdFbmFibGVkID09PSB0cnVlICkgY2xpcHBpbmcuYmVnaW5TaGFkb3dzKCk7CgoJCQljb25zdCBzaGFkb3dzQXJyYXkgPSBjdXJyZW50UmVuZGVyU3RhdGUuc3RhdGUuc2hhZG93c0FycmF5OwoKCQkJc2hhZG93TWFwLnJlbmRlciggc2hhZG93c0FycmF5LCBzY2VuZSwgY2FtZXJhICk7CgoJCQlpZiAoIF9jbGlwcGluZ0VuYWJsZWQgPT09IHRydWUgKSBjbGlwcGluZy5lbmRTaGFkb3dzKCk7CgoJCQkvLwoKCQkJaWYgKCB0aGlzLmluZm8uYXV0b1Jlc2V0ID09PSB0cnVlICkgdGhpcy5pbmZvLnJlc2V0KCk7CgoKCQkJLy8KCgkJCWJhY2tncm91bmQucmVuZGVyKCBjdXJyZW50UmVuZGVyTGlzdCwgc2NlbmUgKTsKCgkJCS8vIHJlbmRlciBzY2VuZQoKCQkJY3VycmVudFJlbmRlclN0YXRlLnNldHVwTGlnaHRzKCBfdGhpcy5fdXNlTGVnYWN5TGlnaHRzICk7CgoJCQlpZiAoIGNhbWVyYS5pc0FycmF5Q2FtZXJhICkgewoKCQkJCWNvbnN0IGNhbWVyYXMgPSBjYW1lcmEuY2FtZXJhczsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjYW1lcmFzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGNhbWVyYTIgPSBjYW1lcmFzWyBpIF07CgoJCQkJCXJlbmRlclNjZW5lKCBjdXJyZW50UmVuZGVyTGlzdCwgc2NlbmUsIGNhbWVyYTIsIGNhbWVyYTIudmlld3BvcnQgKTsKCgkJCQl9CgoJCQl9IGVsc2UgewoKCQkJCXJlbmRlclNjZW5lKCBjdXJyZW50UmVuZGVyTGlzdCwgc2NlbmUsIGNhbWVyYSApOwoKCQkJfQoKCQkJLy8KCgkJCWlmICggX2N1cnJlbnRSZW5kZXJUYXJnZXQgIT09IG51bGwgKSB7CgoJCQkJLy8gcmVzb2x2ZSBtdWx0aXNhbXBsZSByZW5kZXJidWZmZXJzIHRvIGEgc2luZ2xlLXNhbXBsZSB0ZXh0dXJlIGlmIG5lY2Vzc2FyeQoKCQkJCXRleHR1cmVzLnVwZGF0ZU11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0KCBfY3VycmVudFJlbmRlclRhcmdldCApOwoKCQkJCS8vIEdlbmVyYXRlIG1pcG1hcCBpZiB3ZSdyZSB1c2luZyBhbnkga2luZCBvZiBtaXBtYXAgZmlsdGVyaW5nCgoJCQkJdGV4dHVyZXMudXBkYXRlUmVuZGVyVGFyZ2V0TWlwbWFwKCBfY3VycmVudFJlbmRlclRhcmdldCApOwoKCQkJfQoKCQkJLy8KCgkJCWlmICggc2NlbmUuaXNTY2VuZSA9PT0gdHJ1ZSApIHNjZW5lLm9uQWZ0ZXJSZW5kZXIoIF90aGlzLCBzY2VuZSwgY2FtZXJhICk7CgoJCQkvLyBfZ2wuZmluaXNoKCk7CgoJCQliaW5kaW5nU3RhdGVzLnJlc2V0RGVmYXVsdFN0YXRlKCk7CgkJCV9jdXJyZW50TWF0ZXJpYWxJZCA9IC0gMTsKCQkJX2N1cnJlbnRDYW1lcmEgPSBudWxsOwoKCQkJcmVuZGVyU3RhdGVTdGFjay5wb3AoKTsKCgkJCWlmICggcmVuZGVyU3RhdGVTdGFjay5sZW5ndGggPiAwICkgewoKCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZSA9IHJlbmRlclN0YXRlU3RhY2tbIHJlbmRlclN0YXRlU3RhY2subGVuZ3RoIC0gMSBdOwoKCQkJfSBlbHNlIHsKCgkJCQljdXJyZW50UmVuZGVyU3RhdGUgPSBudWxsOwoKCQkJfQoKCQkJcmVuZGVyTGlzdFN0YWNrLnBvcCgpOwoKCQkJaWYgKCByZW5kZXJMaXN0U3RhY2subGVuZ3RoID4gMCApIHsKCgkJCQljdXJyZW50UmVuZGVyTGlzdCA9IHJlbmRlckxpc3RTdGFja1sgcmVuZGVyTGlzdFN0YWNrLmxlbmd0aCAtIDEgXTsKCgkJCX0gZWxzZSB7CgoJCQkJY3VycmVudFJlbmRlckxpc3QgPSBudWxsOwoKCQkJfQoKCQl9OwoKCQlmdW5jdGlvbiBwcm9qZWN0T2JqZWN0KCBvYmplY3QsIGNhbWVyYSwgZ3JvdXBPcmRlciwgc29ydE9iamVjdHMgKSB7CgoJCQlpZiAoIG9iamVjdC52aXNpYmxlID09PSBmYWxzZSApIHJldHVybjsKCgkJCWNvbnN0IHZpc2libGUgPSBvYmplY3QubGF5ZXJzLnRlc3QoIGNhbWVyYS5sYXllcnMgKTsKCgkJCWlmICggdmlzaWJsZSApIHsKCgkJCQlpZiAoIG9iamVjdC5pc0dyb3VwICkgewoKCQkJCQlncm91cE9yZGVyID0gb2JqZWN0LnJlbmRlck9yZGVyOwoKCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0xPRCApIHsKCgkJCQkJaWYgKCBvYmplY3QuYXV0b1VwZGF0ZSA9PT0gdHJ1ZSApIG9iamVjdC51cGRhdGUoIGNhbWVyYSApOwoKCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0xpZ2h0ICkgewoKCQkJCQljdXJyZW50UmVuZGVyU3RhdGUucHVzaExpZ2h0KCBvYmplY3QgKTsKCgkJCQkJaWYgKCBvYmplY3QuY2FzdFNoYWRvdyApIHsKCgkJCQkJCWN1cnJlbnRSZW5kZXJTdGF0ZS5wdXNoU2hhZG93KCBvYmplY3QgKTsKCgkJCQkJfQoKCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc1Nwcml0ZSApIHsKCgkJCQkJaWYgKCAhIG9iamVjdC5mcnVzdHVtQ3VsbGVkIHx8IF9mcnVzdHVtLmludGVyc2VjdHNTcHJpdGUoIG9iamVjdCApICkgewoKCQkJCQkJaWYgKCBzb3J0T2JqZWN0cyApIHsKCgkJCQkJCQlfdmVjdG9yMy5zZXRGcm9tTWF0cml4UG9zaXRpb24oIG9iamVjdC5tYXRyaXhXb3JsZCApCgkJCQkJCQkJLmFwcGx5TWF0cml4NCggX3Byb2pTY3JlZW5NYXRyaXggKTsKCgkJCQkJCX0KCgkJCQkJCWNvbnN0IGdlb21ldHJ5ID0gb2JqZWN0cy51cGRhdGUoIG9iamVjdCApOwoJCQkJCQljb25zdCBtYXRlcmlhbCA9IG9iamVjdC5tYXRlcmlhbDsKCgkJCQkJCWlmICggbWF0ZXJpYWwudmlzaWJsZSApIHsKCgkJCQkJCQljdXJyZW50UmVuZGVyTGlzdC5wdXNoKCBvYmplY3QsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXBPcmRlciwgX3ZlY3RvcjMueiwgbnVsbCApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfSBlbHNlIGlmICggb2JqZWN0LmlzTWVzaCB8fCBvYmplY3QuaXNMaW5lIHx8IG9iamVjdC5pc1BvaW50cyApIHsKCgkJCQkJaWYgKCAhIG9iamVjdC5mcnVzdHVtQ3VsbGVkIHx8IF9mcnVzdHVtLmludGVyc2VjdHNPYmplY3QoIG9iamVjdCApICkgewoKCQkJCQkJY29uc3QgZ2VvbWV0cnkgPSBvYmplY3RzLnVwZGF0ZSggb2JqZWN0ICk7CgkJCQkJCWNvbnN0IG1hdGVyaWFsID0gb2JqZWN0Lm1hdGVyaWFsOwoKCQkJCQkJaWYgKCBzb3J0T2JqZWN0cyApIHsKCgkJCQkJCQlpZiAoIG9iamVjdC5ib3VuZGluZ1NwaGVyZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQkJCQlpZiAoIG9iamVjdC5ib3VuZGluZ1NwaGVyZSA9PT0gbnVsbCApIG9iamVjdC5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTsKCQkJCQkJCQlfdmVjdG9yMy5jb3B5KCBvYmplY3QuYm91bmRpbmdTcGhlcmUuY2VudGVyICk7CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJaWYgKCBnZW9tZXRyeS5ib3VuZGluZ1NwaGVyZSA9PT0gbnVsbCApIGdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoJCQkJCQkJCV92ZWN0b3IzLmNvcHkoIGdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlLmNlbnRlciApOwoKCQkJCQkJCX0KCgkJCQkJCQlfdmVjdG9yMwoJCQkJCQkJCS5hcHBseU1hdHJpeDQoIG9iamVjdC5tYXRyaXhXb3JsZCApCgkJCQkJCQkJLmFwcGx5TWF0cml4NCggX3Byb2pTY3JlZW5NYXRyaXggKTsKCgkJCQkJCX0KCgkJCQkJCWlmICggQXJyYXkuaXNBcnJheSggbWF0ZXJpYWwgKSApIHsKCgkJCQkJCQljb25zdCBncm91cHMgPSBnZW9tZXRyeS5ncm91cHM7CgoJCQkJCQkJZm9yICggbGV0IGkgPSAwLCBsID0gZ3JvdXBzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJCQkJCWNvbnN0IGdyb3VwID0gZ3JvdXBzWyBpIF07CgkJCQkJCQkJY29uc3QgZ3JvdXBNYXRlcmlhbCA9IG1hdGVyaWFsWyBncm91cC5tYXRlcmlhbEluZGV4IF07CgoJCQkJCQkJCWlmICggZ3JvdXBNYXRlcmlhbCAmJiBncm91cE1hdGVyaWFsLnZpc2libGUgKSB7CgoJCQkJCQkJCQljdXJyZW50UmVuZGVyTGlzdC5wdXNoKCBvYmplY3QsIGdlb21ldHJ5LCBncm91cE1hdGVyaWFsLCBncm91cE9yZGVyLCBfdmVjdG9yMy56LCBncm91cCApOwoKCQkJCQkJCQl9CgoJCQkJCQkJfQoKCQkJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWwudmlzaWJsZSApIHsKCgkJCQkJCQljdXJyZW50UmVuZGVyTGlzdC5wdXNoKCBvYmplY3QsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXBPcmRlciwgX3ZlY3RvcjMueiwgbnVsbCApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJY29uc3QgY2hpbGRyZW4gPSBvYmplY3QuY2hpbGRyZW47CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjaGlsZHJlbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCXByb2plY3RPYmplY3QoIGNoaWxkcmVuWyBpIF0sIGNhbWVyYSwgZ3JvdXBPcmRlciwgc29ydE9iamVjdHMgKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiByZW5kZXJTY2VuZSggY3VycmVudFJlbmRlckxpc3QsIHNjZW5lLCBjYW1lcmEsIHZpZXdwb3J0ICkgewoKCQkJY29uc3Qgb3BhcXVlT2JqZWN0cyA9IGN1cnJlbnRSZW5kZXJMaXN0Lm9wYXF1ZTsKCQkJY29uc3QgdHJhbnNtaXNzaXZlT2JqZWN0cyA9IGN1cnJlbnRSZW5kZXJMaXN0LnRyYW5zbWlzc2l2ZTsKCQkJY29uc3QgdHJhbnNwYXJlbnRPYmplY3RzID0gY3VycmVudFJlbmRlckxpc3QudHJhbnNwYXJlbnQ7CgoJCQljdXJyZW50UmVuZGVyU3RhdGUuc2V0dXBMaWdodHNWaWV3KCBjYW1lcmEgKTsKCgkJCWlmICggX2NsaXBwaW5nRW5hYmxlZCA9PT0gdHJ1ZSApIGNsaXBwaW5nLnNldEdsb2JhbFN0YXRlKCBfdGhpcy5jbGlwcGluZ1BsYW5lcywgY2FtZXJhICk7CgoJCQlpZiAoIHRyYW5zbWlzc2l2ZU9iamVjdHMubGVuZ3RoID4gMCApIHJlbmRlclRyYW5zbWlzc2lvblBhc3MoIG9wYXF1ZU9iamVjdHMsIHRyYW5zbWlzc2l2ZU9iamVjdHMsIHNjZW5lLCBjYW1lcmEgKTsKCgkJCWlmICggdmlld3BvcnQgKSBzdGF0ZS52aWV3cG9ydCggX2N1cnJlbnRWaWV3cG9ydC5jb3B5KCB2aWV3cG9ydCApICk7CgoJCQlpZiAoIG9wYXF1ZU9iamVjdHMubGVuZ3RoID4gMCApIHJlbmRlck9iamVjdHMoIG9wYXF1ZU9iamVjdHMsIHNjZW5lLCBjYW1lcmEgKTsKCQkJaWYgKCB0cmFuc21pc3NpdmVPYmplY3RzLmxlbmd0aCA+IDAgKSByZW5kZXJPYmplY3RzKCB0cmFuc21pc3NpdmVPYmplY3RzLCBzY2VuZSwgY2FtZXJhICk7CgkJCWlmICggdHJhbnNwYXJlbnRPYmplY3RzLmxlbmd0aCA+IDAgKSByZW5kZXJPYmplY3RzKCB0cmFuc3BhcmVudE9iamVjdHMsIHNjZW5lLCBjYW1lcmEgKTsKCgkJCS8vIEVuc3VyZSBkZXB0aCBidWZmZXIgd3JpdGluZyBpcyBlbmFibGVkIHNvIGl0IGNhbiBiZSBjbGVhcmVkIG9uIG5leHQgcmVuZGVyCgoJCQlzdGF0ZS5idWZmZXJzLmRlcHRoLnNldFRlc3QoIHRydWUgKTsKCQkJc3RhdGUuYnVmZmVycy5kZXB0aC5zZXRNYXNrKCB0cnVlICk7CgkJCXN0YXRlLmJ1ZmZlcnMuY29sb3Iuc2V0TWFzayggdHJ1ZSApOwoKCQkJc3RhdGUuc2V0UG9seWdvbk9mZnNldCggZmFsc2UgKTsKCgkJfQoKCQlmdW5jdGlvbiByZW5kZXJUcmFuc21pc3Npb25QYXNzKCBvcGFxdWVPYmplY3RzLCB0cmFuc21pc3NpdmVPYmplY3RzLCBzY2VuZSwgY2FtZXJhICkgewoKCQkJY29uc3QgaXNXZWJHTDIgPSBjYXBhYmlsaXRpZXMuaXNXZWJHTDI7CgoJCQlpZiAoIF90cmFuc21pc3Npb25SZW5kZXJUYXJnZXQgPT09IG51bGwgKSB7CgoJCQkJX3RyYW5zbWlzc2lvblJlbmRlclRhcmdldCA9IG5ldyBXZWJHTFJlbmRlclRhcmdldCggMSwgMSwgewoJCQkJCWdlbmVyYXRlTWlwbWFwczogdHJ1ZSwKCQkJCQl0eXBlOiBleHRlbnNpb25zLmhhcyggJ0VYVF9jb2xvcl9idWZmZXJfaGFsZl9mbG9hdCcgKSA/IEhhbGZGbG9hdFR5cGUgOiBVbnNpZ25lZEJ5dGVUeXBlLAoJCQkJCW1pbkZpbHRlcjogTGluZWFyTWlwbWFwTGluZWFyRmlsdGVyLAoJCQkJCXNhbXBsZXM6ICggaXNXZWJHTDIgKSA/IDQgOiAwCgkJCQl9ICk7CgoJCQkJLy8gZGVidWcKCgkJCQkvKgoJCQkJY29uc3QgZ2VvbWV0cnkgPSBuZXcgUGxhbmVHZW9tZXRyeSgpOwoJCQkJY29uc3QgbWF0ZXJpYWwgPSBuZXcgTWVzaEJhc2ljTWF0ZXJpYWwoIHsgbWFwOiBfdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0LnRleHR1cmUgfSApOwoKCQkJCWNvbnN0IG1lc2ggPSBuZXcgTWVzaCggZ2VvbWV0cnksIG1hdGVyaWFsICk7CgkJCQlzY2VuZS5hZGQoIG1lc2ggKTsKCQkJCSovCgoJCQl9CgoJCQlfdGhpcy5nZXREcmF3aW5nQnVmZmVyU2l6ZSggX3ZlY3RvcjIgKTsKCgkJCWlmICggaXNXZWJHTDIgKSB7CgoJCQkJX3RyYW5zbWlzc2lvblJlbmRlclRhcmdldC5zZXRTaXplKCBfdmVjdG9yMi54LCBfdmVjdG9yMi55ICk7CgoJCQl9IGVsc2UgewoKCQkJCV90cmFuc21pc3Npb25SZW5kZXJUYXJnZXQuc2V0U2l6ZSggZmxvb3JQb3dlck9mVHdvKCBfdmVjdG9yMi54ICksIGZsb29yUG93ZXJPZlR3byggX3ZlY3RvcjIueSApICk7CgoJCQl9CgoJCQkvLwoKCQkJY29uc3QgY3VycmVudFJlbmRlclRhcmdldCA9IF90aGlzLmdldFJlbmRlclRhcmdldCgpOwoJCQlfdGhpcy5zZXRSZW5kZXJUYXJnZXQoIF90cmFuc21pc3Npb25SZW5kZXJUYXJnZXQgKTsKCgkJCV90aGlzLmdldENsZWFyQ29sb3IoIF9jdXJyZW50Q2xlYXJDb2xvciApOwoJCQlfY3VycmVudENsZWFyQWxwaGEgPSBfdGhpcy5nZXRDbGVhckFscGhhKCk7CgkJCWlmICggX2N1cnJlbnRDbGVhckFscGhhIDwgMSApIF90aGlzLnNldENsZWFyQ29sb3IoIDB4ZmZmZmZmLCAwLjUgKTsKCgkJCV90aGlzLmNsZWFyKCk7CgoJCQkvLyBUdXJuIG9mZiB0aGUgZmVhdHVyZXMgd2hpY2ggY2FuIGFmZmVjdCB0aGUgZnJhZyBjb2xvciBmb3Igb3BhcXVlIG9iamVjdHMgcGFzcy4KCQkJLy8gT3RoZXJ3aXNlIHRoZXkgYXJlIGFwcGxpZWQgdHdpY2UgaW4gb3BhcXVlIG9iamVjdHMgcGFzcyBhbmQgdHJhbnNtaXNzaW9uIG9iamVjdHMgcGFzcy4KCQkJY29uc3QgY3VycmVudFRvbmVNYXBwaW5nID0gX3RoaXMudG9uZU1hcHBpbmc7CgkJCV90aGlzLnRvbmVNYXBwaW5nID0gTm9Ub25lTWFwcGluZzsKCgkJCXJlbmRlck9iamVjdHMoIG9wYXF1ZU9iamVjdHMsIHNjZW5lLCBjYW1lcmEgKTsKCgkJCXRleHR1cmVzLnVwZGF0ZU11bHRpc2FtcGxlUmVuZGVyVGFyZ2V0KCBfdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ICk7CgkJCXRleHR1cmVzLnVwZGF0ZVJlbmRlclRhcmdldE1pcG1hcCggX3RyYW5zbWlzc2lvblJlbmRlclRhcmdldCApOwoKCQkJbGV0IHJlbmRlclRhcmdldE5lZWRzVXBkYXRlID0gZmFsc2U7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB0cmFuc21pc3NpdmVPYmplY3RzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJY29uc3QgcmVuZGVySXRlbSA9IHRyYW5zbWlzc2l2ZU9iamVjdHNbIGkgXTsKCgkJCQljb25zdCBvYmplY3QgPSByZW5kZXJJdGVtLm9iamVjdDsKCQkJCWNvbnN0IGdlb21ldHJ5ID0gcmVuZGVySXRlbS5nZW9tZXRyeTsKCQkJCWNvbnN0IG1hdGVyaWFsID0gcmVuZGVySXRlbS5tYXRlcmlhbDsKCQkJCWNvbnN0IGdyb3VwID0gcmVuZGVySXRlbS5ncm91cDsKCgkJCQlpZiAoIG1hdGVyaWFsLnNpZGUgPT09IERvdWJsZVNpZGUgJiYgb2JqZWN0LmxheWVycy50ZXN0KCBjYW1lcmEubGF5ZXJzICkgKSB7CgoJCQkJCWNvbnN0IGN1cnJlbnRTaWRlID0gbWF0ZXJpYWwuc2lkZTsKCgkJCQkJbWF0ZXJpYWwuc2lkZSA9IEJhY2tTaWRlOwoJCQkJCW1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQkJcmVuZGVyT2JqZWN0KCBvYmplY3QsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXAgKTsKCgkJCQkJbWF0ZXJpYWwuc2lkZSA9IGN1cnJlbnRTaWRlOwoJCQkJCW1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQkJcmVuZGVyVGFyZ2V0TmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggcmVuZGVyVGFyZ2V0TmVlZHNVcGRhdGUgPT09IHRydWUgKSB7CgoJCQkJdGV4dHVyZXMudXBkYXRlTXVsdGlzYW1wbGVSZW5kZXJUYXJnZXQoIF90cmFuc21pc3Npb25SZW5kZXJUYXJnZXQgKTsKCQkJCXRleHR1cmVzLnVwZGF0ZVJlbmRlclRhcmdldE1pcG1hcCggX3RyYW5zbWlzc2lvblJlbmRlclRhcmdldCApOwoKCQkJfQoKCQkJX3RoaXMuc2V0UmVuZGVyVGFyZ2V0KCBjdXJyZW50UmVuZGVyVGFyZ2V0ICk7CgoJCQlfdGhpcy5zZXRDbGVhckNvbG9yKCBfY3VycmVudENsZWFyQ29sb3IsIF9jdXJyZW50Q2xlYXJBbHBoYSApOwoKCQkJX3RoaXMudG9uZU1hcHBpbmcgPSBjdXJyZW50VG9uZU1hcHBpbmc7CgoJCX0KCgkJZnVuY3Rpb24gcmVuZGVyT2JqZWN0cyggcmVuZGVyTGlzdCwgc2NlbmUsIGNhbWVyYSApIHsKCgkJCWNvbnN0IG92ZXJyaWRlTWF0ZXJpYWwgPSBzY2VuZS5pc1NjZW5lID09PSB0cnVlID8gc2NlbmUub3ZlcnJpZGVNYXRlcmlhbCA6IG51bGw7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSByZW5kZXJMaXN0Lmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJY29uc3QgcmVuZGVySXRlbSA9IHJlbmRlckxpc3RbIGkgXTsKCgkJCQljb25zdCBvYmplY3QgPSByZW5kZXJJdGVtLm9iamVjdDsKCQkJCWNvbnN0IGdlb21ldHJ5ID0gcmVuZGVySXRlbS5nZW9tZXRyeTsKCQkJCWNvbnN0IG1hdGVyaWFsID0gb3ZlcnJpZGVNYXRlcmlhbCA9PT0gbnVsbCA/IHJlbmRlckl0ZW0ubWF0ZXJpYWwgOiBvdmVycmlkZU1hdGVyaWFsOwoJCQkJY29uc3QgZ3JvdXAgPSByZW5kZXJJdGVtLmdyb3VwOwoKCQkJCWlmICggb2JqZWN0LmxheWVycy50ZXN0KCBjYW1lcmEubGF5ZXJzICkgKSB7CgoJCQkJCXJlbmRlck9iamVjdCggb2JqZWN0LCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwICk7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCWZ1bmN0aW9uIHJlbmRlck9iamVjdCggb2JqZWN0LCBzY2VuZSwgY2FtZXJhLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGdyb3VwICkgewoKCQkJb2JqZWN0Lm9uQmVmb3JlUmVuZGVyKCBfdGhpcywgc2NlbmUsIGNhbWVyYSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBncm91cCApOwoKCQkJb2JqZWN0Lm1vZGVsVmlld01hdHJpeC5tdWx0aXBseU1hdHJpY2VzKCBjYW1lcmEubWF0cml4V29ybGRJbnZlcnNlLCBvYmplY3QubWF0cml4V29ybGQgKTsKCQkJb2JqZWN0Lm5vcm1hbE1hdHJpeC5nZXROb3JtYWxNYXRyaXgoIG9iamVjdC5tb2RlbFZpZXdNYXRyaXggKTsKCgkJCW1hdGVyaWFsLm9uQmVmb3JlUmVuZGVyKCBfdGhpcywgc2NlbmUsIGNhbWVyYSwgZ2VvbWV0cnksIG9iamVjdCwgZ3JvdXAgKTsKCgkJCWlmICggbWF0ZXJpYWwudHJhbnNwYXJlbnQgPT09IHRydWUgJiYgbWF0ZXJpYWwuc2lkZSA9PT0gRG91YmxlU2lkZSAmJiBtYXRlcmlhbC5mb3JjZVNpbmdsZVBhc3MgPT09IGZhbHNlICkgewoKCQkJCW1hdGVyaWFsLnNpZGUgPSBCYWNrU2lkZTsKCQkJCW1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCQkJCV90aGlzLnJlbmRlckJ1ZmZlckRpcmVjdCggY2FtZXJhLCBzY2VuZSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBvYmplY3QsIGdyb3VwICk7CgoJCQkJbWF0ZXJpYWwuc2lkZSA9IEZyb250U2lkZTsKCQkJCW1hdGVyaWFsLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCQkJCV90aGlzLnJlbmRlckJ1ZmZlckRpcmVjdCggY2FtZXJhLCBzY2VuZSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBvYmplY3QsIGdyb3VwICk7CgoJCQkJbWF0ZXJpYWwuc2lkZSA9IERvdWJsZVNpZGU7CgoJCQl9IGVsc2UgewoKCQkJCV90aGlzLnJlbmRlckJ1ZmZlckRpcmVjdCggY2FtZXJhLCBzY2VuZSwgZ2VvbWV0cnksIG1hdGVyaWFsLCBvYmplY3QsIGdyb3VwICk7CgoJCQl9CgoJCQlvYmplY3Qub25BZnRlclJlbmRlciggX3RoaXMsIHNjZW5lLCBjYW1lcmEsIGdlb21ldHJ5LCBtYXRlcmlhbCwgZ3JvdXAgKTsKCgkJfQoKCQlmdW5jdGlvbiBnZXRQcm9ncmFtKCBtYXRlcmlhbCwgc2NlbmUsIG9iamVjdCApIHsKCgkJCWlmICggc2NlbmUuaXNTY2VuZSAhPT0gdHJ1ZSApIHNjZW5lID0gX2VtcHR5U2NlbmU7IC8vIHNjZW5lIGNvdWxkIGJlIGEgTWVzaCwgTGluZSwgUG9pbnRzLCAuLi4KCgkJCWNvbnN0IG1hdGVyaWFsUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCBtYXRlcmlhbCApOwoKCQkJY29uc3QgbGlnaHRzID0gY3VycmVudFJlbmRlclN0YXRlLnN0YXRlLmxpZ2h0czsKCQkJY29uc3Qgc2hhZG93c0FycmF5ID0gY3VycmVudFJlbmRlclN0YXRlLnN0YXRlLnNoYWRvd3NBcnJheTsKCgkJCWNvbnN0IGxpZ2h0c1N0YXRlVmVyc2lvbiA9IGxpZ2h0cy5zdGF0ZS52ZXJzaW9uOwoKCQkJY29uc3QgcGFyYW1ldGVycyA9IHByb2dyYW1DYWNoZS5nZXRQYXJhbWV0ZXJzKCBtYXRlcmlhbCwgbGlnaHRzLnN0YXRlLCBzaGFkb3dzQXJyYXksIHNjZW5lLCBvYmplY3QgKTsKCQkJY29uc3QgcHJvZ3JhbUNhY2hlS2V5ID0gcHJvZ3JhbUNhY2hlLmdldFByb2dyYW1DYWNoZUtleSggcGFyYW1ldGVycyApOwoKCQkJbGV0IHByb2dyYW1zID0gbWF0ZXJpYWxQcm9wZXJ0aWVzLnByb2dyYW1zOwoKCQkJLy8gYWx3YXlzIHVwZGF0ZSBlbnZpcm9ubWVudCBhbmQgZm9nIC0gY2hhbmdpbmcgdGhlc2UgdHJpZ2dlciBhbiBnZXRQcm9ncmFtIGNhbGwsIGJ1dCBpdCdzIHBvc3NpYmxlIHRoYXQgdGhlIHByb2dyYW0gZG9lc24ndCBjaGFuZ2UKCgkJCW1hdGVyaWFsUHJvcGVydGllcy5lbnZpcm9ubWVudCA9IG1hdGVyaWFsLmlzTWVzaFN0YW5kYXJkTWF0ZXJpYWwgPyBzY2VuZS5lbnZpcm9ubWVudCA6IG51bGw7CgkJCW1hdGVyaWFsUHJvcGVydGllcy5mb2cgPSBzY2VuZS5mb2c7CgkJCW1hdGVyaWFsUHJvcGVydGllcy5lbnZNYXAgPSAoIG1hdGVyaWFsLmlzTWVzaFN0YW5kYXJkTWF0ZXJpYWwgPyBjdWJldXZtYXBzIDogY3ViZW1hcHMgKS5nZXQoIG1hdGVyaWFsLmVudk1hcCB8fCBtYXRlcmlhbFByb3BlcnRpZXMuZW52aXJvbm1lbnQgKTsKCgkJCWlmICggcHJvZ3JhbXMgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkvLyBuZXcgbWF0ZXJpYWwKCgkJCQltYXRlcmlhbC5hZGRFdmVudExpc3RlbmVyKCAnZGlzcG9zZScsIG9uTWF0ZXJpYWxEaXNwb3NlICk7CgoJCQkJcHJvZ3JhbXMgPSBuZXcgTWFwKCk7CgkJCQltYXRlcmlhbFByb3BlcnRpZXMucHJvZ3JhbXMgPSBwcm9ncmFtczsKCgkJCX0KCgkJCWxldCBwcm9ncmFtID0gcHJvZ3JhbXMuZ2V0KCBwcm9ncmFtQ2FjaGVLZXkgKTsKCgkJCWlmICggcHJvZ3JhbSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCS8vIGVhcmx5IG91dCBpZiBwcm9ncmFtIGFuZCBsaWdodCBzdGF0ZSBpcyBpZGVudGljYWwKCgkJCQlpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5jdXJyZW50UHJvZ3JhbSA9PT0gcHJvZ3JhbSAmJiBtYXRlcmlhbFByb3BlcnRpZXMubGlnaHRzU3RhdGVWZXJzaW9uID09PSBsaWdodHNTdGF0ZVZlcnNpb24gKSB7CgoJCQkJCXVwZGF0ZUNvbW1vbk1hdGVyaWFsUHJvcGVydGllcyggbWF0ZXJpYWwsIHBhcmFtZXRlcnMgKTsKCgkJCQkJcmV0dXJuIHByb2dyYW07CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQlwYXJhbWV0ZXJzLnVuaWZvcm1zID0gcHJvZ3JhbUNhY2hlLmdldFVuaWZvcm1zKCBtYXRlcmlhbCApOwoKCQkJCW1hdGVyaWFsLm9uQnVpbGQoIG9iamVjdCwgcGFyYW1ldGVycywgX3RoaXMgKTsKCgkJCQltYXRlcmlhbC5vbkJlZm9yZUNvbXBpbGUoIHBhcmFtZXRlcnMsIF90aGlzICk7CgoJCQkJcHJvZ3JhbSA9IHByb2dyYW1DYWNoZS5hY3F1aXJlUHJvZ3JhbSggcGFyYW1ldGVycywgcHJvZ3JhbUNhY2hlS2V5ICk7CgkJCQlwcm9ncmFtcy5zZXQoIHByb2dyYW1DYWNoZUtleSwgcHJvZ3JhbSApOwoKCQkJCW1hdGVyaWFsUHJvcGVydGllcy51bmlmb3JtcyA9IHBhcmFtZXRlcnMudW5pZm9ybXM7CgoJCQl9CgoJCQljb25zdCB1bmlmb3JtcyA9IG1hdGVyaWFsUHJvcGVydGllcy51bmlmb3JtczsKCgkJCWlmICggKCAhIG1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgJiYgISBtYXRlcmlhbC5pc1Jhd1NoYWRlck1hdGVyaWFsICkgfHwgbWF0ZXJpYWwuY2xpcHBpbmcgPT09IHRydWUgKSB7CgoJCQkJdW5pZm9ybXMuY2xpcHBpbmdQbGFuZXMgPSBjbGlwcGluZy51bmlmb3JtOwoKCQkJfQoKCQkJdXBkYXRlQ29tbW9uTWF0ZXJpYWxQcm9wZXJ0aWVzKCBtYXRlcmlhbCwgcGFyYW1ldGVycyApOwoKCQkJLy8gc3RvcmUgdGhlIGxpZ2h0IHNldHVwIGl0IHdhcyBjcmVhdGVkIGZvcgoKCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLm5lZWRzTGlnaHRzID0gbWF0ZXJpYWxOZWVkc0xpZ2h0cyggbWF0ZXJpYWwgKTsKCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmxpZ2h0c1N0YXRlVmVyc2lvbiA9IGxpZ2h0c1N0YXRlVmVyc2lvbjsKCgkJCWlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLm5lZWRzTGlnaHRzICkgewoKCQkJCS8vIHdpcmUgdXAgdGhlIG1hdGVyaWFsIHRvIHRoaXMgcmVuZGVyZXIncyBsaWdodGluZyBzdGF0ZQoKCQkJCXVuaWZvcm1zLmFtYmllbnRMaWdodENvbG9yLnZhbHVlID0gbGlnaHRzLnN0YXRlLmFtYmllbnQ7CgkJCQl1bmlmb3Jtcy5saWdodFByb2JlLnZhbHVlID0gbGlnaHRzLnN0YXRlLnByb2JlOwoJCQkJdW5pZm9ybXMuZGlyZWN0aW9uYWxMaWdodHMudmFsdWUgPSBsaWdodHMuc3RhdGUuZGlyZWN0aW9uYWw7CgkJCQl1bmlmb3Jtcy5kaXJlY3Rpb25hbExpZ2h0U2hhZG93cy52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5kaXJlY3Rpb25hbFNoYWRvdzsKCQkJCXVuaWZvcm1zLnNwb3RMaWdodHMudmFsdWUgPSBsaWdodHMuc3RhdGUuc3BvdDsKCQkJCXVuaWZvcm1zLnNwb3RMaWdodFNoYWRvd3MudmFsdWUgPSBsaWdodHMuc3RhdGUuc3BvdFNoYWRvdzsKCQkJCXVuaWZvcm1zLnJlY3RBcmVhTGlnaHRzLnZhbHVlID0gbGlnaHRzLnN0YXRlLnJlY3RBcmVhOwoJCQkJdW5pZm9ybXMubHRjXzEudmFsdWUgPSBsaWdodHMuc3RhdGUucmVjdEFyZWFMVEMxOwoJCQkJdW5pZm9ybXMubHRjXzIudmFsdWUgPSBsaWdodHMuc3RhdGUucmVjdEFyZWFMVEMyOwoJCQkJdW5pZm9ybXMucG9pbnRMaWdodHMudmFsdWUgPSBsaWdodHMuc3RhdGUucG9pbnQ7CgkJCQl1bmlmb3Jtcy5wb2ludExpZ2h0U2hhZG93cy52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5wb2ludFNoYWRvdzsKCQkJCXVuaWZvcm1zLmhlbWlzcGhlcmVMaWdodHMudmFsdWUgPSBsaWdodHMuc3RhdGUuaGVtaTsKCgkJCQl1bmlmb3Jtcy5kaXJlY3Rpb25hbFNoYWRvd01hcC52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5kaXJlY3Rpb25hbFNoYWRvd01hcDsKCQkJCXVuaWZvcm1zLmRpcmVjdGlvbmFsU2hhZG93TWF0cml4LnZhbHVlID0gbGlnaHRzLnN0YXRlLmRpcmVjdGlvbmFsU2hhZG93TWF0cml4OwoJCQkJdW5pZm9ybXMuc3BvdFNoYWRvd01hcC52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5zcG90U2hhZG93TWFwOwoJCQkJdW5pZm9ybXMuc3BvdExpZ2h0TWF0cml4LnZhbHVlID0gbGlnaHRzLnN0YXRlLnNwb3RMaWdodE1hdHJpeDsKCQkJCXVuaWZvcm1zLnNwb3RMaWdodE1hcC52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5zcG90TGlnaHRNYXA7CgkJCQl1bmlmb3Jtcy5wb2ludFNoYWRvd01hcC52YWx1ZSA9IGxpZ2h0cy5zdGF0ZS5wb2ludFNoYWRvd01hcDsKCQkJCXVuaWZvcm1zLnBvaW50U2hhZG93TWF0cml4LnZhbHVlID0gbGlnaHRzLnN0YXRlLnBvaW50U2hhZG93TWF0cml4OwoJCQkJLy8gVE9ETyAoYWJlbG5hdGlvbik6IGFkZCBhcmVhIGxpZ2h0cyBzaGFkb3cgaW5mbyB0byB1bmlmb3JtcwoKCQkJfQoKCQkJY29uc3QgcHJvZ1VuaWZvcm1zID0gcHJvZ3JhbS5nZXRVbmlmb3JtcygpOwoJCQljb25zdCB1bmlmb3Jtc0xpc3QgPSBXZWJHTFVuaWZvcm1zLnNlcVdpdGhWYWx1ZSggcHJvZ1VuaWZvcm1zLnNlcSwgdW5pZm9ybXMgKTsKCgkJCW1hdGVyaWFsUHJvcGVydGllcy5jdXJyZW50UHJvZ3JhbSA9IHByb2dyYW07CgkJCW1hdGVyaWFsUHJvcGVydGllcy51bmlmb3Jtc0xpc3QgPSB1bmlmb3Jtc0xpc3Q7CgoJCQlyZXR1cm4gcHJvZ3JhbTsKCgkJfQoKCQlmdW5jdGlvbiB1cGRhdGVDb21tb25NYXRlcmlhbFByb3BlcnRpZXMoIG1hdGVyaWFsLCBwYXJhbWV0ZXJzICkgewoKCQkJY29uc3QgbWF0ZXJpYWxQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIG1hdGVyaWFsICk7CgoJCQltYXRlcmlhbFByb3BlcnRpZXMub3V0cHV0Q29sb3JTcGFjZSA9IHBhcmFtZXRlcnMub3V0cHV0Q29sb3JTcGFjZTsKCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLmluc3RhbmNpbmcgPSBwYXJhbWV0ZXJzLmluc3RhbmNpbmc7CgkJCW1hdGVyaWFsUHJvcGVydGllcy5pbnN0YW5jaW5nQ29sb3IgPSBwYXJhbWV0ZXJzLmluc3RhbmNpbmdDb2xvcjsKCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnNraW5uaW5nID0gcGFyYW1ldGVycy5za2lubmluZzsKCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLm1vcnBoVGFyZ2V0cyA9IHBhcmFtZXRlcnMubW9ycGhUYXJnZXRzOwoJCQltYXRlcmlhbFByb3BlcnRpZXMubW9ycGhOb3JtYWxzID0gcGFyYW1ldGVycy5tb3JwaE5vcm1hbHM7CgkJCW1hdGVyaWFsUHJvcGVydGllcy5tb3JwaENvbG9ycyA9IHBhcmFtZXRlcnMubW9ycGhDb2xvcnM7CgkJCW1hdGVyaWFsUHJvcGVydGllcy5tb3JwaFRhcmdldHNDb3VudCA9IHBhcmFtZXRlcnMubW9ycGhUYXJnZXRzQ291bnQ7CgkJCW1hdGVyaWFsUHJvcGVydGllcy5udW1DbGlwcGluZ1BsYW5lcyA9IHBhcmFtZXRlcnMubnVtQ2xpcHBpbmdQbGFuZXM7CgkJCW1hdGVyaWFsUHJvcGVydGllcy5udW1JbnRlcnNlY3Rpb24gPSBwYXJhbWV0ZXJzLm51bUNsaXBJbnRlcnNlY3Rpb247CgkJCW1hdGVyaWFsUHJvcGVydGllcy52ZXJ0ZXhBbHBoYXMgPSBwYXJhbWV0ZXJzLnZlcnRleEFscGhhczsKCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnZlcnRleFRhbmdlbnRzID0gcGFyYW1ldGVycy52ZXJ0ZXhUYW5nZW50czsKCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnRvbmVNYXBwaW5nID0gcGFyYW1ldGVycy50b25lTWFwcGluZzsKCgkJfQoKCQlmdW5jdGlvbiBzZXRQcm9ncmFtKCBjYW1lcmEsIHNjZW5lLCBnZW9tZXRyeSwgbWF0ZXJpYWwsIG9iamVjdCApIHsKCgkJCWlmICggc2NlbmUuaXNTY2VuZSAhPT0gdHJ1ZSApIHNjZW5lID0gX2VtcHR5U2NlbmU7IC8vIHNjZW5lIGNvdWxkIGJlIGEgTWVzaCwgTGluZSwgUG9pbnRzLCAuLi4KCgkJCXRleHR1cmVzLnJlc2V0VGV4dHVyZVVuaXRzKCk7CgoJCQljb25zdCBmb2cgPSBzY2VuZS5mb2c7CgkJCWNvbnN0IGVudmlyb25tZW50ID0gbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCA/IHNjZW5lLmVudmlyb25tZW50IDogbnVsbDsKCQkJY29uc3QgY29sb3JTcGFjZSA9ICggX2N1cnJlbnRSZW5kZXJUYXJnZXQgPT09IG51bGwgKSA/IF90aGlzLm91dHB1dENvbG9yU3BhY2UgOiAoIF9jdXJyZW50UmVuZGVyVGFyZ2V0LmlzWFJSZW5kZXJUYXJnZXQgPT09IHRydWUgPyBfY3VycmVudFJlbmRlclRhcmdldC50ZXh0dXJlLmNvbG9yU3BhY2UgOiBMaW5lYXJTUkdCQ29sb3JTcGFjZSApOwoJCQljb25zdCBlbnZNYXAgPSAoIG1hdGVyaWFsLmlzTWVzaFN0YW5kYXJkTWF0ZXJpYWwgPyBjdWJldXZtYXBzIDogY3ViZW1hcHMgKS5nZXQoIG1hdGVyaWFsLmVudk1hcCB8fCBlbnZpcm9ubWVudCApOwoJCQljb25zdCB2ZXJ0ZXhBbHBoYXMgPSBtYXRlcmlhbC52ZXJ0ZXhDb2xvcnMgPT09IHRydWUgJiYgISEgZ2VvbWV0cnkuYXR0cmlidXRlcy5jb2xvciAmJiBnZW9tZXRyeS5hdHRyaWJ1dGVzLmNvbG9yLml0ZW1TaXplID09PSA0OwoJCQljb25zdCB2ZXJ0ZXhUYW5nZW50cyA9ICEhIGdlb21ldHJ5LmF0dHJpYnV0ZXMudGFuZ2VudCAmJiAoICEhIG1hdGVyaWFsLm5vcm1hbE1hcCB8fCBtYXRlcmlhbC5hbmlzb3Ryb3B5ID4gMCApOwoJCQljb25zdCBtb3JwaFRhcmdldHMgPSAhISBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb247CgkJCWNvbnN0IG1vcnBoTm9ybWFscyA9ICEhIGdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlcy5ub3JtYWw7CgkJCWNvbnN0IG1vcnBoQ29sb3JzID0gISEgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLmNvbG9yOwoKCQkJbGV0IHRvbmVNYXBwaW5nID0gTm9Ub25lTWFwcGluZzsKCgkJCWlmICggbWF0ZXJpYWwudG9uZU1hcHBlZCApIHsKCgkJCQlpZiAoIF9jdXJyZW50UmVuZGVyVGFyZ2V0ID09PSBudWxsIHx8IF9jdXJyZW50UmVuZGVyVGFyZ2V0LmlzWFJSZW5kZXJUYXJnZXQgPT09IHRydWUgKSB7CgoJCQkJCXRvbmVNYXBwaW5nID0gX3RoaXMudG9uZU1hcHBpbmc7CgoJCQkJfQoKCQkJfQoKCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGUgPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMucG9zaXRpb24gfHwgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLm5vcm1hbCB8fCBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXMuY29sb3I7CgkJCWNvbnN0IG1vcnBoVGFyZ2V0c0NvdW50ID0gKCBtb3JwaEF0dHJpYnV0ZSAhPT0gdW5kZWZpbmVkICkgPyBtb3JwaEF0dHJpYnV0ZS5sZW5ndGggOiAwOwoKCQkJY29uc3QgbWF0ZXJpYWxQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIG1hdGVyaWFsICk7CgkJCWNvbnN0IGxpZ2h0cyA9IGN1cnJlbnRSZW5kZXJTdGF0ZS5zdGF0ZS5saWdodHM7CgoJCQlpZiAoIF9jbGlwcGluZ0VuYWJsZWQgPT09IHRydWUgKSB7CgoJCQkJaWYgKCBfbG9jYWxDbGlwcGluZ0VuYWJsZWQgPT09IHRydWUgfHwgY2FtZXJhICE9PSBfY3VycmVudENhbWVyYSApIHsKCgkJCQkJY29uc3QgdXNlQ2FjaGUgPQoJCQkJCQljYW1lcmEgPT09IF9jdXJyZW50Q2FtZXJhICYmCgkJCQkJCW1hdGVyaWFsLmlkID09PSBfY3VycmVudE1hdGVyaWFsSWQ7CgoJCQkJCS8vIHdlIG1pZ2h0IHdhbnQgdG8gY2FsbCB0aGlzIGZ1bmN0aW9uIHdpdGggc29tZSBDbGlwcGluZ0dyb3VwCgkJCQkJLy8gb2JqZWN0IGluc3RlYWQgb2YgdGhlIG1hdGVyaWFsLCBvbmNlIGl0IGJlY29tZXMgZmVhc2libGUKCQkJCQkvLyAoIzg0NjUsICM4Mzc5KQoJCQkJCWNsaXBwaW5nLnNldFN0YXRlKCBtYXRlcmlhbCwgY2FtZXJhLCB1c2VDYWNoZSApOwoKCQkJCX0KCgkJCX0KCgkJCS8vCgoJCQlsZXQgbmVlZHNQcm9ncmFtQ2hhbmdlID0gZmFsc2U7CgoJCQlpZiAoIG1hdGVyaWFsLnZlcnNpb24gPT09IG1hdGVyaWFsUHJvcGVydGllcy5fX3ZlcnNpb24gKSB7CgoJCQkJaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMubmVlZHNMaWdodHMgJiYgKCBtYXRlcmlhbFByb3BlcnRpZXMubGlnaHRzU3RhdGVWZXJzaW9uICE9PSBsaWdodHMuc3RhdGUudmVyc2lvbiApICkgewoKCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5vdXRwdXRDb2xvclNwYWNlICE9PSBjb2xvclNwYWNlICkgewoKCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmluc3RhbmNpbmcgPT09IGZhbHNlICkgewoKCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCX0gZWxzZSBpZiAoICEgb2JqZWN0LmlzSW5zdGFuY2VkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuaW5zdGFuY2luZyA9PT0gdHJ1ZSApIHsKCgkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNTa2lubmVkTWVzaCAmJiBtYXRlcmlhbFByb3BlcnRpZXMuc2tpbm5pbmcgPT09IGZhbHNlICkgewoKCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCX0gZWxzZSBpZiAoICEgb2JqZWN0LmlzU2tpbm5lZE1lc2ggJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLnNraW5uaW5nID09PSB0cnVlICkgewoKCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCX0gZWxzZSBpZiAoIG9iamVjdC5pc0luc3RhbmNlZE1lc2ggJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmluc3RhbmNpbmdDb2xvciA9PT0gdHJ1ZSAmJiBvYmplY3QuaW5zdGFuY2VDb2xvciA9PT0gbnVsbCApIHsKCgkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCQl9IGVsc2UgaWYgKCBvYmplY3QuaXNJbnN0YW5jZWRNZXNoICYmIG1hdGVyaWFsUHJvcGVydGllcy5pbnN0YW5jaW5nQ29sb3IgPT09IGZhbHNlICYmIG9iamVjdC5pbnN0YW5jZUNvbG9yICE9PSBudWxsICkgewoKCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5lbnZNYXAgIT09IGVudk1hcCApIHsKCgkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbC5mb2cgPT09IHRydWUgJiYgbWF0ZXJpYWxQcm9wZXJ0aWVzLmZvZyAhPT0gZm9nICkgewoKCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5udW1DbGlwcGluZ1BsYW5lcyAhPT0gdW5kZWZpbmVkICYmCgkJCQkJKCBtYXRlcmlhbFByb3BlcnRpZXMubnVtQ2xpcHBpbmdQbGFuZXMgIT09IGNsaXBwaW5nLm51bVBsYW5lcyB8fAoJCQkJCW1hdGVyaWFsUHJvcGVydGllcy5udW1JbnRlcnNlY3Rpb24gIT09IGNsaXBwaW5nLm51bUludGVyc2VjdGlvbiApICkgewoKCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy52ZXJ0ZXhBbHBoYXMgIT09IHZlcnRleEFscGhhcyApIHsKCgkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMudmVydGV4VGFuZ2VudHMgIT09IHZlcnRleFRhbmdlbnRzICkgewoKCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCX0gZWxzZSBpZiAoIG1hdGVyaWFsUHJvcGVydGllcy5tb3JwaFRhcmdldHMgIT09IG1vcnBoVGFyZ2V0cyApIHsKCgkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMubW9ycGhOb3JtYWxzICE9PSBtb3JwaE5vcm1hbHMgKSB7CgoJCQkJCW5lZWRzUHJvZ3JhbUNoYW5nZSA9IHRydWU7CgoJCQkJfSBlbHNlIGlmICggbWF0ZXJpYWxQcm9wZXJ0aWVzLm1vcnBoQ29sb3JzICE9PSBtb3JwaENvbG9ycyApIHsKCgkJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCgkJCQl9IGVsc2UgaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMudG9uZU1hcHBpbmcgIT09IHRvbmVNYXBwaW5nICkgewoKCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCX0gZWxzZSBpZiAoIGNhcGFiaWxpdGllcy5pc1dlYkdMMiA9PT0gdHJ1ZSAmJiBtYXRlcmlhbFByb3BlcnRpZXMubW9ycGhUYXJnZXRzQ291bnQgIT09IG1vcnBoVGFyZ2V0c0NvdW50ICkgewoKCQkJCQluZWVkc1Byb2dyYW1DaGFuZ2UgPSB0cnVlOwoKCQkJCX0KCgkJCX0gZWxzZSB7CgoJCQkJbmVlZHNQcm9ncmFtQ2hhbmdlID0gdHJ1ZTsKCQkJCW1hdGVyaWFsUHJvcGVydGllcy5fX3ZlcnNpb24gPSBtYXRlcmlhbC52ZXJzaW9uOwoKCQkJfQoKCQkJLy8KCgkJCWxldCBwcm9ncmFtID0gbWF0ZXJpYWxQcm9wZXJ0aWVzLmN1cnJlbnRQcm9ncmFtOwoKCQkJaWYgKCBuZWVkc1Byb2dyYW1DaGFuZ2UgPT09IHRydWUgKSB7CgoJCQkJcHJvZ3JhbSA9IGdldFByb2dyYW0oIG1hdGVyaWFsLCBzY2VuZSwgb2JqZWN0ICk7CgoJCQl9CgoJCQlsZXQgcmVmcmVzaFByb2dyYW0gPSBmYWxzZTsKCQkJbGV0IHJlZnJlc2hNYXRlcmlhbCA9IGZhbHNlOwoJCQlsZXQgcmVmcmVzaExpZ2h0cyA9IGZhbHNlOwoKCQkJY29uc3QgcF91bmlmb3JtcyA9IHByb2dyYW0uZ2V0VW5pZm9ybXMoKSwKCQkJCW1fdW5pZm9ybXMgPSBtYXRlcmlhbFByb3BlcnRpZXMudW5pZm9ybXM7CgoJCQlpZiAoIHN0YXRlLnVzZVByb2dyYW0oIHByb2dyYW0ucHJvZ3JhbSApICkgewoKCQkJCXJlZnJlc2hQcm9ncmFtID0gdHJ1ZTsKCQkJCXJlZnJlc2hNYXRlcmlhbCA9IHRydWU7CgkJCQlyZWZyZXNoTGlnaHRzID0gdHJ1ZTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuaWQgIT09IF9jdXJyZW50TWF0ZXJpYWxJZCApIHsKCgkJCQlfY3VycmVudE1hdGVyaWFsSWQgPSBtYXRlcmlhbC5pZDsKCgkJCQlyZWZyZXNoTWF0ZXJpYWwgPSB0cnVlOwoKCQkJfQoKCQkJaWYgKCByZWZyZXNoUHJvZ3JhbSB8fCBfY3VycmVudENhbWVyYSAhPT0gY2FtZXJhICkgewoKCQkJCS8vIGNvbW1vbiBjYW1lcmEgdW5pZm9ybXMKCgkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdwcm9qZWN0aW9uTWF0cml4JywgY2FtZXJhLnByb2plY3Rpb25NYXRyaXggKTsKCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ3ZpZXdNYXRyaXgnLCBjYW1lcmEubWF0cml4V29ybGRJbnZlcnNlICk7CgoJCQkJY29uc3QgdUNhbVBvcyA9IHBfdW5pZm9ybXMubWFwLmNhbWVyYVBvc2l0aW9uOwoKCQkJCWlmICggdUNhbVBvcyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQl1Q2FtUG9zLnNldFZhbHVlKCBfZ2wsIF92ZWN0b3IzLnNldEZyb21NYXRyaXhQb3NpdGlvbiggY2FtZXJhLm1hdHJpeFdvcmxkICkgKTsKCgkJCQl9CgoJCQkJaWYgKCBjYXBhYmlsaXRpZXMubG9nYXJpdGhtaWNEZXB0aEJ1ZmZlciApIHsKCgkJCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAnbG9nRGVwdGhCdWZGQycsCgkJCQkJCTIuMCAvICggTWF0aC5sb2coIGNhbWVyYS5mYXIgKyAxLjAgKSAvIE1hdGguTE4yICkgKTsKCgkJCQl9CgoJCQkJLy8gY29uc2lkZXIgbW92aW5nIGlzT3J0aG9ncmFwaGljIHRvIFVuaWZvcm1MaWIgYW5kIFdlYkdMTWF0ZXJpYWxzLCBzZWUgaHR0cHM6Ly9naXRodWIuY29tL21yZG9vYi90aHJlZS5qcy9wdWxsLzI2NDY3I2lzc3VlY29tbWVudC0xNjQ1MTg1MDY3CgoJCQkJaWYgKCBtYXRlcmlhbC5pc01lc2hQaG9uZ01hdGVyaWFsIHx8CgkJCQkJbWF0ZXJpYWwuaXNNZXNoVG9vbk1hdGVyaWFsIHx8CgkJCQkJbWF0ZXJpYWwuaXNNZXNoTGFtYmVydE1hdGVyaWFsIHx8CgkJCQkJbWF0ZXJpYWwuaXNNZXNoQmFzaWNNYXRlcmlhbCB8fAoJCQkJCW1hdGVyaWFsLmlzTWVzaFN0YW5kYXJkTWF0ZXJpYWwgfHwKCQkJCQltYXRlcmlhbC5pc1NoYWRlck1hdGVyaWFsICkgewoKCQkJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdpc09ydGhvZ3JhcGhpYycsIGNhbWVyYS5pc09ydGhvZ3JhcGhpY0NhbWVyYSA9PT0gdHJ1ZSApOwoKCQkJCX0KCgkJCQlpZiAoIF9jdXJyZW50Q2FtZXJhICE9PSBjYW1lcmEgKSB7CgoJCQkJCV9jdXJyZW50Q2FtZXJhID0gY2FtZXJhOwoKCQkJCQkvLyBsaWdodGluZyB1bmlmb3JtcyBkZXBlbmQgb24gdGhlIGNhbWVyYSBzbyBlbmZvcmNlIGFuIHVwZGF0ZQoJCQkJCS8vIG5vdywgaW4gY2FzZSB0aGlzIG1hdGVyaWFsIHN1cHBvcnRzIGxpZ2h0cyAtIG9yIGxhdGVyLCB3aGVuCgkJCQkJLy8gdGhlIG5leHQgbWF0ZXJpYWwgdGhhdCBkb2VzIGdldHMgYWN0aXZhdGVkOgoKCQkJCQlyZWZyZXNoTWF0ZXJpYWwgPSB0cnVlOwkJLy8gc2V0IHRvIHRydWUgb24gbWF0ZXJpYWwgY2hhbmdlCgkJCQkJcmVmcmVzaExpZ2h0cyA9IHRydWU7CQkvLyByZW1haW5zIHNldCB1bnRpbCB1cGRhdGUgZG9uZQoKCQkJCX0KCgkJCX0KCgkJCS8vIHNraW5uaW5nIGFuZCBtb3JwaCB0YXJnZXQgdW5pZm9ybXMgbXVzdCBiZSBzZXQgZXZlbiBpZiBtYXRlcmlhbCBkaWRuJ3QgY2hhbmdlCgkJCS8vIGF1dG8tc2V0dGluZyBvZiB0ZXh0dXJlIHVuaXQgZm9yIGJvbmUgYW5kIG1vcnBoIHRleHR1cmUgbXVzdCBnbyBiZWZvcmUgb3RoZXIgdGV4dHVyZXMKCQkJLy8gb3RoZXJ3aXNlIHRleHR1cmVzIHVzZWQgZm9yIHNraW5uaW5nIGFuZCBtb3JwaGluZyBjYW4gdGFrZSBvdmVyIHRleHR1cmUgdW5pdHMgcmVzZXJ2ZWQgZm9yIG90aGVyIG1hdGVyaWFsIHRleHR1cmVzCgoJCQlpZiAoIG9iamVjdC5pc1NraW5uZWRNZXNoICkgewoKCQkJCXBfdW5pZm9ybXMuc2V0T3B0aW9uYWwoIF9nbCwgb2JqZWN0LCAnYmluZE1hdHJpeCcgKTsKCQkJCXBfdW5pZm9ybXMuc2V0T3B0aW9uYWwoIF9nbCwgb2JqZWN0LCAnYmluZE1hdHJpeEludmVyc2UnICk7CgoJCQkJY29uc3Qgc2tlbGV0b24gPSBvYmplY3Quc2tlbGV0b247CgoJCQkJaWYgKCBza2VsZXRvbiApIHsKCgkJCQkJaWYgKCBjYXBhYmlsaXRpZXMuZmxvYXRWZXJ0ZXhUZXh0dXJlcyApIHsKCgkJCQkJCWlmICggc2tlbGV0b24uYm9uZVRleHR1cmUgPT09IG51bGwgKSBza2VsZXRvbi5jb21wdXRlQm9uZVRleHR1cmUoKTsKCgkJCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ2JvbmVUZXh0dXJlJywgc2tlbGV0b24uYm9uZVRleHR1cmUsIHRleHR1cmVzICk7CgkJCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ2JvbmVUZXh0dXJlU2l6ZScsIHNrZWxldG9uLmJvbmVUZXh0dXJlU2l6ZSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogU2tpbm5lZE1lc2ggY2FuIG9ubHkgYmUgdXNlZCB3aXRoIFdlYkdMIDIuIFdpdGggV2ViR0wgMSBPRVNfdGV4dHVyZV9mbG9hdCBhbmQgdmVydGV4IHRleHR1cmVzIHN1cHBvcnQgaXMgcmVxdWlyZWQuJyApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzOwoKCQkJaWYgKCBtb3JwaEF0dHJpYnV0ZXMucG9zaXRpb24gIT09IHVuZGVmaW5lZCB8fCBtb3JwaEF0dHJpYnV0ZXMubm9ybWFsICE9PSB1bmRlZmluZWQgfHwgKCBtb3JwaEF0dHJpYnV0ZXMuY29sb3IgIT09IHVuZGVmaW5lZCAmJiBjYXBhYmlsaXRpZXMuaXNXZWJHTDIgPT09IHRydWUgKSApIHsKCgkJCQltb3JwaHRhcmdldHMudXBkYXRlKCBvYmplY3QsIGdlb21ldHJ5LCBwcm9ncmFtICk7CgoJCQl9CgoJCQlpZiAoIHJlZnJlc2hNYXRlcmlhbCB8fCBtYXRlcmlhbFByb3BlcnRpZXMucmVjZWl2ZVNoYWRvdyAhPT0gb2JqZWN0LnJlY2VpdmVTaGFkb3cgKSB7CgoJCQkJbWF0ZXJpYWxQcm9wZXJ0aWVzLnJlY2VpdmVTaGFkb3cgPSBvYmplY3QucmVjZWl2ZVNoYWRvdzsKCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ3JlY2VpdmVTaGFkb3cnLCBvYmplY3QucmVjZWl2ZVNoYWRvdyApOwoKCQkJfQoKCQkJLy8gaHR0cHM6Ly9naXRodWIuY29tL21yZG9vYi90aHJlZS5qcy9wdWxsLzI0NDY3I2lzc3VlY29tbWVudC0xMjA5MDMxNTEyCgoJCQlpZiAoIG1hdGVyaWFsLmlzTWVzaEdvdXJhdWRNYXRlcmlhbCAmJiBtYXRlcmlhbC5lbnZNYXAgIT09IG51bGwgKSB7CgoJCQkJbV91bmlmb3Jtcy5lbnZNYXAudmFsdWUgPSBlbnZNYXA7CgoJCQkJbV91bmlmb3Jtcy5mbGlwRW52TWFwLnZhbHVlID0gKCBlbnZNYXAuaXNDdWJlVGV4dHVyZSAmJiBlbnZNYXAuaXNSZW5kZXJUYXJnZXRUZXh0dXJlID09PSBmYWxzZSApID8gLSAxIDogMTsKCgkJCX0KCgkJCWlmICggcmVmcmVzaE1hdGVyaWFsICkgewoKCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ3RvbmVNYXBwaW5nRXhwb3N1cmUnLCBfdGhpcy50b25lTWFwcGluZ0V4cG9zdXJlICk7CgoJCQkJaWYgKCBtYXRlcmlhbFByb3BlcnRpZXMubmVlZHNMaWdodHMgKSB7CgoJCQkJCS8vIHRoZSBjdXJyZW50IG1hdGVyaWFsIHJlcXVpcmVzIGxpZ2h0aW5nIGluZm8KCgkJCQkJLy8gbm90ZTogYWxsIGxpZ2h0aW5nIHVuaWZvcm1zIGFyZSBhbHdheXMgc2V0IGNvcnJlY3RseQoJCQkJCS8vIHRoZXkgc2ltcGx5IHJlZmVyZW5jZSB0aGUgcmVuZGVyZXIncyBzdGF0ZSBmb3IgdGhlaXIKCQkJCQkvLyB2YWx1ZXMKCQkJCQkvLwoJCQkJCS8vIHVzZSB0aGUgY3VycmVudCBtYXRlcmlhbCdzIC5uZWVkc1VwZGF0ZSBmbGFncyB0byBzZXQKCQkJCQkvLyB0aGUgR0wgc3RhdGUgd2hlbiByZXF1aXJlZAoKCQkJCQltYXJrVW5pZm9ybXNMaWdodHNOZWVkc1VwZGF0ZSggbV91bmlmb3JtcywgcmVmcmVzaExpZ2h0cyApOwoKCQkJCX0KCgkJCQkvLyByZWZyZXNoIHVuaWZvcm1zIGNvbW1vbiB0byBzZXZlcmFsIG1hdGVyaWFscwoKCQkJCWlmICggZm9nICYmIG1hdGVyaWFsLmZvZyA9PT0gdHJ1ZSApIHsKCgkJCQkJbWF0ZXJpYWxzLnJlZnJlc2hGb2dVbmlmb3JtcyggbV91bmlmb3JtcywgZm9nICk7CgoJCQkJfQoKCQkJCW1hdGVyaWFscy5yZWZyZXNoTWF0ZXJpYWxVbmlmb3JtcyggbV91bmlmb3JtcywgbWF0ZXJpYWwsIF9waXhlbFJhdGlvLCBfaGVpZ2h0LCBfdHJhbnNtaXNzaW9uUmVuZGVyVGFyZ2V0ICk7CgoJCQkJV2ViR0xVbmlmb3Jtcy51cGxvYWQoIF9nbCwgbWF0ZXJpYWxQcm9wZXJ0aWVzLnVuaWZvcm1zTGlzdCwgbV91bmlmb3JtcywgdGV4dHVyZXMgKTsKCgkJCX0KCgkJCWlmICggbWF0ZXJpYWwuaXNTaGFkZXJNYXRlcmlhbCAmJiBtYXRlcmlhbC51bmlmb3Jtc05lZWRVcGRhdGUgPT09IHRydWUgKSB7CgoJCQkJV2ViR0xVbmlmb3Jtcy51cGxvYWQoIF9nbCwgbWF0ZXJpYWxQcm9wZXJ0aWVzLnVuaWZvcm1zTGlzdCwgbV91bmlmb3JtcywgdGV4dHVyZXMgKTsKCQkJCW1hdGVyaWFsLnVuaWZvcm1zTmVlZFVwZGF0ZSA9IGZhbHNlOwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbC5pc1Nwcml0ZU1hdGVyaWFsICkgewoKCQkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ2NlbnRlcicsIG9iamVjdC5jZW50ZXIgKTsKCgkJCX0KCgkJCS8vIGNvbW1vbiBtYXRyaWNlcwoKCQkJcF91bmlmb3Jtcy5zZXRWYWx1ZSggX2dsLCAnbW9kZWxWaWV3TWF0cml4Jywgb2JqZWN0Lm1vZGVsVmlld01hdHJpeCApOwoJCQlwX3VuaWZvcm1zLnNldFZhbHVlKCBfZ2wsICdub3JtYWxNYXRyaXgnLCBvYmplY3Qubm9ybWFsTWF0cml4ICk7CgkJCXBfdW5pZm9ybXMuc2V0VmFsdWUoIF9nbCwgJ21vZGVsTWF0cml4Jywgb2JqZWN0Lm1hdHJpeFdvcmxkICk7CgoJCQkvLyBVQk9zCgoJCQlpZiAoIG1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgfHwgbWF0ZXJpYWwuaXNSYXdTaGFkZXJNYXRlcmlhbCApIHsKCgkJCQljb25zdCBncm91cHMgPSBtYXRlcmlhbC51bmlmb3Jtc0dyb3VwczsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBncm91cHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJaWYgKCBjYXBhYmlsaXRpZXMuaXNXZWJHTDIgKSB7CgoJCQkJCQljb25zdCBncm91cCA9IGdyb3Vwc1sgaSBdOwoKCQkJCQkJdW5pZm9ybXNHcm91cHMudXBkYXRlKCBncm91cCwgcHJvZ3JhbSApOwoJCQkJCQl1bmlmb3Jtc0dyb3Vwcy5iaW5kKCBncm91cCwgcHJvZ3JhbSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVW5pZm9ybSBCdWZmZXIgT2JqZWN0cyBjYW4gb25seSBiZSB1c2VkIHdpdGggV2ViR0wgMi4nICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gcHJvZ3JhbTsKCgkJfQoKCQkvLyBJZiB1bmlmb3JtcyBhcmUgbWFya2VkIGFzIGNsZWFuLCB0aGV5IGRvbid0IG5lZWQgdG8gYmUgbG9hZGVkIHRvIHRoZSBHUFUuCgoJCWZ1bmN0aW9uIG1hcmtVbmlmb3Jtc0xpZ2h0c05lZWRzVXBkYXRlKCB1bmlmb3JtcywgdmFsdWUgKSB7CgoJCQl1bmlmb3Jtcy5hbWJpZW50TGlnaHRDb2xvci5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoJCQl1bmlmb3Jtcy5saWdodFByb2JlLm5lZWRzVXBkYXRlID0gdmFsdWU7CgoJCQl1bmlmb3Jtcy5kaXJlY3Rpb25hbExpZ2h0cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoJCQl1bmlmb3Jtcy5kaXJlY3Rpb25hbExpZ2h0U2hhZG93cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoJCQl1bmlmb3Jtcy5wb2ludExpZ2h0cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoJCQl1bmlmb3Jtcy5wb2ludExpZ2h0U2hhZG93cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoJCQl1bmlmb3Jtcy5zcG90TGlnaHRzLm5lZWRzVXBkYXRlID0gdmFsdWU7CgkJCXVuaWZvcm1zLnNwb3RMaWdodFNoYWRvd3MubmVlZHNVcGRhdGUgPSB2YWx1ZTsKCQkJdW5pZm9ybXMucmVjdEFyZWFMaWdodHMubmVlZHNVcGRhdGUgPSB2YWx1ZTsKCQkJdW5pZm9ybXMuaGVtaXNwaGVyZUxpZ2h0cy5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoKCQl9CgoJCWZ1bmN0aW9uIG1hdGVyaWFsTmVlZHNMaWdodHMoIG1hdGVyaWFsICkgewoKCQkJcmV0dXJuIG1hdGVyaWFsLmlzTWVzaExhbWJlcnRNYXRlcmlhbCB8fCBtYXRlcmlhbC5pc01lc2hUb29uTWF0ZXJpYWwgfHwgbWF0ZXJpYWwuaXNNZXNoUGhvbmdNYXRlcmlhbCB8fAoJCQkJbWF0ZXJpYWwuaXNNZXNoU3RhbmRhcmRNYXRlcmlhbCB8fCBtYXRlcmlhbC5pc1NoYWRvd01hdGVyaWFsIHx8CgkJCQkoIG1hdGVyaWFsLmlzU2hhZGVyTWF0ZXJpYWwgJiYgbWF0ZXJpYWwubGlnaHRzID09PSB0cnVlICk7CgoJCX0KCgkJdGhpcy5nZXRBY3RpdmVDdWJlRmFjZSA9IGZ1bmN0aW9uICgpIHsKCgkJCXJldHVybiBfY3VycmVudEFjdGl2ZUN1YmVGYWNlOwoKCQl9OwoKCQl0aGlzLmdldEFjdGl2ZU1pcG1hcExldmVsID0gZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIF9jdXJyZW50QWN0aXZlTWlwbWFwTGV2ZWw7CgoJCX07CgoJCXRoaXMuZ2V0UmVuZGVyVGFyZ2V0ID0gZnVuY3Rpb24gKCkgewoKCQkJcmV0dXJuIF9jdXJyZW50UmVuZGVyVGFyZ2V0OwoKCQl9OwoKCQl0aGlzLnNldFJlbmRlclRhcmdldFRleHR1cmVzID0gZnVuY3Rpb24gKCByZW5kZXJUYXJnZXQsIGNvbG9yVGV4dHVyZSwgZGVwdGhUZXh0dXJlICkgewoKCQkJcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC50ZXh0dXJlICkuX193ZWJnbFRleHR1cmUgPSBjb2xvclRleHR1cmU7CgkJCXByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQuZGVwdGhUZXh0dXJlICkuX193ZWJnbFRleHR1cmUgPSBkZXB0aFRleHR1cmU7CgoJCQljb25zdCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApOwoJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9faGFzRXh0ZXJuYWxUZXh0dXJlcyA9IHRydWU7CgoJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX19oYXNFeHRlcm5hbFRleHR1cmVzICkgewoKCQkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX19hdXRvQWxsb2NhdGVEZXB0aEJ1ZmZlciA9IGRlcHRoVGV4dHVyZSA9PT0gdW5kZWZpbmVkOwoKCQkJCWlmICggISByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fYXV0b0FsbG9jYXRlRGVwdGhCdWZmZXIgKSB7CgoJCQkJCS8vIFRoZSBtdWx0aXNhbXBsZV9yZW5kZXJfdG9fdGV4dHVyZSBleHRlbnNpb24gZG9lc24ndCB3b3JrIHByb3Blcmx5IGlmIHRoZXJlCgkJCQkJLy8gYXJlIG1pZGZyYW1lIGZsdXNoZXMgYW5kIGFuIGV4dGVybmFsIGRlcHRoIGJ1ZmZlci4gRGlzYWJsZSB1c2Ugb2YgdGhlIGV4dGVuc2lvbi4KCQkJCQlpZiAoIGV4dGVuc2lvbnMuaGFzKCAnV0VCR0xfbXVsdGlzYW1wbGVkX3JlbmRlcl90b190ZXh0dXJlJyApID09PSB0cnVlICkgewoKCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogUmVuZGVyLXRvLXRleHR1cmUgZXh0ZW5zaW9uIHdhcyBkaXNhYmxlZCBiZWNhdXNlIGFuIGV4dGVybmFsIHRleHR1cmUgd2FzIHByb3ZpZGVkJyApOwoJCQkJCQlyZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9fdXNlUmVuZGVyVG9UZXh0dXJlID0gZmFsc2U7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCX07CgoJCXRoaXMuc2V0UmVuZGVyVGFyZ2V0RnJhbWVidWZmZXIgPSBmdW5jdGlvbiAoIHJlbmRlclRhcmdldCwgZGVmYXVsdEZyYW1lYnVmZmVyICkgewoKCQkJY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKCQkJcmVuZGVyVGFyZ2V0UHJvcGVydGllcy5fX3dlYmdsRnJhbWVidWZmZXIgPSBkZWZhdWx0RnJhbWVidWZmZXI7CgkJCXJlbmRlclRhcmdldFByb3BlcnRpZXMuX191c2VEZWZhdWx0RnJhbWVidWZmZXIgPSBkZWZhdWx0RnJhbWVidWZmZXIgPT09IHVuZGVmaW5lZDsKCgkJfTsKCgkJdGhpcy5zZXRSZW5kZXJUYXJnZXQgPSBmdW5jdGlvbiAoIHJlbmRlclRhcmdldCwgYWN0aXZlQ3ViZUZhY2UgPSAwLCBhY3RpdmVNaXBtYXBMZXZlbCA9IDAgKSB7CgoJCQlfY3VycmVudFJlbmRlclRhcmdldCA9IHJlbmRlclRhcmdldDsKCQkJX2N1cnJlbnRBY3RpdmVDdWJlRmFjZSA9IGFjdGl2ZUN1YmVGYWNlOwoJCQlfY3VycmVudEFjdGl2ZU1pcG1hcExldmVsID0gYWN0aXZlTWlwbWFwTGV2ZWw7CgoJCQlsZXQgdXNlRGVmYXVsdEZyYW1lYnVmZmVyID0gdHJ1ZTsKCQkJbGV0IGZyYW1lYnVmZmVyID0gbnVsbDsKCQkJbGV0IGlzQ3ViZSA9IGZhbHNlOwoJCQlsZXQgaXNSZW5kZXJUYXJnZXQzRCA9IGZhbHNlOwoKCQkJaWYgKCByZW5kZXJUYXJnZXQgKSB7CgoJCQkJY29uc3QgcmVuZGVyVGFyZ2V0UHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKTsKCgkJCQlpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX191c2VEZWZhdWx0RnJhbWVidWZmZXIgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJLy8gV2UgbmVlZCB0byBtYWtlIHN1cmUgdG8gcmViaW5kIHRoZSBmcmFtZWJ1ZmZlci4KCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgbnVsbCApOwoJCQkJCXVzZURlZmF1bHRGcmFtZWJ1ZmZlciA9IGZhbHNlOwoKCQkJCX0gZWxzZSBpZiAoIHJlbmRlclRhcmdldFByb3BlcnRpZXMuX193ZWJnbEZyYW1lYnVmZmVyID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCXRleHR1cmVzLnNldHVwUmVuZGVyVGFyZ2V0KCByZW5kZXJUYXJnZXQgKTsKCgkJCQl9IGVsc2UgaWYgKCByZW5kZXJUYXJnZXRQcm9wZXJ0aWVzLl9faGFzRXh0ZXJuYWxUZXh0dXJlcyApIHsKCgkJCQkJLy8gQ29sb3IgYW5kIGRlcHRoIHRleHR1cmUgbXVzdCBiZSByZWJvdW5kIGluIG9yZGVyIGZvciB0aGUgc3dhcGNoYWluIHRvIHVwZGF0ZS4KCQkJCQl0ZXh0dXJlcy5yZWJpbmRUZXh0dXJlcyggcmVuZGVyVGFyZ2V0LCBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0LnRleHR1cmUgKS5fX3dlYmdsVGV4dHVyZSwgcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC5kZXB0aFRleHR1cmUgKS5fX3dlYmdsVGV4dHVyZSApOwoKCQkJCX0KCgkJCQljb25zdCB0ZXh0dXJlID0gcmVuZGVyVGFyZ2V0LnRleHR1cmU7CgoJCQkJaWYgKCB0ZXh0dXJlLmlzRGF0YTNEVGV4dHVyZSB8fCB0ZXh0dXJlLmlzRGF0YUFycmF5VGV4dHVyZSB8fCB0ZXh0dXJlLmlzQ29tcHJlc3NlZEFycmF5VGV4dHVyZSApIHsKCgkJCQkJaXNSZW5kZXJUYXJnZXQzRCA9IHRydWU7CgoJCQkJfQoKCQkJCWNvbnN0IF9fd2ViZ2xGcmFtZWJ1ZmZlciA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQgKS5fX3dlYmdsRnJhbWVidWZmZXI7CgoJCQkJaWYgKCByZW5kZXJUYXJnZXQuaXNXZWJHTEN1YmVSZW5kZXJUYXJnZXQgKSB7CgoJCQkJCWlmICggQXJyYXkuaXNBcnJheSggX193ZWJnbEZyYW1lYnVmZmVyWyBhY3RpdmVDdWJlRmFjZSBdICkgKSB7CgoJCQkJCQlmcmFtZWJ1ZmZlciA9IF9fd2ViZ2xGcmFtZWJ1ZmZlclsgYWN0aXZlQ3ViZUZhY2UgXVsgYWN0aXZlTWlwbWFwTGV2ZWwgXTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWZyYW1lYnVmZmVyID0gX193ZWJnbEZyYW1lYnVmZmVyWyBhY3RpdmVDdWJlRmFjZSBdOwoKCQkJCQl9CgoJCQkJCWlzQ3ViZSA9IHRydWU7CgoJCQkJfSBlbHNlIGlmICggKCBjYXBhYmlsaXRpZXMuaXNXZWJHTDIgJiYgcmVuZGVyVGFyZ2V0LnNhbXBsZXMgPiAwICkgJiYgdGV4dHVyZXMudXNlTXVsdGlzYW1wbGVkUlRUKCByZW5kZXJUYXJnZXQgKSA9PT0gZmFsc2UgKSB7CgoJCQkJCWZyYW1lYnVmZmVyID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldCApLl9fd2ViZ2xNdWx0aXNhbXBsZWRGcmFtZWJ1ZmZlcjsKCgkJCQl9IGVsc2UgewoKCQkJCQlpZiAoIEFycmF5LmlzQXJyYXkoIF9fd2ViZ2xGcmFtZWJ1ZmZlciApICkgewoKCQkJCQkJZnJhbWVidWZmZXIgPSBfX3dlYmdsRnJhbWVidWZmZXJbIGFjdGl2ZU1pcG1hcExldmVsIF07CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlmcmFtZWJ1ZmZlciA9IF9fd2ViZ2xGcmFtZWJ1ZmZlcjsKCgkJCQkJfQoKCQkJCX0KCgkJCQlfY3VycmVudFZpZXdwb3J0LmNvcHkoIHJlbmRlclRhcmdldC52aWV3cG9ydCApOwoJCQkJX2N1cnJlbnRTY2lzc29yLmNvcHkoIHJlbmRlclRhcmdldC5zY2lzc29yICk7CgkJCQlfY3VycmVudFNjaXNzb3JUZXN0ID0gcmVuZGVyVGFyZ2V0LnNjaXNzb3JUZXN0OwoKCQkJfSBlbHNlIHsKCgkJCQlfY3VycmVudFZpZXdwb3J0LmNvcHkoIF92aWV3cG9ydCApLm11bHRpcGx5U2NhbGFyKCBfcGl4ZWxSYXRpbyApLmZsb29yKCk7CgkJCQlfY3VycmVudFNjaXNzb3IuY29weSggX3NjaXNzb3IgKS5tdWx0aXBseVNjYWxhciggX3BpeGVsUmF0aW8gKS5mbG9vcigpOwoJCQkJX2N1cnJlbnRTY2lzc29yVGVzdCA9IF9zY2lzc29yVGVzdDsKCgkJCX0KCgkJCWNvbnN0IGZyYW1lYnVmZmVyQm91bmQgPSBzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZnJhbWVidWZmZXIgKTsKCgkJCWlmICggZnJhbWVidWZmZXJCb3VuZCAmJiBjYXBhYmlsaXRpZXMuZHJhd0J1ZmZlcnMgJiYgdXNlRGVmYXVsdEZyYW1lYnVmZmVyICkgewoKCQkJCXN0YXRlLmRyYXdCdWZmZXJzKCByZW5kZXJUYXJnZXQsIGZyYW1lYnVmZmVyICk7CgoJCQl9CgoJCQlzdGF0ZS52aWV3cG9ydCggX2N1cnJlbnRWaWV3cG9ydCApOwoJCQlzdGF0ZS5zY2lzc29yKCBfY3VycmVudFNjaXNzb3IgKTsKCQkJc3RhdGUuc2V0U2Npc3NvclRlc3QoIF9jdXJyZW50U2Npc3NvclRlc3QgKTsKCgkJCWlmICggaXNDdWJlICkgewoKCQkJCWNvbnN0IHRleHR1cmVQcm9wZXJ0aWVzID0gcHJvcGVydGllcy5nZXQoIHJlbmRlclRhcmdldC50ZXh0dXJlICk7CgkJCQlfZ2wuZnJhbWVidWZmZXJUZXh0dXJlMkQoIF9nbC5GUkFNRUJVRkZFUiwgX2dsLkNPTE9SX0FUVEFDSE1FTlQwLCBfZ2wuVEVYVFVSRV9DVUJFX01BUF9QT1NJVElWRV9YICsgYWN0aXZlQ3ViZUZhY2UsIHRleHR1cmVQcm9wZXJ0aWVzLl9fd2ViZ2xUZXh0dXJlLCBhY3RpdmVNaXBtYXBMZXZlbCApOwoKCQkJfSBlbHNlIGlmICggaXNSZW5kZXJUYXJnZXQzRCApIHsKCgkJCQljb25zdCB0ZXh0dXJlUHJvcGVydGllcyA9IHByb3BlcnRpZXMuZ2V0KCByZW5kZXJUYXJnZXQudGV4dHVyZSApOwoJCQkJY29uc3QgbGF5ZXIgPSBhY3RpdmVDdWJlRmFjZSB8fCAwOwoJCQkJX2dsLmZyYW1lYnVmZmVyVGV4dHVyZUxheWVyKCBfZ2wuRlJBTUVCVUZGRVIsIF9nbC5DT0xPUl9BVFRBQ0hNRU5UMCwgdGV4dHVyZVByb3BlcnRpZXMuX193ZWJnbFRleHR1cmUsIGFjdGl2ZU1pcG1hcExldmVsIHx8IDAsIGxheWVyICk7CgoJCQl9CgoJCQlfY3VycmVudE1hdGVyaWFsSWQgPSAtIDE7IC8vIHJlc2V0IGN1cnJlbnQgbWF0ZXJpYWwgdG8gZW5zdXJlIGNvcnJlY3QgdW5pZm9ybSBiaW5kaW5ncwoKCQl9OwoKCQl0aGlzLnJlYWRSZW5kZXJUYXJnZXRQaXhlbHMgPSBmdW5jdGlvbiAoIHJlbmRlclRhcmdldCwgeCwgeSwgd2lkdGgsIGhlaWdodCwgYnVmZmVyLCBhY3RpdmVDdWJlRmFjZUluZGV4ICkgewoKCQkJaWYgKCAhICggcmVuZGVyVGFyZ2V0ICYmIHJlbmRlclRhcmdldC5pc1dlYkdMUmVuZGVyVGFyZ2V0ICkgKSB7CgoJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLldlYkdMUmVuZGVyZXIucmVhZFJlbmRlclRhcmdldFBpeGVsczogcmVuZGVyVGFyZ2V0IGlzIG5vdCBUSFJFRS5XZWJHTFJlbmRlclRhcmdldC4nICk7CgkJCQlyZXR1cm47CgoJCQl9CgoJCQlsZXQgZnJhbWVidWZmZXIgPSBwcm9wZXJ0aWVzLmdldCggcmVuZGVyVGFyZ2V0ICkuX193ZWJnbEZyYW1lYnVmZmVyOwoKCQkJaWYgKCByZW5kZXJUYXJnZXQuaXNXZWJHTEN1YmVSZW5kZXJUYXJnZXQgJiYgYWN0aXZlQ3ViZUZhY2VJbmRleCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWZyYW1lYnVmZmVyID0gZnJhbWVidWZmZXJbIGFjdGl2ZUN1YmVGYWNlSW5kZXggXTsKCgkJCX0KCgkJCWlmICggZnJhbWVidWZmZXIgKSB7CgoJCQkJc3RhdGUuYmluZEZyYW1lYnVmZmVyKCBfZ2wuRlJBTUVCVUZGRVIsIGZyYW1lYnVmZmVyICk7CgoJCQkJdHJ5IHsKCgkJCQkJY29uc3QgdGV4dHVyZSA9IHJlbmRlclRhcmdldC50ZXh0dXJlOwoJCQkJCWNvbnN0IHRleHR1cmVGb3JtYXQgPSB0ZXh0dXJlLmZvcm1hdDsKCQkJCQljb25zdCB0ZXh0dXJlVHlwZSA9IHRleHR1cmUudHlwZTsKCgkJCQkJaWYgKCB0ZXh0dXJlRm9ybWF0ICE9PSBSR0JBRm9ybWF0ICYmIHV0aWxzLmNvbnZlcnQoIHRleHR1cmVGb3JtYXQgKSAhPT0gX2dsLmdldFBhcmFtZXRlciggX2dsLklNUExFTUVOVEFUSU9OX0NPTE9SX1JFQURfRk9STUFUICkgKSB7CgoJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzOiByZW5kZXJUYXJnZXQgaXMgbm90IGluIFJHQkEgb3IgaW1wbGVtZW50YXRpb24gZGVmaW5lZCBmb3JtYXQuJyApOwoJCQkJCQlyZXR1cm47CgoJCQkJCX0KCgkJCQkJY29uc3QgaGFsZkZsb2F0U3VwcG9ydGVkQnlFeHQgPSAoIHRleHR1cmVUeXBlID09PSBIYWxmRmxvYXRUeXBlICkgJiYgKCBleHRlbnNpb25zLmhhcyggJ0VYVF9jb2xvcl9idWZmZXJfaGFsZl9mbG9hdCcgKSB8fCAoIGNhcGFiaWxpdGllcy5pc1dlYkdMMiAmJiBleHRlbnNpb25zLmhhcyggJ0VYVF9jb2xvcl9idWZmZXJfZmxvYXQnICkgKSApOwoKCQkJCQlpZiAoIHRleHR1cmVUeXBlICE9PSBVbnNpZ25lZEJ5dGVUeXBlICYmIHV0aWxzLmNvbnZlcnQoIHRleHR1cmVUeXBlICkgIT09IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5JTVBMRU1FTlRBVElPTl9DT0xPUl9SRUFEX1RZUEUgKSAmJiAvLyBFZGdlIGFuZCBDaHJvbWUgTWFjIDwgNTIgKCM5NTEzKQoJCQkJCQkhICggdGV4dHVyZVR5cGUgPT09IEZsb2F0VHlwZSAmJiAoIGNhcGFiaWxpdGllcy5pc1dlYkdMMiB8fCBleHRlbnNpb25zLmhhcyggJ09FU190ZXh0dXJlX2Zsb2F0JyApIHx8IGV4dGVuc2lvbnMuaGFzKCAnV0VCR0xfY29sb3JfYnVmZmVyX2Zsb2F0JyApICkgKSAmJiAvLyBDaHJvbWUgTWFjID49IDUyIGFuZCBGaXJlZm94CgkJCQkJCSEgaGFsZkZsb2F0U3VwcG9ydGVkQnlFeHQgKSB7CgoJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5yZWFkUmVuZGVyVGFyZ2V0UGl4ZWxzOiByZW5kZXJUYXJnZXQgaXMgbm90IGluIFVuc2lnbmVkQnl0ZVR5cGUgb3IgaW1wbGVtZW50YXRpb24gZGVmaW5lZCB0eXBlLicgKTsKCQkJCQkJcmV0dXJuOwoKCQkJCQl9CgoJCQkJCS8vIHRoZSBmb2xsb3dpbmcgaWYgc3RhdGVtZW50IGVuc3VyZXMgdmFsaWQgcmVhZCByZXF1ZXN0cyAobm8gb3V0LW9mLWJvdW5kcyBwaXhlbHMsIHNlZSAjODYwNCkKCgkJCQkJaWYgKCAoIHggPj0gMCAmJiB4IDw9ICggcmVuZGVyVGFyZ2V0LndpZHRoIC0gd2lkdGggKSApICYmICggeSA+PSAwICYmIHkgPD0gKCByZW5kZXJUYXJnZXQuaGVpZ2h0IC0gaGVpZ2h0ICkgKSApIHsKCgkJCQkJCV9nbC5yZWFkUGl4ZWxzKCB4LCB5LCB3aWR0aCwgaGVpZ2h0LCB1dGlscy5jb252ZXJ0KCB0ZXh0dXJlRm9ybWF0ICksIHV0aWxzLmNvbnZlcnQoIHRleHR1cmVUeXBlICksIGJ1ZmZlciApOwoKCQkJCQl9CgoJCQkJfSBmaW5hbGx5IHsKCgkJCQkJLy8gcmVzdG9yZSBmcmFtZWJ1ZmZlciBvZiBjdXJyZW50IHJlbmRlciB0YXJnZXQgaWYgbmVjZXNzYXJ5CgoJCQkJCWNvbnN0IGZyYW1lYnVmZmVyID0gKCBfY3VycmVudFJlbmRlclRhcmdldCAhPT0gbnVsbCApID8gcHJvcGVydGllcy5nZXQoIF9jdXJyZW50UmVuZGVyVGFyZ2V0ICkuX193ZWJnbEZyYW1lYnVmZmVyIDogbnVsbDsKCQkJCQlzdGF0ZS5iaW5kRnJhbWVidWZmZXIoIF9nbC5GUkFNRUJVRkZFUiwgZnJhbWVidWZmZXIgKTsKCgkJCQl9CgoJCQl9CgoJCX07CgoJCXRoaXMuY29weUZyYW1lYnVmZmVyVG9UZXh0dXJlID0gZnVuY3Rpb24gKCBwb3NpdGlvbiwgdGV4dHVyZSwgbGV2ZWwgPSAwICkgewoKCQkJY29uc3QgbGV2ZWxTY2FsZSA9IE1hdGgucG93KCAyLCAtIGxldmVsICk7CgkJCWNvbnN0IHdpZHRoID0gTWF0aC5mbG9vciggdGV4dHVyZS5pbWFnZS53aWR0aCAqIGxldmVsU2NhbGUgKTsKCQkJY29uc3QgaGVpZ2h0ID0gTWF0aC5mbG9vciggdGV4dHVyZS5pbWFnZS5oZWlnaHQgKiBsZXZlbFNjYWxlICk7CgoJCQl0ZXh0dXJlcy5zZXRUZXh0dXJlMkQoIHRleHR1cmUsIDAgKTsKCgkJCV9nbC5jb3B5VGV4U3ViSW1hZ2UyRCggX2dsLlRFWFRVUkVfMkQsIGxldmVsLCAwLCAwLCBwb3NpdGlvbi54LCBwb3NpdGlvbi55LCB3aWR0aCwgaGVpZ2h0ICk7CgoJCQlzdGF0ZS51bmJpbmRUZXh0dXJlKCk7CgoJCX07CgoJCXRoaXMuY29weVRleHR1cmVUb1RleHR1cmUgPSBmdW5jdGlvbiAoIHBvc2l0aW9uLCBzcmNUZXh0dXJlLCBkc3RUZXh0dXJlLCBsZXZlbCA9IDAgKSB7CgoJCQljb25zdCB3aWR0aCA9IHNyY1RleHR1cmUuaW1hZ2Uud2lkdGg7CgkJCWNvbnN0IGhlaWdodCA9IHNyY1RleHR1cmUuaW1hZ2UuaGVpZ2h0OwoJCQljb25zdCBnbEZvcm1hdCA9IHV0aWxzLmNvbnZlcnQoIGRzdFRleHR1cmUuZm9ybWF0ICk7CgkJCWNvbnN0IGdsVHlwZSA9IHV0aWxzLmNvbnZlcnQoIGRzdFRleHR1cmUudHlwZSApOwoKCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEKCBkc3RUZXh0dXJlLCAwICk7CgoJCQkvLyBBcyBhbm90aGVyIHRleHR1cmUgdXBsb2FkIG1heSBoYXZlIGNoYW5nZWQgcGl4ZWxTdG9yZWkKCQkJLy8gcGFyYW1ldGVycywgbWFrZSBzdXJlIHRoZXkgYXJlIGNvcnJlY3QgZm9yIHRoZSBkc3RUZXh0dXJlCgkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19GTElQX1lfV0VCR0wsIGRzdFRleHR1cmUuZmxpcFkgKTsKCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX1BSRU1VTFRJUExZX0FMUEhBX1dFQkdMLCBkc3RUZXh0dXJlLnByZW11bHRpcGx5QWxwaGEgKTsKCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX0FMSUdOTUVOVCwgZHN0VGV4dHVyZS51bnBhY2tBbGlnbm1lbnQgKTsKCgkJCWlmICggc3JjVGV4dHVyZS5pc0RhdGFUZXh0dXJlICkgewoKCQkJCV9nbC50ZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgbGV2ZWwsIHBvc2l0aW9uLngsIHBvc2l0aW9uLnksIHdpZHRoLCBoZWlnaHQsIGdsRm9ybWF0LCBnbFR5cGUsIHNyY1RleHR1cmUuaW1hZ2UuZGF0YSApOwoKCQkJfSBlbHNlIHsKCgkJCQlpZiAoIHNyY1RleHR1cmUuaXNDb21wcmVzc2VkVGV4dHVyZSApIHsKCgkJCQkJX2dsLmNvbXByZXNzZWRUZXhTdWJJbWFnZTJEKCBfZ2wuVEVYVFVSRV8yRCwgbGV2ZWwsIHBvc2l0aW9uLngsIHBvc2l0aW9uLnksIHNyY1RleHR1cmUubWlwbWFwc1sgMCBdLndpZHRoLCBzcmNUZXh0dXJlLm1pcG1hcHNbIDAgXS5oZWlnaHQsIGdsRm9ybWF0LCBzcmNUZXh0dXJlLm1pcG1hcHNbIDAgXS5kYXRhICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJX2dsLnRleFN1YkltYWdlMkQoIF9nbC5URVhUVVJFXzJELCBsZXZlbCwgcG9zaXRpb24ueCwgcG9zaXRpb24ueSwgZ2xGb3JtYXQsIGdsVHlwZSwgc3JjVGV4dHVyZS5pbWFnZSApOwoKCQkJCX0KCgkJCX0KCgkJCS8vIEdlbmVyYXRlIG1pcG1hcHMgb25seSB3aGVuIGNvcHlpbmcgbGV2ZWwgMAoJCQlpZiAoIGxldmVsID09PSAwICYmIGRzdFRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzICkgX2dsLmdlbmVyYXRlTWlwbWFwKCBfZ2wuVEVYVFVSRV8yRCApOwoKCQkJc3RhdGUudW5iaW5kVGV4dHVyZSgpOwoKCQl9OwoKCQl0aGlzLmNvcHlUZXh0dXJlVG9UZXh0dXJlM0QgPSBmdW5jdGlvbiAoIHNvdXJjZUJveCwgcG9zaXRpb24sIHNyY1RleHR1cmUsIGRzdFRleHR1cmUsIGxldmVsID0gMCApIHsKCgkJCWlmICggX3RoaXMuaXNXZWJHTDFSZW5kZXJlciApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyLmNvcHlUZXh0dXJlVG9UZXh0dXJlM0Q6IGNhbiBvbmx5IGJlIHVzZWQgd2l0aCBXZWJHTDIuJyApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJY29uc3Qgd2lkdGggPSBzb3VyY2VCb3gubWF4LnggLSBzb3VyY2VCb3gubWluLnggKyAxOwoJCQljb25zdCBoZWlnaHQgPSBzb3VyY2VCb3gubWF4LnkgLSBzb3VyY2VCb3gubWluLnkgKyAxOwoJCQljb25zdCBkZXB0aCA9IHNvdXJjZUJveC5tYXgueiAtIHNvdXJjZUJveC5taW4ueiArIDE7CgkJCWNvbnN0IGdsRm9ybWF0ID0gdXRpbHMuY29udmVydCggZHN0VGV4dHVyZS5mb3JtYXQgKTsKCQkJY29uc3QgZ2xUeXBlID0gdXRpbHMuY29udmVydCggZHN0VGV4dHVyZS50eXBlICk7CgkJCWxldCBnbFRhcmdldDsKCgkJCWlmICggZHN0VGV4dHVyZS5pc0RhdGEzRFRleHR1cmUgKSB7CgoJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTNEKCBkc3RUZXh0dXJlLCAwICk7CgkJCQlnbFRhcmdldCA9IF9nbC5URVhUVVJFXzNEOwoKCQkJfSBlbHNlIGlmICggZHN0VGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgKSB7CgoJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEQXJyYXkoIGRzdFRleHR1cmUsIDAgKTsKCQkJCWdsVGFyZ2V0ID0gX2dsLlRFWFRVUkVfMkRfQVJSQVk7CgoJCQl9IGVsc2UgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXIuY29weVRleHR1cmVUb1RleHR1cmUzRDogb25seSBzdXBwb3J0cyBUSFJFRS5EYXRhVGV4dHVyZTNEIGFuZCBUSFJFRS5EYXRhVGV4dHVyZTJEQXJyYXkuJyApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX0ZMSVBfWV9XRUJHTCwgZHN0VGV4dHVyZS5mbGlwWSApOwoJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfUFJFTVVMVElQTFlfQUxQSEFfV0VCR0wsIGRzdFRleHR1cmUucHJlbXVsdGlwbHlBbHBoYSApOwoJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfQUxJR05NRU5ULCBkc3RUZXh0dXJlLnVucGFja0FsaWdubWVudCApOwoKCQkJY29uc3QgdW5wYWNrUm93TGVuID0gX2dsLmdldFBhcmFtZXRlciggX2dsLlVOUEFDS19ST1dfTEVOR1RIICk7CgkJCWNvbnN0IHVucGFja0ltYWdlSGVpZ2h0ID0gX2dsLmdldFBhcmFtZXRlciggX2dsLlVOUEFDS19JTUFHRV9IRUlHSFQgKTsKCQkJY29uc3QgdW5wYWNrU2tpcFBpeGVscyA9IF9nbC5nZXRQYXJhbWV0ZXIoIF9nbC5VTlBBQ0tfU0tJUF9QSVhFTFMgKTsKCQkJY29uc3QgdW5wYWNrU2tpcFJvd3MgPSBfZ2wuZ2V0UGFyYW1ldGVyKCBfZ2wuVU5QQUNLX1NLSVBfUk9XUyApOwoJCQljb25zdCB1bnBhY2tTa2lwSW1hZ2VzID0gX2dsLmdldFBhcmFtZXRlciggX2dsLlVOUEFDS19TS0lQX0lNQUdFUyApOwoKCQkJY29uc3QgaW1hZ2UgPSBzcmNUZXh0dXJlLmlzQ29tcHJlc3NlZFRleHR1cmUgPyBzcmNUZXh0dXJlLm1pcG1hcHNbIDAgXSA6IHNyY1RleHR1cmUuaW1hZ2U7CgoJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfUk9XX0xFTkdUSCwgaW1hZ2Uud2lkdGggKTsKCQkJX2dsLnBpeGVsU3RvcmVpKCBfZ2wuVU5QQUNLX0lNQUdFX0hFSUdIVCwgaW1hZ2UuaGVpZ2h0ICk7CgkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19TS0lQX1BJWEVMUywgc291cmNlQm94Lm1pbi54ICk7CgkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19TS0lQX1JPV1MsIHNvdXJjZUJveC5taW4ueSApOwoJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfU0tJUF9JTUFHRVMsIHNvdXJjZUJveC5taW4ueiApOwoKCQkJaWYgKCBzcmNUZXh0dXJlLmlzRGF0YVRleHR1cmUgfHwgc3JjVGV4dHVyZS5pc0RhdGEzRFRleHR1cmUgKSB7CgoJCQkJX2dsLnRleFN1YkltYWdlM0QoIGdsVGFyZ2V0LCBsZXZlbCwgcG9zaXRpb24ueCwgcG9zaXRpb24ueSwgcG9zaXRpb24ueiwgd2lkdGgsIGhlaWdodCwgZGVwdGgsIGdsRm9ybWF0LCBnbFR5cGUsIGltYWdlLmRhdGEgKTsKCgkJCX0gZWxzZSB7CgoJCQkJaWYgKCBzcmNUZXh0dXJlLmlzQ29tcHJlc3NlZEFycmF5VGV4dHVyZSApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlci5jb3B5VGV4dHVyZVRvVGV4dHVyZTNEOiB1bnRlc3RlZCBzdXBwb3J0IGZvciBjb21wcmVzc2VkIHNyY1RleHR1cmUuJyApOwoJCQkJCV9nbC5jb21wcmVzc2VkVGV4U3ViSW1hZ2UzRCggZ2xUYXJnZXQsIGxldmVsLCBwb3NpdGlvbi54LCBwb3NpdGlvbi55LCBwb3NpdGlvbi56LCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgZ2xGb3JtYXQsIGltYWdlLmRhdGEgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlfZ2wudGV4U3ViSW1hZ2UzRCggZ2xUYXJnZXQsIGxldmVsLCBwb3NpdGlvbi54LCBwb3NpdGlvbi55LCBwb3NpdGlvbi56LCB3aWR0aCwgaGVpZ2h0LCBkZXB0aCwgZ2xGb3JtYXQsIGdsVHlwZSwgaW1hZ2UgKTsKCgkJCQl9CgoJCQl9CgoJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfUk9XX0xFTkdUSCwgdW5wYWNrUm93TGVuICk7CgkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19JTUFHRV9IRUlHSFQsIHVucGFja0ltYWdlSGVpZ2h0ICk7CgkJCV9nbC5waXhlbFN0b3JlaSggX2dsLlVOUEFDS19TS0lQX1BJWEVMUywgdW5wYWNrU2tpcFBpeGVscyApOwoJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfU0tJUF9ST1dTLCB1bnBhY2tTa2lwUm93cyApOwoJCQlfZ2wucGl4ZWxTdG9yZWkoIF9nbC5VTlBBQ0tfU0tJUF9JTUFHRVMsIHVucGFja1NraXBJbWFnZXMgKTsKCgkJCS8vIEdlbmVyYXRlIG1pcG1hcHMgb25seSB3aGVuIGNvcHlpbmcgbGV2ZWwgMAoJCQlpZiAoIGxldmVsID09PSAwICYmIGRzdFRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzICkgX2dsLmdlbmVyYXRlTWlwbWFwKCBnbFRhcmdldCApOwoKCQkJc3RhdGUudW5iaW5kVGV4dHVyZSgpOwoKCQl9OwoKCQl0aGlzLmluaXRUZXh0dXJlID0gZnVuY3Rpb24gKCB0ZXh0dXJlICkgewoKCQkJaWYgKCB0ZXh0dXJlLmlzQ3ViZVRleHR1cmUgKSB7CgoJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZUN1YmUoIHRleHR1cmUsIDAgKTsKCgkJCX0gZWxzZSBpZiAoIHRleHR1cmUuaXNEYXRhM0RUZXh0dXJlICkgewoKCQkJCXRleHR1cmVzLnNldFRleHR1cmUzRCggdGV4dHVyZSwgMCApOwoKCQkJfSBlbHNlIGlmICggdGV4dHVyZS5pc0RhdGFBcnJheVRleHR1cmUgfHwgdGV4dHVyZS5pc0NvbXByZXNzZWRBcnJheVRleHR1cmUgKSB7CgoJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEQXJyYXkoIHRleHR1cmUsIDAgKTsKCgkJCX0gZWxzZSB7CgoJCQkJdGV4dHVyZXMuc2V0VGV4dHVyZTJEKCB0ZXh0dXJlLCAwICk7CgoJCQl9CgoJCQlzdGF0ZS51bmJpbmRUZXh0dXJlKCk7CgoJCX07CgoJCXRoaXMucmVzZXRTdGF0ZSA9IGZ1bmN0aW9uICgpIHsKCgkJCV9jdXJyZW50QWN0aXZlQ3ViZUZhY2UgPSAwOwoJCQlfY3VycmVudEFjdGl2ZU1pcG1hcExldmVsID0gMDsKCQkJX2N1cnJlbnRSZW5kZXJUYXJnZXQgPSBudWxsOwoKCQkJc3RhdGUucmVzZXQoKTsKCQkJYmluZGluZ1N0YXRlcy5yZXNldCgpOwoKCQl9OwoKCQlpZiAoIHR5cGVvZiBfX1RIUkVFX0RFVlRPT0xTX18gIT09ICd1bmRlZmluZWQnICkgewoKCQkJX19USFJFRV9ERVZUT09MU19fLmRpc3BhdGNoRXZlbnQoIG5ldyBDdXN0b21FdmVudCggJ29ic2VydmUnLCB7IGRldGFpbDogdGhpcyB9ICkgKTsKCgkJfQoKCX0KCglnZXQgY29vcmRpbmF0ZVN5c3RlbSgpIHsKCgkJcmV0dXJuIFdlYkdMQ29vcmRpbmF0ZVN5c3RlbTsKCgl9CgoJZ2V0IG91dHB1dENvbG9yU3BhY2UoKSB7CgoJCXJldHVybiB0aGlzLl9vdXRwdXRDb2xvclNwYWNlOwoKCX0KCglzZXQgb3V0cHV0Q29sb3JTcGFjZSggY29sb3JTcGFjZSApIHsKCgkJdGhpcy5fb3V0cHV0Q29sb3JTcGFjZSA9IGNvbG9yU3BhY2U7CgoJCWNvbnN0IGdsID0gdGhpcy5nZXRDb250ZXh0KCk7CgkJZ2wuZHJhd2luZ0J1ZmZlckNvbG9yU3BhY2UgPSBjb2xvclNwYWNlID09PSBEaXNwbGF5UDNDb2xvclNwYWNlID8gJ2Rpc3BsYXktcDMnIDogJ3NyZ2InOwoJCWdsLnVucGFja0NvbG9yU3BhY2UgPSBDb2xvck1hbmFnZW1lbnQud29ya2luZ0NvbG9yU3BhY2UgPT09IExpbmVhckRpc3BsYXlQM0NvbG9yU3BhY2UgPyAnZGlzcGxheS1wMycgOiAnc3JnYic7CgoJfQoKCWdldCBwaHlzaWNhbGx5Q29ycmVjdExpZ2h0cygpIHsgLy8gQGRlcHJlY2F0ZWQsIHIxNTAKCgkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVGhlIHByb3BlcnR5IC5waHlzaWNhbGx5Q29ycmVjdExpZ2h0cyBoYXMgYmVlbiByZW1vdmVkLiBTZXQgcmVuZGVyZXIudXNlTGVnYWN5TGlnaHRzIGluc3RlYWQuJyApOwoJCXJldHVybiAhIHRoaXMudXNlTGVnYWN5TGlnaHRzOwoKCX0KCglzZXQgcGh5c2ljYWxseUNvcnJlY3RMaWdodHMoIHZhbHVlICkgeyAvLyBAZGVwcmVjYXRlZCwgcjE1MAoKCQljb25zb2xlLndhcm4oICdUSFJFRS5XZWJHTFJlbmRlcmVyOiBUaGUgcHJvcGVydHkgLnBoeXNpY2FsbHlDb3JyZWN0TGlnaHRzIGhhcyBiZWVuIHJlbW92ZWQuIFNldCByZW5kZXJlci51c2VMZWdhY3lMaWdodHMgaW5zdGVhZC4nICk7CgkJdGhpcy51c2VMZWdhY3lMaWdodHMgPSAhIHZhbHVlOwoKCX0KCglnZXQgb3V0cHV0RW5jb2RpbmcoKSB7IC8vIEBkZXByZWNhdGVkLCByMTUyCgoJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFByb3BlcnR5IC5vdXRwdXRFbmNvZGluZyBoYXMgYmVlbiByZW1vdmVkLiBVc2UgLm91dHB1dENvbG9yU3BhY2UgaW5zdGVhZC4nICk7CgkJcmV0dXJuIHRoaXMub3V0cHV0Q29sb3JTcGFjZSA9PT0gU1JHQkNvbG9yU3BhY2UgPyBzUkdCRW5jb2RpbmcgOiBMaW5lYXJFbmNvZGluZzsKCgl9CgoJc2V0IG91dHB1dEVuY29kaW5nKCBlbmNvZGluZyApIHsgLy8gQGRlcHJlY2F0ZWQsIHIxNTIKCgkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogUHJvcGVydHkgLm91dHB1dEVuY29kaW5nIGhhcyBiZWVuIHJlbW92ZWQuIFVzZSAub3V0cHV0Q29sb3JTcGFjZSBpbnN0ZWFkLicgKTsKCQl0aGlzLm91dHB1dENvbG9yU3BhY2UgPSBlbmNvZGluZyA9PT0gc1JHQkVuY29kaW5nID8gU1JHQkNvbG9yU3BhY2UgOiBMaW5lYXJTUkdCQ29sb3JTcGFjZTsKCgl9CgoJZ2V0IHVzZUxlZ2FjeUxpZ2h0cygpIHsgLy8gQGRlcHJlY2F0ZWQsIHIxNTUKCgkJY29uc29sZS53YXJuKCAnVEhSRUUuV2ViR0xSZW5kZXJlcjogVGhlIHByb3BlcnR5IC51c2VMZWdhY3lMaWdodHMgaGFzIGJlZW4gZGVwcmVjYXRlZC4gTWlncmF0ZSB5b3VyIGxpZ2h0aW5nIGFjY29yZGluZyB0byB0aGUgZm9sbG93aW5nIGd1aWRlOiBodHRwczovL2Rpc2NvdXJzZS50aHJlZWpzLm9yZy90L3VwZGF0ZXMtdG8tbGlnaHRpbmctaW4tdGhyZWUtanMtcjE1NS81MzczMy4nICk7CgkJcmV0dXJuIHRoaXMuX3VzZUxlZ2FjeUxpZ2h0czsKCgl9CgoJc2V0IHVzZUxlZ2FjeUxpZ2h0cyggdmFsdWUgKSB7IC8vIEBkZXByZWNhdGVkLCByMTU1CgoJCWNvbnNvbGUud2FybiggJ1RIUkVFLldlYkdMUmVuZGVyZXI6IFRoZSBwcm9wZXJ0eSAudXNlTGVnYWN5TGlnaHRzIGhhcyBiZWVuIGRlcHJlY2F0ZWQuIE1pZ3JhdGUgeW91ciBsaWdodGluZyBhY2NvcmRpbmcgdG8gdGhlIGZvbGxvd2luZyBndWlkZTogaHR0cHM6Ly9kaXNjb3Vyc2UudGhyZWVqcy5vcmcvdC91cGRhdGVzLXRvLWxpZ2h0aW5nLWluLXRocmVlLWpzLXIxNTUvNTM3MzMuJyApOwoJCXRoaXMuX3VzZUxlZ2FjeUxpZ2h0cyA9IHZhbHVlOwoKCX0KCn0KCmNsYXNzIFdlYkdMMVJlbmRlcmVyIGV4dGVuZHMgV2ViR0xSZW5kZXJlciB7fQoKV2ViR0wxUmVuZGVyZXIucHJvdG90eXBlLmlzV2ViR0wxUmVuZGVyZXIgPSB0cnVlOwoKY2xhc3MgRm9nRXhwMiB7CgoJY29uc3RydWN0b3IoIGNvbG9yLCBkZW5zaXR5ID0gMC4wMDAyNSApIHsKCgkJdGhpcy5pc0ZvZ0V4cDIgPSB0cnVlOwoKCQl0aGlzLm5hbWUgPSAnJzsKCgkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggY29sb3IgKTsKCQl0aGlzLmRlbnNpdHkgPSBkZW5zaXR5OwoKCX0KCgljbG9uZSgpIHsKCgkJcmV0dXJuIG5ldyBGb2dFeHAyKCB0aGlzLmNvbG9yLCB0aGlzLmRlbnNpdHkgKTsKCgl9CgoJdG9KU09OKCAvKiBtZXRhICovICkgewoKCQlyZXR1cm4gewoJCQl0eXBlOiAnRm9nRXhwMicsCgkJCW5hbWU6IHRoaXMubmFtZSwKCQkJY29sb3I6IHRoaXMuY29sb3IuZ2V0SGV4KCksCgkJCWRlbnNpdHk6IHRoaXMuZGVuc2l0eQoJCX07CgoJfQoKfQoKY2xhc3MgRm9nIHsKCgljb25zdHJ1Y3RvciggY29sb3IsIG5lYXIgPSAxLCBmYXIgPSAxMDAwICkgewoKCQl0aGlzLmlzRm9nID0gdHJ1ZTsKCgkJdGhpcy5uYW1lID0gJyc7CgoJCXRoaXMuY29sb3IgPSBuZXcgQ29sb3IoIGNvbG9yICk7CgoJCXRoaXMubmVhciA9IG5lYXI7CgkJdGhpcy5mYXIgPSBmYXI7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IEZvZyggdGhpcy5jb2xvciwgdGhpcy5uZWFyLCB0aGlzLmZhciApOwoKCX0KCgl0b0pTT04oIC8qIG1ldGEgKi8gKSB7CgoJCXJldHVybiB7CgkJCXR5cGU6ICdGb2cnLAoJCQluYW1lOiB0aGlzLm5hbWUsCgkJCWNvbG9yOiB0aGlzLmNvbG9yLmdldEhleCgpLAoJCQluZWFyOiB0aGlzLm5lYXIsCgkJCWZhcjogdGhpcy5mYXIKCQl9OwoKCX0KCn0KCmNsYXNzIFNjZW5lIGV4dGVuZHMgT2JqZWN0M0QgewoKCWNvbnN0cnVjdG9yKCkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzU2NlbmUgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnU2NlbmUnOwoKCQl0aGlzLmJhY2tncm91bmQgPSBudWxsOwoJCXRoaXMuZW52aXJvbm1lbnQgPSBudWxsOwoJCXRoaXMuZm9nID0gbnVsbDsKCgkJdGhpcy5iYWNrZ3JvdW5kQmx1cnJpbmVzcyA9IDA7CgkJdGhpcy5iYWNrZ3JvdW5kSW50ZW5zaXR5ID0gMTsKCgkJdGhpcy5vdmVycmlkZU1hdGVyaWFsID0gbnVsbDsKCgkJaWYgKCB0eXBlb2YgX19USFJFRV9ERVZUT09MU19fICE9PSAndW5kZWZpbmVkJyApIHsKCgkJCV9fVEhSRUVfREVWVE9PTFNfXy5kaXNwYXRjaEV2ZW50KCBuZXcgQ3VzdG9tRXZlbnQoICdvYnNlcnZlJywgeyBkZXRhaWw6IHRoaXMgfSApICk7CgoJCX0KCgl9CgoJY29weSggc291cmNlLCByZWN1cnNpdmUgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgoJCWlmICggc291cmNlLmJhY2tncm91bmQgIT09IG51bGwgKSB0aGlzLmJhY2tncm91bmQgPSBzb3VyY2UuYmFja2dyb3VuZC5jbG9uZSgpOwoJCWlmICggc291cmNlLmVudmlyb25tZW50ICE9PSBudWxsICkgdGhpcy5lbnZpcm9ubWVudCA9IHNvdXJjZS5lbnZpcm9ubWVudC5jbG9uZSgpOwoJCWlmICggc291cmNlLmZvZyAhPT0gbnVsbCApIHRoaXMuZm9nID0gc291cmNlLmZvZy5jbG9uZSgpOwoKCQl0aGlzLmJhY2tncm91bmRCbHVycmluZXNzID0gc291cmNlLmJhY2tncm91bmRCbHVycmluZXNzOwoJCXRoaXMuYmFja2dyb3VuZEludGVuc2l0eSA9IHNvdXJjZS5iYWNrZ3JvdW5kSW50ZW5zaXR5OwoKCQlpZiAoIHNvdXJjZS5vdmVycmlkZU1hdGVyaWFsICE9PSBudWxsICkgdGhpcy5vdmVycmlkZU1hdGVyaWFsID0gc291cmNlLm92ZXJyaWRlTWF0ZXJpYWwuY2xvbmUoKTsKCgkJdGhpcy5tYXRyaXhBdXRvVXBkYXRlID0gc291cmNlLm1hdHJpeEF1dG9VcGRhdGU7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0pTT04oIG1ldGEgKSB7CgoJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oIG1ldGEgKTsKCgkJaWYgKCB0aGlzLmZvZyAhPT0gbnVsbCApIGRhdGEub2JqZWN0LmZvZyA9IHRoaXMuZm9nLnRvSlNPTigpOwoJCWlmICggdGhpcy5iYWNrZ3JvdW5kQmx1cnJpbmVzcyA+IDAgKSBkYXRhLm9iamVjdC5iYWNrZ3JvdW5kQmx1cnJpbmVzcyA9IHRoaXMuYmFja2dyb3VuZEJsdXJyaW5lc3M7CgkJaWYgKCB0aGlzLmJhY2tncm91bmRJbnRlbnNpdHkgIT09IDEgKSBkYXRhLm9iamVjdC5iYWNrZ3JvdW5kSW50ZW5zaXR5ID0gdGhpcy5iYWNrZ3JvdW5kSW50ZW5zaXR5OwoKCQlyZXR1cm4gZGF0YTsKCgl9Cgp9CgpjbGFzcyBJbnRlcmxlYXZlZEJ1ZmZlciB7CgoJY29uc3RydWN0b3IoIGFycmF5LCBzdHJpZGUgKSB7CgoJCXRoaXMuaXNJbnRlcmxlYXZlZEJ1ZmZlciA9IHRydWU7CgoJCXRoaXMuYXJyYXkgPSBhcnJheTsKCQl0aGlzLnN0cmlkZSA9IHN0cmlkZTsKCQl0aGlzLmNvdW50ID0gYXJyYXkgIT09IHVuZGVmaW5lZCA/IGFycmF5Lmxlbmd0aCAvIHN0cmlkZSA6IDA7CgoJCXRoaXMudXNhZ2UgPSBTdGF0aWNEcmF3VXNhZ2U7CgkJdGhpcy51cGRhdGVSYW5nZSA9IHsgb2Zmc2V0OiAwLCBjb3VudDogLSAxIH07CgoJCXRoaXMudmVyc2lvbiA9IDA7CgoJCXRoaXMudXVpZCA9IGdlbmVyYXRlVVVJRCgpOwoKCX0KCglvblVwbG9hZENhbGxiYWNrKCkge30KCglzZXQgbmVlZHNVcGRhdGUoIHZhbHVlICkgewoKCQlpZiAoIHZhbHVlID09PSB0cnVlICkgdGhpcy52ZXJzaW9uICsrOwoKCX0KCglzZXRVc2FnZSggdmFsdWUgKSB7CgoJCXRoaXMudXNhZ2UgPSB2YWx1ZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJdGhpcy5hcnJheSA9IG5ldyBzb3VyY2UuYXJyYXkuY29uc3RydWN0b3IoIHNvdXJjZS5hcnJheSApOwoJCXRoaXMuY291bnQgPSBzb3VyY2UuY291bnQ7CgkJdGhpcy5zdHJpZGUgPSBzb3VyY2Uuc3RyaWRlOwoJCXRoaXMudXNhZ2UgPSBzb3VyY2UudXNhZ2U7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljb3B5QXQoIGluZGV4MSwgYXR0cmlidXRlLCBpbmRleDIgKSB7CgoJCWluZGV4MSAqPSB0aGlzLnN0cmlkZTsKCQlpbmRleDIgKj0gYXR0cmlidXRlLnN0cmlkZTsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5zdHJpZGU7IGkgPCBsOyBpICsrICkgewoKCQkJdGhpcy5hcnJheVsgaW5kZXgxICsgaSBdID0gYXR0cmlidXRlLmFycmF5WyBpbmRleDIgKyBpIF07CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldCggdmFsdWUsIG9mZnNldCA9IDAgKSB7CgoJCXRoaXMuYXJyYXkuc2V0KCB2YWx1ZSwgb2Zmc2V0ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljbG9uZSggZGF0YSApIHsKCgkJaWYgKCBkYXRhLmFycmF5QnVmZmVycyA9PT0gdW5kZWZpbmVkICkgewoKCQkJZGF0YS5hcnJheUJ1ZmZlcnMgPSB7fTsKCgkJfQoKCQlpZiAoIHRoaXMuYXJyYXkuYnVmZmVyLl91dWlkID09PSB1bmRlZmluZWQgKSB7CgoJCQl0aGlzLmFycmF5LmJ1ZmZlci5fdXVpZCA9IGdlbmVyYXRlVVVJRCgpOwoKCQl9CgoJCWlmICggZGF0YS5hcnJheUJ1ZmZlcnNbIHRoaXMuYXJyYXkuYnVmZmVyLl91dWlkIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCWRhdGEuYXJyYXlCdWZmZXJzWyB0aGlzLmFycmF5LmJ1ZmZlci5fdXVpZCBdID0gdGhpcy5hcnJheS5zbGljZSggMCApLmJ1ZmZlcjsKCgkJfQoKCQljb25zdCBhcnJheSA9IG5ldyB0aGlzLmFycmF5LmNvbnN0cnVjdG9yKCBkYXRhLmFycmF5QnVmZmVyc1sgdGhpcy5hcnJheS5idWZmZXIuX3V1aWQgXSApOwoKCQljb25zdCBpYiA9IG5ldyB0aGlzLmNvbnN0cnVjdG9yKCBhcnJheSwgdGhpcy5zdHJpZGUgKTsKCQlpYi5zZXRVc2FnZSggdGhpcy51c2FnZSApOwoKCQlyZXR1cm4gaWI7CgoJfQoKCW9uVXBsb2FkKCBjYWxsYmFjayApIHsKCgkJdGhpcy5vblVwbG9hZENhbGxiYWNrID0gY2FsbGJhY2s7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0pTT04oIGRhdGEgKSB7CgoJCWlmICggZGF0YS5hcnJheUJ1ZmZlcnMgPT09IHVuZGVmaW5lZCApIHsKCgkJCWRhdGEuYXJyYXlCdWZmZXJzID0ge307CgoJCX0KCgkJLy8gZ2VuZXJhdGUgVVVJRCBmb3IgYXJyYXkgYnVmZmVyIGlmIG5lY2Vzc2FyeQoKCQlpZiAoIHRoaXMuYXJyYXkuYnVmZmVyLl91dWlkID09PSB1bmRlZmluZWQgKSB7CgoJCQl0aGlzLmFycmF5LmJ1ZmZlci5fdXVpZCA9IGdlbmVyYXRlVVVJRCgpOwoKCQl9CgoJCWlmICggZGF0YS5hcnJheUJ1ZmZlcnNbIHRoaXMuYXJyYXkuYnVmZmVyLl91dWlkIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCWRhdGEuYXJyYXlCdWZmZXJzWyB0aGlzLmFycmF5LmJ1ZmZlci5fdXVpZCBdID0gQXJyYXkuZnJvbSggbmV3IFVpbnQzMkFycmF5KCB0aGlzLmFycmF5LmJ1ZmZlciApICk7CgoJCX0KCgkJLy8KCgkJcmV0dXJuIHsKCQkJdXVpZDogdGhpcy51dWlkLAoJCQlidWZmZXI6IHRoaXMuYXJyYXkuYnVmZmVyLl91dWlkLAoJCQl0eXBlOiB0aGlzLmFycmF5LmNvbnN0cnVjdG9yLm5hbWUsCgkJCXN0cmlkZTogdGhpcy5zdHJpZGUKCQl9OwoKCX0KCn0KCmNvbnN0IF92ZWN0b3IkNSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNsYXNzIEludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlIHsKCgljb25zdHJ1Y3RvciggaW50ZXJsZWF2ZWRCdWZmZXIsIGl0ZW1TaXplLCBvZmZzZXQsIG5vcm1hbGl6ZWQgPSBmYWxzZSApIHsKCgkJdGhpcy5pc0ludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlID0gdHJ1ZTsKCgkJdGhpcy5uYW1lID0gJyc7CgoJCXRoaXMuZGF0YSA9IGludGVybGVhdmVkQnVmZmVyOwoJCXRoaXMuaXRlbVNpemUgPSBpdGVtU2l6ZTsKCQl0aGlzLm9mZnNldCA9IG9mZnNldDsKCgkJdGhpcy5ub3JtYWxpemVkID0gbm9ybWFsaXplZDsKCgl9CgoJZ2V0IGNvdW50KCkgewoKCQlyZXR1cm4gdGhpcy5kYXRhLmNvdW50OwoKCX0KCglnZXQgYXJyYXkoKSB7CgoJCXJldHVybiB0aGlzLmRhdGEuYXJyYXk7CgoJfQoKCXNldCBuZWVkc1VwZGF0ZSggdmFsdWUgKSB7CgoJCXRoaXMuZGF0YS5uZWVkc1VwZGF0ZSA9IHZhbHVlOwoKCX0KCglhcHBseU1hdHJpeDQoIG0gKSB7CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMuZGF0YS5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgoJCQlfdmVjdG9yJDUuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggdGhpcywgaSApOwoKCQkJX3ZlY3RvciQ1LmFwcGx5TWF0cml4NCggbSApOwoKCQkJdGhpcy5zZXRYWVooIGksIF92ZWN0b3IkNS54LCBfdmVjdG9yJDUueSwgX3ZlY3RvciQ1LnogKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJYXBwbHlOb3JtYWxNYXRyaXgoIG0gKSB7CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMuY291bnQ7IGkgPCBsOyBpICsrICkgewoKCQkJX3ZlY3RvciQ1LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHRoaXMsIGkgKTsKCgkJCV92ZWN0b3IkNS5hcHBseU5vcm1hbE1hdHJpeCggbSApOwoKCQkJdGhpcy5zZXRYWVooIGksIF92ZWN0b3IkNS54LCBfdmVjdG9yJDUueSwgX3ZlY3RvciQ1LnogKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdHJhbnNmb3JtRGlyZWN0aW9uKCBtICkgewoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB0aGlzLmNvdW50OyBpIDwgbDsgaSArKyApIHsKCgkJCV92ZWN0b3IkNS5mcm9tQnVmZmVyQXR0cmlidXRlKCB0aGlzLCBpICk7CgoJCQlfdmVjdG9yJDUudHJhbnNmb3JtRGlyZWN0aW9uKCBtICk7CgoJCQl0aGlzLnNldFhZWiggaSwgX3ZlY3RvciQ1LngsIF92ZWN0b3IkNS55LCBfdmVjdG9yJDUueiApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRYKCBpbmRleCwgeCApIHsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB4ID0gbm9ybWFsaXplKCB4LCB0aGlzLmFycmF5ICk7CgoJCXRoaXMuZGF0YS5hcnJheVsgaW5kZXggKiB0aGlzLmRhdGEuc3RyaWRlICsgdGhpcy5vZmZzZXQgXSA9IHg7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRZKCBpbmRleCwgeSApIHsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB5ID0gbm9ybWFsaXplKCB5LCB0aGlzLmFycmF5ICk7CgoJCXRoaXMuZGF0YS5hcnJheVsgaW5kZXggKiB0aGlzLmRhdGEuc3RyaWRlICsgdGhpcy5vZmZzZXQgKyAxIF0gPSB5OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0WiggaW5kZXgsIHogKSB7CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgeiA9IG5vcm1hbGl6ZSggeiwgdGhpcy5hcnJheSApOwoKCQl0aGlzLmRhdGEuYXJyYXlbIGluZGV4ICogdGhpcy5kYXRhLnN0cmlkZSArIHRoaXMub2Zmc2V0ICsgMiBdID0gejsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldFcoIGluZGV4LCB3ICkgewoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHcgPSBub3JtYWxpemUoIHcsIHRoaXMuYXJyYXkgKTsKCgkJdGhpcy5kYXRhLmFycmF5WyBpbmRleCAqIHRoaXMuZGF0YS5zdHJpZGUgKyB0aGlzLm9mZnNldCArIDMgXSA9IHc7CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXRYKCBpbmRleCApIHsKCgkJbGV0IHggPSB0aGlzLmRhdGEuYXJyYXlbIGluZGV4ICogdGhpcy5kYXRhLnN0cmlkZSArIHRoaXMub2Zmc2V0IF07CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgeCA9IGRlbm9ybWFsaXplKCB4LCB0aGlzLmFycmF5ICk7CgoJCXJldHVybiB4OwoKCX0KCglnZXRZKCBpbmRleCApIHsKCgkJbGV0IHkgPSB0aGlzLmRhdGEuYXJyYXlbIGluZGV4ICogdGhpcy5kYXRhLnN0cmlkZSArIHRoaXMub2Zmc2V0ICsgMSBdOwoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHkgPSBkZW5vcm1hbGl6ZSggeSwgdGhpcy5hcnJheSApOwoKCQlyZXR1cm4geTsKCgl9CgoJZ2V0WiggaW5kZXggKSB7CgoJCWxldCB6ID0gdGhpcy5kYXRhLmFycmF5WyBpbmRleCAqIHRoaXMuZGF0YS5zdHJpZGUgKyB0aGlzLm9mZnNldCArIDIgXTsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB6ID0gZGVub3JtYWxpemUoIHosIHRoaXMuYXJyYXkgKTsKCgkJcmV0dXJuIHo7CgoJfQoKCWdldFcoIGluZGV4ICkgewoKCQlsZXQgdyA9IHRoaXMuZGF0YS5hcnJheVsgaW5kZXggKiB0aGlzLmRhdGEuc3RyaWRlICsgdGhpcy5vZmZzZXQgKyAzIF07CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgdyA9IGRlbm9ybWFsaXplKCB3LCB0aGlzLmFycmF5ICk7CgoJCXJldHVybiB3OwoKCX0KCglzZXRYWSggaW5kZXgsIHgsIHkgKSB7CgoJCWluZGV4ID0gaW5kZXggKiB0aGlzLmRhdGEuc3RyaWRlICsgdGhpcy5vZmZzZXQ7CgoJCWlmICggdGhpcy5ub3JtYWxpemVkICkgewoKCQkJeCA9IG5vcm1hbGl6ZSggeCwgdGhpcy5hcnJheSApOwoJCQl5ID0gbm9ybWFsaXplKCB5LCB0aGlzLmFycmF5ICk7CgoJCX0KCgkJdGhpcy5kYXRhLmFycmF5WyBpbmRleCArIDAgXSA9IHg7CgkJdGhpcy5kYXRhLmFycmF5WyBpbmRleCArIDEgXSA9IHk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRYWVooIGluZGV4LCB4LCB5LCB6ICkgewoKCQlpbmRleCA9IGluZGV4ICogdGhpcy5kYXRhLnN0cmlkZSArIHRoaXMub2Zmc2V0OwoKCQlpZiAoIHRoaXMubm9ybWFsaXplZCApIHsKCgkJCXggPSBub3JtYWxpemUoIHgsIHRoaXMuYXJyYXkgKTsKCQkJeSA9IG5vcm1hbGl6ZSggeSwgdGhpcy5hcnJheSApOwoJCQl6ID0gbm9ybWFsaXplKCB6LCB0aGlzLmFycmF5ICk7CgoJCX0KCgkJdGhpcy5kYXRhLmFycmF5WyBpbmRleCArIDAgXSA9IHg7CgkJdGhpcy5kYXRhLmFycmF5WyBpbmRleCArIDEgXSA9IHk7CgkJdGhpcy5kYXRhLmFycmF5WyBpbmRleCArIDIgXSA9IHo7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRYWVpXKCBpbmRleCwgeCwgeSwgeiwgdyApIHsKCgkJaW5kZXggPSBpbmRleCAqIHRoaXMuZGF0YS5zdHJpZGUgKyB0aGlzLm9mZnNldDsKCgkJaWYgKCB0aGlzLm5vcm1hbGl6ZWQgKSB7CgoJCQl4ID0gbm9ybWFsaXplKCB4LCB0aGlzLmFycmF5ICk7CgkJCXkgPSBub3JtYWxpemUoIHksIHRoaXMuYXJyYXkgKTsKCQkJeiA9IG5vcm1hbGl6ZSggeiwgdGhpcy5hcnJheSApOwoJCQl3ID0gbm9ybWFsaXplKCB3LCB0aGlzLmFycmF5ICk7CgoJCX0KCgkJdGhpcy5kYXRhLmFycmF5WyBpbmRleCArIDAgXSA9IHg7CgkJdGhpcy5kYXRhLmFycmF5WyBpbmRleCArIDEgXSA9IHk7CgkJdGhpcy5kYXRhLmFycmF5WyBpbmRleCArIDIgXSA9IHo7CgkJdGhpcy5kYXRhLmFycmF5WyBpbmRleCArIDMgXSA9IHc7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljbG9uZSggZGF0YSApIHsKCgkJaWYgKCBkYXRhID09PSB1bmRlZmluZWQgKSB7CgoJCQljb25zb2xlLmxvZyggJ1RIUkVFLkludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlLmNsb25lKCk6IENsb25pbmcgYW4gaW50ZXJsZWF2ZWQgYnVmZmVyIGF0dHJpYnV0ZSB3aWxsIGRlLWludGVybGVhdmUgYnVmZmVyIGRhdGEuJyApOwoKCQkJY29uc3QgYXJyYXkgPSBbXTsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMuY291bnQ7IGkgKysgKSB7CgoJCQkJY29uc3QgaW5kZXggPSBpICogdGhpcy5kYXRhLnN0cmlkZSArIHRoaXMub2Zmc2V0OwoKCQkJCWZvciAoIGxldCBqID0gMDsgaiA8IHRoaXMuaXRlbVNpemU7IGogKysgKSB7CgoJCQkJCWFycmF5LnB1c2goIHRoaXMuZGF0YS5hcnJheVsgaW5kZXggKyBqIF0gKTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gbmV3IEJ1ZmZlckF0dHJpYnV0ZSggbmV3IHRoaXMuYXJyYXkuY29uc3RydWN0b3IoIGFycmF5ICksIHRoaXMuaXRlbVNpemUsIHRoaXMubm9ybWFsaXplZCApOwoKCQl9IGVsc2UgewoKCQkJaWYgKCBkYXRhLmludGVybGVhdmVkQnVmZmVycyA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWRhdGEuaW50ZXJsZWF2ZWRCdWZmZXJzID0ge307CgoJCQl9CgoJCQlpZiAoIGRhdGEuaW50ZXJsZWF2ZWRCdWZmZXJzWyB0aGlzLmRhdGEudXVpZCBdID09PSB1bmRlZmluZWQgKSB7CgoJCQkJZGF0YS5pbnRlcmxlYXZlZEJ1ZmZlcnNbIHRoaXMuZGF0YS51dWlkIF0gPSB0aGlzLmRhdGEuY2xvbmUoIGRhdGEgKTsKCgkJCX0KCgkJCXJldHVybiBuZXcgSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUoIGRhdGEuaW50ZXJsZWF2ZWRCdWZmZXJzWyB0aGlzLmRhdGEudXVpZCBdLCB0aGlzLml0ZW1TaXplLCB0aGlzLm9mZnNldCwgdGhpcy5ub3JtYWxpemVkICk7CgoJCX0KCgl9CgoJdG9KU09OKCBkYXRhICkgewoKCQlpZiAoIGRhdGEgPT09IHVuZGVmaW5lZCApIHsKCgkJCWNvbnNvbGUubG9nKCAnVEhSRUUuSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUudG9KU09OKCk6IFNlcmlhbGl6aW5nIGFuIGludGVybGVhdmVkIGJ1ZmZlciBhdHRyaWJ1dGUgd2lsbCBkZS1pbnRlcmxlYXZlIGJ1ZmZlciBkYXRhLicgKTsKCgkJCWNvbnN0IGFycmF5ID0gW107CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGlzLmNvdW50OyBpICsrICkgewoKCQkJCWNvbnN0IGluZGV4ID0gaSAqIHRoaXMuZGF0YS5zdHJpZGUgKyB0aGlzLm9mZnNldDsKCgkJCQlmb3IgKCBsZXQgaiA9IDA7IGogPCB0aGlzLml0ZW1TaXplOyBqICsrICkgewoKCQkJCQlhcnJheS5wdXNoKCB0aGlzLmRhdGEuYXJyYXlbIGluZGV4ICsgaiBdICk7CgoJCQkJfQoKCQkJfQoKCQkJLy8gZGUtaW50ZXJsZWF2ZSBkYXRhIGFuZCBzYXZlIGl0IGFzIGFuIG9yZGluYXJ5IGJ1ZmZlciBhdHRyaWJ1dGUgZm9yIG5vdwoKCQkJcmV0dXJuIHsKCQkJCWl0ZW1TaXplOiB0aGlzLml0ZW1TaXplLAoJCQkJdHlwZTogdGhpcy5hcnJheS5jb25zdHJ1Y3Rvci5uYW1lLAoJCQkJYXJyYXk6IGFycmF5LAoJCQkJbm9ybWFsaXplZDogdGhpcy5ub3JtYWxpemVkCgkJCX07CgoJCX0gZWxzZSB7CgoJCQkvLyBzYXZlIGFzIHRydWUgaW50ZXJsZWF2ZWQgYXR0cmlidXRlCgoJCQlpZiAoIGRhdGEuaW50ZXJsZWF2ZWRCdWZmZXJzID09PSB1bmRlZmluZWQgKSB7CgoJCQkJZGF0YS5pbnRlcmxlYXZlZEJ1ZmZlcnMgPSB7fTsKCgkJCX0KCgkJCWlmICggZGF0YS5pbnRlcmxlYXZlZEJ1ZmZlcnNbIHRoaXMuZGF0YS51dWlkIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQlkYXRhLmludGVybGVhdmVkQnVmZmVyc1sgdGhpcy5kYXRhLnV1aWQgXSA9IHRoaXMuZGF0YS50b0pTT04oIGRhdGEgKTsKCgkJCX0KCgkJCXJldHVybiB7CgkJCQlpc0ludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlOiB0cnVlLAoJCQkJaXRlbVNpemU6IHRoaXMuaXRlbVNpemUsCgkJCQlkYXRhOiB0aGlzLmRhdGEudXVpZCwKCQkJCW9mZnNldDogdGhpcy5vZmZzZXQsCgkJCQlub3JtYWxpemVkOiB0aGlzLm5vcm1hbGl6ZWQKCQkJfTsKCgkJfQoKCX0KCn0KCmNsYXNzIFNwcml0ZU1hdGVyaWFsIGV4dGVuZHMgTWF0ZXJpYWwgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJzICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzU3ByaXRlTWF0ZXJpYWwgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnU3ByaXRlTWF0ZXJpYWwnOwoKCQl0aGlzLmNvbG9yID0gbmV3IENvbG9yKCAweGZmZmZmZiApOwoKCQl0aGlzLm1hcCA9IG51bGw7CgoJCXRoaXMuYWxwaGFNYXAgPSBudWxsOwoKCQl0aGlzLnJvdGF0aW9uID0gMDsKCgkJdGhpcy5zaXplQXR0ZW51YXRpb24gPSB0cnVlOwoKCQl0aGlzLnRyYW5zcGFyZW50ID0gdHJ1ZTsKCgkJdGhpcy5mb2cgPSB0cnVlOwoKCQl0aGlzLnNldFZhbHVlcyggcGFyYW1ldGVycyApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLmNvbG9yLmNvcHkoIHNvdXJjZS5jb2xvciApOwoKCQl0aGlzLm1hcCA9IHNvdXJjZS5tYXA7CgoJCXRoaXMuYWxwaGFNYXAgPSBzb3VyY2UuYWxwaGFNYXA7CgoJCXRoaXMucm90YXRpb24gPSBzb3VyY2Uucm90YXRpb247CgoJCXRoaXMuc2l6ZUF0dGVudWF0aW9uID0gc291cmNlLnNpemVBdHRlbnVhdGlvbjsKCgkJdGhpcy5mb2cgPSBzb3VyY2UuZm9nOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpsZXQgX2dlb21ldHJ5OwoKY29uc3QgX2ludGVyc2VjdFBvaW50ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfd29ybGRTY2FsZSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX212UG9zaXRpb24gPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7Cgpjb25zdCBfYWxpZ25lZFBvc2l0aW9uID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMigpOwpjb25zdCBfcm90YXRlZFBvc2l0aW9uID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMigpOwpjb25zdCBfdmlld1dvcmxkTWF0cml4ID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwoKY29uc3QgX3ZBID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfdkIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF92QyA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNvbnN0IF91dkEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IyKCk7CmNvbnN0IF91dkIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IyKCk7CmNvbnN0IF91dkMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IyKCk7CgpjbGFzcyBTcHJpdGUgZXh0ZW5kcyBPYmplY3QzRCB7CgoJY29uc3RydWN0b3IoIG1hdGVyaWFsID0gbmV3IFNwcml0ZU1hdGVyaWFsKCkgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMuaXNTcHJpdGUgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnU3ByaXRlJzsKCgkJaWYgKCBfZ2VvbWV0cnkgPT09IHVuZGVmaW5lZCApIHsKCgkJCV9nZW9tZXRyeSA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoKCQkJY29uc3QgZmxvYXQzMkFycmF5ID0gbmV3IEZsb2F0MzJBcnJheSggWwoJCQkJLSAwLjUsIC0gMC41LCAwLCAwLCAwLAoJCQkJMC41LCAtIDAuNSwgMCwgMSwgMCwKCQkJCTAuNSwgMC41LCAwLCAxLCAxLAoJCQkJLSAwLjUsIDAuNSwgMCwgMCwgMQoJCQldICk7CgoJCQljb25zdCBpbnRlcmxlYXZlZEJ1ZmZlciA9IG5ldyBJbnRlcmxlYXZlZEJ1ZmZlciggZmxvYXQzMkFycmF5LCA1ICk7CgoJCQlfZ2VvbWV0cnkuc2V0SW5kZXgoIFsgMCwgMSwgMiwJMCwgMiwgMyBdICk7CgkJCV9nZW9tZXRyeS5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSggaW50ZXJsZWF2ZWRCdWZmZXIsIDMsIDAsIGZhbHNlICkgKTsKCQkJX2dlb21ldHJ5LnNldEF0dHJpYnV0ZSggJ3V2JywgbmV3IEludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlKCBpbnRlcmxlYXZlZEJ1ZmZlciwgMiwgMywgZmFsc2UgKSApOwoKCQl9CgoJCXRoaXMuZ2VvbWV0cnkgPSBfZ2VvbWV0cnk7CgkJdGhpcy5tYXRlcmlhbCA9IG1hdGVyaWFsOwoKCQl0aGlzLmNlbnRlciA9IG5ldyBWZWN0b3IyKCAwLjUsIDAuNSApOwoKCX0KCglyYXljYXN0KCByYXljYXN0ZXIsIGludGVyc2VjdHMgKSB7CgoJCWlmICggcmF5Y2FzdGVyLmNhbWVyYSA9PT0gbnVsbCApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5TcHJpdGU6ICJSYXljYXN0ZXIuY2FtZXJhIiBuZWVkcyB0byBiZSBzZXQgaW4gb3JkZXIgdG8gcmF5Y2FzdCBhZ2FpbnN0IHNwcml0ZXMuJyApOwoKCQl9CgoJCV93b3JsZFNjYWxlLnNldEZyb21NYXRyaXhTY2FsZSggdGhpcy5tYXRyaXhXb3JsZCApOwoKCQlfdmlld1dvcmxkTWF0cml4LmNvcHkoIHJheWNhc3Rlci5jYW1lcmEubWF0cml4V29ybGQgKTsKCQl0aGlzLm1vZGVsVmlld01hdHJpeC5tdWx0aXBseU1hdHJpY2VzKCByYXljYXN0ZXIuY2FtZXJhLm1hdHJpeFdvcmxkSW52ZXJzZSwgdGhpcy5tYXRyaXhXb3JsZCApOwoKCQlfbXZQb3NpdGlvbi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIHRoaXMubW9kZWxWaWV3TWF0cml4ICk7CgoJCWlmICggcmF5Y2FzdGVyLmNhbWVyYS5pc1BlcnNwZWN0aXZlQ2FtZXJhICYmIHRoaXMubWF0ZXJpYWwuc2l6ZUF0dGVudWF0aW9uID09PSBmYWxzZSApIHsKCgkJCV93b3JsZFNjYWxlLm11bHRpcGx5U2NhbGFyKCAtIF9tdlBvc2l0aW9uLnogKTsKCgkJfQoKCQljb25zdCByb3RhdGlvbiA9IHRoaXMubWF0ZXJpYWwucm90YXRpb247CgkJbGV0IHNpbiwgY29zOwoKCQlpZiAoIHJvdGF0aW9uICE9PSAwICkgewoKCQkJY29zID0gTWF0aC5jb3MoIHJvdGF0aW9uICk7CgkJCXNpbiA9IE1hdGguc2luKCByb3RhdGlvbiApOwoKCQl9CgoJCWNvbnN0IGNlbnRlciA9IHRoaXMuY2VudGVyOwoKCQl0cmFuc2Zvcm1WZXJ0ZXgoIF92QS5zZXQoIC0gMC41LCAtIDAuNSwgMCApLCBfbXZQb3NpdGlvbiwgY2VudGVyLCBfd29ybGRTY2FsZSwgc2luLCBjb3MgKTsKCQl0cmFuc2Zvcm1WZXJ0ZXgoIF92Qi5zZXQoIDAuNSwgLSAwLjUsIDAgKSwgX212UG9zaXRpb24sIGNlbnRlciwgX3dvcmxkU2NhbGUsIHNpbiwgY29zICk7CgkJdHJhbnNmb3JtVmVydGV4KCBfdkMuc2V0KCAwLjUsIDAuNSwgMCApLCBfbXZQb3NpdGlvbiwgY2VudGVyLCBfd29ybGRTY2FsZSwgc2luLCBjb3MgKTsKCgkJX3V2QS5zZXQoIDAsIDAgKTsKCQlfdXZCLnNldCggMSwgMCApOwoJCV91dkMuc2V0KCAxLCAxICk7CgoJCS8vIGNoZWNrIGZpcnN0IHRyaWFuZ2xlCgkJbGV0IGludGVyc2VjdCA9IHJheWNhc3Rlci5yYXkuaW50ZXJzZWN0VHJpYW5nbGUoIF92QSwgX3ZCLCBfdkMsIGZhbHNlLCBfaW50ZXJzZWN0UG9pbnQgKTsKCgkJaWYgKCBpbnRlcnNlY3QgPT09IG51bGwgKSB7CgoJCQkvLyBjaGVjayBzZWNvbmQgdHJpYW5nbGUKCQkJdHJhbnNmb3JtVmVydGV4KCBfdkIuc2V0KCAtIDAuNSwgMC41LCAwICksIF9tdlBvc2l0aW9uLCBjZW50ZXIsIF93b3JsZFNjYWxlLCBzaW4sIGNvcyApOwoJCQlfdXZCLnNldCggMCwgMSApOwoKCQkJaW50ZXJzZWN0ID0gcmF5Y2FzdGVyLnJheS5pbnRlcnNlY3RUcmlhbmdsZSggX3ZBLCBfdkMsIF92QiwgZmFsc2UsIF9pbnRlcnNlY3RQb2ludCApOwoJCQlpZiAoIGludGVyc2VjdCA9PT0gbnVsbCApIHsKCgkJCQlyZXR1cm47CgoJCQl9CgoJCX0KCgkJY29uc3QgZGlzdGFuY2UgPSByYXljYXN0ZXIucmF5Lm9yaWdpbi5kaXN0YW5jZVRvKCBfaW50ZXJzZWN0UG9pbnQgKTsKCgkJaWYgKCBkaXN0YW5jZSA8IHJheWNhc3Rlci5uZWFyIHx8IGRpc3RhbmNlID4gcmF5Y2FzdGVyLmZhciApIHJldHVybjsKCgkJaW50ZXJzZWN0cy5wdXNoKCB7CgoJCQlkaXN0YW5jZTogZGlzdGFuY2UsCgkJCXBvaW50OiBfaW50ZXJzZWN0UG9pbnQuY2xvbmUoKSwKCQkJdXY6IFRyaWFuZ2xlLmdldEludGVycG9sYXRpb24oIF9pbnRlcnNlY3RQb2ludCwgX3ZBLCBfdkIsIF92QywgX3V2QSwgX3V2QiwgX3V2QywgbmV3IFZlY3RvcjIoKSApLAoJCQlmYWNlOiBudWxsLAoJCQlvYmplY3Q6IHRoaXMKCgkJfSApOwoKCX0KCgljb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlLCByZWN1cnNpdmUgKTsKCgkJaWYgKCBzb3VyY2UuY2VudGVyICE9PSB1bmRlZmluZWQgKSB0aGlzLmNlbnRlci5jb3B5KCBzb3VyY2UuY2VudGVyICk7CgoJCXRoaXMubWF0ZXJpYWwgPSBzb3VyY2UubWF0ZXJpYWw7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmZ1bmN0aW9uIHRyYW5zZm9ybVZlcnRleCggdmVydGV4UG9zaXRpb24sIG12UG9zaXRpb24sIGNlbnRlciwgc2NhbGUsIHNpbiwgY29zICkgewoKCS8vIGNvbXB1dGUgcG9zaXRpb24gaW4gY2FtZXJhIHNwYWNlCglfYWxpZ25lZFBvc2l0aW9uLnN1YlZlY3RvcnMoIHZlcnRleFBvc2l0aW9uLCBjZW50ZXIgKS5hZGRTY2FsYXIoIDAuNSApLm11bHRpcGx5KCBzY2FsZSApOwoKCS8vIHRvIGNoZWNrIGlmIHJvdGF0aW9uIGlzIG5vdCB6ZXJvCglpZiAoIHNpbiAhPT0gdW5kZWZpbmVkICkgewoKCQlfcm90YXRlZFBvc2l0aW9uLnggPSAoIGNvcyAqIF9hbGlnbmVkUG9zaXRpb24ueCApIC0gKCBzaW4gKiBfYWxpZ25lZFBvc2l0aW9uLnkgKTsKCQlfcm90YXRlZFBvc2l0aW9uLnkgPSAoIHNpbiAqIF9hbGlnbmVkUG9zaXRpb24ueCApICsgKCBjb3MgKiBfYWxpZ25lZFBvc2l0aW9uLnkgKTsKCgl9IGVsc2UgewoKCQlfcm90YXRlZFBvc2l0aW9uLmNvcHkoIF9hbGlnbmVkUG9zaXRpb24gKTsKCgl9CgoKCXZlcnRleFBvc2l0aW9uLmNvcHkoIG12UG9zaXRpb24gKTsKCXZlcnRleFBvc2l0aW9uLnggKz0gX3JvdGF0ZWRQb3NpdGlvbi54OwoJdmVydGV4UG9zaXRpb24ueSArPSBfcm90YXRlZFBvc2l0aW9uLnk7CgoJLy8gdHJhbnNmb3JtIHRvIHdvcmxkIHNwYWNlCgl2ZXJ0ZXhQb3NpdGlvbi5hcHBseU1hdHJpeDQoIF92aWV3V29ybGRNYXRyaXggKTsKCn0KCmNvbnN0IF92MSQyID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfdjIkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNsYXNzIExPRCBleHRlbmRzIE9iamVjdDNEIHsKCgljb25zdHJ1Y3RvcigpIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5fY3VycmVudExldmVsID0gMDsKCgkJdGhpcy50eXBlID0gJ0xPRCc7CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0aWVzKCB0aGlzLCB7CgkJCWxldmVsczogewoJCQkJZW51bWVyYWJsZTogdHJ1ZSwKCQkJCXZhbHVlOiBbXQoJCQl9LAoJCQlpc0xPRDogewoJCQkJdmFsdWU6IHRydWUsCgkJCX0KCQl9ICk7CgoJCXRoaXMuYXV0b1VwZGF0ZSA9IHRydWU7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlLCBmYWxzZSApOwoKCQljb25zdCBsZXZlbHMgPSBzb3VyY2UubGV2ZWxzOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBsZXZlbHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IGxldmVsID0gbGV2ZWxzWyBpIF07CgoJCQl0aGlzLmFkZExldmVsKCBsZXZlbC5vYmplY3QuY2xvbmUoKSwgbGV2ZWwuZGlzdGFuY2UsIGxldmVsLmh5c3RlcmVzaXMgKTsKCgkJfQoKCQl0aGlzLmF1dG9VcGRhdGUgPSBzb3VyY2UuYXV0b1VwZGF0ZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFkZExldmVsKCBvYmplY3QsIGRpc3RhbmNlID0gMCwgaHlzdGVyZXNpcyA9IDAgKSB7CgoJCWRpc3RhbmNlID0gTWF0aC5hYnMoIGRpc3RhbmNlICk7CgoJCWNvbnN0IGxldmVscyA9IHRoaXMubGV2ZWxzOwoKCQlsZXQgbDsKCgkJZm9yICggbCA9IDA7IGwgPCBsZXZlbHMubGVuZ3RoOyBsICsrICkgewoKCQkJaWYgKCBkaXN0YW5jZSA8IGxldmVsc1sgbCBdLmRpc3RhbmNlICkgewoKCQkJCWJyZWFrOwoKCQkJfQoKCQl9CgoJCWxldmVscy5zcGxpY2UoIGwsIDAsIHsgZGlzdGFuY2U6IGRpc3RhbmNlLCBoeXN0ZXJlc2lzOiBoeXN0ZXJlc2lzLCBvYmplY3Q6IG9iamVjdCB9ICk7CgoJCXRoaXMuYWRkKCBvYmplY3QgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWdldEN1cnJlbnRMZXZlbCgpIHsKCgkJcmV0dXJuIHRoaXMuX2N1cnJlbnRMZXZlbDsKCgl9CgoKCglnZXRPYmplY3RGb3JEaXN0YW5jZSggZGlzdGFuY2UgKSB7CgoJCWNvbnN0IGxldmVscyA9IHRoaXMubGV2ZWxzOwoKCQlpZiAoIGxldmVscy5sZW5ndGggPiAwICkgewoKCQkJbGV0IGksIGw7CgoJCQlmb3IgKCBpID0gMSwgbCA9IGxldmVscy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWxldCBsZXZlbERpc3RhbmNlID0gbGV2ZWxzWyBpIF0uZGlzdGFuY2U7CgoJCQkJaWYgKCBsZXZlbHNbIGkgXS5vYmplY3QudmlzaWJsZSApIHsKCgkJCQkJbGV2ZWxEaXN0YW5jZSAtPSBsZXZlbERpc3RhbmNlICogbGV2ZWxzWyBpIF0uaHlzdGVyZXNpczsKCgkJCQl9CgoJCQkJaWYgKCBkaXN0YW5jZSA8IGxldmVsRGlzdGFuY2UgKSB7CgoJCQkJCWJyZWFrOwoKCQkJCX0KCgkJCX0KCgkJCXJldHVybiBsZXZlbHNbIGkgLSAxIF0ub2JqZWN0OwoKCQl9CgoJCXJldHVybiBudWxsOwoKCX0KCglyYXljYXN0KCByYXljYXN0ZXIsIGludGVyc2VjdHMgKSB7CgoJCWNvbnN0IGxldmVscyA9IHRoaXMubGV2ZWxzOwoKCQlpZiAoIGxldmVscy5sZW5ndGggPiAwICkgewoKCQkJX3YxJDIuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCB0aGlzLm1hdHJpeFdvcmxkICk7CgoJCQljb25zdCBkaXN0YW5jZSA9IHJheWNhc3Rlci5yYXkub3JpZ2luLmRpc3RhbmNlVG8oIF92MSQyICk7CgoJCQl0aGlzLmdldE9iamVjdEZvckRpc3RhbmNlKCBkaXN0YW5jZSApLnJheWNhc3QoIHJheWNhc3RlciwgaW50ZXJzZWN0cyApOwoKCQl9CgoJfQoKCXVwZGF0ZSggY2FtZXJhICkgewoKCQljb25zdCBsZXZlbHMgPSB0aGlzLmxldmVsczsKCgkJaWYgKCBsZXZlbHMubGVuZ3RoID4gMSApIHsKCgkJCV92MSQyLnNldEZyb21NYXRyaXhQb3NpdGlvbiggY2FtZXJhLm1hdHJpeFdvcmxkICk7CgkJCV92MiQxLnNldEZyb21NYXRyaXhQb3NpdGlvbiggdGhpcy5tYXRyaXhXb3JsZCApOwoKCQkJY29uc3QgZGlzdGFuY2UgPSBfdjEkMi5kaXN0YW5jZVRvKCBfdjIkMSApIC8gY2FtZXJhLnpvb207CgoJCQlsZXZlbHNbIDAgXS5vYmplY3QudmlzaWJsZSA9IHRydWU7CgoJCQlsZXQgaSwgbDsKCgkJCWZvciAoIGkgPSAxLCBsID0gbGV2ZWxzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJbGV0IGxldmVsRGlzdGFuY2UgPSBsZXZlbHNbIGkgXS5kaXN0YW5jZTsKCgkJCQlpZiAoIGxldmVsc1sgaSBdLm9iamVjdC52aXNpYmxlICkgewoKCQkJCQlsZXZlbERpc3RhbmNlIC09IGxldmVsRGlzdGFuY2UgKiBsZXZlbHNbIGkgXS5oeXN0ZXJlc2lzOwoKCQkJCX0KCgkJCQlpZiAoIGRpc3RhbmNlID49IGxldmVsRGlzdGFuY2UgKSB7CgoJCQkJCWxldmVsc1sgaSAtIDEgXS5vYmplY3QudmlzaWJsZSA9IGZhbHNlOwoJCQkJCWxldmVsc1sgaSBdLm9iamVjdC52aXNpYmxlID0gdHJ1ZTsKCgkJCQl9IGVsc2UgewoKCQkJCQlicmVhazsKCgkJCQl9CgoJCQl9CgoJCQl0aGlzLl9jdXJyZW50TGV2ZWwgPSBpIC0gMTsKCgkJCWZvciAoIDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJbGV2ZWxzWyBpIF0ub2JqZWN0LnZpc2libGUgPSBmYWxzZTsKCgkJCX0KCgkJfQoKCX0KCgl0b0pTT04oIG1ldGEgKSB7CgoJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oIG1ldGEgKTsKCgkJaWYgKCB0aGlzLmF1dG9VcGRhdGUgPT09IGZhbHNlICkgZGF0YS5vYmplY3QuYXV0b1VwZGF0ZSA9IGZhbHNlOwoKCQlkYXRhLm9iamVjdC5sZXZlbHMgPSBbXTsKCgkJY29uc3QgbGV2ZWxzID0gdGhpcy5sZXZlbHM7CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IGxldmVscy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJY29uc3QgbGV2ZWwgPSBsZXZlbHNbIGkgXTsKCgkJCWRhdGEub2JqZWN0LmxldmVscy5wdXNoKCB7CgkJCQlvYmplY3Q6IGxldmVsLm9iamVjdC51dWlkLAoJCQkJZGlzdGFuY2U6IGxldmVsLmRpc3RhbmNlLAoJCQkJaHlzdGVyZXNpczogbGV2ZWwuaHlzdGVyZXNpcwoJCQl9ICk7CgoJCX0KCgkJcmV0dXJuIGRhdGE7CgoJfQoKfQoKY29uc3QgX2Jhc2VQb3NpdGlvbiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNvbnN0IF9za2luSW5kZXggPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3I0KCk7CmNvbnN0IF9za2luV2VpZ2h0ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yNCgpOwoKY29uc3QgX3ZlY3RvcjMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF9tYXRyaXg0ID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwpjb25zdCBfdmVydGV4ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKY29uc3QgX3NwaGVyZSQzID0gLypAX19QVVJFX18qLyBuZXcgU3BoZXJlKCk7CmNvbnN0IF9pbnZlcnNlTWF0cml4JDIgPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXg0KCk7CmNvbnN0IF9yYXkkMiA9IC8qQF9fUFVSRV9fKi8gbmV3IFJheSgpOwoKY2xhc3MgU2tpbm5lZE1lc2ggZXh0ZW5kcyBNZXNoIHsKCgljb25zdHJ1Y3RvciggZ2VvbWV0cnksIG1hdGVyaWFsICkgewoKCQlzdXBlciggZ2VvbWV0cnksIG1hdGVyaWFsICk7CgoJCXRoaXMuaXNTa2lubmVkTWVzaCA9IHRydWU7CgoJCXRoaXMudHlwZSA9ICdTa2lubmVkTWVzaCc7CgoJCXRoaXMuYmluZE1vZGUgPSAnYXR0YWNoZWQnOwoJCXRoaXMuYmluZE1hdHJpeCA9IG5ldyBNYXRyaXg0KCk7CgkJdGhpcy5iaW5kTWF0cml4SW52ZXJzZSA9IG5ldyBNYXRyaXg0KCk7CgoJCXRoaXMuYm91bmRpbmdCb3ggPSBudWxsOwoJCXRoaXMuYm91bmRpbmdTcGhlcmUgPSBudWxsOwoKCX0KCgljb21wdXRlQm91bmRpbmdCb3goKSB7CgoJCWNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCgkJaWYgKCB0aGlzLmJvdW5kaW5nQm94ID09PSBudWxsICkgewoKCQkJdGhpcy5ib3VuZGluZ0JveCA9IG5ldyBCb3gzKCk7CgoJCX0KCgkJdGhpcy5ib3VuZGluZ0JveC5tYWtlRW1wdHkoKTsKCgkJY29uc3QgcG9zaXRpb25BdHRyaWJ1dGUgPSBnZW9tZXRyeS5nZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicgKTsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgcG9zaXRpb25BdHRyaWJ1dGUuY291bnQ7IGkgKysgKSB7CgoJCQlfdmVydGV4LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBpICk7CgkJCXRoaXMuYXBwbHlCb25lVHJhbnNmb3JtKCBpLCBfdmVydGV4ICk7CgkJCXRoaXMuYm91bmRpbmdCb3guZXhwYW5kQnlQb2ludCggX3ZlcnRleCApOwoKCQl9CgoJfQoKCWNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpIHsKCgkJY29uc3QgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwoKCQlpZiAoIHRoaXMuYm91bmRpbmdTcGhlcmUgPT09IG51bGwgKSB7CgoJCQl0aGlzLmJvdW5kaW5nU3BoZXJlID0gbmV3IFNwaGVyZSgpOwoKCQl9CgoJCXRoaXMuYm91bmRpbmdTcGhlcmUubWFrZUVtcHR5KCk7CgoJCWNvbnN0IHBvc2l0aW9uQXR0cmlidXRlID0gZ2VvbWV0cnkuZ2V0QXR0cmlidXRlKCAncG9zaXRpb24nICk7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IHBvc2l0aW9uQXR0cmlidXRlLmNvdW50OyBpICsrICkgewoKCQkJX3ZlcnRleC5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgaSApOwoJCQl0aGlzLmFwcGx5Qm9uZVRyYW5zZm9ybSggaSwgX3ZlcnRleCApOwoJCQl0aGlzLmJvdW5kaW5nU3BoZXJlLmV4cGFuZEJ5UG9pbnQoIF92ZXJ0ZXggKTsKCgkJfQoKCX0KCgljb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlLCByZWN1cnNpdmUgKTsKCgkJdGhpcy5iaW5kTW9kZSA9IHNvdXJjZS5iaW5kTW9kZTsKCQl0aGlzLmJpbmRNYXRyaXguY29weSggc291cmNlLmJpbmRNYXRyaXggKTsKCQl0aGlzLmJpbmRNYXRyaXhJbnZlcnNlLmNvcHkoIHNvdXJjZS5iaW5kTWF0cml4SW52ZXJzZSApOwoKCQl0aGlzLnNrZWxldG9uID0gc291cmNlLnNrZWxldG9uOwoKCQlpZiAoIHNvdXJjZS5ib3VuZGluZ0JveCAhPT0gbnVsbCApIHRoaXMuYm91bmRpbmdCb3ggPSBzb3VyY2UuYm91bmRpbmdCb3guY2xvbmUoKTsKCQlpZiAoIHNvdXJjZS5ib3VuZGluZ1NwaGVyZSAhPT0gbnVsbCApIHRoaXMuYm91bmRpbmdTcGhlcmUgPSBzb3VyY2UuYm91bmRpbmdTcGhlcmUuY2xvbmUoKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXJheWNhc3QoIHJheWNhc3RlciwgaW50ZXJzZWN0cyApIHsKCgkJY29uc3QgbWF0ZXJpYWwgPSB0aGlzLm1hdGVyaWFsOwoJCWNvbnN0IG1hdHJpeFdvcmxkID0gdGhpcy5tYXRyaXhXb3JsZDsKCgkJaWYgKCBtYXRlcmlhbCA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQkvLyB0ZXN0IHdpdGggYm91bmRpbmcgc3BoZXJlIGluIHdvcmxkIHNwYWNlCgoJCWlmICggdGhpcy5ib3VuZGluZ1NwaGVyZSA9PT0gbnVsbCApIHRoaXMuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgoJCV9zcGhlcmUkMy5jb3B5KCB0aGlzLmJvdW5kaW5nU3BoZXJlICk7CgkJX3NwaGVyZSQzLmFwcGx5TWF0cml4NCggbWF0cml4V29ybGQgKTsKCgkJaWYgKCByYXljYXN0ZXIucmF5LmludGVyc2VjdHNTcGhlcmUoIF9zcGhlcmUkMyApID09PSBmYWxzZSApIHJldHVybjsKCgkJLy8gY29udmVydCByYXkgdG8gbG9jYWwgc3BhY2Ugb2Ygc2tpbm5lZCBtZXNoCgoJCV9pbnZlcnNlTWF0cml4JDIuY29weSggbWF0cml4V29ybGQgKS5pbnZlcnQoKTsKCQlfcmF5JDIuY29weSggcmF5Y2FzdGVyLnJheSApLmFwcGx5TWF0cml4NCggX2ludmVyc2VNYXRyaXgkMiApOwoKCQkvLyB0ZXN0IHdpdGggYm91bmRpbmcgYm94IGluIGxvY2FsIHNwYWNlCgoJCWlmICggdGhpcy5ib3VuZGluZ0JveCAhPT0gbnVsbCApIHsKCgkJCWlmICggX3JheSQyLmludGVyc2VjdHNCb3goIHRoaXMuYm91bmRpbmdCb3ggKSA9PT0gZmFsc2UgKSByZXR1cm47CgoJCX0KCgkJLy8gdGVzdCBmb3IgaW50ZXJzZWN0aW9ucyB3aXRoIGdlb21ldHJ5CgoJCXRoaXMuX2NvbXB1dGVJbnRlcnNlY3Rpb25zKCByYXljYXN0ZXIsIGludGVyc2VjdHMsIF9yYXkkMiApOwoKCX0KCglnZXRWZXJ0ZXhQb3NpdGlvbiggaW5kZXgsIHRhcmdldCApIHsKCgkJc3VwZXIuZ2V0VmVydGV4UG9zaXRpb24oIGluZGV4LCB0YXJnZXQgKTsKCgkJdGhpcy5hcHBseUJvbmVUcmFuc2Zvcm0oIGluZGV4LCB0YXJnZXQgKTsKCgkJcmV0dXJuIHRhcmdldDsKCgl9CgoJYmluZCggc2tlbGV0b24sIGJpbmRNYXRyaXggKSB7CgoJCXRoaXMuc2tlbGV0b24gPSBza2VsZXRvbjsKCgkJaWYgKCBiaW5kTWF0cml4ID09PSB1bmRlZmluZWQgKSB7CgoJCQl0aGlzLnVwZGF0ZU1hdHJpeFdvcmxkKCB0cnVlICk7CgoJCQl0aGlzLnNrZWxldG9uLmNhbGN1bGF0ZUludmVyc2VzKCk7CgoJCQliaW5kTWF0cml4ID0gdGhpcy5tYXRyaXhXb3JsZDsKCgkJfQoKCQl0aGlzLmJpbmRNYXRyaXguY29weSggYmluZE1hdHJpeCApOwoJCXRoaXMuYmluZE1hdHJpeEludmVyc2UuY29weSggYmluZE1hdHJpeCApLmludmVydCgpOwoKCX0KCglwb3NlKCkgewoKCQl0aGlzLnNrZWxldG9uLnBvc2UoKTsKCgl9CgoJbm9ybWFsaXplU2tpbldlaWdodHMoKSB7CgoJCWNvbnN0IHZlY3RvciA9IG5ldyBWZWN0b3I0KCk7CgoJCWNvbnN0IHNraW5XZWlnaHQgPSB0aGlzLmdlb21ldHJ5LmF0dHJpYnV0ZXMuc2tpbldlaWdodDsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gc2tpbldlaWdodC5jb3VudDsgaSA8IGw7IGkgKysgKSB7CgoJCQl2ZWN0b3IuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggc2tpbldlaWdodCwgaSApOwoKCQkJY29uc3Qgc2NhbGUgPSAxLjAgLyB2ZWN0b3IubWFuaGF0dGFuTGVuZ3RoKCk7CgoJCQlpZiAoIHNjYWxlICE9PSBJbmZpbml0eSApIHsKCgkJCQl2ZWN0b3IubXVsdGlwbHlTY2FsYXIoIHNjYWxlICk7CgoJCQl9IGVsc2UgewoKCQkJCXZlY3Rvci5zZXQoIDEsIDAsIDAsIDAgKTsgLy8gZG8gc29tZXRoaW5nIHJlYXNvbmFibGUKCgkJCX0KCgkJCXNraW5XZWlnaHQuc2V0WFlaVyggaSwgdmVjdG9yLngsIHZlY3Rvci55LCB2ZWN0b3IueiwgdmVjdG9yLncgKTsKCgkJfQoKCX0KCgl1cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKSB7CgoJCXN1cGVyLnVwZGF0ZU1hdHJpeFdvcmxkKCBmb3JjZSApOwoKCQlpZiAoIHRoaXMuYmluZE1vZGUgPT09ICdhdHRhY2hlZCcgKSB7CgoJCQl0aGlzLmJpbmRNYXRyaXhJbnZlcnNlLmNvcHkoIHRoaXMubWF0cml4V29ybGQgKS5pbnZlcnQoKTsKCgkJfSBlbHNlIGlmICggdGhpcy5iaW5kTW9kZSA9PT0gJ2RldGFjaGVkJyApIHsKCgkJCXRoaXMuYmluZE1hdHJpeEludmVyc2UuY29weSggdGhpcy5iaW5kTWF0cml4ICkuaW52ZXJ0KCk7CgoJCX0gZWxzZSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5Ta2lubmVkTWVzaDogVW5yZWNvZ25pemVkIGJpbmRNb2RlOiAnICsgdGhpcy5iaW5kTW9kZSApOwoKCQl9CgoJfQoKCWFwcGx5Qm9uZVRyYW5zZm9ybSggaW5kZXgsIHZlY3RvciApIHsKCgkJY29uc3Qgc2tlbGV0b24gPSB0aGlzLnNrZWxldG9uOwoJCWNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCgkJX3NraW5JbmRleC5mcm9tQnVmZmVyQXR0cmlidXRlKCBnZW9tZXRyeS5hdHRyaWJ1dGVzLnNraW5JbmRleCwgaW5kZXggKTsKCQlfc2tpbldlaWdodC5mcm9tQnVmZmVyQXR0cmlidXRlKCBnZW9tZXRyeS5hdHRyaWJ1dGVzLnNraW5XZWlnaHQsIGluZGV4ICk7CgoJCV9iYXNlUG9zaXRpb24uY29weSggdmVjdG9yICkuYXBwbHlNYXRyaXg0KCB0aGlzLmJpbmRNYXRyaXggKTsKCgkJdmVjdG9yLnNldCggMCwgMCwgMCApOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA0OyBpICsrICkgewoKCQkJY29uc3Qgd2VpZ2h0ID0gX3NraW5XZWlnaHQuZ2V0Q29tcG9uZW50KCBpICk7CgoJCQlpZiAoIHdlaWdodCAhPT0gMCApIHsKCgkJCQljb25zdCBib25lSW5kZXggPSBfc2tpbkluZGV4LmdldENvbXBvbmVudCggaSApOwoKCQkJCV9tYXRyaXg0Lm11bHRpcGx5TWF0cmljZXMoIHNrZWxldG9uLmJvbmVzWyBib25lSW5kZXggXS5tYXRyaXhXb3JsZCwgc2tlbGV0b24uYm9uZUludmVyc2VzWyBib25lSW5kZXggXSApOwoKCQkJCXZlY3Rvci5hZGRTY2FsZWRWZWN0b3IoIF92ZWN0b3IzLmNvcHkoIF9iYXNlUG9zaXRpb24gKS5hcHBseU1hdHJpeDQoIF9tYXRyaXg0ICksIHdlaWdodCApOwoKCQkJfQoKCQl9CgoJCXJldHVybiB2ZWN0b3IuYXBwbHlNYXRyaXg0KCB0aGlzLmJpbmRNYXRyaXhJbnZlcnNlICk7CgoJfQoKCWJvbmVUcmFuc2Zvcm0oIGluZGV4LCB2ZWN0b3IgKSB7IC8vIEBkZXByZWNhdGVkLCByMTUxCgoJCWNvbnNvbGUud2FybiggJ1RIUkVFLlNraW5uZWRNZXNoOiAuYm9uZVRyYW5zZm9ybSgpIHdhcyByZW5hbWVkIHRvIC5hcHBseUJvbmVUcmFuc2Zvcm0oKSBpbiByMTUxLicgKTsKCQlyZXR1cm4gdGhpcy5hcHBseUJvbmVUcmFuc2Zvcm0oIGluZGV4LCB2ZWN0b3IgKTsKCgl9CgoKfQoKY2xhc3MgQm9uZSBleHRlbmRzIE9iamVjdDNEIHsKCgljb25zdHJ1Y3RvcigpIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc0JvbmUgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnQm9uZSc7CgoJfQoKfQoKY2xhc3MgRGF0YVRleHR1cmUgZXh0ZW5kcyBUZXh0dXJlIHsKCgljb25zdHJ1Y3RvciggZGF0YSA9IG51bGwsIHdpZHRoID0gMSwgaGVpZ2h0ID0gMSwgZm9ybWF0LCB0eXBlLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciA9IE5lYXJlc3RGaWx0ZXIsIG1pbkZpbHRlciA9IE5lYXJlc3RGaWx0ZXIsIGFuaXNvdHJvcHksIGNvbG9yU3BhY2UgKSB7CgoJCXN1cGVyKCBudWxsLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciwgbWluRmlsdGVyLCBmb3JtYXQsIHR5cGUsIGFuaXNvdHJvcHksIGNvbG9yU3BhY2UgKTsKCgkJdGhpcy5pc0RhdGFUZXh0dXJlID0gdHJ1ZTsKCgkJdGhpcy5pbWFnZSA9IHsgZGF0YTogZGF0YSwgd2lkdGg6IHdpZHRoLCBoZWlnaHQ6IGhlaWdodCB9OwoKCQl0aGlzLmdlbmVyYXRlTWlwbWFwcyA9IGZhbHNlOwoJCXRoaXMuZmxpcFkgPSBmYWxzZTsKCQl0aGlzLnVucGFja0FsaWdubWVudCA9IDE7CgoJfQoKfQoKY29uc3QgX29mZnNldE1hdHJpeCA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKY29uc3QgX2lkZW50aXR5TWF0cml4ID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwoKY2xhc3MgU2tlbGV0b24gewoKCWNvbnN0cnVjdG9yKCBib25lcyA9IFtdLCBib25lSW52ZXJzZXMgPSBbXSApIHsKCgkJdGhpcy51dWlkID0gZ2VuZXJhdGVVVUlEKCk7CgoJCXRoaXMuYm9uZXMgPSBib25lcy5zbGljZSggMCApOwoJCXRoaXMuYm9uZUludmVyc2VzID0gYm9uZUludmVyc2VzOwoJCXRoaXMuYm9uZU1hdHJpY2VzID0gbnVsbDsKCgkJdGhpcy5ib25lVGV4dHVyZSA9IG51bGw7CgkJdGhpcy5ib25lVGV4dHVyZVNpemUgPSAwOwoKCQl0aGlzLmluaXQoKTsKCgl9CgoJaW5pdCgpIHsKCgkJY29uc3QgYm9uZXMgPSB0aGlzLmJvbmVzOwoJCWNvbnN0IGJvbmVJbnZlcnNlcyA9IHRoaXMuYm9uZUludmVyc2VzOwoKCQl0aGlzLmJvbmVNYXRyaWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkoIGJvbmVzLmxlbmd0aCAqIDE2ICk7CgoJCS8vIGNhbGN1bGF0ZSBpbnZlcnNlIGJvbmUgbWF0cmljZXMgaWYgbmVjZXNzYXJ5CgoJCWlmICggYm9uZUludmVyc2VzLmxlbmd0aCA9PT0gMCApIHsKCgkJCXRoaXMuY2FsY3VsYXRlSW52ZXJzZXMoKTsKCgkJfSBlbHNlIHsKCgkJCS8vIGhhbmRsZSBzcGVjaWFsIGNhc2UKCgkJCWlmICggYm9uZXMubGVuZ3RoICE9PSBib25lSW52ZXJzZXMubGVuZ3RoICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlNrZWxldG9uOiBOdW1iZXIgb2YgaW52ZXJzZSBib25lIG1hdHJpY2VzIGRvZXMgbm90IG1hdGNoIGFtb3VudCBvZiBib25lcy4nICk7CgoJCQkJdGhpcy5ib25lSW52ZXJzZXMgPSBbXTsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gdGhpcy5ib25lcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJdGhpcy5ib25lSW52ZXJzZXMucHVzaCggbmV3IE1hdHJpeDQoKSApOwoKCQkJCX0KCgkJCX0KCgkJfQoKCX0KCgljYWxjdWxhdGVJbnZlcnNlcygpIHsKCgkJdGhpcy5ib25lSW52ZXJzZXMubGVuZ3RoID0gMDsKCgkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHRoaXMuYm9uZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQljb25zdCBpbnZlcnNlID0gbmV3IE1hdHJpeDQoKTsKCgkJCWlmICggdGhpcy5ib25lc1sgaSBdICkgewoKCQkJCWludmVyc2UuY29weSggdGhpcy5ib25lc1sgaSBdLm1hdHJpeFdvcmxkICkuaW52ZXJ0KCk7CgoJCQl9CgoJCQl0aGlzLmJvbmVJbnZlcnNlcy5wdXNoKCBpbnZlcnNlICk7CgoJCX0KCgl9CgoJcG9zZSgpIHsKCgkJLy8gcmVjb3ZlciB0aGUgYmluZC10aW1lIHdvcmxkIG1hdHJpY2VzCgoJCWZvciAoIGxldCBpID0gMCwgaWwgPSB0aGlzLmJvbmVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJY29uc3QgYm9uZSA9IHRoaXMuYm9uZXNbIGkgXTsKCgkJCWlmICggYm9uZSApIHsKCgkJCQlib25lLm1hdHJpeFdvcmxkLmNvcHkoIHRoaXMuYm9uZUludmVyc2VzWyBpIF0gKS5pbnZlcnQoKTsKCgkJCX0KCgkJfQoKCQkvLyBjb21wdXRlIHRoZSBsb2NhbCBtYXRyaWNlcywgcG9zaXRpb25zLCByb3RhdGlvbnMgYW5kIHNjYWxlcwoKCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gdGhpcy5ib25lcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCWNvbnN0IGJvbmUgPSB0aGlzLmJvbmVzWyBpIF07CgoJCQlpZiAoIGJvbmUgKSB7CgoJCQkJaWYgKCBib25lLnBhcmVudCAmJiBib25lLnBhcmVudC5pc0JvbmUgKSB7CgoJCQkJCWJvbmUubWF0cml4LmNvcHkoIGJvbmUucGFyZW50Lm1hdHJpeFdvcmxkICkuaW52ZXJ0KCk7CgkJCQkJYm9uZS5tYXRyaXgubXVsdGlwbHkoIGJvbmUubWF0cml4V29ybGQgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQlib25lLm1hdHJpeC5jb3B5KCBib25lLm1hdHJpeFdvcmxkICk7CgoJCQkJfQoKCQkJCWJvbmUubWF0cml4LmRlY29tcG9zZSggYm9uZS5wb3NpdGlvbiwgYm9uZS5xdWF0ZXJuaW9uLCBib25lLnNjYWxlICk7CgoJCQl9CgoJCX0KCgl9CgoJdXBkYXRlKCkgewoKCQljb25zdCBib25lcyA9IHRoaXMuYm9uZXM7CgkJY29uc3QgYm9uZUludmVyc2VzID0gdGhpcy5ib25lSW52ZXJzZXM7CgkJY29uc3QgYm9uZU1hdHJpY2VzID0gdGhpcy5ib25lTWF0cmljZXM7CgkJY29uc3QgYm9uZVRleHR1cmUgPSB0aGlzLmJvbmVUZXh0dXJlOwoKCQkvLyBmbGF0dGVuIGJvbmUgbWF0cmljZXMgdG8gYXJyYXkKCgkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGJvbmVzLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJLy8gY29tcHV0ZSB0aGUgb2Zmc2V0IGJldHdlZW4gdGhlIGN1cnJlbnQgYW5kIHRoZSBvcmlnaW5hbCB0cmFuc2Zvcm0KCgkJCWNvbnN0IG1hdHJpeCA9IGJvbmVzWyBpIF0gPyBib25lc1sgaSBdLm1hdHJpeFdvcmxkIDogX2lkZW50aXR5TWF0cml4OwoKCQkJX29mZnNldE1hdHJpeC5tdWx0aXBseU1hdHJpY2VzKCBtYXRyaXgsIGJvbmVJbnZlcnNlc1sgaSBdICk7CgkJCV9vZmZzZXRNYXRyaXgudG9BcnJheSggYm9uZU1hdHJpY2VzLCBpICogMTYgKTsKCgkJfQoKCQlpZiAoIGJvbmVUZXh0dXJlICE9PSBudWxsICkgewoKCQkJYm9uZVRleHR1cmUubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQl9CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IFNrZWxldG9uKCB0aGlzLmJvbmVzLCB0aGlzLmJvbmVJbnZlcnNlcyApOwoKCX0KCgljb21wdXRlQm9uZVRleHR1cmUoKSB7CgoJCS8vIGxheW91dCAoMSBtYXRyaXggPSA0IHBpeGVscykKCQkvLyAgICAgIFJHQkEgUkdCQSBSR0JBIFJHQkEgKD0+IGNvbHVtbjEsIGNvbHVtbjIsIGNvbHVtbjMsIGNvbHVtbjQpCgkJLy8gIHdpdGggIDh4OCAgcGl4ZWwgdGV4dHVyZSBtYXggICAxNiBib25lcyAqIDQgcGl4ZWxzID0gICg4ICogOCkKCQkvLyAgICAgICAxNngxNiBwaXhlbCB0ZXh0dXJlIG1heCAgIDY0IGJvbmVzICogNCBwaXhlbHMgPSAoMTYgKiAxNikKCQkvLyAgICAgICAzMngzMiBwaXhlbCB0ZXh0dXJlIG1heCAgMjU2IGJvbmVzICogNCBwaXhlbHMgPSAoMzIgKiAzMikKCQkvLyAgICAgICA2NHg2NCBwaXhlbCB0ZXh0dXJlIG1heCAxMDI0IGJvbmVzICogNCBwaXhlbHMgPSAoNjQgKiA2NCkKCgkJbGV0IHNpemUgPSBNYXRoLnNxcnQoIHRoaXMuYm9uZXMubGVuZ3RoICogNCApOyAvLyA0IHBpeGVscyBuZWVkZWQgZm9yIDEgbWF0cml4CgkJc2l6ZSA9IGNlaWxQb3dlck9mVHdvKCBzaXplICk7CgkJc2l6ZSA9IE1hdGgubWF4KCBzaXplLCA0ICk7CgoJCWNvbnN0IGJvbmVNYXRyaWNlcyA9IG5ldyBGbG9hdDMyQXJyYXkoIHNpemUgKiBzaXplICogNCApOyAvLyA0IGZsb2F0cyBwZXIgUkdCQSBwaXhlbAoJCWJvbmVNYXRyaWNlcy5zZXQoIHRoaXMuYm9uZU1hdHJpY2VzICk7IC8vIGNvcHkgY3VycmVudCB2YWx1ZXMKCgkJY29uc3QgYm9uZVRleHR1cmUgPSBuZXcgRGF0YVRleHR1cmUoIGJvbmVNYXRyaWNlcywgc2l6ZSwgc2l6ZSwgUkdCQUZvcm1hdCwgRmxvYXRUeXBlICk7CgkJYm9uZVRleHR1cmUubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQl0aGlzLmJvbmVNYXRyaWNlcyA9IGJvbmVNYXRyaWNlczsKCQl0aGlzLmJvbmVUZXh0dXJlID0gYm9uZVRleHR1cmU7CgkJdGhpcy5ib25lVGV4dHVyZVNpemUgPSBzaXplOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0Qm9uZUJ5TmFtZSggbmFtZSApIHsKCgkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHRoaXMuYm9uZXMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQljb25zdCBib25lID0gdGhpcy5ib25lc1sgaSBdOwoKCQkJaWYgKCBib25lLm5hbWUgPT09IG5hbWUgKSB7CgoJCQkJcmV0dXJuIGJvbmU7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHVuZGVmaW5lZDsKCgl9CgoJZGlzcG9zZSggKSB7CgoJCWlmICggdGhpcy5ib25lVGV4dHVyZSAhPT0gbnVsbCApIHsKCgkJCXRoaXMuYm9uZVRleHR1cmUuZGlzcG9zZSgpOwoKCQkJdGhpcy5ib25lVGV4dHVyZSA9IG51bGw7CgoJCX0KCgl9CgoJZnJvbUpTT04oIGpzb24sIGJvbmVzICkgewoKCQl0aGlzLnV1aWQgPSBqc29uLnV1aWQ7CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IGpzb24uYm9uZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IHV1aWQgPSBqc29uLmJvbmVzWyBpIF07CgkJCWxldCBib25lID0gYm9uZXNbIHV1aWQgXTsKCgkJCWlmICggYm9uZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlNrZWxldG9uOiBObyBib25lIGZvdW5kIHdpdGggVVVJRDonLCB1dWlkICk7CgkJCQlib25lID0gbmV3IEJvbmUoKTsKCgkJCX0KCgkJCXRoaXMuYm9uZXMucHVzaCggYm9uZSApOwoJCQl0aGlzLmJvbmVJbnZlcnNlcy5wdXNoKCBuZXcgTWF0cml4NCgpLmZyb21BcnJheSgganNvbi5ib25lSW52ZXJzZXNbIGkgXSApICk7CgoJCX0KCgkJdGhpcy5pbml0KCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0pTT04oKSB7CgoJCWNvbnN0IGRhdGEgPSB7CgkJCW1ldGFkYXRhOiB7CgkJCQl2ZXJzaW9uOiA0LjYsCgkJCQl0eXBlOiAnU2tlbGV0b24nLAoJCQkJZ2VuZXJhdG9yOiAnU2tlbGV0b24udG9KU09OJwoJCQl9LAoJCQlib25lczogW10sCgkJCWJvbmVJbnZlcnNlczogW10KCQl9OwoKCQlkYXRhLnV1aWQgPSB0aGlzLnV1aWQ7CgoJCWNvbnN0IGJvbmVzID0gdGhpcy5ib25lczsKCQljb25zdCBib25lSW52ZXJzZXMgPSB0aGlzLmJvbmVJbnZlcnNlczsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gYm9uZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IGJvbmUgPSBib25lc1sgaSBdOwoJCQlkYXRhLmJvbmVzLnB1c2goIGJvbmUudXVpZCApOwoKCQkJY29uc3QgYm9uZUludmVyc2UgPSBib25lSW52ZXJzZXNbIGkgXTsKCQkJZGF0YS5ib25lSW52ZXJzZXMucHVzaCggYm9uZUludmVyc2UudG9BcnJheSgpICk7CgoJCX0KCgkJcmV0dXJuIGRhdGE7CgoJfQoKfQoKY2xhc3MgSW5zdGFuY2VkQnVmZmVyQXR0cmlidXRlIGV4dGVuZHMgQnVmZmVyQXR0cmlidXRlIHsKCgljb25zdHJ1Y3RvciggYXJyYXksIGl0ZW1TaXplLCBub3JtYWxpemVkLCBtZXNoUGVyQXR0cmlidXRlID0gMSApIHsKCgkJc3VwZXIoIGFycmF5LCBpdGVtU2l6ZSwgbm9ybWFsaXplZCApOwoKCQl0aGlzLmlzSW5zdGFuY2VkQnVmZmVyQXR0cmlidXRlID0gdHJ1ZTsKCgkJdGhpcy5tZXNoUGVyQXR0cmlidXRlID0gbWVzaFBlckF0dHJpYnV0ZTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5tZXNoUGVyQXR0cmlidXRlID0gc291cmNlLm1lc2hQZXJBdHRyaWJ1dGU7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0pTT04oKSB7CgoJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oKTsKCgkJZGF0YS5tZXNoUGVyQXR0cmlidXRlID0gdGhpcy5tZXNoUGVyQXR0cmlidXRlOwoKCQlkYXRhLmlzSW5zdGFuY2VkQnVmZmVyQXR0cmlidXRlID0gdHJ1ZTsKCgkJcmV0dXJuIGRhdGE7CgoJfQoKfQoKY29uc3QgX2luc3RhbmNlTG9jYWxNYXRyaXggPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXg0KCk7CmNvbnN0IF9pbnN0YW5jZVdvcmxkTWF0cml4ID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwoKY29uc3QgX2luc3RhbmNlSW50ZXJzZWN0cyA9IFtdOwoKY29uc3QgX2JveDMgPSAvKkBfX1BVUkVfXyovIG5ldyBCb3gzKCk7CmNvbnN0IF9pZGVudGl0eSA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKY29uc3QgX21lc2ggPSAvKkBfX1BVUkVfXyovIG5ldyBNZXNoKCk7CmNvbnN0IF9zcGhlcmUkMiA9IC8qQF9fUFVSRV9fKi8gbmV3IFNwaGVyZSgpOwoKY2xhc3MgSW5zdGFuY2VkTWVzaCBleHRlbmRzIE1lc2ggewoKCWNvbnN0cnVjdG9yKCBnZW9tZXRyeSwgbWF0ZXJpYWwsIGNvdW50ICkgewoKCQlzdXBlciggZ2VvbWV0cnksIG1hdGVyaWFsICk7CgoJCXRoaXMuaXNJbnN0YW5jZWRNZXNoID0gdHJ1ZTsKCgkJdGhpcy5pbnN0YW5jZU1hdHJpeCA9IG5ldyBJbnN0YW5jZWRCdWZmZXJBdHRyaWJ1dGUoIG5ldyBGbG9hdDMyQXJyYXkoIGNvdW50ICogMTYgKSwgMTYgKTsKCQl0aGlzLmluc3RhbmNlQ29sb3IgPSBudWxsOwoKCQl0aGlzLmNvdW50ID0gY291bnQ7CgoJCXRoaXMuYm91bmRpbmdCb3ggPSBudWxsOwoJCXRoaXMuYm91bmRpbmdTcGhlcmUgPSBudWxsOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBjb3VudDsgaSArKyApIHsKCgkJCXRoaXMuc2V0TWF0cml4QXQoIGksIF9pZGVudGl0eSApOwoKCQl9CgoJfQoKCWNvbXB1dGVCb3VuZGluZ0JveCgpIHsKCgkJY29uc3QgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwoJCWNvbnN0IGNvdW50ID0gdGhpcy5jb3VudDsKCgkJaWYgKCB0aGlzLmJvdW5kaW5nQm94ID09PSBudWxsICkgewoKCQkJdGhpcy5ib3VuZGluZ0JveCA9IG5ldyBCb3gzKCk7CgoJCX0KCgkJaWYgKCBnZW9tZXRyeS5ib3VuZGluZ0JveCA9PT0gbnVsbCApIHsKCgkJCWdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ0JveCgpOwoKCQl9CgoJCXRoaXMuYm91bmRpbmdCb3gubWFrZUVtcHR5KCk7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IGNvdW50OyBpICsrICkgewoKCQkJdGhpcy5nZXRNYXRyaXhBdCggaSwgX2luc3RhbmNlTG9jYWxNYXRyaXggKTsKCgkJCV9ib3gzLmNvcHkoIGdlb21ldHJ5LmJvdW5kaW5nQm94ICkuYXBwbHlNYXRyaXg0KCBfaW5zdGFuY2VMb2NhbE1hdHJpeCApOwoKCQkJdGhpcy5ib3VuZGluZ0JveC51bmlvbiggX2JveDMgKTsKCgkJfQoKCX0KCgljb21wdXRlQm91bmRpbmdTcGhlcmUoKSB7CgoJCWNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCQljb25zdCBjb3VudCA9IHRoaXMuY291bnQ7CgoJCWlmICggdGhpcy5ib3VuZGluZ1NwaGVyZSA9PT0gbnVsbCApIHsKCgkJCXRoaXMuYm91bmRpbmdTcGhlcmUgPSBuZXcgU3BoZXJlKCk7CgoJCX0KCgkJaWYgKCBnZW9tZXRyeS5ib3VuZGluZ1NwaGVyZSA9PT0gbnVsbCApIHsKCgkJCWdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoKCQl9CgoJCXRoaXMuYm91bmRpbmdTcGhlcmUubWFrZUVtcHR5KCk7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IGNvdW50OyBpICsrICkgewoKCQkJdGhpcy5nZXRNYXRyaXhBdCggaSwgX2luc3RhbmNlTG9jYWxNYXRyaXggKTsKCgkJCV9zcGhlcmUkMi5jb3B5KCBnZW9tZXRyeS5ib3VuZGluZ1NwaGVyZSApLmFwcGx5TWF0cml4NCggX2luc3RhbmNlTG9jYWxNYXRyaXggKTsKCgkJCXRoaXMuYm91bmRpbmdTcGhlcmUudW5pb24oIF9zcGhlcmUkMiApOwoKCQl9CgoJfQoKCWNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApOwoKCQl0aGlzLmluc3RhbmNlTWF0cml4LmNvcHkoIHNvdXJjZS5pbnN0YW5jZU1hdHJpeCApOwoKCQlpZiAoIHNvdXJjZS5pbnN0YW5jZUNvbG9yICE9PSBudWxsICkgdGhpcy5pbnN0YW5jZUNvbG9yID0gc291cmNlLmluc3RhbmNlQ29sb3IuY2xvbmUoKTsKCgkJdGhpcy5jb3VudCA9IHNvdXJjZS5jb3VudDsKCgkJaWYgKCBzb3VyY2UuYm91bmRpbmdCb3ggIT09IG51bGwgKSB0aGlzLmJvdW5kaW5nQm94ID0gc291cmNlLmJvdW5kaW5nQm94LmNsb25lKCk7CgkJaWYgKCBzb3VyY2UuYm91bmRpbmdTcGhlcmUgIT09IG51bGwgKSB0aGlzLmJvdW5kaW5nU3BoZXJlID0gc291cmNlLmJvdW5kaW5nU3BoZXJlLmNsb25lKCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXRDb2xvckF0KCBpbmRleCwgY29sb3IgKSB7CgoJCWNvbG9yLmZyb21BcnJheSggdGhpcy5pbnN0YW5jZUNvbG9yLmFycmF5LCBpbmRleCAqIDMgKTsKCgl9CgoJZ2V0TWF0cml4QXQoIGluZGV4LCBtYXRyaXggKSB7CgoJCW1hdHJpeC5mcm9tQXJyYXkoIHRoaXMuaW5zdGFuY2VNYXRyaXguYXJyYXksIGluZGV4ICogMTYgKTsKCgl9CgoJcmF5Y2FzdCggcmF5Y2FzdGVyLCBpbnRlcnNlY3RzICkgewoKCQljb25zdCBtYXRyaXhXb3JsZCA9IHRoaXMubWF0cml4V29ybGQ7CgkJY29uc3QgcmF5Y2FzdFRpbWVzID0gdGhpcy5jb3VudDsKCgkJX21lc2guZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwoJCV9tZXNoLm1hdGVyaWFsID0gdGhpcy5tYXRlcmlhbDsKCgkJaWYgKCBfbWVzaC5tYXRlcmlhbCA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOwoKCQkvLyB0ZXN0IHdpdGggYm91bmRpbmcgc3BoZXJlIGZpcnN0CgoJCWlmICggdGhpcy5ib3VuZGluZ1NwaGVyZSA9PT0gbnVsbCApIHRoaXMuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgoJCV9zcGhlcmUkMi5jb3B5KCB0aGlzLmJvdW5kaW5nU3BoZXJlICk7CgkJX3NwaGVyZSQyLmFwcGx5TWF0cml4NCggbWF0cml4V29ybGQgKTsKCgkJaWYgKCByYXljYXN0ZXIucmF5LmludGVyc2VjdHNTcGhlcmUoIF9zcGhlcmUkMiApID09PSBmYWxzZSApIHJldHVybjsKCgkJLy8gbm93IHRlc3QgZWFjaCBpbnN0YW5jZQoKCQlmb3IgKCBsZXQgaW5zdGFuY2VJZCA9IDA7IGluc3RhbmNlSWQgPCByYXljYXN0VGltZXM7IGluc3RhbmNlSWQgKysgKSB7CgoJCQkvLyBjYWxjdWxhdGUgdGhlIHdvcmxkIG1hdHJpeCBmb3IgZWFjaCBpbnN0YW5jZQoKCQkJdGhpcy5nZXRNYXRyaXhBdCggaW5zdGFuY2VJZCwgX2luc3RhbmNlTG9jYWxNYXRyaXggKTsKCgkJCV9pbnN0YW5jZVdvcmxkTWF0cml4Lm11bHRpcGx5TWF0cmljZXMoIG1hdHJpeFdvcmxkLCBfaW5zdGFuY2VMb2NhbE1hdHJpeCApOwoKCQkJLy8gdGhlIG1lc2ggcmVwcmVzZW50cyB0aGlzIHNpbmdsZSBpbnN0YW5jZQoKCQkJX21lc2gubWF0cml4V29ybGQgPSBfaW5zdGFuY2VXb3JsZE1hdHJpeDsKCgkJCV9tZXNoLnJheWNhc3QoIHJheWNhc3RlciwgX2luc3RhbmNlSW50ZXJzZWN0cyApOwoKCQkJLy8gcHJvY2VzcyB0aGUgcmVzdWx0IG9mIHJheWNhc3QKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IF9pbnN0YW5jZUludGVyc2VjdHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQljb25zdCBpbnRlcnNlY3QgPSBfaW5zdGFuY2VJbnRlcnNlY3RzWyBpIF07CgkJCQlpbnRlcnNlY3QuaW5zdGFuY2VJZCA9IGluc3RhbmNlSWQ7CgkJCQlpbnRlcnNlY3Qub2JqZWN0ID0gdGhpczsKCQkJCWludGVyc2VjdHMucHVzaCggaW50ZXJzZWN0ICk7CgoJCQl9CgoJCQlfaW5zdGFuY2VJbnRlcnNlY3RzLmxlbmd0aCA9IDA7CgoJCX0KCgl9CgoJc2V0Q29sb3JBdCggaW5kZXgsIGNvbG9yICkgewoKCQlpZiAoIHRoaXMuaW5zdGFuY2VDb2xvciA9PT0gbnVsbCApIHsKCgkJCXRoaXMuaW5zdGFuY2VDb2xvciA9IG5ldyBJbnN0YW5jZWRCdWZmZXJBdHRyaWJ1dGUoIG5ldyBGbG9hdDMyQXJyYXkoIHRoaXMuaW5zdGFuY2VNYXRyaXguY291bnQgKiAzICksIDMgKTsKCgkJfQoKCQljb2xvci50b0FycmF5KCB0aGlzLmluc3RhbmNlQ29sb3IuYXJyYXksIGluZGV4ICogMyApOwoKCX0KCglzZXRNYXRyaXhBdCggaW5kZXgsIG1hdHJpeCApIHsKCgkJbWF0cml4LnRvQXJyYXkoIHRoaXMuaW5zdGFuY2VNYXRyaXguYXJyYXksIGluZGV4ICogMTYgKTsKCgl9CgoJdXBkYXRlTW9ycGhUYXJnZXRzKCkgewoKCX0KCglkaXNwb3NlKCkgewoKCQl0aGlzLmRpc3BhdGNoRXZlbnQoIHsgdHlwZTogJ2Rpc3Bvc2UnIH0gKTsKCgl9Cgp9CgpjbGFzcyBMaW5lQmFzaWNNYXRlcmlhbCBleHRlbmRzIE1hdGVyaWFsIHsKCgljb25zdHJ1Y3RvciggcGFyYW1ldGVycyApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc0xpbmVCYXNpY01hdGVyaWFsID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ0xpbmVCYXNpY01hdGVyaWFsJzsKCgkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggMHhmZmZmZmYgKTsKCgkJdGhpcy5tYXAgPSBudWxsOwoKCQl0aGlzLmxpbmV3aWR0aCA9IDE7CgkJdGhpcy5saW5lY2FwID0gJ3JvdW5kJzsKCQl0aGlzLmxpbmVqb2luID0gJ3JvdW5kJzsKCgkJdGhpcy5mb2cgPSB0cnVlOwoKCQl0aGlzLnNldFZhbHVlcyggcGFyYW1ldGVycyApOwoKCX0KCgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5jb2xvci5jb3B5KCBzb3VyY2UuY29sb3IgKTsKCgkJdGhpcy5tYXAgPSBzb3VyY2UubWFwOwoKCQl0aGlzLmxpbmV3aWR0aCA9IHNvdXJjZS5saW5ld2lkdGg7CgkJdGhpcy5saW5lY2FwID0gc291cmNlLmxpbmVjYXA7CgkJdGhpcy5saW5lam9pbiA9IHNvdXJjZS5saW5lam9pbjsKCgkJdGhpcy5mb2cgPSBzb3VyY2UuZm9nOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9Cgpjb25zdCBfc3RhcnQkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX2VuZCQxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfaW52ZXJzZU1hdHJpeCQxID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwpjb25zdCBfcmF5JDEgPSAvKkBfX1BVUkVfXyovIG5ldyBSYXkoKTsKY29uc3QgX3NwaGVyZSQxID0gLypAX19QVVJFX18qLyBuZXcgU3BoZXJlKCk7CgpjbGFzcyBMaW5lIGV4dGVuZHMgT2JqZWN0M0QgewoKCWNvbnN0cnVjdG9yKCBnZW9tZXRyeSA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpLCBtYXRlcmlhbCA9IG5ldyBMaW5lQmFzaWNNYXRlcmlhbCgpICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzTGluZSA9IHRydWU7CgoJCXRoaXMudHlwZSA9ICdMaW5lJzsKCgkJdGhpcy5nZW9tZXRyeSA9IGdlb21ldHJ5OwoJCXRoaXMubWF0ZXJpYWwgPSBtYXRlcmlhbDsKCgkJdGhpcy51cGRhdGVNb3JwaFRhcmdldHMoKTsKCgl9CgoJY29weSggc291cmNlLCByZWN1cnNpdmUgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgoJCXRoaXMubWF0ZXJpYWwgPSBBcnJheS5pc0FycmF5KCBzb3VyY2UubWF0ZXJpYWwgKSA/IHNvdXJjZS5tYXRlcmlhbC5zbGljZSgpIDogc291cmNlLm1hdGVyaWFsOwoJCXRoaXMuZ2VvbWV0cnkgPSBzb3VyY2UuZ2VvbWV0cnk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljb21wdXRlTGluZURpc3RhbmNlcygpIHsKCgkJY29uc3QgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwoKCQkvLyB3ZSBhc3N1bWUgbm9uLWluZGV4ZWQgZ2VvbWV0cnkKCgkJaWYgKCBnZW9tZXRyeS5pbmRleCA9PT0gbnVsbCApIHsKCgkJCWNvbnN0IHBvc2l0aW9uQXR0cmlidXRlID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKCQkJY29uc3QgbGluZURpc3RhbmNlcyA9IFsgMCBdOwoKCQkJZm9yICggbGV0IGkgPSAxLCBsID0gcG9zaXRpb25BdHRyaWJ1dGUuY291bnQ7IGkgPCBsOyBpICsrICkgewoKCQkJCV9zdGFydCQxLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBpIC0gMSApOwoJCQkJX2VuZCQxLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBpICk7CgoJCQkJbGluZURpc3RhbmNlc1sgaSBdID0gbGluZURpc3RhbmNlc1sgaSAtIDEgXTsKCQkJCWxpbmVEaXN0YW5jZXNbIGkgXSArPSBfc3RhcnQkMS5kaXN0YW5jZVRvKCBfZW5kJDEgKTsKCgkJCX0KCgkJCWdlb21ldHJ5LnNldEF0dHJpYnV0ZSggJ2xpbmVEaXN0YW5jZScsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBsaW5lRGlzdGFuY2VzLCAxICkgKTsKCgkJfSBlbHNlIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkxpbmUuY29tcHV0ZUxpbmVEaXN0YW5jZXMoKTogQ29tcHV0YXRpb24gb25seSBwb3NzaWJsZSB3aXRoIG5vbi1pbmRleGVkIEJ1ZmZlckdlb21ldHJ5LicgKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJcmF5Y2FzdCggcmF5Y2FzdGVyLCBpbnRlcnNlY3RzICkgewoKCQljb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgkJY29uc3QgbWF0cml4V29ybGQgPSB0aGlzLm1hdHJpeFdvcmxkOwoJCWNvbnN0IHRocmVzaG9sZCA9IHJheWNhc3Rlci5wYXJhbXMuTGluZS50aHJlc2hvbGQ7CgkJY29uc3QgZHJhd1JhbmdlID0gZ2VvbWV0cnkuZHJhd1JhbmdlOwoKCQkvLyBDaGVja2luZyBib3VuZGluZ1NwaGVyZSBkaXN0YW5jZSB0byByYXkKCgkJaWYgKCBnZW9tZXRyeS5ib3VuZGluZ1NwaGVyZSA9PT0gbnVsbCApIGdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoKCQlfc3BoZXJlJDEuY29weSggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgKTsKCQlfc3BoZXJlJDEuYXBwbHlNYXRyaXg0KCBtYXRyaXhXb3JsZCApOwoJCV9zcGhlcmUkMS5yYWRpdXMgKz0gdGhyZXNob2xkOwoKCQlpZiAoIHJheWNhc3Rlci5yYXkuaW50ZXJzZWN0c1NwaGVyZSggX3NwaGVyZSQxICkgPT09IGZhbHNlICkgcmV0dXJuOwoKCQkvLwoKCQlfaW52ZXJzZU1hdHJpeCQxLmNvcHkoIG1hdHJpeFdvcmxkICkuaW52ZXJ0KCk7CgkJX3JheSQxLmNvcHkoIHJheWNhc3Rlci5yYXkgKS5hcHBseU1hdHJpeDQoIF9pbnZlcnNlTWF0cml4JDEgKTsKCgkJY29uc3QgbG9jYWxUaHJlc2hvbGQgPSB0aHJlc2hvbGQgLyAoICggdGhpcy5zY2FsZS54ICsgdGhpcy5zY2FsZS55ICsgdGhpcy5zY2FsZS56ICkgLyAzICk7CgkJY29uc3QgbG9jYWxUaHJlc2hvbGRTcSA9IGxvY2FsVGhyZXNob2xkICogbG9jYWxUaHJlc2hvbGQ7CgoJCWNvbnN0IHZTdGFydCA9IG5ldyBWZWN0b3IzKCk7CgkJY29uc3QgdkVuZCA9IG5ldyBWZWN0b3IzKCk7CgkJY29uc3QgaW50ZXJTZWdtZW50ID0gbmV3IFZlY3RvcjMoKTsKCQljb25zdCBpbnRlclJheSA9IG5ldyBWZWN0b3IzKCk7CgkJY29uc3Qgc3RlcCA9IHRoaXMuaXNMaW5lU2VnbWVudHMgPyAyIDogMTsKCgkJY29uc3QgaW5kZXggPSBnZW9tZXRyeS5pbmRleDsKCQljb25zdCBhdHRyaWJ1dGVzID0gZ2VvbWV0cnkuYXR0cmlidXRlczsKCQljb25zdCBwb3NpdGlvbkF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXMucG9zaXRpb247CgoJCWlmICggaW5kZXggIT09IG51bGwgKSB7CgoJCQljb25zdCBzdGFydCA9IE1hdGgubWF4KCAwLCBkcmF3UmFuZ2Uuc3RhcnQgKTsKCQkJY29uc3QgZW5kID0gTWF0aC5taW4oIGluZGV4LmNvdW50LCAoIGRyYXdSYW5nZS5zdGFydCArIGRyYXdSYW5nZS5jb3VudCApICk7CgoJCQlmb3IgKCBsZXQgaSA9IHN0YXJ0LCBsID0gZW5kIC0gMTsgaSA8IGw7IGkgKz0gc3RlcCApIHsKCgkJCQljb25zdCBhID0gaW5kZXguZ2V0WCggaSApOwoJCQkJY29uc3QgYiA9IGluZGV4LmdldFgoIGkgKyAxICk7CgoJCQkJdlN0YXJ0LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBhICk7CgkJCQl2RW5kLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0cmlidXRlLCBiICk7CgoJCQkJY29uc3QgZGlzdFNxID0gX3JheSQxLmRpc3RhbmNlU3FUb1NlZ21lbnQoIHZTdGFydCwgdkVuZCwgaW50ZXJSYXksIGludGVyU2VnbWVudCApOwoKCQkJCWlmICggZGlzdFNxID4gbG9jYWxUaHJlc2hvbGRTcSApIGNvbnRpbnVlOwoKCQkJCWludGVyUmF5LmFwcGx5TWF0cml4NCggdGhpcy5tYXRyaXhXb3JsZCApOyAvL01vdmUgYmFjayB0byB3b3JsZCBzcGFjZSBmb3IgZGlzdGFuY2UgY2FsY3VsYXRpb24KCgkJCQljb25zdCBkaXN0YW5jZSA9IHJheWNhc3Rlci5yYXkub3JpZ2luLmRpc3RhbmNlVG8oIGludGVyUmF5ICk7CgoJCQkJaWYgKCBkaXN0YW5jZSA8IHJheWNhc3Rlci5uZWFyIHx8IGRpc3RhbmNlID4gcmF5Y2FzdGVyLmZhciApIGNvbnRpbnVlOwoKCQkJCWludGVyc2VjdHMucHVzaCggewoKCQkJCQlkaXN0YW5jZTogZGlzdGFuY2UsCgkJCQkJLy8gV2hhdCBkbyB3ZSB3YW50PyBpbnRlcnNlY3Rpb24gcG9pbnQgb24gdGhlIHJheSBvciBvbiB0aGUgc2VnbWVudD8/CgkJCQkJLy8gcG9pbnQ6IHJheWNhc3Rlci5yYXkuYXQoIGRpc3RhbmNlICksCgkJCQkJcG9pbnQ6IGludGVyU2VnbWVudC5jbG9uZSgpLmFwcGx5TWF0cml4NCggdGhpcy5tYXRyaXhXb3JsZCApLAoJCQkJCWluZGV4OiBpLAoJCQkJCWZhY2U6IG51bGwsCgkJCQkJZmFjZUluZGV4OiBudWxsLAoJCQkJCW9iamVjdDogdGhpcwoKCQkJCX0gKTsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCWNvbnN0IHN0YXJ0ID0gTWF0aC5tYXgoIDAsIGRyYXdSYW5nZS5zdGFydCApOwoJCQljb25zdCBlbmQgPSBNYXRoLm1pbiggcG9zaXRpb25BdHRyaWJ1dGUuY291bnQsICggZHJhd1JhbmdlLnN0YXJ0ICsgZHJhd1JhbmdlLmNvdW50ICkgKTsKCgkJCWZvciAoIGxldCBpID0gc3RhcnQsIGwgPSBlbmQgLSAxOyBpIDwgbDsgaSArPSBzdGVwICkgewoKCQkJCXZTdGFydC5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgaSApOwoJCQkJdkVuZC5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgaSArIDEgKTsKCgkJCQljb25zdCBkaXN0U3EgPSBfcmF5JDEuZGlzdGFuY2VTcVRvU2VnbWVudCggdlN0YXJ0LCB2RW5kLCBpbnRlclJheSwgaW50ZXJTZWdtZW50ICk7CgoJCQkJaWYgKCBkaXN0U3EgPiBsb2NhbFRocmVzaG9sZFNxICkgY29udGludWU7CgoJCQkJaW50ZXJSYXkuYXBwbHlNYXRyaXg0KCB0aGlzLm1hdHJpeFdvcmxkICk7IC8vTW92ZSBiYWNrIHRvIHdvcmxkIHNwYWNlIGZvciBkaXN0YW5jZSBjYWxjdWxhdGlvbgoKCQkJCWNvbnN0IGRpc3RhbmNlID0gcmF5Y2FzdGVyLnJheS5vcmlnaW4uZGlzdGFuY2VUbyggaW50ZXJSYXkgKTsKCgkJCQlpZiAoIGRpc3RhbmNlIDwgcmF5Y2FzdGVyLm5lYXIgfHwgZGlzdGFuY2UgPiByYXljYXN0ZXIuZmFyICkgY29udGludWU7CgoJCQkJaW50ZXJzZWN0cy5wdXNoKCB7CgoJCQkJCWRpc3RhbmNlOiBkaXN0YW5jZSwKCQkJCQkvLyBXaGF0IGRvIHdlIHdhbnQ/IGludGVyc2VjdGlvbiBwb2ludCBvbiB0aGUgcmF5IG9yIG9uIHRoZSBzZWdtZW50Pz8KCQkJCQkvLyBwb2ludDogcmF5Y2FzdGVyLnJheS5hdCggZGlzdGFuY2UgKSwKCQkJCQlwb2ludDogaW50ZXJTZWdtZW50LmNsb25lKCkuYXBwbHlNYXRyaXg0KCB0aGlzLm1hdHJpeFdvcmxkICksCgkJCQkJaW5kZXg6IGksCgkJCQkJZmFjZTogbnVsbCwKCQkJCQlmYWNlSW5kZXg6IG51bGwsCgkJCQkJb2JqZWN0OiB0aGlzCgoJCQkJfSApOwoKCQkJfQoKCQl9CgoJfQoKCXVwZGF0ZU1vcnBoVGFyZ2V0cygpIHsKCgkJY29uc3QgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwoKCQljb25zdCBtb3JwaEF0dHJpYnV0ZXMgPSBnZW9tZXRyeS5tb3JwaEF0dHJpYnV0ZXM7CgkJY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKCBtb3JwaEF0dHJpYnV0ZXMgKTsKCgkJaWYgKCBrZXlzLmxlbmd0aCA+IDAgKSB7CgoJCQljb25zdCBtb3JwaEF0dHJpYnV0ZSA9IG1vcnBoQXR0cmlidXRlc1sga2V5c1sgMCBdIF07CgoJCQlpZiAoIG1vcnBoQXR0cmlidXRlICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJdGhpcy5tb3JwaFRhcmdldEluZmx1ZW5jZXMgPSBbXTsKCQkJCXRoaXMubW9ycGhUYXJnZXREaWN0aW9uYXJ5ID0ge307CgoJCQkJZm9yICggbGV0IG0gPSAwLCBtbCA9IG1vcnBoQXR0cmlidXRlLmxlbmd0aDsgbSA8IG1sOyBtICsrICkgewoKCQkJCQljb25zdCBuYW1lID0gbW9ycGhBdHRyaWJ1dGVbIG0gXS5uYW1lIHx8IFN0cmluZyggbSApOwoKCQkJCQl0aGlzLm1vcnBoVGFyZ2V0SW5mbHVlbmNlcy5wdXNoKCAwICk7CgkJCQkJdGhpcy5tb3JwaFRhcmdldERpY3Rpb25hcnlbIG5hbWUgXSA9IG07CgoJCQkJfQoKCQkJfQoKCQl9CgoJfQoKfQoKY29uc3QgX3N0YXJ0ID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfZW5kID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKY2xhc3MgTGluZVNlZ21lbnRzIGV4dGVuZHMgTGluZSB7CgoJY29uc3RydWN0b3IoIGdlb21ldHJ5LCBtYXRlcmlhbCApIHsKCgkJc3VwZXIoIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCQl0aGlzLmlzTGluZVNlZ21lbnRzID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ0xpbmVTZWdtZW50cyc7CgoJfQoKCWNvbXB1dGVMaW5lRGlzdGFuY2VzKCkgewoKCQljb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgoJCS8vIHdlIGFzc3VtZSBub24taW5kZXhlZCBnZW9tZXRyeQoKCQlpZiAoIGdlb21ldHJ5LmluZGV4ID09PSBudWxsICkgewoKCQkJY29uc3QgcG9zaXRpb25BdHRyaWJ1dGUgPSBnZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uOwoJCQljb25zdCBsaW5lRGlzdGFuY2VzID0gW107CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBwb3NpdGlvbkF0dHJpYnV0ZS5jb3VudDsgaSA8IGw7IGkgKz0gMiApIHsKCgkJCQlfc3RhcnQuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIGkgKTsKCQkJCV9lbmQuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIGkgKyAxICk7CgoJCQkJbGluZURpc3RhbmNlc1sgaSBdID0gKCBpID09PSAwICkgPyAwIDogbGluZURpc3RhbmNlc1sgaSAtIDEgXTsKCQkJCWxpbmVEaXN0YW5jZXNbIGkgKyAxIF0gPSBsaW5lRGlzdGFuY2VzWyBpIF0gKyBfc3RhcnQuZGlzdGFuY2VUbyggX2VuZCApOwoKCQkJfQoKCQkJZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCAnbGluZURpc3RhbmNlJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIGxpbmVEaXN0YW5jZXMsIDEgKSApOwoKCQl9IGVsc2UgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuTGluZVNlZ21lbnRzLmNvbXB1dGVMaW5lRGlzdGFuY2VzKCk6IENvbXB1dGF0aW9uIG9ubHkgcG9zc2libGUgd2l0aCBub24taW5kZXhlZCBCdWZmZXJHZW9tZXRyeS4nICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKY2xhc3MgTGluZUxvb3AgZXh0ZW5kcyBMaW5lIHsKCgljb25zdHJ1Y3RvciggZ2VvbWV0cnksIG1hdGVyaWFsICkgewoKCQlzdXBlciggZ2VvbWV0cnksIG1hdGVyaWFsICk7CgoJCXRoaXMuaXNMaW5lTG9vcCA9IHRydWU7CgoJCXRoaXMudHlwZSA9ICdMaW5lTG9vcCc7CgoJfQoKfQoKY2xhc3MgUG9pbnRzTWF0ZXJpYWwgZXh0ZW5kcyBNYXRlcmlhbCB7CgoJY29uc3RydWN0b3IoIHBhcmFtZXRlcnMgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMuaXNQb2ludHNNYXRlcmlhbCA9IHRydWU7CgoJCXRoaXMudHlwZSA9ICdQb2ludHNNYXRlcmlhbCc7CgoJCXRoaXMuY29sb3IgPSBuZXcgQ29sb3IoIDB4ZmZmZmZmICk7CgoJCXRoaXMubWFwID0gbnVsbDsKCgkJdGhpcy5hbHBoYU1hcCA9IG51bGw7CgoJCXRoaXMuc2l6ZSA9IDE7CgkJdGhpcy5zaXplQXR0ZW51YXRpb24gPSB0cnVlOwoKCQl0aGlzLmZvZyA9IHRydWU7CgoJCXRoaXMuc2V0VmFsdWVzKCBwYXJhbWV0ZXJzICk7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMuY29sb3IuY29weSggc291cmNlLmNvbG9yICk7CgoJCXRoaXMubWFwID0gc291cmNlLm1hcDsKCgkJdGhpcy5hbHBoYU1hcCA9IHNvdXJjZS5hbHBoYU1hcDsKCgkJdGhpcy5zaXplID0gc291cmNlLnNpemU7CgkJdGhpcy5zaXplQXR0ZW51YXRpb24gPSBzb3VyY2Uuc2l6ZUF0dGVudWF0aW9uOwoKCQl0aGlzLmZvZyA9IHNvdXJjZS5mb2c7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNvbnN0IF9pbnZlcnNlTWF0cml4ID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwpjb25zdCBfcmF5ID0gLypAX19QVVJFX18qLyBuZXcgUmF5KCk7CmNvbnN0IF9zcGhlcmUgPSAvKkBfX1BVUkVfXyovIG5ldyBTcGhlcmUoKTsKY29uc3QgX3Bvc2l0aW9uJDIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgpjbGFzcyBQb2ludHMgZXh0ZW5kcyBPYmplY3QzRCB7CgoJY29uc3RydWN0b3IoIGdlb21ldHJ5ID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCksIG1hdGVyaWFsID0gbmV3IFBvaW50c01hdGVyaWFsKCkgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMuaXNQb2ludHMgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnUG9pbnRzJzsKCgkJdGhpcy5nZW9tZXRyeSA9IGdlb21ldHJ5OwoJCXRoaXMubWF0ZXJpYWwgPSBtYXRlcmlhbDsKCgkJdGhpcy51cGRhdGVNb3JwaFRhcmdldHMoKTsKCgl9CgoJY29weSggc291cmNlLCByZWN1cnNpdmUgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgoJCXRoaXMubWF0ZXJpYWwgPSBBcnJheS5pc0FycmF5KCBzb3VyY2UubWF0ZXJpYWwgKSA/IHNvdXJjZS5tYXRlcmlhbC5zbGljZSgpIDogc291cmNlLm1hdGVyaWFsOwoJCXRoaXMuZ2VvbWV0cnkgPSBzb3VyY2UuZ2VvbWV0cnk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglyYXljYXN0KCByYXljYXN0ZXIsIGludGVyc2VjdHMgKSB7CgoJCWNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCQljb25zdCBtYXRyaXhXb3JsZCA9IHRoaXMubWF0cml4V29ybGQ7CgkJY29uc3QgdGhyZXNob2xkID0gcmF5Y2FzdGVyLnBhcmFtcy5Qb2ludHMudGhyZXNob2xkOwoJCWNvbnN0IGRyYXdSYW5nZSA9IGdlb21ldHJ5LmRyYXdSYW5nZTsKCgkJLy8gQ2hlY2tpbmcgYm91bmRpbmdTcGhlcmUgZGlzdGFuY2UgdG8gcmF5CgoJCWlmICggZ2VvbWV0cnkuYm91bmRpbmdTcGhlcmUgPT09IG51bGwgKSBnZW9tZXRyeS5jb21wdXRlQm91bmRpbmdTcGhlcmUoKTsKCgkJX3NwaGVyZS5jb3B5KCBnZW9tZXRyeS5ib3VuZGluZ1NwaGVyZSApOwoJCV9zcGhlcmUuYXBwbHlNYXRyaXg0KCBtYXRyaXhXb3JsZCApOwoJCV9zcGhlcmUucmFkaXVzICs9IHRocmVzaG9sZDsKCgkJaWYgKCByYXljYXN0ZXIucmF5LmludGVyc2VjdHNTcGhlcmUoIF9zcGhlcmUgKSA9PT0gZmFsc2UgKSByZXR1cm47CgoJCS8vCgoJCV9pbnZlcnNlTWF0cml4LmNvcHkoIG1hdHJpeFdvcmxkICkuaW52ZXJ0KCk7CgkJX3JheS5jb3B5KCByYXljYXN0ZXIucmF5ICkuYXBwbHlNYXRyaXg0KCBfaW52ZXJzZU1hdHJpeCApOwoKCQljb25zdCBsb2NhbFRocmVzaG9sZCA9IHRocmVzaG9sZCAvICggKCB0aGlzLnNjYWxlLnggKyB0aGlzLnNjYWxlLnkgKyB0aGlzLnNjYWxlLnogKSAvIDMgKTsKCQljb25zdCBsb2NhbFRocmVzaG9sZFNxID0gbG9jYWxUaHJlc2hvbGQgKiBsb2NhbFRocmVzaG9sZDsKCgkJY29uc3QgaW5kZXggPSBnZW9tZXRyeS5pbmRleDsKCQljb25zdCBhdHRyaWJ1dGVzID0gZ2VvbWV0cnkuYXR0cmlidXRlczsKCQljb25zdCBwb3NpdGlvbkF0dHJpYnV0ZSA9IGF0dHJpYnV0ZXMucG9zaXRpb247CgoJCWlmICggaW5kZXggIT09IG51bGwgKSB7CgoJCQljb25zdCBzdGFydCA9IE1hdGgubWF4KCAwLCBkcmF3UmFuZ2Uuc3RhcnQgKTsKCQkJY29uc3QgZW5kID0gTWF0aC5taW4oIGluZGV4LmNvdW50LCAoIGRyYXdSYW5nZS5zdGFydCArIGRyYXdSYW5nZS5jb3VudCApICk7CgoJCQlmb3IgKCBsZXQgaSA9IHN0YXJ0LCBpbCA9IGVuZDsgaSA8IGlsOyBpICsrICkgewoKCQkJCWNvbnN0IGEgPSBpbmRleC5nZXRYKCBpICk7CgoJCQkJX3Bvc2l0aW9uJDIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyaWJ1dGUsIGEgKTsKCgkJCQl0ZXN0UG9pbnQoIF9wb3NpdGlvbiQyLCBhLCBsb2NhbFRocmVzaG9sZFNxLCBtYXRyaXhXb3JsZCwgcmF5Y2FzdGVyLCBpbnRlcnNlY3RzLCB0aGlzICk7CgoJCQl9CgoJCX0gZWxzZSB7CgoJCQljb25zdCBzdGFydCA9IE1hdGgubWF4KCAwLCBkcmF3UmFuZ2Uuc3RhcnQgKTsKCQkJY29uc3QgZW5kID0gTWF0aC5taW4oIHBvc2l0aW9uQXR0cmlidXRlLmNvdW50LCAoIGRyYXdSYW5nZS5zdGFydCArIGRyYXdSYW5nZS5jb3VudCApICk7CgoJCQlmb3IgKCBsZXQgaSA9IHN0YXJ0LCBsID0gZW5kOyBpIDwgbDsgaSArKyApIHsKCgkJCQlfcG9zaXRpb24kMi5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHJpYnV0ZSwgaSApOwoKCQkJCXRlc3RQb2ludCggX3Bvc2l0aW9uJDIsIGksIGxvY2FsVGhyZXNob2xkU3EsIG1hdHJpeFdvcmxkLCByYXljYXN0ZXIsIGludGVyc2VjdHMsIHRoaXMgKTsKCgkJCX0KCgkJfQoKCX0KCgl1cGRhdGVNb3JwaFRhcmdldHMoKSB7CgoJCWNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCgkJY29uc3QgbW9ycGhBdHRyaWJ1dGVzID0gZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzOwoJCWNvbnN0IGtleXMgPSBPYmplY3Qua2V5cyggbW9ycGhBdHRyaWJ1dGVzICk7CgoJCWlmICgga2V5cy5sZW5ndGggPiAwICkgewoKCQkJY29uc3QgbW9ycGhBdHRyaWJ1dGUgPSBtb3JwaEF0dHJpYnV0ZXNbIGtleXNbIDAgXSBdOwoKCQkJaWYgKCBtb3JwaEF0dHJpYnV0ZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXRoaXMubW9ycGhUYXJnZXRJbmZsdWVuY2VzID0gW107CgkJCQl0aGlzLm1vcnBoVGFyZ2V0RGljdGlvbmFyeSA9IHt9OwoKCQkJCWZvciAoIGxldCBtID0gMCwgbWwgPSBtb3JwaEF0dHJpYnV0ZS5sZW5ndGg7IG0gPCBtbDsgbSArKyApIHsKCgkJCQkJY29uc3QgbmFtZSA9IG1vcnBoQXR0cmlidXRlWyBtIF0ubmFtZSB8fCBTdHJpbmcoIG0gKTsKCgkJCQkJdGhpcy5tb3JwaFRhcmdldEluZmx1ZW5jZXMucHVzaCggMCApOwoJCQkJCXRoaXMubW9ycGhUYXJnZXREaWN0aW9uYXJ5WyBuYW1lIF0gPSBtOwoKCQkJCX0KCgkJCX0KCgkJfQoKCX0KCn0KCmZ1bmN0aW9uIHRlc3RQb2ludCggcG9pbnQsIGluZGV4LCBsb2NhbFRocmVzaG9sZFNxLCBtYXRyaXhXb3JsZCwgcmF5Y2FzdGVyLCBpbnRlcnNlY3RzLCBvYmplY3QgKSB7CgoJY29uc3QgcmF5UG9pbnREaXN0YW5jZVNxID0gX3JheS5kaXN0YW5jZVNxVG9Qb2ludCggcG9pbnQgKTsKCglpZiAoIHJheVBvaW50RGlzdGFuY2VTcSA8IGxvY2FsVGhyZXNob2xkU3EgKSB7CgoJCWNvbnN0IGludGVyc2VjdFBvaW50ID0gbmV3IFZlY3RvcjMoKTsKCgkJX3JheS5jbG9zZXN0UG9pbnRUb1BvaW50KCBwb2ludCwgaW50ZXJzZWN0UG9pbnQgKTsKCQlpbnRlcnNlY3RQb2ludC5hcHBseU1hdHJpeDQoIG1hdHJpeFdvcmxkICk7CgoJCWNvbnN0IGRpc3RhbmNlID0gcmF5Y2FzdGVyLnJheS5vcmlnaW4uZGlzdGFuY2VUbyggaW50ZXJzZWN0UG9pbnQgKTsKCgkJaWYgKCBkaXN0YW5jZSA8IHJheWNhc3Rlci5uZWFyIHx8IGRpc3RhbmNlID4gcmF5Y2FzdGVyLmZhciApIHJldHVybjsKCgkJaW50ZXJzZWN0cy5wdXNoKCB7CgoJCQlkaXN0YW5jZTogZGlzdGFuY2UsCgkJCWRpc3RhbmNlVG9SYXk6IE1hdGguc3FydCggcmF5UG9pbnREaXN0YW5jZVNxICksCgkJCXBvaW50OiBpbnRlcnNlY3RQb2ludCwKCQkJaW5kZXg6IGluZGV4LAoJCQlmYWNlOiBudWxsLAoJCQlvYmplY3Q6IG9iamVjdAoKCQl9ICk7CgoJfQoKfQoKY2xhc3MgVmlkZW9UZXh0dXJlIGV4dGVuZHMgVGV4dHVyZSB7CgoJY29uc3RydWN0b3IoIHZpZGVvLCBtYXBwaW5nLCB3cmFwUywgd3JhcFQsIG1hZ0ZpbHRlciwgbWluRmlsdGVyLCBmb3JtYXQsIHR5cGUsIGFuaXNvdHJvcHkgKSB7CgoJCXN1cGVyKCB2aWRlbywgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5ICk7CgoJCXRoaXMuaXNWaWRlb1RleHR1cmUgPSB0cnVlOwoKCQl0aGlzLm1pbkZpbHRlciA9IG1pbkZpbHRlciAhPT0gdW5kZWZpbmVkID8gbWluRmlsdGVyIDogTGluZWFyRmlsdGVyOwoJCXRoaXMubWFnRmlsdGVyID0gbWFnRmlsdGVyICE9PSB1bmRlZmluZWQgPyBtYWdGaWx0ZXIgOiBMaW5lYXJGaWx0ZXI7CgoJCXRoaXMuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgoJCWNvbnN0IHNjb3BlID0gdGhpczsKCgkJZnVuY3Rpb24gdXBkYXRlVmlkZW8oKSB7CgoJCQlzY29wZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgkJCXZpZGVvLnJlcXVlc3RWaWRlb0ZyYW1lQ2FsbGJhY2soIHVwZGF0ZVZpZGVvICk7CgoJCX0KCgkJaWYgKCAncmVxdWVzdFZpZGVvRnJhbWVDYWxsYmFjaycgaW4gdmlkZW8gKSB7CgoJCQl2aWRlby5yZXF1ZXN0VmlkZW9GcmFtZUNhbGxiYWNrKCB1cGRhdGVWaWRlbyApOwoKCQl9CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMuaW1hZ2UgKS5jb3B5KCB0aGlzICk7CgoJfQoKCXVwZGF0ZSgpIHsKCgkJY29uc3QgdmlkZW8gPSB0aGlzLmltYWdlOwoJCWNvbnN0IGhhc1ZpZGVvRnJhbWVDYWxsYmFjayA9ICdyZXF1ZXN0VmlkZW9GcmFtZUNhbGxiYWNrJyBpbiB2aWRlbzsKCgkJaWYgKCBoYXNWaWRlb0ZyYW1lQ2FsbGJhY2sgPT09IGZhbHNlICYmIHZpZGVvLnJlYWR5U3RhdGUgPj0gdmlkZW8uSEFWRV9DVVJSRU5UX0RBVEEgKSB7CgoJCQl0aGlzLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJfQoKCX0KCn0KCmNsYXNzIEZyYW1lYnVmZmVyVGV4dHVyZSBleHRlbmRzIFRleHR1cmUgewoKCWNvbnN0cnVjdG9yKCB3aWR0aCwgaGVpZ2h0ICkgewoKCQlzdXBlciggeyB3aWR0aCwgaGVpZ2h0IH0gKTsKCgkJdGhpcy5pc0ZyYW1lYnVmZmVyVGV4dHVyZSA9IHRydWU7CgoJCXRoaXMubWFnRmlsdGVyID0gTmVhcmVzdEZpbHRlcjsKCQl0aGlzLm1pbkZpbHRlciA9IE5lYXJlc3RGaWx0ZXI7CgoJCXRoaXMuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgoJCXRoaXMubmVlZHNVcGRhdGUgPSB0cnVlOwoKCX0KCn0KCmNsYXNzIENvbXByZXNzZWRUZXh0dXJlIGV4dGVuZHMgVGV4dHVyZSB7CgoJY29uc3RydWN0b3IoIG1pcG1hcHMsIHdpZHRoLCBoZWlnaHQsIGZvcm1hdCwgdHlwZSwgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgYW5pc290cm9weSwgY29sb3JTcGFjZSApIHsKCgkJc3VwZXIoIG51bGwsIG1hcHBpbmcsIHdyYXBTLCB3cmFwVCwgbWFnRmlsdGVyLCBtaW5GaWx0ZXIsIGZvcm1hdCwgdHlwZSwgYW5pc290cm9weSwgY29sb3JTcGFjZSApOwoKCQl0aGlzLmlzQ29tcHJlc3NlZFRleHR1cmUgPSB0cnVlOwoKCQl0aGlzLmltYWdlID0geyB3aWR0aDogd2lkdGgsIGhlaWdodDogaGVpZ2h0IH07CgkJdGhpcy5taXBtYXBzID0gbWlwbWFwczsKCgkJLy8gbm8gZmxpcHBpbmcgZm9yIGN1YmUgdGV4dHVyZXMKCQkvLyAoYWxzbyBmbGlwcGluZyBkb2Vzbid0IHdvcmsgZm9yIGNvbXByZXNzZWQgdGV4dHVyZXMgKQoKCQl0aGlzLmZsaXBZID0gZmFsc2U7CgoJCS8vIGNhbid0IGdlbmVyYXRlIG1pcG1hcHMgZm9yIGNvbXByZXNzZWQgdGV4dHVyZXMKCQkvLyBtaXBzIG11c3QgYmUgZW1iZWRkZWQgaW4gRERTIGZpbGVzCgoJCXRoaXMuZ2VuZXJhdGVNaXBtYXBzID0gZmFsc2U7CgoJfQoKfQoKY2xhc3MgQ29tcHJlc3NlZEFycmF5VGV4dHVyZSBleHRlbmRzIENvbXByZXNzZWRUZXh0dXJlIHsKCgljb25zdHJ1Y3RvciggbWlwbWFwcywgd2lkdGgsIGhlaWdodCwgZGVwdGgsIGZvcm1hdCwgdHlwZSApIHsKCgkJc3VwZXIoIG1pcG1hcHMsIHdpZHRoLCBoZWlnaHQsIGZvcm1hdCwgdHlwZSApOwoKCQl0aGlzLmlzQ29tcHJlc3NlZEFycmF5VGV4dHVyZSA9IHRydWU7CgkJdGhpcy5pbWFnZS5kZXB0aCA9IGRlcHRoOwoJCXRoaXMud3JhcFIgPSBDbGFtcFRvRWRnZVdyYXBwaW5nOwoKCX0KCn0KCmNsYXNzIENvbXByZXNzZWRDdWJlVGV4dHVyZSBleHRlbmRzIENvbXByZXNzZWRUZXh0dXJlIHsKCgljb25zdHJ1Y3RvciggaW1hZ2VzLCBmb3JtYXQsIHR5cGUgKSB7CgoJCXN1cGVyKCB1bmRlZmluZWQsIGltYWdlc1sgMCBdLndpZHRoLCBpbWFnZXNbIDAgXS5oZWlnaHQsIGZvcm1hdCwgdHlwZSwgQ3ViZVJlZmxlY3Rpb25NYXBwaW5nICk7CgoJCXRoaXMuaXNDb21wcmVzc2VkQ3ViZVRleHR1cmUgPSB0cnVlOwoJCXRoaXMuaXNDdWJlVGV4dHVyZSA9IHRydWU7CgoJCXRoaXMuaW1hZ2UgPSBpbWFnZXM7CgoJfQoKfQoKY2xhc3MgQ2FudmFzVGV4dHVyZSBleHRlbmRzIFRleHR1cmUgewoKCWNvbnN0cnVjdG9yKCBjYW52YXMsIG1hcHBpbmcsIHdyYXBTLCB3cmFwVCwgbWFnRmlsdGVyLCBtaW5GaWx0ZXIsIGZvcm1hdCwgdHlwZSwgYW5pc290cm9weSApIHsKCgkJc3VwZXIoIGNhbnZhcywgbWFwcGluZywgd3JhcFMsIHdyYXBULCBtYWdGaWx0ZXIsIG1pbkZpbHRlciwgZm9ybWF0LCB0eXBlLCBhbmlzb3Ryb3B5ICk7CgoJCXRoaXMuaXNDYW52YXNUZXh0dXJlID0gdHJ1ZTsKCgkJdGhpcy5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJfQoKfQoKLyoqCiAqIEV4dGVuc2libGUgY3VydmUgb2JqZWN0LgogKgogKiBTb21lIGNvbW1vbiBvZiBjdXJ2ZSBtZXRob2RzOgogKiAuZ2V0UG9pbnQoIHQsIG9wdGlvbmFsVGFyZ2V0ICksIC5nZXRUYW5nZW50KCB0LCBvcHRpb25hbFRhcmdldCApCiAqIC5nZXRQb2ludEF0KCB1LCBvcHRpb25hbFRhcmdldCApLCAuZ2V0VGFuZ2VudEF0KCB1LCBvcHRpb25hbFRhcmdldCApCiAqIC5nZXRQb2ludHMoKSwgLmdldFNwYWNlZFBvaW50cygpCiAqIC5nZXRMZW5ndGgoKQogKiAudXBkYXRlQXJjTGVuZ3RocygpCiAqCiAqIFRoaXMgZm9sbG93aW5nIGN1cnZlcyBpbmhlcml0IGZyb20gVEhSRUUuQ3VydmU6CiAqCiAqIC0tIDJEIGN1cnZlcyAtLQogKiBUSFJFRS5BcmNDdXJ2ZQogKiBUSFJFRS5DdWJpY0JlemllckN1cnZlCiAqIFRIUkVFLkVsbGlwc2VDdXJ2ZQogKiBUSFJFRS5MaW5lQ3VydmUKICogVEhSRUUuUXVhZHJhdGljQmV6aWVyQ3VydmUKICogVEhSRUUuU3BsaW5lQ3VydmUKICoKICogLS0gM0QgY3VydmVzIC0tCiAqIFRIUkVFLkNhdG11bGxSb21DdXJ2ZTMKICogVEhSRUUuQ3ViaWNCZXppZXJDdXJ2ZTMKICogVEhSRUUuTGluZUN1cnZlMwogKiBUSFJFRS5RdWFkcmF0aWNCZXppZXJDdXJ2ZTMKICoKICogQSBzZXJpZXMgb2YgY3VydmVzIGNhbiBiZSByZXByZXNlbnRlZCBhcyBhIFRIUkVFLkN1cnZlUGF0aC4KICoKICoqLwoKY2xhc3MgQ3VydmUgewoKCWNvbnN0cnVjdG9yKCkgewoKCQl0aGlzLnR5cGUgPSAnQ3VydmUnOwoKCQl0aGlzLmFyY0xlbmd0aERpdmlzaW9ucyA9IDIwMDsKCgl9CgoJLy8gVmlydHVhbCBiYXNlIGNsYXNzIG1ldGhvZCB0byBvdmVyd3JpdGUgYW5kIGltcGxlbWVudCBpbiBzdWJjbGFzc2VzCgkvLwktIHQgWzAgLi4gMV0KCglnZXRQb2ludCggLyogdCwgb3B0aW9uYWxUYXJnZXQgKi8gKSB7CgoJCWNvbnNvbGUud2FybiggJ1RIUkVFLkN1cnZlOiAuZ2V0UG9pbnQoKSBub3QgaW1wbGVtZW50ZWQuJyApOwoJCXJldHVybiBudWxsOwoKCX0KCgkvLyBHZXQgcG9pbnQgYXQgcmVsYXRpdmUgcG9zaXRpb24gaW4gY3VydmUgYWNjb3JkaW5nIHRvIGFyYyBsZW5ndGgKCS8vIC0gdSBbMCAuLiAxXQoKCWdldFBvaW50QXQoIHUsIG9wdGlvbmFsVGFyZ2V0ICkgewoKCQljb25zdCB0ID0gdGhpcy5nZXRVdG9UbWFwcGluZyggdSApOwoJCXJldHVybiB0aGlzLmdldFBvaW50KCB0LCBvcHRpb25hbFRhcmdldCApOwoKCX0KCgkvLyBHZXQgc2VxdWVuY2Ugb2YgcG9pbnRzIHVzaW5nIGdldFBvaW50KCB0ICkKCglnZXRQb2ludHMoIGRpdmlzaW9ucyA9IDUgKSB7CgoJCWNvbnN0IHBvaW50cyA9IFtdOwoKCQlmb3IgKCBsZXQgZCA9IDA7IGQgPD0gZGl2aXNpb25zOyBkICsrICkgewoKCQkJcG9pbnRzLnB1c2goIHRoaXMuZ2V0UG9pbnQoIGQgLyBkaXZpc2lvbnMgKSApOwoKCQl9CgoJCXJldHVybiBwb2ludHM7CgoJfQoKCS8vIEdldCBzZXF1ZW5jZSBvZiBwb2ludHMgdXNpbmcgZ2V0UG9pbnRBdCggdSApCgoJZ2V0U3BhY2VkUG9pbnRzKCBkaXZpc2lvbnMgPSA1ICkgewoKCQljb25zdCBwb2ludHMgPSBbXTsKCgkJZm9yICggbGV0IGQgPSAwOyBkIDw9IGRpdmlzaW9uczsgZCArKyApIHsKCgkJCXBvaW50cy5wdXNoKCB0aGlzLmdldFBvaW50QXQoIGQgLyBkaXZpc2lvbnMgKSApOwoKCQl9CgoJCXJldHVybiBwb2ludHM7CgoJfQoKCS8vIEdldCB0b3RhbCBjdXJ2ZSBhcmMgbGVuZ3RoCgoJZ2V0TGVuZ3RoKCkgewoKCQljb25zdCBsZW5ndGhzID0gdGhpcy5nZXRMZW5ndGhzKCk7CgkJcmV0dXJuIGxlbmd0aHNbIGxlbmd0aHMubGVuZ3RoIC0gMSBdOwoKCX0KCgkvLyBHZXQgbGlzdCBvZiBjdW11bGF0aXZlIHNlZ21lbnQgbGVuZ3RocwoKCWdldExlbmd0aHMoIGRpdmlzaW9ucyA9IHRoaXMuYXJjTGVuZ3RoRGl2aXNpb25zICkgewoKCQlpZiAoIHRoaXMuY2FjaGVBcmNMZW5ndGhzICYmCgkJCSggdGhpcy5jYWNoZUFyY0xlbmd0aHMubGVuZ3RoID09PSBkaXZpc2lvbnMgKyAxICkgJiYKCQkJISB0aGlzLm5lZWRzVXBkYXRlICkgewoKCQkJcmV0dXJuIHRoaXMuY2FjaGVBcmNMZW5ndGhzOwoKCQl9CgoJCXRoaXMubmVlZHNVcGRhdGUgPSBmYWxzZTsKCgkJY29uc3QgY2FjaGUgPSBbXTsKCQlsZXQgY3VycmVudCwgbGFzdCA9IHRoaXMuZ2V0UG9pbnQoIDAgKTsKCQlsZXQgc3VtID0gMDsKCgkJY2FjaGUucHVzaCggMCApOwoKCQlmb3IgKCBsZXQgcCA9IDE7IHAgPD0gZGl2aXNpb25zOyBwICsrICkgewoKCQkJY3VycmVudCA9IHRoaXMuZ2V0UG9pbnQoIHAgLyBkaXZpc2lvbnMgKTsKCQkJc3VtICs9IGN1cnJlbnQuZGlzdGFuY2VUbyggbGFzdCApOwoJCQljYWNoZS5wdXNoKCBzdW0gKTsKCQkJbGFzdCA9IGN1cnJlbnQ7CgoJCX0KCgkJdGhpcy5jYWNoZUFyY0xlbmd0aHMgPSBjYWNoZTsKCgkJcmV0dXJuIGNhY2hlOyAvLyB7IHN1bXM6IGNhY2hlLCBzdW06IHN1bSB9OyBTdW0gaXMgaW4gdGhlIGxhc3QgZWxlbWVudC4KCgl9CgoJdXBkYXRlQXJjTGVuZ3RocygpIHsKCgkJdGhpcy5uZWVkc1VwZGF0ZSA9IHRydWU7CgkJdGhpcy5nZXRMZW5ndGhzKCk7CgoJfQoKCS8vIEdpdmVuIHUgKCAwIC4uIDEgKSwgZ2V0IGEgdCB0byBmaW5kIHAuIFRoaXMgZ2l2ZXMgeW91IHBvaW50cyB3aGljaCBhcmUgZXF1aWRpc3RhbnQKCglnZXRVdG9UbWFwcGluZyggdSwgZGlzdGFuY2UgKSB7CgoJCWNvbnN0IGFyY0xlbmd0aHMgPSB0aGlzLmdldExlbmd0aHMoKTsKCgkJbGV0IGkgPSAwOwoJCWNvbnN0IGlsID0gYXJjTGVuZ3Rocy5sZW5ndGg7CgoJCWxldCB0YXJnZXRBcmNMZW5ndGg7IC8vIFRoZSB0YXJnZXRlZCB1IGRpc3RhbmNlIHZhbHVlIHRvIGdldAoKCQlpZiAoIGRpc3RhbmNlICkgewoKCQkJdGFyZ2V0QXJjTGVuZ3RoID0gZGlzdGFuY2U7CgoJCX0gZWxzZSB7CgoJCQl0YXJnZXRBcmNMZW5ndGggPSB1ICogYXJjTGVuZ3Roc1sgaWwgLSAxIF07CgoJCX0KCgkJLy8gYmluYXJ5IHNlYXJjaCBmb3IgdGhlIGluZGV4IHdpdGggbGFyZ2VzdCB2YWx1ZSBzbWFsbGVyIHRoYW4gdGFyZ2V0IHUgZGlzdGFuY2UKCgkJbGV0IGxvdyA9IDAsIGhpZ2ggPSBpbCAtIDEsIGNvbXBhcmlzb247CgoJCXdoaWxlICggbG93IDw9IGhpZ2ggKSB7CgoJCQlpID0gTWF0aC5mbG9vciggbG93ICsgKCBoaWdoIC0gbG93ICkgLyAyICk7IC8vIGxlc3MgbGlrZWx5IHRvIG92ZXJmbG93LCB0aG91Z2ggcHJvYmFibHkgbm90IGlzc3VlIGhlcmUsIEpTIGRvZXNuJ3QgcmVhbGx5IGhhdmUgaW50ZWdlcnMsIGFsbCBudW1iZXJzIGFyZSBmbG9hdHMKCgkJCWNvbXBhcmlzb24gPSBhcmNMZW5ndGhzWyBpIF0gLSB0YXJnZXRBcmNMZW5ndGg7CgoJCQlpZiAoIGNvbXBhcmlzb24gPCAwICkgewoKCQkJCWxvdyA9IGkgKyAxOwoKCQkJfSBlbHNlIGlmICggY29tcGFyaXNvbiA+IDAgKSB7CgoJCQkJaGlnaCA9IGkgLSAxOwoKCQkJfSBlbHNlIHsKCgkJCQloaWdoID0gaTsKCQkJCWJyZWFrOwoKCQkJCS8vIERPTkUKCgkJCX0KCgkJfQoKCQlpID0gaGlnaDsKCgkJaWYgKCBhcmNMZW5ndGhzWyBpIF0gPT09IHRhcmdldEFyY0xlbmd0aCApIHsKCgkJCXJldHVybiBpIC8gKCBpbCAtIDEgKTsKCgkJfQoKCQkvLyB3ZSBjb3VsZCBnZXQgZmluZXIgZ3JhaW4gYXQgbGVuZ3Rocywgb3IgdXNlIHNpbXBsZSBpbnRlcnBvbGF0aW9uIGJldHdlZW4gdHdvIHBvaW50cwoKCQljb25zdCBsZW5ndGhCZWZvcmUgPSBhcmNMZW5ndGhzWyBpIF07CgkJY29uc3QgbGVuZ3RoQWZ0ZXIgPSBhcmNMZW5ndGhzWyBpICsgMSBdOwoKCQljb25zdCBzZWdtZW50TGVuZ3RoID0gbGVuZ3RoQWZ0ZXIgLSBsZW5ndGhCZWZvcmU7CgoJCS8vIGRldGVybWluZSB3aGVyZSB3ZSBhcmUgYmV0d2VlbiB0aGUgJ2JlZm9yZScgYW5kICdhZnRlcicgcG9pbnRzCgoJCWNvbnN0IHNlZ21lbnRGcmFjdGlvbiA9ICggdGFyZ2V0QXJjTGVuZ3RoIC0gbGVuZ3RoQmVmb3JlICkgLyBzZWdtZW50TGVuZ3RoOwoKCQkvLyBhZGQgdGhhdCBmcmFjdGlvbmFsIGFtb3VudCB0byB0CgoJCWNvbnN0IHQgPSAoIGkgKyBzZWdtZW50RnJhY3Rpb24gKSAvICggaWwgLSAxICk7CgoJCXJldHVybiB0OwoKCX0KCgkvLyBSZXR1cm5zIGEgdW5pdCB2ZWN0b3IgdGFuZ2VudCBhdCB0CgkvLyBJbiBjYXNlIGFueSBzdWIgY3VydmUgZG9lcyBub3QgaW1wbGVtZW50IGl0cyB0YW5nZW50IGRlcml2YXRpb24sCgkvLyAyIHBvaW50cyBhIHNtYWxsIGRlbHRhIGFwYXJ0IHdpbGwgYmUgdXNlZCB0byBmaW5kIGl0cyBncmFkaWVudAoJLy8gd2hpY2ggc2VlbXMgdG8gZ2l2ZSBhIHJlYXNvbmFibGUgYXBwcm94aW1hdGlvbgoKCWdldFRhbmdlbnQoIHQsIG9wdGlvbmFsVGFyZ2V0ICkgewoKCQljb25zdCBkZWx0YSA9IDAuMDAwMTsKCQlsZXQgdDEgPSB0IC0gZGVsdGE7CgkJbGV0IHQyID0gdCArIGRlbHRhOwoKCQkvLyBDYXBwaW5nIGluIGNhc2Ugb2YgZGFuZ2VyCgoJCWlmICggdDEgPCAwICkgdDEgPSAwOwoJCWlmICggdDIgPiAxICkgdDIgPSAxOwoKCQljb25zdCBwdDEgPSB0aGlzLmdldFBvaW50KCB0MSApOwoJCWNvbnN0IHB0MiA9IHRoaXMuZ2V0UG9pbnQoIHQyICk7CgoJCWNvbnN0IHRhbmdlbnQgPSBvcHRpb25hbFRhcmdldCB8fCAoICggcHQxLmlzVmVjdG9yMiApID8gbmV3IFZlY3RvcjIoKSA6IG5ldyBWZWN0b3IzKCkgKTsKCgkJdGFuZ2VudC5jb3B5KCBwdDIgKS5zdWIoIHB0MSApLm5vcm1hbGl6ZSgpOwoKCQlyZXR1cm4gdGFuZ2VudDsKCgl9CgoJZ2V0VGFuZ2VudEF0KCB1LCBvcHRpb25hbFRhcmdldCApIHsKCgkJY29uc3QgdCA9IHRoaXMuZ2V0VXRvVG1hcHBpbmcoIHUgKTsKCQlyZXR1cm4gdGhpcy5nZXRUYW5nZW50KCB0LCBvcHRpb25hbFRhcmdldCApOwoKCX0KCgljb21wdXRlRnJlbmV0RnJhbWVzKCBzZWdtZW50cywgY2xvc2VkICkgewoKCQkvLyBzZWUgaHR0cDovL3d3dy5jcy5pbmRpYW5hLmVkdS9wdWIvdGVjaHJlcG9ydHMvVFI0MjUucGRmCgoJCWNvbnN0IG5vcm1hbCA9IG5ldyBWZWN0b3IzKCk7CgoJCWNvbnN0IHRhbmdlbnRzID0gW107CgkJY29uc3Qgbm9ybWFscyA9IFtdOwoJCWNvbnN0IGJpbm9ybWFscyA9IFtdOwoKCQljb25zdCB2ZWMgPSBuZXcgVmVjdG9yMygpOwoJCWNvbnN0IG1hdCA9IG5ldyBNYXRyaXg0KCk7CgoJCS8vIGNvbXB1dGUgdGhlIHRhbmdlbnQgdmVjdG9ycyBmb3IgZWFjaCBzZWdtZW50IG9uIHRoZSBjdXJ2ZQoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPD0gc2VnbWVudHM7IGkgKysgKSB7CgoJCQljb25zdCB1ID0gaSAvIHNlZ21lbnRzOwoKCQkJdGFuZ2VudHNbIGkgXSA9IHRoaXMuZ2V0VGFuZ2VudEF0KCB1LCBuZXcgVmVjdG9yMygpICk7CgoJCX0KCgkJLy8gc2VsZWN0IGFuIGluaXRpYWwgbm9ybWFsIHZlY3RvciBwZXJwZW5kaWN1bGFyIHRvIHRoZSBmaXJzdCB0YW5nZW50IHZlY3RvciwKCQkvLyBhbmQgaW4gdGhlIGRpcmVjdGlvbiBvZiB0aGUgbWluaW11bSB0YW5nZW50IHh5eiBjb21wb25lbnQKCgkJbm9ybWFsc1sgMCBdID0gbmV3IFZlY3RvcjMoKTsKCQliaW5vcm1hbHNbIDAgXSA9IG5ldyBWZWN0b3IzKCk7CgkJbGV0IG1pbiA9IE51bWJlci5NQVhfVkFMVUU7CgkJY29uc3QgdHggPSBNYXRoLmFicyggdGFuZ2VudHNbIDAgXS54ICk7CgkJY29uc3QgdHkgPSBNYXRoLmFicyggdGFuZ2VudHNbIDAgXS55ICk7CgkJY29uc3QgdHogPSBNYXRoLmFicyggdGFuZ2VudHNbIDAgXS56ICk7CgoJCWlmICggdHggPD0gbWluICkgewoKCQkJbWluID0gdHg7CgkJCW5vcm1hbC5zZXQoIDEsIDAsIDAgKTsKCgkJfQoKCQlpZiAoIHR5IDw9IG1pbiApIHsKCgkJCW1pbiA9IHR5OwoJCQlub3JtYWwuc2V0KCAwLCAxLCAwICk7CgoJCX0KCgkJaWYgKCB0eiA8PSBtaW4gKSB7CgoJCQlub3JtYWwuc2V0KCAwLCAwLCAxICk7CgoJCX0KCgkJdmVjLmNyb3NzVmVjdG9ycyggdGFuZ2VudHNbIDAgXSwgbm9ybWFsICkubm9ybWFsaXplKCk7CgoJCW5vcm1hbHNbIDAgXS5jcm9zc1ZlY3RvcnMoIHRhbmdlbnRzWyAwIF0sIHZlYyApOwoJCWJpbm9ybWFsc1sgMCBdLmNyb3NzVmVjdG9ycyggdGFuZ2VudHNbIDAgXSwgbm9ybWFsc1sgMCBdICk7CgoKCQkvLyBjb21wdXRlIHRoZSBzbG93bHktdmFyeWluZyBub3JtYWwgYW5kIGJpbm9ybWFsIHZlY3RvcnMgZm9yIGVhY2ggc2VnbWVudCBvbiB0aGUgY3VydmUKCgkJZm9yICggbGV0IGkgPSAxOyBpIDw9IHNlZ21lbnRzOyBpICsrICkgewoKCQkJbm9ybWFsc1sgaSBdID0gbm9ybWFsc1sgaSAtIDEgXS5jbG9uZSgpOwoKCQkJYmlub3JtYWxzWyBpIF0gPSBiaW5vcm1hbHNbIGkgLSAxIF0uY2xvbmUoKTsKCgkJCXZlYy5jcm9zc1ZlY3RvcnMoIHRhbmdlbnRzWyBpIC0gMSBdLCB0YW5nZW50c1sgaSBdICk7CgoJCQlpZiAoIHZlYy5sZW5ndGgoKSA+IE51bWJlci5FUFNJTE9OICkgewoKCQkJCXZlYy5ub3JtYWxpemUoKTsKCgkJCQljb25zdCB0aGV0YSA9IE1hdGguYWNvcyggY2xhbXAoIHRhbmdlbnRzWyBpIC0gMSBdLmRvdCggdGFuZ2VudHNbIGkgXSApLCAtIDEsIDEgKSApOyAvLyBjbGFtcCBmb3IgZmxvYXRpbmcgcHQgZXJyb3JzCgoJCQkJbm9ybWFsc1sgaSBdLmFwcGx5TWF0cml4NCggbWF0Lm1ha2VSb3RhdGlvbkF4aXMoIHZlYywgdGhldGEgKSApOwoKCQkJfQoKCQkJYmlub3JtYWxzWyBpIF0uY3Jvc3NWZWN0b3JzKCB0YW5nZW50c1sgaSBdLCBub3JtYWxzWyBpIF0gKTsKCgkJfQoKCQkvLyBpZiB0aGUgY3VydmUgaXMgY2xvc2VkLCBwb3N0cHJvY2VzcyB0aGUgdmVjdG9ycyBzbyB0aGUgZmlyc3QgYW5kIGxhc3Qgbm9ybWFsIHZlY3RvcnMgYXJlIHRoZSBzYW1lCgoJCWlmICggY2xvc2VkID09PSB0cnVlICkgewoKCQkJbGV0IHRoZXRhID0gTWF0aC5hY29zKCBjbGFtcCggbm9ybWFsc1sgMCBdLmRvdCggbm9ybWFsc1sgc2VnbWVudHMgXSApLCAtIDEsIDEgKSApOwoJCQl0aGV0YSAvPSBzZWdtZW50czsKCgkJCWlmICggdGFuZ2VudHNbIDAgXS5kb3QoIHZlYy5jcm9zc1ZlY3RvcnMoIG5vcm1hbHNbIDAgXSwgbm9ybWFsc1sgc2VnbWVudHMgXSApICkgPiAwICkgewoKCQkJCXRoZXRhID0gLSB0aGV0YTsKCgkJCX0KCgkJCWZvciAoIGxldCBpID0gMTsgaSA8PSBzZWdtZW50czsgaSArKyApIHsKCgkJCQkvLyB0d2lzdCBhIGxpdHRsZS4uLgoJCQkJbm9ybWFsc1sgaSBdLmFwcGx5TWF0cml4NCggbWF0Lm1ha2VSb3RhdGlvbkF4aXMoIHRhbmdlbnRzWyBpIF0sIHRoZXRhICogaSApICk7CgkJCQliaW5vcm1hbHNbIGkgXS5jcm9zc1ZlY3RvcnMoIHRhbmdlbnRzWyBpIF0sIG5vcm1hbHNbIGkgXSApOwoKCQkJfQoKCQl9CgoJCXJldHVybiB7CgkJCXRhbmdlbnRzOiB0YW5nZW50cywKCQkJbm9ybWFsczogbm9ybWFscywKCQkJYmlub3JtYWxzOiBiaW5vcm1hbHMKCQl9OwoKCX0KCgljbG9uZSgpIHsKCgkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXRoaXMuYXJjTGVuZ3RoRGl2aXNpb25zID0gc291cmNlLmFyY0xlbmd0aERpdmlzaW9uczsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTigpIHsKCgkJY29uc3QgZGF0YSA9IHsKCQkJbWV0YWRhdGE6IHsKCQkJCXZlcnNpb246IDQuNiwKCQkJCXR5cGU6ICdDdXJ2ZScsCgkJCQlnZW5lcmF0b3I6ICdDdXJ2ZS50b0pTT04nCgkJCX0KCQl9OwoKCQlkYXRhLmFyY0xlbmd0aERpdmlzaW9ucyA9IHRoaXMuYXJjTGVuZ3RoRGl2aXNpb25zOwoJCWRhdGEudHlwZSA9IHRoaXMudHlwZTsKCgkJcmV0dXJuIGRhdGE7CgoJfQoKCWZyb21KU09OKCBqc29uICkgewoKCQl0aGlzLmFyY0xlbmd0aERpdmlzaW9ucyA9IGpzb24uYXJjTGVuZ3RoRGl2aXNpb25zOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpjbGFzcyBFbGxpcHNlQ3VydmUgZXh0ZW5kcyBDdXJ2ZSB7CgoJY29uc3RydWN0b3IoIGFYID0gMCwgYVkgPSAwLCB4UmFkaXVzID0gMSwgeVJhZGl1cyA9IDEsIGFTdGFydEFuZ2xlID0gMCwgYUVuZEFuZ2xlID0gTWF0aC5QSSAqIDIsIGFDbG9ja3dpc2UgPSBmYWxzZSwgYVJvdGF0aW9uID0gMCApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc0VsbGlwc2VDdXJ2ZSA9IHRydWU7CgoJCXRoaXMudHlwZSA9ICdFbGxpcHNlQ3VydmUnOwoKCQl0aGlzLmFYID0gYVg7CgkJdGhpcy5hWSA9IGFZOwoKCQl0aGlzLnhSYWRpdXMgPSB4UmFkaXVzOwoJCXRoaXMueVJhZGl1cyA9IHlSYWRpdXM7CgoJCXRoaXMuYVN0YXJ0QW5nbGUgPSBhU3RhcnRBbmdsZTsKCQl0aGlzLmFFbmRBbmdsZSA9IGFFbmRBbmdsZTsKCgkJdGhpcy5hQ2xvY2t3aXNlID0gYUNsb2Nrd2lzZTsKCgkJdGhpcy5hUm90YXRpb24gPSBhUm90YXRpb247CgoJfQoKCWdldFBvaW50KCB0LCBvcHRpb25hbFRhcmdldCApIHsKCgkJY29uc3QgcG9pbnQgPSBvcHRpb25hbFRhcmdldCB8fCBuZXcgVmVjdG9yMigpOwoKCQljb25zdCB0d29QaSA9IE1hdGguUEkgKiAyOwoJCWxldCBkZWx0YUFuZ2xlID0gdGhpcy5hRW5kQW5nbGUgLSB0aGlzLmFTdGFydEFuZ2xlOwoJCWNvbnN0IHNhbWVQb2ludHMgPSBNYXRoLmFicyggZGVsdGFBbmdsZSApIDwgTnVtYmVyLkVQU0lMT047CgoJCS8vIGVuc3VyZXMgdGhhdCBkZWx0YUFuZ2xlIGlzIDAgLi4gMiBQSQoJCXdoaWxlICggZGVsdGFBbmdsZSA8IDAgKSBkZWx0YUFuZ2xlICs9IHR3b1BpOwoJCXdoaWxlICggZGVsdGFBbmdsZSA+IHR3b1BpICkgZGVsdGFBbmdsZSAtPSB0d29QaTsKCgkJaWYgKCBkZWx0YUFuZ2xlIDwgTnVtYmVyLkVQU0lMT04gKSB7CgoJCQlpZiAoIHNhbWVQb2ludHMgKSB7CgoJCQkJZGVsdGFBbmdsZSA9IDA7CgoJCQl9IGVsc2UgewoKCQkJCWRlbHRhQW5nbGUgPSB0d29QaTsKCgkJCX0KCgkJfQoKCQlpZiAoIHRoaXMuYUNsb2Nrd2lzZSA9PT0gdHJ1ZSAmJiAhIHNhbWVQb2ludHMgKSB7CgoJCQlpZiAoIGRlbHRhQW5nbGUgPT09IHR3b1BpICkgewoKCQkJCWRlbHRhQW5nbGUgPSAtIHR3b1BpOwoKCQkJfSBlbHNlIHsKCgkJCQlkZWx0YUFuZ2xlID0gZGVsdGFBbmdsZSAtIHR3b1BpOwoKCQkJfQoKCQl9CgoJCWNvbnN0IGFuZ2xlID0gdGhpcy5hU3RhcnRBbmdsZSArIHQgKiBkZWx0YUFuZ2xlOwoJCWxldCB4ID0gdGhpcy5hWCArIHRoaXMueFJhZGl1cyAqIE1hdGguY29zKCBhbmdsZSApOwoJCWxldCB5ID0gdGhpcy5hWSArIHRoaXMueVJhZGl1cyAqIE1hdGguc2luKCBhbmdsZSApOwoKCQlpZiAoIHRoaXMuYVJvdGF0aW9uICE9PSAwICkgewoKCQkJY29uc3QgY29zID0gTWF0aC5jb3MoIHRoaXMuYVJvdGF0aW9uICk7CgkJCWNvbnN0IHNpbiA9IE1hdGguc2luKCB0aGlzLmFSb3RhdGlvbiApOwoKCQkJY29uc3QgdHggPSB4IC0gdGhpcy5hWDsKCQkJY29uc3QgdHkgPSB5IC0gdGhpcy5hWTsKCgkJCS8vIFJvdGF0ZSB0aGUgcG9pbnQgYWJvdXQgdGhlIGNlbnRlciBvZiB0aGUgZWxsaXBzZS4KCQkJeCA9IHR4ICogY29zIC0gdHkgKiBzaW4gKyB0aGlzLmFYOwoJCQl5ID0gdHggKiBzaW4gKyB0eSAqIGNvcyArIHRoaXMuYVk7CgoJCX0KCgkJcmV0dXJuIHBvaW50LnNldCggeCwgeSApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLmFYID0gc291cmNlLmFYOwoJCXRoaXMuYVkgPSBzb3VyY2UuYVk7CgoJCXRoaXMueFJhZGl1cyA9IHNvdXJjZS54UmFkaXVzOwoJCXRoaXMueVJhZGl1cyA9IHNvdXJjZS55UmFkaXVzOwoKCQl0aGlzLmFTdGFydEFuZ2xlID0gc291cmNlLmFTdGFydEFuZ2xlOwoJCXRoaXMuYUVuZEFuZ2xlID0gc291cmNlLmFFbmRBbmdsZTsKCgkJdGhpcy5hQ2xvY2t3aXNlID0gc291cmNlLmFDbG9ja3dpc2U7CgoJCXRoaXMuYVJvdGF0aW9uID0gc291cmNlLmFSb3RhdGlvbjsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTigpIHsKCgkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTigpOwoKCQlkYXRhLmFYID0gdGhpcy5hWDsKCQlkYXRhLmFZID0gdGhpcy5hWTsKCgkJZGF0YS54UmFkaXVzID0gdGhpcy54UmFkaXVzOwoJCWRhdGEueVJhZGl1cyA9IHRoaXMueVJhZGl1czsKCgkJZGF0YS5hU3RhcnRBbmdsZSA9IHRoaXMuYVN0YXJ0QW5nbGU7CgkJZGF0YS5hRW5kQW5nbGUgPSB0aGlzLmFFbmRBbmdsZTsKCgkJZGF0YS5hQ2xvY2t3aXNlID0gdGhpcy5hQ2xvY2t3aXNlOwoKCQlkYXRhLmFSb3RhdGlvbiA9IHRoaXMuYVJvdGF0aW9uOwoKCQlyZXR1cm4gZGF0YTsKCgl9CgoJZnJvbUpTT04oIGpzb24gKSB7CgoJCXN1cGVyLmZyb21KU09OKCBqc29uICk7CgoJCXRoaXMuYVggPSBqc29uLmFYOwoJCXRoaXMuYVkgPSBqc29uLmFZOwoKCQl0aGlzLnhSYWRpdXMgPSBqc29uLnhSYWRpdXM7CgkJdGhpcy55UmFkaXVzID0ganNvbi55UmFkaXVzOwoKCQl0aGlzLmFTdGFydEFuZ2xlID0ganNvbi5hU3RhcnRBbmdsZTsKCQl0aGlzLmFFbmRBbmdsZSA9IGpzb24uYUVuZEFuZ2xlOwoKCQl0aGlzLmFDbG9ja3dpc2UgPSBqc29uLmFDbG9ja3dpc2U7CgoJCXRoaXMuYVJvdGF0aW9uID0ganNvbi5hUm90YXRpb247CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNsYXNzIEFyY0N1cnZlIGV4dGVuZHMgRWxsaXBzZUN1cnZlIHsKCgljb25zdHJ1Y3RvciggYVgsIGFZLCBhUmFkaXVzLCBhU3RhcnRBbmdsZSwgYUVuZEFuZ2xlLCBhQ2xvY2t3aXNlICkgewoKCQlzdXBlciggYVgsIGFZLCBhUmFkaXVzLCBhUmFkaXVzLCBhU3RhcnRBbmdsZSwgYUVuZEFuZ2xlLCBhQ2xvY2t3aXNlICk7CgoJCXRoaXMuaXNBcmNDdXJ2ZSA9IHRydWU7CgoJCXRoaXMudHlwZSA9ICdBcmNDdXJ2ZSc7CgoJfQoKfQoKLyoqCiAqIENlbnRyaXBldGFsIENhdG11bGxSb20gQ3VydmUgLSB3aGljaCBpcyB1c2VmdWwgZm9yIGF2b2lkaW5nCiAqIGN1c3BzIGFuZCBzZWxmLWludGVyc2VjdGlvbnMgaW4gbm9uLXVuaWZvcm0gY2F0bXVsbCByb20gY3VydmVzLgogKiBodHRwOi8vd3d3LmNlbXl1a3NlbC5jb20vcmVzZWFyY2gvY2F0bXVsbHJvbV9wYXJhbS9jYXRtdWxscm9tLnBkZgogKgogKiBjdXJ2ZS50eXBlIGFjY2VwdHMgY2VudHJpcGV0YWwoZGVmYXVsdCksIGNob3JkYWwgYW5kIGNhdG11bGxyb20KICogY3VydmUudGVuc2lvbiBpcyB1c2VkIGZvciBjYXRtdWxscm9tIHdoaWNoIGRlZmF1bHRzIHRvIDAuNQogKi8KCgovKgpCYXNlZCBvbiBhbiBvcHRpbWl6ZWQgYysrIHNvbHV0aW9uIGluCiAtIGh0dHA6Ly9zdGFja292ZXJmbG93LmNvbS9xdWVzdGlvbnMvOTQ4OTczNi9jYXRtdWxsLXJvbS1jdXJ2ZS13aXRoLW5vLWN1c3BzLWFuZC1uby1zZWxmLWludGVyc2VjdGlvbnMvCiAtIGh0dHA6Ly9pZGVvbmUuY29tL05vRWJWTQoKVGhpcyBDdWJpY1BvbHkgY2xhc3MgY291bGQgYmUgdXNlZCBmb3IgcmV1c2luZyBzb21lIHZhcmlhYmxlcyBhbmQgY2FsY3VsYXRpb25zLApidXQgZm9yIHRocmVlLmpzIGN1cnZlIHVzZSwgaXQgY291bGQgYmUgcG9zc2libGUgaW5saW5lZCBhbmQgZmxhdHRlbiBpbnRvIGEgc2luZ2xlIGZ1bmN0aW9uIGNhbGwKd2hpY2ggY2FuIGJlIHBsYWNlZCBpbiBDdXJ2ZVV0aWxzLgoqLwoKZnVuY3Rpb24gQ3ViaWNQb2x5KCkgewoKCWxldCBjMCA9IDAsIGMxID0gMCwgYzIgPSAwLCBjMyA9IDA7CgoJLyoKCSAqIENvbXB1dGUgY29lZmZpY2llbnRzIGZvciBhIGN1YmljIHBvbHlub21pYWwKCSAqICAgcChzKSA9IGMwICsgYzEqcyArIGMyKnNeMiArIGMzKnNeMwoJICogc3VjaCB0aGF0CgkgKiAgIHAoMCkgPSB4MCwgcCgxKSA9IHgxCgkgKiAgYW5kCgkgKiAgIHAnKDApID0gdDAsIHAnKDEpID0gdDEuCgkgKi8KCWZ1bmN0aW9uIGluaXQoIHgwLCB4MSwgdDAsIHQxICkgewoKCQljMCA9IHgwOwoJCWMxID0gdDA7CgkJYzIgPSAtIDMgKiB4MCArIDMgKiB4MSAtIDIgKiB0MCAtIHQxOwoJCWMzID0gMiAqIHgwIC0gMiAqIHgxICsgdDAgKyB0MTsKCgl9CgoJcmV0dXJuIHsKCgkJaW5pdENhdG11bGxSb206IGZ1bmN0aW9uICggeDAsIHgxLCB4MiwgeDMsIHRlbnNpb24gKSB7CgoJCQlpbml0KCB4MSwgeDIsIHRlbnNpb24gKiAoIHgyIC0geDAgKSwgdGVuc2lvbiAqICggeDMgLSB4MSApICk7CgoJCX0sCgoJCWluaXROb251bmlmb3JtQ2F0bXVsbFJvbTogZnVuY3Rpb24gKCB4MCwgeDEsIHgyLCB4MywgZHQwLCBkdDEsIGR0MiApIHsKCgkJCS8vIGNvbXB1dGUgdGFuZ2VudHMgd2hlbiBwYXJhbWV0ZXJpemVkIGluIFt0MSx0Ml0KCQkJbGV0IHQxID0gKCB4MSAtIHgwICkgLyBkdDAgLSAoIHgyIC0geDAgKSAvICggZHQwICsgZHQxICkgKyAoIHgyIC0geDEgKSAvIGR0MTsKCQkJbGV0IHQyID0gKCB4MiAtIHgxICkgLyBkdDEgLSAoIHgzIC0geDEgKSAvICggZHQxICsgZHQyICkgKyAoIHgzIC0geDIgKSAvIGR0MjsKCgkJCS8vIHJlc2NhbGUgdGFuZ2VudHMgZm9yIHBhcmFtZXRyaXphdGlvbiBpbiBbMCwxXQoJCQl0MSAqPSBkdDE7CgkJCXQyICo9IGR0MTsKCgkJCWluaXQoIHgxLCB4MiwgdDEsIHQyICk7CgoJCX0sCgoJCWNhbGM6IGZ1bmN0aW9uICggdCApIHsKCgkJCWNvbnN0IHQyID0gdCAqIHQ7CgkJCWNvbnN0IHQzID0gdDIgKiB0OwoJCQlyZXR1cm4gYzAgKyBjMSAqIHQgKyBjMiAqIHQyICsgYzMgKiB0MzsKCgkJfQoKCX07Cgp9CgovLwoKY29uc3QgdG1wID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBweCA9IC8qQF9fUFVSRV9fKi8gbmV3IEN1YmljUG9seSgpOwpjb25zdCBweSA9IC8qQF9fUFVSRV9fKi8gbmV3IEN1YmljUG9seSgpOwpjb25zdCBweiA9IC8qQF9fUFVSRV9fKi8gbmV3IEN1YmljUG9seSgpOwoKY2xhc3MgQ2F0bXVsbFJvbUN1cnZlMyBleHRlbmRzIEN1cnZlIHsKCgljb25zdHJ1Y3RvciggcG9pbnRzID0gW10sIGNsb3NlZCA9IGZhbHNlLCBjdXJ2ZVR5cGUgPSAnY2VudHJpcGV0YWwnLCB0ZW5zaW9uID0gMC41ICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzQ2F0bXVsbFJvbUN1cnZlMyA9IHRydWU7CgoJCXRoaXMudHlwZSA9ICdDYXRtdWxsUm9tQ3VydmUzJzsKCgkJdGhpcy5wb2ludHMgPSBwb2ludHM7CgkJdGhpcy5jbG9zZWQgPSBjbG9zZWQ7CgkJdGhpcy5jdXJ2ZVR5cGUgPSBjdXJ2ZVR5cGU7CgkJdGhpcy50ZW5zaW9uID0gdGVuc2lvbjsKCgl9CgoJZ2V0UG9pbnQoIHQsIG9wdGlvbmFsVGFyZ2V0ID0gbmV3IFZlY3RvcjMoKSApIHsKCgkJY29uc3QgcG9pbnQgPSBvcHRpb25hbFRhcmdldDsKCgkJY29uc3QgcG9pbnRzID0gdGhpcy5wb2ludHM7CgkJY29uc3QgbCA9IHBvaW50cy5sZW5ndGg7CgoJCWNvbnN0IHAgPSAoIGwgLSAoIHRoaXMuY2xvc2VkID8gMCA6IDEgKSApICogdDsKCQlsZXQgaW50UG9pbnQgPSBNYXRoLmZsb29yKCBwICk7CgkJbGV0IHdlaWdodCA9IHAgLSBpbnRQb2ludDsKCgkJaWYgKCB0aGlzLmNsb3NlZCApIHsKCgkJCWludFBvaW50ICs9IGludFBvaW50ID4gMCA/IDAgOiAoIE1hdGguZmxvb3IoIE1hdGguYWJzKCBpbnRQb2ludCApIC8gbCApICsgMSApICogbDsKCgkJfSBlbHNlIGlmICggd2VpZ2h0ID09PSAwICYmIGludFBvaW50ID09PSBsIC0gMSApIHsKCgkJCWludFBvaW50ID0gbCAtIDI7CgkJCXdlaWdodCA9IDE7CgoJCX0KCgkJbGV0IHAwLCBwMzsgLy8gNCBwb2ludHMgKHAxICYgcDIgZGVmaW5lZCBiZWxvdykKCgkJaWYgKCB0aGlzLmNsb3NlZCB8fCBpbnRQb2ludCA+IDAgKSB7CgoJCQlwMCA9IHBvaW50c1sgKCBpbnRQb2ludCAtIDEgKSAlIGwgXTsKCgkJfSBlbHNlIHsKCgkJCS8vIGV4dHJhcG9sYXRlIGZpcnN0IHBvaW50CgkJCXRtcC5zdWJWZWN0b3JzKCBwb2ludHNbIDAgXSwgcG9pbnRzWyAxIF0gKS5hZGQoIHBvaW50c1sgMCBdICk7CgkJCXAwID0gdG1wOwoKCQl9CgoJCWNvbnN0IHAxID0gcG9pbnRzWyBpbnRQb2ludCAlIGwgXTsKCQljb25zdCBwMiA9IHBvaW50c1sgKCBpbnRQb2ludCArIDEgKSAlIGwgXTsKCgkJaWYgKCB0aGlzLmNsb3NlZCB8fCBpbnRQb2ludCArIDIgPCBsICkgewoKCQkJcDMgPSBwb2ludHNbICggaW50UG9pbnQgKyAyICkgJSBsIF07CgoJCX0gZWxzZSB7CgoJCQkvLyBleHRyYXBvbGF0ZSBsYXN0IHBvaW50CgkJCXRtcC5zdWJWZWN0b3JzKCBwb2ludHNbIGwgLSAxIF0sIHBvaW50c1sgbCAtIDIgXSApLmFkZCggcG9pbnRzWyBsIC0gMSBdICk7CgkJCXAzID0gdG1wOwoKCQl9CgoJCWlmICggdGhpcy5jdXJ2ZVR5cGUgPT09ICdjZW50cmlwZXRhbCcgfHwgdGhpcy5jdXJ2ZVR5cGUgPT09ICdjaG9yZGFsJyApIHsKCgkJCS8vIGluaXQgQ2VudHJpcGV0YWwgLyBDaG9yZGFsIENhdG11bGwtUm9tCgkJCWNvbnN0IHBvdyA9IHRoaXMuY3VydmVUeXBlID09PSAnY2hvcmRhbCcgPyAwLjUgOiAwLjI1OwoJCQlsZXQgZHQwID0gTWF0aC5wb3coIHAwLmRpc3RhbmNlVG9TcXVhcmVkKCBwMSApLCBwb3cgKTsKCQkJbGV0IGR0MSA9IE1hdGgucG93KCBwMS5kaXN0YW5jZVRvU3F1YXJlZCggcDIgKSwgcG93ICk7CgkJCWxldCBkdDIgPSBNYXRoLnBvdyggcDIuZGlzdGFuY2VUb1NxdWFyZWQoIHAzICksIHBvdyApOwoKCQkJLy8gc2FmZXR5IGNoZWNrIGZvciByZXBlYXRlZCBwb2ludHMKCQkJaWYgKCBkdDEgPCAxZS00ICkgZHQxID0gMS4wOwoJCQlpZiAoIGR0MCA8IDFlLTQgKSBkdDAgPSBkdDE7CgkJCWlmICggZHQyIDwgMWUtNCApIGR0MiA9IGR0MTsKCgkJCXB4LmluaXROb251bmlmb3JtQ2F0bXVsbFJvbSggcDAueCwgcDEueCwgcDIueCwgcDMueCwgZHQwLCBkdDEsIGR0MiApOwoJCQlweS5pbml0Tm9udW5pZm9ybUNhdG11bGxSb20oIHAwLnksIHAxLnksIHAyLnksIHAzLnksIGR0MCwgZHQxLCBkdDIgKTsKCQkJcHouaW5pdE5vbnVuaWZvcm1DYXRtdWxsUm9tKCBwMC56LCBwMS56LCBwMi56LCBwMy56LCBkdDAsIGR0MSwgZHQyICk7CgoJCX0gZWxzZSBpZiAoIHRoaXMuY3VydmVUeXBlID09PSAnY2F0bXVsbHJvbScgKSB7CgoJCQlweC5pbml0Q2F0bXVsbFJvbSggcDAueCwgcDEueCwgcDIueCwgcDMueCwgdGhpcy50ZW5zaW9uICk7CgkJCXB5LmluaXRDYXRtdWxsUm9tKCBwMC55LCBwMS55LCBwMi55LCBwMy55LCB0aGlzLnRlbnNpb24gKTsKCQkJcHouaW5pdENhdG11bGxSb20oIHAwLnosIHAxLnosIHAyLnosIHAzLnosIHRoaXMudGVuc2lvbiApOwoKCQl9CgoJCXBvaW50LnNldCgKCQkJcHguY2FsYyggd2VpZ2h0ICksCgkJCXB5LmNhbGMoIHdlaWdodCApLAoJCQlwei5jYWxjKCB3ZWlnaHQgKQoJCSk7CgoJCXJldHVybiBwb2ludDsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5wb2ludHMgPSBbXTsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gc291cmNlLnBvaW50cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJY29uc3QgcG9pbnQgPSBzb3VyY2UucG9pbnRzWyBpIF07CgoJCQl0aGlzLnBvaW50cy5wdXNoKCBwb2ludC5jbG9uZSgpICk7CgoJCX0KCgkJdGhpcy5jbG9zZWQgPSBzb3VyY2UuY2xvc2VkOwoJCXRoaXMuY3VydmVUeXBlID0gc291cmNlLmN1cnZlVHlwZTsKCQl0aGlzLnRlbnNpb24gPSBzb3VyY2UudGVuc2lvbjsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTigpIHsKCgkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTigpOwoKCQlkYXRhLnBvaW50cyA9IFtdOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB0aGlzLnBvaW50cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJY29uc3QgcG9pbnQgPSB0aGlzLnBvaW50c1sgaSBdOwoJCQlkYXRhLnBvaW50cy5wdXNoKCBwb2ludC50b0FycmF5KCkgKTsKCgkJfQoKCQlkYXRhLmNsb3NlZCA9IHRoaXMuY2xvc2VkOwoJCWRhdGEuY3VydmVUeXBlID0gdGhpcy5jdXJ2ZVR5cGU7CgkJZGF0YS50ZW5zaW9uID0gdGhpcy50ZW5zaW9uOwoKCQlyZXR1cm4gZGF0YTsKCgl9CgoJZnJvbUpTT04oIGpzb24gKSB7CgoJCXN1cGVyLmZyb21KU09OKCBqc29uICk7CgoJCXRoaXMucG9pbnRzID0gW107CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IGpzb24ucG9pbnRzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQljb25zdCBwb2ludCA9IGpzb24ucG9pbnRzWyBpIF07CgkJCXRoaXMucG9pbnRzLnB1c2goIG5ldyBWZWN0b3IzKCkuZnJvbUFycmF5KCBwb2ludCApICk7CgoJCX0KCgkJdGhpcy5jbG9zZWQgPSBqc29uLmNsb3NlZDsKCQl0aGlzLmN1cnZlVHlwZSA9IGpzb24uY3VydmVUeXBlOwoJCXRoaXMudGVuc2lvbiA9IGpzb24udGVuc2lvbjsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKLyoqCiAqIEJlemllciBDdXJ2ZXMgZm9ybXVsYXMgb2J0YWluZWQgZnJvbQogKiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9CJUMzJUE5emllcl9jdXJ2ZQogKi8KCmZ1bmN0aW9uIENhdG11bGxSb20oIHQsIHAwLCBwMSwgcDIsIHAzICkgewoKCWNvbnN0IHYwID0gKCBwMiAtIHAwICkgKiAwLjU7Cgljb25zdCB2MSA9ICggcDMgLSBwMSApICogMC41OwoJY29uc3QgdDIgPSB0ICogdDsKCWNvbnN0IHQzID0gdCAqIHQyOwoJcmV0dXJuICggMiAqIHAxIC0gMiAqIHAyICsgdjAgKyB2MSApICogdDMgKyAoIC0gMyAqIHAxICsgMyAqIHAyIC0gMiAqIHYwIC0gdjEgKSAqIHQyICsgdjAgKiB0ICsgcDE7Cgp9CgovLwoKZnVuY3Rpb24gUXVhZHJhdGljQmV6aWVyUDAoIHQsIHAgKSB7CgoJY29uc3QgayA9IDEgLSB0OwoJcmV0dXJuIGsgKiBrICogcDsKCn0KCmZ1bmN0aW9uIFF1YWRyYXRpY0JlemllclAxKCB0LCBwICkgewoKCXJldHVybiAyICogKCAxIC0gdCApICogdCAqIHA7Cgp9CgpmdW5jdGlvbiBRdWFkcmF0aWNCZXppZXJQMiggdCwgcCApIHsKCglyZXR1cm4gdCAqIHQgKiBwOwoKfQoKZnVuY3Rpb24gUXVhZHJhdGljQmV6aWVyKCB0LCBwMCwgcDEsIHAyICkgewoKCXJldHVybiBRdWFkcmF0aWNCZXppZXJQMCggdCwgcDAgKSArIFF1YWRyYXRpY0JlemllclAxKCB0LCBwMSApICsKCQlRdWFkcmF0aWNCZXppZXJQMiggdCwgcDIgKTsKCn0KCi8vCgpmdW5jdGlvbiBDdWJpY0JlemllclAwKCB0LCBwICkgewoKCWNvbnN0IGsgPSAxIC0gdDsKCXJldHVybiBrICogayAqIGsgKiBwOwoKfQoKZnVuY3Rpb24gQ3ViaWNCZXppZXJQMSggdCwgcCApIHsKCgljb25zdCBrID0gMSAtIHQ7CglyZXR1cm4gMyAqIGsgKiBrICogdCAqIHA7Cgp9CgpmdW5jdGlvbiBDdWJpY0JlemllclAyKCB0LCBwICkgewoKCXJldHVybiAzICogKCAxIC0gdCApICogdCAqIHQgKiBwOwoKfQoKZnVuY3Rpb24gQ3ViaWNCZXppZXJQMyggdCwgcCApIHsKCglyZXR1cm4gdCAqIHQgKiB0ICogcDsKCn0KCmZ1bmN0aW9uIEN1YmljQmV6aWVyKCB0LCBwMCwgcDEsIHAyLCBwMyApIHsKCglyZXR1cm4gQ3ViaWNCZXppZXJQMCggdCwgcDAgKSArIEN1YmljQmV6aWVyUDEoIHQsIHAxICkgKyBDdWJpY0JlemllclAyKCB0LCBwMiApICsKCQlDdWJpY0JlemllclAzKCB0LCBwMyApOwoKfQoKY2xhc3MgQ3ViaWNCZXppZXJDdXJ2ZSBleHRlbmRzIEN1cnZlIHsKCgljb25zdHJ1Y3RvciggdjAgPSBuZXcgVmVjdG9yMigpLCB2MSA9IG5ldyBWZWN0b3IyKCksIHYyID0gbmV3IFZlY3RvcjIoKSwgdjMgPSBuZXcgVmVjdG9yMigpICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzQ3ViaWNCZXppZXJDdXJ2ZSA9IHRydWU7CgoJCXRoaXMudHlwZSA9ICdDdWJpY0JlemllckN1cnZlJzsKCgkJdGhpcy52MCA9IHYwOwoJCXRoaXMudjEgPSB2MTsKCQl0aGlzLnYyID0gdjI7CgkJdGhpcy52MyA9IHYzOwoKCX0KCglnZXRQb2ludCggdCwgb3B0aW9uYWxUYXJnZXQgPSBuZXcgVmVjdG9yMigpICkgewoKCQljb25zdCBwb2ludCA9IG9wdGlvbmFsVGFyZ2V0OwoKCQljb25zdCB2MCA9IHRoaXMudjAsIHYxID0gdGhpcy52MSwgdjIgPSB0aGlzLnYyLCB2MyA9IHRoaXMudjM7CgoJCXBvaW50LnNldCgKCQkJQ3ViaWNCZXppZXIoIHQsIHYwLngsIHYxLngsIHYyLngsIHYzLnggKSwKCQkJQ3ViaWNCZXppZXIoIHQsIHYwLnksIHYxLnksIHYyLnksIHYzLnkgKQoJCSk7CgoJCXJldHVybiBwb2ludDsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy52MC5jb3B5KCBzb3VyY2UudjAgKTsKCQl0aGlzLnYxLmNvcHkoIHNvdXJjZS52MSApOwoJCXRoaXMudjIuY29weSggc291cmNlLnYyICk7CgkJdGhpcy52My5jb3B5KCBzb3VyY2UudjMgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTigpIHsKCgkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTigpOwoKCQlkYXRhLnYwID0gdGhpcy52MC50b0FycmF5KCk7CgkJZGF0YS52MSA9IHRoaXMudjEudG9BcnJheSgpOwoJCWRhdGEudjIgPSB0aGlzLnYyLnRvQXJyYXkoKTsKCQlkYXRhLnYzID0gdGhpcy52My50b0FycmF5KCk7CgoJCXJldHVybiBkYXRhOwoKCX0KCglmcm9tSlNPTigganNvbiApIHsKCgkJc3VwZXIuZnJvbUpTT04oIGpzb24gKTsKCgkJdGhpcy52MC5mcm9tQXJyYXkoIGpzb24udjAgKTsKCQl0aGlzLnYxLmZyb21BcnJheSgganNvbi52MSApOwoJCXRoaXMudjIuZnJvbUFycmF5KCBqc29uLnYyICk7CgkJdGhpcy52My5mcm9tQXJyYXkoIGpzb24udjMgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKY2xhc3MgQ3ViaWNCZXppZXJDdXJ2ZTMgZXh0ZW5kcyBDdXJ2ZSB7CgoJY29uc3RydWN0b3IoIHYwID0gbmV3IFZlY3RvcjMoKSwgdjEgPSBuZXcgVmVjdG9yMygpLCB2MiA9IG5ldyBWZWN0b3IzKCksIHYzID0gbmV3IFZlY3RvcjMoKSApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc0N1YmljQmV6aWVyQ3VydmUzID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ0N1YmljQmV6aWVyQ3VydmUzJzsKCgkJdGhpcy52MCA9IHYwOwoJCXRoaXMudjEgPSB2MTsKCQl0aGlzLnYyID0gdjI7CgkJdGhpcy52MyA9IHYzOwoKCX0KCglnZXRQb2ludCggdCwgb3B0aW9uYWxUYXJnZXQgPSBuZXcgVmVjdG9yMygpICkgewoKCQljb25zdCBwb2ludCA9IG9wdGlvbmFsVGFyZ2V0OwoKCQljb25zdCB2MCA9IHRoaXMudjAsIHYxID0gdGhpcy52MSwgdjIgPSB0aGlzLnYyLCB2MyA9IHRoaXMudjM7CgoJCXBvaW50LnNldCgKCQkJQ3ViaWNCZXppZXIoIHQsIHYwLngsIHYxLngsIHYyLngsIHYzLnggKSwKCQkJQ3ViaWNCZXppZXIoIHQsIHYwLnksIHYxLnksIHYyLnksIHYzLnkgKSwKCQkJQ3ViaWNCZXppZXIoIHQsIHYwLnosIHYxLnosIHYyLnosIHYzLnogKQoJCSk7CgoJCXJldHVybiBwb2ludDsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy52MC5jb3B5KCBzb3VyY2UudjAgKTsKCQl0aGlzLnYxLmNvcHkoIHNvdXJjZS52MSApOwoJCXRoaXMudjIuY29weSggc291cmNlLnYyICk7CgkJdGhpcy52My5jb3B5KCBzb3VyY2UudjMgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTigpIHsKCgkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTigpOwoKCQlkYXRhLnYwID0gdGhpcy52MC50b0FycmF5KCk7CgkJZGF0YS52MSA9IHRoaXMudjEudG9BcnJheSgpOwoJCWRhdGEudjIgPSB0aGlzLnYyLnRvQXJyYXkoKTsKCQlkYXRhLnYzID0gdGhpcy52My50b0FycmF5KCk7CgoJCXJldHVybiBkYXRhOwoKCX0KCglmcm9tSlNPTigganNvbiApIHsKCgkJc3VwZXIuZnJvbUpTT04oIGpzb24gKTsKCgkJdGhpcy52MC5mcm9tQXJyYXkoIGpzb24udjAgKTsKCQl0aGlzLnYxLmZyb21BcnJheSgganNvbi52MSApOwoJCXRoaXMudjIuZnJvbUFycmF5KCBqc29uLnYyICk7CgkJdGhpcy52My5mcm9tQXJyYXkoIGpzb24udjMgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKY2xhc3MgTGluZUN1cnZlIGV4dGVuZHMgQ3VydmUgewoKCWNvbnN0cnVjdG9yKCB2MSA9IG5ldyBWZWN0b3IyKCksIHYyID0gbmV3IFZlY3RvcjIoKSApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc0xpbmVDdXJ2ZSA9IHRydWU7CgoJCXRoaXMudHlwZSA9ICdMaW5lQ3VydmUnOwoKCQl0aGlzLnYxID0gdjE7CgkJdGhpcy52MiA9IHYyOwoKCX0KCglnZXRQb2ludCggdCwgb3B0aW9uYWxUYXJnZXQgPSBuZXcgVmVjdG9yMigpICkgewoKCQljb25zdCBwb2ludCA9IG9wdGlvbmFsVGFyZ2V0OwoKCQlpZiAoIHQgPT09IDEgKSB7CgoJCQlwb2ludC5jb3B5KCB0aGlzLnYyICk7CgoJCX0gZWxzZSB7CgoJCQlwb2ludC5jb3B5KCB0aGlzLnYyICkuc3ViKCB0aGlzLnYxICk7CgkJCXBvaW50Lm11bHRpcGx5U2NhbGFyKCB0ICkuYWRkKCB0aGlzLnYxICk7CgoJCX0KCgkJcmV0dXJuIHBvaW50OwoKCX0KCgkvLyBMaW5lIGN1cnZlIGlzIGxpbmVhciwgc28gd2UgY2FuIG92ZXJ3cml0ZSBkZWZhdWx0IGdldFBvaW50QXQKCWdldFBvaW50QXQoIHUsIG9wdGlvbmFsVGFyZ2V0ICkgewoKCQlyZXR1cm4gdGhpcy5nZXRQb2ludCggdSwgb3B0aW9uYWxUYXJnZXQgKTsKCgl9CgoJZ2V0VGFuZ2VudCggdCwgb3B0aW9uYWxUYXJnZXQgPSBuZXcgVmVjdG9yMigpICkgewoKCQlyZXR1cm4gb3B0aW9uYWxUYXJnZXQuc3ViVmVjdG9ycyggdGhpcy52MiwgdGhpcy52MSApLm5vcm1hbGl6ZSgpOwoKCX0KCglnZXRUYW5nZW50QXQoIHUsIG9wdGlvbmFsVGFyZ2V0ICkgewoKCQlyZXR1cm4gdGhpcy5nZXRUYW5nZW50KCB1LCBvcHRpb25hbFRhcmdldCApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLnYxLmNvcHkoIHNvdXJjZS52MSApOwoJCXRoaXMudjIuY29weSggc291cmNlLnYyICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0pTT04oKSB7CgoJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oKTsKCgkJZGF0YS52MSA9IHRoaXMudjEudG9BcnJheSgpOwoJCWRhdGEudjIgPSB0aGlzLnYyLnRvQXJyYXkoKTsKCgkJcmV0dXJuIGRhdGE7CgoJfQoKCWZyb21KU09OKCBqc29uICkgewoKCQlzdXBlci5mcm9tSlNPTigganNvbiApOwoKCQl0aGlzLnYxLmZyb21BcnJheSgganNvbi52MSApOwoJCXRoaXMudjIuZnJvbUFycmF5KCBqc29uLnYyICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNsYXNzIExpbmVDdXJ2ZTMgZXh0ZW5kcyBDdXJ2ZSB7CgoJY29uc3RydWN0b3IoIHYxID0gbmV3IFZlY3RvcjMoKSwgdjIgPSBuZXcgVmVjdG9yMygpICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzTGluZUN1cnZlMyA9IHRydWU7CgoJCXRoaXMudHlwZSA9ICdMaW5lQ3VydmUzJzsKCgkJdGhpcy52MSA9IHYxOwoJCXRoaXMudjIgPSB2MjsKCgl9CglnZXRQb2ludCggdCwgb3B0aW9uYWxUYXJnZXQgPSBuZXcgVmVjdG9yMygpICkgewoKCQljb25zdCBwb2ludCA9IG9wdGlvbmFsVGFyZ2V0OwoKCQlpZiAoIHQgPT09IDEgKSB7CgoJCQlwb2ludC5jb3B5KCB0aGlzLnYyICk7CgoJCX0gZWxzZSB7CgoJCQlwb2ludC5jb3B5KCB0aGlzLnYyICkuc3ViKCB0aGlzLnYxICk7CgkJCXBvaW50Lm11bHRpcGx5U2NhbGFyKCB0ICkuYWRkKCB0aGlzLnYxICk7CgoJCX0KCgkJcmV0dXJuIHBvaW50OwoKCX0KCS8vIExpbmUgY3VydmUgaXMgbGluZWFyLCBzbyB3ZSBjYW4gb3ZlcndyaXRlIGRlZmF1bHQgZ2V0UG9pbnRBdAoJZ2V0UG9pbnRBdCggdSwgb3B0aW9uYWxUYXJnZXQgKSB7CgoJCXJldHVybiB0aGlzLmdldFBvaW50KCB1LCBvcHRpb25hbFRhcmdldCApOwoKCX0KCglnZXRUYW5nZW50KCB0LCBvcHRpb25hbFRhcmdldCA9IG5ldyBWZWN0b3IzKCkgKSB7CgoJCXJldHVybiBvcHRpb25hbFRhcmdldC5zdWJWZWN0b3JzKCB0aGlzLnYyLCB0aGlzLnYxICkubm9ybWFsaXplKCk7CgoJfQoKCWdldFRhbmdlbnRBdCggdSwgb3B0aW9uYWxUYXJnZXQgKSB7CgoJCXJldHVybiB0aGlzLmdldFRhbmdlbnQoIHUsIG9wdGlvbmFsVGFyZ2V0ICk7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMudjEuY29weSggc291cmNlLnYxICk7CgkJdGhpcy52Mi5jb3B5KCBzb3VyY2UudjIgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoJdG9KU09OKCkgewoKCQljb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCk7CgoJCWRhdGEudjEgPSB0aGlzLnYxLnRvQXJyYXkoKTsKCQlkYXRhLnYyID0gdGhpcy52Mi50b0FycmF5KCk7CgoJCXJldHVybiBkYXRhOwoKCX0KCWZyb21KU09OKCBqc29uICkgewoKCQlzdXBlci5mcm9tSlNPTigganNvbiApOwoKCQl0aGlzLnYxLmZyb21BcnJheSgganNvbi52MSApOwoJCXRoaXMudjIuZnJvbUFycmF5KCBqc29uLnYyICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNsYXNzIFF1YWRyYXRpY0JlemllckN1cnZlIGV4dGVuZHMgQ3VydmUgewoKCWNvbnN0cnVjdG9yKCB2MCA9IG5ldyBWZWN0b3IyKCksIHYxID0gbmV3IFZlY3RvcjIoKSwgdjIgPSBuZXcgVmVjdG9yMigpICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzUXVhZHJhdGljQmV6aWVyQ3VydmUgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnUXVhZHJhdGljQmV6aWVyQ3VydmUnOwoKCQl0aGlzLnYwID0gdjA7CgkJdGhpcy52MSA9IHYxOwoJCXRoaXMudjIgPSB2MjsKCgl9CgoJZ2V0UG9pbnQoIHQsIG9wdGlvbmFsVGFyZ2V0ID0gbmV3IFZlY3RvcjIoKSApIHsKCgkJY29uc3QgcG9pbnQgPSBvcHRpb25hbFRhcmdldDsKCgkJY29uc3QgdjAgPSB0aGlzLnYwLCB2MSA9IHRoaXMudjEsIHYyID0gdGhpcy52MjsKCgkJcG9pbnQuc2V0KAoJCQlRdWFkcmF0aWNCZXppZXIoIHQsIHYwLngsIHYxLngsIHYyLnggKSwKCQkJUXVhZHJhdGljQmV6aWVyKCB0LCB2MC55LCB2MS55LCB2Mi55ICkKCQkpOwoKCQlyZXR1cm4gcG9pbnQ7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMudjAuY29weSggc291cmNlLnYwICk7CgkJdGhpcy52MS5jb3B5KCBzb3VyY2UudjEgKTsKCQl0aGlzLnYyLmNvcHkoIHNvdXJjZS52MiApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9KU09OKCkgewoKCQljb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCk7CgoJCWRhdGEudjAgPSB0aGlzLnYwLnRvQXJyYXkoKTsKCQlkYXRhLnYxID0gdGhpcy52MS50b0FycmF5KCk7CgkJZGF0YS52MiA9IHRoaXMudjIudG9BcnJheSgpOwoKCQlyZXR1cm4gZGF0YTsKCgl9CgoJZnJvbUpTT04oIGpzb24gKSB7CgoJCXN1cGVyLmZyb21KU09OKCBqc29uICk7CgoJCXRoaXMudjAuZnJvbUFycmF5KCBqc29uLnYwICk7CgkJdGhpcy52MS5mcm9tQXJyYXkoIGpzb24udjEgKTsKCQl0aGlzLnYyLmZyb21BcnJheSgganNvbi52MiApOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpjbGFzcyBRdWFkcmF0aWNCZXppZXJDdXJ2ZTMgZXh0ZW5kcyBDdXJ2ZSB7CgoJY29uc3RydWN0b3IoIHYwID0gbmV3IFZlY3RvcjMoKSwgdjEgPSBuZXcgVmVjdG9yMygpLCB2MiA9IG5ldyBWZWN0b3IzKCkgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMuaXNRdWFkcmF0aWNCZXppZXJDdXJ2ZTMgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnUXVhZHJhdGljQmV6aWVyQ3VydmUzJzsKCgkJdGhpcy52MCA9IHYwOwoJCXRoaXMudjEgPSB2MTsKCQl0aGlzLnYyID0gdjI7CgoJfQoKCWdldFBvaW50KCB0LCBvcHRpb25hbFRhcmdldCA9IG5ldyBWZWN0b3IzKCkgKSB7CgoJCWNvbnN0IHBvaW50ID0gb3B0aW9uYWxUYXJnZXQ7CgoJCWNvbnN0IHYwID0gdGhpcy52MCwgdjEgPSB0aGlzLnYxLCB2MiA9IHRoaXMudjI7CgoJCXBvaW50LnNldCgKCQkJUXVhZHJhdGljQmV6aWVyKCB0LCB2MC54LCB2MS54LCB2Mi54ICksCgkJCVF1YWRyYXRpY0JlemllciggdCwgdjAueSwgdjEueSwgdjIueSApLAoJCQlRdWFkcmF0aWNCZXppZXIoIHQsIHYwLnosIHYxLnosIHYyLnogKQoJCSk7CgoJCXJldHVybiBwb2ludDsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy52MC5jb3B5KCBzb3VyY2UudjAgKTsKCQl0aGlzLnYxLmNvcHkoIHNvdXJjZS52MSApOwoJCXRoaXMudjIuY29weSggc291cmNlLnYyICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0pTT04oKSB7CgoJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oKTsKCgkJZGF0YS52MCA9IHRoaXMudjAudG9BcnJheSgpOwoJCWRhdGEudjEgPSB0aGlzLnYxLnRvQXJyYXkoKTsKCQlkYXRhLnYyID0gdGhpcy52Mi50b0FycmF5KCk7CgoJCXJldHVybiBkYXRhOwoKCX0KCglmcm9tSlNPTigganNvbiApIHsKCgkJc3VwZXIuZnJvbUpTT04oIGpzb24gKTsKCgkJdGhpcy52MC5mcm9tQXJyYXkoIGpzb24udjAgKTsKCQl0aGlzLnYxLmZyb21BcnJheSgganNvbi52MSApOwoJCXRoaXMudjIuZnJvbUFycmF5KCBqc29uLnYyICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNsYXNzIFNwbGluZUN1cnZlIGV4dGVuZHMgQ3VydmUgewoKCWNvbnN0cnVjdG9yKCBwb2ludHMgPSBbXSApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc1NwbGluZUN1cnZlID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ1NwbGluZUN1cnZlJzsKCgkJdGhpcy5wb2ludHMgPSBwb2ludHM7CgoJfQoKCWdldFBvaW50KCB0LCBvcHRpb25hbFRhcmdldCA9IG5ldyBWZWN0b3IyKCkgKSB7CgoJCWNvbnN0IHBvaW50ID0gb3B0aW9uYWxUYXJnZXQ7CgoJCWNvbnN0IHBvaW50cyA9IHRoaXMucG9pbnRzOwoJCWNvbnN0IHAgPSAoIHBvaW50cy5sZW5ndGggLSAxICkgKiB0OwoKCQljb25zdCBpbnRQb2ludCA9IE1hdGguZmxvb3IoIHAgKTsKCQljb25zdCB3ZWlnaHQgPSBwIC0gaW50UG9pbnQ7CgoJCWNvbnN0IHAwID0gcG9pbnRzWyBpbnRQb2ludCA9PT0gMCA/IGludFBvaW50IDogaW50UG9pbnQgLSAxIF07CgkJY29uc3QgcDEgPSBwb2ludHNbIGludFBvaW50IF07CgkJY29uc3QgcDIgPSBwb2ludHNbIGludFBvaW50ID4gcG9pbnRzLmxlbmd0aCAtIDIgPyBwb2ludHMubGVuZ3RoIC0gMSA6IGludFBvaW50ICsgMSBdOwoJCWNvbnN0IHAzID0gcG9pbnRzWyBpbnRQb2ludCA+IHBvaW50cy5sZW5ndGggLSAzID8gcG9pbnRzLmxlbmd0aCAtIDEgOiBpbnRQb2ludCArIDIgXTsKCgkJcG9pbnQuc2V0KAoJCQlDYXRtdWxsUm9tKCB3ZWlnaHQsIHAwLngsIHAxLngsIHAyLngsIHAzLnggKSwKCQkJQ2F0bXVsbFJvbSggd2VpZ2h0LCBwMC55LCBwMS55LCBwMi55LCBwMy55ICkKCQkpOwoKCQlyZXR1cm4gcG9pbnQ7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMucG9pbnRzID0gW107CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHNvdXJjZS5wb2ludHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IHBvaW50ID0gc291cmNlLnBvaW50c1sgaSBdOwoKCQkJdGhpcy5wb2ludHMucHVzaCggcG9pbnQuY2xvbmUoKSApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0pTT04oKSB7CgoJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oKTsKCgkJZGF0YS5wb2ludHMgPSBbXTsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gdGhpcy5wb2ludHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IHBvaW50ID0gdGhpcy5wb2ludHNbIGkgXTsKCQkJZGF0YS5wb2ludHMucHVzaCggcG9pbnQudG9BcnJheSgpICk7CgoJCX0KCgkJcmV0dXJuIGRhdGE7CgoJfQoKCWZyb21KU09OKCBqc29uICkgewoKCQlzdXBlci5mcm9tSlNPTigganNvbiApOwoKCQl0aGlzLnBvaW50cyA9IFtdOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBqc29uLnBvaW50cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJY29uc3QgcG9pbnQgPSBqc29uLnBvaW50c1sgaSBdOwoJCQl0aGlzLnBvaW50cy5wdXNoKCBuZXcgVmVjdG9yMigpLmZyb21BcnJheSggcG9pbnQgKSApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCnZhciBDdXJ2ZXMgPSAvKiNfX1BVUkVfXyovT2JqZWN0LmZyZWV6ZSh7CglfX3Byb3RvX186IG51bGwsCglBcmNDdXJ2ZTogQXJjQ3VydmUsCglDYXRtdWxsUm9tQ3VydmUzOiBDYXRtdWxsUm9tQ3VydmUzLAoJQ3ViaWNCZXppZXJDdXJ2ZTogQ3ViaWNCZXppZXJDdXJ2ZSwKCUN1YmljQmV6aWVyQ3VydmUzOiBDdWJpY0JlemllckN1cnZlMywKCUVsbGlwc2VDdXJ2ZTogRWxsaXBzZUN1cnZlLAoJTGluZUN1cnZlOiBMaW5lQ3VydmUsCglMaW5lQ3VydmUzOiBMaW5lQ3VydmUzLAoJUXVhZHJhdGljQmV6aWVyQ3VydmU6IFF1YWRyYXRpY0JlemllckN1cnZlLAoJUXVhZHJhdGljQmV6aWVyQ3VydmUzOiBRdWFkcmF0aWNCZXppZXJDdXJ2ZTMsCglTcGxpbmVDdXJ2ZTogU3BsaW5lQ3VydmUKfSk7CgovKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioKICoJQ3VydmVkIFBhdGggLSBhIGN1cnZlIHBhdGggaXMgc2ltcGx5IGEgYXJyYXkgb2YgY29ubmVjdGVkCiAqICBjdXJ2ZXMsIGJ1dCByZXRhaW5zIHRoZSBhcGkgb2YgYSBjdXJ2ZQogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKiovCgpjbGFzcyBDdXJ2ZVBhdGggZXh0ZW5kcyBDdXJ2ZSB7CgoJY29uc3RydWN0b3IoKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMudHlwZSA9ICdDdXJ2ZVBhdGgnOwoKCQl0aGlzLmN1cnZlcyA9IFtdOwoJCXRoaXMuYXV0b0Nsb3NlID0gZmFsc2U7IC8vIEF1dG9tYXRpY2FsbHkgY2xvc2VzIHRoZSBwYXRoCgoJfQoKCWFkZCggY3VydmUgKSB7CgoJCXRoaXMuY3VydmVzLnB1c2goIGN1cnZlICk7CgoJfQoKCWNsb3NlUGF0aCgpIHsKCgkJLy8gQWRkIGEgbGluZSBjdXJ2ZSBpZiBzdGFydCBhbmQgZW5kIG9mIGxpbmVzIGFyZSBub3QgY29ubmVjdGVkCgkJY29uc3Qgc3RhcnRQb2ludCA9IHRoaXMuY3VydmVzWyAwIF0uZ2V0UG9pbnQoIDAgKTsKCQljb25zdCBlbmRQb2ludCA9IHRoaXMuY3VydmVzWyB0aGlzLmN1cnZlcy5sZW5ndGggLSAxIF0uZ2V0UG9pbnQoIDEgKTsKCgkJaWYgKCAhIHN0YXJ0UG9pbnQuZXF1YWxzKCBlbmRQb2ludCApICkgewoKCQkJY29uc3QgbGluZVR5cGUgPSAoIHN0YXJ0UG9pbnQuaXNWZWN0b3IyID09PSB0cnVlICkgPyAnTGluZUN1cnZlJyA6ICdMaW5lQ3VydmUzJzsKCQkJdGhpcy5jdXJ2ZXMucHVzaCggbmV3IEN1cnZlc1sgbGluZVR5cGUgXSggZW5kUG9pbnQsIHN0YXJ0UG9pbnQgKSApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgkvLyBUbyBnZXQgYWNjdXJhdGUgcG9pbnQgd2l0aCByZWZlcmVuY2UgdG8KCS8vIGVudGlyZSBwYXRoIGRpc3RhbmNlIGF0IHRpbWUgdCwKCS8vIGZvbGxvd2luZyBoYXMgdG8gYmUgZG9uZToKCgkvLyAxLiBMZW5ndGggb2YgZWFjaCBzdWIgcGF0aCBoYXZlIHRvIGJlIGtub3duCgkvLyAyLiBMb2NhdGUgYW5kIGlkZW50aWZ5IHR5cGUgb2YgY3VydmUKCS8vIDMuIEdldCB0IGZvciB0aGUgY3VydmUKCS8vIDQuIFJldHVybiBjdXJ2ZS5nZXRQb2ludEF0KHQnKQoKCWdldFBvaW50KCB0LCBvcHRpb25hbFRhcmdldCApIHsKCgkJY29uc3QgZCA9IHQgKiB0aGlzLmdldExlbmd0aCgpOwoJCWNvbnN0IGN1cnZlTGVuZ3RocyA9IHRoaXMuZ2V0Q3VydmVMZW5ndGhzKCk7CgkJbGV0IGkgPSAwOwoKCQkvLyBUbyB0aGluayBhYm91dCBib3VuZGFyaWVzIHBvaW50cy4KCgkJd2hpbGUgKCBpIDwgY3VydmVMZW5ndGhzLmxlbmd0aCApIHsKCgkJCWlmICggY3VydmVMZW5ndGhzWyBpIF0gPj0gZCApIHsKCgkJCQljb25zdCBkaWZmID0gY3VydmVMZW5ndGhzWyBpIF0gLSBkOwoJCQkJY29uc3QgY3VydmUgPSB0aGlzLmN1cnZlc1sgaSBdOwoKCQkJCWNvbnN0IHNlZ21lbnRMZW5ndGggPSBjdXJ2ZS5nZXRMZW5ndGgoKTsKCQkJCWNvbnN0IHUgPSBzZWdtZW50TGVuZ3RoID09PSAwID8gMCA6IDEgLSBkaWZmIC8gc2VnbWVudExlbmd0aDsKCgkJCQlyZXR1cm4gY3VydmUuZ2V0UG9pbnRBdCggdSwgb3B0aW9uYWxUYXJnZXQgKTsKCgkJCX0KCgkJCWkgKys7CgoJCX0KCgkJcmV0dXJuIG51bGw7CgoJCS8vIGxvb3Agd2hlcmUgc3VtICE9IDAsIHN1bSA+IGQgLCBzdW0rMSA8ZAoKCX0KCgkvLyBXZSBjYW5ub3QgdXNlIHRoZSBkZWZhdWx0IFRIUkVFLkN1cnZlIGdldFBvaW50KCkgd2l0aCBnZXRMZW5ndGgoKSBiZWNhdXNlIGluCgkvLyBUSFJFRS5DdXJ2ZSwgZ2V0TGVuZ3RoKCkgZGVwZW5kcyBvbiBnZXRQb2ludCgpIGJ1dCBpbiBUSFJFRS5DdXJ2ZVBhdGgKCS8vIGdldFBvaW50KCkgZGVwZW5kcyBvbiBnZXRMZW5ndGgKCglnZXRMZW5ndGgoKSB7CgoJCWNvbnN0IGxlbnMgPSB0aGlzLmdldEN1cnZlTGVuZ3RocygpOwoJCXJldHVybiBsZW5zWyBsZW5zLmxlbmd0aCAtIDEgXTsKCgl9CgoJLy8gY2FjaGVMZW5ndGhzIG11c3QgYmUgcmVjYWxjdWxhdGVkLgoJdXBkYXRlQXJjTGVuZ3RocygpIHsKCgkJdGhpcy5uZWVkc1VwZGF0ZSA9IHRydWU7CgkJdGhpcy5jYWNoZUxlbmd0aHMgPSBudWxsOwoJCXRoaXMuZ2V0Q3VydmVMZW5ndGhzKCk7CgoJfQoKCS8vIENvbXB1dGUgbGVuZ3RocyBhbmQgY2FjaGUgdGhlbQoJLy8gV2UgY2Fubm90IG92ZXJ3cml0ZSBnZXRMZW5ndGhzKCkgYmVjYXVzZSBVdG9UIG1hcHBpbmcgdXNlcyBpdC4KCglnZXRDdXJ2ZUxlbmd0aHMoKSB7CgoJCS8vIFdlIHVzZSBjYWNoZSB2YWx1ZXMgaWYgY3VydmVzIGFuZCBjYWNoZSBhcnJheSBhcmUgc2FtZSBsZW5ndGgKCgkJaWYgKCB0aGlzLmNhY2hlTGVuZ3RocyAmJiB0aGlzLmNhY2hlTGVuZ3Rocy5sZW5ndGggPT09IHRoaXMuY3VydmVzLmxlbmd0aCApIHsKCgkJCXJldHVybiB0aGlzLmNhY2hlTGVuZ3RoczsKCgkJfQoKCQkvLyBHZXQgbGVuZ3RoIG9mIHN1Yi1jdXJ2ZQoJCS8vIFB1c2ggc3VtcyBpbnRvIGNhY2hlZCBhcnJheQoKCQljb25zdCBsZW5ndGhzID0gW107CgkJbGV0IHN1bXMgPSAwOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB0aGlzLmN1cnZlcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJc3VtcyArPSB0aGlzLmN1cnZlc1sgaSBdLmdldExlbmd0aCgpOwoJCQlsZW5ndGhzLnB1c2goIHN1bXMgKTsKCgkJfQoKCQl0aGlzLmNhY2hlTGVuZ3RocyA9IGxlbmd0aHM7CgoJCXJldHVybiBsZW5ndGhzOwoKCX0KCglnZXRTcGFjZWRQb2ludHMoIGRpdmlzaW9ucyA9IDQwICkgewoKCQljb25zdCBwb2ludHMgPSBbXTsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDw9IGRpdmlzaW9uczsgaSArKyApIHsKCgkJCXBvaW50cy5wdXNoKCB0aGlzLmdldFBvaW50KCBpIC8gZGl2aXNpb25zICkgKTsKCgkJfQoKCQlpZiAoIHRoaXMuYXV0b0Nsb3NlICkgewoKCQkJcG9pbnRzLnB1c2goIHBvaW50c1sgMCBdICk7CgoJCX0KCgkJcmV0dXJuIHBvaW50czsKCgl9CgoJZ2V0UG9pbnRzKCBkaXZpc2lvbnMgPSAxMiApIHsKCgkJY29uc3QgcG9pbnRzID0gW107CgkJbGV0IGxhc3Q7CgoJCWZvciAoIGxldCBpID0gMCwgY3VydmVzID0gdGhpcy5jdXJ2ZXM7IGkgPCBjdXJ2ZXMubGVuZ3RoOyBpICsrICkgewoKCQkJY29uc3QgY3VydmUgPSBjdXJ2ZXNbIGkgXTsKCQkJY29uc3QgcmVzb2x1dGlvbiA9IGN1cnZlLmlzRWxsaXBzZUN1cnZlID8gZGl2aXNpb25zICogMgoJCQkJOiAoIGN1cnZlLmlzTGluZUN1cnZlIHx8IGN1cnZlLmlzTGluZUN1cnZlMyApID8gMQoJCQkJCTogY3VydmUuaXNTcGxpbmVDdXJ2ZSA/IGRpdmlzaW9ucyAqIGN1cnZlLnBvaW50cy5sZW5ndGgKCQkJCQkJOiBkaXZpc2lvbnM7CgoJCQljb25zdCBwdHMgPSBjdXJ2ZS5nZXRQb2ludHMoIHJlc29sdXRpb24gKTsKCgkJCWZvciAoIGxldCBqID0gMDsgaiA8IHB0cy5sZW5ndGg7IGogKysgKSB7CgoJCQkJY29uc3QgcG9pbnQgPSBwdHNbIGogXTsKCgkJCQlpZiAoIGxhc3QgJiYgbGFzdC5lcXVhbHMoIHBvaW50ICkgKSBjb250aW51ZTsgLy8gZW5zdXJlcyBubyBjb25zZWN1dGl2ZSBwb2ludHMgYXJlIGR1cGxpY2F0ZXMKCgkJCQlwb2ludHMucHVzaCggcG9pbnQgKTsKCQkJCWxhc3QgPSBwb2ludDsKCgkJCX0KCgkJfQoKCQlpZiAoIHRoaXMuYXV0b0Nsb3NlICYmIHBvaW50cy5sZW5ndGggPiAxICYmICEgcG9pbnRzWyBwb2ludHMubGVuZ3RoIC0gMSBdLmVxdWFscyggcG9pbnRzWyAwIF0gKSApIHsKCgkJCXBvaW50cy5wdXNoKCBwb2ludHNbIDAgXSApOwoKCQl9CgoJCXJldHVybiBwb2ludHM7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMuY3VydmVzID0gW107CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHNvdXJjZS5jdXJ2ZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IGN1cnZlID0gc291cmNlLmN1cnZlc1sgaSBdOwoKCQkJdGhpcy5jdXJ2ZXMucHVzaCggY3VydmUuY2xvbmUoKSApOwoKCQl9CgoJCXRoaXMuYXV0b0Nsb3NlID0gc291cmNlLmF1dG9DbG9zZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTigpIHsKCgkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTigpOwoKCQlkYXRhLmF1dG9DbG9zZSA9IHRoaXMuYXV0b0Nsb3NlOwoJCWRhdGEuY3VydmVzID0gW107CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHRoaXMuY3VydmVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQljb25zdCBjdXJ2ZSA9IHRoaXMuY3VydmVzWyBpIF07CgkJCWRhdGEuY3VydmVzLnB1c2goIGN1cnZlLnRvSlNPTigpICk7CgoJCX0KCgkJcmV0dXJuIGRhdGE7CgoJfQoKCWZyb21KU09OKCBqc29uICkgewoKCQlzdXBlci5mcm9tSlNPTigganNvbiApOwoKCQl0aGlzLmF1dG9DbG9zZSA9IGpzb24uYXV0b0Nsb3NlOwoJCXRoaXMuY3VydmVzID0gW107CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IGpzb24uY3VydmVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQljb25zdCBjdXJ2ZSA9IGpzb24uY3VydmVzWyBpIF07CgkJCXRoaXMuY3VydmVzLnB1c2goIG5ldyBDdXJ2ZXNbIGN1cnZlLnR5cGUgXSgpLmZyb21KU09OKCBjdXJ2ZSApICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKY2xhc3MgUGF0aCBleHRlbmRzIEN1cnZlUGF0aCB7CgoJY29uc3RydWN0b3IoIHBvaW50cyApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy50eXBlID0gJ1BhdGgnOwoKCQl0aGlzLmN1cnJlbnRQb2ludCA9IG5ldyBWZWN0b3IyKCk7CgoJCWlmICggcG9pbnRzICkgewoKCQkJdGhpcy5zZXRGcm9tUG9pbnRzKCBwb2ludHMgKTsKCgkJfQoKCX0KCglzZXRGcm9tUG9pbnRzKCBwb2ludHMgKSB7CgoJCXRoaXMubW92ZVRvKCBwb2ludHNbIDAgXS54LCBwb2ludHNbIDAgXS55ICk7CgoJCWZvciAoIGxldCBpID0gMSwgbCA9IHBvaW50cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJdGhpcy5saW5lVG8oIHBvaW50c1sgaSBdLngsIHBvaW50c1sgaSBdLnkgKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbW92ZVRvKCB4LCB5ICkgewoKCQl0aGlzLmN1cnJlbnRQb2ludC5zZXQoIHgsIHkgKTsgLy8gVE9ETyBjb25zaWRlciByZWZlcmVuY2luZyB2ZWN0b3JzIGluc3RlYWQgb2YgY29weWluZz8KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWxpbmVUbyggeCwgeSApIHsKCgkJY29uc3QgY3VydmUgPSBuZXcgTGluZUN1cnZlKCB0aGlzLmN1cnJlbnRQb2ludC5jbG9uZSgpLCBuZXcgVmVjdG9yMiggeCwgeSApICk7CgkJdGhpcy5jdXJ2ZXMucHVzaCggY3VydmUgKTsKCgkJdGhpcy5jdXJyZW50UG9pbnQuc2V0KCB4LCB5ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglxdWFkcmF0aWNDdXJ2ZVRvKCBhQ1B4LCBhQ1B5LCBhWCwgYVkgKSB7CgoJCWNvbnN0IGN1cnZlID0gbmV3IFF1YWRyYXRpY0JlemllckN1cnZlKAoJCQl0aGlzLmN1cnJlbnRQb2ludC5jbG9uZSgpLAoJCQluZXcgVmVjdG9yMiggYUNQeCwgYUNQeSApLAoJCQluZXcgVmVjdG9yMiggYVgsIGFZICkKCQkpOwoKCQl0aGlzLmN1cnZlcy5wdXNoKCBjdXJ2ZSApOwoKCQl0aGlzLmN1cnJlbnRQb2ludC5zZXQoIGFYLCBhWSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJYmV6aWVyQ3VydmVUbyggYUNQMXgsIGFDUDF5LCBhQ1AyeCwgYUNQMnksIGFYLCBhWSApIHsKCgkJY29uc3QgY3VydmUgPSBuZXcgQ3ViaWNCZXppZXJDdXJ2ZSgKCQkJdGhpcy5jdXJyZW50UG9pbnQuY2xvbmUoKSwKCQkJbmV3IFZlY3RvcjIoIGFDUDF4LCBhQ1AxeSApLAoJCQluZXcgVmVjdG9yMiggYUNQMngsIGFDUDJ5ICksCgkJCW5ldyBWZWN0b3IyKCBhWCwgYVkgKQoJCSk7CgoJCXRoaXMuY3VydmVzLnB1c2goIGN1cnZlICk7CgoJCXRoaXMuY3VycmVudFBvaW50LnNldCggYVgsIGFZICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzcGxpbmVUaHJ1KCBwdHMgLypBcnJheSBvZiBWZWN0b3IqLyApIHsKCgkJY29uc3QgbnB0cyA9IFsgdGhpcy5jdXJyZW50UG9pbnQuY2xvbmUoKSBdLmNvbmNhdCggcHRzICk7CgoJCWNvbnN0IGN1cnZlID0gbmV3IFNwbGluZUN1cnZlKCBucHRzICk7CgkJdGhpcy5jdXJ2ZXMucHVzaCggY3VydmUgKTsKCgkJdGhpcy5jdXJyZW50UG9pbnQuY29weSggcHRzWyBwdHMubGVuZ3RoIC0gMSBdICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglhcmMoIGFYLCBhWSwgYVJhZGl1cywgYVN0YXJ0QW5nbGUsIGFFbmRBbmdsZSwgYUNsb2Nrd2lzZSApIHsKCgkJY29uc3QgeDAgPSB0aGlzLmN1cnJlbnRQb2ludC54OwoJCWNvbnN0IHkwID0gdGhpcy5jdXJyZW50UG9pbnQueTsKCgkJdGhpcy5hYnNhcmMoIGFYICsgeDAsIGFZICsgeTAsIGFSYWRpdXMsCgkJCWFTdGFydEFuZ2xlLCBhRW5kQW5nbGUsIGFDbG9ja3dpc2UgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWFic2FyYyggYVgsIGFZLCBhUmFkaXVzLCBhU3RhcnRBbmdsZSwgYUVuZEFuZ2xlLCBhQ2xvY2t3aXNlICkgewoKCQl0aGlzLmFic2VsbGlwc2UoIGFYLCBhWSwgYVJhZGl1cywgYVJhZGl1cywgYVN0YXJ0QW5nbGUsIGFFbmRBbmdsZSwgYUNsb2Nrd2lzZSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZWxsaXBzZSggYVgsIGFZLCB4UmFkaXVzLCB5UmFkaXVzLCBhU3RhcnRBbmdsZSwgYUVuZEFuZ2xlLCBhQ2xvY2t3aXNlLCBhUm90YXRpb24gKSB7CgoJCWNvbnN0IHgwID0gdGhpcy5jdXJyZW50UG9pbnQueDsKCQljb25zdCB5MCA9IHRoaXMuY3VycmVudFBvaW50Lnk7CgoJCXRoaXMuYWJzZWxsaXBzZSggYVggKyB4MCwgYVkgKyB5MCwgeFJhZGl1cywgeVJhZGl1cywgYVN0YXJ0QW5nbGUsIGFFbmRBbmdsZSwgYUNsb2Nrd2lzZSwgYVJvdGF0aW9uICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglhYnNlbGxpcHNlKCBhWCwgYVksIHhSYWRpdXMsIHlSYWRpdXMsIGFTdGFydEFuZ2xlLCBhRW5kQW5nbGUsIGFDbG9ja3dpc2UsIGFSb3RhdGlvbiApIHsKCgkJY29uc3QgY3VydmUgPSBuZXcgRWxsaXBzZUN1cnZlKCBhWCwgYVksIHhSYWRpdXMsIHlSYWRpdXMsIGFTdGFydEFuZ2xlLCBhRW5kQW5nbGUsIGFDbG9ja3dpc2UsIGFSb3RhdGlvbiApOwoKCQlpZiAoIHRoaXMuY3VydmVzLmxlbmd0aCA+IDAgKSB7CgoJCQkvLyBpZiBhIHByZXZpb3VzIGN1cnZlIGlzIHByZXNlbnQsIGF0dGVtcHQgdG8gam9pbgoJCQljb25zdCBmaXJzdFBvaW50ID0gY3VydmUuZ2V0UG9pbnQoIDAgKTsKCgkJCWlmICggISBmaXJzdFBvaW50LmVxdWFscyggdGhpcy5jdXJyZW50UG9pbnQgKSApIHsKCgkJCQl0aGlzLmxpbmVUbyggZmlyc3RQb2ludC54LCBmaXJzdFBvaW50LnkgKTsKCgkJCX0KCgkJfQoKCQl0aGlzLmN1cnZlcy5wdXNoKCBjdXJ2ZSApOwoKCQljb25zdCBsYXN0UG9pbnQgPSBjdXJ2ZS5nZXRQb2ludCggMSApOwoJCXRoaXMuY3VycmVudFBvaW50LmNvcHkoIGxhc3RQb2ludCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5jdXJyZW50UG9pbnQuY29weSggc291cmNlLmN1cnJlbnRQb2ludCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdG9KU09OKCkgewoKCQljb25zdCBkYXRhID0gc3VwZXIudG9KU09OKCk7CgoJCWRhdGEuY3VycmVudFBvaW50ID0gdGhpcy5jdXJyZW50UG9pbnQudG9BcnJheSgpOwoKCQlyZXR1cm4gZGF0YTsKCgl9CgoJZnJvbUpTT04oIGpzb24gKSB7CgoJCXN1cGVyLmZyb21KU09OKCBqc29uICk7CgoJCXRoaXMuY3VycmVudFBvaW50LmZyb21BcnJheSgganNvbi5jdXJyZW50UG9pbnQgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKY2xhc3MgTGF0aGVHZW9tZXRyeSBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKCgljb25zdHJ1Y3RvciggcG9pbnRzID0gWyBuZXcgVmVjdG9yMiggMCwgLSAwLjUgKSwgbmV3IFZlY3RvcjIoIDAuNSwgMCApLCBuZXcgVmVjdG9yMiggMCwgMC41ICkgXSwgc2VnbWVudHMgPSAxMiwgcGhpU3RhcnQgPSAwLCBwaGlMZW5ndGggPSBNYXRoLlBJICogMiApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy50eXBlID0gJ0xhdGhlR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXBvaW50czogcG9pbnRzLAoJCQlzZWdtZW50czogc2VnbWVudHMsCgkJCXBoaVN0YXJ0OiBwaGlTdGFydCwKCQkJcGhpTGVuZ3RoOiBwaGlMZW5ndGgKCQl9OwoKCQlzZWdtZW50cyA9IE1hdGguZmxvb3IoIHNlZ21lbnRzICk7CgoJCS8vIGNsYW1wIHBoaUxlbmd0aCBzbyBpdCdzIGluIHJhbmdlIG9mIFsgMCwgMlBJIF0KCgkJcGhpTGVuZ3RoID0gY2xhbXAoIHBoaUxlbmd0aCwgMCwgTWF0aC5QSSAqIDIgKTsKCgkJLy8gYnVmZmVycwoKCQljb25zdCBpbmRpY2VzID0gW107CgkJY29uc3QgdmVydGljZXMgPSBbXTsKCQljb25zdCB1dnMgPSBbXTsKCQljb25zdCBpbml0Tm9ybWFscyA9IFtdOwoJCWNvbnN0IG5vcm1hbHMgPSBbXTsKCgkJLy8gaGVscGVyIHZhcmlhYmxlcwoKCQljb25zdCBpbnZlcnNlU2VnbWVudHMgPSAxLjAgLyBzZWdtZW50czsKCQljb25zdCB2ZXJ0ZXggPSBuZXcgVmVjdG9yMygpOwoJCWNvbnN0IHV2ID0gbmV3IFZlY3RvcjIoKTsKCQljb25zdCBub3JtYWwgPSBuZXcgVmVjdG9yMygpOwoJCWNvbnN0IGN1ck5vcm1hbCA9IG5ldyBWZWN0b3IzKCk7CgkJY29uc3QgcHJldk5vcm1hbCA9IG5ldyBWZWN0b3IzKCk7CgkJbGV0IGR4ID0gMDsKCQlsZXQgZHkgPSAwOwoKCQkvLyBwcmUtY29tcHV0ZSBub3JtYWxzIGZvciBpbml0aWFsICJtZXJpZGlhbiIKCgkJZm9yICggbGV0IGogPSAwOyBqIDw9ICggcG9pbnRzLmxlbmd0aCAtIDEgKTsgaiArKyApIHsKCgkJCXN3aXRjaCAoIGogKSB7CgoJCQkJY2FzZSAwOgkJCQkvLyBzcGVjaWFsIGhhbmRsaW5nIGZvciAxc3QgdmVydGV4IG9uIHBhdGgKCgkJCQkJZHggPSBwb2ludHNbIGogKyAxIF0ueCAtIHBvaW50c1sgaiBdLng7CgkJCQkJZHkgPSBwb2ludHNbIGogKyAxIF0ueSAtIHBvaW50c1sgaiBdLnk7CgoJCQkJCW5vcm1hbC54ID0gZHkgKiAxLjA7CgkJCQkJbm9ybWFsLnkgPSAtIGR4OwoJCQkJCW5vcm1hbC56ID0gZHkgKiAwLjA7CgoJCQkJCXByZXZOb3JtYWwuY29weSggbm9ybWFsICk7CgoJCQkJCW5vcm1hbC5ub3JtYWxpemUoKTsKCgkJCQkJaW5pdE5vcm1hbHMucHVzaCggbm9ybWFsLngsIG5vcm1hbC55LCBub3JtYWwueiApOwoKCQkJCQlicmVhazsKCgkJCQljYXNlICggcG9pbnRzLmxlbmd0aCAtIDEgKToJLy8gc3BlY2lhbCBoYW5kbGluZyBmb3IgbGFzdCBWZXJ0ZXggb24gcGF0aAoKCQkJCQlpbml0Tm9ybWFscy5wdXNoKCBwcmV2Tm9ybWFsLngsIHByZXZOb3JtYWwueSwgcHJldk5vcm1hbC56ICk7CgoJCQkJCWJyZWFrOwoKCQkJCWRlZmF1bHQ6CQkJLy8gZGVmYXVsdCBoYW5kbGluZyBmb3IgYWxsIHZlcnRpY2VzIGluIGJldHdlZW4KCgkJCQkJZHggPSBwb2ludHNbIGogKyAxIF0ueCAtIHBvaW50c1sgaiBdLng7CgkJCQkJZHkgPSBwb2ludHNbIGogKyAxIF0ueSAtIHBvaW50c1sgaiBdLnk7CgoJCQkJCW5vcm1hbC54ID0gZHkgKiAxLjA7CgkJCQkJbm9ybWFsLnkgPSAtIGR4OwoJCQkJCW5vcm1hbC56ID0gZHkgKiAwLjA7CgoJCQkJCWN1ck5vcm1hbC5jb3B5KCBub3JtYWwgKTsKCgkJCQkJbm9ybWFsLnggKz0gcHJldk5vcm1hbC54OwoJCQkJCW5vcm1hbC55ICs9IHByZXZOb3JtYWwueTsKCQkJCQlub3JtYWwueiArPSBwcmV2Tm9ybWFsLno7CgoJCQkJCW5vcm1hbC5ub3JtYWxpemUoKTsKCgkJCQkJaW5pdE5vcm1hbHMucHVzaCggbm9ybWFsLngsIG5vcm1hbC55LCBub3JtYWwueiApOwoKCQkJCQlwcmV2Tm9ybWFsLmNvcHkoIGN1ck5vcm1hbCApOwoKCQkJfQoKCQl9CgoJCS8vIGdlbmVyYXRlIHZlcnRpY2VzLCB1dnMgYW5kIG5vcm1hbHMKCgkJZm9yICggbGV0IGkgPSAwOyBpIDw9IHNlZ21lbnRzOyBpICsrICkgewoKCQkJY29uc3QgcGhpID0gcGhpU3RhcnQgKyBpICogaW52ZXJzZVNlZ21lbnRzICogcGhpTGVuZ3RoOwoKCQkJY29uc3Qgc2luID0gTWF0aC5zaW4oIHBoaSApOwoJCQljb25zdCBjb3MgPSBNYXRoLmNvcyggcGhpICk7CgoJCQlmb3IgKCBsZXQgaiA9IDA7IGogPD0gKCBwb2ludHMubGVuZ3RoIC0gMSApOyBqICsrICkgewoKCQkJCS8vIHZlcnRleAoKCQkJCXZlcnRleC54ID0gcG9pbnRzWyBqIF0ueCAqIHNpbjsKCQkJCXZlcnRleC55ID0gcG9pbnRzWyBqIF0ueTsKCQkJCXZlcnRleC56ID0gcG9pbnRzWyBqIF0ueCAqIGNvczsKCgkJCQl2ZXJ0aWNlcy5wdXNoKCB2ZXJ0ZXgueCwgdmVydGV4LnksIHZlcnRleC56ICk7CgoJCQkJLy8gdXYKCgkJCQl1di54ID0gaSAvIHNlZ21lbnRzOwoJCQkJdXYueSA9IGogLyAoIHBvaW50cy5sZW5ndGggLSAxICk7CgoJCQkJdXZzLnB1c2goIHV2LngsIHV2LnkgKTsKCgkJCQkvLyBub3JtYWwKCgkJCQljb25zdCB4ID0gaW5pdE5vcm1hbHNbIDMgKiBqICsgMCBdICogc2luOwoJCQkJY29uc3QgeSA9IGluaXROb3JtYWxzWyAzICogaiArIDEgXTsKCQkJCWNvbnN0IHogPSBpbml0Tm9ybWFsc1sgMyAqIGogKyAwIF0gKiBjb3M7CgoJCQkJbm9ybWFscy5wdXNoKCB4LCB5LCB6ICk7CgoJCQl9CgoJCX0KCgkJLy8gaW5kaWNlcwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBzZWdtZW50czsgaSArKyApIHsKCgkJCWZvciAoIGxldCBqID0gMDsgaiA8ICggcG9pbnRzLmxlbmd0aCAtIDEgKTsgaiArKyApIHsKCgkJCQljb25zdCBiYXNlID0gaiArIGkgKiBwb2ludHMubGVuZ3RoOwoKCQkJCWNvbnN0IGEgPSBiYXNlOwoJCQkJY29uc3QgYiA9IGJhc2UgKyBwb2ludHMubGVuZ3RoOwoJCQkJY29uc3QgYyA9IGJhc2UgKyBwb2ludHMubGVuZ3RoICsgMTsKCQkJCWNvbnN0IGQgPSBiYXNlICsgMTsKCgkJCQkvLyBmYWNlcwoKCQkJCWluZGljZXMucHVzaCggYSwgYiwgZCApOwoJCQkJaW5kaWNlcy5wdXNoKCBjLCBkLCBiICk7CgoJCQl9CgoJCX0KCgkJLy8gYnVpbGQgZ2VvbWV0cnkKCgkJdGhpcy5zZXRJbmRleCggaW5kaWNlcyApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAndXYnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdXZzLCAyICkgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBub3JtYWxzLCAzICkgKTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5wYXJhbWV0ZXJzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzdGF0aWMgZnJvbUpTT04oIGRhdGEgKSB7CgoJCXJldHVybiBuZXcgTGF0aGVHZW9tZXRyeSggZGF0YS5wb2ludHMsIGRhdGEuc2VnbWVudHMsIGRhdGEucGhpU3RhcnQsIGRhdGEucGhpTGVuZ3RoICk7CgoJfQoKfQoKY2xhc3MgQ2Fwc3VsZUdlb21ldHJ5IGV4dGVuZHMgTGF0aGVHZW9tZXRyeSB7CgoJY29uc3RydWN0b3IoIHJhZGl1cyA9IDEsIGxlbmd0aCA9IDEsIGNhcFNlZ21lbnRzID0gNCwgcmFkaWFsU2VnbWVudHMgPSA4ICkgewoKCQljb25zdCBwYXRoID0gbmV3IFBhdGgoKTsKCQlwYXRoLmFic2FyYyggMCwgLSBsZW5ndGggLyAyLCByYWRpdXMsIE1hdGguUEkgKiAxLjUsIDAgKTsKCQlwYXRoLmFic2FyYyggMCwgbGVuZ3RoIC8gMiwgcmFkaXVzLCAwLCBNYXRoLlBJICogMC41ICk7CgoJCXN1cGVyKCBwYXRoLmdldFBvaW50cyggY2FwU2VnbWVudHMgKSwgcmFkaWFsU2VnbWVudHMgKTsKCgkJdGhpcy50eXBlID0gJ0NhcHN1bGVHZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJcmFkaXVzOiByYWRpdXMsCgkJCWxlbmd0aDogbGVuZ3RoLAoJCQljYXBTZWdtZW50czogY2FwU2VnbWVudHMsCgkJCXJhZGlhbFNlZ21lbnRzOiByYWRpYWxTZWdtZW50cywKCQl9OwoKCX0KCglzdGF0aWMgZnJvbUpTT04oIGRhdGEgKSB7CgoJCXJldHVybiBuZXcgQ2Fwc3VsZUdlb21ldHJ5KCBkYXRhLnJhZGl1cywgZGF0YS5sZW5ndGgsIGRhdGEuY2FwU2VnbWVudHMsIGRhdGEucmFkaWFsU2VnbWVudHMgKTsKCgl9Cgp9CgpjbGFzcyBDaXJjbGVHZW9tZXRyeSBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKCgljb25zdHJ1Y3RvciggcmFkaXVzID0gMSwgc2VnbWVudHMgPSAzMiwgdGhldGFTdGFydCA9IDAsIHRoZXRhTGVuZ3RoID0gTWF0aC5QSSAqIDIgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMudHlwZSA9ICdDaXJjbGVHZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJcmFkaXVzOiByYWRpdXMsCgkJCXNlZ21lbnRzOiBzZWdtZW50cywKCQkJdGhldGFTdGFydDogdGhldGFTdGFydCwKCQkJdGhldGFMZW5ndGg6IHRoZXRhTGVuZ3RoCgkJfTsKCgkJc2VnbWVudHMgPSBNYXRoLm1heCggMywgc2VnbWVudHMgKTsKCgkJLy8gYnVmZmVycwoKCQljb25zdCBpbmRpY2VzID0gW107CgkJY29uc3QgdmVydGljZXMgPSBbXTsKCQljb25zdCBub3JtYWxzID0gW107CgkJY29uc3QgdXZzID0gW107CgoJCS8vIGhlbHBlciB2YXJpYWJsZXMKCgkJY29uc3QgdmVydGV4ID0gbmV3IFZlY3RvcjMoKTsKCQljb25zdCB1diA9IG5ldyBWZWN0b3IyKCk7CgoJCS8vIGNlbnRlciBwb2ludAoKCQl2ZXJ0aWNlcy5wdXNoKCAwLCAwLCAwICk7CgkJbm9ybWFscy5wdXNoKCAwLCAwLCAxICk7CgkJdXZzLnB1c2goIDAuNSwgMC41ICk7CgoJCWZvciAoIGxldCBzID0gMCwgaSA9IDM7IHMgPD0gc2VnbWVudHM7IHMgKyssIGkgKz0gMyApIHsKCgkJCWNvbnN0IHNlZ21lbnQgPSB0aGV0YVN0YXJ0ICsgcyAvIHNlZ21lbnRzICogdGhldGFMZW5ndGg7CgoJCQkvLyB2ZXJ0ZXgKCgkJCXZlcnRleC54ID0gcmFkaXVzICogTWF0aC5jb3MoIHNlZ21lbnQgKTsKCQkJdmVydGV4LnkgPSByYWRpdXMgKiBNYXRoLnNpbiggc2VnbWVudCApOwoKCQkJdmVydGljZXMucHVzaCggdmVydGV4LngsIHZlcnRleC55LCB2ZXJ0ZXgueiApOwoKCQkJLy8gbm9ybWFsCgoJCQlub3JtYWxzLnB1c2goIDAsIDAsIDEgKTsKCgkJCS8vIHV2cwoKCQkJdXYueCA9ICggdmVydGljZXNbIGkgXSAvIHJhZGl1cyArIDEgKSAvIDI7CgkJCXV2LnkgPSAoIHZlcnRpY2VzWyBpICsgMSBdIC8gcmFkaXVzICsgMSApIC8gMjsKCgkJCXV2cy5wdXNoKCB1di54LCB1di55ICk7CgoJCX0KCgkJLy8gaW5kaWNlcwoKCQlmb3IgKCBsZXQgaSA9IDE7IGkgPD0gc2VnbWVudHM7IGkgKysgKSB7CgoJCQlpbmRpY2VzLnB1c2goIGksIGkgKyAxLCAwICk7CgoJCX0KCgkJLy8gYnVpbGQgZ2VvbWV0cnkKCgkJdGhpcy5zZXRJbmRleCggaW5kaWNlcyApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAnbm9ybWFsJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbHMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAndXYnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdXZzLCAyICkgKTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5wYXJhbWV0ZXJzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzdGF0aWMgZnJvbUpTT04oIGRhdGEgKSB7CgoJCXJldHVybiBuZXcgQ2lyY2xlR2VvbWV0cnkoIGRhdGEucmFkaXVzLCBkYXRhLnNlZ21lbnRzLCBkYXRhLnRoZXRhU3RhcnQsIGRhdGEudGhldGFMZW5ndGggKTsKCgl9Cgp9CgpjbGFzcyBDeWxpbmRlckdlb21ldHJ5IGV4dGVuZHMgQnVmZmVyR2VvbWV0cnkgewoKCWNvbnN0cnVjdG9yKCByYWRpdXNUb3AgPSAxLCByYWRpdXNCb3R0b20gPSAxLCBoZWlnaHQgPSAxLCByYWRpYWxTZWdtZW50cyA9IDMyLCBoZWlnaHRTZWdtZW50cyA9IDEsIG9wZW5FbmRlZCA9IGZhbHNlLCB0aGV0YVN0YXJ0ID0gMCwgdGhldGFMZW5ndGggPSBNYXRoLlBJICogMiApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy50eXBlID0gJ0N5bGluZGVyR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXJhZGl1c1RvcDogcmFkaXVzVG9wLAoJCQlyYWRpdXNCb3R0b206IHJhZGl1c0JvdHRvbSwKCQkJaGVpZ2h0OiBoZWlnaHQsCgkJCXJhZGlhbFNlZ21lbnRzOiByYWRpYWxTZWdtZW50cywKCQkJaGVpZ2h0U2VnbWVudHM6IGhlaWdodFNlZ21lbnRzLAoJCQlvcGVuRW5kZWQ6IG9wZW5FbmRlZCwKCQkJdGhldGFTdGFydDogdGhldGFTdGFydCwKCQkJdGhldGFMZW5ndGg6IHRoZXRhTGVuZ3RoCgkJfTsKCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQlyYWRpYWxTZWdtZW50cyA9IE1hdGguZmxvb3IoIHJhZGlhbFNlZ21lbnRzICk7CgkJaGVpZ2h0U2VnbWVudHMgPSBNYXRoLmZsb29yKCBoZWlnaHRTZWdtZW50cyApOwoKCQkvLyBidWZmZXJzCgoJCWNvbnN0IGluZGljZXMgPSBbXTsKCQljb25zdCB2ZXJ0aWNlcyA9IFtdOwoJCWNvbnN0IG5vcm1hbHMgPSBbXTsKCQljb25zdCB1dnMgPSBbXTsKCgkJLy8gaGVscGVyIHZhcmlhYmxlcwoKCQlsZXQgaW5kZXggPSAwOwoJCWNvbnN0IGluZGV4QXJyYXkgPSBbXTsKCQljb25zdCBoYWxmSGVpZ2h0ID0gaGVpZ2h0IC8gMjsKCQlsZXQgZ3JvdXBTdGFydCA9IDA7CgoJCS8vIGdlbmVyYXRlIGdlb21ldHJ5CgoJCWdlbmVyYXRlVG9yc28oKTsKCgkJaWYgKCBvcGVuRW5kZWQgPT09IGZhbHNlICkgewoKCQkJaWYgKCByYWRpdXNUb3AgPiAwICkgZ2VuZXJhdGVDYXAoIHRydWUgKTsKCQkJaWYgKCByYWRpdXNCb3R0b20gPiAwICkgZ2VuZXJhdGVDYXAoIGZhbHNlICk7CgoJCX0KCgkJLy8gYnVpbGQgZ2VvbWV0cnkKCgkJdGhpcy5zZXRJbmRleCggaW5kaWNlcyApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAnbm9ybWFsJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbHMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAndXYnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdXZzLCAyICkgKTsKCgkJZnVuY3Rpb24gZ2VuZXJhdGVUb3JzbygpIHsKCgkJCWNvbnN0IG5vcm1hbCA9IG5ldyBWZWN0b3IzKCk7CgkJCWNvbnN0IHZlcnRleCA9IG5ldyBWZWN0b3IzKCk7CgoJCQlsZXQgZ3JvdXBDb3VudCA9IDA7CgoJCQkvLyB0aGlzIHdpbGwgYmUgdXNlZCB0byBjYWxjdWxhdGUgdGhlIG5vcm1hbAoJCQljb25zdCBzbG9wZSA9ICggcmFkaXVzQm90dG9tIC0gcmFkaXVzVG9wICkgLyBoZWlnaHQ7CgoJCQkvLyBnZW5lcmF0ZSB2ZXJ0aWNlcywgbm9ybWFscyBhbmQgdXZzCgoJCQlmb3IgKCBsZXQgeSA9IDA7IHkgPD0gaGVpZ2h0U2VnbWVudHM7IHkgKysgKSB7CgoJCQkJY29uc3QgaW5kZXhSb3cgPSBbXTsKCgkJCQljb25zdCB2ID0geSAvIGhlaWdodFNlZ21lbnRzOwoKCQkJCS8vIGNhbGN1bGF0ZSB0aGUgcmFkaXVzIG9mIHRoZSBjdXJyZW50IHJvdwoKCQkJCWNvbnN0IHJhZGl1cyA9IHYgKiAoIHJhZGl1c0JvdHRvbSAtIHJhZGl1c1RvcCApICsgcmFkaXVzVG9wOwoKCQkJCWZvciAoIGxldCB4ID0gMDsgeCA8PSByYWRpYWxTZWdtZW50czsgeCArKyApIHsKCgkJCQkJY29uc3QgdSA9IHggLyByYWRpYWxTZWdtZW50czsKCgkJCQkJY29uc3QgdGhldGEgPSB1ICogdGhldGFMZW5ndGggKyB0aGV0YVN0YXJ0OwoKCQkJCQljb25zdCBzaW5UaGV0YSA9IE1hdGguc2luKCB0aGV0YSApOwoJCQkJCWNvbnN0IGNvc1RoZXRhID0gTWF0aC5jb3MoIHRoZXRhICk7CgoJCQkJCS8vIHZlcnRleAoKCQkJCQl2ZXJ0ZXgueCA9IHJhZGl1cyAqIHNpblRoZXRhOwoJCQkJCXZlcnRleC55ID0gLSB2ICogaGVpZ2h0ICsgaGFsZkhlaWdodDsKCQkJCQl2ZXJ0ZXgueiA9IHJhZGl1cyAqIGNvc1RoZXRhOwoJCQkJCXZlcnRpY2VzLnB1c2goIHZlcnRleC54LCB2ZXJ0ZXgueSwgdmVydGV4LnogKTsKCgkJCQkJLy8gbm9ybWFsCgoJCQkJCW5vcm1hbC5zZXQoIHNpblRoZXRhLCBzbG9wZSwgY29zVGhldGEgKS5ub3JtYWxpemUoKTsKCQkJCQlub3JtYWxzLnB1c2goIG5vcm1hbC54LCBub3JtYWwueSwgbm9ybWFsLnogKTsKCgkJCQkJLy8gdXYKCgkJCQkJdXZzLnB1c2goIHUsIDEgLSB2ICk7CgoJCQkJCS8vIHNhdmUgaW5kZXggb2YgdmVydGV4IGluIHJlc3BlY3RpdmUgcm93CgoJCQkJCWluZGV4Um93LnB1c2goIGluZGV4ICsrICk7CgoJCQkJfQoKCQkJCS8vIG5vdyBzYXZlIHZlcnRpY2VzIG9mIHRoZSByb3cgaW4gb3VyIGluZGV4IGFycmF5CgoJCQkJaW5kZXhBcnJheS5wdXNoKCBpbmRleFJvdyApOwoKCQkJfQoKCQkJLy8gZ2VuZXJhdGUgaW5kaWNlcwoKCQkJZm9yICggbGV0IHggPSAwOyB4IDwgcmFkaWFsU2VnbWVudHM7IHggKysgKSB7CgoJCQkJZm9yICggbGV0IHkgPSAwOyB5IDwgaGVpZ2h0U2VnbWVudHM7IHkgKysgKSB7CgoJCQkJCS8vIHdlIHVzZSB0aGUgaW5kZXggYXJyYXkgdG8gYWNjZXNzIHRoZSBjb3JyZWN0IGluZGljZXMKCgkJCQkJY29uc3QgYSA9IGluZGV4QXJyYXlbIHkgXVsgeCBdOwoJCQkJCWNvbnN0IGIgPSBpbmRleEFycmF5WyB5ICsgMSBdWyB4IF07CgkJCQkJY29uc3QgYyA9IGluZGV4QXJyYXlbIHkgKyAxIF1bIHggKyAxIF07CgkJCQkJY29uc3QgZCA9IGluZGV4QXJyYXlbIHkgXVsgeCArIDEgXTsKCgkJCQkJLy8gZmFjZXMKCgkJCQkJaW5kaWNlcy5wdXNoKCBhLCBiLCBkICk7CgkJCQkJaW5kaWNlcy5wdXNoKCBiLCBjLCBkICk7CgoJCQkJCS8vIHVwZGF0ZSBncm91cCBjb3VudGVyCgoJCQkJCWdyb3VwQ291bnQgKz0gNjsKCgkJCQl9CgoJCQl9CgoJCQkvLyBhZGQgYSBncm91cCB0byB0aGUgZ2VvbWV0cnkuIHRoaXMgd2lsbCBlbnN1cmUgbXVsdGkgbWF0ZXJpYWwgc3VwcG9ydAoKCQkJc2NvcGUuYWRkR3JvdXAoIGdyb3VwU3RhcnQsIGdyb3VwQ291bnQsIDAgKTsKCgkJCS8vIGNhbGN1bGF0ZSBuZXcgc3RhcnQgdmFsdWUgZm9yIGdyb3VwcwoKCQkJZ3JvdXBTdGFydCArPSBncm91cENvdW50OwoKCQl9CgoJCWZ1bmN0aW9uIGdlbmVyYXRlQ2FwKCB0b3AgKSB7CgoJCQkvLyBzYXZlIHRoZSBpbmRleCBvZiB0aGUgZmlyc3QgY2VudGVyIHZlcnRleAoJCQljb25zdCBjZW50ZXJJbmRleFN0YXJ0ID0gaW5kZXg7CgoJCQljb25zdCB1diA9IG5ldyBWZWN0b3IyKCk7CgkJCWNvbnN0IHZlcnRleCA9IG5ldyBWZWN0b3IzKCk7CgoJCQlsZXQgZ3JvdXBDb3VudCA9IDA7CgoJCQljb25zdCByYWRpdXMgPSAoIHRvcCA9PT0gdHJ1ZSApID8gcmFkaXVzVG9wIDogcmFkaXVzQm90dG9tOwoJCQljb25zdCBzaWduID0gKCB0b3AgPT09IHRydWUgKSA/IDEgOiAtIDE7CgoJCQkvLyBmaXJzdCB3ZSBnZW5lcmF0ZSB0aGUgY2VudGVyIHZlcnRleCBkYXRhIG9mIHRoZSBjYXAuCgkJCS8vIGJlY2F1c2UgdGhlIGdlb21ldHJ5IG5lZWRzIG9uZSBzZXQgb2YgdXZzIHBlciBmYWNlLAoJCQkvLyB3ZSBtdXN0IGdlbmVyYXRlIGEgY2VudGVyIHZlcnRleCBwZXIgZmFjZS9zZWdtZW50CgoJCQlmb3IgKCBsZXQgeCA9IDE7IHggPD0gcmFkaWFsU2VnbWVudHM7IHggKysgKSB7CgoJCQkJLy8gdmVydGV4CgoJCQkJdmVydGljZXMucHVzaCggMCwgaGFsZkhlaWdodCAqIHNpZ24sIDAgKTsKCgkJCQkvLyBub3JtYWwKCgkJCQlub3JtYWxzLnB1c2goIDAsIHNpZ24sIDAgKTsKCgkJCQkvLyB1dgoKCQkJCXV2cy5wdXNoKCAwLjUsIDAuNSApOwoKCQkJCS8vIGluY3JlYXNlIGluZGV4CgoJCQkJaW5kZXggKys7CgoJCQl9CgoJCQkvLyBzYXZlIHRoZSBpbmRleCBvZiB0aGUgbGFzdCBjZW50ZXIgdmVydGV4CgkJCWNvbnN0IGNlbnRlckluZGV4RW5kID0gaW5kZXg7CgoJCQkvLyBub3cgd2UgZ2VuZXJhdGUgdGhlIHN1cnJvdW5kaW5nIHZlcnRpY2VzLCBub3JtYWxzIGFuZCB1dnMKCgkJCWZvciAoIGxldCB4ID0gMDsgeCA8PSByYWRpYWxTZWdtZW50czsgeCArKyApIHsKCgkJCQljb25zdCB1ID0geCAvIHJhZGlhbFNlZ21lbnRzOwoJCQkJY29uc3QgdGhldGEgPSB1ICogdGhldGFMZW5ndGggKyB0aGV0YVN0YXJ0OwoKCQkJCWNvbnN0IGNvc1RoZXRhID0gTWF0aC5jb3MoIHRoZXRhICk7CgkJCQljb25zdCBzaW5UaGV0YSA9IE1hdGguc2luKCB0aGV0YSApOwoKCQkJCS8vIHZlcnRleAoKCQkJCXZlcnRleC54ID0gcmFkaXVzICogc2luVGhldGE7CgkJCQl2ZXJ0ZXgueSA9IGhhbGZIZWlnaHQgKiBzaWduOwoJCQkJdmVydGV4LnogPSByYWRpdXMgKiBjb3NUaGV0YTsKCQkJCXZlcnRpY2VzLnB1c2goIHZlcnRleC54LCB2ZXJ0ZXgueSwgdmVydGV4LnogKTsKCgkJCQkvLyBub3JtYWwKCgkJCQlub3JtYWxzLnB1c2goIDAsIHNpZ24sIDAgKTsKCgkJCQkvLyB1dgoKCQkJCXV2LnggPSAoIGNvc1RoZXRhICogMC41ICkgKyAwLjU7CgkJCQl1di55ID0gKCBzaW5UaGV0YSAqIDAuNSAqIHNpZ24gKSArIDAuNTsKCQkJCXV2cy5wdXNoKCB1di54LCB1di55ICk7CgoJCQkJLy8gaW5jcmVhc2UgaW5kZXgKCgkJCQlpbmRleCArKzsKCgkJCX0KCgkJCS8vIGdlbmVyYXRlIGluZGljZXMKCgkJCWZvciAoIGxldCB4ID0gMDsgeCA8IHJhZGlhbFNlZ21lbnRzOyB4ICsrICkgewoKCQkJCWNvbnN0IGMgPSBjZW50ZXJJbmRleFN0YXJ0ICsgeDsKCQkJCWNvbnN0IGkgPSBjZW50ZXJJbmRleEVuZCArIHg7CgoJCQkJaWYgKCB0b3AgPT09IHRydWUgKSB7CgoJCQkJCS8vIGZhY2UgdG9wCgoJCQkJCWluZGljZXMucHVzaCggaSwgaSArIDEsIGMgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQkvLyBmYWNlIGJvdHRvbQoKCQkJCQlpbmRpY2VzLnB1c2goIGkgKyAxLCBpLCBjICk7CgoJCQkJfQoKCQkJCWdyb3VwQ291bnQgKz0gMzsKCgkJCX0KCgkJCS8vIGFkZCBhIGdyb3VwIHRvIHRoZSBnZW9tZXRyeS4gdGhpcyB3aWxsIGVuc3VyZSBtdWx0aSBtYXRlcmlhbCBzdXBwb3J0CgoJCQlzY29wZS5hZGRHcm91cCggZ3JvdXBTdGFydCwgZ3JvdXBDb3VudCwgdG9wID09PSB0cnVlID8gMSA6IDIgKTsKCgkJCS8vIGNhbGN1bGF0ZSBuZXcgc3RhcnQgdmFsdWUgZm9yIGdyb3VwcwoKCQkJZ3JvdXBTdGFydCArPSBncm91cENvdW50OwoKCQl9CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMucGFyYW1ldGVycyA9IE9iamVjdC5hc3NpZ24oIHt9LCBzb3VyY2UucGFyYW1ldGVycyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc3RhdGljIGZyb21KU09OKCBkYXRhICkgewoKCQlyZXR1cm4gbmV3IEN5bGluZGVyR2VvbWV0cnkoIGRhdGEucmFkaXVzVG9wLCBkYXRhLnJhZGl1c0JvdHRvbSwgZGF0YS5oZWlnaHQsIGRhdGEucmFkaWFsU2VnbWVudHMsIGRhdGEuaGVpZ2h0U2VnbWVudHMsIGRhdGEub3BlbkVuZGVkLCBkYXRhLnRoZXRhU3RhcnQsIGRhdGEudGhldGFMZW5ndGggKTsKCgl9Cgp9CgpjbGFzcyBDb25lR2VvbWV0cnkgZXh0ZW5kcyBDeWxpbmRlckdlb21ldHJ5IHsKCgljb25zdHJ1Y3RvciggcmFkaXVzID0gMSwgaGVpZ2h0ID0gMSwgcmFkaWFsU2VnbWVudHMgPSAzMiwgaGVpZ2h0U2VnbWVudHMgPSAxLCBvcGVuRW5kZWQgPSBmYWxzZSwgdGhldGFTdGFydCA9IDAsIHRoZXRhTGVuZ3RoID0gTWF0aC5QSSAqIDIgKSB7CgoJCXN1cGVyKCAwLCByYWRpdXMsIGhlaWdodCwgcmFkaWFsU2VnbWVudHMsIGhlaWdodFNlZ21lbnRzLCBvcGVuRW5kZWQsIHRoZXRhU3RhcnQsIHRoZXRhTGVuZ3RoICk7CgoJCXRoaXMudHlwZSA9ICdDb25lR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXJhZGl1czogcmFkaXVzLAoJCQloZWlnaHQ6IGhlaWdodCwKCQkJcmFkaWFsU2VnbWVudHM6IHJhZGlhbFNlZ21lbnRzLAoJCQloZWlnaHRTZWdtZW50czogaGVpZ2h0U2VnbWVudHMsCgkJCW9wZW5FbmRlZDogb3BlbkVuZGVkLAoJCQl0aGV0YVN0YXJ0OiB0aGV0YVN0YXJ0LAoJCQl0aGV0YUxlbmd0aDogdGhldGFMZW5ndGgKCQl9OwoKCX0KCglzdGF0aWMgZnJvbUpTT04oIGRhdGEgKSB7CgoJCXJldHVybiBuZXcgQ29uZUdlb21ldHJ5KCBkYXRhLnJhZGl1cywgZGF0YS5oZWlnaHQsIGRhdGEucmFkaWFsU2VnbWVudHMsIGRhdGEuaGVpZ2h0U2VnbWVudHMsIGRhdGEub3BlbkVuZGVkLCBkYXRhLnRoZXRhU3RhcnQsIGRhdGEudGhldGFMZW5ndGggKTsKCgl9Cgp9CgpjbGFzcyBQb2x5aGVkcm9uR2VvbWV0cnkgZXh0ZW5kcyBCdWZmZXJHZW9tZXRyeSB7CgoJY29uc3RydWN0b3IoIHZlcnRpY2VzID0gW10sIGluZGljZXMgPSBbXSwgcmFkaXVzID0gMSwgZGV0YWlsID0gMCApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy50eXBlID0gJ1BvbHloZWRyb25HZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJdmVydGljZXM6IHZlcnRpY2VzLAoJCQlpbmRpY2VzOiBpbmRpY2VzLAoJCQlyYWRpdXM6IHJhZGl1cywKCQkJZGV0YWlsOiBkZXRhaWwKCQl9OwoKCQkvLyBkZWZhdWx0IGJ1ZmZlciBkYXRhCgoJCWNvbnN0IHZlcnRleEJ1ZmZlciA9IFtdOwoJCWNvbnN0IHV2QnVmZmVyID0gW107CgoJCS8vIHRoZSBzdWJkaXZpc2lvbiBjcmVhdGVzIHRoZSB2ZXJ0ZXggYnVmZmVyIGRhdGEKCgkJc3ViZGl2aWRlKCBkZXRhaWwgKTsKCgkJLy8gYWxsIHZlcnRpY2VzIHNob3VsZCBsaWUgb24gYSBjb25jZXB0dWFsIHNwaGVyZSB3aXRoIGEgZ2l2ZW4gcmFkaXVzCgoJCWFwcGx5UmFkaXVzKCByYWRpdXMgKTsKCgkJLy8gZmluYWxseSwgY3JlYXRlIHRoZSB1diBkYXRhCgoJCWdlbmVyYXRlVVZzKCk7CgoJCS8vIGJ1aWxkIG5vbi1pbmRleGVkIGdlb21ldHJ5CgoJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGV4QnVmZmVyLCAzICkgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0ZXhCdWZmZXIuc2xpY2UoKSwgMyApICk7CgkJdGhpcy5zZXRBdHRyaWJ1dGUoICd1dicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB1dkJ1ZmZlciwgMiApICk7CgoJCWlmICggZGV0YWlsID09PSAwICkgewoKCQkJdGhpcy5jb21wdXRlVmVydGV4Tm9ybWFscygpOyAvLyBmbGF0IG5vcm1hbHMKCgkJfSBlbHNlIHsKCgkJCXRoaXMubm9ybWFsaXplTm9ybWFscygpOyAvLyBzbW9vdGggbm9ybWFscwoKCQl9CgoJCS8vIGhlbHBlciBmdW5jdGlvbnMKCgkJZnVuY3Rpb24gc3ViZGl2aWRlKCBkZXRhaWwgKSB7CgoJCQljb25zdCBhID0gbmV3IFZlY3RvcjMoKTsKCQkJY29uc3QgYiA9IG5ldyBWZWN0b3IzKCk7CgkJCWNvbnN0IGMgPSBuZXcgVmVjdG9yMygpOwoKCQkJLy8gaXRlcmF0ZSBvdmVyIGFsbCBmYWNlcyBhbmQgYXBwbHkgYSBzdWJkaXZpc2lvbiB3aXRoIHRoZSBnaXZlbiBkZXRhaWwgdmFsdWUKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IGluZGljZXMubGVuZ3RoOyBpICs9IDMgKSB7CgoJCQkJLy8gZ2V0IHRoZSB2ZXJ0aWNlcyBvZiB0aGUgZmFjZQoKCQkJCWdldFZlcnRleEJ5SW5kZXgoIGluZGljZXNbIGkgKyAwIF0sIGEgKTsKCQkJCWdldFZlcnRleEJ5SW5kZXgoIGluZGljZXNbIGkgKyAxIF0sIGIgKTsKCQkJCWdldFZlcnRleEJ5SW5kZXgoIGluZGljZXNbIGkgKyAyIF0sIGMgKTsKCgkJCQkvLyBwZXJmb3JtIHN1YmRpdmlzaW9uCgoJCQkJc3ViZGl2aWRlRmFjZSggYSwgYiwgYywgZGV0YWlsICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gc3ViZGl2aWRlRmFjZSggYSwgYiwgYywgZGV0YWlsICkgewoKCQkJY29uc3QgY29scyA9IGRldGFpbCArIDE7CgoJCQkvLyB3ZSB1c2UgdGhpcyBtdWx0aWRpbWVuc2lvbmFsIGFycmF5IGFzIGEgZGF0YSBzdHJ1Y3R1cmUgZm9yIGNyZWF0aW5nIHRoZSBzdWJkaXZpc2lvbgoKCQkJY29uc3QgdiA9IFtdOwoKCQkJLy8gY29uc3RydWN0IGFsbCBvZiB0aGUgdmVydGljZXMgZm9yIHRoaXMgc3ViZGl2aXNpb24KCgkJCWZvciAoIGxldCBpID0gMDsgaSA8PSBjb2xzOyBpICsrICkgewoKCQkJCXZbIGkgXSA9IFtdOwoKCQkJCWNvbnN0IGFqID0gYS5jbG9uZSgpLmxlcnAoIGMsIGkgLyBjb2xzICk7CgkJCQljb25zdCBiaiA9IGIuY2xvbmUoKS5sZXJwKCBjLCBpIC8gY29scyApOwoKCQkJCWNvbnN0IHJvd3MgPSBjb2xzIC0gaTsKCgkJCQlmb3IgKCBsZXQgaiA9IDA7IGogPD0gcm93czsgaiArKyApIHsKCgkJCQkJaWYgKCBqID09PSAwICYmIGkgPT09IGNvbHMgKSB7CgoJCQkJCQl2WyBpIF1bIGogXSA9IGFqOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdlsgaSBdWyBqIF0gPSBhai5jbG9uZSgpLmxlcnAoIGJqLCBqIC8gcm93cyApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJLy8gY29uc3RydWN0IGFsbCBvZiB0aGUgZmFjZXMKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IGNvbHM7IGkgKysgKSB7CgoJCQkJZm9yICggbGV0IGogPSAwOyBqIDwgMiAqICggY29scyAtIGkgKSAtIDE7IGogKysgKSB7CgoJCQkJCWNvbnN0IGsgPSBNYXRoLmZsb29yKCBqIC8gMiApOwoKCQkJCQlpZiAoIGogJSAyID09PSAwICkgewoKCQkJCQkJcHVzaFZlcnRleCggdlsgaSBdWyBrICsgMSBdICk7CgkJCQkJCXB1c2hWZXJ0ZXgoIHZbIGkgKyAxIF1bIGsgXSApOwoJCQkJCQlwdXNoVmVydGV4KCB2WyBpIF1bIGsgXSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJcHVzaFZlcnRleCggdlsgaSBdWyBrICsgMSBdICk7CgkJCQkJCXB1c2hWZXJ0ZXgoIHZbIGkgKyAxIF1bIGsgKyAxIF0gKTsKCQkJCQkJcHVzaFZlcnRleCggdlsgaSArIDEgXVsgayBdICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gYXBwbHlSYWRpdXMoIHJhZGl1cyApIHsKCgkJCWNvbnN0IHZlcnRleCA9IG5ldyBWZWN0b3IzKCk7CgoJCQkvLyBpdGVyYXRlIG92ZXIgdGhlIGVudGlyZSBidWZmZXIgYW5kIGFwcGx5IHRoZSByYWRpdXMgdG8gZWFjaCB2ZXJ0ZXgKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IHZlcnRleEJ1ZmZlci5sZW5ndGg7IGkgKz0gMyApIHsKCgkJCQl2ZXJ0ZXgueCA9IHZlcnRleEJ1ZmZlclsgaSArIDAgXTsKCQkJCXZlcnRleC55ID0gdmVydGV4QnVmZmVyWyBpICsgMSBdOwoJCQkJdmVydGV4LnogPSB2ZXJ0ZXhCdWZmZXJbIGkgKyAyIF07CgoJCQkJdmVydGV4Lm5vcm1hbGl6ZSgpLm11bHRpcGx5U2NhbGFyKCByYWRpdXMgKTsKCgkJCQl2ZXJ0ZXhCdWZmZXJbIGkgKyAwIF0gPSB2ZXJ0ZXgueDsKCQkJCXZlcnRleEJ1ZmZlclsgaSArIDEgXSA9IHZlcnRleC55OwoJCQkJdmVydGV4QnVmZmVyWyBpICsgMiBdID0gdmVydGV4Lno7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gZ2VuZXJhdGVVVnMoKSB7CgoJCQljb25zdCB2ZXJ0ZXggPSBuZXcgVmVjdG9yMygpOwoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdmVydGV4QnVmZmVyLmxlbmd0aDsgaSArPSAzICkgewoKCQkJCXZlcnRleC54ID0gdmVydGV4QnVmZmVyWyBpICsgMCBdOwoJCQkJdmVydGV4LnkgPSB2ZXJ0ZXhCdWZmZXJbIGkgKyAxIF07CgkJCQl2ZXJ0ZXgueiA9IHZlcnRleEJ1ZmZlclsgaSArIDIgXTsKCgkJCQljb25zdCB1ID0gYXppbXV0aCggdmVydGV4ICkgLyAyIC8gTWF0aC5QSSArIDAuNTsKCQkJCWNvbnN0IHYgPSBpbmNsaW5hdGlvbiggdmVydGV4ICkgLyBNYXRoLlBJICsgMC41OwoJCQkJdXZCdWZmZXIucHVzaCggdSwgMSAtIHYgKTsKCgkJCX0KCgkJCWNvcnJlY3RVVnMoKTsKCgkJCWNvcnJlY3RTZWFtKCk7CgoJCX0KCgkJZnVuY3Rpb24gY29ycmVjdFNlYW0oKSB7CgoJCQkvLyBoYW5kbGUgY2FzZSB3aGVuIGZhY2Ugc3RyYWRkbGVzIHRoZSBzZWFtLCBzZWUgIzMyNjkKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IHV2QnVmZmVyLmxlbmd0aDsgaSArPSA2ICkgewoKCQkJCS8vIHV2IGRhdGEgb2YgYSBzaW5nbGUgZmFjZQoKCQkJCWNvbnN0IHgwID0gdXZCdWZmZXJbIGkgKyAwIF07CgkJCQljb25zdCB4MSA9IHV2QnVmZmVyWyBpICsgMiBdOwoJCQkJY29uc3QgeDIgPSB1dkJ1ZmZlclsgaSArIDQgXTsKCgkJCQljb25zdCBtYXggPSBNYXRoLm1heCggeDAsIHgxLCB4MiApOwoJCQkJY29uc3QgbWluID0gTWF0aC5taW4oIHgwLCB4MSwgeDIgKTsKCgkJCQkvLyAwLjkgaXMgc29tZXdoYXQgYXJiaXRyYXJ5CgoJCQkJaWYgKCBtYXggPiAwLjkgJiYgbWluIDwgMC4xICkgewoKCQkJCQlpZiAoIHgwIDwgMC4yICkgdXZCdWZmZXJbIGkgKyAwIF0gKz0gMTsKCQkJCQlpZiAoIHgxIDwgMC4yICkgdXZCdWZmZXJbIGkgKyAyIF0gKz0gMTsKCQkJCQlpZiAoIHgyIDwgMC4yICkgdXZCdWZmZXJbIGkgKyA0IF0gKz0gMTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gcHVzaFZlcnRleCggdmVydGV4ICkgewoKCQkJdmVydGV4QnVmZmVyLnB1c2goIHZlcnRleC54LCB2ZXJ0ZXgueSwgdmVydGV4LnogKTsKCgkJfQoKCQlmdW5jdGlvbiBnZXRWZXJ0ZXhCeUluZGV4KCBpbmRleCwgdmVydGV4ICkgewoKCQkJY29uc3Qgc3RyaWRlID0gaW5kZXggKiAzOwoKCQkJdmVydGV4LnggPSB2ZXJ0aWNlc1sgc3RyaWRlICsgMCBdOwoJCQl2ZXJ0ZXgueSA9IHZlcnRpY2VzWyBzdHJpZGUgKyAxIF07CgkJCXZlcnRleC56ID0gdmVydGljZXNbIHN0cmlkZSArIDIgXTsKCgkJfQoKCQlmdW5jdGlvbiBjb3JyZWN0VVZzKCkgewoKCQkJY29uc3QgYSA9IG5ldyBWZWN0b3IzKCk7CgkJCWNvbnN0IGIgPSBuZXcgVmVjdG9yMygpOwoJCQljb25zdCBjID0gbmV3IFZlY3RvcjMoKTsKCgkJCWNvbnN0IGNlbnRyb2lkID0gbmV3IFZlY3RvcjMoKTsKCgkJCWNvbnN0IHV2QSA9IG5ldyBWZWN0b3IyKCk7CgkJCWNvbnN0IHV2QiA9IG5ldyBWZWN0b3IyKCk7CgkJCWNvbnN0IHV2QyA9IG5ldyBWZWN0b3IyKCk7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGogPSAwOyBpIDwgdmVydGV4QnVmZmVyLmxlbmd0aDsgaSArPSA5LCBqICs9IDYgKSB7CgoJCQkJYS5zZXQoIHZlcnRleEJ1ZmZlclsgaSArIDAgXSwgdmVydGV4QnVmZmVyWyBpICsgMSBdLCB2ZXJ0ZXhCdWZmZXJbIGkgKyAyIF0gKTsKCQkJCWIuc2V0KCB2ZXJ0ZXhCdWZmZXJbIGkgKyAzIF0sIHZlcnRleEJ1ZmZlclsgaSArIDQgXSwgdmVydGV4QnVmZmVyWyBpICsgNSBdICk7CgkJCQljLnNldCggdmVydGV4QnVmZmVyWyBpICsgNiBdLCB2ZXJ0ZXhCdWZmZXJbIGkgKyA3IF0sIHZlcnRleEJ1ZmZlclsgaSArIDggXSApOwoKCQkJCXV2QS5zZXQoIHV2QnVmZmVyWyBqICsgMCBdLCB1dkJ1ZmZlclsgaiArIDEgXSApOwoJCQkJdXZCLnNldCggdXZCdWZmZXJbIGogKyAyIF0sIHV2QnVmZmVyWyBqICsgMyBdICk7CgkJCQl1dkMuc2V0KCB1dkJ1ZmZlclsgaiArIDQgXSwgdXZCdWZmZXJbIGogKyA1IF0gKTsKCgkJCQljZW50cm9pZC5jb3B5KCBhICkuYWRkKCBiICkuYWRkKCBjICkuZGl2aWRlU2NhbGFyKCAzICk7CgoJCQkJY29uc3QgYXppID0gYXppbXV0aCggY2VudHJvaWQgKTsKCgkJCQljb3JyZWN0VVYoIHV2QSwgaiArIDAsIGEsIGF6aSApOwoJCQkJY29ycmVjdFVWKCB1dkIsIGogKyAyLCBiLCBhemkgKTsKCQkJCWNvcnJlY3RVViggdXZDLCBqICsgNCwgYywgYXppICk7CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gY29ycmVjdFVWKCB1diwgc3RyaWRlLCB2ZWN0b3IsIGF6aW11dGggKSB7CgoJCQlpZiAoICggYXppbXV0aCA8IDAgKSAmJiAoIHV2LnggPT09IDEgKSApIHsKCgkJCQl1dkJ1ZmZlclsgc3RyaWRlIF0gPSB1di54IC0gMTsKCgkJCX0KCgkJCWlmICggKCB2ZWN0b3IueCA9PT0gMCApICYmICggdmVjdG9yLnogPT09IDAgKSApIHsKCgkJCQl1dkJ1ZmZlclsgc3RyaWRlIF0gPSBhemltdXRoIC8gMiAvIE1hdGguUEkgKyAwLjU7CgoJCQl9CgoJCX0KCgkJLy8gQW5nbGUgYXJvdW5kIHRoZSBZIGF4aXMsIGNvdW50ZXItY2xvY2t3aXNlIHdoZW4gbG9va2luZyBmcm9tIGFib3ZlLgoKCQlmdW5jdGlvbiBhemltdXRoKCB2ZWN0b3IgKSB7CgoJCQlyZXR1cm4gTWF0aC5hdGFuMiggdmVjdG9yLnosIC0gdmVjdG9yLnggKTsKCgkJfQoKCgkJLy8gQW5nbGUgYWJvdmUgdGhlIFhaIHBsYW5lLgoKCQlmdW5jdGlvbiBpbmNsaW5hdGlvbiggdmVjdG9yICkgewoKCQkJcmV0dXJuIE1hdGguYXRhbjIoIC0gdmVjdG9yLnksIE1hdGguc3FydCggKCB2ZWN0b3IueCAqIHZlY3Rvci54ICkgKyAoIHZlY3Rvci56ICogdmVjdG9yLnogKSApICk7CgoJCX0KCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5wYXJhbWV0ZXJzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzdGF0aWMgZnJvbUpTT04oIGRhdGEgKSB7CgoJCXJldHVybiBuZXcgUG9seWhlZHJvbkdlb21ldHJ5KCBkYXRhLnZlcnRpY2VzLCBkYXRhLmluZGljZXMsIGRhdGEucmFkaXVzLCBkYXRhLmRldGFpbHMgKTsKCgl9Cgp9CgpjbGFzcyBEb2RlY2FoZWRyb25HZW9tZXRyeSBleHRlbmRzIFBvbHloZWRyb25HZW9tZXRyeSB7CgoJY29uc3RydWN0b3IoIHJhZGl1cyA9IDEsIGRldGFpbCA9IDAgKSB7CgoJCWNvbnN0IHQgPSAoIDEgKyBNYXRoLnNxcnQoIDUgKSApIC8gMjsKCQljb25zdCByID0gMSAvIHQ7CgoJCWNvbnN0IHZlcnRpY2VzID0gWwoKCQkJLy8gKMKxMSwgwrExLCDCsTEpCgkJCS0gMSwgLSAxLCAtIDEsCS0gMSwgLSAxLCAxLAoJCQktIDEsIDEsIC0gMSwgLSAxLCAxLCAxLAoJCQkxLCAtIDEsIC0gMSwgMSwgLSAxLCAxLAoJCQkxLCAxLCAtIDEsIDEsIDEsIDEsCgoJCQkvLyAoMCwgwrExL8+GLCDCsc+GKQoJCQkwLCAtIHIsIC0gdCwgMCwgLSByLCB0LAoJCQkwLCByLCAtIHQsIDAsIHIsIHQsCgoJCQkvLyAowrExL8+GLCDCsc+GLCAwKQoJCQktIHIsIC0gdCwgMCwgLSByLCB0LCAwLAoJCQlyLCAtIHQsIDAsIHIsIHQsIDAsCgoJCQkvLyAowrHPhiwgMCwgwrExL8+GKQoJCQktIHQsIDAsIC0gciwgdCwgMCwgLSByLAoJCQktIHQsIDAsIHIsIHQsIDAsIHIKCQldOwoKCQljb25zdCBpbmRpY2VzID0gWwoJCQkzLCAxMSwgNywgCTMsIDcsIDE1LCAJMywgMTUsIDEzLAoJCQk3LCAxOSwgMTcsIAk3LCAxNywgNiwgCTcsIDYsIDE1LAoJCQkxNywgNCwgOCwgCTE3LCA4LCAxMCwgCTE3LCAxMCwgNiwKCQkJOCwgMCwgMTYsIAk4LCAxNiwgMiwgCTgsIDIsIDEwLAoJCQkwLCAxMiwgMSwgCTAsIDEsIDE4LCAJMCwgMTgsIDE2LAoJCQk2LCAxMCwgMiwgCTYsIDIsIDEzLCAJNiwgMTMsIDE1LAoJCQkyLCAxNiwgMTgsIAkyLCAxOCwgMywgCTIsIDMsIDEzLAoJCQkxOCwgMSwgOSwgCTE4LCA5LCAxMSwgCTE4LCAxMSwgMywKCQkJNCwgMTQsIDEyLCAJNCwgMTIsIDAsIAk0LCAwLCA4LAoJCQkxMSwgOSwgNSwgCTExLCA1LCAxOSwgCTExLCAxOSwgNywKCQkJMTksIDUsIDE0LCAJMTksIDE0LCA0LCAJMTksIDQsIDE3LAoJCQkxLCAxMiwgMTQsIAkxLCAxNCwgNSwgCTEsIDUsIDkKCQldOwoKCQlzdXBlciggdmVydGljZXMsIGluZGljZXMsIHJhZGl1cywgZGV0YWlsICk7CgoJCXRoaXMudHlwZSA9ICdEb2RlY2FoZWRyb25HZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJcmFkaXVzOiByYWRpdXMsCgkJCWRldGFpbDogZGV0YWlsCgkJfTsKCgl9CgoJc3RhdGljIGZyb21KU09OKCBkYXRhICkgewoKCQlyZXR1cm4gbmV3IERvZGVjYWhlZHJvbkdlb21ldHJ5KCBkYXRhLnJhZGl1cywgZGF0YS5kZXRhaWwgKTsKCgl9Cgp9Cgpjb25zdCBfdjAgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF92MSQxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfbm9ybWFsID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfdHJpYW5nbGUgPSAvKkBfX1BVUkVfXyovIG5ldyBUcmlhbmdsZSgpOwoKY2xhc3MgRWRnZXNHZW9tZXRyeSBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKCgljb25zdHJ1Y3RvciggZ2VvbWV0cnkgPSBudWxsLCB0aHJlc2hvbGRBbmdsZSA9IDEgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMudHlwZSA9ICdFZGdlc0dlb21ldHJ5JzsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gewoJCQlnZW9tZXRyeTogZ2VvbWV0cnksCgkJCXRocmVzaG9sZEFuZ2xlOiB0aHJlc2hvbGRBbmdsZQoJCX07CgoJCWlmICggZ2VvbWV0cnkgIT09IG51bGwgKSB7CgoJCQljb25zdCBwcmVjaXNpb25Qb2ludHMgPSA0OwoJCQljb25zdCBwcmVjaXNpb24gPSBNYXRoLnBvdyggMTAsIHByZWNpc2lvblBvaW50cyApOwoJCQljb25zdCB0aHJlc2hvbGREb3QgPSBNYXRoLmNvcyggREVHMlJBRCAqIHRocmVzaG9sZEFuZ2xlICk7CgoJCQljb25zdCBpbmRleEF0dHIgPSBnZW9tZXRyeS5nZXRJbmRleCgpOwoJCQljb25zdCBwb3NpdGlvbkF0dHIgPSBnZW9tZXRyeS5nZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicgKTsKCQkJY29uc3QgaW5kZXhDb3VudCA9IGluZGV4QXR0ciA/IGluZGV4QXR0ci5jb3VudCA6IHBvc2l0aW9uQXR0ci5jb3VudDsKCgkJCWNvbnN0IGluZGV4QXJyID0gWyAwLCAwLCAwIF07CgkJCWNvbnN0IHZlcnRLZXlzID0gWyAnYScsICdiJywgJ2MnIF07CgkJCWNvbnN0IGhhc2hlcyA9IG5ldyBBcnJheSggMyApOwoKCQkJY29uc3QgZWRnZURhdGEgPSB7fTsKCQkJY29uc3QgdmVydGljZXMgPSBbXTsKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgaW5kZXhDb3VudDsgaSArPSAzICkgewoKCQkJCWlmICggaW5kZXhBdHRyICkgewoKCQkJCQlpbmRleEFyclsgMCBdID0gaW5kZXhBdHRyLmdldFgoIGkgKTsKCQkJCQlpbmRleEFyclsgMSBdID0gaW5kZXhBdHRyLmdldFgoIGkgKyAxICk7CgkJCQkJaW5kZXhBcnJbIDIgXSA9IGluZGV4QXR0ci5nZXRYKCBpICsgMiApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWluZGV4QXJyWyAwIF0gPSBpOwoJCQkJCWluZGV4QXJyWyAxIF0gPSBpICsgMTsKCQkJCQlpbmRleEFyclsgMiBdID0gaSArIDI7CgoJCQkJfQoKCQkJCWNvbnN0IHsgYSwgYiwgYyB9ID0gX3RyaWFuZ2xlOwoJCQkJYS5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHIsIGluZGV4QXJyWyAwIF0gKTsKCQkJCWIuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25BdHRyLCBpbmRleEFyclsgMSBdICk7CgkJCQljLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0ciwgaW5kZXhBcnJbIDIgXSApOwoJCQkJX3RyaWFuZ2xlLmdldE5vcm1hbCggX25vcm1hbCApOwoKCQkJCS8vIGNyZWF0ZSBoYXNoZXMgZm9yIHRoZSBlZGdlIGZyb20gdGhlIHZlcnRpY2VzCgkJCQloYXNoZXNbIDAgXSA9IGAkeyBNYXRoLnJvdW5kKCBhLnggKiBwcmVjaXNpb24gKSB9LCR7IE1hdGgucm91bmQoIGEueSAqIHByZWNpc2lvbiApIH0sJHsgTWF0aC5yb3VuZCggYS56ICogcHJlY2lzaW9uICkgfWA7CgkJCQloYXNoZXNbIDEgXSA9IGAkeyBNYXRoLnJvdW5kKCBiLnggKiBwcmVjaXNpb24gKSB9LCR7IE1hdGgucm91bmQoIGIueSAqIHByZWNpc2lvbiApIH0sJHsgTWF0aC5yb3VuZCggYi56ICogcHJlY2lzaW9uICkgfWA7CgkJCQloYXNoZXNbIDIgXSA9IGAkeyBNYXRoLnJvdW5kKCBjLnggKiBwcmVjaXNpb24gKSB9LCR7IE1hdGgucm91bmQoIGMueSAqIHByZWNpc2lvbiApIH0sJHsgTWF0aC5yb3VuZCggYy56ICogcHJlY2lzaW9uICkgfWA7CgoJCQkJLy8gc2tpcCBkZWdlbmVyYXRlIHRyaWFuZ2xlcwoJCQkJaWYgKCBoYXNoZXNbIDAgXSA9PT0gaGFzaGVzWyAxIF0gfHwgaGFzaGVzWyAxIF0gPT09IGhhc2hlc1sgMiBdIHx8IGhhc2hlc1sgMiBdID09PSBoYXNoZXNbIDAgXSApIHsKCgkJCQkJY29udGludWU7CgoJCQkJfQoKCQkJCS8vIGl0ZXJhdGUgb3ZlciBldmVyeSBlZGdlCgkJCQlmb3IgKCBsZXQgaiA9IDA7IGogPCAzOyBqICsrICkgewoKCQkJCQkvLyBnZXQgdGhlIGZpcnN0IGFuZCBuZXh0IHZlcnRleCBtYWtpbmcgdXAgdGhlIGVkZ2UKCQkJCQljb25zdCBqTmV4dCA9ICggaiArIDEgKSAlIDM7CgkJCQkJY29uc3QgdmVjSGFzaDAgPSBoYXNoZXNbIGogXTsKCQkJCQljb25zdCB2ZWNIYXNoMSA9IGhhc2hlc1sgak5leHQgXTsKCQkJCQljb25zdCB2MCA9IF90cmlhbmdsZVsgdmVydEtleXNbIGogXSBdOwoJCQkJCWNvbnN0IHYxID0gX3RyaWFuZ2xlWyB2ZXJ0S2V5c1sgak5leHQgXSBdOwoKCQkJCQljb25zdCBoYXNoID0gYCR7IHZlY0hhc2gwIH1fJHsgdmVjSGFzaDEgfWA7CgkJCQkJY29uc3QgcmV2ZXJzZUhhc2ggPSBgJHsgdmVjSGFzaDEgfV8keyB2ZWNIYXNoMCB9YDsKCgkJCQkJaWYgKCByZXZlcnNlSGFzaCBpbiBlZGdlRGF0YSAmJiBlZGdlRGF0YVsgcmV2ZXJzZUhhc2ggXSApIHsKCgkJCQkJCS8vIGlmIHdlIGZvdW5kIGEgc2libGluZyBlZGdlIGFkZCBpdCBpbnRvIHRoZSB2ZXJ0ZXggYXJyYXkgaWYKCQkJCQkJLy8gaXQgbWVldHMgdGhlIGFuZ2xlIHRocmVzaG9sZCBhbmQgZGVsZXRlIHRoZSBlZGdlIGZyb20gdGhlIG1hcC4KCQkJCQkJaWYgKCBfbm9ybWFsLmRvdCggZWRnZURhdGFbIHJldmVyc2VIYXNoIF0ubm9ybWFsICkgPD0gdGhyZXNob2xkRG90ICkgewoKCQkJCQkJCXZlcnRpY2VzLnB1c2goIHYwLngsIHYwLnksIHYwLnogKTsKCQkJCQkJCXZlcnRpY2VzLnB1c2goIHYxLngsIHYxLnksIHYxLnogKTsKCgkJCQkJCX0KCgkJCQkJCWVkZ2VEYXRhWyByZXZlcnNlSGFzaCBdID0gbnVsbDsKCgkJCQkJfSBlbHNlIGlmICggISAoIGhhc2ggaW4gZWRnZURhdGEgKSApIHsKCgkJCQkJCS8vIGlmIHdlJ3ZlIGFscmVhZHkgZ290IGFuIGVkZ2UgaGVyZSB0aGVuIHNraXAgYWRkaW5nIGEgbmV3IG9uZQoJCQkJCQllZGdlRGF0YVsgaGFzaCBdID0gewoKCQkJCQkJCWluZGV4MDogaW5kZXhBcnJbIGogXSwKCQkJCQkJCWluZGV4MTogaW5kZXhBcnJbIGpOZXh0IF0sCgkJCQkJCQlub3JtYWw6IF9ub3JtYWwuY2xvbmUoKSwKCgkJCQkJCX07CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQkvLyBpdGVyYXRlIG92ZXIgYWxsIHJlbWFpbmluZywgdW5tYXRjaGVkIGVkZ2VzIGFuZCBhZGQgdGhlbSB0byB0aGUgdmVydGV4IGFycmF5CgkJCWZvciAoIGNvbnN0IGtleSBpbiBlZGdlRGF0YSApIHsKCgkJCQlpZiAoIGVkZ2VEYXRhWyBrZXkgXSApIHsKCgkJCQkJY29uc3QgeyBpbmRleDAsIGluZGV4MSB9ID0gZWRnZURhdGFbIGtleSBdOwoJCQkJCV92MC5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbkF0dHIsIGluZGV4MCApOwoJCQkJCV92MSQxLmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uQXR0ciwgaW5kZXgxICk7CgoJCQkJCXZlcnRpY2VzLnB1c2goIF92MC54LCBfdjAueSwgX3YwLnogKTsKCQkJCQl2ZXJ0aWNlcy5wdXNoKCBfdjEkMS54LCBfdjEkMS55LCBfdjEkMS56ICk7CgoJCQkJfQoKCQkJfQoKCQkJdGhpcy5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlcywgMyApICk7CgoJCX0KCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5wYXJhbWV0ZXJzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNsYXNzIFNoYXBlIGV4dGVuZHMgUGF0aCB7CgoJY29uc3RydWN0b3IoIHBvaW50cyApIHsKCgkJc3VwZXIoIHBvaW50cyApOwoKCQl0aGlzLnV1aWQgPSBnZW5lcmF0ZVVVSUQoKTsKCgkJdGhpcy50eXBlID0gJ1NoYXBlJzsKCgkJdGhpcy5ob2xlcyA9IFtdOwoKCX0KCglnZXRQb2ludHNIb2xlcyggZGl2aXNpb25zICkgewoKCQljb25zdCBob2xlc1B0cyA9IFtdOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB0aGlzLmhvbGVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQlob2xlc1B0c1sgaSBdID0gdGhpcy5ob2xlc1sgaSBdLmdldFBvaW50cyggZGl2aXNpb25zICk7CgoJCX0KCgkJcmV0dXJuIGhvbGVzUHRzOwoKCX0KCgkvLyBnZXQgcG9pbnRzIG9mIHNoYXBlIGFuZCBob2xlcyAoa2V5cG9pbnRzIGJhc2VkIG9uIHNlZ21lbnRzIHBhcmFtZXRlcikKCglleHRyYWN0UG9pbnRzKCBkaXZpc2lvbnMgKSB7CgoJCXJldHVybiB7CgoJCQlzaGFwZTogdGhpcy5nZXRQb2ludHMoIGRpdmlzaW9ucyApLAoJCQlob2xlczogdGhpcy5nZXRQb2ludHNIb2xlcyggZGl2aXNpb25zICkKCgkJfTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5ob2xlcyA9IFtdOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBzb3VyY2UuaG9sZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IGhvbGUgPSBzb3VyY2UuaG9sZXNbIGkgXTsKCgkJCXRoaXMuaG9sZXMucHVzaCggaG9sZS5jbG9uZSgpICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTigpIHsKCgkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTigpOwoKCQlkYXRhLnV1aWQgPSB0aGlzLnV1aWQ7CgkJZGF0YS5ob2xlcyA9IFtdOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB0aGlzLmhvbGVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQljb25zdCBob2xlID0gdGhpcy5ob2xlc1sgaSBdOwoJCQlkYXRhLmhvbGVzLnB1c2goIGhvbGUudG9KU09OKCkgKTsKCgkJfQoKCQlyZXR1cm4gZGF0YTsKCgl9CgoJZnJvbUpTT04oIGpzb24gKSB7CgoJCXN1cGVyLmZyb21KU09OKCBqc29uICk7CgoJCXRoaXMudXVpZCA9IGpzb24udXVpZDsKCQl0aGlzLmhvbGVzID0gW107CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IGpzb24uaG9sZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWNvbnN0IGhvbGUgPSBqc29uLmhvbGVzWyBpIF07CgkJCXRoaXMuaG9sZXMucHVzaCggbmV3IFBhdGgoKS5mcm9tSlNPTiggaG9sZSApICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKLyoqCiAqIFBvcnQgZnJvbSBodHRwczovL2dpdGh1Yi5jb20vbWFwYm94L2VhcmN1dCAodjIuMi40KQogKi8KCmNvbnN0IEVhcmN1dCA9IHsKCgl0cmlhbmd1bGF0ZTogZnVuY3Rpb24gKCBkYXRhLCBob2xlSW5kaWNlcywgZGltID0gMiApIHsKCgkJY29uc3QgaGFzSG9sZXMgPSBob2xlSW5kaWNlcyAmJiBob2xlSW5kaWNlcy5sZW5ndGg7CgkJY29uc3Qgb3V0ZXJMZW4gPSBoYXNIb2xlcyA/IGhvbGVJbmRpY2VzWyAwIF0gKiBkaW0gOiBkYXRhLmxlbmd0aDsKCQlsZXQgb3V0ZXJOb2RlID0gbGlua2VkTGlzdCggZGF0YSwgMCwgb3V0ZXJMZW4sIGRpbSwgdHJ1ZSApOwoJCWNvbnN0IHRyaWFuZ2xlcyA9IFtdOwoKCQlpZiAoICEgb3V0ZXJOb2RlIHx8IG91dGVyTm9kZS5uZXh0ID09PSBvdXRlck5vZGUucHJldiApIHJldHVybiB0cmlhbmdsZXM7CgoJCWxldCBtaW5YLCBtaW5ZLCBtYXhYLCBtYXhZLCB4LCB5LCBpbnZTaXplOwoKCQlpZiAoIGhhc0hvbGVzICkgb3V0ZXJOb2RlID0gZWxpbWluYXRlSG9sZXMoIGRhdGEsIGhvbGVJbmRpY2VzLCBvdXRlck5vZGUsIGRpbSApOwoKCQkvLyBpZiB0aGUgc2hhcGUgaXMgbm90IHRvbyBzaW1wbGUsIHdlJ2xsIHVzZSB6LW9yZGVyIGN1cnZlIGhhc2ggbGF0ZXI7IGNhbGN1bGF0ZSBwb2x5Z29uIGJib3gKCQlpZiAoIGRhdGEubGVuZ3RoID4gODAgKiBkaW0gKSB7CgoJCQltaW5YID0gbWF4WCA9IGRhdGFbIDAgXTsKCQkJbWluWSA9IG1heFkgPSBkYXRhWyAxIF07CgoJCQlmb3IgKCBsZXQgaSA9IGRpbTsgaSA8IG91dGVyTGVuOyBpICs9IGRpbSApIHsKCgkJCQl4ID0gZGF0YVsgaSBdOwoJCQkJeSA9IGRhdGFbIGkgKyAxIF07CgkJCQlpZiAoIHggPCBtaW5YICkgbWluWCA9IHg7CgkJCQlpZiAoIHkgPCBtaW5ZICkgbWluWSA9IHk7CgkJCQlpZiAoIHggPiBtYXhYICkgbWF4WCA9IHg7CgkJCQlpZiAoIHkgPiBtYXhZICkgbWF4WSA9IHk7CgoJCQl9CgoJCQkvLyBtaW5YLCBtaW5ZIGFuZCBpbnZTaXplIGFyZSBsYXRlciB1c2VkIHRvIHRyYW5zZm9ybSBjb29yZHMgaW50byBpbnRlZ2VycyBmb3Igei1vcmRlciBjYWxjdWxhdGlvbgoJCQlpbnZTaXplID0gTWF0aC5tYXgoIG1heFggLSBtaW5YLCBtYXhZIC0gbWluWSApOwoJCQlpbnZTaXplID0gaW52U2l6ZSAhPT0gMCA/IDMyNzY3IC8gaW52U2l6ZSA6IDA7CgoJCX0KCgkJZWFyY3V0TGlua2VkKCBvdXRlck5vZGUsIHRyaWFuZ2xlcywgZGltLCBtaW5YLCBtaW5ZLCBpbnZTaXplLCAwICk7CgoJCXJldHVybiB0cmlhbmdsZXM7CgoJfQoKfTsKCi8vIGNyZWF0ZSBhIGNpcmN1bGFyIGRvdWJseSBsaW5rZWQgbGlzdCBmcm9tIHBvbHlnb24gcG9pbnRzIGluIHRoZSBzcGVjaWZpZWQgd2luZGluZyBvcmRlcgpmdW5jdGlvbiBsaW5rZWRMaXN0KCBkYXRhLCBzdGFydCwgZW5kLCBkaW0sIGNsb2Nrd2lzZSApIHsKCglsZXQgaSwgbGFzdDsKCglpZiAoIGNsb2Nrd2lzZSA9PT0gKCBzaWduZWRBcmVhKCBkYXRhLCBzdGFydCwgZW5kLCBkaW0gKSA+IDAgKSApIHsKCgkJZm9yICggaSA9IHN0YXJ0OyBpIDwgZW5kOyBpICs9IGRpbSApIGxhc3QgPSBpbnNlcnROb2RlKCBpLCBkYXRhWyBpIF0sIGRhdGFbIGkgKyAxIF0sIGxhc3QgKTsKCgl9IGVsc2UgewoKCQlmb3IgKCBpID0gZW5kIC0gZGltOyBpID49IHN0YXJ0OyBpIC09IGRpbSApIGxhc3QgPSBpbnNlcnROb2RlKCBpLCBkYXRhWyBpIF0sIGRhdGFbIGkgKyAxIF0sIGxhc3QgKTsKCgl9CgoJaWYgKCBsYXN0ICYmIGVxdWFscyggbGFzdCwgbGFzdC5uZXh0ICkgKSB7CgoJCXJlbW92ZU5vZGUoIGxhc3QgKTsKCQlsYXN0ID0gbGFzdC5uZXh0OwoKCX0KCglyZXR1cm4gbGFzdDsKCn0KCi8vIGVsaW1pbmF0ZSBjb2xpbmVhciBvciBkdXBsaWNhdGUgcG9pbnRzCmZ1bmN0aW9uIGZpbHRlclBvaW50cyggc3RhcnQsIGVuZCApIHsKCglpZiAoICEgc3RhcnQgKSByZXR1cm4gc3RhcnQ7CglpZiAoICEgZW5kICkgZW5kID0gc3RhcnQ7CgoJbGV0IHAgPSBzdGFydCwKCQlhZ2FpbjsKCWRvIHsKCgkJYWdhaW4gPSBmYWxzZTsKCgkJaWYgKCAhIHAuc3RlaW5lciAmJiAoIGVxdWFscyggcCwgcC5uZXh0ICkgfHwgYXJlYSggcC5wcmV2LCBwLCBwLm5leHQgKSA9PT0gMCApICkgewoKCQkJcmVtb3ZlTm9kZSggcCApOwoJCQlwID0gZW5kID0gcC5wcmV2OwoJCQlpZiAoIHAgPT09IHAubmV4dCApIGJyZWFrOwoJCQlhZ2FpbiA9IHRydWU7CgoJCX0gZWxzZSB7CgoJCQlwID0gcC5uZXh0OwoKCQl9CgoJfSB3aGlsZSAoIGFnYWluIHx8IHAgIT09IGVuZCApOwoKCXJldHVybiBlbmQ7Cgp9CgovLyBtYWluIGVhciBzbGljaW5nIGxvb3Agd2hpY2ggdHJpYW5ndWxhdGVzIGEgcG9seWdvbiAoZ2l2ZW4gYXMgYSBsaW5rZWQgbGlzdCkKZnVuY3Rpb24gZWFyY3V0TGlua2VkKCBlYXIsIHRyaWFuZ2xlcywgZGltLCBtaW5YLCBtaW5ZLCBpbnZTaXplLCBwYXNzICkgewoKCWlmICggISBlYXIgKSByZXR1cm47CgoJLy8gaW50ZXJsaW5rIHBvbHlnb24gbm9kZXMgaW4gei1vcmRlcgoJaWYgKCAhIHBhc3MgJiYgaW52U2l6ZSApIGluZGV4Q3VydmUoIGVhciwgbWluWCwgbWluWSwgaW52U2l6ZSApOwoKCWxldCBzdG9wID0gZWFyLAoJCXByZXYsIG5leHQ7CgoJLy8gaXRlcmF0ZSB0aHJvdWdoIGVhcnMsIHNsaWNpbmcgdGhlbSBvbmUgYnkgb25lCgl3aGlsZSAoIGVhci5wcmV2ICE9PSBlYXIubmV4dCApIHsKCgkJcHJldiA9IGVhci5wcmV2OwoJCW5leHQgPSBlYXIubmV4dDsKCgkJaWYgKCBpbnZTaXplID8gaXNFYXJIYXNoZWQoIGVhciwgbWluWCwgbWluWSwgaW52U2l6ZSApIDogaXNFYXIoIGVhciApICkgewoKCQkJLy8gY3V0IG9mZiB0aGUgdHJpYW5nbGUKCQkJdHJpYW5nbGVzLnB1c2goIHByZXYuaSAvIGRpbSB8IDAgKTsKCQkJdHJpYW5nbGVzLnB1c2goIGVhci5pIC8gZGltIHwgMCApOwoJCQl0cmlhbmdsZXMucHVzaCggbmV4dC5pIC8gZGltIHwgMCApOwoKCQkJcmVtb3ZlTm9kZSggZWFyICk7CgoJCQkvLyBza2lwcGluZyB0aGUgbmV4dCB2ZXJ0ZXggbGVhZHMgdG8gbGVzcyBzbGl2ZXIgdHJpYW5nbGVzCgkJCWVhciA9IG5leHQubmV4dDsKCQkJc3RvcCA9IG5leHQubmV4dDsKCgkJCWNvbnRpbnVlOwoKCQl9CgoJCWVhciA9IG5leHQ7CgoJCS8vIGlmIHdlIGxvb3BlZCB0aHJvdWdoIHRoZSB3aG9sZSByZW1haW5pbmcgcG9seWdvbiBhbmQgY2FuJ3QgZmluZCBhbnkgbW9yZSBlYXJzCgkJaWYgKCBlYXIgPT09IHN0b3AgKSB7CgoJCQkvLyB0cnkgZmlsdGVyaW5nIHBvaW50cyBhbmQgc2xpY2luZyBhZ2FpbgoJCQlpZiAoICEgcGFzcyApIHsKCgkJCQllYXJjdXRMaW5rZWQoIGZpbHRlclBvaW50cyggZWFyICksIHRyaWFuZ2xlcywgZGltLCBtaW5YLCBtaW5ZLCBpbnZTaXplLCAxICk7CgoJCQkJLy8gaWYgdGhpcyBkaWRuJ3Qgd29yaywgdHJ5IGN1cmluZyBhbGwgc21hbGwgc2VsZi1pbnRlcnNlY3Rpb25zIGxvY2FsbHkKCgkJCX0gZWxzZSBpZiAoIHBhc3MgPT09IDEgKSB7CgoJCQkJZWFyID0gY3VyZUxvY2FsSW50ZXJzZWN0aW9ucyggZmlsdGVyUG9pbnRzKCBlYXIgKSwgdHJpYW5nbGVzLCBkaW0gKTsKCQkJCWVhcmN1dExpbmtlZCggZWFyLCB0cmlhbmdsZXMsIGRpbSwgbWluWCwgbWluWSwgaW52U2l6ZSwgMiApOwoKCQkJCS8vIGFzIGEgbGFzdCByZXNvcnQsIHRyeSBzcGxpdHRpbmcgdGhlIHJlbWFpbmluZyBwb2x5Z29uIGludG8gdHdvCgoJCQl9IGVsc2UgaWYgKCBwYXNzID09PSAyICkgewoKCQkJCXNwbGl0RWFyY3V0KCBlYXIsIHRyaWFuZ2xlcywgZGltLCBtaW5YLCBtaW5ZLCBpbnZTaXplICk7CgoJCQl9CgoJCQlicmVhazsKCgkJfQoKCX0KCn0KCi8vIGNoZWNrIHdoZXRoZXIgYSBwb2x5Z29uIG5vZGUgZm9ybXMgYSB2YWxpZCBlYXIgd2l0aCBhZGphY2VudCBub2RlcwpmdW5jdGlvbiBpc0VhciggZWFyICkgewoKCWNvbnN0IGEgPSBlYXIucHJldiwKCQliID0gZWFyLAoJCWMgPSBlYXIubmV4dDsKCglpZiAoIGFyZWEoIGEsIGIsIGMgKSA+PSAwICkgcmV0dXJuIGZhbHNlOyAvLyByZWZsZXgsIGNhbid0IGJlIGFuIGVhcgoKCS8vIG5vdyBtYWtlIHN1cmUgd2UgZG9uJ3QgaGF2ZSBvdGhlciBwb2ludHMgaW5zaWRlIHRoZSBwb3RlbnRpYWwgZWFyCgljb25zdCBheCA9IGEueCwgYnggPSBiLngsIGN4ID0gYy54LCBheSA9IGEueSwgYnkgPSBiLnksIGN5ID0gYy55OwoKCS8vIHRyaWFuZ2xlIGJib3g7IG1pbiAmIG1heCBhcmUgY2FsY3VsYXRlZCBsaWtlIHRoaXMgZm9yIHNwZWVkCgljb25zdCB4MCA9IGF4IDwgYnggPyAoIGF4IDwgY3ggPyBheCA6IGN4ICkgOiAoIGJ4IDwgY3ggPyBieCA6IGN4ICksCgkJeTAgPSBheSA8IGJ5ID8gKCBheSA8IGN5ID8gYXkgOiBjeSApIDogKCBieSA8IGN5ID8gYnkgOiBjeSApLAoJCXgxID0gYXggPiBieCA/ICggYXggPiBjeCA/IGF4IDogY3ggKSA6ICggYnggPiBjeCA/IGJ4IDogY3ggKSwKCQl5MSA9IGF5ID4gYnkgPyAoIGF5ID4gY3kgPyBheSA6IGN5ICkgOiAoIGJ5ID4gY3kgPyBieSA6IGN5ICk7CgoJbGV0IHAgPSBjLm5leHQ7Cgl3aGlsZSAoIHAgIT09IGEgKSB7CgoJCWlmICggcC54ID49IHgwICYmIHAueCA8PSB4MSAmJiBwLnkgPj0geTAgJiYgcC55IDw9IHkxICYmCgkJCXBvaW50SW5UcmlhbmdsZSggYXgsIGF5LCBieCwgYnksIGN4LCBjeSwgcC54LCBwLnkgKSAmJgoJCQlhcmVhKCBwLnByZXYsIHAsIHAubmV4dCApID49IDAgKSByZXR1cm4gZmFsc2U7CgkJcCA9IHAubmV4dDsKCgl9CgoJcmV0dXJuIHRydWU7Cgp9CgpmdW5jdGlvbiBpc0Vhckhhc2hlZCggZWFyLCBtaW5YLCBtaW5ZLCBpbnZTaXplICkgewoKCWNvbnN0IGEgPSBlYXIucHJldiwKCQliID0gZWFyLAoJCWMgPSBlYXIubmV4dDsKCglpZiAoIGFyZWEoIGEsIGIsIGMgKSA+PSAwICkgcmV0dXJuIGZhbHNlOyAvLyByZWZsZXgsIGNhbid0IGJlIGFuIGVhcgoKCWNvbnN0IGF4ID0gYS54LCBieCA9IGIueCwgY3ggPSBjLngsIGF5ID0gYS55LCBieSA9IGIueSwgY3kgPSBjLnk7CgoJLy8gdHJpYW5nbGUgYmJveDsgbWluICYgbWF4IGFyZSBjYWxjdWxhdGVkIGxpa2UgdGhpcyBmb3Igc3BlZWQKCWNvbnN0IHgwID0gYXggPCBieCA/ICggYXggPCBjeCA/IGF4IDogY3ggKSA6ICggYnggPCBjeCA/IGJ4IDogY3ggKSwKCQl5MCA9IGF5IDwgYnkgPyAoIGF5IDwgY3kgPyBheSA6IGN5ICkgOiAoIGJ5IDwgY3kgPyBieSA6IGN5ICksCgkJeDEgPSBheCA+IGJ4ID8gKCBheCA+IGN4ID8gYXggOiBjeCApIDogKCBieCA+IGN4ID8gYnggOiBjeCApLAoJCXkxID0gYXkgPiBieSA/ICggYXkgPiBjeSA/IGF5IDogY3kgKSA6ICggYnkgPiBjeSA/IGJ5IDogY3kgKTsKCgkvLyB6LW9yZGVyIHJhbmdlIGZvciB0aGUgY3VycmVudCB0cmlhbmdsZSBiYm94OwoJY29uc3QgbWluWiA9IHpPcmRlciggeDAsIHkwLCBtaW5YLCBtaW5ZLCBpbnZTaXplICksCgkJbWF4WiA9IHpPcmRlciggeDEsIHkxLCBtaW5YLCBtaW5ZLCBpbnZTaXplICk7CgoJbGV0IHAgPSBlYXIucHJldlosCgkJbiA9IGVhci5uZXh0WjsKCgkvLyBsb29rIGZvciBwb2ludHMgaW5zaWRlIHRoZSB0cmlhbmdsZSBpbiBib3RoIGRpcmVjdGlvbnMKCXdoaWxlICggcCAmJiBwLnogPj0gbWluWiAmJiBuICYmIG4ueiA8PSBtYXhaICkgewoKCQlpZiAoIHAueCA+PSB4MCAmJiBwLnggPD0geDEgJiYgcC55ID49IHkwICYmIHAueSA8PSB5MSAmJiBwICE9PSBhICYmIHAgIT09IGMgJiYKCQkJcG9pbnRJblRyaWFuZ2xlKCBheCwgYXksIGJ4LCBieSwgY3gsIGN5LCBwLngsIHAueSApICYmIGFyZWEoIHAucHJldiwgcCwgcC5uZXh0ICkgPj0gMCApIHJldHVybiBmYWxzZTsKCQlwID0gcC5wcmV2WjsKCgkJaWYgKCBuLnggPj0geDAgJiYgbi54IDw9IHgxICYmIG4ueSA+PSB5MCAmJiBuLnkgPD0geTEgJiYgbiAhPT0gYSAmJiBuICE9PSBjICYmCgkJCXBvaW50SW5UcmlhbmdsZSggYXgsIGF5LCBieCwgYnksIGN4LCBjeSwgbi54LCBuLnkgKSAmJiBhcmVhKCBuLnByZXYsIG4sIG4ubmV4dCApID49IDAgKSByZXR1cm4gZmFsc2U7CgkJbiA9IG4ubmV4dFo7CgoJfQoKCS8vIGxvb2sgZm9yIHJlbWFpbmluZyBwb2ludHMgaW4gZGVjcmVhc2luZyB6LW9yZGVyCgl3aGlsZSAoIHAgJiYgcC56ID49IG1pblogKSB7CgoJCWlmICggcC54ID49IHgwICYmIHAueCA8PSB4MSAmJiBwLnkgPj0geTAgJiYgcC55IDw9IHkxICYmIHAgIT09IGEgJiYgcCAhPT0gYyAmJgoJCQlwb2ludEluVHJpYW5nbGUoIGF4LCBheSwgYngsIGJ5LCBjeCwgY3ksIHAueCwgcC55ICkgJiYgYXJlYSggcC5wcmV2LCBwLCBwLm5leHQgKSA+PSAwICkgcmV0dXJuIGZhbHNlOwoJCXAgPSBwLnByZXZaOwoKCX0KCgkvLyBsb29rIGZvciByZW1haW5pbmcgcG9pbnRzIGluIGluY3JlYXNpbmcgei1vcmRlcgoJd2hpbGUgKCBuICYmIG4ueiA8PSBtYXhaICkgewoKCQlpZiAoIG4ueCA+PSB4MCAmJiBuLnggPD0geDEgJiYgbi55ID49IHkwICYmIG4ueSA8PSB5MSAmJiBuICE9PSBhICYmIG4gIT09IGMgJiYKCQkJcG9pbnRJblRyaWFuZ2xlKCBheCwgYXksIGJ4LCBieSwgY3gsIGN5LCBuLngsIG4ueSApICYmIGFyZWEoIG4ucHJldiwgbiwgbi5uZXh0ICkgPj0gMCApIHJldHVybiBmYWxzZTsKCQluID0gbi5uZXh0WjsKCgl9CgoJcmV0dXJuIHRydWU7Cgp9CgovLyBnbyB0aHJvdWdoIGFsbCBwb2x5Z29uIG5vZGVzIGFuZCBjdXJlIHNtYWxsIGxvY2FsIHNlbGYtaW50ZXJzZWN0aW9ucwpmdW5jdGlvbiBjdXJlTG9jYWxJbnRlcnNlY3Rpb25zKCBzdGFydCwgdHJpYW5nbGVzLCBkaW0gKSB7CgoJbGV0IHAgPSBzdGFydDsKCWRvIHsKCgkJY29uc3QgYSA9IHAucHJldiwKCQkJYiA9IHAubmV4dC5uZXh0OwoKCQlpZiAoICEgZXF1YWxzKCBhLCBiICkgJiYgaW50ZXJzZWN0cyggYSwgcCwgcC5uZXh0LCBiICkgJiYgbG9jYWxseUluc2lkZSggYSwgYiApICYmIGxvY2FsbHlJbnNpZGUoIGIsIGEgKSApIHsKCgkJCXRyaWFuZ2xlcy5wdXNoKCBhLmkgLyBkaW0gfCAwICk7CgkJCXRyaWFuZ2xlcy5wdXNoKCBwLmkgLyBkaW0gfCAwICk7CgkJCXRyaWFuZ2xlcy5wdXNoKCBiLmkgLyBkaW0gfCAwICk7CgoJCQkvLyByZW1vdmUgdHdvIG5vZGVzIGludm9sdmVkCgkJCXJlbW92ZU5vZGUoIHAgKTsKCQkJcmVtb3ZlTm9kZSggcC5uZXh0ICk7CgoJCQlwID0gc3RhcnQgPSBiOwoKCQl9CgoJCXAgPSBwLm5leHQ7CgoJfSB3aGlsZSAoIHAgIT09IHN0YXJ0ICk7CgoJcmV0dXJuIGZpbHRlclBvaW50cyggcCApOwoKfQoKLy8gdHJ5IHNwbGl0dGluZyBwb2x5Z29uIGludG8gdHdvIGFuZCB0cmlhbmd1bGF0ZSB0aGVtIGluZGVwZW5kZW50bHkKZnVuY3Rpb24gc3BsaXRFYXJjdXQoIHN0YXJ0LCB0cmlhbmdsZXMsIGRpbSwgbWluWCwgbWluWSwgaW52U2l6ZSApIHsKCgkvLyBsb29rIGZvciBhIHZhbGlkIGRpYWdvbmFsIHRoYXQgZGl2aWRlcyB0aGUgcG9seWdvbiBpbnRvIHR3bwoJbGV0IGEgPSBzdGFydDsKCWRvIHsKCgkJbGV0IGIgPSBhLm5leHQubmV4dDsKCQl3aGlsZSAoIGIgIT09IGEucHJldiApIHsKCgkJCWlmICggYS5pICE9PSBiLmkgJiYgaXNWYWxpZERpYWdvbmFsKCBhLCBiICkgKSB7CgoJCQkJLy8gc3BsaXQgdGhlIHBvbHlnb24gaW4gdHdvIGJ5IHRoZSBkaWFnb25hbAoJCQkJbGV0IGMgPSBzcGxpdFBvbHlnb24oIGEsIGIgKTsKCgkJCQkvLyBmaWx0ZXIgY29saW5lYXIgcG9pbnRzIGFyb3VuZCB0aGUgY3V0cwoJCQkJYSA9IGZpbHRlclBvaW50cyggYSwgYS5uZXh0ICk7CgkJCQljID0gZmlsdGVyUG9pbnRzKCBjLCBjLm5leHQgKTsKCgkJCQkvLyBydW4gZWFyY3V0IG9uIGVhY2ggaGFsZgoJCQkJZWFyY3V0TGlua2VkKCBhLCB0cmlhbmdsZXMsIGRpbSwgbWluWCwgbWluWSwgaW52U2l6ZSwgMCApOwoJCQkJZWFyY3V0TGlua2VkKCBjLCB0cmlhbmdsZXMsIGRpbSwgbWluWCwgbWluWSwgaW52U2l6ZSwgMCApOwoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJYiA9IGIubmV4dDsKCgkJfQoKCQlhID0gYS5uZXh0OwoKCX0gd2hpbGUgKCBhICE9PSBzdGFydCApOwoKfQoKLy8gbGluayBldmVyeSBob2xlIGludG8gdGhlIG91dGVyIGxvb3AsIHByb2R1Y2luZyBhIHNpbmdsZS1yaW5nIHBvbHlnb24gd2l0aG91dCBob2xlcwpmdW5jdGlvbiBlbGltaW5hdGVIb2xlcyggZGF0YSwgaG9sZUluZGljZXMsIG91dGVyTm9kZSwgZGltICkgewoKCWNvbnN0IHF1ZXVlID0gW107CglsZXQgaSwgbGVuLCBzdGFydCwgZW5kLCBsaXN0OwoKCWZvciAoIGkgPSAwLCBsZW4gPSBob2xlSW5kaWNlcy5sZW5ndGg7IGkgPCBsZW47IGkgKysgKSB7CgoJCXN0YXJ0ID0gaG9sZUluZGljZXNbIGkgXSAqIGRpbTsKCQllbmQgPSBpIDwgbGVuIC0gMSA/IGhvbGVJbmRpY2VzWyBpICsgMSBdICogZGltIDogZGF0YS5sZW5ndGg7CgkJbGlzdCA9IGxpbmtlZExpc3QoIGRhdGEsIHN0YXJ0LCBlbmQsIGRpbSwgZmFsc2UgKTsKCQlpZiAoIGxpc3QgPT09IGxpc3QubmV4dCApIGxpc3Quc3RlaW5lciA9IHRydWU7CgkJcXVldWUucHVzaCggZ2V0TGVmdG1vc3QoIGxpc3QgKSApOwoKCX0KCglxdWV1ZS5zb3J0KCBjb21wYXJlWCApOwoKCS8vIHByb2Nlc3MgaG9sZXMgZnJvbSBsZWZ0IHRvIHJpZ2h0Cglmb3IgKCBpID0gMDsgaSA8IHF1ZXVlLmxlbmd0aDsgaSArKyApIHsKCgkJb3V0ZXJOb2RlID0gZWxpbWluYXRlSG9sZSggcXVldWVbIGkgXSwgb3V0ZXJOb2RlICk7CgoJfQoKCXJldHVybiBvdXRlck5vZGU7Cgp9CgpmdW5jdGlvbiBjb21wYXJlWCggYSwgYiApIHsKCglyZXR1cm4gYS54IC0gYi54OwoKfQoKLy8gZmluZCBhIGJyaWRnZSBiZXR3ZWVuIHZlcnRpY2VzIHRoYXQgY29ubmVjdHMgaG9sZSB3aXRoIGFuIG91dGVyIHJpbmcgYW5kIGxpbmsgaXQKZnVuY3Rpb24gZWxpbWluYXRlSG9sZSggaG9sZSwgb3V0ZXJOb2RlICkgewoKCWNvbnN0IGJyaWRnZSA9IGZpbmRIb2xlQnJpZGdlKCBob2xlLCBvdXRlck5vZGUgKTsKCWlmICggISBicmlkZ2UgKSB7CgoJCXJldHVybiBvdXRlck5vZGU7CgoJfQoKCWNvbnN0IGJyaWRnZVJldmVyc2UgPSBzcGxpdFBvbHlnb24oIGJyaWRnZSwgaG9sZSApOwoKCS8vIGZpbHRlciBjb2xsaW5lYXIgcG9pbnRzIGFyb3VuZCB0aGUgY3V0cwoJZmlsdGVyUG9pbnRzKCBicmlkZ2VSZXZlcnNlLCBicmlkZ2VSZXZlcnNlLm5leHQgKTsKCXJldHVybiBmaWx0ZXJQb2ludHMoIGJyaWRnZSwgYnJpZGdlLm5leHQgKTsKCn0KCi8vIERhdmlkIEViZXJseSdzIGFsZ29yaXRobSBmb3IgZmluZGluZyBhIGJyaWRnZSBiZXR3ZWVuIGhvbGUgYW5kIG91dGVyIHBvbHlnb24KZnVuY3Rpb24gZmluZEhvbGVCcmlkZ2UoIGhvbGUsIG91dGVyTm9kZSApIHsKCglsZXQgcCA9IG91dGVyTm9kZSwKCQlxeCA9IC0gSW5maW5pdHksCgkJbTsKCgljb25zdCBoeCA9IGhvbGUueCwgaHkgPSBob2xlLnk7CgoJLy8gZmluZCBhIHNlZ21lbnQgaW50ZXJzZWN0ZWQgYnkgYSByYXkgZnJvbSB0aGUgaG9sZSdzIGxlZnRtb3N0IHBvaW50IHRvIHRoZSBsZWZ0OwoJLy8gc2VnbWVudCdzIGVuZHBvaW50IHdpdGggbGVzc2VyIHggd2lsbCBiZSBwb3RlbnRpYWwgY29ubmVjdGlvbiBwb2ludAoJZG8gewoKCQlpZiAoIGh5IDw9IHAueSAmJiBoeSA+PSBwLm5leHQueSAmJiBwLm5leHQueSAhPT0gcC55ICkgewoKCQkJY29uc3QgeCA9IHAueCArICggaHkgLSBwLnkgKSAqICggcC5uZXh0LnggLSBwLnggKSAvICggcC5uZXh0LnkgLSBwLnkgKTsKCQkJaWYgKCB4IDw9IGh4ICYmIHggPiBxeCApIHsKCgkJCQlxeCA9IHg7CgkJCQltID0gcC54IDwgcC5uZXh0LnggPyBwIDogcC5uZXh0OwoJCQkJaWYgKCB4ID09PSBoeCApIHJldHVybiBtOyAvLyBob2xlIHRvdWNoZXMgb3V0ZXIgc2VnbWVudDsgcGljayBsZWZ0bW9zdCBlbmRwb2ludAoKCQkJfQoKCQl9CgoJCXAgPSBwLm5leHQ7CgoJfSB3aGlsZSAoIHAgIT09IG91dGVyTm9kZSApOwoKCWlmICggISBtICkgcmV0dXJuIG51bGw7CgoJLy8gbG9vayBmb3IgcG9pbnRzIGluc2lkZSB0aGUgdHJpYW5nbGUgb2YgaG9sZSBwb2ludCwgc2VnbWVudCBpbnRlcnNlY3Rpb24gYW5kIGVuZHBvaW50OwoJLy8gaWYgdGhlcmUgYXJlIG5vIHBvaW50cyBmb3VuZCwgd2UgaGF2ZSBhIHZhbGlkIGNvbm5lY3Rpb247CgkvLyBvdGhlcndpc2UgY2hvb3NlIHRoZSBwb2ludCBvZiB0aGUgbWluaW11bSBhbmdsZSB3aXRoIHRoZSByYXkgYXMgY29ubmVjdGlvbiBwb2ludAoKCWNvbnN0IHN0b3AgPSBtLAoJCW14ID0gbS54LAoJCW15ID0gbS55OwoJbGV0IHRhbk1pbiA9IEluZmluaXR5LCB0YW47CgoJcCA9IG07CgoJZG8gewoKCQlpZiAoIGh4ID49IHAueCAmJiBwLnggPj0gbXggJiYgaHggIT09IHAueCAmJgoJCQkJcG9pbnRJblRyaWFuZ2xlKCBoeSA8IG15ID8gaHggOiBxeCwgaHksIG14LCBteSwgaHkgPCBteSA/IHF4IDogaHgsIGh5LCBwLngsIHAueSApICkgewoKCQkJdGFuID0gTWF0aC5hYnMoIGh5IC0gcC55ICkgLyAoIGh4IC0gcC54ICk7IC8vIHRhbmdlbnRpYWwKCgkJCWlmICggbG9jYWxseUluc2lkZSggcCwgaG9sZSApICYmICggdGFuIDwgdGFuTWluIHx8ICggdGFuID09PSB0YW5NaW4gJiYgKCBwLnggPiBtLnggfHwgKCBwLnggPT09IG0ueCAmJiBzZWN0b3JDb250YWluc1NlY3RvciggbSwgcCApICkgKSApICkgKSB7CgoJCQkJbSA9IHA7CgkJCQl0YW5NaW4gPSB0YW47CgoJCQl9CgoJCX0KCgkJcCA9IHAubmV4dDsKCgl9IHdoaWxlICggcCAhPT0gc3RvcCApOwoKCXJldHVybiBtOwoKfQoKLy8gd2hldGhlciBzZWN0b3IgaW4gdmVydGV4IG0gY29udGFpbnMgc2VjdG9yIGluIHZlcnRleCBwIGluIHRoZSBzYW1lIGNvb3JkaW5hdGVzCmZ1bmN0aW9uIHNlY3RvckNvbnRhaW5zU2VjdG9yKCBtLCBwICkgewoKCXJldHVybiBhcmVhKCBtLnByZXYsIG0sIHAucHJldiApIDwgMCAmJiBhcmVhKCBwLm5leHQsIG0sIG0ubmV4dCApIDwgMDsKCn0KCi8vIGludGVybGluayBwb2x5Z29uIG5vZGVzIGluIHotb3JkZXIKZnVuY3Rpb24gaW5kZXhDdXJ2ZSggc3RhcnQsIG1pblgsIG1pblksIGludlNpemUgKSB7CgoJbGV0IHAgPSBzdGFydDsKCWRvIHsKCgkJaWYgKCBwLnogPT09IDAgKSBwLnogPSB6T3JkZXIoIHAueCwgcC55LCBtaW5YLCBtaW5ZLCBpbnZTaXplICk7CgkJcC5wcmV2WiA9IHAucHJldjsKCQlwLm5leHRaID0gcC5uZXh0OwoJCXAgPSBwLm5leHQ7CgoJfSB3aGlsZSAoIHAgIT09IHN0YXJ0ICk7CgoJcC5wcmV2Wi5uZXh0WiA9IG51bGw7CglwLnByZXZaID0gbnVsbDsKCglzb3J0TGlua2VkKCBwICk7Cgp9CgovLyBTaW1vbiBUYXRoYW0ncyBsaW5rZWQgbGlzdCBtZXJnZSBzb3J0IGFsZ29yaXRobQovLyBodHRwOi8vd3d3LmNoaWFyay5ncmVlbmVuZC5vcmcudWsvfnNndGF0aGFtL2FsZ29yaXRobXMvbGlzdHNvcnQuaHRtbApmdW5jdGlvbiBzb3J0TGlua2VkKCBsaXN0ICkgewoKCWxldCBpLCBwLCBxLCBlLCB0YWlsLCBudW1NZXJnZXMsIHBTaXplLCBxU2l6ZSwKCQlpblNpemUgPSAxOwoKCWRvIHsKCgkJcCA9IGxpc3Q7CgkJbGlzdCA9IG51bGw7CgkJdGFpbCA9IG51bGw7CgkJbnVtTWVyZ2VzID0gMDsKCgkJd2hpbGUgKCBwICkgewoKCQkJbnVtTWVyZ2VzICsrOwoJCQlxID0gcDsKCQkJcFNpemUgPSAwOwoJCQlmb3IgKCBpID0gMDsgaSA8IGluU2l6ZTsgaSArKyApIHsKCgkJCQlwU2l6ZSArKzsKCQkJCXEgPSBxLm5leHRaOwoJCQkJaWYgKCAhIHEgKSBicmVhazsKCgkJCX0KCgkJCXFTaXplID0gaW5TaXplOwoKCQkJd2hpbGUgKCBwU2l6ZSA+IDAgfHwgKCBxU2l6ZSA+IDAgJiYgcSApICkgewoKCQkJCWlmICggcFNpemUgIT09IDAgJiYgKCBxU2l6ZSA9PT0gMCB8fCAhIHEgfHwgcC56IDw9IHEueiApICkgewoKCQkJCQllID0gcDsKCQkJCQlwID0gcC5uZXh0WjsKCQkJCQlwU2l6ZSAtLTsKCgkJCQl9IGVsc2UgewoKCQkJCQllID0gcTsKCQkJCQlxID0gcS5uZXh0WjsKCQkJCQlxU2l6ZSAtLTsKCgkJCQl9CgoJCQkJaWYgKCB0YWlsICkgdGFpbC5uZXh0WiA9IGU7CgkJCQllbHNlIGxpc3QgPSBlOwoKCQkJCWUucHJldlogPSB0YWlsOwoJCQkJdGFpbCA9IGU7CgoJCQl9CgoJCQlwID0gcTsKCgkJfQoKCQl0YWlsLm5leHRaID0gbnVsbDsKCQlpblNpemUgKj0gMjsKCgl9IHdoaWxlICggbnVtTWVyZ2VzID4gMSApOwoKCXJldHVybiBsaXN0OwoKfQoKLy8gei1vcmRlciBvZiBhIHBvaW50IGdpdmVuIGNvb3JkcyBhbmQgaW52ZXJzZSBvZiB0aGUgbG9uZ2VyIHNpZGUgb2YgZGF0YSBiYm94CmZ1bmN0aW9uIHpPcmRlciggeCwgeSwgbWluWCwgbWluWSwgaW52U2l6ZSApIHsKCgkvLyBjb29yZHMgYXJlIHRyYW5zZm9ybWVkIGludG8gbm9uLW5lZ2F0aXZlIDE1LWJpdCBpbnRlZ2VyIHJhbmdlCgl4ID0gKCB4IC0gbWluWCApICogaW52U2l6ZSB8IDA7Cgl5ID0gKCB5IC0gbWluWSApICogaW52U2l6ZSB8IDA7CgoJeCA9ICggeCB8ICggeCA8PCA4ICkgKSAmIDB4MDBGRjAwRkY7Cgl4ID0gKCB4IHwgKCB4IDw8IDQgKSApICYgMHgwRjBGMEYwRjsKCXggPSAoIHggfCAoIHggPDwgMiApICkgJiAweDMzMzMzMzMzOwoJeCA9ICggeCB8ICggeCA8PCAxICkgKSAmIDB4NTU1NTU1NTU7CgoJeSA9ICggeSB8ICggeSA8PCA4ICkgKSAmIDB4MDBGRjAwRkY7Cgl5ID0gKCB5IHwgKCB5IDw8IDQgKSApICYgMHgwRjBGMEYwRjsKCXkgPSAoIHkgfCAoIHkgPDwgMiApICkgJiAweDMzMzMzMzMzOwoJeSA9ICggeSB8ICggeSA8PCAxICkgKSAmIDB4NTU1NTU1NTU7CgoJcmV0dXJuIHggfCAoIHkgPDwgMSApOwoKfQoKLy8gZmluZCB0aGUgbGVmdG1vc3Qgbm9kZSBvZiBhIHBvbHlnb24gcmluZwpmdW5jdGlvbiBnZXRMZWZ0bW9zdCggc3RhcnQgKSB7CgoJbGV0IHAgPSBzdGFydCwKCQlsZWZ0bW9zdCA9IHN0YXJ0OwoJZG8gewoKCQlpZiAoIHAueCA8IGxlZnRtb3N0LnggfHwgKCBwLnggPT09IGxlZnRtb3N0LnggJiYgcC55IDwgbGVmdG1vc3QueSApICkgbGVmdG1vc3QgPSBwOwoJCXAgPSBwLm5leHQ7CgoJfSB3aGlsZSAoIHAgIT09IHN0YXJ0ICk7CgoJcmV0dXJuIGxlZnRtb3N0OwoKfQoKLy8gY2hlY2sgaWYgYSBwb2ludCBsaWVzIHdpdGhpbiBhIGNvbnZleCB0cmlhbmdsZQpmdW5jdGlvbiBwb2ludEluVHJpYW5nbGUoIGF4LCBheSwgYngsIGJ5LCBjeCwgY3ksIHB4LCBweSApIHsKCglyZXR1cm4gKCBjeCAtIHB4ICkgKiAoIGF5IC0gcHkgKSA+PSAoIGF4IC0gcHggKSAqICggY3kgLSBweSApICYmCiAgICAgICAgICAgKCBheCAtIHB4ICkgKiAoIGJ5IC0gcHkgKSA+PSAoIGJ4IC0gcHggKSAqICggYXkgLSBweSApICYmCiAgICAgICAgICAgKCBieCAtIHB4ICkgKiAoIGN5IC0gcHkgKSA+PSAoIGN4IC0gcHggKSAqICggYnkgLSBweSApOwoKfQoKLy8gY2hlY2sgaWYgYSBkaWFnb25hbCBiZXR3ZWVuIHR3byBwb2x5Z29uIG5vZGVzIGlzIHZhbGlkIChsaWVzIGluIHBvbHlnb24gaW50ZXJpb3IpCmZ1bmN0aW9uIGlzVmFsaWREaWFnb25hbCggYSwgYiApIHsKCglyZXR1cm4gYS5uZXh0LmkgIT09IGIuaSAmJiBhLnByZXYuaSAhPT0gYi5pICYmICEgaW50ZXJzZWN0c1BvbHlnb24oIGEsIGIgKSAmJiAvLyBkb25lcyd0IGludGVyc2VjdCBvdGhlciBlZGdlcwogICAgICAgICAgICggbG9jYWxseUluc2lkZSggYSwgYiApICYmIGxvY2FsbHlJbnNpZGUoIGIsIGEgKSAmJiBtaWRkbGVJbnNpZGUoIGEsIGIgKSAmJiAvLyBsb2NhbGx5IHZpc2libGUKICAgICAgICAgICAgKCBhcmVhKCBhLnByZXYsIGEsIGIucHJldiApIHx8IGFyZWEoIGEsIGIucHJldiwgYiApICkgfHwgLy8gZG9lcyBub3QgY3JlYXRlIG9wcG9zaXRlLWZhY2luZyBzZWN0b3JzCiAgICAgICAgICAgIGVxdWFscyggYSwgYiApICYmIGFyZWEoIGEucHJldiwgYSwgYS5uZXh0ICkgPiAwICYmIGFyZWEoIGIucHJldiwgYiwgYi5uZXh0ICkgPiAwICk7IC8vIHNwZWNpYWwgemVyby1sZW5ndGggY2FzZQoKfQoKLy8gc2lnbmVkIGFyZWEgb2YgYSB0cmlhbmdsZQpmdW5jdGlvbiBhcmVhKCBwLCBxLCByICkgewoKCXJldHVybiAoIHEueSAtIHAueSApICogKCByLnggLSBxLnggKSAtICggcS54IC0gcC54ICkgKiAoIHIueSAtIHEueSApOwoKfQoKLy8gY2hlY2sgaWYgdHdvIHBvaW50cyBhcmUgZXF1YWwKZnVuY3Rpb24gZXF1YWxzKCBwMSwgcDIgKSB7CgoJcmV0dXJuIHAxLnggPT09IHAyLnggJiYgcDEueSA9PT0gcDIueTsKCn0KCi8vIGNoZWNrIGlmIHR3byBzZWdtZW50cyBpbnRlcnNlY3QKZnVuY3Rpb24gaW50ZXJzZWN0cyggcDEsIHExLCBwMiwgcTIgKSB7CgoJY29uc3QgbzEgPSBzaWduKCBhcmVhKCBwMSwgcTEsIHAyICkgKTsKCWNvbnN0IG8yID0gc2lnbiggYXJlYSggcDEsIHExLCBxMiApICk7Cgljb25zdCBvMyA9IHNpZ24oIGFyZWEoIHAyLCBxMiwgcDEgKSApOwoJY29uc3QgbzQgPSBzaWduKCBhcmVhKCBwMiwgcTIsIHExICkgKTsKCglpZiAoIG8xICE9PSBvMiAmJiBvMyAhPT0gbzQgKSByZXR1cm4gdHJ1ZTsgLy8gZ2VuZXJhbCBjYXNlCgoJaWYgKCBvMSA9PT0gMCAmJiBvblNlZ21lbnQoIHAxLCBwMiwgcTEgKSApIHJldHVybiB0cnVlOyAvLyBwMSwgcTEgYW5kIHAyIGFyZSBjb2xsaW5lYXIgYW5kIHAyIGxpZXMgb24gcDFxMQoJaWYgKCBvMiA9PT0gMCAmJiBvblNlZ21lbnQoIHAxLCBxMiwgcTEgKSApIHJldHVybiB0cnVlOyAvLyBwMSwgcTEgYW5kIHEyIGFyZSBjb2xsaW5lYXIgYW5kIHEyIGxpZXMgb24gcDFxMQoJaWYgKCBvMyA9PT0gMCAmJiBvblNlZ21lbnQoIHAyLCBwMSwgcTIgKSApIHJldHVybiB0cnVlOyAvLyBwMiwgcTIgYW5kIHAxIGFyZSBjb2xsaW5lYXIgYW5kIHAxIGxpZXMgb24gcDJxMgoJaWYgKCBvNCA9PT0gMCAmJiBvblNlZ21lbnQoIHAyLCBxMSwgcTIgKSApIHJldHVybiB0cnVlOyAvLyBwMiwgcTIgYW5kIHExIGFyZSBjb2xsaW5lYXIgYW5kIHExIGxpZXMgb24gcDJxMgoKCXJldHVybiBmYWxzZTsKCn0KCi8vIGZvciBjb2xsaW5lYXIgcG9pbnRzIHAsIHEsIHIsIGNoZWNrIGlmIHBvaW50IHEgbGllcyBvbiBzZWdtZW50IHByCmZ1bmN0aW9uIG9uU2VnbWVudCggcCwgcSwgciApIHsKCglyZXR1cm4gcS54IDw9IE1hdGgubWF4KCBwLngsIHIueCApICYmIHEueCA+PSBNYXRoLm1pbiggcC54LCByLnggKSAmJiBxLnkgPD0gTWF0aC5tYXgoIHAueSwgci55ICkgJiYgcS55ID49IE1hdGgubWluKCBwLnksIHIueSApOwoKfQoKZnVuY3Rpb24gc2lnbiggbnVtICkgewoKCXJldHVybiBudW0gPiAwID8gMSA6IG51bSA8IDAgPyAtIDEgOiAwOwoKfQoKLy8gY2hlY2sgaWYgYSBwb2x5Z29uIGRpYWdvbmFsIGludGVyc2VjdHMgYW55IHBvbHlnb24gc2VnbWVudHMKZnVuY3Rpb24gaW50ZXJzZWN0c1BvbHlnb24oIGEsIGIgKSB7CgoJbGV0IHAgPSBhOwoJZG8gewoKCQlpZiAoIHAuaSAhPT0gYS5pICYmIHAubmV4dC5pICE9PSBhLmkgJiYgcC5pICE9PSBiLmkgJiYgcC5uZXh0LmkgIT09IGIuaSAmJgoJCQlpbnRlcnNlY3RzKCBwLCBwLm5leHQsIGEsIGIgKSApIHJldHVybiB0cnVlOwoJCXAgPSBwLm5leHQ7CgoJfSB3aGlsZSAoIHAgIT09IGEgKTsKCglyZXR1cm4gZmFsc2U7Cgp9CgovLyBjaGVjayBpZiBhIHBvbHlnb24gZGlhZ29uYWwgaXMgbG9jYWxseSBpbnNpZGUgdGhlIHBvbHlnb24KZnVuY3Rpb24gbG9jYWxseUluc2lkZSggYSwgYiApIHsKCglyZXR1cm4gYXJlYSggYS5wcmV2LCBhLCBhLm5leHQgKSA8IDAgPwoJCWFyZWEoIGEsIGIsIGEubmV4dCApID49IDAgJiYgYXJlYSggYSwgYS5wcmV2LCBiICkgPj0gMCA6CgkJYXJlYSggYSwgYiwgYS5wcmV2ICkgPCAwIHx8IGFyZWEoIGEsIGEubmV4dCwgYiApIDwgMDsKCn0KCi8vIGNoZWNrIGlmIHRoZSBtaWRkbGUgcG9pbnQgb2YgYSBwb2x5Z29uIGRpYWdvbmFsIGlzIGluc2lkZSB0aGUgcG9seWdvbgpmdW5jdGlvbiBtaWRkbGVJbnNpZGUoIGEsIGIgKSB7CgoJbGV0IHAgPSBhLAoJCWluc2lkZSA9IGZhbHNlOwoJY29uc3QgcHggPSAoIGEueCArIGIueCApIC8gMiwKCQlweSA9ICggYS55ICsgYi55ICkgLyAyOwoJZG8gewoKCQlpZiAoICggKCBwLnkgPiBweSApICE9PSAoIHAubmV4dC55ID4gcHkgKSApICYmIHAubmV4dC55ICE9PSBwLnkgJiYKCQkJKCBweCA8ICggcC5uZXh0LnggLSBwLnggKSAqICggcHkgLSBwLnkgKSAvICggcC5uZXh0LnkgLSBwLnkgKSArIHAueCApICkKCQkJaW5zaWRlID0gISBpbnNpZGU7CgkJcCA9IHAubmV4dDsKCgl9IHdoaWxlICggcCAhPT0gYSApOwoKCXJldHVybiBpbnNpZGU7Cgp9CgovLyBsaW5rIHR3byBwb2x5Z29uIHZlcnRpY2VzIHdpdGggYSBicmlkZ2U7IGlmIHRoZSB2ZXJ0aWNlcyBiZWxvbmcgdG8gdGhlIHNhbWUgcmluZywgaXQgc3BsaXRzIHBvbHlnb24gaW50byB0d287Ci8vIGlmIG9uZSBiZWxvbmdzIHRvIHRoZSBvdXRlciByaW5nIGFuZCBhbm90aGVyIHRvIGEgaG9sZSwgaXQgbWVyZ2VzIGl0IGludG8gYSBzaW5nbGUgcmluZwpmdW5jdGlvbiBzcGxpdFBvbHlnb24oIGEsIGIgKSB7CgoJY29uc3QgYTIgPSBuZXcgTm9kZSggYS5pLCBhLngsIGEueSApLAoJCWIyID0gbmV3IE5vZGUoIGIuaSwgYi54LCBiLnkgKSwKCQlhbiA9IGEubmV4dCwKCQlicCA9IGIucHJldjsKCglhLm5leHQgPSBiOwoJYi5wcmV2ID0gYTsKCglhMi5uZXh0ID0gYW47Cglhbi5wcmV2ID0gYTI7CgoJYjIubmV4dCA9IGEyOwoJYTIucHJldiA9IGIyOwoKCWJwLm5leHQgPSBiMjsKCWIyLnByZXYgPSBicDsKCglyZXR1cm4gYjI7Cgp9CgovLyBjcmVhdGUgYSBub2RlIGFuZCBvcHRpb25hbGx5IGxpbmsgaXQgd2l0aCBwcmV2aW91cyBvbmUgKGluIGEgY2lyY3VsYXIgZG91Ymx5IGxpbmtlZCBsaXN0KQpmdW5jdGlvbiBpbnNlcnROb2RlKCBpLCB4LCB5LCBsYXN0ICkgewoKCWNvbnN0IHAgPSBuZXcgTm9kZSggaSwgeCwgeSApOwoKCWlmICggISBsYXN0ICkgewoKCQlwLnByZXYgPSBwOwoJCXAubmV4dCA9IHA7CgoJfSBlbHNlIHsKCgkJcC5uZXh0ID0gbGFzdC5uZXh0OwoJCXAucHJldiA9IGxhc3Q7CgkJbGFzdC5uZXh0LnByZXYgPSBwOwoJCWxhc3QubmV4dCA9IHA7CgoJfQoKCXJldHVybiBwOwoKfQoKZnVuY3Rpb24gcmVtb3ZlTm9kZSggcCApIHsKCglwLm5leHQucHJldiA9IHAucHJldjsKCXAucHJldi5uZXh0ID0gcC5uZXh0OwoKCWlmICggcC5wcmV2WiApIHAucHJldloubmV4dFogPSBwLm5leHRaOwoJaWYgKCBwLm5leHRaICkgcC5uZXh0Wi5wcmV2WiA9IHAucHJldlo7Cgp9CgpmdW5jdGlvbiBOb2RlKCBpLCB4LCB5ICkgewoKCS8vIHZlcnRleCBpbmRleCBpbiBjb29yZGluYXRlcyBhcnJheQoJdGhpcy5pID0gaTsKCgkvLyB2ZXJ0ZXggY29vcmRpbmF0ZXMKCXRoaXMueCA9IHg7Cgl0aGlzLnkgPSB5OwoKCS8vIHByZXZpb3VzIGFuZCBuZXh0IHZlcnRleCBub2RlcyBpbiBhIHBvbHlnb24gcmluZwoJdGhpcy5wcmV2ID0gbnVsbDsKCXRoaXMubmV4dCA9IG51bGw7CgoJLy8gei1vcmRlciBjdXJ2ZSB2YWx1ZQoJdGhpcy56ID0gMDsKCgkvLyBwcmV2aW91cyBhbmQgbmV4dCBub2RlcyBpbiB6LW9yZGVyCgl0aGlzLnByZXZaID0gbnVsbDsKCXRoaXMubmV4dFogPSBudWxsOwoKCS8vIGluZGljYXRlcyB3aGV0aGVyIHRoaXMgaXMgYSBzdGVpbmVyIHBvaW50Cgl0aGlzLnN0ZWluZXIgPSBmYWxzZTsKCn0KCmZ1bmN0aW9uIHNpZ25lZEFyZWEoIGRhdGEsIHN0YXJ0LCBlbmQsIGRpbSApIHsKCglsZXQgc3VtID0gMDsKCWZvciAoIGxldCBpID0gc3RhcnQsIGogPSBlbmQgLSBkaW07IGkgPCBlbmQ7IGkgKz0gZGltICkgewoKCQlzdW0gKz0gKCBkYXRhWyBqIF0gLSBkYXRhWyBpIF0gKSAqICggZGF0YVsgaSArIDEgXSArIGRhdGFbIGogKyAxIF0gKTsKCQlqID0gaTsKCgl9CgoJcmV0dXJuIHN1bTsKCn0KCmNsYXNzIFNoYXBlVXRpbHMgewoKCS8vIGNhbGN1bGF0ZSBhcmVhIG9mIHRoZSBjb250b3VyIHBvbHlnb24KCglzdGF0aWMgYXJlYSggY29udG91ciApIHsKCgkJY29uc3QgbiA9IGNvbnRvdXIubGVuZ3RoOwoJCWxldCBhID0gMC4wOwoKCQlmb3IgKCBsZXQgcCA9IG4gLSAxLCBxID0gMDsgcSA8IG47IHAgPSBxICsrICkgewoKCQkJYSArPSBjb250b3VyWyBwIF0ueCAqIGNvbnRvdXJbIHEgXS55IC0gY29udG91clsgcSBdLnggKiBjb250b3VyWyBwIF0ueTsKCgkJfQoKCQlyZXR1cm4gYSAqIDAuNTsKCgl9CgoJc3RhdGljIGlzQ2xvY2tXaXNlKCBwdHMgKSB7CgoJCXJldHVybiBTaGFwZVV0aWxzLmFyZWEoIHB0cyApIDwgMDsKCgl9CgoJc3RhdGljIHRyaWFuZ3VsYXRlU2hhcGUoIGNvbnRvdXIsIGhvbGVzICkgewoKCQljb25zdCB2ZXJ0aWNlcyA9IFtdOyAvLyBmbGF0IGFycmF5IG9mIHZlcnRpY2VzIGxpa2UgWyB4MCx5MCwgeDEseTEsIHgyLHkyLCAuLi4gXQoJCWNvbnN0IGhvbGVJbmRpY2VzID0gW107IC8vIGFycmF5IG9mIGhvbGUgaW5kaWNlcwoJCWNvbnN0IGZhY2VzID0gW107IC8vIGZpbmFsIGFycmF5IG9mIHZlcnRleCBpbmRpY2VzIGxpa2UgWyBbIGEsYixkIF0sIFsgYixjLGQgXSBdCgoJCXJlbW92ZUR1cEVuZFB0cyggY29udG91ciApOwoJCWFkZENvbnRvdXIoIHZlcnRpY2VzLCBjb250b3VyICk7CgoJCS8vCgoJCWxldCBob2xlSW5kZXggPSBjb250b3VyLmxlbmd0aDsKCgkJaG9sZXMuZm9yRWFjaCggcmVtb3ZlRHVwRW5kUHRzICk7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IGhvbGVzLmxlbmd0aDsgaSArKyApIHsKCgkJCWhvbGVJbmRpY2VzLnB1c2goIGhvbGVJbmRleCApOwoJCQlob2xlSW5kZXggKz0gaG9sZXNbIGkgXS5sZW5ndGg7CgkJCWFkZENvbnRvdXIoIHZlcnRpY2VzLCBob2xlc1sgaSBdICk7CgoJCX0KCgkJLy8KCgkJY29uc3QgdHJpYW5nbGVzID0gRWFyY3V0LnRyaWFuZ3VsYXRlKCB2ZXJ0aWNlcywgaG9sZUluZGljZXMgKTsKCgkJLy8KCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgdHJpYW5nbGVzLmxlbmd0aDsgaSArPSAzICkgewoKCQkJZmFjZXMucHVzaCggdHJpYW5nbGVzLnNsaWNlKCBpLCBpICsgMyApICk7CgoJCX0KCgkJcmV0dXJuIGZhY2VzOwoKCX0KCn0KCmZ1bmN0aW9uIHJlbW92ZUR1cEVuZFB0cyggcG9pbnRzICkgewoKCWNvbnN0IGwgPSBwb2ludHMubGVuZ3RoOwoKCWlmICggbCA+IDIgJiYgcG9pbnRzWyBsIC0gMSBdLmVxdWFscyggcG9pbnRzWyAwIF0gKSApIHsKCgkJcG9pbnRzLnBvcCgpOwoKCX0KCn0KCmZ1bmN0aW9uIGFkZENvbnRvdXIoIHZlcnRpY2VzLCBjb250b3VyICkgewoKCWZvciAoIGxldCBpID0gMDsgaSA8IGNvbnRvdXIubGVuZ3RoOyBpICsrICkgewoKCQl2ZXJ0aWNlcy5wdXNoKCBjb250b3VyWyBpIF0ueCApOwoJCXZlcnRpY2VzLnB1c2goIGNvbnRvdXJbIGkgXS55ICk7CgoJfQoKfQoKLyoqCiAqIENyZWF0ZXMgZXh0cnVkZWQgZ2VvbWV0cnkgZnJvbSBhIHBhdGggc2hhcGUuCiAqCiAqIHBhcmFtZXRlcnMgPSB7CiAqCiAqICBjdXJ2ZVNlZ21lbnRzOiA8aW50PiwgLy8gbnVtYmVyIG9mIHBvaW50cyBvbiB0aGUgY3VydmVzCiAqICBzdGVwczogPGludD4sIC8vIG51bWJlciBvZiBwb2ludHMgZm9yIHotc2lkZSBleHRydXNpb25zIC8gdXNlZCBmb3Igc3ViZGl2aWRpbmcgc2VnbWVudHMgb2YgZXh0cnVkZSBzcGxpbmUgdG9vCiAqICBkZXB0aDogPGZsb2F0PiwgLy8gRGVwdGggdG8gZXh0cnVkZSB0aGUgc2hhcGUKICoKICogIGJldmVsRW5hYmxlZDogPGJvb2w+LCAvLyB0dXJuIG9uIGJldmVsCiAqICBiZXZlbFRoaWNrbmVzczogPGZsb2F0PiwgLy8gaG93IGRlZXAgaW50byB0aGUgb3JpZ2luYWwgc2hhcGUgYmV2ZWwgZ29lcwogKiAgYmV2ZWxTaXplOiA8ZmxvYXQ+LCAvLyBob3cgZmFyIGZyb20gc2hhcGUgb3V0bGluZSAoaW5jbHVkaW5nIGJldmVsT2Zmc2V0KSBpcyBiZXZlbAogKiAgYmV2ZWxPZmZzZXQ6IDxmbG9hdD4sIC8vIGhvdyBmYXIgZnJvbSBzaGFwZSBvdXRsaW5lIGRvZXMgYmV2ZWwgc3RhcnQKICogIGJldmVsU2VnbWVudHM6IDxpbnQ+LCAvLyBudW1iZXIgb2YgYmV2ZWwgbGF5ZXJzCiAqCiAqICBleHRydWRlUGF0aDogPFRIUkVFLkN1cnZlPiAvLyBjdXJ2ZSB0byBleHRydWRlIHNoYXBlIGFsb25nCiAqCiAqICBVVkdlbmVyYXRvcjogPE9iamVjdD4gLy8gb2JqZWN0IHRoYXQgcHJvdmlkZXMgVVYgZ2VuZXJhdG9yIGZ1bmN0aW9ucwogKgogKiB9CiAqLwoKCmNsYXNzIEV4dHJ1ZGVHZW9tZXRyeSBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKCgljb25zdHJ1Y3Rvciggc2hhcGVzID0gbmV3IFNoYXBlKCBbIG5ldyBWZWN0b3IyKCAwLjUsIDAuNSApLCBuZXcgVmVjdG9yMiggLSAwLjUsIDAuNSApLCBuZXcgVmVjdG9yMiggLSAwLjUsIC0gMC41ICksIG5ldyBWZWN0b3IyKCAwLjUsIC0gMC41ICkgXSApLCBvcHRpb25zID0ge30gKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMudHlwZSA9ICdFeHRydWRlR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXNoYXBlczogc2hhcGVzLAoJCQlvcHRpb25zOiBvcHRpb25zCgkJfTsKCgkJc2hhcGVzID0gQXJyYXkuaXNBcnJheSggc2hhcGVzICkgPyBzaGFwZXMgOiBbIHNoYXBlcyBdOwoKCQljb25zdCBzY29wZSA9IHRoaXM7CgoJCWNvbnN0IHZlcnRpY2VzQXJyYXkgPSBbXTsKCQljb25zdCB1dkFycmF5ID0gW107CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHNoYXBlcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJY29uc3Qgc2hhcGUgPSBzaGFwZXNbIGkgXTsKCQkJYWRkU2hhcGUoIHNoYXBlICk7CgoJCX0KCgkJLy8gYnVpbGQgZ2VvbWV0cnkKCgkJdGhpcy5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlc0FycmF5LCAzICkgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3V2JywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHV2QXJyYXksIDIgKSApOwoKCQl0aGlzLmNvbXB1dGVWZXJ0ZXhOb3JtYWxzKCk7CgoJCS8vIGZ1bmN0aW9ucwoKCQlmdW5jdGlvbiBhZGRTaGFwZSggc2hhcGUgKSB7CgoJCQljb25zdCBwbGFjZWhvbGRlciA9IFtdOwoKCQkJLy8gb3B0aW9ucwoKCQkJY29uc3QgY3VydmVTZWdtZW50cyA9IG9wdGlvbnMuY3VydmVTZWdtZW50cyAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5jdXJ2ZVNlZ21lbnRzIDogMTI7CgkJCWNvbnN0IHN0ZXBzID0gb3B0aW9ucy5zdGVwcyAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5zdGVwcyA6IDE7CgkJCWNvbnN0IGRlcHRoID0gb3B0aW9ucy5kZXB0aCAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5kZXB0aCA6IDE7CgoJCQlsZXQgYmV2ZWxFbmFibGVkID0gb3B0aW9ucy5iZXZlbEVuYWJsZWQgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuYmV2ZWxFbmFibGVkIDogdHJ1ZTsKCQkJbGV0IGJldmVsVGhpY2tuZXNzID0gb3B0aW9ucy5iZXZlbFRoaWNrbmVzcyAhPT0gdW5kZWZpbmVkID8gb3B0aW9ucy5iZXZlbFRoaWNrbmVzcyA6IDAuMjsKCQkJbGV0IGJldmVsU2l6ZSA9IG9wdGlvbnMuYmV2ZWxTaXplICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJldmVsU2l6ZSA6IGJldmVsVGhpY2tuZXNzIC0gMC4xOwoJCQlsZXQgYmV2ZWxPZmZzZXQgPSBvcHRpb25zLmJldmVsT2Zmc2V0ICE9PSB1bmRlZmluZWQgPyBvcHRpb25zLmJldmVsT2Zmc2V0IDogMDsKCQkJbGV0IGJldmVsU2VnbWVudHMgPSBvcHRpb25zLmJldmVsU2VnbWVudHMgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuYmV2ZWxTZWdtZW50cyA6IDM7CgoJCQljb25zdCBleHRydWRlUGF0aCA9IG9wdGlvbnMuZXh0cnVkZVBhdGg7CgoJCQljb25zdCB1dmdlbiA9IG9wdGlvbnMuVVZHZW5lcmF0b3IgIT09IHVuZGVmaW5lZCA/IG9wdGlvbnMuVVZHZW5lcmF0b3IgOiBXb3JsZFVWR2VuZXJhdG9yOwoKCQkJLy8KCgkJCWxldCBleHRydWRlUHRzLCBleHRydWRlQnlQYXRoID0gZmFsc2U7CgkJCWxldCBzcGxpbmVUdWJlLCBiaW5vcm1hbCwgbm9ybWFsLCBwb3NpdGlvbjI7CgoJCQlpZiAoIGV4dHJ1ZGVQYXRoICkgewoKCQkJCWV4dHJ1ZGVQdHMgPSBleHRydWRlUGF0aC5nZXRTcGFjZWRQb2ludHMoIHN0ZXBzICk7CgoJCQkJZXh0cnVkZUJ5UGF0aCA9IHRydWU7CgkJCQliZXZlbEVuYWJsZWQgPSBmYWxzZTsgLy8gYmV2ZWxzIG5vdCBzdXBwb3J0ZWQgZm9yIHBhdGggZXh0cnVzaW9uCgoJCQkJLy8gU0VUVVAgVE5CIHZhcmlhYmxlcwoKCQkJCS8vIFRPRE8xIC0gaGF2ZSBhIC5pc0Nsb3NlZCBpbiBzcGxpbmU/CgoJCQkJc3BsaW5lVHViZSA9IGV4dHJ1ZGVQYXRoLmNvbXB1dGVGcmVuZXRGcmFtZXMoIHN0ZXBzLCBmYWxzZSApOwoKCQkJCS8vIGNvbnNvbGUubG9nKHNwbGluZVR1YmUsICdzcGxpbmVUdWJlJywgc3BsaW5lVHViZS5ub3JtYWxzLmxlbmd0aCwgJ3N0ZXBzJywgc3RlcHMsICdleHRydWRlUHRzJywgZXh0cnVkZVB0cy5sZW5ndGgpOwoKCQkJCWJpbm9ybWFsID0gbmV3IFZlY3RvcjMoKTsKCQkJCW5vcm1hbCA9IG5ldyBWZWN0b3IzKCk7CgkJCQlwb3NpdGlvbjIgPSBuZXcgVmVjdG9yMygpOwoKCQkJfQoKCQkJLy8gU2FmZWd1YXJkcyBpZiBiZXZlbHMgYXJlIG5vdCBlbmFibGVkCgoJCQlpZiAoICEgYmV2ZWxFbmFibGVkICkgewoKCQkJCWJldmVsU2VnbWVudHMgPSAwOwoJCQkJYmV2ZWxUaGlja25lc3MgPSAwOwoJCQkJYmV2ZWxTaXplID0gMDsKCQkJCWJldmVsT2Zmc2V0ID0gMDsKCgkJCX0KCgkJCS8vIFZhcmlhYmxlcyBpbml0aWFsaXphdGlvbgoKCQkJY29uc3Qgc2hhcGVQb2ludHMgPSBzaGFwZS5leHRyYWN0UG9pbnRzKCBjdXJ2ZVNlZ21lbnRzICk7CgoJCQlsZXQgdmVydGljZXMgPSBzaGFwZVBvaW50cy5zaGFwZTsKCQkJY29uc3QgaG9sZXMgPSBzaGFwZVBvaW50cy5ob2xlczsKCgkJCWNvbnN0IHJldmVyc2UgPSAhIFNoYXBlVXRpbHMuaXNDbG9ja1dpc2UoIHZlcnRpY2VzICk7CgoJCQlpZiAoIHJldmVyc2UgKSB7CgoJCQkJdmVydGljZXMgPSB2ZXJ0aWNlcy5yZXZlcnNlKCk7CgoJCQkJLy8gTWF5YmUgd2Ugc2hvdWxkIGFsc28gY2hlY2sgaWYgaG9sZXMgYXJlIGluIHRoZSBvcHBvc2l0ZSBkaXJlY3Rpb24sIGp1c3QgdG8gYmUgc2FmZSAuLi4KCgkJCQlmb3IgKCBsZXQgaCA9IDAsIGhsID0gaG9sZXMubGVuZ3RoOyBoIDwgaGw7IGggKysgKSB7CgoJCQkJCWNvbnN0IGFob2xlID0gaG9sZXNbIGggXTsKCgkJCQkJaWYgKCBTaGFwZVV0aWxzLmlzQ2xvY2tXaXNlKCBhaG9sZSApICkgewoKCQkJCQkJaG9sZXNbIGggXSA9IGFob2xlLnJldmVyc2UoKTsKCgkJCQkJfQoKCQkJCX0KCgkJCX0KCgoJCQljb25zdCBmYWNlcyA9IFNoYXBlVXRpbHMudHJpYW5ndWxhdGVTaGFwZSggdmVydGljZXMsIGhvbGVzICk7CgoJCQkvKiBWZXJ0aWNlcyAqLwoKCQkJY29uc3QgY29udG91ciA9IHZlcnRpY2VzOyAvLyB2ZXJ0aWNlcyBoYXMgYWxsIHBvaW50cyBidXQgY29udG91ciBoYXMgb25seSBwb2ludHMgb2YgY2lyY3VtZmVyZW5jZQoKCQkJZm9yICggbGV0IGggPSAwLCBobCA9IGhvbGVzLmxlbmd0aDsgaCA8IGhsOyBoICsrICkgewoKCQkJCWNvbnN0IGFob2xlID0gaG9sZXNbIGggXTsKCgkJCQl2ZXJ0aWNlcyA9IHZlcnRpY2VzLmNvbmNhdCggYWhvbGUgKTsKCgkJCX0KCgoJCQlmdW5jdGlvbiBzY2FsZVB0MiggcHQsIHZlYywgc2l6ZSApIHsKCgkJCQlpZiAoICEgdmVjICkgY29uc29sZS5lcnJvciggJ1RIUkVFLkV4dHJ1ZGVHZW9tZXRyeTogdmVjIGRvZXMgbm90IGV4aXN0JyApOwoKCQkJCXJldHVybiBwdC5jbG9uZSgpLmFkZFNjYWxlZFZlY3RvciggdmVjLCBzaXplICk7CgoJCQl9CgoJCQljb25zdCB2bGVuID0gdmVydGljZXMubGVuZ3RoLCBmbGVuID0gZmFjZXMubGVuZ3RoOwoKCgkJCS8vIEZpbmQgZGlyZWN0aW9ucyBmb3IgcG9pbnQgbW92ZW1lbnQKCgoJCQlmdW5jdGlvbiBnZXRCZXZlbFZlYyggaW5QdCwgaW5QcmV2LCBpbk5leHQgKSB7CgoJCQkJLy8gY29tcHV0ZXMgZm9yIGluUHQgdGhlIGNvcnJlc3BvbmRpbmcgcG9pbnQgaW5QdCcgb24gYSBuZXcgY29udG91cgoJCQkJLy8gICBzaGlmdGVkIGJ5IDEgdW5pdCAobGVuZ3RoIG9mIG5vcm1hbGl6ZWQgdmVjdG9yKSB0byB0aGUgbGVmdAoJCQkJLy8gaWYgd2Ugd2FsayBhbG9uZyBjb250b3VyIGNsb2Nrd2lzZSwgdGhpcyBuZXcgY29udG91ciBpcyBvdXRzaWRlIHRoZSBvbGQgb25lCgkJCQkvLwoJCQkJLy8gaW5QdCcgaXMgdGhlIGludGVyc2VjdGlvbiBvZiB0aGUgdHdvIGxpbmVzIHBhcmFsbGVsIHRvIHRoZSB0d28KCQkJCS8vICBhZGphY2VudCBlZGdlcyBvZiBpblB0IGF0IGEgZGlzdGFuY2Ugb2YgMSB1bml0IG9uIHRoZSBsZWZ0IHNpZGUuCgoJCQkJbGV0IHZfdHJhbnNfeCwgdl90cmFuc195LCBzaHJpbmtfYnk7IC8vIHJlc3VsdGluZyB0cmFuc2xhdGlvbiB2ZWN0b3IgZm9yIGluUHQKCgkJCQkvLyBnb29kIHJlYWRpbmcgZm9yIGdlb21ldHJ5IGFsZ29yaXRobXMgKGhlcmU6IGxpbmUtbGluZSBpbnRlcnNlY3Rpb24pCgkJCQkvLyBodHRwOi8vZ2VvbWFsZ29yaXRobXMuY29tL2EwNS1faW50ZXJzZWN0LTEuaHRtbAoKCQkJCWNvbnN0IHZfcHJldl94ID0gaW5QdC54IC0gaW5QcmV2LngsCgkJCQkJdl9wcmV2X3kgPSBpblB0LnkgLSBpblByZXYueTsKCQkJCWNvbnN0IHZfbmV4dF94ID0gaW5OZXh0LnggLSBpblB0LngsCgkJCQkJdl9uZXh0X3kgPSBpbk5leHQueSAtIGluUHQueTsKCgkJCQljb25zdCB2X3ByZXZfbGVuc3EgPSAoIHZfcHJldl94ICogdl9wcmV2X3ggKyB2X3ByZXZfeSAqIHZfcHJldl95ICk7CgoJCQkJLy8gY2hlY2sgZm9yIGNvbGxpbmVhciBlZGdlcwoJCQkJY29uc3QgY29sbGluZWFyMCA9ICggdl9wcmV2X3ggKiB2X25leHRfeSAtIHZfcHJldl95ICogdl9uZXh0X3ggKTsKCgkJCQlpZiAoIE1hdGguYWJzKCBjb2xsaW5lYXIwICkgPiBOdW1iZXIuRVBTSUxPTiApIHsKCgkJCQkJLy8gbm90IGNvbGxpbmVhcgoKCQkJCQkvLyBsZW5ndGggb2YgdmVjdG9ycyBmb3Igbm9ybWFsaXppbmcKCgkJCQkJY29uc3Qgdl9wcmV2X2xlbiA9IE1hdGguc3FydCggdl9wcmV2X2xlbnNxICk7CgkJCQkJY29uc3Qgdl9uZXh0X2xlbiA9IE1hdGguc3FydCggdl9uZXh0X3ggKiB2X25leHRfeCArIHZfbmV4dF95ICogdl9uZXh0X3kgKTsKCgkJCQkJLy8gc2hpZnQgYWRqYWNlbnQgcG9pbnRzIGJ5IHVuaXQgdmVjdG9ycyB0byB0aGUgbGVmdAoKCQkJCQljb25zdCBwdFByZXZTaGlmdF94ID0gKCBpblByZXYueCAtIHZfcHJldl95IC8gdl9wcmV2X2xlbiApOwoJCQkJCWNvbnN0IHB0UHJldlNoaWZ0X3kgPSAoIGluUHJldi55ICsgdl9wcmV2X3ggLyB2X3ByZXZfbGVuICk7CgoJCQkJCWNvbnN0IHB0TmV4dFNoaWZ0X3ggPSAoIGluTmV4dC54IC0gdl9uZXh0X3kgLyB2X25leHRfbGVuICk7CgkJCQkJY29uc3QgcHROZXh0U2hpZnRfeSA9ICggaW5OZXh0LnkgKyB2X25leHRfeCAvIHZfbmV4dF9sZW4gKTsKCgkJCQkJLy8gc2NhbGluZyBmYWN0b3IgZm9yIHZfcHJldiB0byBpbnRlcnNlY3Rpb24gcG9pbnQKCgkJCQkJY29uc3Qgc2YgPSAoICggcHROZXh0U2hpZnRfeCAtIHB0UHJldlNoaWZ0X3ggKSAqIHZfbmV4dF95IC0KCQkJCQkJCSggcHROZXh0U2hpZnRfeSAtIHB0UHJldlNoaWZ0X3kgKSAqIHZfbmV4dF94ICkgLwoJCQkJCQkoIHZfcHJldl94ICogdl9uZXh0X3kgLSB2X3ByZXZfeSAqIHZfbmV4dF94ICk7CgoJCQkJCS8vIHZlY3RvciBmcm9tIGluUHQgdG8gaW50ZXJzZWN0aW9uIHBvaW50CgoJCQkJCXZfdHJhbnNfeCA9ICggcHRQcmV2U2hpZnRfeCArIHZfcHJldl94ICogc2YgLSBpblB0LnggKTsKCQkJCQl2X3RyYW5zX3kgPSAoIHB0UHJldlNoaWZ0X3kgKyB2X3ByZXZfeSAqIHNmIC0gaW5QdC55ICk7CgoJCQkJCS8vIERvbid0IG5vcm1hbGl6ZSEsIG90aGVyd2lzZSBzaGFycCBjb3JuZXJzIGJlY29tZSB1Z2x5CgkJCQkJLy8gIGJ1dCBwcmV2ZW50IGNyYXp5IHNwaWtlcwoJCQkJCWNvbnN0IHZfdHJhbnNfbGVuc3EgPSAoIHZfdHJhbnNfeCAqIHZfdHJhbnNfeCArIHZfdHJhbnNfeSAqIHZfdHJhbnNfeSApOwoJCQkJCWlmICggdl90cmFuc19sZW5zcSA8PSAyICkgewoKCQkJCQkJcmV0dXJuIG5ldyBWZWN0b3IyKCB2X3RyYW5zX3gsIHZfdHJhbnNfeSApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJc2hyaW5rX2J5ID0gTWF0aC5zcXJ0KCB2X3RyYW5zX2xlbnNxIC8gMiApOwoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gaGFuZGxlIHNwZWNpYWwgY2FzZSBvZiBjb2xsaW5lYXIgZWRnZXMKCgkJCQkJbGV0IGRpcmVjdGlvbl9lcSA9IGZhbHNlOyAvLyBhc3N1bWVzOiBvcHBvc2l0ZQoKCQkJCQlpZiAoIHZfcHJldl94ID4gTnVtYmVyLkVQU0lMT04gKSB7CgoJCQkJCQlpZiAoIHZfbmV4dF94ID4gTnVtYmVyLkVQU0lMT04gKSB7CgoJCQkJCQkJZGlyZWN0aW9uX2VxID0gdHJ1ZTsKCgkJCQkJCX0KCgkJCQkJfSBlbHNlIHsKCgkJCQkJCWlmICggdl9wcmV2X3ggPCAtIE51bWJlci5FUFNJTE9OICkgewoKCQkJCQkJCWlmICggdl9uZXh0X3ggPCAtIE51bWJlci5FUFNJTE9OICkgewoKCQkJCQkJCQlkaXJlY3Rpb25fZXEgPSB0cnVlOwoKCQkJCQkJCX0KCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJaWYgKCBNYXRoLnNpZ24oIHZfcHJldl95ICkgPT09IE1hdGguc2lnbiggdl9uZXh0X3kgKSApIHsKCgkJCQkJCQkJZGlyZWN0aW9uX2VxID0gdHJ1ZTsKCgkJCQkJCQl9CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQkJaWYgKCBkaXJlY3Rpb25fZXEgKSB7CgoJCQkJCQkvLyBjb25zb2xlLmxvZygiV2FybmluZzogbGluZXMgYXJlIGEgc3RyYWlnaHQgc2VxdWVuY2UiKTsKCQkJCQkJdl90cmFuc194ID0gLSB2X3ByZXZfeTsKCQkJCQkJdl90cmFuc195ID0gdl9wcmV2X3g7CgkJCQkJCXNocmlua19ieSA9IE1hdGguc3FydCggdl9wcmV2X2xlbnNxICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQkvLyBjb25zb2xlLmxvZygiV2FybmluZzogbGluZXMgYXJlIGEgc3RyYWlnaHQgc3Bpa2UiKTsKCQkJCQkJdl90cmFuc194ID0gdl9wcmV2X3g7CgkJCQkJCXZfdHJhbnNfeSA9IHZfcHJldl95OwoJCQkJCQlzaHJpbmtfYnkgPSBNYXRoLnNxcnQoIHZfcHJldl9sZW5zcSAvIDIgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQlyZXR1cm4gbmV3IFZlY3RvcjIoIHZfdHJhbnNfeCAvIHNocmlua19ieSwgdl90cmFuc195IC8gc2hyaW5rX2J5ICk7CgoJCQl9CgoKCQkJY29uc3QgY29udG91ck1vdmVtZW50cyA9IFtdOwoKCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGNvbnRvdXIubGVuZ3RoLCBqID0gaWwgLSAxLCBrID0gaSArIDE7IGkgPCBpbDsgaSArKywgaiArKywgayArKyApIHsKCgkJCQlpZiAoIGogPT09IGlsICkgaiA9IDA7CgkJCQlpZiAoIGsgPT09IGlsICkgayA9IDA7CgoJCQkJLy8gIChqKS0tLShpKS0tLShrKQoJCQkJLy8gY29uc29sZS5sb2coJ2ksaixrJywgaSwgaiAsIGspCgoJCQkJY29udG91ck1vdmVtZW50c1sgaSBdID0gZ2V0QmV2ZWxWZWMoIGNvbnRvdXJbIGkgXSwgY29udG91clsgaiBdLCBjb250b3VyWyBrIF0gKTsKCgkJCX0KCgkJCWNvbnN0IGhvbGVzTW92ZW1lbnRzID0gW107CgkJCWxldCBvbmVIb2xlTW92ZW1lbnRzLCB2ZXJ0aWNlc01vdmVtZW50cyA9IGNvbnRvdXJNb3ZlbWVudHMuY29uY2F0KCk7CgoJCQlmb3IgKCBsZXQgaCA9IDAsIGhsID0gaG9sZXMubGVuZ3RoOyBoIDwgaGw7IGggKysgKSB7CgoJCQkJY29uc3QgYWhvbGUgPSBob2xlc1sgaCBdOwoKCQkJCW9uZUhvbGVNb3ZlbWVudHMgPSBbXTsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gYWhvbGUubGVuZ3RoLCBqID0gaWwgLSAxLCBrID0gaSArIDE7IGkgPCBpbDsgaSArKywgaiArKywgayArKyApIHsKCgkJCQkJaWYgKCBqID09PSBpbCApIGogPSAwOwoJCQkJCWlmICggayA9PT0gaWwgKSBrID0gMDsKCgkJCQkJLy8gIChqKS0tLShpKS0tLShrKQoJCQkJCW9uZUhvbGVNb3ZlbWVudHNbIGkgXSA9IGdldEJldmVsVmVjKCBhaG9sZVsgaSBdLCBhaG9sZVsgaiBdLCBhaG9sZVsgayBdICk7CgoJCQkJfQoKCQkJCWhvbGVzTW92ZW1lbnRzLnB1c2goIG9uZUhvbGVNb3ZlbWVudHMgKTsKCQkJCXZlcnRpY2VzTW92ZW1lbnRzID0gdmVydGljZXNNb3ZlbWVudHMuY29uY2F0KCBvbmVIb2xlTW92ZW1lbnRzICk7CgoJCQl9CgoKCQkJLy8gTG9vcCBiZXZlbFNlZ21lbnRzLCAxIGZvciB0aGUgZnJvbnQsIDEgZm9yIHRoZSBiYWNrCgoJCQlmb3IgKCBsZXQgYiA9IDA7IGIgPCBiZXZlbFNlZ21lbnRzOyBiICsrICkgewoKCQkJCS8vZm9yICggYiA9IGJldmVsU2VnbWVudHM7IGIgPiAwOyBiIC0tICkgewoKCQkJCWNvbnN0IHQgPSBiIC8gYmV2ZWxTZWdtZW50czsKCQkJCWNvbnN0IHogPSBiZXZlbFRoaWNrbmVzcyAqIE1hdGguY29zKCB0ICogTWF0aC5QSSAvIDIgKTsKCQkJCWNvbnN0IGJzID0gYmV2ZWxTaXplICogTWF0aC5zaW4oIHQgKiBNYXRoLlBJIC8gMiApICsgYmV2ZWxPZmZzZXQ7CgoJCQkJLy8gY29udHJhY3Qgc2hhcGUKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gY29udG91ci5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJY29uc3QgdmVydCA9IHNjYWxlUHQyKCBjb250b3VyWyBpIF0sIGNvbnRvdXJNb3ZlbWVudHNbIGkgXSwgYnMgKTsKCgkJCQkJdiggdmVydC54LCB2ZXJ0LnksIC0geiApOwoKCQkJCX0KCgkJCQkvLyBleHBhbmQgaG9sZXMKCgkJCQlmb3IgKCBsZXQgaCA9IDAsIGhsID0gaG9sZXMubGVuZ3RoOyBoIDwgaGw7IGggKysgKSB7CgoJCQkJCWNvbnN0IGFob2xlID0gaG9sZXNbIGggXTsKCQkJCQlvbmVIb2xlTW92ZW1lbnRzID0gaG9sZXNNb3ZlbWVudHNbIGggXTsKCgkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGFob2xlLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQkJY29uc3QgdmVydCA9IHNjYWxlUHQyKCBhaG9sZVsgaSBdLCBvbmVIb2xlTW92ZW1lbnRzWyBpIF0sIGJzICk7CgoJCQkJCQl2KCB2ZXJ0LngsIHZlcnQueSwgLSB6ICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQljb25zdCBicyA9IGJldmVsU2l6ZSArIGJldmVsT2Zmc2V0OwoKCQkJLy8gQmFjayBmYWNpbmcgdmVydGljZXMKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IHZsZW47IGkgKysgKSB7CgoJCQkJY29uc3QgdmVydCA9IGJldmVsRW5hYmxlZCA/IHNjYWxlUHQyKCB2ZXJ0aWNlc1sgaSBdLCB2ZXJ0aWNlc01vdmVtZW50c1sgaSBdLCBicyApIDogdmVydGljZXNbIGkgXTsKCgkJCQlpZiAoICEgZXh0cnVkZUJ5UGF0aCApIHsKCgkJCQkJdiggdmVydC54LCB2ZXJ0LnksIDAgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQkvLyB2KCB2ZXJ0LngsIHZlcnQueSArIGV4dHJ1ZGVQdHNbIDAgXS55LCBleHRydWRlUHRzWyAwIF0ueCApOwoKCQkJCQlub3JtYWwuY29weSggc3BsaW5lVHViZS5ub3JtYWxzWyAwIF0gKS5tdWx0aXBseVNjYWxhciggdmVydC54ICk7CgkJCQkJYmlub3JtYWwuY29weSggc3BsaW5lVHViZS5iaW5vcm1hbHNbIDAgXSApLm11bHRpcGx5U2NhbGFyKCB2ZXJ0LnkgKTsKCgkJCQkJcG9zaXRpb24yLmNvcHkoIGV4dHJ1ZGVQdHNbIDAgXSApLmFkZCggbm9ybWFsICkuYWRkKCBiaW5vcm1hbCApOwoKCQkJCQl2KCBwb3NpdGlvbjIueCwgcG9zaXRpb24yLnksIHBvc2l0aW9uMi56ICk7CgoJCQkJfQoKCQkJfQoKCQkJLy8gQWRkIHN0ZXBwZWQgdmVydGljZXMuLi4KCQkJLy8gSW5jbHVkaW5nIGZyb250IGZhY2luZyB2ZXJ0aWNlcwoKCQkJZm9yICggbGV0IHMgPSAxOyBzIDw9IHN0ZXBzOyBzICsrICkgewoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHZsZW47IGkgKysgKSB7CgoJCQkJCWNvbnN0IHZlcnQgPSBiZXZlbEVuYWJsZWQgPyBzY2FsZVB0MiggdmVydGljZXNbIGkgXSwgdmVydGljZXNNb3ZlbWVudHNbIGkgXSwgYnMgKSA6IHZlcnRpY2VzWyBpIF07CgoJCQkJCWlmICggISBleHRydWRlQnlQYXRoICkgewoKCQkJCQkJdiggdmVydC54LCB2ZXJ0LnksIGRlcHRoIC8gc3RlcHMgKiBzICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQkvLyB2KCB2ZXJ0LngsIHZlcnQueSArIGV4dHJ1ZGVQdHNbIHMgLSAxIF0ueSwgZXh0cnVkZVB0c1sgcyAtIDEgXS54ICk7CgoJCQkJCQlub3JtYWwuY29weSggc3BsaW5lVHViZS5ub3JtYWxzWyBzIF0gKS5tdWx0aXBseVNjYWxhciggdmVydC54ICk7CgkJCQkJCWJpbm9ybWFsLmNvcHkoIHNwbGluZVR1YmUuYmlub3JtYWxzWyBzIF0gKS5tdWx0aXBseVNjYWxhciggdmVydC55ICk7CgoJCQkJCQlwb3NpdGlvbjIuY29weSggZXh0cnVkZVB0c1sgcyBdICkuYWRkKCBub3JtYWwgKS5hZGQoIGJpbm9ybWFsICk7CgoJCQkJCQl2KCBwb3NpdGlvbjIueCwgcG9zaXRpb24yLnksIHBvc2l0aW9uMi56ICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoKCQkJLy8gQWRkIGJldmVsIHNlZ21lbnRzIHBsYW5lcwoKCQkJLy9mb3IgKCBiID0gMTsgYiA8PSBiZXZlbFNlZ21lbnRzOyBiICsrICkgewoJCQlmb3IgKCBsZXQgYiA9IGJldmVsU2VnbWVudHMgLSAxOyBiID49IDA7IGIgLS0gKSB7CgoJCQkJY29uc3QgdCA9IGIgLyBiZXZlbFNlZ21lbnRzOwoJCQkJY29uc3QgeiA9IGJldmVsVGhpY2tuZXNzICogTWF0aC5jb3MoIHQgKiBNYXRoLlBJIC8gMiApOwoJCQkJY29uc3QgYnMgPSBiZXZlbFNpemUgKiBNYXRoLnNpbiggdCAqIE1hdGguUEkgLyAyICkgKyBiZXZlbE9mZnNldDsKCgkJCQkvLyBjb250cmFjdCBzaGFwZQoKCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBjb250b3VyLmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJCQljb25zdCB2ZXJ0ID0gc2NhbGVQdDIoIGNvbnRvdXJbIGkgXSwgY29udG91ck1vdmVtZW50c1sgaSBdLCBicyApOwoJCQkJCXYoIHZlcnQueCwgdmVydC55LCBkZXB0aCArIHogKTsKCgkJCQl9CgoJCQkJLy8gZXhwYW5kIGhvbGVzCgoJCQkJZm9yICggbGV0IGggPSAwLCBobCA9IGhvbGVzLmxlbmd0aDsgaCA8IGhsOyBoICsrICkgewoKCQkJCQljb25zdCBhaG9sZSA9IGhvbGVzWyBoIF07CgkJCQkJb25lSG9sZU1vdmVtZW50cyA9IGhvbGVzTW92ZW1lbnRzWyBoIF07CgoJCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBhaG9sZS5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCWNvbnN0IHZlcnQgPSBzY2FsZVB0MiggYWhvbGVbIGkgXSwgb25lSG9sZU1vdmVtZW50c1sgaSBdLCBicyApOwoKCQkJCQkJaWYgKCAhIGV4dHJ1ZGVCeVBhdGggKSB7CgoJCQkJCQkJdiggdmVydC54LCB2ZXJ0LnksIGRlcHRoICsgeiApOwoKCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQl2KCB2ZXJ0LngsIHZlcnQueSArIGV4dHJ1ZGVQdHNbIHN0ZXBzIC0gMSBdLnksIGV4dHJ1ZGVQdHNbIHN0ZXBzIC0gMSBdLnggKyB6ICk7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQkvKiBGYWNlcyAqLwoKCQkJLy8gVG9wIGFuZCBib3R0b20gZmFjZXMKCgkJCWJ1aWxkTGlkRmFjZXMoKTsKCgkJCS8vIFNpZGVzIGZhY2VzCgoJCQlidWlsZFNpZGVGYWNlcygpOwoKCgkJCS8vLy8vICBJbnRlcm5hbCBmdW5jdGlvbnMKCgkJCWZ1bmN0aW9uIGJ1aWxkTGlkRmFjZXMoKSB7CgoJCQkJY29uc3Qgc3RhcnQgPSB2ZXJ0aWNlc0FycmF5Lmxlbmd0aCAvIDM7CgoJCQkJaWYgKCBiZXZlbEVuYWJsZWQgKSB7CgoJCQkJCWxldCBsYXllciA9IDA7IC8vIHN0ZXBzICsgMQoJCQkJCWxldCBvZmZzZXQgPSB2bGVuICogbGF5ZXI7CgoJCQkJCS8vIEJvdHRvbSBmYWNlcwoKCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBmbGVuOyBpICsrICkgewoKCQkJCQkJY29uc3QgZmFjZSA9IGZhY2VzWyBpIF07CgkJCQkJCWYzKCBmYWNlWyAyIF0gKyBvZmZzZXQsIGZhY2VbIDEgXSArIG9mZnNldCwgZmFjZVsgMCBdICsgb2Zmc2V0ICk7CgoJCQkJCX0KCgkJCQkJbGF5ZXIgPSBzdGVwcyArIGJldmVsU2VnbWVudHMgKiAyOwoJCQkJCW9mZnNldCA9IHZsZW4gKiBsYXllcjsKCgkJCQkJLy8gVG9wIGZhY2VzCgoJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IGZsZW47IGkgKysgKSB7CgoJCQkJCQljb25zdCBmYWNlID0gZmFjZXNbIGkgXTsKCQkJCQkJZjMoIGZhY2VbIDAgXSArIG9mZnNldCwgZmFjZVsgMSBdICsgb2Zmc2V0LCBmYWNlWyAyIF0gKyBvZmZzZXQgKTsKCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCS8vIEJvdHRvbSBmYWNlcwoKCQkJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBmbGVuOyBpICsrICkgewoKCQkJCQkJY29uc3QgZmFjZSA9IGZhY2VzWyBpIF07CgkJCQkJCWYzKCBmYWNlWyAyIF0sIGZhY2VbIDEgXSwgZmFjZVsgMCBdICk7CgoJCQkJCX0KCgkJCQkJLy8gVG9wIGZhY2VzCgoJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IGZsZW47IGkgKysgKSB7CgoJCQkJCQljb25zdCBmYWNlID0gZmFjZXNbIGkgXTsKCQkJCQkJZjMoIGZhY2VbIDAgXSArIHZsZW4gKiBzdGVwcywgZmFjZVsgMSBdICsgdmxlbiAqIHN0ZXBzLCBmYWNlWyAyIF0gKyB2bGVuICogc3RlcHMgKTsKCgkJCQkJfQoKCQkJCX0KCgkJCQlzY29wZS5hZGRHcm91cCggc3RhcnQsIHZlcnRpY2VzQXJyYXkubGVuZ3RoIC8gMyAtIHN0YXJ0LCAwICk7CgoJCQl9CgoJCQkvLyBDcmVhdGUgZmFjZXMgZm9yIHRoZSB6LXNpZGVzIG9mIHRoZSBzaGFwZQoKCQkJZnVuY3Rpb24gYnVpbGRTaWRlRmFjZXMoKSB7CgoJCQkJY29uc3Qgc3RhcnQgPSB2ZXJ0aWNlc0FycmF5Lmxlbmd0aCAvIDM7CgkJCQlsZXQgbGF5ZXJvZmZzZXQgPSAwOwoJCQkJc2lkZXdhbGxzKCBjb250b3VyLCBsYXllcm9mZnNldCApOwoJCQkJbGF5ZXJvZmZzZXQgKz0gY29udG91ci5sZW5ndGg7CgoJCQkJZm9yICggbGV0IGggPSAwLCBobCA9IGhvbGVzLmxlbmd0aDsgaCA8IGhsOyBoICsrICkgewoKCQkJCQljb25zdCBhaG9sZSA9IGhvbGVzWyBoIF07CgkJCQkJc2lkZXdhbGxzKCBhaG9sZSwgbGF5ZXJvZmZzZXQgKTsKCgkJCQkJLy8sIHRydWUKCQkJCQlsYXllcm9mZnNldCArPSBhaG9sZS5sZW5ndGg7CgoJCQkJfQoKCgkJCQlzY29wZS5hZGRHcm91cCggc3RhcnQsIHZlcnRpY2VzQXJyYXkubGVuZ3RoIC8gMyAtIHN0YXJ0LCAxICk7CgoKCQkJfQoKCQkJZnVuY3Rpb24gc2lkZXdhbGxzKCBjb250b3VyLCBsYXllcm9mZnNldCApIHsKCgkJCQlsZXQgaSA9IGNvbnRvdXIubGVuZ3RoOwoKCQkJCXdoaWxlICggLS0gaSA+PSAwICkgewoKCQkJCQljb25zdCBqID0gaTsKCQkJCQlsZXQgayA9IGkgLSAxOwoJCQkJCWlmICggayA8IDAgKSBrID0gY29udG91ci5sZW5ndGggLSAxOwoKCQkJCQkvL2NvbnNvbGUubG9nKCdiJywgaSxqLCBpLTEsIGssdmVydGljZXMubGVuZ3RoKTsKCgkJCQkJZm9yICggbGV0IHMgPSAwLCBzbCA9ICggc3RlcHMgKyBiZXZlbFNlZ21lbnRzICogMiApOyBzIDwgc2w7IHMgKysgKSB7CgoJCQkJCQljb25zdCBzbGVuMSA9IHZsZW4gKiBzOwoJCQkJCQljb25zdCBzbGVuMiA9IHZsZW4gKiAoIHMgKyAxICk7CgoJCQkJCQljb25zdCBhID0gbGF5ZXJvZmZzZXQgKyBqICsgc2xlbjEsCgkJCQkJCQliID0gbGF5ZXJvZmZzZXQgKyBrICsgc2xlbjEsCgkJCQkJCQljID0gbGF5ZXJvZmZzZXQgKyBrICsgc2xlbjIsCgkJCQkJCQlkID0gbGF5ZXJvZmZzZXQgKyBqICsgc2xlbjI7CgoJCQkJCQlmNCggYSwgYiwgYywgZCApOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJZnVuY3Rpb24gdiggeCwgeSwgeiApIHsKCgkJCQlwbGFjZWhvbGRlci5wdXNoKCB4ICk7CgkJCQlwbGFjZWhvbGRlci5wdXNoKCB5ICk7CgkJCQlwbGFjZWhvbGRlci5wdXNoKCB6ICk7CgoJCQl9CgoKCQkJZnVuY3Rpb24gZjMoIGEsIGIsIGMgKSB7CgoJCQkJYWRkVmVydGV4KCBhICk7CgkJCQlhZGRWZXJ0ZXgoIGIgKTsKCQkJCWFkZFZlcnRleCggYyApOwoKCQkJCWNvbnN0IG5leHRJbmRleCA9IHZlcnRpY2VzQXJyYXkubGVuZ3RoIC8gMzsKCQkJCWNvbnN0IHV2cyA9IHV2Z2VuLmdlbmVyYXRlVG9wVVYoIHNjb3BlLCB2ZXJ0aWNlc0FycmF5LCBuZXh0SW5kZXggLSAzLCBuZXh0SW5kZXggLSAyLCBuZXh0SW5kZXggLSAxICk7CgoJCQkJYWRkVVYoIHV2c1sgMCBdICk7CgkJCQlhZGRVViggdXZzWyAxIF0gKTsKCQkJCWFkZFVWKCB1dnNbIDIgXSApOwoKCQkJfQoKCQkJZnVuY3Rpb24gZjQoIGEsIGIsIGMsIGQgKSB7CgoJCQkJYWRkVmVydGV4KCBhICk7CgkJCQlhZGRWZXJ0ZXgoIGIgKTsKCQkJCWFkZFZlcnRleCggZCApOwoKCQkJCWFkZFZlcnRleCggYiApOwoJCQkJYWRkVmVydGV4KCBjICk7CgkJCQlhZGRWZXJ0ZXgoIGQgKTsKCgoJCQkJY29uc3QgbmV4dEluZGV4ID0gdmVydGljZXNBcnJheS5sZW5ndGggLyAzOwoJCQkJY29uc3QgdXZzID0gdXZnZW4uZ2VuZXJhdGVTaWRlV2FsbFVWKCBzY29wZSwgdmVydGljZXNBcnJheSwgbmV4dEluZGV4IC0gNiwgbmV4dEluZGV4IC0gMywgbmV4dEluZGV4IC0gMiwgbmV4dEluZGV4IC0gMSApOwoKCQkJCWFkZFVWKCB1dnNbIDAgXSApOwoJCQkJYWRkVVYoIHV2c1sgMSBdICk7CgkJCQlhZGRVViggdXZzWyAzIF0gKTsKCgkJCQlhZGRVViggdXZzWyAxIF0gKTsKCQkJCWFkZFVWKCB1dnNbIDIgXSApOwoJCQkJYWRkVVYoIHV2c1sgMyBdICk7CgoJCQl9CgoJCQlmdW5jdGlvbiBhZGRWZXJ0ZXgoIGluZGV4ICkgewoKCQkJCXZlcnRpY2VzQXJyYXkucHVzaCggcGxhY2Vob2xkZXJbIGluZGV4ICogMyArIDAgXSApOwoJCQkJdmVydGljZXNBcnJheS5wdXNoKCBwbGFjZWhvbGRlclsgaW5kZXggKiAzICsgMSBdICk7CgkJCQl2ZXJ0aWNlc0FycmF5LnB1c2goIHBsYWNlaG9sZGVyWyBpbmRleCAqIDMgKyAyIF0gKTsKCgkJCX0KCgoJCQlmdW5jdGlvbiBhZGRVViggdmVjdG9yMiApIHsKCgkJCQl1dkFycmF5LnB1c2goIHZlY3RvcjIueCApOwoJCQkJdXZBcnJheS5wdXNoKCB2ZWN0b3IyLnkgKTsKCgkJCX0KCgkJfQoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSBPYmplY3QuYXNzaWduKCB7fSwgc291cmNlLnBhcmFtZXRlcnMgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTigpIHsKCgkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTigpOwoKCQljb25zdCBzaGFwZXMgPSB0aGlzLnBhcmFtZXRlcnMuc2hhcGVzOwoJCWNvbnN0IG9wdGlvbnMgPSB0aGlzLnBhcmFtZXRlcnMub3B0aW9uczsKCgkJcmV0dXJuIHRvSlNPTiQxKCBzaGFwZXMsIG9wdGlvbnMsIGRhdGEgKTsKCgl9CgoJc3RhdGljIGZyb21KU09OKCBkYXRhLCBzaGFwZXMgKSB7CgoJCWNvbnN0IGdlb21ldHJ5U2hhcGVzID0gW107CgoJCWZvciAoIGxldCBqID0gMCwgamwgPSBkYXRhLnNoYXBlcy5sZW5ndGg7IGogPCBqbDsgaiArKyApIHsKCgkJCWNvbnN0IHNoYXBlID0gc2hhcGVzWyBkYXRhLnNoYXBlc1sgaiBdIF07CgoJCQlnZW9tZXRyeVNoYXBlcy5wdXNoKCBzaGFwZSApOwoKCQl9CgoJCWNvbnN0IGV4dHJ1ZGVQYXRoID0gZGF0YS5vcHRpb25zLmV4dHJ1ZGVQYXRoOwoKCQlpZiAoIGV4dHJ1ZGVQYXRoICE9PSB1bmRlZmluZWQgKSB7CgoJCQlkYXRhLm9wdGlvbnMuZXh0cnVkZVBhdGggPSBuZXcgQ3VydmVzWyBleHRydWRlUGF0aC50eXBlIF0oKS5mcm9tSlNPTiggZXh0cnVkZVBhdGggKTsKCgkJfQoKCQlyZXR1cm4gbmV3IEV4dHJ1ZGVHZW9tZXRyeSggZ2VvbWV0cnlTaGFwZXMsIGRhdGEub3B0aW9ucyApOwoKCX0KCn0KCmNvbnN0IFdvcmxkVVZHZW5lcmF0b3IgPSB7CgoJZ2VuZXJhdGVUb3BVVjogZnVuY3Rpb24gKCBnZW9tZXRyeSwgdmVydGljZXMsIGluZGV4QSwgaW5kZXhCLCBpbmRleEMgKSB7CgoJCWNvbnN0IGFfeCA9IHZlcnRpY2VzWyBpbmRleEEgKiAzIF07CgkJY29uc3QgYV95ID0gdmVydGljZXNbIGluZGV4QSAqIDMgKyAxIF07CgkJY29uc3QgYl94ID0gdmVydGljZXNbIGluZGV4QiAqIDMgXTsKCQljb25zdCBiX3kgPSB2ZXJ0aWNlc1sgaW5kZXhCICogMyArIDEgXTsKCQljb25zdCBjX3ggPSB2ZXJ0aWNlc1sgaW5kZXhDICogMyBdOwoJCWNvbnN0IGNfeSA9IHZlcnRpY2VzWyBpbmRleEMgKiAzICsgMSBdOwoKCQlyZXR1cm4gWwoJCQluZXcgVmVjdG9yMiggYV94LCBhX3kgKSwKCQkJbmV3IFZlY3RvcjIoIGJfeCwgYl95ICksCgkJCW5ldyBWZWN0b3IyKCBjX3gsIGNfeSApCgkJXTsKCgl9LAoKCWdlbmVyYXRlU2lkZVdhbGxVVjogZnVuY3Rpb24gKCBnZW9tZXRyeSwgdmVydGljZXMsIGluZGV4QSwgaW5kZXhCLCBpbmRleEMsIGluZGV4RCApIHsKCgkJY29uc3QgYV94ID0gdmVydGljZXNbIGluZGV4QSAqIDMgXTsKCQljb25zdCBhX3kgPSB2ZXJ0aWNlc1sgaW5kZXhBICogMyArIDEgXTsKCQljb25zdCBhX3ogPSB2ZXJ0aWNlc1sgaW5kZXhBICogMyArIDIgXTsKCQljb25zdCBiX3ggPSB2ZXJ0aWNlc1sgaW5kZXhCICogMyBdOwoJCWNvbnN0IGJfeSA9IHZlcnRpY2VzWyBpbmRleEIgKiAzICsgMSBdOwoJCWNvbnN0IGJfeiA9IHZlcnRpY2VzWyBpbmRleEIgKiAzICsgMiBdOwoJCWNvbnN0IGNfeCA9IHZlcnRpY2VzWyBpbmRleEMgKiAzIF07CgkJY29uc3QgY195ID0gdmVydGljZXNbIGluZGV4QyAqIDMgKyAxIF07CgkJY29uc3QgY196ID0gdmVydGljZXNbIGluZGV4QyAqIDMgKyAyIF07CgkJY29uc3QgZF94ID0gdmVydGljZXNbIGluZGV4RCAqIDMgXTsKCQljb25zdCBkX3kgPSB2ZXJ0aWNlc1sgaW5kZXhEICogMyArIDEgXTsKCQljb25zdCBkX3ogPSB2ZXJ0aWNlc1sgaW5kZXhEICogMyArIDIgXTsKCgkJaWYgKCBNYXRoLmFicyggYV95IC0gYl95ICkgPCBNYXRoLmFicyggYV94IC0gYl94ICkgKSB7CgoJCQlyZXR1cm4gWwoJCQkJbmV3IFZlY3RvcjIoIGFfeCwgMSAtIGFfeiApLAoJCQkJbmV3IFZlY3RvcjIoIGJfeCwgMSAtIGJfeiApLAoJCQkJbmV3IFZlY3RvcjIoIGNfeCwgMSAtIGNfeiApLAoJCQkJbmV3IFZlY3RvcjIoIGRfeCwgMSAtIGRfeiApCgkJCV07CgoJCX0gZWxzZSB7CgoJCQlyZXR1cm4gWwoJCQkJbmV3IFZlY3RvcjIoIGFfeSwgMSAtIGFfeiApLAoJCQkJbmV3IFZlY3RvcjIoIGJfeSwgMSAtIGJfeiApLAoJCQkJbmV3IFZlY3RvcjIoIGNfeSwgMSAtIGNfeiApLAoJCQkJbmV3IFZlY3RvcjIoIGRfeSwgMSAtIGRfeiApCgkJCV07CgoJCX0KCgl9Cgp9OwoKZnVuY3Rpb24gdG9KU09OJDEoIHNoYXBlcywgb3B0aW9ucywgZGF0YSApIHsKCglkYXRhLnNoYXBlcyA9IFtdOwoKCWlmICggQXJyYXkuaXNBcnJheSggc2hhcGVzICkgKSB7CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHNoYXBlcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJY29uc3Qgc2hhcGUgPSBzaGFwZXNbIGkgXTsKCgkJCWRhdGEuc2hhcGVzLnB1c2goIHNoYXBlLnV1aWQgKTsKCgkJfQoKCX0gZWxzZSB7CgoJCWRhdGEuc2hhcGVzLnB1c2goIHNoYXBlcy51dWlkICk7CgoJfQoKCWRhdGEub3B0aW9ucyA9IE9iamVjdC5hc3NpZ24oIHt9LCBvcHRpb25zICk7CgoJaWYgKCBvcHRpb25zLmV4dHJ1ZGVQYXRoICE9PSB1bmRlZmluZWQgKSBkYXRhLm9wdGlvbnMuZXh0cnVkZVBhdGggPSBvcHRpb25zLmV4dHJ1ZGVQYXRoLnRvSlNPTigpOwoKCXJldHVybiBkYXRhOwoKfQoKY2xhc3MgSWNvc2FoZWRyb25HZW9tZXRyeSBleHRlbmRzIFBvbHloZWRyb25HZW9tZXRyeSB7CgoJY29uc3RydWN0b3IoIHJhZGl1cyA9IDEsIGRldGFpbCA9IDAgKSB7CgoJCWNvbnN0IHQgPSAoIDEgKyBNYXRoLnNxcnQoIDUgKSApIC8gMjsKCgkJY29uc3QgdmVydGljZXMgPSBbCgkJCS0gMSwgdCwgMCwgCTEsIHQsIDAsIAktIDEsIC0gdCwgMCwgCTEsIC0gdCwgMCwKCQkJMCwgLSAxLCB0LCAJMCwgMSwgdCwJMCwgLSAxLCAtIHQsIAkwLCAxLCAtIHQsCgkJCXQsIDAsIC0gMSwgCXQsIDAsIDEsIAktIHQsIDAsIC0gMSwgCS0gdCwgMCwgMQoJCV07CgoJCWNvbnN0IGluZGljZXMgPSBbCgkJCTAsIDExLCA1LCAJMCwgNSwgMSwgCTAsIDEsIDcsIAkwLCA3LCAxMCwgCTAsIDEwLCAxMSwKCQkJMSwgNSwgOSwgCTUsIDExLCA0LAkxMSwgMTAsIDIsCTEwLCA3LCA2LAk3LCAxLCA4LAoJCQkzLCA5LCA0LCAJMywgNCwgMiwJMywgMiwgNiwJMywgNiwgOCwJMywgOCwgOSwKCQkJNCwgOSwgNSwgCTIsIDQsIDExLAk2LCAyLCAxMCwJOCwgNiwgNywJOSwgOCwgMQoJCV07CgoJCXN1cGVyKCB2ZXJ0aWNlcywgaW5kaWNlcywgcmFkaXVzLCBkZXRhaWwgKTsKCgkJdGhpcy50eXBlID0gJ0ljb3NhaGVkcm9uR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXJhZGl1czogcmFkaXVzLAoJCQlkZXRhaWw6IGRldGFpbAoJCX07CgoJfQoKCXN0YXRpYyBmcm9tSlNPTiggZGF0YSApIHsKCgkJcmV0dXJuIG5ldyBJY29zYWhlZHJvbkdlb21ldHJ5KCBkYXRhLnJhZGl1cywgZGF0YS5kZXRhaWwgKTsKCgl9Cgp9CgpjbGFzcyBPY3RhaGVkcm9uR2VvbWV0cnkgZXh0ZW5kcyBQb2x5aGVkcm9uR2VvbWV0cnkgewoKCWNvbnN0cnVjdG9yKCByYWRpdXMgPSAxLCBkZXRhaWwgPSAwICkgewoKCQljb25zdCB2ZXJ0aWNlcyA9IFsKCQkJMSwgMCwgMCwgCS0gMSwgMCwgMCwJMCwgMSwgMCwKCQkJMCwgLSAxLCAwLCAJMCwgMCwgMSwJMCwgMCwgLSAxCgkJXTsKCgkJY29uc3QgaW5kaWNlcyA9IFsKCQkJMCwgMiwgNCwJMCwgNCwgMywJMCwgMywgNSwKCQkJMCwgNSwgMiwJMSwgMiwgNSwJMSwgNSwgMywKCQkJMSwgMywgNCwJMSwgNCwgMgoJCV07CgoJCXN1cGVyKCB2ZXJ0aWNlcywgaW5kaWNlcywgcmFkaXVzLCBkZXRhaWwgKTsKCgkJdGhpcy50eXBlID0gJ09jdGFoZWRyb25HZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJcmFkaXVzOiByYWRpdXMsCgkJCWRldGFpbDogZGV0YWlsCgkJfTsKCgl9CgoJc3RhdGljIGZyb21KU09OKCBkYXRhICkgewoKCQlyZXR1cm4gbmV3IE9jdGFoZWRyb25HZW9tZXRyeSggZGF0YS5yYWRpdXMsIGRhdGEuZGV0YWlsICk7CgoJfQoKfQoKY2xhc3MgUmluZ0dlb21ldHJ5IGV4dGVuZHMgQnVmZmVyR2VvbWV0cnkgewoKCWNvbnN0cnVjdG9yKCBpbm5lclJhZGl1cyA9IDAuNSwgb3V0ZXJSYWRpdXMgPSAxLCB0aGV0YVNlZ21lbnRzID0gMzIsIHBoaVNlZ21lbnRzID0gMSwgdGhldGFTdGFydCA9IDAsIHRoZXRhTGVuZ3RoID0gTWF0aC5QSSAqIDIgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMudHlwZSA9ICdSaW5nR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCWlubmVyUmFkaXVzOiBpbm5lclJhZGl1cywKCQkJb3V0ZXJSYWRpdXM6IG91dGVyUmFkaXVzLAoJCQl0aGV0YVNlZ21lbnRzOiB0aGV0YVNlZ21lbnRzLAoJCQlwaGlTZWdtZW50czogcGhpU2VnbWVudHMsCgkJCXRoZXRhU3RhcnQ6IHRoZXRhU3RhcnQsCgkJCXRoZXRhTGVuZ3RoOiB0aGV0YUxlbmd0aAoJCX07CgoJCXRoZXRhU2VnbWVudHMgPSBNYXRoLm1heCggMywgdGhldGFTZWdtZW50cyApOwoJCXBoaVNlZ21lbnRzID0gTWF0aC5tYXgoIDEsIHBoaVNlZ21lbnRzICk7CgoJCS8vIGJ1ZmZlcnMKCgkJY29uc3QgaW5kaWNlcyA9IFtdOwoJCWNvbnN0IHZlcnRpY2VzID0gW107CgkJY29uc3Qgbm9ybWFscyA9IFtdOwoJCWNvbnN0IHV2cyA9IFtdOwoKCQkvLyBzb21lIGhlbHBlciB2YXJpYWJsZXMKCgkJbGV0IHJhZGl1cyA9IGlubmVyUmFkaXVzOwoJCWNvbnN0IHJhZGl1c1N0ZXAgPSAoICggb3V0ZXJSYWRpdXMgLSBpbm5lclJhZGl1cyApIC8gcGhpU2VnbWVudHMgKTsKCQljb25zdCB2ZXJ0ZXggPSBuZXcgVmVjdG9yMygpOwoJCWNvbnN0IHV2ID0gbmV3IFZlY3RvcjIoKTsKCgkJLy8gZ2VuZXJhdGUgdmVydGljZXMsIG5vcm1hbHMgYW5kIHV2cwoKCQlmb3IgKCBsZXQgaiA9IDA7IGogPD0gcGhpU2VnbWVudHM7IGogKysgKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPD0gdGhldGFTZWdtZW50czsgaSArKyApIHsKCgkJCQkvLyB2YWx1ZXMgYXJlIGdlbmVyYXRlIGZyb20gdGhlIGluc2lkZSBvZiB0aGUgcmluZyB0byB0aGUgb3V0c2lkZQoKCQkJCWNvbnN0IHNlZ21lbnQgPSB0aGV0YVN0YXJ0ICsgaSAvIHRoZXRhU2VnbWVudHMgKiB0aGV0YUxlbmd0aDsKCgkJCQkvLyB2ZXJ0ZXgKCgkJCQl2ZXJ0ZXgueCA9IHJhZGl1cyAqIE1hdGguY29zKCBzZWdtZW50ICk7CgkJCQl2ZXJ0ZXgueSA9IHJhZGl1cyAqIE1hdGguc2luKCBzZWdtZW50ICk7CgoJCQkJdmVydGljZXMucHVzaCggdmVydGV4LngsIHZlcnRleC55LCB2ZXJ0ZXgueiApOwoKCQkJCS8vIG5vcm1hbAoKCQkJCW5vcm1hbHMucHVzaCggMCwgMCwgMSApOwoKCQkJCS8vIHV2CgoJCQkJdXYueCA9ICggdmVydGV4LnggLyBvdXRlclJhZGl1cyArIDEgKSAvIDI7CgkJCQl1di55ID0gKCB2ZXJ0ZXgueSAvIG91dGVyUmFkaXVzICsgMSApIC8gMjsKCgkJCQl1dnMucHVzaCggdXYueCwgdXYueSApOwoKCQkJfQoKCQkJLy8gaW5jcmVhc2UgdGhlIHJhZGl1cyBmb3IgbmV4dCByb3cgb2YgdmVydGljZXMKCgkJCXJhZGl1cyArPSByYWRpdXNTdGVwOwoKCQl9CgoJCS8vIGluZGljZXMKCgkJZm9yICggbGV0IGogPSAwOyBqIDwgcGhpU2VnbWVudHM7IGogKysgKSB7CgoJCQljb25zdCB0aGV0YVNlZ21lbnRMZXZlbCA9IGogKiAoIHRoZXRhU2VnbWVudHMgKyAxICk7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB0aGV0YVNlZ21lbnRzOyBpICsrICkgewoKCQkJCWNvbnN0IHNlZ21lbnQgPSBpICsgdGhldGFTZWdtZW50TGV2ZWw7CgoJCQkJY29uc3QgYSA9IHNlZ21lbnQ7CgkJCQljb25zdCBiID0gc2VnbWVudCArIHRoZXRhU2VnbWVudHMgKyAxOwoJCQkJY29uc3QgYyA9IHNlZ21lbnQgKyB0aGV0YVNlZ21lbnRzICsgMjsKCQkJCWNvbnN0IGQgPSBzZWdtZW50ICsgMTsKCgkJCQkvLyBmYWNlcwoKCQkJCWluZGljZXMucHVzaCggYSwgYiwgZCApOwoJCQkJaW5kaWNlcy5wdXNoKCBiLCBjLCBkICk7CgoJCQl9CgoJCX0KCgkJLy8gYnVpbGQgZ2VvbWV0cnkKCgkJdGhpcy5zZXRJbmRleCggaW5kaWNlcyApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAnbm9ybWFsJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbHMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAndXYnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdXZzLCAyICkgKTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5wYXJhbWV0ZXJzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzdGF0aWMgZnJvbUpTT04oIGRhdGEgKSB7CgoJCXJldHVybiBuZXcgUmluZ0dlb21ldHJ5KCBkYXRhLmlubmVyUmFkaXVzLCBkYXRhLm91dGVyUmFkaXVzLCBkYXRhLnRoZXRhU2VnbWVudHMsIGRhdGEucGhpU2VnbWVudHMsIGRhdGEudGhldGFTdGFydCwgZGF0YS50aGV0YUxlbmd0aCApOwoKCX0KCn0KCmNsYXNzIFNoYXBlR2VvbWV0cnkgZXh0ZW5kcyBCdWZmZXJHZW9tZXRyeSB7CgoJY29uc3RydWN0b3IoIHNoYXBlcyA9IG5ldyBTaGFwZSggWyBuZXcgVmVjdG9yMiggMCwgMC41ICksIG5ldyBWZWN0b3IyKCAtIDAuNSwgLSAwLjUgKSwgbmV3IFZlY3RvcjIoIDAuNSwgLSAwLjUgKSBdICksIGN1cnZlU2VnbWVudHMgPSAxMiApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy50eXBlID0gJ1NoYXBlR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXNoYXBlczogc2hhcGVzLAoJCQljdXJ2ZVNlZ21lbnRzOiBjdXJ2ZVNlZ21lbnRzCgkJfTsKCgkJLy8gYnVmZmVycwoKCQljb25zdCBpbmRpY2VzID0gW107CgkJY29uc3QgdmVydGljZXMgPSBbXTsKCQljb25zdCBub3JtYWxzID0gW107CgkJY29uc3QgdXZzID0gW107CgoJCS8vIGhlbHBlciB2YXJpYWJsZXMKCgkJbGV0IGdyb3VwU3RhcnQgPSAwOwoJCWxldCBncm91cENvdW50ID0gMDsKCgkJLy8gYWxsb3cgc2luZ2xlIGFuZCBhcnJheSB2YWx1ZXMgZm9yICJzaGFwZXMiIHBhcmFtZXRlcgoKCQlpZiAoIEFycmF5LmlzQXJyYXkoIHNoYXBlcyApID09PSBmYWxzZSApIHsKCgkJCWFkZFNoYXBlKCBzaGFwZXMgKTsKCgkJfSBlbHNlIHsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IHNoYXBlcy5sZW5ndGg7IGkgKysgKSB7CgoJCQkJYWRkU2hhcGUoIHNoYXBlc1sgaSBdICk7CgoJCQkJdGhpcy5hZGRHcm91cCggZ3JvdXBTdGFydCwgZ3JvdXBDb3VudCwgaSApOyAvLyBlbmFibGVzIE11bHRpTWF0ZXJpYWwgc3VwcG9ydAoKCQkJCWdyb3VwU3RhcnQgKz0gZ3JvdXBDb3VudDsKCQkJCWdyb3VwQ291bnQgPSAwOwoKCQkJfQoKCQl9CgoJCS8vIGJ1aWxkIGdlb21ldHJ5CgoJCXRoaXMuc2V0SW5kZXgoIGluZGljZXMgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzLCAzICkgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBub3JtYWxzLCAzICkgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3V2JywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHV2cywgMiApICk7CgoKCQkvLyBoZWxwZXIgZnVuY3Rpb25zCgoJCWZ1bmN0aW9uIGFkZFNoYXBlKCBzaGFwZSApIHsKCgkJCWNvbnN0IGluZGV4T2Zmc2V0ID0gdmVydGljZXMubGVuZ3RoIC8gMzsKCQkJY29uc3QgcG9pbnRzID0gc2hhcGUuZXh0cmFjdFBvaW50cyggY3VydmVTZWdtZW50cyApOwoKCQkJbGV0IHNoYXBlVmVydGljZXMgPSBwb2ludHMuc2hhcGU7CgkJCWNvbnN0IHNoYXBlSG9sZXMgPSBwb2ludHMuaG9sZXM7CgoJCQkvLyBjaGVjayBkaXJlY3Rpb24gb2YgdmVydGljZXMKCgkJCWlmICggU2hhcGVVdGlscy5pc0Nsb2NrV2lzZSggc2hhcGVWZXJ0aWNlcyApID09PSBmYWxzZSApIHsKCgkJCQlzaGFwZVZlcnRpY2VzID0gc2hhcGVWZXJ0aWNlcy5yZXZlcnNlKCk7CgoJCQl9CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBzaGFwZUhvbGVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJY29uc3Qgc2hhcGVIb2xlID0gc2hhcGVIb2xlc1sgaSBdOwoKCQkJCWlmICggU2hhcGVVdGlscy5pc0Nsb2NrV2lzZSggc2hhcGVIb2xlICkgPT09IHRydWUgKSB7CgoJCQkJCXNoYXBlSG9sZXNbIGkgXSA9IHNoYXBlSG9sZS5yZXZlcnNlKCk7CgoJCQkJfQoKCQkJfQoKCQkJY29uc3QgZmFjZXMgPSBTaGFwZVV0aWxzLnRyaWFuZ3VsYXRlU2hhcGUoIHNoYXBlVmVydGljZXMsIHNoYXBlSG9sZXMgKTsKCgkJCS8vIGpvaW4gdmVydGljZXMgb2YgaW5uZXIgYW5kIG91dGVyIHBhdGhzIHRvIGEgc2luZ2xlIGFycmF5CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBzaGFwZUhvbGVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJY29uc3Qgc2hhcGVIb2xlID0gc2hhcGVIb2xlc1sgaSBdOwoJCQkJc2hhcGVWZXJ0aWNlcyA9IHNoYXBlVmVydGljZXMuY29uY2F0KCBzaGFwZUhvbGUgKTsKCgkJCX0KCgkJCS8vIHZlcnRpY2VzLCBub3JtYWxzLCB1dnMKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IHNoYXBlVmVydGljZXMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQljb25zdCB2ZXJ0ZXggPSBzaGFwZVZlcnRpY2VzWyBpIF07CgoJCQkJdmVydGljZXMucHVzaCggdmVydGV4LngsIHZlcnRleC55LCAwICk7CgkJCQlub3JtYWxzLnB1c2goIDAsIDAsIDEgKTsKCQkJCXV2cy5wdXNoKCB2ZXJ0ZXgueCwgdmVydGV4LnkgKTsgLy8gd29ybGQgdXZzCgoJCQl9CgoJCQkvLyBpbmRpY2VzCgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBmYWNlcy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWNvbnN0IGZhY2UgPSBmYWNlc1sgaSBdOwoKCQkJCWNvbnN0IGEgPSBmYWNlWyAwIF0gKyBpbmRleE9mZnNldDsKCQkJCWNvbnN0IGIgPSBmYWNlWyAxIF0gKyBpbmRleE9mZnNldDsKCQkJCWNvbnN0IGMgPSBmYWNlWyAyIF0gKyBpbmRleE9mZnNldDsKCgkJCQlpbmRpY2VzLnB1c2goIGEsIGIsIGMgKTsKCQkJCWdyb3VwQ291bnQgKz0gMzsKCgkJCX0KCgkJfQoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSBPYmplY3QuYXNzaWduKCB7fSwgc291cmNlLnBhcmFtZXRlcnMgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTigpIHsKCgkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTigpOwoKCQljb25zdCBzaGFwZXMgPSB0aGlzLnBhcmFtZXRlcnMuc2hhcGVzOwoKCQlyZXR1cm4gdG9KU09OKCBzaGFwZXMsIGRhdGEgKTsKCgl9CgoJc3RhdGljIGZyb21KU09OKCBkYXRhLCBzaGFwZXMgKSB7CgoJCWNvbnN0IGdlb21ldHJ5U2hhcGVzID0gW107CgoJCWZvciAoIGxldCBqID0gMCwgamwgPSBkYXRhLnNoYXBlcy5sZW5ndGg7IGogPCBqbDsgaiArKyApIHsKCgkJCWNvbnN0IHNoYXBlID0gc2hhcGVzWyBkYXRhLnNoYXBlc1sgaiBdIF07CgoJCQlnZW9tZXRyeVNoYXBlcy5wdXNoKCBzaGFwZSApOwoKCQl9CgoJCXJldHVybiBuZXcgU2hhcGVHZW9tZXRyeSggZ2VvbWV0cnlTaGFwZXMsIGRhdGEuY3VydmVTZWdtZW50cyApOwoKCX0KCn0KCmZ1bmN0aW9uIHRvSlNPTiggc2hhcGVzLCBkYXRhICkgewoKCWRhdGEuc2hhcGVzID0gW107CgoJaWYgKCBBcnJheS5pc0FycmF5KCBzaGFwZXMgKSApIHsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gc2hhcGVzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQljb25zdCBzaGFwZSA9IHNoYXBlc1sgaSBdOwoKCQkJZGF0YS5zaGFwZXMucHVzaCggc2hhcGUudXVpZCApOwoKCQl9CgoJfSBlbHNlIHsKCgkJZGF0YS5zaGFwZXMucHVzaCggc2hhcGVzLnV1aWQgKTsKCgl9CgoJcmV0dXJuIGRhdGE7Cgp9CgpjbGFzcyBTcGhlcmVHZW9tZXRyeSBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKCgljb25zdHJ1Y3RvciggcmFkaXVzID0gMSwgd2lkdGhTZWdtZW50cyA9IDMyLCBoZWlnaHRTZWdtZW50cyA9IDE2LCBwaGlTdGFydCA9IDAsIHBoaUxlbmd0aCA9IE1hdGguUEkgKiAyLCB0aGV0YVN0YXJ0ID0gMCwgdGhldGFMZW5ndGggPSBNYXRoLlBJICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLnR5cGUgPSAnU3BoZXJlR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXJhZGl1czogcmFkaXVzLAoJCQl3aWR0aFNlZ21lbnRzOiB3aWR0aFNlZ21lbnRzLAoJCQloZWlnaHRTZWdtZW50czogaGVpZ2h0U2VnbWVudHMsCgkJCXBoaVN0YXJ0OiBwaGlTdGFydCwKCQkJcGhpTGVuZ3RoOiBwaGlMZW5ndGgsCgkJCXRoZXRhU3RhcnQ6IHRoZXRhU3RhcnQsCgkJCXRoZXRhTGVuZ3RoOiB0aGV0YUxlbmd0aAoJCX07CgoJCXdpZHRoU2VnbWVudHMgPSBNYXRoLm1heCggMywgTWF0aC5mbG9vciggd2lkdGhTZWdtZW50cyApICk7CgkJaGVpZ2h0U2VnbWVudHMgPSBNYXRoLm1heCggMiwgTWF0aC5mbG9vciggaGVpZ2h0U2VnbWVudHMgKSApOwoKCQljb25zdCB0aGV0YUVuZCA9IE1hdGgubWluKCB0aGV0YVN0YXJ0ICsgdGhldGFMZW5ndGgsIE1hdGguUEkgKTsKCgkJbGV0IGluZGV4ID0gMDsKCQljb25zdCBncmlkID0gW107CgoJCWNvbnN0IHZlcnRleCA9IG5ldyBWZWN0b3IzKCk7CgkJY29uc3Qgbm9ybWFsID0gbmV3IFZlY3RvcjMoKTsKCgkJLy8gYnVmZmVycwoKCQljb25zdCBpbmRpY2VzID0gW107CgkJY29uc3QgdmVydGljZXMgPSBbXTsKCQljb25zdCBub3JtYWxzID0gW107CgkJY29uc3QgdXZzID0gW107CgoJCS8vIGdlbmVyYXRlIHZlcnRpY2VzLCBub3JtYWxzIGFuZCB1dnMKCgkJZm9yICggbGV0IGl5ID0gMDsgaXkgPD0gaGVpZ2h0U2VnbWVudHM7IGl5ICsrICkgewoKCQkJY29uc3QgdmVydGljZXNSb3cgPSBbXTsKCgkJCWNvbnN0IHYgPSBpeSAvIGhlaWdodFNlZ21lbnRzOwoKCQkJLy8gc3BlY2lhbCBjYXNlIGZvciB0aGUgcG9sZXMKCgkJCWxldCB1T2Zmc2V0ID0gMDsKCgkJCWlmICggaXkgPT09IDAgJiYgdGhldGFTdGFydCA9PT0gMCApIHsKCgkJCQl1T2Zmc2V0ID0gMC41IC8gd2lkdGhTZWdtZW50czsKCgkJCX0gZWxzZSBpZiAoIGl5ID09PSBoZWlnaHRTZWdtZW50cyAmJiB0aGV0YUVuZCA9PT0gTWF0aC5QSSApIHsKCgkJCQl1T2Zmc2V0ID0gLSAwLjUgLyB3aWR0aFNlZ21lbnRzOwoKCQkJfQoKCQkJZm9yICggbGV0IGl4ID0gMDsgaXggPD0gd2lkdGhTZWdtZW50czsgaXggKysgKSB7CgoJCQkJY29uc3QgdSA9IGl4IC8gd2lkdGhTZWdtZW50czsKCgkJCQkvLyB2ZXJ0ZXgKCgkJCQl2ZXJ0ZXgueCA9IC0gcmFkaXVzICogTWF0aC5jb3MoIHBoaVN0YXJ0ICsgdSAqIHBoaUxlbmd0aCApICogTWF0aC5zaW4oIHRoZXRhU3RhcnQgKyB2ICogdGhldGFMZW5ndGggKTsKCQkJCXZlcnRleC55ID0gcmFkaXVzICogTWF0aC5jb3MoIHRoZXRhU3RhcnQgKyB2ICogdGhldGFMZW5ndGggKTsKCQkJCXZlcnRleC56ID0gcmFkaXVzICogTWF0aC5zaW4oIHBoaVN0YXJ0ICsgdSAqIHBoaUxlbmd0aCApICogTWF0aC5zaW4oIHRoZXRhU3RhcnQgKyB2ICogdGhldGFMZW5ndGggKTsKCgkJCQl2ZXJ0aWNlcy5wdXNoKCB2ZXJ0ZXgueCwgdmVydGV4LnksIHZlcnRleC56ICk7CgoJCQkJLy8gbm9ybWFsCgoJCQkJbm9ybWFsLmNvcHkoIHZlcnRleCApLm5vcm1hbGl6ZSgpOwoJCQkJbm9ybWFscy5wdXNoKCBub3JtYWwueCwgbm9ybWFsLnksIG5vcm1hbC56ICk7CgoJCQkJLy8gdXYKCgkJCQl1dnMucHVzaCggdSArIHVPZmZzZXQsIDEgLSB2ICk7CgoJCQkJdmVydGljZXNSb3cucHVzaCggaW5kZXggKysgKTsKCgkJCX0KCgkJCWdyaWQucHVzaCggdmVydGljZXNSb3cgKTsKCgkJfQoKCQkvLyBpbmRpY2VzCgoJCWZvciAoIGxldCBpeSA9IDA7IGl5IDwgaGVpZ2h0U2VnbWVudHM7IGl5ICsrICkgewoKCQkJZm9yICggbGV0IGl4ID0gMDsgaXggPCB3aWR0aFNlZ21lbnRzOyBpeCArKyApIHsKCgkJCQljb25zdCBhID0gZ3JpZFsgaXkgXVsgaXggKyAxIF07CgkJCQljb25zdCBiID0gZ3JpZFsgaXkgXVsgaXggXTsKCQkJCWNvbnN0IGMgPSBncmlkWyBpeSArIDEgXVsgaXggXTsKCQkJCWNvbnN0IGQgPSBncmlkWyBpeSArIDEgXVsgaXggKyAxIF07CgoJCQkJaWYgKCBpeSAhPT0gMCB8fCB0aGV0YVN0YXJ0ID4gMCApIGluZGljZXMucHVzaCggYSwgYiwgZCApOwoJCQkJaWYgKCBpeSAhPT0gaGVpZ2h0U2VnbWVudHMgLSAxIHx8IHRoZXRhRW5kIDwgTWF0aC5QSSApIGluZGljZXMucHVzaCggYiwgYywgZCApOwoKCQkJfQoKCQl9CgoJCS8vIGJ1aWxkIGdlb21ldHJ5CgoJCXRoaXMuc2V0SW5kZXgoIGluZGljZXMgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzLCAzICkgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ25vcm1hbCcsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBub3JtYWxzLCAzICkgKTsKCQl0aGlzLnNldEF0dHJpYnV0ZSggJ3V2JywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHV2cywgMiApICk7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMucGFyYW1ldGVycyA9IE9iamVjdC5hc3NpZ24oIHt9LCBzb3VyY2UucGFyYW1ldGVycyApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc3RhdGljIGZyb21KU09OKCBkYXRhICkgewoKCQlyZXR1cm4gbmV3IFNwaGVyZUdlb21ldHJ5KCBkYXRhLnJhZGl1cywgZGF0YS53aWR0aFNlZ21lbnRzLCBkYXRhLmhlaWdodFNlZ21lbnRzLCBkYXRhLnBoaVN0YXJ0LCBkYXRhLnBoaUxlbmd0aCwgZGF0YS50aGV0YVN0YXJ0LCBkYXRhLnRoZXRhTGVuZ3RoICk7CgoJfQoKfQoKY2xhc3MgVGV0cmFoZWRyb25HZW9tZXRyeSBleHRlbmRzIFBvbHloZWRyb25HZW9tZXRyeSB7CgoJY29uc3RydWN0b3IoIHJhZGl1cyA9IDEsIGRldGFpbCA9IDAgKSB7CgoJCWNvbnN0IHZlcnRpY2VzID0gWwoJCQkxLCAxLCAxLCAJLSAxLCAtIDEsIDEsIAktIDEsIDEsIC0gMSwgCTEsIC0gMSwgLSAxCgkJXTsKCgkJY29uc3QgaW5kaWNlcyA9IFsKCQkJMiwgMSwgMCwgCTAsIDMsIDIsCTEsIDMsIDAsCTIsIDMsIDEKCQldOwoKCQlzdXBlciggdmVydGljZXMsIGluZGljZXMsIHJhZGl1cywgZGV0YWlsICk7CgoJCXRoaXMudHlwZSA9ICdUZXRyYWhlZHJvbkdlb21ldHJ5JzsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gewoJCQlyYWRpdXM6IHJhZGl1cywKCQkJZGV0YWlsOiBkZXRhaWwKCQl9OwoKCX0KCglzdGF0aWMgZnJvbUpTT04oIGRhdGEgKSB7CgoJCXJldHVybiBuZXcgVGV0cmFoZWRyb25HZW9tZXRyeSggZGF0YS5yYWRpdXMsIGRhdGEuZGV0YWlsICk7CgoJfQoKfQoKY2xhc3MgVG9ydXNHZW9tZXRyeSBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKCgljb25zdHJ1Y3RvciggcmFkaXVzID0gMSwgdHViZSA9IDAuNCwgcmFkaWFsU2VnbWVudHMgPSAxMiwgdHVidWxhclNlZ21lbnRzID0gNDgsIGFyYyA9IE1hdGguUEkgKiAyICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLnR5cGUgPSAnVG9ydXNHZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJcmFkaXVzOiByYWRpdXMsCgkJCXR1YmU6IHR1YmUsCgkJCXJhZGlhbFNlZ21lbnRzOiByYWRpYWxTZWdtZW50cywKCQkJdHVidWxhclNlZ21lbnRzOiB0dWJ1bGFyU2VnbWVudHMsCgkJCWFyYzogYXJjCgkJfTsKCgkJcmFkaWFsU2VnbWVudHMgPSBNYXRoLmZsb29yKCByYWRpYWxTZWdtZW50cyApOwoJCXR1YnVsYXJTZWdtZW50cyA9IE1hdGguZmxvb3IoIHR1YnVsYXJTZWdtZW50cyApOwoKCQkvLyBidWZmZXJzCgoJCWNvbnN0IGluZGljZXMgPSBbXTsKCQljb25zdCB2ZXJ0aWNlcyA9IFtdOwoJCWNvbnN0IG5vcm1hbHMgPSBbXTsKCQljb25zdCB1dnMgPSBbXTsKCgkJLy8gaGVscGVyIHZhcmlhYmxlcwoKCQljb25zdCBjZW50ZXIgPSBuZXcgVmVjdG9yMygpOwoJCWNvbnN0IHZlcnRleCA9IG5ldyBWZWN0b3IzKCk7CgkJY29uc3Qgbm9ybWFsID0gbmV3IFZlY3RvcjMoKTsKCgkJLy8gZ2VuZXJhdGUgdmVydGljZXMsIG5vcm1hbHMgYW5kIHV2cwoKCQlmb3IgKCBsZXQgaiA9IDA7IGogPD0gcmFkaWFsU2VnbWVudHM7IGogKysgKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpICsrICkgewoKCQkJCWNvbnN0IHUgPSBpIC8gdHVidWxhclNlZ21lbnRzICogYXJjOwoJCQkJY29uc3QgdiA9IGogLyByYWRpYWxTZWdtZW50cyAqIE1hdGguUEkgKiAyOwoKCQkJCS8vIHZlcnRleAoKCQkJCXZlcnRleC54ID0gKCByYWRpdXMgKyB0dWJlICogTWF0aC5jb3MoIHYgKSApICogTWF0aC5jb3MoIHUgKTsKCQkJCXZlcnRleC55ID0gKCByYWRpdXMgKyB0dWJlICogTWF0aC5jb3MoIHYgKSApICogTWF0aC5zaW4oIHUgKTsKCQkJCXZlcnRleC56ID0gdHViZSAqIE1hdGguc2luKCB2ICk7CgoJCQkJdmVydGljZXMucHVzaCggdmVydGV4LngsIHZlcnRleC55LCB2ZXJ0ZXgueiApOwoKCQkJCS8vIG5vcm1hbAoKCQkJCWNlbnRlci54ID0gcmFkaXVzICogTWF0aC5jb3MoIHUgKTsKCQkJCWNlbnRlci55ID0gcmFkaXVzICogTWF0aC5zaW4oIHUgKTsKCQkJCW5vcm1hbC5zdWJWZWN0b3JzKCB2ZXJ0ZXgsIGNlbnRlciApLm5vcm1hbGl6ZSgpOwoKCQkJCW5vcm1hbHMucHVzaCggbm9ybWFsLngsIG5vcm1hbC55LCBub3JtYWwueiApOwoKCQkJCS8vIHV2CgoJCQkJdXZzLnB1c2goIGkgLyB0dWJ1bGFyU2VnbWVudHMgKTsKCQkJCXV2cy5wdXNoKCBqIC8gcmFkaWFsU2VnbWVudHMgKTsKCgkJCX0KCgkJfQoKCQkvLyBnZW5lcmF0ZSBpbmRpY2VzCgoJCWZvciAoIGxldCBqID0gMTsgaiA8PSByYWRpYWxTZWdtZW50czsgaiArKyApIHsKCgkJCWZvciAoIGxldCBpID0gMTsgaSA8PSB0dWJ1bGFyU2VnbWVudHM7IGkgKysgKSB7CgoJCQkJLy8gaW5kaWNlcwoKCQkJCWNvbnN0IGEgPSAoIHR1YnVsYXJTZWdtZW50cyArIDEgKSAqIGogKyBpIC0gMTsKCQkJCWNvbnN0IGIgPSAoIHR1YnVsYXJTZWdtZW50cyArIDEgKSAqICggaiAtIDEgKSArIGkgLSAxOwoJCQkJY29uc3QgYyA9ICggdHVidWxhclNlZ21lbnRzICsgMSApICogKCBqIC0gMSApICsgaTsKCQkJCWNvbnN0IGQgPSAoIHR1YnVsYXJTZWdtZW50cyArIDEgKSAqIGogKyBpOwoKCQkJCS8vIGZhY2VzCgoJCQkJaW5kaWNlcy5wdXNoKCBhLCBiLCBkICk7CgkJCQlpbmRpY2VzLnB1c2goIGIsIGMsIGQgKTsKCgkJCX0KCgkJfQoKCQkvLyBidWlsZCBnZW9tZXRyeQoKCQl0aGlzLnNldEluZGV4KCBpbmRpY2VzICk7CgkJdGhpcy5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlcywgMyApICk7CgkJdGhpcy5zZXRBdHRyaWJ1dGUoICdub3JtYWwnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFscywgMyApICk7CgkJdGhpcy5zZXRBdHRyaWJ1dGUoICd1dicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB1dnMsIDIgKSApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSBPYmplY3QuYXNzaWduKCB7fSwgc291cmNlLnBhcmFtZXRlcnMgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXN0YXRpYyBmcm9tSlNPTiggZGF0YSApIHsKCgkJcmV0dXJuIG5ldyBUb3J1c0dlb21ldHJ5KCBkYXRhLnJhZGl1cywgZGF0YS50dWJlLCBkYXRhLnJhZGlhbFNlZ21lbnRzLCBkYXRhLnR1YnVsYXJTZWdtZW50cywgZGF0YS5hcmMgKTsKCgl9Cgp9CgpjbGFzcyBUb3J1c0tub3RHZW9tZXRyeSBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKCgljb25zdHJ1Y3RvciggcmFkaXVzID0gMSwgdHViZSA9IDAuNCwgdHVidWxhclNlZ21lbnRzID0gNjQsIHJhZGlhbFNlZ21lbnRzID0gOCwgcCA9IDIsIHEgPSAzICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLnR5cGUgPSAnVG9ydXNLbm90R2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXJhZGl1czogcmFkaXVzLAoJCQl0dWJlOiB0dWJlLAoJCQl0dWJ1bGFyU2VnbWVudHM6IHR1YnVsYXJTZWdtZW50cywKCQkJcmFkaWFsU2VnbWVudHM6IHJhZGlhbFNlZ21lbnRzLAoJCQlwOiBwLAoJCQlxOiBxCgkJfTsKCgkJdHVidWxhclNlZ21lbnRzID0gTWF0aC5mbG9vciggdHVidWxhclNlZ21lbnRzICk7CgkJcmFkaWFsU2VnbWVudHMgPSBNYXRoLmZsb29yKCByYWRpYWxTZWdtZW50cyApOwoKCQkvLyBidWZmZXJzCgoJCWNvbnN0IGluZGljZXMgPSBbXTsKCQljb25zdCB2ZXJ0aWNlcyA9IFtdOwoJCWNvbnN0IG5vcm1hbHMgPSBbXTsKCQljb25zdCB1dnMgPSBbXTsKCgkJLy8gaGVscGVyIHZhcmlhYmxlcwoKCQljb25zdCB2ZXJ0ZXggPSBuZXcgVmVjdG9yMygpOwoJCWNvbnN0IG5vcm1hbCA9IG5ldyBWZWN0b3IzKCk7CgoJCWNvbnN0IFAxID0gbmV3IFZlY3RvcjMoKTsKCQljb25zdCBQMiA9IG5ldyBWZWN0b3IzKCk7CgoJCWNvbnN0IEIgPSBuZXcgVmVjdG9yMygpOwoJCWNvbnN0IFQgPSBuZXcgVmVjdG9yMygpOwoJCWNvbnN0IE4gPSBuZXcgVmVjdG9yMygpOwoKCQkvLyBnZW5lcmF0ZSB2ZXJ0aWNlcywgbm9ybWFscyBhbmQgdXZzCgoJCWZvciAoIGxldCBpID0gMDsgaSA8PSB0dWJ1bGFyU2VnbWVudHM7ICsrIGkgKSB7CgoJCQkvLyB0aGUgcmFkaWFuICJ1IiBpcyB1c2VkIHRvIGNhbGN1bGF0ZSB0aGUgcG9zaXRpb24gb24gdGhlIHRvcnVzIGN1cnZlIG9mIHRoZSBjdXJyZW50IHR1YnVsYXIgc2VnbWVudAoKCQkJY29uc3QgdSA9IGkgLyB0dWJ1bGFyU2VnbWVudHMgKiBwICogTWF0aC5QSSAqIDI7CgoJCQkvLyBub3cgd2UgY2FsY3VsYXRlIHR3byBwb2ludHMuIFAxIGlzIG91ciBjdXJyZW50IHBvc2l0aW9uIG9uIHRoZSBjdXJ2ZSwgUDIgaXMgYSBsaXR0bGUgZmFydGhlciBhaGVhZC4KCQkJLy8gdGhlc2UgcG9pbnRzIGFyZSB1c2VkIHRvIGNyZWF0ZSBhIHNwZWNpYWwgImNvb3JkaW5hdGUgc3BhY2UiLCB3aGljaCBpcyBuZWNlc3NhcnkgdG8gY2FsY3VsYXRlIHRoZSBjb3JyZWN0IHZlcnRleCBwb3NpdGlvbnMKCgkJCWNhbGN1bGF0ZVBvc2l0aW9uT25DdXJ2ZSggdSwgcCwgcSwgcmFkaXVzLCBQMSApOwoJCQljYWxjdWxhdGVQb3NpdGlvbk9uQ3VydmUoIHUgKyAwLjAxLCBwLCBxLCByYWRpdXMsIFAyICk7CgoJCQkvLyBjYWxjdWxhdGUgb3J0aG9ub3JtYWwgYmFzaXMKCgkJCVQuc3ViVmVjdG9ycyggUDIsIFAxICk7CgkJCU4uYWRkVmVjdG9ycyggUDIsIFAxICk7CgkJCUIuY3Jvc3NWZWN0b3JzKCBULCBOICk7CgkJCU4uY3Jvc3NWZWN0b3JzKCBCLCBUICk7CgoJCQkvLyBub3JtYWxpemUgQiwgTi4gVCBjYW4gYmUgaWdub3JlZCwgd2UgZG9uJ3QgdXNlIGl0CgoJCQlCLm5vcm1hbGl6ZSgpOwoJCQlOLm5vcm1hbGl6ZSgpOwoKCQkJZm9yICggbGV0IGogPSAwOyBqIDw9IHJhZGlhbFNlZ21lbnRzOyArKyBqICkgewoKCQkJCS8vIG5vdyBjYWxjdWxhdGUgdGhlIHZlcnRpY2VzLiB0aGV5IGFyZSBub3RoaW5nIG1vcmUgdGhhbiBhbiBleHRydXNpb24gb2YgdGhlIHRvcnVzIGN1cnZlLgoJCQkJLy8gYmVjYXVzZSB3ZSBleHRydWRlIGEgc2hhcGUgaW4gdGhlIHh5LXBsYW5lLCB0aGVyZSBpcyBubyBuZWVkIHRvIGNhbGN1bGF0ZSBhIHotdmFsdWUuCgoJCQkJY29uc3QgdiA9IGogLyByYWRpYWxTZWdtZW50cyAqIE1hdGguUEkgKiAyOwoJCQkJY29uc3QgY3ggPSAtIHR1YmUgKiBNYXRoLmNvcyggdiApOwoJCQkJY29uc3QgY3kgPSB0dWJlICogTWF0aC5zaW4oIHYgKTsKCgkJCQkvLyBub3cgY2FsY3VsYXRlIHRoZSBmaW5hbCB2ZXJ0ZXggcG9zaXRpb24uCgkJCQkvLyBmaXJzdCB3ZSBvcmllbnQgdGhlIGV4dHJ1c2lvbiB3aXRoIG91ciBiYXNpcyB2ZWN0b3JzLCB0aGVuIHdlIGFkZCBpdCB0byB0aGUgY3VycmVudCBwb3NpdGlvbiBvbiB0aGUgY3VydmUKCgkJCQl2ZXJ0ZXgueCA9IFAxLnggKyAoIGN4ICogTi54ICsgY3kgKiBCLnggKTsKCQkJCXZlcnRleC55ID0gUDEueSArICggY3ggKiBOLnkgKyBjeSAqIEIueSApOwoJCQkJdmVydGV4LnogPSBQMS56ICsgKCBjeCAqIE4ueiArIGN5ICogQi56ICk7CgoJCQkJdmVydGljZXMucHVzaCggdmVydGV4LngsIHZlcnRleC55LCB2ZXJ0ZXgueiApOwoKCQkJCS8vIG5vcm1hbCAoUDEgaXMgYWx3YXlzIHRoZSBjZW50ZXIvb3JpZ2luIG9mIHRoZSBleHRydXNpb24sIHRodXMgd2UgY2FuIHVzZSBpdCB0byBjYWxjdWxhdGUgdGhlIG5vcm1hbCkKCgkJCQlub3JtYWwuc3ViVmVjdG9ycyggdmVydGV4LCBQMSApLm5vcm1hbGl6ZSgpOwoKCQkJCW5vcm1hbHMucHVzaCggbm9ybWFsLngsIG5vcm1hbC55LCBub3JtYWwueiApOwoKCQkJCS8vIHV2CgoJCQkJdXZzLnB1c2goIGkgLyB0dWJ1bGFyU2VnbWVudHMgKTsKCQkJCXV2cy5wdXNoKCBqIC8gcmFkaWFsU2VnbWVudHMgKTsKCgkJCX0KCgkJfQoKCQkvLyBnZW5lcmF0ZSBpbmRpY2VzCgoJCWZvciAoIGxldCBqID0gMTsgaiA8PSB0dWJ1bGFyU2VnbWVudHM7IGogKysgKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDE7IGkgPD0gcmFkaWFsU2VnbWVudHM7IGkgKysgKSB7CgoJCQkJLy8gaW5kaWNlcwoKCQkJCWNvbnN0IGEgPSAoIHJhZGlhbFNlZ21lbnRzICsgMSApICogKCBqIC0gMSApICsgKCBpIC0gMSApOwoJCQkJY29uc3QgYiA9ICggcmFkaWFsU2VnbWVudHMgKyAxICkgKiBqICsgKCBpIC0gMSApOwoJCQkJY29uc3QgYyA9ICggcmFkaWFsU2VnbWVudHMgKyAxICkgKiBqICsgaTsKCQkJCWNvbnN0IGQgPSAoIHJhZGlhbFNlZ21lbnRzICsgMSApICogKCBqIC0gMSApICsgaTsKCgkJCQkvLyBmYWNlcwoKCQkJCWluZGljZXMucHVzaCggYSwgYiwgZCApOwoJCQkJaW5kaWNlcy5wdXNoKCBiLCBjLCBkICk7CgoJCQl9CgoJCX0KCgkJLy8gYnVpbGQgZ2VvbWV0cnkKCgkJdGhpcy5zZXRJbmRleCggaW5kaWNlcyApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAnbm9ybWFsJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIG5vcm1hbHMsIDMgKSApOwoJCXRoaXMuc2V0QXR0cmlidXRlKCAndXYnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdXZzLCAyICkgKTsKCgkJLy8gdGhpcyBmdW5jdGlvbiBjYWxjdWxhdGVzIHRoZSBjdXJyZW50IHBvc2l0aW9uIG9uIHRoZSB0b3J1cyBjdXJ2ZQoKCQlmdW5jdGlvbiBjYWxjdWxhdGVQb3NpdGlvbk9uQ3VydmUoIHUsIHAsIHEsIHJhZGl1cywgcG9zaXRpb24gKSB7CgoJCQljb25zdCBjdSA9IE1hdGguY29zKCB1ICk7CgkJCWNvbnN0IHN1ID0gTWF0aC5zaW4oIHUgKTsKCQkJY29uc3QgcXVPdmVyUCA9IHEgLyBwICogdTsKCQkJY29uc3QgY3MgPSBNYXRoLmNvcyggcXVPdmVyUCApOwoKCQkJcG9zaXRpb24ueCA9IHJhZGl1cyAqICggMiArIGNzICkgKiAwLjUgKiBjdTsKCQkJcG9zaXRpb24ueSA9IHJhZGl1cyAqICggMiArIGNzICkgKiBzdSAqIDAuNTsKCQkJcG9zaXRpb24ueiA9IHJhZGl1cyAqIE1hdGguc2luKCBxdU92ZXJQICkgKiAwLjU7CgoJCX0KCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5wYXJhbWV0ZXJzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzdGF0aWMgZnJvbUpTT04oIGRhdGEgKSB7CgoJCXJldHVybiBuZXcgVG9ydXNLbm90R2VvbWV0cnkoIGRhdGEucmFkaXVzLCBkYXRhLnR1YmUsIGRhdGEudHVidWxhclNlZ21lbnRzLCBkYXRhLnJhZGlhbFNlZ21lbnRzLCBkYXRhLnAsIGRhdGEucSApOwoKCX0KCn0KCmNsYXNzIFR1YmVHZW9tZXRyeSBleHRlbmRzIEJ1ZmZlckdlb21ldHJ5IHsKCgljb25zdHJ1Y3RvciggcGF0aCA9IG5ldyBRdWFkcmF0aWNCZXppZXJDdXJ2ZTMoIG5ldyBWZWN0b3IzKCAtIDEsIC0gMSwgMCApLCBuZXcgVmVjdG9yMyggLSAxLCAxLCAwICksIG5ldyBWZWN0b3IzKCAxLCAxLCAwICkgKSwgdHVidWxhclNlZ21lbnRzID0gNjQsIHJhZGl1cyA9IDEsIHJhZGlhbFNlZ21lbnRzID0gOCwgY2xvc2VkID0gZmFsc2UgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMudHlwZSA9ICdUdWJlR2VvbWV0cnknOwoKCQl0aGlzLnBhcmFtZXRlcnMgPSB7CgkJCXBhdGg6IHBhdGgsCgkJCXR1YnVsYXJTZWdtZW50czogdHVidWxhclNlZ21lbnRzLAoJCQlyYWRpdXM6IHJhZGl1cywKCQkJcmFkaWFsU2VnbWVudHM6IHJhZGlhbFNlZ21lbnRzLAoJCQljbG9zZWQ6IGNsb3NlZAoJCX07CgoJCWNvbnN0IGZyYW1lcyA9IHBhdGguY29tcHV0ZUZyZW5ldEZyYW1lcyggdHVidWxhclNlZ21lbnRzLCBjbG9zZWQgKTsKCgkJLy8gZXhwb3NlIGludGVybmFscwoKCQl0aGlzLnRhbmdlbnRzID0gZnJhbWVzLnRhbmdlbnRzOwoJCXRoaXMubm9ybWFscyA9IGZyYW1lcy5ub3JtYWxzOwoJCXRoaXMuYmlub3JtYWxzID0gZnJhbWVzLmJpbm9ybWFsczsKCgkJLy8gaGVscGVyIHZhcmlhYmxlcwoKCQljb25zdCB2ZXJ0ZXggPSBuZXcgVmVjdG9yMygpOwoJCWNvbnN0IG5vcm1hbCA9IG5ldyBWZWN0b3IzKCk7CgkJY29uc3QgdXYgPSBuZXcgVmVjdG9yMigpOwoJCWxldCBQID0gbmV3IFZlY3RvcjMoKTsKCgkJLy8gYnVmZmVyCgoJCWNvbnN0IHZlcnRpY2VzID0gW107CgkJY29uc3Qgbm9ybWFscyA9IFtdOwoJCWNvbnN0IHV2cyA9IFtdOwoJCWNvbnN0IGluZGljZXMgPSBbXTsKCgkJLy8gY3JlYXRlIGJ1ZmZlciBkYXRhCgoJCWdlbmVyYXRlQnVmZmVyRGF0YSgpOwoKCQkvLyBidWlsZCBnZW9tZXRyeQoKCQl0aGlzLnNldEluZGV4KCBpbmRpY2VzICk7CgkJdGhpcy5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlcywgMyApICk7CgkJdGhpcy5zZXRBdHRyaWJ1dGUoICdub3JtYWwnLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggbm9ybWFscywgMyApICk7CgkJdGhpcy5zZXRBdHRyaWJ1dGUoICd1dicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB1dnMsIDIgKSApOwoKCQkvLyBmdW5jdGlvbnMKCgkJZnVuY3Rpb24gZ2VuZXJhdGVCdWZmZXJEYXRhKCkgewoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdHVidWxhclNlZ21lbnRzOyBpICsrICkgewoKCQkJCWdlbmVyYXRlU2VnbWVudCggaSApOwoKCQkJfQoKCQkJLy8gaWYgdGhlIGdlb21ldHJ5IGlzIG5vdCBjbG9zZWQsIGdlbmVyYXRlIHRoZSBsYXN0IHJvdyBvZiB2ZXJ0aWNlcyBhbmQgbm9ybWFscwoJCQkvLyBhdCB0aGUgcmVndWxhciBwb3NpdGlvbiBvbiB0aGUgZ2l2ZW4gcGF0aAoJCQkvLwoJCQkvLyBpZiB0aGUgZ2VvbWV0cnkgaXMgY2xvc2VkLCBkdXBsaWNhdGUgdGhlIGZpcnN0IHJvdyBvZiB2ZXJ0aWNlcyBhbmQgbm9ybWFscyAodXZzIHdpbGwgZGlmZmVyKQoKCQkJZ2VuZXJhdGVTZWdtZW50KCAoIGNsb3NlZCA9PT0gZmFsc2UgKSA/IHR1YnVsYXJTZWdtZW50cyA6IDAgKTsKCgkJCS8vIHV2cyBhcmUgZ2VuZXJhdGVkIGluIGEgc2VwYXJhdGUgZnVuY3Rpb24uCgkJCS8vIHRoaXMgbWFrZXMgaXQgZWFzeSBjb21wdXRlIGNvcnJlY3QgdmFsdWVzIGZvciBjbG9zZWQgZ2VvbWV0cmllcwoKCQkJZ2VuZXJhdGVVVnMoKTsKCgkJCS8vIGZpbmFsbHkgY3JlYXRlIGZhY2VzCgoJCQlnZW5lcmF0ZUluZGljZXMoKTsKCgkJfQoKCQlmdW5jdGlvbiBnZW5lcmF0ZVNlZ21lbnQoIGkgKSB7CgoJCQkvLyB3ZSB1c2UgZ2V0UG9pbnRBdCB0byBzYW1wbGUgZXZlbmx5IGRpc3RyaWJ1dGVkIHBvaW50cyBmcm9tIHRoZSBnaXZlbiBwYXRoCgoJCQlQID0gcGF0aC5nZXRQb2ludEF0KCBpIC8gdHVidWxhclNlZ21lbnRzLCBQICk7CgoJCQkvLyByZXRyaWV2ZSBjb3JyZXNwb25kaW5nIG5vcm1hbCBhbmQgYmlub3JtYWwKCgkJCWNvbnN0IE4gPSBmcmFtZXMubm9ybWFsc1sgaSBdOwoJCQljb25zdCBCID0gZnJhbWVzLmJpbm9ybWFsc1sgaSBdOwoKCQkJLy8gZ2VuZXJhdGUgbm9ybWFscyBhbmQgdmVydGljZXMgZm9yIHRoZSBjdXJyZW50IHNlZ21lbnQKCgkJCWZvciAoIGxldCBqID0gMDsgaiA8PSByYWRpYWxTZWdtZW50czsgaiArKyApIHsKCgkJCQljb25zdCB2ID0gaiAvIHJhZGlhbFNlZ21lbnRzICogTWF0aC5QSSAqIDI7CgoJCQkJY29uc3Qgc2luID0gTWF0aC5zaW4oIHYgKTsKCQkJCWNvbnN0IGNvcyA9IC0gTWF0aC5jb3MoIHYgKTsKCgkJCQkvLyBub3JtYWwKCgkJCQlub3JtYWwueCA9ICggY29zICogTi54ICsgc2luICogQi54ICk7CgkJCQlub3JtYWwueSA9ICggY29zICogTi55ICsgc2luICogQi55ICk7CgkJCQlub3JtYWwueiA9ICggY29zICogTi56ICsgc2luICogQi56ICk7CgkJCQlub3JtYWwubm9ybWFsaXplKCk7CgoJCQkJbm9ybWFscy5wdXNoKCBub3JtYWwueCwgbm9ybWFsLnksIG5vcm1hbC56ICk7CgoJCQkJLy8gdmVydGV4CgoJCQkJdmVydGV4LnggPSBQLnggKyByYWRpdXMgKiBub3JtYWwueDsKCQkJCXZlcnRleC55ID0gUC55ICsgcmFkaXVzICogbm9ybWFsLnk7CgkJCQl2ZXJ0ZXgueiA9IFAueiArIHJhZGl1cyAqIG5vcm1hbC56OwoKCQkJCXZlcnRpY2VzLnB1c2goIHZlcnRleC54LCB2ZXJ0ZXgueSwgdmVydGV4LnogKTsKCgkJCX0KCgkJfQoKCQlmdW5jdGlvbiBnZW5lcmF0ZUluZGljZXMoKSB7CgoJCQlmb3IgKCBsZXQgaiA9IDE7IGogPD0gdHVidWxhclNlZ21lbnRzOyBqICsrICkgewoKCQkJCWZvciAoIGxldCBpID0gMTsgaSA8PSByYWRpYWxTZWdtZW50czsgaSArKyApIHsKCgkJCQkJY29uc3QgYSA9ICggcmFkaWFsU2VnbWVudHMgKyAxICkgKiAoIGogLSAxICkgKyAoIGkgLSAxICk7CgkJCQkJY29uc3QgYiA9ICggcmFkaWFsU2VnbWVudHMgKyAxICkgKiBqICsgKCBpIC0gMSApOwoJCQkJCWNvbnN0IGMgPSAoIHJhZGlhbFNlZ21lbnRzICsgMSApICogaiArIGk7CgkJCQkJY29uc3QgZCA9ICggcmFkaWFsU2VnbWVudHMgKyAxICkgKiAoIGogLSAxICkgKyBpOwoKCQkJCQkvLyBmYWNlcwoKCQkJCQlpbmRpY2VzLnB1c2goIGEsIGIsIGQgKTsKCQkJCQlpbmRpY2VzLnB1c2goIGIsIGMsIGQgKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJZnVuY3Rpb24gZ2VuZXJhdGVVVnMoKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPD0gdHVidWxhclNlZ21lbnRzOyBpICsrICkgewoKCQkJCWZvciAoIGxldCBqID0gMDsgaiA8PSByYWRpYWxTZWdtZW50czsgaiArKyApIHsKCgkJCQkJdXYueCA9IGkgLyB0dWJ1bGFyU2VnbWVudHM7CgkJCQkJdXYueSA9IGogLyByYWRpYWxTZWdtZW50czsKCgkJCQkJdXZzLnB1c2goIHV2LngsIHV2LnkgKTsKCgkJCQl9CgoJCQl9CgoJCX0KCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5wYXJhbWV0ZXJzID0gT2JqZWN0LmFzc2lnbigge30sIHNvdXJjZS5wYXJhbWV0ZXJzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0pTT04oKSB7CgoJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oKTsKCgkJZGF0YS5wYXRoID0gdGhpcy5wYXJhbWV0ZXJzLnBhdGgudG9KU09OKCk7CgoJCXJldHVybiBkYXRhOwoKCX0KCglzdGF0aWMgZnJvbUpTT04oIGRhdGEgKSB7CgoJCS8vIFRoaXMgb25seSB3b3JrcyBmb3IgYnVpbHQtaW4gY3VydmVzIChlLmcuIENhdG11bGxSb21DdXJ2ZTMpLgoJCS8vIFVzZXIgZGVmaW5lZCBjdXJ2ZXMgb3IgaW5zdGFuY2VzIG9mIEN1cnZlUGF0aCB3aWxsIG5vdCBiZSBkZXNlcmlhbGl6ZWQuCgkJcmV0dXJuIG5ldyBUdWJlR2VvbWV0cnkoCgkJCW5ldyBDdXJ2ZXNbIGRhdGEucGF0aC50eXBlIF0oKS5mcm9tSlNPTiggZGF0YS5wYXRoICksCgkJCWRhdGEudHVidWxhclNlZ21lbnRzLAoJCQlkYXRhLnJhZGl1cywKCQkJZGF0YS5yYWRpYWxTZWdtZW50cywKCQkJZGF0YS5jbG9zZWQKCQkpOwoKCX0KCn0KCmNsYXNzIFdpcmVmcmFtZUdlb21ldHJ5IGV4dGVuZHMgQnVmZmVyR2VvbWV0cnkgewoKCWNvbnN0cnVjdG9yKCBnZW9tZXRyeSA9IG51bGwgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMudHlwZSA9ICdXaXJlZnJhbWVHZW9tZXRyeSc7CgoJCXRoaXMucGFyYW1ldGVycyA9IHsKCQkJZ2VvbWV0cnk6IGdlb21ldHJ5CgkJfTsKCgkJaWYgKCBnZW9tZXRyeSAhPT0gbnVsbCApIHsKCgkJCS8vIGJ1ZmZlcgoKCQkJY29uc3QgdmVydGljZXMgPSBbXTsKCQkJY29uc3QgZWRnZXMgPSBuZXcgU2V0KCk7CgoJCQkvLyBoZWxwZXIgdmFyaWFibGVzCgoJCQljb25zdCBzdGFydCA9IG5ldyBWZWN0b3IzKCk7CgkJCWNvbnN0IGVuZCA9IG5ldyBWZWN0b3IzKCk7CgoJCQlpZiAoIGdlb21ldHJ5LmluZGV4ICE9PSBudWxsICkgewoKCQkJCS8vIGluZGV4ZWQgQnVmZmVyR2VvbWV0cnkKCgkJCQljb25zdCBwb3NpdGlvbiA9IGdlb21ldHJ5LmF0dHJpYnV0ZXMucG9zaXRpb247CgkJCQljb25zdCBpbmRpY2VzID0gZ2VvbWV0cnkuaW5kZXg7CgkJCQlsZXQgZ3JvdXBzID0gZ2VvbWV0cnkuZ3JvdXBzOwoKCQkJCWlmICggZ3JvdXBzLmxlbmd0aCA9PT0gMCApIHsKCgkJCQkJZ3JvdXBzID0gWyB7IHN0YXJ0OiAwLCBjb3VudDogaW5kaWNlcy5jb3VudCwgbWF0ZXJpYWxJbmRleDogMCB9IF07CgoJCQkJfQoKCQkJCS8vIGNyZWF0ZSBhIGRhdGEgc3RydWN0dXJlIHRoYXQgY29udGFpbnMgYWxsIGVkZ2VzIHdpdGhvdXQgZHVwbGljYXRlcwoKCQkJCWZvciAoIGxldCBvID0gMCwgb2wgPSBncm91cHMubGVuZ3RoOyBvIDwgb2w7ICsrIG8gKSB7CgoJCQkJCWNvbnN0IGdyb3VwID0gZ3JvdXBzWyBvIF07CgoJCQkJCWNvbnN0IGdyb3VwU3RhcnQgPSBncm91cC5zdGFydDsKCQkJCQljb25zdCBncm91cENvdW50ID0gZ3JvdXAuY291bnQ7CgoJCQkJCWZvciAoIGxldCBpID0gZ3JvdXBTdGFydCwgbCA9ICggZ3JvdXBTdGFydCArIGdyb3VwQ291bnQgKTsgaSA8IGw7IGkgKz0gMyApIHsKCgkJCQkJCWZvciAoIGxldCBqID0gMDsgaiA8IDM7IGogKysgKSB7CgoJCQkJCQkJY29uc3QgaW5kZXgxID0gaW5kaWNlcy5nZXRYKCBpICsgaiApOwoJCQkJCQkJY29uc3QgaW5kZXgyID0gaW5kaWNlcy5nZXRYKCBpICsgKCBqICsgMSApICUgMyApOwoKCQkJCQkJCXN0YXJ0LmZyb21CdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9uLCBpbmRleDEgKTsKCQkJCQkJCWVuZC5mcm9tQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbiwgaW5kZXgyICk7CgoJCQkJCQkJaWYgKCBpc1VuaXF1ZUVkZ2UoIHN0YXJ0LCBlbmQsIGVkZ2VzICkgPT09IHRydWUgKSB7CgoJCQkJCQkJCXZlcnRpY2VzLnB1c2goIHN0YXJ0LngsIHN0YXJ0LnksIHN0YXJ0LnogKTsKCQkJCQkJCQl2ZXJ0aWNlcy5wdXNoKCBlbmQueCwgZW5kLnksIGVuZC56ICk7CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQkvLyBub24taW5kZXhlZCBCdWZmZXJHZW9tZXRyeQoKCQkJCWNvbnN0IHBvc2l0aW9uID0gZ2VvbWV0cnkuYXR0cmlidXRlcy5wb3NpdGlvbjsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSAoIHBvc2l0aW9uLmNvdW50IC8gMyApOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJZm9yICggbGV0IGogPSAwOyBqIDwgMzsgaiArKyApIHsKCgkJCQkJCS8vIHRocmVlIGVkZ2VzIHBlciB0cmlhbmdsZSwgYW4gZWRnZSBpcyByZXByZXNlbnRlZCBhcyAoaW5kZXgxLCBpbmRleDIpCgkJCQkJCS8vIGUuZy4gdGhlIGZpcnN0IHRyaWFuZ2xlIGhhcyB0aGUgZm9sbG93aW5nIGVkZ2VzOiAoMCwxKSwoMSwyKSwoMiwwKQoKCQkJCQkJY29uc3QgaW5kZXgxID0gMyAqIGkgKyBqOwoJCQkJCQljb25zdCBpbmRleDIgPSAzICogaSArICggKCBqICsgMSApICUgMyApOwoKCQkJCQkJc3RhcnQuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIGluZGV4MSApOwoJCQkJCQllbmQuZnJvbUJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb24sIGluZGV4MiApOwoKCQkJCQkJaWYgKCBpc1VuaXF1ZUVkZ2UoIHN0YXJ0LCBlbmQsIGVkZ2VzICkgPT09IHRydWUgKSB7CgoJCQkJCQkJdmVydGljZXMucHVzaCggc3RhcnQueCwgc3RhcnQueSwgc3RhcnQueiApOwoJCQkJCQkJdmVydGljZXMucHVzaCggZW5kLngsIGVuZC55LCBlbmQueiApOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQkJLy8gYnVpbGQgZ2VvbWV0cnkKCgkJCXRoaXMuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoKCQl9CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMucGFyYW1ldGVycyA9IE9iamVjdC5hc3NpZ24oIHt9LCBzb3VyY2UucGFyYW1ldGVycyApOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpmdW5jdGlvbiBpc1VuaXF1ZUVkZ2UoIHN0YXJ0LCBlbmQsIGVkZ2VzICkgewoKCWNvbnN0IGhhc2gxID0gYCR7c3RhcnQueH0sJHtzdGFydC55fSwke3N0YXJ0Lnp9LSR7ZW5kLnh9LCR7ZW5kLnl9LCR7ZW5kLnp9YDsKCWNvbnN0IGhhc2gyID0gYCR7ZW5kLnh9LCR7ZW5kLnl9LCR7ZW5kLnp9LSR7c3RhcnQueH0sJHtzdGFydC55fSwke3N0YXJ0Lnp9YDsgLy8gY29pbmNpZGVudCBlZGdlCgoJaWYgKCBlZGdlcy5oYXMoIGhhc2gxICkgPT09IHRydWUgfHwgZWRnZXMuaGFzKCBoYXNoMiApID09PSB0cnVlICkgewoKCQlyZXR1cm4gZmFsc2U7CgoJfSBlbHNlIHsKCgkJZWRnZXMuYWRkKCBoYXNoMSApOwoJCWVkZ2VzLmFkZCggaGFzaDIgKTsKCQlyZXR1cm4gdHJ1ZTsKCgl9Cgp9Cgp2YXIgR2VvbWV0cmllcyA9IC8qI19fUFVSRV9fKi9PYmplY3QuZnJlZXplKHsKCV9fcHJvdG9fXzogbnVsbCwKCUJveEdlb21ldHJ5OiBCb3hHZW9tZXRyeSwKCUNhcHN1bGVHZW9tZXRyeTogQ2Fwc3VsZUdlb21ldHJ5LAoJQ2lyY2xlR2VvbWV0cnk6IENpcmNsZUdlb21ldHJ5LAoJQ29uZUdlb21ldHJ5OiBDb25lR2VvbWV0cnksCglDeWxpbmRlckdlb21ldHJ5OiBDeWxpbmRlckdlb21ldHJ5LAoJRG9kZWNhaGVkcm9uR2VvbWV0cnk6IERvZGVjYWhlZHJvbkdlb21ldHJ5LAoJRWRnZXNHZW9tZXRyeTogRWRnZXNHZW9tZXRyeSwKCUV4dHJ1ZGVHZW9tZXRyeTogRXh0cnVkZUdlb21ldHJ5LAoJSWNvc2FoZWRyb25HZW9tZXRyeTogSWNvc2FoZWRyb25HZW9tZXRyeSwKCUxhdGhlR2VvbWV0cnk6IExhdGhlR2VvbWV0cnksCglPY3RhaGVkcm9uR2VvbWV0cnk6IE9jdGFoZWRyb25HZW9tZXRyeSwKCVBsYW5lR2VvbWV0cnk6IFBsYW5lR2VvbWV0cnksCglQb2x5aGVkcm9uR2VvbWV0cnk6IFBvbHloZWRyb25HZW9tZXRyeSwKCVJpbmdHZW9tZXRyeTogUmluZ0dlb21ldHJ5LAoJU2hhcGVHZW9tZXRyeTogU2hhcGVHZW9tZXRyeSwKCVNwaGVyZUdlb21ldHJ5OiBTcGhlcmVHZW9tZXRyeSwKCVRldHJhaGVkcm9uR2VvbWV0cnk6IFRldHJhaGVkcm9uR2VvbWV0cnksCglUb3J1c0dlb21ldHJ5OiBUb3J1c0dlb21ldHJ5LAoJVG9ydXNLbm90R2VvbWV0cnk6IFRvcnVzS25vdEdlb21ldHJ5LAoJVHViZUdlb21ldHJ5OiBUdWJlR2VvbWV0cnksCglXaXJlZnJhbWVHZW9tZXRyeTogV2lyZWZyYW1lR2VvbWV0cnkKfSk7CgpjbGFzcyBTaGFkb3dNYXRlcmlhbCBleHRlbmRzIE1hdGVyaWFsIHsKCgljb25zdHJ1Y3RvciggcGFyYW1ldGVycyApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc1NoYWRvd01hdGVyaWFsID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ1NoYWRvd01hdGVyaWFsJzsKCgkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggMHgwMDAwMDAgKTsKCQl0aGlzLnRyYW5zcGFyZW50ID0gdHJ1ZTsKCgkJdGhpcy5mb2cgPSB0cnVlOwoKCQl0aGlzLnNldFZhbHVlcyggcGFyYW1ldGVycyApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLmNvbG9yLmNvcHkoIHNvdXJjZS5jb2xvciApOwoKCQl0aGlzLmZvZyA9IHNvdXJjZS5mb2c7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNsYXNzIFJhd1NoYWRlck1hdGVyaWFsIGV4dGVuZHMgU2hhZGVyTWF0ZXJpYWwgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJzICkgewoKCQlzdXBlciggcGFyYW1ldGVycyApOwoKCQl0aGlzLmlzUmF3U2hhZGVyTWF0ZXJpYWwgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnUmF3U2hhZGVyTWF0ZXJpYWwnOwoKCX0KCn0KCmNsYXNzIE1lc2hTdGFuZGFyZE1hdGVyaWFsIGV4dGVuZHMgTWF0ZXJpYWwgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJzICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzTWVzaFN0YW5kYXJkTWF0ZXJpYWwgPSB0cnVlOwoKCQl0aGlzLmRlZmluZXMgPSB7ICdTVEFOREFSRCc6ICcnIH07CgoJCXRoaXMudHlwZSA9ICdNZXNoU3RhbmRhcmRNYXRlcmlhbCc7CgoJCXRoaXMuY29sb3IgPSBuZXcgQ29sb3IoIDB4ZmZmZmZmICk7IC8vIGRpZmZ1c2UKCQl0aGlzLnJvdWdobmVzcyA9IDEuMDsKCQl0aGlzLm1ldGFsbmVzcyA9IDAuMDsKCgkJdGhpcy5tYXAgPSBudWxsOwoKCQl0aGlzLmxpZ2h0TWFwID0gbnVsbDsKCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gMS4wOwoKCQl0aGlzLmFvTWFwID0gbnVsbDsKCQl0aGlzLmFvTWFwSW50ZW5zaXR5ID0gMS4wOwoKCQl0aGlzLmVtaXNzaXZlID0gbmV3IENvbG9yKCAweDAwMDAwMCApOwoJCXRoaXMuZW1pc3NpdmVJbnRlbnNpdHkgPSAxLjA7CgkJdGhpcy5lbWlzc2l2ZU1hcCA9IG51bGw7CgoJCXRoaXMuYnVtcE1hcCA9IG51bGw7CgkJdGhpcy5idW1wU2NhbGUgPSAxOwoKCQl0aGlzLm5vcm1hbE1hcCA9IG51bGw7CgkJdGhpcy5ub3JtYWxNYXBUeXBlID0gVGFuZ2VudFNwYWNlTm9ybWFsTWFwOwoJCXRoaXMubm9ybWFsU2NhbGUgPSBuZXcgVmVjdG9yMiggMSwgMSApOwoKCQl0aGlzLmRpc3BsYWNlbWVudE1hcCA9IG51bGw7CgkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IDE7CgkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gMDsKCgkJdGhpcy5yb3VnaG5lc3NNYXAgPSBudWxsOwoKCQl0aGlzLm1ldGFsbmVzc01hcCA9IG51bGw7CgoJCXRoaXMuYWxwaGFNYXAgPSBudWxsOwoKCQl0aGlzLmVudk1hcCA9IG51bGw7CgkJdGhpcy5lbnZNYXBJbnRlbnNpdHkgPSAxLjA7CgoJCXRoaXMud2lyZWZyYW1lID0gZmFsc2U7CgkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSAxOwoJCXRoaXMud2lyZWZyYW1lTGluZWNhcCA9ICdyb3VuZCc7CgkJdGhpcy53aXJlZnJhbWVMaW5lam9pbiA9ICdyb3VuZCc7CgoJCXRoaXMuZmxhdFNoYWRpbmcgPSBmYWxzZTsKCgkJdGhpcy5mb2cgPSB0cnVlOwoKCQl0aGlzLnNldFZhbHVlcyggcGFyYW1ldGVycyApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLmRlZmluZXMgPSB7ICdTVEFOREFSRCc6ICcnIH07CgoJCXRoaXMuY29sb3IuY29weSggc291cmNlLmNvbG9yICk7CgkJdGhpcy5yb3VnaG5lc3MgPSBzb3VyY2Uucm91Z2huZXNzOwoJCXRoaXMubWV0YWxuZXNzID0gc291cmNlLm1ldGFsbmVzczsKCgkJdGhpcy5tYXAgPSBzb3VyY2UubWFwOwoKCQl0aGlzLmxpZ2h0TWFwID0gc291cmNlLmxpZ2h0TWFwOwoJCXRoaXMubGlnaHRNYXBJbnRlbnNpdHkgPSBzb3VyY2UubGlnaHRNYXBJbnRlbnNpdHk7CgoJCXRoaXMuYW9NYXAgPSBzb3VyY2UuYW9NYXA7CgkJdGhpcy5hb01hcEludGVuc2l0eSA9IHNvdXJjZS5hb01hcEludGVuc2l0eTsKCgkJdGhpcy5lbWlzc2l2ZS5jb3B5KCBzb3VyY2UuZW1pc3NpdmUgKTsKCQl0aGlzLmVtaXNzaXZlTWFwID0gc291cmNlLmVtaXNzaXZlTWFwOwoJCXRoaXMuZW1pc3NpdmVJbnRlbnNpdHkgPSBzb3VyY2UuZW1pc3NpdmVJbnRlbnNpdHk7CgoJCXRoaXMuYnVtcE1hcCA9IHNvdXJjZS5idW1wTWFwOwoJCXRoaXMuYnVtcFNjYWxlID0gc291cmNlLmJ1bXBTY2FsZTsKCgkJdGhpcy5ub3JtYWxNYXAgPSBzb3VyY2Uubm9ybWFsTWFwOwoJCXRoaXMubm9ybWFsTWFwVHlwZSA9IHNvdXJjZS5ub3JtYWxNYXBUeXBlOwoJCXRoaXMubm9ybWFsU2NhbGUuY29weSggc291cmNlLm5vcm1hbFNjYWxlICk7CgoJCXRoaXMuZGlzcGxhY2VtZW50TWFwID0gc291cmNlLmRpc3BsYWNlbWVudE1hcDsKCQl0aGlzLmRpc3BsYWNlbWVudFNjYWxlID0gc291cmNlLmRpc3BsYWNlbWVudFNjYWxlOwoJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IHNvdXJjZS5kaXNwbGFjZW1lbnRCaWFzOwoKCQl0aGlzLnJvdWdobmVzc01hcCA9IHNvdXJjZS5yb3VnaG5lc3NNYXA7CgoJCXRoaXMubWV0YWxuZXNzTWFwID0gc291cmNlLm1ldGFsbmVzc01hcDsKCgkJdGhpcy5hbHBoYU1hcCA9IHNvdXJjZS5hbHBoYU1hcDsKCgkJdGhpcy5lbnZNYXAgPSBzb3VyY2UuZW52TWFwOwoJCXRoaXMuZW52TWFwSW50ZW5zaXR5ID0gc291cmNlLmVudk1hcEludGVuc2l0eTsKCgkJdGhpcy53aXJlZnJhbWUgPSBzb3VyY2Uud2lyZWZyYW1lOwoJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gc291cmNlLndpcmVmcmFtZUxpbmV3aWR0aDsKCQl0aGlzLndpcmVmcmFtZUxpbmVjYXAgPSBzb3VyY2Uud2lyZWZyYW1lTGluZWNhcDsKCQl0aGlzLndpcmVmcmFtZUxpbmVqb2luID0gc291cmNlLndpcmVmcmFtZUxpbmVqb2luOwoKCQl0aGlzLmZsYXRTaGFkaW5nID0gc291cmNlLmZsYXRTaGFkaW5nOwoKCQl0aGlzLmZvZyA9IHNvdXJjZS5mb2c7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNsYXNzIE1lc2hQaHlzaWNhbE1hdGVyaWFsIGV4dGVuZHMgTWVzaFN0YW5kYXJkTWF0ZXJpYWwgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJzICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzTWVzaFBoeXNpY2FsTWF0ZXJpYWwgPSB0cnVlOwoKCQl0aGlzLmRlZmluZXMgPSB7CgoJCQknU1RBTkRBUkQnOiAnJywKCQkJJ1BIWVNJQ0FMJzogJycKCgkJfTsKCgkJdGhpcy50eXBlID0gJ01lc2hQaHlzaWNhbE1hdGVyaWFsJzsKCgkJdGhpcy5hbmlzb3Ryb3B5Um90YXRpb24gPSAwOwoJCXRoaXMuYW5pc290cm9weU1hcCA9IG51bGw7CgoJCXRoaXMuY2xlYXJjb2F0TWFwID0gbnVsbDsKCQl0aGlzLmNsZWFyY29hdFJvdWdobmVzcyA9IDAuMDsKCQl0aGlzLmNsZWFyY29hdFJvdWdobmVzc01hcCA9IG51bGw7CgkJdGhpcy5jbGVhcmNvYXROb3JtYWxTY2FsZSA9IG5ldyBWZWN0b3IyKCAxLCAxICk7CgkJdGhpcy5jbGVhcmNvYXROb3JtYWxNYXAgPSBudWxsOwoKCQl0aGlzLmlvciA9IDEuNTsKCgkJT2JqZWN0LmRlZmluZVByb3BlcnR5KCB0aGlzLCAncmVmbGVjdGl2aXR5JywgewoJCQlnZXQ6IGZ1bmN0aW9uICgpIHsKCgkJCQlyZXR1cm4gKCBjbGFtcCggMi41ICogKCB0aGlzLmlvciAtIDEgKSAvICggdGhpcy5pb3IgKyAxICksIDAsIDEgKSApOwoKCQkJfSwKCQkJc2V0OiBmdW5jdGlvbiAoIHJlZmxlY3Rpdml0eSApIHsKCgkJCQl0aGlzLmlvciA9ICggMSArIDAuNCAqIHJlZmxlY3Rpdml0eSApIC8gKCAxIC0gMC40ICogcmVmbGVjdGl2aXR5ICk7CgoJCQl9CgkJfSApOwoKCQl0aGlzLmlyaWRlc2NlbmNlTWFwID0gbnVsbDsKCQl0aGlzLmlyaWRlc2NlbmNlSU9SID0gMS4zOwoJCXRoaXMuaXJpZGVzY2VuY2VUaGlja25lc3NSYW5nZSA9IFsgMTAwLCA0MDAgXTsKCQl0aGlzLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwID0gbnVsbDsKCgkJdGhpcy5zaGVlbkNvbG9yID0gbmV3IENvbG9yKCAweDAwMDAwMCApOwoJCXRoaXMuc2hlZW5Db2xvck1hcCA9IG51bGw7CgkJdGhpcy5zaGVlblJvdWdobmVzcyA9IDEuMDsKCQl0aGlzLnNoZWVuUm91Z2huZXNzTWFwID0gbnVsbDsKCgkJdGhpcy50cmFuc21pc3Npb25NYXAgPSBudWxsOwoKCQl0aGlzLnRoaWNrbmVzcyA9IDA7CgkJdGhpcy50aGlja25lc3NNYXAgPSBudWxsOwoJCXRoaXMuYXR0ZW51YXRpb25EaXN0YW5jZSA9IEluZmluaXR5OwoJCXRoaXMuYXR0ZW51YXRpb25Db2xvciA9IG5ldyBDb2xvciggMSwgMSwgMSApOwoKCQl0aGlzLnNwZWN1bGFySW50ZW5zaXR5ID0gMS4wOwoJCXRoaXMuc3BlY3VsYXJJbnRlbnNpdHlNYXAgPSBudWxsOwoJCXRoaXMuc3BlY3VsYXJDb2xvciA9IG5ldyBDb2xvciggMSwgMSwgMSApOwoJCXRoaXMuc3BlY3VsYXJDb2xvck1hcCA9IG51bGw7CgoJCXRoaXMuX2FuaXNvdHJvcHkgPSAwOwoJCXRoaXMuX2NsZWFyY29hdCA9IDA7CgkJdGhpcy5faXJpZGVzY2VuY2UgPSAwOwoJCXRoaXMuX3NoZWVuID0gMC4wOwoJCXRoaXMuX3RyYW5zbWlzc2lvbiA9IDA7CgoJCXRoaXMuc2V0VmFsdWVzKCBwYXJhbWV0ZXJzICk7CgoJfQoKCWdldCBhbmlzb3Ryb3B5KCkgewoKCQlyZXR1cm4gdGhpcy5fYW5pc290cm9weTsKCgl9CgoJc2V0IGFuaXNvdHJvcHkoIHZhbHVlICkgewoKCQlpZiAoIHRoaXMuX2FuaXNvdHJvcHkgPiAwICE9PSB2YWx1ZSA+IDAgKSB7CgoJCQl0aGlzLnZlcnNpb24gKys7CgoJCX0KCgkJdGhpcy5fYW5pc290cm9weSA9IHZhbHVlOwoKCX0KCglnZXQgY2xlYXJjb2F0KCkgewoKCQlyZXR1cm4gdGhpcy5fY2xlYXJjb2F0OwoKCX0KCglzZXQgY2xlYXJjb2F0KCB2YWx1ZSApIHsKCgkJaWYgKCB0aGlzLl9jbGVhcmNvYXQgPiAwICE9PSB2YWx1ZSA+IDAgKSB7CgoJCQl0aGlzLnZlcnNpb24gKys7CgoJCX0KCgkJdGhpcy5fY2xlYXJjb2F0ID0gdmFsdWU7CgoJfQoKCWdldCBpcmlkZXNjZW5jZSgpIHsKCgkJcmV0dXJuIHRoaXMuX2lyaWRlc2NlbmNlOwoKCX0KCglzZXQgaXJpZGVzY2VuY2UoIHZhbHVlICkgewoKCQlpZiAoIHRoaXMuX2lyaWRlc2NlbmNlID4gMCAhPT0gdmFsdWUgPiAwICkgewoKCQkJdGhpcy52ZXJzaW9uICsrOwoKCQl9CgoJCXRoaXMuX2lyaWRlc2NlbmNlID0gdmFsdWU7CgoJfQoKCWdldCBzaGVlbigpIHsKCgkJcmV0dXJuIHRoaXMuX3NoZWVuOwoKCX0KCglzZXQgc2hlZW4oIHZhbHVlICkgewoKCQlpZiAoIHRoaXMuX3NoZWVuID4gMCAhPT0gdmFsdWUgPiAwICkgewoKCQkJdGhpcy52ZXJzaW9uICsrOwoKCQl9CgoJCXRoaXMuX3NoZWVuID0gdmFsdWU7CgoJfQoKCWdldCB0cmFuc21pc3Npb24oKSB7CgoJCXJldHVybiB0aGlzLl90cmFuc21pc3Npb247CgoJfQoKCXNldCB0cmFuc21pc3Npb24oIHZhbHVlICkgewoKCQlpZiAoIHRoaXMuX3RyYW5zbWlzc2lvbiA+IDAgIT09IHZhbHVlID4gMCApIHsKCgkJCXRoaXMudmVyc2lvbiArKzsKCgkJfQoKCQl0aGlzLl90cmFuc21pc3Npb24gPSB2YWx1ZTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5kZWZpbmVzID0gewoKCQkJJ1NUQU5EQVJEJzogJycsCgkJCSdQSFlTSUNBTCc6ICcnCgoJCX07CgoJCXRoaXMuYW5pc290cm9weSA9IHNvdXJjZS5hbmlzb3Ryb3B5OwoJCXRoaXMuYW5pc290cm9weVJvdGF0aW9uID0gc291cmNlLmFuaXNvdHJvcHlSb3RhdGlvbjsKCQl0aGlzLmFuaXNvdHJvcHlNYXAgPSBzb3VyY2UuYW5pc290cm9weU1hcDsKCgkJdGhpcy5jbGVhcmNvYXQgPSBzb3VyY2UuY2xlYXJjb2F0OwoJCXRoaXMuY2xlYXJjb2F0TWFwID0gc291cmNlLmNsZWFyY29hdE1hcDsKCQl0aGlzLmNsZWFyY29hdFJvdWdobmVzcyA9IHNvdXJjZS5jbGVhcmNvYXRSb3VnaG5lc3M7CgkJdGhpcy5jbGVhcmNvYXRSb3VnaG5lc3NNYXAgPSBzb3VyY2UuY2xlYXJjb2F0Um91Z2huZXNzTWFwOwoJCXRoaXMuY2xlYXJjb2F0Tm9ybWFsTWFwID0gc291cmNlLmNsZWFyY29hdE5vcm1hbE1hcDsKCQl0aGlzLmNsZWFyY29hdE5vcm1hbFNjYWxlLmNvcHkoIHNvdXJjZS5jbGVhcmNvYXROb3JtYWxTY2FsZSApOwoKCQl0aGlzLmlvciA9IHNvdXJjZS5pb3I7CgoJCXRoaXMuaXJpZGVzY2VuY2UgPSBzb3VyY2UuaXJpZGVzY2VuY2U7CgkJdGhpcy5pcmlkZXNjZW5jZU1hcCA9IHNvdXJjZS5pcmlkZXNjZW5jZU1hcDsKCQl0aGlzLmlyaWRlc2NlbmNlSU9SID0gc291cmNlLmlyaWRlc2NlbmNlSU9SOwoJCXRoaXMuaXJpZGVzY2VuY2VUaGlja25lc3NSYW5nZSA9IFsgLi4uc291cmNlLmlyaWRlc2NlbmNlVGhpY2tuZXNzUmFuZ2UgXTsKCQl0aGlzLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwID0gc291cmNlLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwOwoKCQl0aGlzLnNoZWVuID0gc291cmNlLnNoZWVuOwoJCXRoaXMuc2hlZW5Db2xvci5jb3B5KCBzb3VyY2Uuc2hlZW5Db2xvciApOwoJCXRoaXMuc2hlZW5Db2xvck1hcCA9IHNvdXJjZS5zaGVlbkNvbG9yTWFwOwoJCXRoaXMuc2hlZW5Sb3VnaG5lc3MgPSBzb3VyY2Uuc2hlZW5Sb3VnaG5lc3M7CgkJdGhpcy5zaGVlblJvdWdobmVzc01hcCA9IHNvdXJjZS5zaGVlblJvdWdobmVzc01hcDsKCgkJdGhpcy50cmFuc21pc3Npb24gPSBzb3VyY2UudHJhbnNtaXNzaW9uOwoJCXRoaXMudHJhbnNtaXNzaW9uTWFwID0gc291cmNlLnRyYW5zbWlzc2lvbk1hcDsKCgkJdGhpcy50aGlja25lc3MgPSBzb3VyY2UudGhpY2tuZXNzOwoJCXRoaXMudGhpY2tuZXNzTWFwID0gc291cmNlLnRoaWNrbmVzc01hcDsKCQl0aGlzLmF0dGVudWF0aW9uRGlzdGFuY2UgPSBzb3VyY2UuYXR0ZW51YXRpb25EaXN0YW5jZTsKCQl0aGlzLmF0dGVudWF0aW9uQ29sb3IuY29weSggc291cmNlLmF0dGVudWF0aW9uQ29sb3IgKTsKCgkJdGhpcy5zcGVjdWxhckludGVuc2l0eSA9IHNvdXJjZS5zcGVjdWxhckludGVuc2l0eTsKCQl0aGlzLnNwZWN1bGFySW50ZW5zaXR5TWFwID0gc291cmNlLnNwZWN1bGFySW50ZW5zaXR5TWFwOwoJCXRoaXMuc3BlY3VsYXJDb2xvci5jb3B5KCBzb3VyY2Uuc3BlY3VsYXJDb2xvciApOwoJCXRoaXMuc3BlY3VsYXJDb2xvck1hcCA9IHNvdXJjZS5zcGVjdWxhckNvbG9yTWFwOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpjbGFzcyBNZXNoUGhvbmdNYXRlcmlhbCBleHRlbmRzIE1hdGVyaWFsIHsKCgljb25zdHJ1Y3RvciggcGFyYW1ldGVycyApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc01lc2hQaG9uZ01hdGVyaWFsID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ01lc2hQaG9uZ01hdGVyaWFsJzsKCgkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggMHhmZmZmZmYgKTsgLy8gZGlmZnVzZQoJCXRoaXMuc3BlY3VsYXIgPSBuZXcgQ29sb3IoIDB4MTExMTExICk7CgkJdGhpcy5zaGluaW5lc3MgPSAzMDsKCgkJdGhpcy5tYXAgPSBudWxsOwoKCQl0aGlzLmxpZ2h0TWFwID0gbnVsbDsKCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gMS4wOwoKCQl0aGlzLmFvTWFwID0gbnVsbDsKCQl0aGlzLmFvTWFwSW50ZW5zaXR5ID0gMS4wOwoKCQl0aGlzLmVtaXNzaXZlID0gbmV3IENvbG9yKCAweDAwMDAwMCApOwoJCXRoaXMuZW1pc3NpdmVJbnRlbnNpdHkgPSAxLjA7CgkJdGhpcy5lbWlzc2l2ZU1hcCA9IG51bGw7CgoJCXRoaXMuYnVtcE1hcCA9IG51bGw7CgkJdGhpcy5idW1wU2NhbGUgPSAxOwoKCQl0aGlzLm5vcm1hbE1hcCA9IG51bGw7CgkJdGhpcy5ub3JtYWxNYXBUeXBlID0gVGFuZ2VudFNwYWNlTm9ybWFsTWFwOwoJCXRoaXMubm9ybWFsU2NhbGUgPSBuZXcgVmVjdG9yMiggMSwgMSApOwoKCQl0aGlzLmRpc3BsYWNlbWVudE1hcCA9IG51bGw7CgkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IDE7CgkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gMDsKCgkJdGhpcy5zcGVjdWxhck1hcCA9IG51bGw7CgoJCXRoaXMuYWxwaGFNYXAgPSBudWxsOwoKCQl0aGlzLmVudk1hcCA9IG51bGw7CgkJdGhpcy5jb21iaW5lID0gTXVsdGlwbHlPcGVyYXRpb247CgkJdGhpcy5yZWZsZWN0aXZpdHkgPSAxOwoJCXRoaXMucmVmcmFjdGlvblJhdGlvID0gMC45ODsKCgkJdGhpcy53aXJlZnJhbWUgPSBmYWxzZTsKCQl0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IDE7CgkJdGhpcy53aXJlZnJhbWVMaW5lY2FwID0gJ3JvdW5kJzsKCQl0aGlzLndpcmVmcmFtZUxpbmVqb2luID0gJ3JvdW5kJzsKCgkJdGhpcy5mbGF0U2hhZGluZyA9IGZhbHNlOwoKCQl0aGlzLmZvZyA9IHRydWU7CgoJCXRoaXMuc2V0VmFsdWVzKCBwYXJhbWV0ZXJzICk7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMuY29sb3IuY29weSggc291cmNlLmNvbG9yICk7CgkJdGhpcy5zcGVjdWxhci5jb3B5KCBzb3VyY2Uuc3BlY3VsYXIgKTsKCQl0aGlzLnNoaW5pbmVzcyA9IHNvdXJjZS5zaGluaW5lc3M7CgoJCXRoaXMubWFwID0gc291cmNlLm1hcDsKCgkJdGhpcy5saWdodE1hcCA9IHNvdXJjZS5saWdodE1hcDsKCQl0aGlzLmxpZ2h0TWFwSW50ZW5zaXR5ID0gc291cmNlLmxpZ2h0TWFwSW50ZW5zaXR5OwoKCQl0aGlzLmFvTWFwID0gc291cmNlLmFvTWFwOwoJCXRoaXMuYW9NYXBJbnRlbnNpdHkgPSBzb3VyY2UuYW9NYXBJbnRlbnNpdHk7CgoJCXRoaXMuZW1pc3NpdmUuY29weSggc291cmNlLmVtaXNzaXZlICk7CgkJdGhpcy5lbWlzc2l2ZU1hcCA9IHNvdXJjZS5lbWlzc2l2ZU1hcDsKCQl0aGlzLmVtaXNzaXZlSW50ZW5zaXR5ID0gc291cmNlLmVtaXNzaXZlSW50ZW5zaXR5OwoKCQl0aGlzLmJ1bXBNYXAgPSBzb3VyY2UuYnVtcE1hcDsKCQl0aGlzLmJ1bXBTY2FsZSA9IHNvdXJjZS5idW1wU2NhbGU7CgoJCXRoaXMubm9ybWFsTWFwID0gc291cmNlLm5vcm1hbE1hcDsKCQl0aGlzLm5vcm1hbE1hcFR5cGUgPSBzb3VyY2Uubm9ybWFsTWFwVHlwZTsKCQl0aGlzLm5vcm1hbFNjYWxlLmNvcHkoIHNvdXJjZS5ub3JtYWxTY2FsZSApOwoKCQl0aGlzLmRpc3BsYWNlbWVudE1hcCA9IHNvdXJjZS5kaXNwbGFjZW1lbnRNYXA7CgkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IHNvdXJjZS5kaXNwbGFjZW1lbnRTY2FsZTsKCQl0aGlzLmRpc3BsYWNlbWVudEJpYXMgPSBzb3VyY2UuZGlzcGxhY2VtZW50QmlhczsKCgkJdGhpcy5zcGVjdWxhck1hcCA9IHNvdXJjZS5zcGVjdWxhck1hcDsKCgkJdGhpcy5hbHBoYU1hcCA9IHNvdXJjZS5hbHBoYU1hcDsKCgkJdGhpcy5lbnZNYXAgPSBzb3VyY2UuZW52TWFwOwoJCXRoaXMuY29tYmluZSA9IHNvdXJjZS5jb21iaW5lOwoJCXRoaXMucmVmbGVjdGl2aXR5ID0gc291cmNlLnJlZmxlY3Rpdml0eTsKCQl0aGlzLnJlZnJhY3Rpb25SYXRpbyA9IHNvdXJjZS5yZWZyYWN0aW9uUmF0aW87CgoJCXRoaXMud2lyZWZyYW1lID0gc291cmNlLndpcmVmcmFtZTsKCQl0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IHNvdXJjZS53aXJlZnJhbWVMaW5ld2lkdGg7CgkJdGhpcy53aXJlZnJhbWVMaW5lY2FwID0gc291cmNlLndpcmVmcmFtZUxpbmVjYXA7CgkJdGhpcy53aXJlZnJhbWVMaW5lam9pbiA9IHNvdXJjZS53aXJlZnJhbWVMaW5lam9pbjsKCgkJdGhpcy5mbGF0U2hhZGluZyA9IHNvdXJjZS5mbGF0U2hhZGluZzsKCgkJdGhpcy5mb2cgPSBzb3VyY2UuZm9nOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpjbGFzcyBNZXNoVG9vbk1hdGVyaWFsIGV4dGVuZHMgTWF0ZXJpYWwgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJzICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzTWVzaFRvb25NYXRlcmlhbCA9IHRydWU7CgoJCXRoaXMuZGVmaW5lcyA9IHsgJ1RPT04nOiAnJyB9OwoKCQl0aGlzLnR5cGUgPSAnTWVzaFRvb25NYXRlcmlhbCc7CgoJCXRoaXMuY29sb3IgPSBuZXcgQ29sb3IoIDB4ZmZmZmZmICk7CgoJCXRoaXMubWFwID0gbnVsbDsKCQl0aGlzLmdyYWRpZW50TWFwID0gbnVsbDsKCgkJdGhpcy5saWdodE1hcCA9IG51bGw7CgkJdGhpcy5saWdodE1hcEludGVuc2l0eSA9IDEuMDsKCgkJdGhpcy5hb01hcCA9IG51bGw7CgkJdGhpcy5hb01hcEludGVuc2l0eSA9IDEuMDsKCgkJdGhpcy5lbWlzc2l2ZSA9IG5ldyBDb2xvciggMHgwMDAwMDAgKTsKCQl0aGlzLmVtaXNzaXZlSW50ZW5zaXR5ID0gMS4wOwoJCXRoaXMuZW1pc3NpdmVNYXAgPSBudWxsOwoKCQl0aGlzLmJ1bXBNYXAgPSBudWxsOwoJCXRoaXMuYnVtcFNjYWxlID0gMTsKCgkJdGhpcy5ub3JtYWxNYXAgPSBudWxsOwoJCXRoaXMubm9ybWFsTWFwVHlwZSA9IFRhbmdlbnRTcGFjZU5vcm1hbE1hcDsKCQl0aGlzLm5vcm1hbFNjYWxlID0gbmV3IFZlY3RvcjIoIDEsIDEgKTsKCgkJdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBudWxsOwoJCXRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSAxOwoJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IDA7CgoJCXRoaXMuYWxwaGFNYXAgPSBudWxsOwoKCQl0aGlzLndpcmVmcmFtZSA9IGZhbHNlOwoJCXRoaXMud2lyZWZyYW1lTGluZXdpZHRoID0gMTsKCQl0aGlzLndpcmVmcmFtZUxpbmVjYXAgPSAncm91bmQnOwoJCXRoaXMud2lyZWZyYW1lTGluZWpvaW4gPSAncm91bmQnOwoKCQl0aGlzLmZvZyA9IHRydWU7CgoJCXRoaXMuc2V0VmFsdWVzKCBwYXJhbWV0ZXJzICk7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMuY29sb3IuY29weSggc291cmNlLmNvbG9yICk7CgoJCXRoaXMubWFwID0gc291cmNlLm1hcDsKCQl0aGlzLmdyYWRpZW50TWFwID0gc291cmNlLmdyYWRpZW50TWFwOwoKCQl0aGlzLmxpZ2h0TWFwID0gc291cmNlLmxpZ2h0TWFwOwoJCXRoaXMubGlnaHRNYXBJbnRlbnNpdHkgPSBzb3VyY2UubGlnaHRNYXBJbnRlbnNpdHk7CgoJCXRoaXMuYW9NYXAgPSBzb3VyY2UuYW9NYXA7CgkJdGhpcy5hb01hcEludGVuc2l0eSA9IHNvdXJjZS5hb01hcEludGVuc2l0eTsKCgkJdGhpcy5lbWlzc2l2ZS5jb3B5KCBzb3VyY2UuZW1pc3NpdmUgKTsKCQl0aGlzLmVtaXNzaXZlTWFwID0gc291cmNlLmVtaXNzaXZlTWFwOwoJCXRoaXMuZW1pc3NpdmVJbnRlbnNpdHkgPSBzb3VyY2UuZW1pc3NpdmVJbnRlbnNpdHk7CgoJCXRoaXMuYnVtcE1hcCA9IHNvdXJjZS5idW1wTWFwOwoJCXRoaXMuYnVtcFNjYWxlID0gc291cmNlLmJ1bXBTY2FsZTsKCgkJdGhpcy5ub3JtYWxNYXAgPSBzb3VyY2Uubm9ybWFsTWFwOwoJCXRoaXMubm9ybWFsTWFwVHlwZSA9IHNvdXJjZS5ub3JtYWxNYXBUeXBlOwoJCXRoaXMubm9ybWFsU2NhbGUuY29weSggc291cmNlLm5vcm1hbFNjYWxlICk7CgoJCXRoaXMuZGlzcGxhY2VtZW50TWFwID0gc291cmNlLmRpc3BsYWNlbWVudE1hcDsKCQl0aGlzLmRpc3BsYWNlbWVudFNjYWxlID0gc291cmNlLmRpc3BsYWNlbWVudFNjYWxlOwoJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IHNvdXJjZS5kaXNwbGFjZW1lbnRCaWFzOwoKCQl0aGlzLmFscGhhTWFwID0gc291cmNlLmFscGhhTWFwOwoKCQl0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CgkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSBzb3VyY2Uud2lyZWZyYW1lTGluZXdpZHRoOwoJCXRoaXMud2lyZWZyYW1lTGluZWNhcCA9IHNvdXJjZS53aXJlZnJhbWVMaW5lY2FwOwoJCXRoaXMud2lyZWZyYW1lTGluZWpvaW4gPSBzb3VyY2Uud2lyZWZyYW1lTGluZWpvaW47CgoJCXRoaXMuZm9nID0gc291cmNlLmZvZzsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKY2xhc3MgTWVzaE5vcm1hbE1hdGVyaWFsIGV4dGVuZHMgTWF0ZXJpYWwgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJzICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzTWVzaE5vcm1hbE1hdGVyaWFsID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ01lc2hOb3JtYWxNYXRlcmlhbCc7CgoJCXRoaXMuYnVtcE1hcCA9IG51bGw7CgkJdGhpcy5idW1wU2NhbGUgPSAxOwoKCQl0aGlzLm5vcm1hbE1hcCA9IG51bGw7CgkJdGhpcy5ub3JtYWxNYXBUeXBlID0gVGFuZ2VudFNwYWNlTm9ybWFsTWFwOwoJCXRoaXMubm9ybWFsU2NhbGUgPSBuZXcgVmVjdG9yMiggMSwgMSApOwoKCQl0aGlzLmRpc3BsYWNlbWVudE1hcCA9IG51bGw7CgkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IDE7CgkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gMDsKCgkJdGhpcy53aXJlZnJhbWUgPSBmYWxzZTsKCQl0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IDE7CgoJCXRoaXMuZmxhdFNoYWRpbmcgPSBmYWxzZTsKCgkJdGhpcy5zZXRWYWx1ZXMoIHBhcmFtZXRlcnMgKTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5idW1wTWFwID0gc291cmNlLmJ1bXBNYXA7CgkJdGhpcy5idW1wU2NhbGUgPSBzb3VyY2UuYnVtcFNjYWxlOwoKCQl0aGlzLm5vcm1hbE1hcCA9IHNvdXJjZS5ub3JtYWxNYXA7CgkJdGhpcy5ub3JtYWxNYXBUeXBlID0gc291cmNlLm5vcm1hbE1hcFR5cGU7CgkJdGhpcy5ub3JtYWxTY2FsZS5jb3B5KCBzb3VyY2Uubm9ybWFsU2NhbGUgKTsKCgkJdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBzb3VyY2UuZGlzcGxhY2VtZW50TWFwOwoJCXRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSBzb3VyY2UuZGlzcGxhY2VtZW50U2NhbGU7CgkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gc291cmNlLmRpc3BsYWNlbWVudEJpYXM7CgoJCXRoaXMud2lyZWZyYW1lID0gc291cmNlLndpcmVmcmFtZTsKCQl0aGlzLndpcmVmcmFtZUxpbmV3aWR0aCA9IHNvdXJjZS53aXJlZnJhbWVMaW5ld2lkdGg7CgoJCXRoaXMuZmxhdFNoYWRpbmcgPSBzb3VyY2UuZmxhdFNoYWRpbmc7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNsYXNzIE1lc2hMYW1iZXJ0TWF0ZXJpYWwgZXh0ZW5kcyBNYXRlcmlhbCB7CgoJY29uc3RydWN0b3IoIHBhcmFtZXRlcnMgKSB7CgoJCXN1cGVyKCk7CgoJCXRoaXMuaXNNZXNoTGFtYmVydE1hdGVyaWFsID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ01lc2hMYW1iZXJ0TWF0ZXJpYWwnOwoKCQl0aGlzLmNvbG9yID0gbmV3IENvbG9yKCAweGZmZmZmZiApOyAvLyBkaWZmdXNlCgoJCXRoaXMubWFwID0gbnVsbDsKCgkJdGhpcy5saWdodE1hcCA9IG51bGw7CgkJdGhpcy5saWdodE1hcEludGVuc2l0eSA9IDEuMDsKCgkJdGhpcy5hb01hcCA9IG51bGw7CgkJdGhpcy5hb01hcEludGVuc2l0eSA9IDEuMDsKCgkJdGhpcy5lbWlzc2l2ZSA9IG5ldyBDb2xvciggMHgwMDAwMDAgKTsKCQl0aGlzLmVtaXNzaXZlSW50ZW5zaXR5ID0gMS4wOwoJCXRoaXMuZW1pc3NpdmVNYXAgPSBudWxsOwoKCQl0aGlzLmJ1bXBNYXAgPSBudWxsOwoJCXRoaXMuYnVtcFNjYWxlID0gMTsKCgkJdGhpcy5ub3JtYWxNYXAgPSBudWxsOwoJCXRoaXMubm9ybWFsTWFwVHlwZSA9IFRhbmdlbnRTcGFjZU5vcm1hbE1hcDsKCQl0aGlzLm5vcm1hbFNjYWxlID0gbmV3IFZlY3RvcjIoIDEsIDEgKTsKCgkJdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBudWxsOwoJCXRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSAxOwoJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IDA7CgoJCXRoaXMuc3BlY3VsYXJNYXAgPSBudWxsOwoKCQl0aGlzLmFscGhhTWFwID0gbnVsbDsKCgkJdGhpcy5lbnZNYXAgPSBudWxsOwoJCXRoaXMuY29tYmluZSA9IE11bHRpcGx5T3BlcmF0aW9uOwoJCXRoaXMucmVmbGVjdGl2aXR5ID0gMTsKCQl0aGlzLnJlZnJhY3Rpb25SYXRpbyA9IDAuOTg7CgoJCXRoaXMud2lyZWZyYW1lID0gZmFsc2U7CgkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSAxOwoJCXRoaXMud2lyZWZyYW1lTGluZWNhcCA9ICdyb3VuZCc7CgkJdGhpcy53aXJlZnJhbWVMaW5lam9pbiA9ICdyb3VuZCc7CgoJCXRoaXMuZmxhdFNoYWRpbmcgPSBmYWxzZTsKCgkJdGhpcy5mb2cgPSB0cnVlOwoKCQl0aGlzLnNldFZhbHVlcyggcGFyYW1ldGVycyApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLmNvbG9yLmNvcHkoIHNvdXJjZS5jb2xvciApOwoKCQl0aGlzLm1hcCA9IHNvdXJjZS5tYXA7CgoJCXRoaXMubGlnaHRNYXAgPSBzb3VyY2UubGlnaHRNYXA7CgkJdGhpcy5saWdodE1hcEludGVuc2l0eSA9IHNvdXJjZS5saWdodE1hcEludGVuc2l0eTsKCgkJdGhpcy5hb01hcCA9IHNvdXJjZS5hb01hcDsKCQl0aGlzLmFvTWFwSW50ZW5zaXR5ID0gc291cmNlLmFvTWFwSW50ZW5zaXR5OwoKCQl0aGlzLmVtaXNzaXZlLmNvcHkoIHNvdXJjZS5lbWlzc2l2ZSApOwoJCXRoaXMuZW1pc3NpdmVNYXAgPSBzb3VyY2UuZW1pc3NpdmVNYXA7CgkJdGhpcy5lbWlzc2l2ZUludGVuc2l0eSA9IHNvdXJjZS5lbWlzc2l2ZUludGVuc2l0eTsKCgkJdGhpcy5idW1wTWFwID0gc291cmNlLmJ1bXBNYXA7CgkJdGhpcy5idW1wU2NhbGUgPSBzb3VyY2UuYnVtcFNjYWxlOwoKCQl0aGlzLm5vcm1hbE1hcCA9IHNvdXJjZS5ub3JtYWxNYXA7CgkJdGhpcy5ub3JtYWxNYXBUeXBlID0gc291cmNlLm5vcm1hbE1hcFR5cGU7CgkJdGhpcy5ub3JtYWxTY2FsZS5jb3B5KCBzb3VyY2Uubm9ybWFsU2NhbGUgKTsKCgkJdGhpcy5kaXNwbGFjZW1lbnRNYXAgPSBzb3VyY2UuZGlzcGxhY2VtZW50TWFwOwoJCXRoaXMuZGlzcGxhY2VtZW50U2NhbGUgPSBzb3VyY2UuZGlzcGxhY2VtZW50U2NhbGU7CgkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gc291cmNlLmRpc3BsYWNlbWVudEJpYXM7CgoJCXRoaXMuc3BlY3VsYXJNYXAgPSBzb3VyY2Uuc3BlY3VsYXJNYXA7CgoJCXRoaXMuYWxwaGFNYXAgPSBzb3VyY2UuYWxwaGFNYXA7CgoJCXRoaXMuZW52TWFwID0gc291cmNlLmVudk1hcDsKCQl0aGlzLmNvbWJpbmUgPSBzb3VyY2UuY29tYmluZTsKCQl0aGlzLnJlZmxlY3Rpdml0eSA9IHNvdXJjZS5yZWZsZWN0aXZpdHk7CgkJdGhpcy5yZWZyYWN0aW9uUmF0aW8gPSBzb3VyY2UucmVmcmFjdGlvblJhdGlvOwoKCQl0aGlzLndpcmVmcmFtZSA9IHNvdXJjZS53aXJlZnJhbWU7CgkJdGhpcy53aXJlZnJhbWVMaW5ld2lkdGggPSBzb3VyY2Uud2lyZWZyYW1lTGluZXdpZHRoOwoJCXRoaXMud2lyZWZyYW1lTGluZWNhcCA9IHNvdXJjZS53aXJlZnJhbWVMaW5lY2FwOwoJCXRoaXMud2lyZWZyYW1lTGluZWpvaW4gPSBzb3VyY2Uud2lyZWZyYW1lTGluZWpvaW47CgoJCXRoaXMuZmxhdFNoYWRpbmcgPSBzb3VyY2UuZmxhdFNoYWRpbmc7CgoJCXRoaXMuZm9nID0gc291cmNlLmZvZzsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKY2xhc3MgTWVzaE1hdGNhcE1hdGVyaWFsIGV4dGVuZHMgTWF0ZXJpYWwgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJzICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzTWVzaE1hdGNhcE1hdGVyaWFsID0gdHJ1ZTsKCgkJdGhpcy5kZWZpbmVzID0geyAnTUFUQ0FQJzogJycgfTsKCgkJdGhpcy50eXBlID0gJ01lc2hNYXRjYXBNYXRlcmlhbCc7CgoJCXRoaXMuY29sb3IgPSBuZXcgQ29sb3IoIDB4ZmZmZmZmICk7IC8vIGRpZmZ1c2UKCgkJdGhpcy5tYXRjYXAgPSBudWxsOwoKCQl0aGlzLm1hcCA9IG51bGw7CgoJCXRoaXMuYnVtcE1hcCA9IG51bGw7CgkJdGhpcy5idW1wU2NhbGUgPSAxOwoKCQl0aGlzLm5vcm1hbE1hcCA9IG51bGw7CgkJdGhpcy5ub3JtYWxNYXBUeXBlID0gVGFuZ2VudFNwYWNlTm9ybWFsTWFwOwoJCXRoaXMubm9ybWFsU2NhbGUgPSBuZXcgVmVjdG9yMiggMSwgMSApOwoKCQl0aGlzLmRpc3BsYWNlbWVudE1hcCA9IG51bGw7CgkJdGhpcy5kaXNwbGFjZW1lbnRTY2FsZSA9IDE7CgkJdGhpcy5kaXNwbGFjZW1lbnRCaWFzID0gMDsKCgkJdGhpcy5hbHBoYU1hcCA9IG51bGw7CgoJCXRoaXMuZmxhdFNoYWRpbmcgPSBmYWxzZTsKCgkJdGhpcy5mb2cgPSB0cnVlOwoKCQl0aGlzLnNldFZhbHVlcyggcGFyYW1ldGVycyApOwoKCX0KCgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5kZWZpbmVzID0geyAnTUFUQ0FQJzogJycgfTsKCgkJdGhpcy5jb2xvci5jb3B5KCBzb3VyY2UuY29sb3IgKTsKCgkJdGhpcy5tYXRjYXAgPSBzb3VyY2UubWF0Y2FwOwoKCQl0aGlzLm1hcCA9IHNvdXJjZS5tYXA7CgoJCXRoaXMuYnVtcE1hcCA9IHNvdXJjZS5idW1wTWFwOwoJCXRoaXMuYnVtcFNjYWxlID0gc291cmNlLmJ1bXBTY2FsZTsKCgkJdGhpcy5ub3JtYWxNYXAgPSBzb3VyY2Uubm9ybWFsTWFwOwoJCXRoaXMubm9ybWFsTWFwVHlwZSA9IHNvdXJjZS5ub3JtYWxNYXBUeXBlOwoJCXRoaXMubm9ybWFsU2NhbGUuY29weSggc291cmNlLm5vcm1hbFNjYWxlICk7CgoJCXRoaXMuZGlzcGxhY2VtZW50TWFwID0gc291cmNlLmRpc3BsYWNlbWVudE1hcDsKCQl0aGlzLmRpc3BsYWNlbWVudFNjYWxlID0gc291cmNlLmRpc3BsYWNlbWVudFNjYWxlOwoJCXRoaXMuZGlzcGxhY2VtZW50QmlhcyA9IHNvdXJjZS5kaXNwbGFjZW1lbnRCaWFzOwoKCQl0aGlzLmFscGhhTWFwID0gc291cmNlLmFscGhhTWFwOwoKCQl0aGlzLmZsYXRTaGFkaW5nID0gc291cmNlLmZsYXRTaGFkaW5nOwoKCQl0aGlzLmZvZyA9IHNvdXJjZS5mb2c7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNsYXNzIExpbmVEYXNoZWRNYXRlcmlhbCBleHRlbmRzIExpbmVCYXNpY01hdGVyaWFsIHsKCgljb25zdHJ1Y3RvciggcGFyYW1ldGVycyApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc0xpbmVEYXNoZWRNYXRlcmlhbCA9IHRydWU7CgoJCXRoaXMudHlwZSA9ICdMaW5lRGFzaGVkTWF0ZXJpYWwnOwoKCQl0aGlzLnNjYWxlID0gMTsKCQl0aGlzLmRhc2hTaXplID0gMzsKCQl0aGlzLmdhcFNpemUgPSAxOwoKCQl0aGlzLnNldFZhbHVlcyggcGFyYW1ldGVycyApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLnNjYWxlID0gc291cmNlLnNjYWxlOwoJCXRoaXMuZGFzaFNpemUgPSBzb3VyY2UuZGFzaFNpemU7CgkJdGhpcy5nYXBTaXplID0gc291cmNlLmdhcFNpemU7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCi8vIGNvbnZlcnRzIGFuIGFycmF5IHRvIGEgc3BlY2lmaWMgdHlwZQpmdW5jdGlvbiBjb252ZXJ0QXJyYXkoIGFycmF5LCB0eXBlLCBmb3JjZUNsb25lICkgewoKCWlmICggISBhcnJheSB8fCAvLyBsZXQgJ3VuZGVmaW5lZCcgYW5kICdudWxsJyBwYXNzCgkJISBmb3JjZUNsb25lICYmIGFycmF5LmNvbnN0cnVjdG9yID09PSB0eXBlICkgcmV0dXJuIGFycmF5OwoKCWlmICggdHlwZW9mIHR5cGUuQllURVNfUEVSX0VMRU1FTlQgPT09ICdudW1iZXInICkgewoKCQlyZXR1cm4gbmV3IHR5cGUoIGFycmF5ICk7IC8vIGNyZWF0ZSB0eXBlZCBhcnJheQoKCX0KCglyZXR1cm4gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoIGFycmF5ICk7IC8vIGNyZWF0ZSBBcnJheQoKfQoKZnVuY3Rpb24gaXNUeXBlZEFycmF5KCBvYmplY3QgKSB7CgoJcmV0dXJuIEFycmF5QnVmZmVyLmlzVmlldyggb2JqZWN0ICkgJiYKCQkhICggb2JqZWN0IGluc3RhbmNlb2YgRGF0YVZpZXcgKTsKCn0KCi8vIHJldHVybnMgYW4gYXJyYXkgYnkgd2hpY2ggdGltZXMgYW5kIHZhbHVlcyBjYW4gYmUgc29ydGVkCmZ1bmN0aW9uIGdldEtleWZyYW1lT3JkZXIoIHRpbWVzICkgewoKCWZ1bmN0aW9uIGNvbXBhcmVUaW1lKCBpLCBqICkgewoKCQlyZXR1cm4gdGltZXNbIGkgXSAtIHRpbWVzWyBqIF07CgoJfQoKCWNvbnN0IG4gPSB0aW1lcy5sZW5ndGg7Cgljb25zdCByZXN1bHQgPSBuZXcgQXJyYXkoIG4gKTsKCWZvciAoIGxldCBpID0gMDsgaSAhPT0gbjsgKysgaSApIHJlc3VsdFsgaSBdID0gaTsKCglyZXN1bHQuc29ydCggY29tcGFyZVRpbWUgKTsKCglyZXR1cm4gcmVzdWx0OwoKfQoKLy8gdXNlcyB0aGUgYXJyYXkgcHJldmlvdXNseSByZXR1cm5lZCBieSAnZ2V0S2V5ZnJhbWVPcmRlcicgdG8gc29ydCBkYXRhCmZ1bmN0aW9uIHNvcnRlZEFycmF5KCB2YWx1ZXMsIHN0cmlkZSwgb3JkZXIgKSB7CgoJY29uc3QgblZhbHVlcyA9IHZhbHVlcy5sZW5ndGg7Cgljb25zdCByZXN1bHQgPSBuZXcgdmFsdWVzLmNvbnN0cnVjdG9yKCBuVmFsdWVzICk7CgoJZm9yICggbGV0IGkgPSAwLCBkc3RPZmZzZXQgPSAwOyBkc3RPZmZzZXQgIT09IG5WYWx1ZXM7ICsrIGkgKSB7CgoJCWNvbnN0IHNyY09mZnNldCA9IG9yZGVyWyBpIF0gKiBzdHJpZGU7CgoJCWZvciAoIGxldCBqID0gMDsgaiAhPT0gc3RyaWRlOyArKyBqICkgewoKCQkJcmVzdWx0WyBkc3RPZmZzZXQgKysgXSA9IHZhbHVlc1sgc3JjT2Zmc2V0ICsgaiBdOwoKCQl9CgoJfQoKCXJldHVybiByZXN1bHQ7Cgp9CgovLyBmdW5jdGlvbiBmb3IgcGFyc2luZyBBT1Mga2V5ZnJhbWUgZm9ybWF0cwpmdW5jdGlvbiBmbGF0dGVuSlNPTigganNvbktleXMsIHRpbWVzLCB2YWx1ZXMsIHZhbHVlUHJvcGVydHlOYW1lICkgewoKCWxldCBpID0gMSwga2V5ID0ganNvbktleXNbIDAgXTsKCgl3aGlsZSAoIGtleSAhPT0gdW5kZWZpbmVkICYmIGtleVsgdmFsdWVQcm9wZXJ0eU5hbWUgXSA9PT0gdW5kZWZpbmVkICkgewoKCQlrZXkgPSBqc29uS2V5c1sgaSArKyBdOwoKCX0KCglpZiAoIGtleSA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOyAvLyBubyBkYXRhCgoJbGV0IHZhbHVlID0ga2V5WyB2YWx1ZVByb3BlcnR5TmFtZSBdOwoJaWYgKCB2YWx1ZSA9PT0gdW5kZWZpbmVkICkgcmV0dXJuOyAvLyBubyBkYXRhCgoJaWYgKCBBcnJheS5pc0FycmF5KCB2YWx1ZSApICkgewoKCQlkbyB7CgoJCQl2YWx1ZSA9IGtleVsgdmFsdWVQcm9wZXJ0eU5hbWUgXTsKCgkJCWlmICggdmFsdWUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQl0aW1lcy5wdXNoKCBrZXkudGltZSApOwoJCQkJdmFsdWVzLnB1c2guYXBwbHkoIHZhbHVlcywgdmFsdWUgKTsgLy8gcHVzaCBhbGwgZWxlbWVudHMKCgkJCX0KCgkJCWtleSA9IGpzb25LZXlzWyBpICsrIF07CgoJCX0gd2hpbGUgKCBrZXkgIT09IHVuZGVmaW5lZCApOwoKCX0gZWxzZSBpZiAoIHZhbHVlLnRvQXJyYXkgIT09IHVuZGVmaW5lZCApIHsKCgkJLy8gLi4uYXNzdW1lIFRIUkVFLk1hdGgtaXNoCgoJCWRvIHsKCgkJCXZhbHVlID0ga2V5WyB2YWx1ZVByb3BlcnR5TmFtZSBdOwoKCQkJaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXRpbWVzLnB1c2goIGtleS50aW1lICk7CgkJCQl2YWx1ZS50b0FycmF5KCB2YWx1ZXMsIHZhbHVlcy5sZW5ndGggKTsKCgkJCX0KCgkJCWtleSA9IGpzb25LZXlzWyBpICsrIF07CgoJCX0gd2hpbGUgKCBrZXkgIT09IHVuZGVmaW5lZCApOwoKCX0gZWxzZSB7CgoJCS8vIG90aGVyd2lzZSBwdXNoIGFzLWlzCgoJCWRvIHsKCgkJCXZhbHVlID0ga2V5WyB2YWx1ZVByb3BlcnR5TmFtZSBdOwoKCQkJaWYgKCB2YWx1ZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXRpbWVzLnB1c2goIGtleS50aW1lICk7CgkJCQl2YWx1ZXMucHVzaCggdmFsdWUgKTsKCgkJCX0KCgkJCWtleSA9IGpzb25LZXlzWyBpICsrIF07CgoJCX0gd2hpbGUgKCBrZXkgIT09IHVuZGVmaW5lZCApOwoKCX0KCn0KCmZ1bmN0aW9uIHN1YmNsaXAoIHNvdXJjZUNsaXAsIG5hbWUsIHN0YXJ0RnJhbWUsIGVuZEZyYW1lLCBmcHMgPSAzMCApIHsKCgljb25zdCBjbGlwID0gc291cmNlQ2xpcC5jbG9uZSgpOwoKCWNsaXAubmFtZSA9IG5hbWU7CgoJY29uc3QgdHJhY2tzID0gW107CgoJZm9yICggbGV0IGkgPSAwOyBpIDwgY2xpcC50cmFja3MubGVuZ3RoOyArKyBpICkgewoKCQljb25zdCB0cmFjayA9IGNsaXAudHJhY2tzWyBpIF07CgkJY29uc3QgdmFsdWVTaXplID0gdHJhY2suZ2V0VmFsdWVTaXplKCk7CgoJCWNvbnN0IHRpbWVzID0gW107CgkJY29uc3QgdmFsdWVzID0gW107CgoJCWZvciAoIGxldCBqID0gMDsgaiA8IHRyYWNrLnRpbWVzLmxlbmd0aDsgKysgaiApIHsKCgkJCWNvbnN0IGZyYW1lID0gdHJhY2sudGltZXNbIGogXSAqIGZwczsKCgkJCWlmICggZnJhbWUgPCBzdGFydEZyYW1lIHx8IGZyYW1lID49IGVuZEZyYW1lICkgY29udGludWU7CgoJCQl0aW1lcy5wdXNoKCB0cmFjay50aW1lc1sgaiBdICk7CgoJCQlmb3IgKCBsZXQgayA9IDA7IGsgPCB2YWx1ZVNpemU7ICsrIGsgKSB7CgoJCQkJdmFsdWVzLnB1c2goIHRyYWNrLnZhbHVlc1sgaiAqIHZhbHVlU2l6ZSArIGsgXSApOwoKCQkJfQoKCQl9CgoJCWlmICggdGltZXMubGVuZ3RoID09PSAwICkgY29udGludWU7CgoJCXRyYWNrLnRpbWVzID0gY29udmVydEFycmF5KCB0aW1lcywgdHJhY2sudGltZXMuY29uc3RydWN0b3IgKTsKCQl0cmFjay52YWx1ZXMgPSBjb252ZXJ0QXJyYXkoIHZhbHVlcywgdHJhY2sudmFsdWVzLmNvbnN0cnVjdG9yICk7CgoJCXRyYWNrcy5wdXNoKCB0cmFjayApOwoKCX0KCgljbGlwLnRyYWNrcyA9IHRyYWNrczsKCgkvLyBmaW5kIG1pbmltdW0gLnRpbWVzIHZhbHVlIGFjcm9zcyBhbGwgdHJhY2tzIGluIHRoZSB0cmltbWVkIGNsaXAKCglsZXQgbWluU3RhcnRUaW1lID0gSW5maW5pdHk7CgoJZm9yICggbGV0IGkgPSAwOyBpIDwgY2xpcC50cmFja3MubGVuZ3RoOyArKyBpICkgewoKCQlpZiAoIG1pblN0YXJ0VGltZSA+IGNsaXAudHJhY2tzWyBpIF0udGltZXNbIDAgXSApIHsKCgkJCW1pblN0YXJ0VGltZSA9IGNsaXAudHJhY2tzWyBpIF0udGltZXNbIDAgXTsKCgkJfQoKCX0KCgkvLyBzaGlmdCBhbGwgdHJhY2tzIHN1Y2ggdGhhdCBjbGlwIGJlZ2lucyBhdCB0PTAKCglmb3IgKCBsZXQgaSA9IDA7IGkgPCBjbGlwLnRyYWNrcy5sZW5ndGg7ICsrIGkgKSB7CgoJCWNsaXAudHJhY2tzWyBpIF0uc2hpZnQoIC0gMSAqIG1pblN0YXJ0VGltZSApOwoKCX0KCgljbGlwLnJlc2V0RHVyYXRpb24oKTsKCglyZXR1cm4gY2xpcDsKCn0KCmZ1bmN0aW9uIG1ha2VDbGlwQWRkaXRpdmUoIHRhcmdldENsaXAsIHJlZmVyZW5jZUZyYW1lID0gMCwgcmVmZXJlbmNlQ2xpcCA9IHRhcmdldENsaXAsIGZwcyA9IDMwICkgewoKCWlmICggZnBzIDw9IDAgKSBmcHMgPSAzMDsKCgljb25zdCBudW1UcmFja3MgPSByZWZlcmVuY2VDbGlwLnRyYWNrcy5sZW5ndGg7Cgljb25zdCByZWZlcmVuY2VUaW1lID0gcmVmZXJlbmNlRnJhbWUgLyBmcHM7CgoJLy8gTWFrZSBlYWNoIHRyYWNrJ3MgdmFsdWVzIHJlbGF0aXZlIHRvIHRoZSB2YWx1ZXMgYXQgdGhlIHJlZmVyZW5jZSBmcmFtZQoJZm9yICggbGV0IGkgPSAwOyBpIDwgbnVtVHJhY2tzOyArKyBpICkgewoKCQljb25zdCByZWZlcmVuY2VUcmFjayA9IHJlZmVyZW5jZUNsaXAudHJhY2tzWyBpIF07CgkJY29uc3QgcmVmZXJlbmNlVHJhY2tUeXBlID0gcmVmZXJlbmNlVHJhY2suVmFsdWVUeXBlTmFtZTsKCgkJLy8gU2tpcCB0aGlzIHRyYWNrIGlmIGl0J3Mgbm9uLW51bWVyaWMKCQlpZiAoIHJlZmVyZW5jZVRyYWNrVHlwZSA9PT0gJ2Jvb2wnIHx8IHJlZmVyZW5jZVRyYWNrVHlwZSA9PT0gJ3N0cmluZycgKSBjb250aW51ZTsKCgkJLy8gRmluZCB0aGUgdHJhY2sgaW4gdGhlIHRhcmdldCBjbGlwIHdob3NlIG5hbWUgYW5kIHR5cGUgbWF0Y2hlcyB0aGUgcmVmZXJlbmNlIHRyYWNrCgkJY29uc3QgdGFyZ2V0VHJhY2sgPSB0YXJnZXRDbGlwLnRyYWNrcy5maW5kKCBmdW5jdGlvbiAoIHRyYWNrICkgewoKCQkJcmV0dXJuIHRyYWNrLm5hbWUgPT09IHJlZmVyZW5jZVRyYWNrLm5hbWUKCQkJCSYmIHRyYWNrLlZhbHVlVHlwZU5hbWUgPT09IHJlZmVyZW5jZVRyYWNrVHlwZTsKCgkJfSApOwoKCQlpZiAoIHRhcmdldFRyYWNrID09PSB1bmRlZmluZWQgKSBjb250aW51ZTsKCgkJbGV0IHJlZmVyZW5jZU9mZnNldCA9IDA7CgkJY29uc3QgcmVmZXJlbmNlVmFsdWVTaXplID0gcmVmZXJlbmNlVHJhY2suZ2V0VmFsdWVTaXplKCk7CgoJCWlmICggcmVmZXJlbmNlVHJhY2suY3JlYXRlSW50ZXJwb2xhbnQuaXNJbnRlcnBvbGFudEZhY3RvcnlNZXRob2RHTFRGQ3ViaWNTcGxpbmUgKSB7CgoJCQlyZWZlcmVuY2VPZmZzZXQgPSByZWZlcmVuY2VWYWx1ZVNpemUgLyAzOwoKCQl9CgoJCWxldCB0YXJnZXRPZmZzZXQgPSAwOwoJCWNvbnN0IHRhcmdldFZhbHVlU2l6ZSA9IHRhcmdldFRyYWNrLmdldFZhbHVlU2l6ZSgpOwoKCQlpZiAoIHRhcmdldFRyYWNrLmNyZWF0ZUludGVycG9sYW50LmlzSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kR0xURkN1YmljU3BsaW5lICkgewoKCQkJdGFyZ2V0T2Zmc2V0ID0gdGFyZ2V0VmFsdWVTaXplIC8gMzsKCgkJfQoKCQljb25zdCBsYXN0SW5kZXggPSByZWZlcmVuY2VUcmFjay50aW1lcy5sZW5ndGggLSAxOwoJCWxldCByZWZlcmVuY2VWYWx1ZTsKCgkJLy8gRmluZCB0aGUgdmFsdWUgdG8gc3VidHJhY3Qgb3V0IG9mIHRoZSB0cmFjawoJCWlmICggcmVmZXJlbmNlVGltZSA8PSByZWZlcmVuY2VUcmFjay50aW1lc1sgMCBdICkgewoKCQkJLy8gUmVmZXJlbmNlIGZyYW1lIGlzIGVhcmxpZXIgdGhhbiB0aGUgZmlyc3Qga2V5ZnJhbWUsIHNvIGp1c3QgdXNlIHRoZSBmaXJzdCBrZXlmcmFtZQoJCQljb25zdCBzdGFydEluZGV4ID0gcmVmZXJlbmNlT2Zmc2V0OwoJCQljb25zdCBlbmRJbmRleCA9IHJlZmVyZW5jZVZhbHVlU2l6ZSAtIHJlZmVyZW5jZU9mZnNldDsKCQkJcmVmZXJlbmNlVmFsdWUgPSByZWZlcmVuY2VUcmFjay52YWx1ZXMuc2xpY2UoIHN0YXJ0SW5kZXgsIGVuZEluZGV4ICk7CgoJCX0gZWxzZSBpZiAoIHJlZmVyZW5jZVRpbWUgPj0gcmVmZXJlbmNlVHJhY2sudGltZXNbIGxhc3RJbmRleCBdICkgewoKCQkJLy8gUmVmZXJlbmNlIGZyYW1lIGlzIGFmdGVyIHRoZSBsYXN0IGtleWZyYW1lLCBzbyBqdXN0IHVzZSB0aGUgbGFzdCBrZXlmcmFtZQoJCQljb25zdCBzdGFydEluZGV4ID0gbGFzdEluZGV4ICogcmVmZXJlbmNlVmFsdWVTaXplICsgcmVmZXJlbmNlT2Zmc2V0OwoJCQljb25zdCBlbmRJbmRleCA9IHN0YXJ0SW5kZXggKyByZWZlcmVuY2VWYWx1ZVNpemUgLSByZWZlcmVuY2VPZmZzZXQ7CgkJCXJlZmVyZW5jZVZhbHVlID0gcmVmZXJlbmNlVHJhY2sudmFsdWVzLnNsaWNlKCBzdGFydEluZGV4LCBlbmRJbmRleCApOwoKCQl9IGVsc2UgewoKCQkJLy8gSW50ZXJwb2xhdGUgdG8gdGhlIHJlZmVyZW5jZSB2YWx1ZQoJCQljb25zdCBpbnRlcnBvbGFudCA9IHJlZmVyZW5jZVRyYWNrLmNyZWF0ZUludGVycG9sYW50KCk7CgkJCWNvbnN0IHN0YXJ0SW5kZXggPSByZWZlcmVuY2VPZmZzZXQ7CgkJCWNvbnN0IGVuZEluZGV4ID0gcmVmZXJlbmNlVmFsdWVTaXplIC0gcmVmZXJlbmNlT2Zmc2V0OwoJCQlpbnRlcnBvbGFudC5ldmFsdWF0ZSggcmVmZXJlbmNlVGltZSApOwoJCQlyZWZlcmVuY2VWYWx1ZSA9IGludGVycG9sYW50LnJlc3VsdEJ1ZmZlci5zbGljZSggc3RhcnRJbmRleCwgZW5kSW5kZXggKTsKCgkJfQoKCQkvLyBDb25qdWdhdGUgdGhlIHF1YXRlcm5pb24KCQlpZiAoIHJlZmVyZW5jZVRyYWNrVHlwZSA9PT0gJ3F1YXRlcm5pb24nICkgewoKCQkJY29uc3QgcmVmZXJlbmNlUXVhdCA9IG5ldyBRdWF0ZXJuaW9uKCkuZnJvbUFycmF5KCByZWZlcmVuY2VWYWx1ZSApLm5vcm1hbGl6ZSgpLmNvbmp1Z2F0ZSgpOwoJCQlyZWZlcmVuY2VRdWF0LnRvQXJyYXkoIHJlZmVyZW5jZVZhbHVlICk7CgoJCX0KCgkJLy8gU3VidHJhY3QgdGhlIHJlZmVyZW5jZSB2YWx1ZSBmcm9tIGFsbCBvZiB0aGUgdHJhY2sgdmFsdWVzCgoJCWNvbnN0IG51bVRpbWVzID0gdGFyZ2V0VHJhY2sudGltZXMubGVuZ3RoOwoJCWZvciAoIGxldCBqID0gMDsgaiA8IG51bVRpbWVzOyArKyBqICkgewoKCQkJY29uc3QgdmFsdWVTdGFydCA9IGogKiB0YXJnZXRWYWx1ZVNpemUgKyB0YXJnZXRPZmZzZXQ7CgoJCQlpZiAoIHJlZmVyZW5jZVRyYWNrVHlwZSA9PT0gJ3F1YXRlcm5pb24nICkgewoKCQkJCS8vIE11bHRpcGx5IHRoZSBjb25qdWdhdGUgZm9yIHF1YXRlcm5pb24gdHJhY2sgdHlwZXMKCQkJCVF1YXRlcm5pb24ubXVsdGlwbHlRdWF0ZXJuaW9uc0ZsYXQoCgkJCQkJdGFyZ2V0VHJhY2sudmFsdWVzLAoJCQkJCXZhbHVlU3RhcnQsCgkJCQkJcmVmZXJlbmNlVmFsdWUsCgkJCQkJMCwKCQkJCQl0YXJnZXRUcmFjay52YWx1ZXMsCgkJCQkJdmFsdWVTdGFydAoJCQkJKTsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc3QgdmFsdWVFbmQgPSB0YXJnZXRWYWx1ZVNpemUgLSB0YXJnZXRPZmZzZXQgKiAyOwoKCQkJCS8vIFN1YnRyYWN0IGVhY2ggdmFsdWUgZm9yIGFsbCBvdGhlciBudW1lcmljIHRyYWNrIHR5cGVzCgkJCQlmb3IgKCBsZXQgayA9IDA7IGsgPCB2YWx1ZUVuZDsgKysgayApIHsKCgkJCQkJdGFyZ2V0VHJhY2sudmFsdWVzWyB2YWx1ZVN0YXJ0ICsgayBdIC09IHJlZmVyZW5jZVZhbHVlWyBrIF07CgoJCQkJfQoKCQkJfQoKCQl9CgoJfQoKCXRhcmdldENsaXAuYmxlbmRNb2RlID0gQWRkaXRpdmVBbmltYXRpb25CbGVuZE1vZGU7CgoJcmV0dXJuIHRhcmdldENsaXA7Cgp9Cgpjb25zdCBBbmltYXRpb25VdGlscyA9IHsKCWNvbnZlcnRBcnJheTogY29udmVydEFycmF5LAoJaXNUeXBlZEFycmF5OiBpc1R5cGVkQXJyYXksCglnZXRLZXlmcmFtZU9yZGVyOiBnZXRLZXlmcmFtZU9yZGVyLAoJc29ydGVkQXJyYXk6IHNvcnRlZEFycmF5LAoJZmxhdHRlbkpTT046IGZsYXR0ZW5KU09OLAoJc3ViY2xpcDogc3ViY2xpcCwKCW1ha2VDbGlwQWRkaXRpdmU6IG1ha2VDbGlwQWRkaXRpdmUKfTsKCi8qKgogKiBBYnN0cmFjdCBiYXNlIGNsYXNzIG9mIGludGVycG9sYW50cyBvdmVyIHBhcmFtZXRyaWMgc2FtcGxlcy4KICoKICogVGhlIHBhcmFtZXRlciBkb21haW4gaXMgb25lIGRpbWVuc2lvbmFsLCB0eXBpY2FsbHkgdGhlIHRpbWUgb3IgYSBwYXRoCiAqIGFsb25nIGEgY3VydmUgZGVmaW5lZCBieSB0aGUgZGF0YS4KICoKICogVGhlIHNhbXBsZSB2YWx1ZXMgY2FuIGhhdmUgYW55IGRpbWVuc2lvbmFsaXR5IGFuZCBkZXJpdmVkIGNsYXNzZXMgbWF5CiAqIGFwcGx5IHNwZWNpYWwgaW50ZXJwcmV0YXRpb25zIHRvIHRoZSBkYXRhLgogKgogKiBUaGlzIGNsYXNzIHByb3ZpZGVzIHRoZSBpbnRlcnZhbCBzZWVrIGluIGEgVGVtcGxhdGUgTWV0aG9kLCBkZWZlcnJpbmcKICogdGhlIGFjdHVhbCBpbnRlcnBvbGF0aW9uIHRvIGRlcml2ZWQgY2xhc3Nlcy4KICoKICogVGltZSBjb21wbGV4aXR5IGlzIE8oMSkgZm9yIGxpbmVhciBhY2Nlc3MgY3Jvc3NpbmcgYXQgbW9zdCB0d28gcG9pbnRzCiAqIGFuZCBPKGxvZyBOKSBmb3IgcmFuZG9tIGFjY2Vzcywgd2hlcmUgTiBpcyB0aGUgbnVtYmVyIG9mIHBvc2l0aW9ucy4KICoKICogUmVmZXJlbmNlczoKICoKICogCQlodHRwOi8vd3d3Lm9vZGVzaWduLmNvbS90ZW1wbGF0ZS1tZXRob2QtcGF0dGVybi5odG1sCiAqCiAqLwoKY2xhc3MgSW50ZXJwb2xhbnQgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJQb3NpdGlvbnMsIHNhbXBsZVZhbHVlcywgc2FtcGxlU2l6ZSwgcmVzdWx0QnVmZmVyICkgewoKCQl0aGlzLnBhcmFtZXRlclBvc2l0aW9ucyA9IHBhcmFtZXRlclBvc2l0aW9uczsKCQl0aGlzLl9jYWNoZWRJbmRleCA9IDA7CgoJCXRoaXMucmVzdWx0QnVmZmVyID0gcmVzdWx0QnVmZmVyICE9PSB1bmRlZmluZWQgPwoJCQlyZXN1bHRCdWZmZXIgOiBuZXcgc2FtcGxlVmFsdWVzLmNvbnN0cnVjdG9yKCBzYW1wbGVTaXplICk7CgkJdGhpcy5zYW1wbGVWYWx1ZXMgPSBzYW1wbGVWYWx1ZXM7CgkJdGhpcy52YWx1ZVNpemUgPSBzYW1wbGVTaXplOwoKCQl0aGlzLnNldHRpbmdzID0gbnVsbDsKCQl0aGlzLkRlZmF1bHRTZXR0aW5nc18gPSB7fTsKCgl9CgoJZXZhbHVhdGUoIHQgKSB7CgoJCWNvbnN0IHBwID0gdGhpcy5wYXJhbWV0ZXJQb3NpdGlvbnM7CgkJbGV0IGkxID0gdGhpcy5fY2FjaGVkSW5kZXgsCgkJCXQxID0gcHBbIGkxIF0sCgkJCXQwID0gcHBbIGkxIC0gMSBdOwoKCQl2YWxpZGF0ZV9pbnRlcnZhbDogewoKCQkJc2VlazogewoKCQkJCWxldCByaWdodDsKCgkJCQlsaW5lYXJfc2NhbjogewoKCQkJCQkvLy0gU2VlIGh0dHA6Ly9qc3BlcmYuY29tL2NvbXBhcmlzb24tdG8tdW5kZWZpbmVkLzMKCQkJCQkvLy0gc2xvd2VyIGNvZGU6CgkJCQkJLy8tCgkJCQkJLy8tIAkJCQlpZiAoIHQgPj0gdDEgfHwgdDEgPT09IHVuZGVmaW5lZCApIHsKCQkJCQlmb3J3YXJkX3NjYW46IGlmICggISAoIHQgPCB0MSApICkgewoKCQkJCQkJZm9yICggbGV0IGdpdmVVcEF0ID0gaTEgKyAyOyA7ICkgewoKCQkJCQkJCWlmICggdDEgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJCQkJaWYgKCB0IDwgdDAgKSBicmVhayBmb3J3YXJkX3NjYW47CgoJCQkJCQkJCS8vIGFmdGVyIGVuZAoKCQkJCQkJCQlpMSA9IHBwLmxlbmd0aDsKCQkJCQkJCQl0aGlzLl9jYWNoZWRJbmRleCA9IGkxOwoJCQkJCQkJCXJldHVybiB0aGlzLmNvcHlTYW1wbGVWYWx1ZV8oIGkxIC0gMSApOwoKCQkJCQkJCX0KCgkJCQkJCQlpZiAoIGkxID09PSBnaXZlVXBBdCApIGJyZWFrOyAvLyB0aGlzIGxvb3AKCgkJCQkJCQl0MCA9IHQxOwoJCQkJCQkJdDEgPSBwcFsgKysgaTEgXTsKCgkJCQkJCQlpZiAoIHQgPCB0MSApIHsKCgkJCQkJCQkJLy8gd2UgaGF2ZSBhcnJpdmVkIGF0IHRoZSBzb3VnaHQgaW50ZXJ2YWwKCQkJCQkJCQlicmVhayBzZWVrOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJCS8vIHByZXBhcmUgYmluYXJ5IHNlYXJjaCBvbiB0aGUgcmlnaHQgc2lkZSBvZiB0aGUgaW5kZXgKCQkJCQkJcmlnaHQgPSBwcC5sZW5ndGg7CgkJCQkJCWJyZWFrIGxpbmVhcl9zY2FuOwoKCQkJCQl9CgoJCQkJCS8vLSBzbG93ZXIgY29kZToKCQkJCQkvLy0JCQkJCWlmICggdCA8IHQwIHx8IHQwID09PSB1bmRlZmluZWQgKSB7CgkJCQkJaWYgKCAhICggdCA+PSB0MCApICkgewoKCQkJCQkJLy8gbG9vcGluZz8KCgkJCQkJCWNvbnN0IHQxZ2xvYmFsID0gcHBbIDEgXTsKCgkJCQkJCWlmICggdCA8IHQxZ2xvYmFsICkgewoKCQkJCQkJCWkxID0gMjsgLy8gKyAxLCB1c2luZyB0aGUgc2NhbiBmb3IgdGhlIGRldGFpbHMKCQkJCQkJCXQwID0gdDFnbG9iYWw7CgoJCQkJCQl9CgoJCQkJCQkvLyBsaW5lYXIgcmV2ZXJzZSBzY2FuCgoJCQkJCQlmb3IgKCBsZXQgZ2l2ZVVwQXQgPSBpMSAtIDI7IDsgKSB7CgoJCQkJCQkJaWYgKCB0MCA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJCQkvLyBiZWZvcmUgc3RhcnQKCgkJCQkJCQkJdGhpcy5fY2FjaGVkSW5kZXggPSAwOwoJCQkJCQkJCXJldHVybiB0aGlzLmNvcHlTYW1wbGVWYWx1ZV8oIDAgKTsKCgkJCQkJCQl9CgoJCQkJCQkJaWYgKCBpMSA9PT0gZ2l2ZVVwQXQgKSBicmVhazsgLy8gdGhpcyBsb29wCgoJCQkJCQkJdDEgPSB0MDsKCQkJCQkJCXQwID0gcHBbIC0tIGkxIC0gMSBdOwoKCQkJCQkJCWlmICggdCA+PSB0MCApIHsKCgkJCQkJCQkJLy8gd2UgaGF2ZSBhcnJpdmVkIGF0IHRoZSBzb3VnaHQgaW50ZXJ2YWwKCQkJCQkJCQlicmVhayBzZWVrOwoKCQkJCQkJCX0KCgkJCQkJCX0KCgkJCQkJCS8vIHByZXBhcmUgYmluYXJ5IHNlYXJjaCBvbiB0aGUgbGVmdCBzaWRlIG9mIHRoZSBpbmRleAoJCQkJCQlyaWdodCA9IGkxOwoJCQkJCQlpMSA9IDA7CgkJCQkJCWJyZWFrIGxpbmVhcl9zY2FuOwoKCQkJCQl9CgoJCQkJCS8vIHRoZSBpbnRlcnZhbCBpcyB2YWxpZAoKCQkJCQlicmVhayB2YWxpZGF0ZV9pbnRlcnZhbDsKCgkJCQl9IC8vIGxpbmVhciBzY2FuCgoJCQkJLy8gYmluYXJ5IHNlYXJjaAoKCQkJCXdoaWxlICggaTEgPCByaWdodCApIHsKCgkJCQkJY29uc3QgbWlkID0gKCBpMSArIHJpZ2h0ICkgPj4+IDE7CgoJCQkJCWlmICggdCA8IHBwWyBtaWQgXSApIHsKCgkJCQkJCXJpZ2h0ID0gbWlkOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJaTEgPSBtaWQgKyAxOwoKCQkJCQl9CgoJCQkJfQoKCQkJCXQxID0gcHBbIGkxIF07CgkJCQl0MCA9IHBwWyBpMSAtIDEgXTsKCgkJCQkvLyBjaGVjayBib3VuZGFyeSBjYXNlcywgYWdhaW4KCgkJCQlpZiAoIHQwID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCXRoaXMuX2NhY2hlZEluZGV4ID0gMDsKCQkJCQlyZXR1cm4gdGhpcy5jb3B5U2FtcGxlVmFsdWVfKCAwICk7CgoJCQkJfQoKCQkJCWlmICggdDEgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJaTEgPSBwcC5sZW5ndGg7CgkJCQkJdGhpcy5fY2FjaGVkSW5kZXggPSBpMTsKCQkJCQlyZXR1cm4gdGhpcy5jb3B5U2FtcGxlVmFsdWVfKCBpMSAtIDEgKTsKCgkJCQl9CgoJCQl9IC8vIHNlZWsKCgkJCXRoaXMuX2NhY2hlZEluZGV4ID0gaTE7CgoJCQl0aGlzLmludGVydmFsQ2hhbmdlZF8oIGkxLCB0MCwgdDEgKTsKCgkJfSAvLyB2YWxpZGF0ZV9pbnRlcnZhbAoKCQlyZXR1cm4gdGhpcy5pbnRlcnBvbGF0ZV8oIGkxLCB0MCwgdCwgdDEgKTsKCgl9CgoJZ2V0U2V0dGluZ3NfKCkgewoKCQlyZXR1cm4gdGhpcy5zZXR0aW5ncyB8fCB0aGlzLkRlZmF1bHRTZXR0aW5nc187CgoJfQoKCWNvcHlTYW1wbGVWYWx1ZV8oIGluZGV4ICkgewoKCQkvLyBjb3BpZXMgYSBzYW1wbGUgdmFsdWUgdG8gdGhlIHJlc3VsdCBidWZmZXIKCgkJY29uc3QgcmVzdWx0ID0gdGhpcy5yZXN1bHRCdWZmZXIsCgkJCXZhbHVlcyA9IHRoaXMuc2FtcGxlVmFsdWVzLAoJCQlzdHJpZGUgPSB0aGlzLnZhbHVlU2l6ZSwKCQkJb2Zmc2V0ID0gaW5kZXggKiBzdHJpZGU7CgoJCWZvciAoIGxldCBpID0gMDsgaSAhPT0gc3RyaWRlOyArKyBpICkgewoKCQkJcmVzdWx0WyBpIF0gPSB2YWx1ZXNbIG9mZnNldCArIGkgXTsKCgkJfQoKCQlyZXR1cm4gcmVzdWx0OwoKCX0KCgkvLyBUZW1wbGF0ZSBtZXRob2RzIGZvciBkZXJpdmVkIGNsYXNzZXM6CgoJaW50ZXJwb2xhdGVfKCAvKiBpMSwgdDAsIHQsIHQxICovICkgewoKCQl0aHJvdyBuZXcgRXJyb3IoICdjYWxsIHRvIGFic3RyYWN0IG1ldGhvZCcgKTsKCQkvLyBpbXBsZW1lbnRhdGlvbnMgc2hhbGwgcmV0dXJuIHRoaXMucmVzdWx0QnVmZmVyCgoJfQoKCWludGVydmFsQ2hhbmdlZF8oIC8qIGkxLCB0MCwgdDEgKi8gKSB7CgoJCS8vIGVtcHR5CgoJfQoKfQoKLyoqCiAqIEZhc3QgYW5kIHNpbXBsZSBjdWJpYyBzcGxpbmUgaW50ZXJwb2xhbnQuCiAqCiAqIEl0IHdhcyBkZXJpdmVkIGZyb20gYSBIZXJtaXRpYW4gY29uc3RydWN0aW9uIHNldHRpbmcgdGhlIGZpcnN0IGRlcml2YXRpdmUKICogYXQgZWFjaCBzYW1wbGUgcG9zaXRpb24gdG8gdGhlIGxpbmVhciBzbG9wZSBiZXR3ZWVuIG5laWdoYm9yaW5nIHBvc2l0aW9ucwogKiBvdmVyIHRoZWlyIHBhcmFtZXRlciBpbnRlcnZhbC4KICovCgpjbGFzcyBDdWJpY0ludGVycG9sYW50IGV4dGVuZHMgSW50ZXJwb2xhbnQgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJQb3NpdGlvbnMsIHNhbXBsZVZhbHVlcywgc2FtcGxlU2l6ZSwgcmVzdWx0QnVmZmVyICkgewoKCQlzdXBlciggcGFyYW1ldGVyUG9zaXRpb25zLCBzYW1wbGVWYWx1ZXMsIHNhbXBsZVNpemUsIHJlc3VsdEJ1ZmZlciApOwoKCQl0aGlzLl93ZWlnaHRQcmV2ID0gLSAwOwoJCXRoaXMuX29mZnNldFByZXYgPSAtIDA7CgkJdGhpcy5fd2VpZ2h0TmV4dCA9IC0gMDsKCQl0aGlzLl9vZmZzZXROZXh0ID0gLSAwOwoKCQl0aGlzLkRlZmF1bHRTZXR0aW5nc18gPSB7CgoJCQllbmRpbmdTdGFydDogWmVyb0N1cnZhdHVyZUVuZGluZywKCQkJZW5kaW5nRW5kOiBaZXJvQ3VydmF0dXJlRW5kaW5nCgoJCX07CgoJfQoKCWludGVydmFsQ2hhbmdlZF8oIGkxLCB0MCwgdDEgKSB7CgoJCWNvbnN0IHBwID0gdGhpcy5wYXJhbWV0ZXJQb3NpdGlvbnM7CgkJbGV0IGlQcmV2ID0gaTEgLSAyLAoJCQlpTmV4dCA9IGkxICsgMSwKCgkJCXRQcmV2ID0gcHBbIGlQcmV2IF0sCgkJCXROZXh0ID0gcHBbIGlOZXh0IF07CgoJCWlmICggdFByZXYgPT09IHVuZGVmaW5lZCApIHsKCgkJCXN3aXRjaCAoIHRoaXMuZ2V0U2V0dGluZ3NfKCkuZW5kaW5nU3RhcnQgKSB7CgoJCQkJY2FzZSBaZXJvU2xvcGVFbmRpbmc6CgoJCQkJCS8vIGYnKHQwKSA9IDAKCQkJCQlpUHJldiA9IGkxOwoJCQkJCXRQcmV2ID0gMiAqIHQwIC0gdDE7CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgV3JhcEFyb3VuZEVuZGluZzoKCgkJCQkJLy8gdXNlIHRoZSBvdGhlciBlbmQgb2YgdGhlIGN1cnZlCgkJCQkJaVByZXYgPSBwcC5sZW5ndGggLSAyOwoJCQkJCXRQcmV2ID0gdDAgKyBwcFsgaVByZXYgXSAtIHBwWyBpUHJldiArIDEgXTsKCgkJCQkJYnJlYWs7CgoJCQkJZGVmYXVsdDogLy8gWmVyb0N1cnZhdHVyZUVuZGluZwoKCQkJCQkvLyBmJycodDApID0gMCBhLmsuYS4gTmF0dXJhbCBTcGxpbmUKCQkJCQlpUHJldiA9IGkxOwoJCQkJCXRQcmV2ID0gdDE7CgoJCQl9CgoJCX0KCgkJaWYgKCB0TmV4dCA9PT0gdW5kZWZpbmVkICkgewoKCQkJc3dpdGNoICggdGhpcy5nZXRTZXR0aW5nc18oKS5lbmRpbmdFbmQgKSB7CgoJCQkJY2FzZSBaZXJvU2xvcGVFbmRpbmc6CgoJCQkJCS8vIGYnKHROKSA9IDAKCQkJCQlpTmV4dCA9IGkxOwoJCQkJCXROZXh0ID0gMiAqIHQxIC0gdDA7CgoJCQkJCWJyZWFrOwoKCQkJCWNhc2UgV3JhcEFyb3VuZEVuZGluZzoKCgkJCQkJLy8gdXNlIHRoZSBvdGhlciBlbmQgb2YgdGhlIGN1cnZlCgkJCQkJaU5leHQgPSAxOwoJCQkJCXROZXh0ID0gdDEgKyBwcFsgMSBdIC0gcHBbIDAgXTsKCgkJCQkJYnJlYWs7CgoJCQkJZGVmYXVsdDogLy8gWmVyb0N1cnZhdHVyZUVuZGluZwoKCQkJCQkvLyBmJycodE4pID0gMCwgYS5rLmEuIE5hdHVyYWwgU3BsaW5lCgkJCQkJaU5leHQgPSBpMSAtIDE7CgkJCQkJdE5leHQgPSB0MDsKCgkJCX0KCgkJfQoKCQljb25zdCBoYWxmRHQgPSAoIHQxIC0gdDAgKSAqIDAuNSwKCQkJc3RyaWRlID0gdGhpcy52YWx1ZVNpemU7CgoJCXRoaXMuX3dlaWdodFByZXYgPSBoYWxmRHQgLyAoIHQwIC0gdFByZXYgKTsKCQl0aGlzLl93ZWlnaHROZXh0ID0gaGFsZkR0IC8gKCB0TmV4dCAtIHQxICk7CgkJdGhpcy5fb2Zmc2V0UHJldiA9IGlQcmV2ICogc3RyaWRlOwoJCXRoaXMuX29mZnNldE5leHQgPSBpTmV4dCAqIHN0cmlkZTsKCgl9CgoJaW50ZXJwb2xhdGVfKCBpMSwgdDAsIHQsIHQxICkgewoKCQljb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdEJ1ZmZlciwKCQkJdmFsdWVzID0gdGhpcy5zYW1wbGVWYWx1ZXMsCgkJCXN0cmlkZSA9IHRoaXMudmFsdWVTaXplLAoKCQkJbzEgPSBpMSAqIHN0cmlkZSwJCW8wID0gbzEgLSBzdHJpZGUsCgkJCW9QID0gdGhpcy5fb2Zmc2V0UHJldiwgCW9OID0gdGhpcy5fb2Zmc2V0TmV4dCwKCQkJd1AgPSB0aGlzLl93ZWlnaHRQcmV2LAl3TiA9IHRoaXMuX3dlaWdodE5leHQsCgoJCQlwID0gKCB0IC0gdDAgKSAvICggdDEgLSB0MCApLAoJCQlwcCA9IHAgKiBwLAoJCQlwcHAgPSBwcCAqIHA7CgoJCS8vIGV2YWx1YXRlIHBvbHlub21pYWxzCgoJCWNvbnN0IHNQID0gLSB3UCAqIHBwcCArIDIgKiB3UCAqIHBwIC0gd1AgKiBwOwoJCWNvbnN0IHMwID0gKCAxICsgd1AgKSAqIHBwcCArICggLSAxLjUgLSAyICogd1AgKSAqIHBwICsgKCAtIDAuNSArIHdQICkgKiBwICsgMTsKCQljb25zdCBzMSA9ICggLSAxIC0gd04gKSAqIHBwcCArICggMS41ICsgd04gKSAqIHBwICsgMC41ICogcDsKCQljb25zdCBzTiA9IHdOICogcHBwIC0gd04gKiBwcDsKCgkJLy8gY29tYmluZSBkYXRhIGxpbmVhcmx5CgoJCWZvciAoIGxldCBpID0gMDsgaSAhPT0gc3RyaWRlOyArKyBpICkgewoKCQkJcmVzdWx0WyBpIF0gPQoJCQkJCXNQICogdmFsdWVzWyBvUCArIGkgXSArCgkJCQkJczAgKiB2YWx1ZXNbIG8wICsgaSBdICsKCQkJCQlzMSAqIHZhbHVlc1sgbzEgKyBpIF0gKwoJCQkJCXNOICogdmFsdWVzWyBvTiArIGkgXTsKCgkJfQoKCQlyZXR1cm4gcmVzdWx0OwoKCX0KCn0KCmNsYXNzIExpbmVhckludGVycG9sYW50IGV4dGVuZHMgSW50ZXJwb2xhbnQgewoKCWNvbnN0cnVjdG9yKCBwYXJhbWV0ZXJQb3NpdGlvbnMsIHNhbXBsZVZhbHVlcywgc2FtcGxlU2l6ZSwgcmVzdWx0QnVmZmVyICkgewoKCQlzdXBlciggcGFyYW1ldGVyUG9zaXRpb25zLCBzYW1wbGVWYWx1ZXMsIHNhbXBsZVNpemUsIHJlc3VsdEJ1ZmZlciApOwoKCX0KCglpbnRlcnBvbGF0ZV8oIGkxLCB0MCwgdCwgdDEgKSB7CgoJCWNvbnN0IHJlc3VsdCA9IHRoaXMucmVzdWx0QnVmZmVyLAoJCQl2YWx1ZXMgPSB0aGlzLnNhbXBsZVZhbHVlcywKCQkJc3RyaWRlID0gdGhpcy52YWx1ZVNpemUsCgoJCQlvZmZzZXQxID0gaTEgKiBzdHJpZGUsCgkJCW9mZnNldDAgPSBvZmZzZXQxIC0gc3RyaWRlLAoKCQkJd2VpZ2h0MSA9ICggdCAtIHQwICkgLyAoIHQxIC0gdDAgKSwKCQkJd2VpZ2h0MCA9IDEgLSB3ZWlnaHQxOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgIT09IHN0cmlkZTsgKysgaSApIHsKCgkJCXJlc3VsdFsgaSBdID0KCQkJCQl2YWx1ZXNbIG9mZnNldDAgKyBpIF0gKiB3ZWlnaHQwICsKCQkJCQl2YWx1ZXNbIG9mZnNldDEgKyBpIF0gKiB3ZWlnaHQxOwoKCQl9CgoJCXJldHVybiByZXN1bHQ7CgoJfQoKfQoKLyoqCiAqCiAqIEludGVycG9sYW50IHRoYXQgZXZhbHVhdGVzIHRvIHRoZSBzYW1wbGUgdmFsdWUgYXQgdGhlIHBvc2l0aW9uIHByZWNlZGluZwogKiB0aGUgcGFyYW1ldGVyLgogKi8KCmNsYXNzIERpc2NyZXRlSW50ZXJwb2xhbnQgZXh0ZW5kcyBJbnRlcnBvbGFudCB7CgoJY29uc3RydWN0b3IoIHBhcmFtZXRlclBvc2l0aW9ucywgc2FtcGxlVmFsdWVzLCBzYW1wbGVTaXplLCByZXN1bHRCdWZmZXIgKSB7CgoJCXN1cGVyKCBwYXJhbWV0ZXJQb3NpdGlvbnMsIHNhbXBsZVZhbHVlcywgc2FtcGxlU2l6ZSwgcmVzdWx0QnVmZmVyICk7CgoJfQoKCWludGVycG9sYXRlXyggaTEgLyosIHQwLCB0LCB0MSAqLyApIHsKCgkJcmV0dXJuIHRoaXMuY29weVNhbXBsZVZhbHVlXyggaTEgLSAxICk7CgoJfQoKfQoKY2xhc3MgS2V5ZnJhbWVUcmFjayB7CgoJY29uc3RydWN0b3IoIG5hbWUsIHRpbWVzLCB2YWx1ZXMsIGludGVycG9sYXRpb24gKSB7CgoJCWlmICggbmFtZSA9PT0gdW5kZWZpbmVkICkgdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuS2V5ZnJhbWVUcmFjazogdHJhY2sgbmFtZSBpcyB1bmRlZmluZWQnICk7CgkJaWYgKCB0aW1lcyA9PT0gdW5kZWZpbmVkIHx8IHRpbWVzLmxlbmd0aCA9PT0gMCApIHRocm93IG5ldyBFcnJvciggJ1RIUkVFLktleWZyYW1lVHJhY2s6IG5vIGtleWZyYW1lcyBpbiB0cmFjayBuYW1lZCAnICsgbmFtZSApOwoKCQl0aGlzLm5hbWUgPSBuYW1lOwoKCQl0aGlzLnRpbWVzID0gY29udmVydEFycmF5KCB0aW1lcywgdGhpcy5UaW1lQnVmZmVyVHlwZSApOwoJCXRoaXMudmFsdWVzID0gY29udmVydEFycmF5KCB2YWx1ZXMsIHRoaXMuVmFsdWVCdWZmZXJUeXBlICk7CgoJCXRoaXMuc2V0SW50ZXJwb2xhdGlvbiggaW50ZXJwb2xhdGlvbiB8fCB0aGlzLkRlZmF1bHRJbnRlcnBvbGF0aW9uICk7CgoJfQoKCS8vIFNlcmlhbGl6YXRpb24gKGluIHN0YXRpYyBjb250ZXh0LCBiZWNhdXNlIG9mIGNvbnN0cnVjdG9yIGludm9jYXRpb24KCS8vIGFuZCBhdXRvbWF0aWMgaW52b2NhdGlvbiBvZiAudG9KU09OKToKCglzdGF0aWMgdG9KU09OKCB0cmFjayApIHsKCgkJY29uc3QgdHJhY2tUeXBlID0gdHJhY2suY29uc3RydWN0b3I7CgoJCWxldCBqc29uOwoKCQkvLyBkZXJpdmVkIGNsYXNzZXMgY2FuIGRlZmluZSBhIHN0YXRpYyB0b0pTT04gbWV0aG9kCgkJaWYgKCB0cmFja1R5cGUudG9KU09OICE9PSB0aGlzLnRvSlNPTiApIHsKCgkJCWpzb24gPSB0cmFja1R5cGUudG9KU09OKCB0cmFjayApOwoKCQl9IGVsc2UgewoKCQkJLy8gYnkgZGVmYXVsdCwgd2UgYXNzdW1lIHRoZSBkYXRhIGNhbiBiZSBzZXJpYWxpemVkIGFzLWlzCgkJCWpzb24gPSB7CgoJCQkJJ25hbWUnOiB0cmFjay5uYW1lLAoJCQkJJ3RpbWVzJzogY29udmVydEFycmF5KCB0cmFjay50aW1lcywgQXJyYXkgKSwKCQkJCSd2YWx1ZXMnOiBjb252ZXJ0QXJyYXkoIHRyYWNrLnZhbHVlcywgQXJyYXkgKQoKCQkJfTsKCgkJCWNvbnN0IGludGVycG9sYXRpb24gPSB0cmFjay5nZXRJbnRlcnBvbGF0aW9uKCk7CgoJCQlpZiAoIGludGVycG9sYXRpb24gIT09IHRyYWNrLkRlZmF1bHRJbnRlcnBvbGF0aW9uICkgewoKCQkJCWpzb24uaW50ZXJwb2xhdGlvbiA9IGludGVycG9sYXRpb247CgoJCQl9CgoJCX0KCgkJanNvbi50eXBlID0gdHJhY2suVmFsdWVUeXBlTmFtZTsgLy8gbWFuZGF0b3J5CgoJCXJldHVybiBqc29uOwoKCX0KCglJbnRlcnBvbGFudEZhY3RvcnlNZXRob2REaXNjcmV0ZSggcmVzdWx0ICkgewoKCQlyZXR1cm4gbmV3IERpc2NyZXRlSW50ZXJwb2xhbnQoIHRoaXMudGltZXMsIHRoaXMudmFsdWVzLCB0aGlzLmdldFZhbHVlU2l6ZSgpLCByZXN1bHQgKTsKCgl9CgoJSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kTGluZWFyKCByZXN1bHQgKSB7CgoJCXJldHVybiBuZXcgTGluZWFySW50ZXJwb2xhbnQoIHRoaXMudGltZXMsIHRoaXMudmFsdWVzLCB0aGlzLmdldFZhbHVlU2l6ZSgpLCByZXN1bHQgKTsKCgl9CgoJSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kU21vb3RoKCByZXN1bHQgKSB7CgoJCXJldHVybiBuZXcgQ3ViaWNJbnRlcnBvbGFudCggdGhpcy50aW1lcywgdGhpcy52YWx1ZXMsIHRoaXMuZ2V0VmFsdWVTaXplKCksIHJlc3VsdCApOwoKCX0KCglzZXRJbnRlcnBvbGF0aW9uKCBpbnRlcnBvbGF0aW9uICkgewoKCQlsZXQgZmFjdG9yeU1ldGhvZDsKCgkJc3dpdGNoICggaW50ZXJwb2xhdGlvbiApIHsKCgkJCWNhc2UgSW50ZXJwb2xhdGVEaXNjcmV0ZToKCgkJCQlmYWN0b3J5TWV0aG9kID0gdGhpcy5JbnRlcnBvbGFudEZhY3RvcnlNZXRob2REaXNjcmV0ZTsKCgkJCQlicmVhazsKCgkJCWNhc2UgSW50ZXJwb2xhdGVMaW5lYXI6CgoJCQkJZmFjdG9yeU1ldGhvZCA9IHRoaXMuSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kTGluZWFyOwoKCQkJCWJyZWFrOwoKCQkJY2FzZSBJbnRlcnBvbGF0ZVNtb290aDoKCgkJCQlmYWN0b3J5TWV0aG9kID0gdGhpcy5JbnRlcnBvbGFudEZhY3RvcnlNZXRob2RTbW9vdGg7CgoJCQkJYnJlYWs7CgoJCX0KCgkJaWYgKCBmYWN0b3J5TWV0aG9kID09PSB1bmRlZmluZWQgKSB7CgoJCQljb25zdCBtZXNzYWdlID0gJ3Vuc3VwcG9ydGVkIGludGVycG9sYXRpb24gZm9yICcgKwoJCQkJdGhpcy5WYWx1ZVR5cGVOYW1lICsgJyBrZXlmcmFtZSB0cmFjayBuYW1lZCAnICsgdGhpcy5uYW1lOwoKCQkJaWYgKCB0aGlzLmNyZWF0ZUludGVycG9sYW50ID09PSB1bmRlZmluZWQgKSB7CgoJCQkJLy8gZmFsbCBiYWNrIHRvIGRlZmF1bHQsIHVubGVzcyB0aGUgZGVmYXVsdCBpdHNlbGYgaXMgbWVzc2VkIHVwCgkJCQlpZiAoIGludGVycG9sYXRpb24gIT09IHRoaXMuRGVmYXVsdEludGVycG9sYXRpb24gKSB7CgoJCQkJCXRoaXMuc2V0SW50ZXJwb2xhdGlvbiggdGhpcy5EZWZhdWx0SW50ZXJwb2xhdGlvbiApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXRocm93IG5ldyBFcnJvciggbWVzc2FnZSApOyAvLyBmYXRhbCwgaW4gdGhpcyBjYXNlCgoJCQkJfQoKCQkJfQoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuS2V5ZnJhbWVUcmFjazonLCBtZXNzYWdlICk7CgkJCXJldHVybiB0aGlzOwoKCQl9CgoJCXRoaXMuY3JlYXRlSW50ZXJwb2xhbnQgPSBmYWN0b3J5TWV0aG9kOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0SW50ZXJwb2xhdGlvbigpIHsKCgkJc3dpdGNoICggdGhpcy5jcmVhdGVJbnRlcnBvbGFudCApIHsKCgkJCWNhc2UgdGhpcy5JbnRlcnBvbGFudEZhY3RvcnlNZXRob2REaXNjcmV0ZToKCgkJCQlyZXR1cm4gSW50ZXJwb2xhdGVEaXNjcmV0ZTsKCgkJCWNhc2UgdGhpcy5JbnRlcnBvbGFudEZhY3RvcnlNZXRob2RMaW5lYXI6CgoJCQkJcmV0dXJuIEludGVycG9sYXRlTGluZWFyOwoKCQkJY2FzZSB0aGlzLkludGVycG9sYW50RmFjdG9yeU1ldGhvZFNtb290aDoKCgkJCQlyZXR1cm4gSW50ZXJwb2xhdGVTbW9vdGg7CgoJCX0KCgl9CgoJZ2V0VmFsdWVTaXplKCkgewoKCQlyZXR1cm4gdGhpcy52YWx1ZXMubGVuZ3RoIC8gdGhpcy50aW1lcy5sZW5ndGg7CgoJfQoKCS8vIG1vdmUgYWxsIGtleWZyYW1lcyBlaXRoZXIgZm9yd2FyZHMgb3IgYmFja3dhcmRzIGluIHRpbWUKCXNoaWZ0KCB0aW1lT2Zmc2V0ICkgewoKCQlpZiAoIHRpbWVPZmZzZXQgIT09IDAuMCApIHsKCgkJCWNvbnN0IHRpbWVzID0gdGhpcy50aW1lczsKCgkJCWZvciAoIGxldCBpID0gMCwgbiA9IHRpbWVzLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCQl0aW1lc1sgaSBdICs9IHRpbWVPZmZzZXQ7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCS8vIHNjYWxlIGFsbCBrZXlmcmFtZSB0aW1lcyBieSBhIGZhY3RvciAodXNlZnVsIGZvciBmcmFtZSA8LT4gc2Vjb25kcyBjb252ZXJzaW9ucykKCXNjYWxlKCB0aW1lU2NhbGUgKSB7CgoJCWlmICggdGltZVNjYWxlICE9PSAxLjAgKSB7CgoJCQljb25zdCB0aW1lcyA9IHRoaXMudGltZXM7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIG4gPSB0aW1lcy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQkJdGltZXNbIGkgXSAqPSB0aW1lU2NhbGU7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCS8vIHJlbW92ZXMga2V5ZnJhbWVzIGJlZm9yZSBhbmQgYWZ0ZXIgYW5pbWF0aW9uIHdpdGhvdXQgY2hhbmdpbmcgYW55IHZhbHVlcyB3aXRoaW4gdGhlIHJhbmdlIFtzdGFydFRpbWUsIGVuZFRpbWVdLgoJLy8gSU1QT1JUQU5UOiBXZSBkbyBub3Qgc2hpZnQgYXJvdW5kIGtleXMgdG8gdGhlIHN0YXJ0IG9mIHRoZSB0cmFjayB0aW1lLCBiZWNhdXNlIGZvciBpbnRlcnBvbGF0ZWQga2V5cyB0aGlzIHdpbGwgY2hhbmdlIHRoZWlyIHZhbHVlcwoJdHJpbSggc3RhcnRUaW1lLCBlbmRUaW1lICkgewoKCQljb25zdCB0aW1lcyA9IHRoaXMudGltZXMsCgkJCW5LZXlzID0gdGltZXMubGVuZ3RoOwoKCQlsZXQgZnJvbSA9IDAsCgkJCXRvID0gbktleXMgLSAxOwoKCQl3aGlsZSAoIGZyb20gIT09IG5LZXlzICYmIHRpbWVzWyBmcm9tIF0gPCBzdGFydFRpbWUgKSB7CgoJCQkrKyBmcm9tOwoKCQl9CgoJCXdoaWxlICggdG8gIT09IC0gMSAmJiB0aW1lc1sgdG8gXSA+IGVuZFRpbWUgKSB7CgoJCQktLSB0bzsKCgkJfQoKCQkrKyB0bzsgLy8gaW5jbHVzaXZlIC0+IGV4Y2x1c2l2ZSBib3VuZAoKCQlpZiAoIGZyb20gIT09IDAgfHwgdG8gIT09IG5LZXlzICkgewoKCQkJLy8gZW1wdHkgdHJhY2tzIGFyZSBmb3JiaWRkZW4sIHNvIGtlZXAgYXQgbGVhc3Qgb25lIGtleWZyYW1lCgkJCWlmICggZnJvbSA+PSB0byApIHsKCgkJCQl0byA9IE1hdGgubWF4KCB0bywgMSApOwoJCQkJZnJvbSA9IHRvIC0gMTsKCgkJCX0KCgkJCWNvbnN0IHN0cmlkZSA9IHRoaXMuZ2V0VmFsdWVTaXplKCk7CgkJCXRoaXMudGltZXMgPSB0aW1lcy5zbGljZSggZnJvbSwgdG8gKTsKCQkJdGhpcy52YWx1ZXMgPSB0aGlzLnZhbHVlcy5zbGljZSggZnJvbSAqIHN0cmlkZSwgdG8gKiBzdHJpZGUgKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJLy8gZW5zdXJlIHdlIGRvIG5vdCBnZXQgYSBHYXJiYWdlSW5HYXJiYWdlT3V0IHNpdHVhdGlvbiwgbWFrZSBzdXJlIHRyYWNrcyBhcmUgYXQgbGVhc3QgbWluaW1hbGx5IHZpYWJsZQoJdmFsaWRhdGUoKSB7CgoJCWxldCB2YWxpZCA9IHRydWU7CgoJCWNvbnN0IHZhbHVlU2l6ZSA9IHRoaXMuZ2V0VmFsdWVTaXplKCk7CgkJaWYgKCB2YWx1ZVNpemUgLSBNYXRoLmZsb29yKCB2YWx1ZVNpemUgKSAhPT0gMCApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5LZXlmcmFtZVRyYWNrOiBJbnZhbGlkIHZhbHVlIHNpemUgaW4gdHJhY2suJywgdGhpcyApOwoJCQl2YWxpZCA9IGZhbHNlOwoKCQl9CgoJCWNvbnN0IHRpbWVzID0gdGhpcy50aW1lcywKCQkJdmFsdWVzID0gdGhpcy52YWx1ZXMsCgoJCQluS2V5cyA9IHRpbWVzLmxlbmd0aDsKCgkJaWYgKCBuS2V5cyA9PT0gMCApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5LZXlmcmFtZVRyYWNrOiBUcmFjayBpcyBlbXB0eS4nLCB0aGlzICk7CgkJCXZhbGlkID0gZmFsc2U7CgoJCX0KCgkJbGV0IHByZXZUaW1lID0gbnVsbDsKCgkJZm9yICggbGV0IGkgPSAwOyBpICE9PSBuS2V5czsgaSArKyApIHsKCgkJCWNvbnN0IGN1cnJUaW1lID0gdGltZXNbIGkgXTsKCgkJCWlmICggdHlwZW9mIGN1cnJUaW1lID09PSAnbnVtYmVyJyAmJiBpc05hTiggY3VyclRpbWUgKSApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuS2V5ZnJhbWVUcmFjazogVGltZSBpcyBub3QgYSB2YWxpZCBudW1iZXIuJywgdGhpcywgaSwgY3VyclRpbWUgKTsKCQkJCXZhbGlkID0gZmFsc2U7CgkJCQlicmVhazsKCgkJCX0KCgkJCWlmICggcHJldlRpbWUgIT09IG51bGwgJiYgcHJldlRpbWUgPiBjdXJyVGltZSApIHsKCgkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuS2V5ZnJhbWVUcmFjazogT3V0IG9mIG9yZGVyIGtleXMuJywgdGhpcywgaSwgY3VyclRpbWUsIHByZXZUaW1lICk7CgkJCQl2YWxpZCA9IGZhbHNlOwoJCQkJYnJlYWs7CgoJCQl9CgoJCQlwcmV2VGltZSA9IGN1cnJUaW1lOwoKCQl9CgoJCWlmICggdmFsdWVzICE9PSB1bmRlZmluZWQgKSB7CgoJCQlpZiAoIGlzVHlwZWRBcnJheSggdmFsdWVzICkgKSB7CgoJCQkJZm9yICggbGV0IGkgPSAwLCBuID0gdmFsdWVzLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCQkJY29uc3QgdmFsdWUgPSB2YWx1ZXNbIGkgXTsKCgkJCQkJaWYgKCBpc05hTiggdmFsdWUgKSApIHsKCgkJCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5LZXlmcmFtZVRyYWNrOiBWYWx1ZSBpcyBub3QgYSB2YWxpZCBudW1iZXIuJywgdGhpcywgaSwgdmFsdWUgKTsKCQkJCQkJdmFsaWQgPSBmYWxzZTsKCQkJCQkJYnJlYWs7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHZhbGlkOwoKCX0KCgkvLyByZW1vdmVzIGVxdWl2YWxlbnQgc2VxdWVudGlhbCBrZXlzIGFzIGNvbW1vbiBpbiBtb3JwaCB0YXJnZXQgc2VxdWVuY2VzCgkvLyAoMCwwLDAsMCwxLDEsMSwwLDAsMCwwLDAsMCwwKSAtLT4gKDAsMCwxLDEsMCwwKQoJb3B0aW1pemUoKSB7CgoJCS8vIHRpbWVzIG9yIHZhbHVlcyBtYXkgYmUgc2hhcmVkIHdpdGggb3RoZXIgdHJhY2tzLCBzbyBvdmVyd3JpdGluZyBpcyB1bnNhZmUKCQljb25zdCB0aW1lcyA9IHRoaXMudGltZXMuc2xpY2UoKSwKCQkJdmFsdWVzID0gdGhpcy52YWx1ZXMuc2xpY2UoKSwKCQkJc3RyaWRlID0gdGhpcy5nZXRWYWx1ZVNpemUoKSwKCgkJCXNtb290aEludGVycG9sYXRpb24gPSB0aGlzLmdldEludGVycG9sYXRpb24oKSA9PT0gSW50ZXJwb2xhdGVTbW9vdGgsCgoJCQlsYXN0SW5kZXggPSB0aW1lcy5sZW5ndGggLSAxOwoKCQlsZXQgd3JpdGVJbmRleCA9IDE7CgoJCWZvciAoIGxldCBpID0gMTsgaSA8IGxhc3RJbmRleDsgKysgaSApIHsKCgkJCWxldCBrZWVwID0gZmFsc2U7CgoJCQljb25zdCB0aW1lID0gdGltZXNbIGkgXTsKCQkJY29uc3QgdGltZU5leHQgPSB0aW1lc1sgaSArIDEgXTsKCgkJCS8vIHJlbW92ZSBhZGphY2VudCBrZXlmcmFtZXMgc2NoZWR1bGVkIGF0IHRoZSBzYW1lIHRpbWUKCgkJCWlmICggdGltZSAhPT0gdGltZU5leHQgJiYgKCBpICE9PSAxIHx8IHRpbWUgIT09IHRpbWVzWyAwIF0gKSApIHsKCgkJCQlpZiAoICEgc21vb3RoSW50ZXJwb2xhdGlvbiApIHsKCgkJCQkJLy8gcmVtb3ZlIHVubmVjZXNzYXJ5IGtleWZyYW1lcyBzYW1lIGFzIHRoZWlyIG5laWdoYm9ycwoKCQkJCQljb25zdCBvZmZzZXQgPSBpICogc3RyaWRlLAoJCQkJCQlvZmZzZXRQID0gb2Zmc2V0IC0gc3RyaWRlLAoJCQkJCQlvZmZzZXROID0gb2Zmc2V0ICsgc3RyaWRlOwoKCQkJCQlmb3IgKCBsZXQgaiA9IDA7IGogIT09IHN0cmlkZTsgKysgaiApIHsKCgkJCQkJCWNvbnN0IHZhbHVlID0gdmFsdWVzWyBvZmZzZXQgKyBqIF07CgoJCQkJCQlpZiAoIHZhbHVlICE9PSB2YWx1ZXNbIG9mZnNldFAgKyBqIF0gfHwKCQkJCQkJCXZhbHVlICE9PSB2YWx1ZXNbIG9mZnNldE4gKyBqIF0gKSB7CgoJCQkJCQkJa2VlcCA9IHRydWU7CgkJCQkJCQlicmVhazsKCgkJCQkJCX0KCgkJCQkJfQoKCQkJCX0gZWxzZSB7CgoJCQkJCWtlZXAgPSB0cnVlOwoKCQkJCX0KCgkJCX0KCgkJCS8vIGluLXBsYWNlIGNvbXBhY3Rpb24KCgkJCWlmICgga2VlcCApIHsKCgkJCQlpZiAoIGkgIT09IHdyaXRlSW5kZXggKSB7CgoJCQkJCXRpbWVzWyB3cml0ZUluZGV4IF0gPSB0aW1lc1sgaSBdOwoKCQkJCQljb25zdCByZWFkT2Zmc2V0ID0gaSAqIHN0cmlkZSwKCQkJCQkJd3JpdGVPZmZzZXQgPSB3cml0ZUluZGV4ICogc3RyaWRlOwoKCQkJCQlmb3IgKCBsZXQgaiA9IDA7IGogIT09IHN0cmlkZTsgKysgaiApIHsKCgkJCQkJCXZhbHVlc1sgd3JpdGVPZmZzZXQgKyBqIF0gPSB2YWx1ZXNbIHJlYWRPZmZzZXQgKyBqIF07CgoJCQkJCX0KCgkJCQl9CgoJCQkJKysgd3JpdGVJbmRleDsKCgkJCX0KCgkJfQoKCQkvLyBmbHVzaCBsYXN0IGtleWZyYW1lIChjb21wYWN0aW9uIGxvb2tzIGFoZWFkKQoKCQlpZiAoIGxhc3RJbmRleCA+IDAgKSB7CgoJCQl0aW1lc1sgd3JpdGVJbmRleCBdID0gdGltZXNbIGxhc3RJbmRleCBdOwoKCQkJZm9yICggbGV0IHJlYWRPZmZzZXQgPSBsYXN0SW5kZXggKiBzdHJpZGUsIHdyaXRlT2Zmc2V0ID0gd3JpdGVJbmRleCAqIHN0cmlkZSwgaiA9IDA7IGogIT09IHN0cmlkZTsgKysgaiApIHsKCgkJCQl2YWx1ZXNbIHdyaXRlT2Zmc2V0ICsgaiBdID0gdmFsdWVzWyByZWFkT2Zmc2V0ICsgaiBdOwoKCQkJfQoKCQkJKysgd3JpdGVJbmRleDsKCgkJfQoKCQlpZiAoIHdyaXRlSW5kZXggIT09IHRpbWVzLmxlbmd0aCApIHsKCgkJCXRoaXMudGltZXMgPSB0aW1lcy5zbGljZSggMCwgd3JpdGVJbmRleCApOwoJCQl0aGlzLnZhbHVlcyA9IHZhbHVlcy5zbGljZSggMCwgd3JpdGVJbmRleCAqIHN0cmlkZSApOwoKCQl9IGVsc2UgewoKCQkJdGhpcy50aW1lcyA9IHRpbWVzOwoJCQl0aGlzLnZhbHVlcyA9IHZhbHVlczsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY2xvbmUoKSB7CgoJCWNvbnN0IHRpbWVzID0gdGhpcy50aW1lcy5zbGljZSgpOwoJCWNvbnN0IHZhbHVlcyA9IHRoaXMudmFsdWVzLnNsaWNlKCk7CgoJCWNvbnN0IFR5cGVkS2V5ZnJhbWVUcmFjayA9IHRoaXMuY29uc3RydWN0b3I7CgkJY29uc3QgdHJhY2sgPSBuZXcgVHlwZWRLZXlmcmFtZVRyYWNrKCB0aGlzLm5hbWUsIHRpbWVzLCB2YWx1ZXMgKTsKCgkJLy8gSW50ZXJwb2xhbnQgYXJndW1lbnQgdG8gY29uc3RydWN0b3IgaXMgbm90IHNhdmVkLCBzbyBjb3B5IHRoZSBmYWN0b3J5IG1ldGhvZCBkaXJlY3RseS4KCQl0cmFjay5jcmVhdGVJbnRlcnBvbGFudCA9IHRoaXMuY3JlYXRlSW50ZXJwb2xhbnQ7CgoJCXJldHVybiB0cmFjazsKCgl9Cgp9CgpLZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5UaW1lQnVmZmVyVHlwZSA9IEZsb2F0MzJBcnJheTsKS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuVmFsdWVCdWZmZXJUeXBlID0gRmxvYXQzMkFycmF5OwpLZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5EZWZhdWx0SW50ZXJwb2xhdGlvbiA9IEludGVycG9sYXRlTGluZWFyOwoKLyoqCiAqIEEgVHJhY2sgb2YgQm9vbGVhbiBrZXlmcmFtZSB2YWx1ZXMuCiAqLwpjbGFzcyBCb29sZWFuS2V5ZnJhbWVUcmFjayBleHRlbmRzIEtleWZyYW1lVHJhY2sge30KCkJvb2xlYW5LZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5WYWx1ZVR5cGVOYW1lID0gJ2Jvb2wnOwpCb29sZWFuS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuVmFsdWVCdWZmZXJUeXBlID0gQXJyYXk7CkJvb2xlYW5LZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5EZWZhdWx0SW50ZXJwb2xhdGlvbiA9IEludGVycG9sYXRlRGlzY3JldGU7CkJvb2xlYW5LZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5JbnRlcnBvbGFudEZhY3RvcnlNZXRob2RMaW5lYXIgPSB1bmRlZmluZWQ7CkJvb2xlYW5LZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5JbnRlcnBvbGFudEZhY3RvcnlNZXRob2RTbW9vdGggPSB1bmRlZmluZWQ7CgovKioKICogQSBUcmFjayBvZiBrZXlmcmFtZSB2YWx1ZXMgdGhhdCByZXByZXNlbnQgY29sb3IuCiAqLwpjbGFzcyBDb2xvcktleWZyYW1lVHJhY2sgZXh0ZW5kcyBLZXlmcmFtZVRyYWNrIHt9CgpDb2xvcktleWZyYW1lVHJhY2sucHJvdG90eXBlLlZhbHVlVHlwZU5hbWUgPSAnY29sb3InOwoKLyoqCiAqIEEgVHJhY2sgb2YgbnVtZXJpYyBrZXlmcmFtZSB2YWx1ZXMuCiAqLwpjbGFzcyBOdW1iZXJLZXlmcmFtZVRyYWNrIGV4dGVuZHMgS2V5ZnJhbWVUcmFjayB7fQoKTnVtYmVyS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuVmFsdWVUeXBlTmFtZSA9ICdudW1iZXInOwoKLyoqCiAqIFNwaGVyaWNhbCBsaW5lYXIgdW5pdCBxdWF0ZXJuaW9uIGludGVycG9sYW50LgogKi8KCmNsYXNzIFF1YXRlcm5pb25MaW5lYXJJbnRlcnBvbGFudCBleHRlbmRzIEludGVycG9sYW50IHsKCgljb25zdHJ1Y3RvciggcGFyYW1ldGVyUG9zaXRpb25zLCBzYW1wbGVWYWx1ZXMsIHNhbXBsZVNpemUsIHJlc3VsdEJ1ZmZlciApIHsKCgkJc3VwZXIoIHBhcmFtZXRlclBvc2l0aW9ucywgc2FtcGxlVmFsdWVzLCBzYW1wbGVTaXplLCByZXN1bHRCdWZmZXIgKTsKCgl9CgoJaW50ZXJwb2xhdGVfKCBpMSwgdDAsIHQsIHQxICkgewoKCQljb25zdCByZXN1bHQgPSB0aGlzLnJlc3VsdEJ1ZmZlciwKCQkJdmFsdWVzID0gdGhpcy5zYW1wbGVWYWx1ZXMsCgkJCXN0cmlkZSA9IHRoaXMudmFsdWVTaXplLAoKCQkJYWxwaGEgPSAoIHQgLSB0MCApIC8gKCB0MSAtIHQwICk7CgoJCWxldCBvZmZzZXQgPSBpMSAqIHN0cmlkZTsKCgkJZm9yICggbGV0IGVuZCA9IG9mZnNldCArIHN0cmlkZTsgb2Zmc2V0ICE9PSBlbmQ7IG9mZnNldCArPSA0ICkgewoKCQkJUXVhdGVybmlvbi5zbGVycEZsYXQoIHJlc3VsdCwgMCwgdmFsdWVzLCBvZmZzZXQgLSBzdHJpZGUsIHZhbHVlcywgb2Zmc2V0LCBhbHBoYSApOwoKCQl9CgoJCXJldHVybiByZXN1bHQ7CgoJfQoKfQoKLyoqCiAqIEEgVHJhY2sgb2YgcXVhdGVybmlvbiBrZXlmcmFtZSB2YWx1ZXMuCiAqLwpjbGFzcyBRdWF0ZXJuaW9uS2V5ZnJhbWVUcmFjayBleHRlbmRzIEtleWZyYW1lVHJhY2sgewoKCUludGVycG9sYW50RmFjdG9yeU1ldGhvZExpbmVhciggcmVzdWx0ICkgewoKCQlyZXR1cm4gbmV3IFF1YXRlcm5pb25MaW5lYXJJbnRlcnBvbGFudCggdGhpcy50aW1lcywgdGhpcy52YWx1ZXMsIHRoaXMuZ2V0VmFsdWVTaXplKCksIHJlc3VsdCApOwoKCX0KCn0KClF1YXRlcm5pb25LZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5WYWx1ZVR5cGVOYW1lID0gJ3F1YXRlcm5pb24nOwovLyBWYWx1ZUJ1ZmZlclR5cGUgaXMgaW5oZXJpdGVkClF1YXRlcm5pb25LZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5EZWZhdWx0SW50ZXJwb2xhdGlvbiA9IEludGVycG9sYXRlTGluZWFyOwpRdWF0ZXJuaW9uS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kU21vb3RoID0gdW5kZWZpbmVkOwoKLyoqCiAqIEEgVHJhY2sgdGhhdCBpbnRlcnBvbGF0ZXMgU3RyaW5ncwogKi8KY2xhc3MgU3RyaW5nS2V5ZnJhbWVUcmFjayBleHRlbmRzIEtleWZyYW1lVHJhY2sge30KClN0cmluZ0tleWZyYW1lVHJhY2sucHJvdG90eXBlLlZhbHVlVHlwZU5hbWUgPSAnc3RyaW5nJzsKU3RyaW5nS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuVmFsdWVCdWZmZXJUeXBlID0gQXJyYXk7ClN0cmluZ0tleWZyYW1lVHJhY2sucHJvdG90eXBlLkRlZmF1bHRJbnRlcnBvbGF0aW9uID0gSW50ZXJwb2xhdGVEaXNjcmV0ZTsKU3RyaW5nS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuSW50ZXJwb2xhbnRGYWN0b3J5TWV0aG9kTGluZWFyID0gdW5kZWZpbmVkOwpTdHJpbmdLZXlmcmFtZVRyYWNrLnByb3RvdHlwZS5JbnRlcnBvbGFudEZhY3RvcnlNZXRob2RTbW9vdGggPSB1bmRlZmluZWQ7CgovKioKICogQSBUcmFjayBvZiB2ZWN0b3JlZCBrZXlmcmFtZSB2YWx1ZXMuCiAqLwpjbGFzcyBWZWN0b3JLZXlmcmFtZVRyYWNrIGV4dGVuZHMgS2V5ZnJhbWVUcmFjayB7fQoKVmVjdG9yS2V5ZnJhbWVUcmFjay5wcm90b3R5cGUuVmFsdWVUeXBlTmFtZSA9ICd2ZWN0b3InOwoKY2xhc3MgQW5pbWF0aW9uQ2xpcCB7CgoJY29uc3RydWN0b3IoIG5hbWUsIGR1cmF0aW9uID0gLSAxLCB0cmFja3MsIGJsZW5kTW9kZSA9IE5vcm1hbEFuaW1hdGlvbkJsZW5kTW9kZSApIHsKCgkJdGhpcy5uYW1lID0gbmFtZTsKCQl0aGlzLnRyYWNrcyA9IHRyYWNrczsKCQl0aGlzLmR1cmF0aW9uID0gZHVyYXRpb247CgkJdGhpcy5ibGVuZE1vZGUgPSBibGVuZE1vZGU7CgoJCXRoaXMudXVpZCA9IGdlbmVyYXRlVVVJRCgpOwoKCQkvLyB0aGlzIG1lYW5zIGl0IHNob3VsZCBmaWd1cmUgb3V0IGl0cyBkdXJhdGlvbiBieSBzY2FubmluZyB0aGUgdHJhY2tzCgkJaWYgKCB0aGlzLmR1cmF0aW9uIDwgMCApIHsKCgkJCXRoaXMucmVzZXREdXJhdGlvbigpOwoKCQl9CgoJfQoKCglzdGF0aWMgcGFyc2UoIGpzb24gKSB7CgoJCWNvbnN0IHRyYWNrcyA9IFtdLAoJCQlqc29uVHJhY2tzID0ganNvbi50cmFja3MsCgkJCWZyYW1lVGltZSA9IDEuMCAvICgganNvbi5mcHMgfHwgMS4wICk7CgoJCWZvciAoIGxldCBpID0gMCwgbiA9IGpzb25UcmFja3MubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJdHJhY2tzLnB1c2goIHBhcnNlS2V5ZnJhbWVUcmFjaygganNvblRyYWNrc1sgaSBdICkuc2NhbGUoIGZyYW1lVGltZSApICk7CgoJCX0KCgkJY29uc3QgY2xpcCA9IG5ldyB0aGlzKCBqc29uLm5hbWUsIGpzb24uZHVyYXRpb24sIHRyYWNrcywganNvbi5ibGVuZE1vZGUgKTsKCQljbGlwLnV1aWQgPSBqc29uLnV1aWQ7CgoJCXJldHVybiBjbGlwOwoKCX0KCglzdGF0aWMgdG9KU09OKCBjbGlwICkgewoKCQljb25zdCB0cmFja3MgPSBbXSwKCQkJY2xpcFRyYWNrcyA9IGNsaXAudHJhY2tzOwoKCQljb25zdCBqc29uID0gewoKCQkJJ25hbWUnOiBjbGlwLm5hbWUsCgkJCSdkdXJhdGlvbic6IGNsaXAuZHVyYXRpb24sCgkJCSd0cmFja3MnOiB0cmFja3MsCgkJCSd1dWlkJzogY2xpcC51dWlkLAoJCQknYmxlbmRNb2RlJzogY2xpcC5ibGVuZE1vZGUKCgkJfTsKCgkJZm9yICggbGV0IGkgPSAwLCBuID0gY2xpcFRyYWNrcy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQl0cmFja3MucHVzaCggS2V5ZnJhbWVUcmFjay50b0pTT04oIGNsaXBUcmFja3NbIGkgXSApICk7CgoJCX0KCgkJcmV0dXJuIGpzb247CgoJfQoKCXN0YXRpYyBDcmVhdGVGcm9tTW9ycGhUYXJnZXRTZXF1ZW5jZSggbmFtZSwgbW9ycGhUYXJnZXRTZXF1ZW5jZSwgZnBzLCBub0xvb3AgKSB7CgoJCWNvbnN0IG51bU1vcnBoVGFyZ2V0cyA9IG1vcnBoVGFyZ2V0U2VxdWVuY2UubGVuZ3RoOwoJCWNvbnN0IHRyYWNrcyA9IFtdOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBudW1Nb3JwaFRhcmdldHM7IGkgKysgKSB7CgoJCQlsZXQgdGltZXMgPSBbXTsKCQkJbGV0IHZhbHVlcyA9IFtdOwoKCQkJdGltZXMucHVzaCgKCQkJCSggaSArIG51bU1vcnBoVGFyZ2V0cyAtIDEgKSAlIG51bU1vcnBoVGFyZ2V0cywKCQkJCWksCgkJCQkoIGkgKyAxICkgJSBudW1Nb3JwaFRhcmdldHMgKTsKCgkJCXZhbHVlcy5wdXNoKCAwLCAxLCAwICk7CgoJCQljb25zdCBvcmRlciA9IGdldEtleWZyYW1lT3JkZXIoIHRpbWVzICk7CgkJCXRpbWVzID0gc29ydGVkQXJyYXkoIHRpbWVzLCAxLCBvcmRlciApOwoJCQl2YWx1ZXMgPSBzb3J0ZWRBcnJheSggdmFsdWVzLCAxLCBvcmRlciApOwoKCQkJLy8gaWYgdGhlcmUgaXMgYSBrZXkgYXQgdGhlIGZpcnN0IGZyYW1lLCBkdXBsaWNhdGUgaXQgYXMgdGhlCgkJCS8vIGxhc3QgZnJhbWUgYXMgd2VsbCBmb3IgcGVyZmVjdCBsb29wLgoJCQlpZiAoICEgbm9Mb29wICYmIHRpbWVzWyAwIF0gPT09IDAgKSB7CgoJCQkJdGltZXMucHVzaCggbnVtTW9ycGhUYXJnZXRzICk7CgkJCQl2YWx1ZXMucHVzaCggdmFsdWVzWyAwIF0gKTsKCgkJCX0KCgkJCXRyYWNrcy5wdXNoKAoJCQkJbmV3IE51bWJlcktleWZyYW1lVHJhY2soCgkJCQkJJy5tb3JwaFRhcmdldEluZmx1ZW5jZXNbJyArIG1vcnBoVGFyZ2V0U2VxdWVuY2VbIGkgXS5uYW1lICsgJ10nLAoJCQkJCXRpbWVzLCB2YWx1ZXMKCQkJCSkuc2NhbGUoIDEuMCAvIGZwcyApICk7CgoJCX0KCgkJcmV0dXJuIG5ldyB0aGlzKCBuYW1lLCAtIDEsIHRyYWNrcyApOwoKCX0KCglzdGF0aWMgZmluZEJ5TmFtZSggb2JqZWN0T3JDbGlwQXJyYXksIG5hbWUgKSB7CgoJCWxldCBjbGlwQXJyYXkgPSBvYmplY3RPckNsaXBBcnJheTsKCgkJaWYgKCAhIEFycmF5LmlzQXJyYXkoIG9iamVjdE9yQ2xpcEFycmF5ICkgKSB7CgoJCQljb25zdCBvID0gb2JqZWN0T3JDbGlwQXJyYXk7CgkJCWNsaXBBcnJheSA9IG8uZ2VvbWV0cnkgJiYgby5nZW9tZXRyeS5hbmltYXRpb25zIHx8IG8uYW5pbWF0aW9uczsKCgkJfQoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBjbGlwQXJyYXkubGVuZ3RoOyBpICsrICkgewoKCQkJaWYgKCBjbGlwQXJyYXlbIGkgXS5uYW1lID09PSBuYW1lICkgewoKCQkJCXJldHVybiBjbGlwQXJyYXlbIGkgXTsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gbnVsbDsKCgl9CgoJc3RhdGljIENyZWF0ZUNsaXBzRnJvbU1vcnBoVGFyZ2V0U2VxdWVuY2VzKCBtb3JwaFRhcmdldHMsIGZwcywgbm9Mb29wICkgewoKCQljb25zdCBhbmltYXRpb25Ub01vcnBoVGFyZ2V0cyA9IHt9OwoKCQkvLyB0ZXN0ZWQgd2l0aCBodHRwczovL3JlZ2V4MTAxLmNvbS8gb24gdHJpY2sgc2VxdWVuY2VzCgkJLy8gc3VjaCBmbGFtaW5nb19mbHlBXzAwMywgZmxhbWluZ29fcnVuMV8wMDMsIGNyZGVhdGgwMDU5CgkJY29uc3QgcGF0dGVybiA9IC9eKFtcdy1dKj8pKFtcZF0rKSQvOwoKCQkvLyBzb3J0IG1vcnBoIHRhcmdldCBuYW1lcyBpbnRvIGFuaW1hdGlvbiBncm91cHMgYmFzZWQKCQkvLyBwYXR0ZXJucyBsaWtlIFdhbGtfMDAxLCBXYWxrXzAwMiwgUnVuXzAwMSwgUnVuXzAwMgoJCWZvciAoIGxldCBpID0gMCwgaWwgPSBtb3JwaFRhcmdldHMubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQljb25zdCBtb3JwaFRhcmdldCA9IG1vcnBoVGFyZ2V0c1sgaSBdOwoJCQljb25zdCBwYXJ0cyA9IG1vcnBoVGFyZ2V0Lm5hbWUubWF0Y2goIHBhdHRlcm4gKTsKCgkJCWlmICggcGFydHMgJiYgcGFydHMubGVuZ3RoID4gMSApIHsKCgkJCQljb25zdCBuYW1lID0gcGFydHNbIDEgXTsKCgkJCQlsZXQgYW5pbWF0aW9uTW9ycGhUYXJnZXRzID0gYW5pbWF0aW9uVG9Nb3JwaFRhcmdldHNbIG5hbWUgXTsKCgkJCQlpZiAoICEgYW5pbWF0aW9uTW9ycGhUYXJnZXRzICkgewoKCQkJCQlhbmltYXRpb25Ub01vcnBoVGFyZ2V0c1sgbmFtZSBdID0gYW5pbWF0aW9uTW9ycGhUYXJnZXRzID0gW107CgoJCQkJfQoKCQkJCWFuaW1hdGlvbk1vcnBoVGFyZ2V0cy5wdXNoKCBtb3JwaFRhcmdldCApOwoKCQkJfQoKCQl9CgoJCWNvbnN0IGNsaXBzID0gW107CgoJCWZvciAoIGNvbnN0IG5hbWUgaW4gYW5pbWF0aW9uVG9Nb3JwaFRhcmdldHMgKSB7CgoJCQljbGlwcy5wdXNoKCB0aGlzLkNyZWF0ZUZyb21Nb3JwaFRhcmdldFNlcXVlbmNlKCBuYW1lLCBhbmltYXRpb25Ub01vcnBoVGFyZ2V0c1sgbmFtZSBdLCBmcHMsIG5vTG9vcCApICk7CgoJCX0KCgkJcmV0dXJuIGNsaXBzOwoKCX0KCgkvLyBwYXJzZSB0aGUgYW5pbWF0aW9uLmhpZXJhcmNoeSBmb3JtYXQKCXN0YXRpYyBwYXJzZUFuaW1hdGlvbiggYW5pbWF0aW9uLCBib25lcyApIHsKCgkJaWYgKCAhIGFuaW1hdGlvbiApIHsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5BbmltYXRpb25DbGlwOiBObyBhbmltYXRpb24gaW4gSlNPTkxvYWRlciBkYXRhLicgKTsKCQkJcmV0dXJuIG51bGw7CgoJCX0KCgkJY29uc3QgYWRkTm9uZW1wdHlUcmFjayA9IGZ1bmN0aW9uICggdHJhY2tUeXBlLCB0cmFja05hbWUsIGFuaW1hdGlvbktleXMsIHByb3BlcnR5TmFtZSwgZGVzdFRyYWNrcyApIHsKCgkJCS8vIG9ubHkgcmV0dXJuIHRyYWNrIGlmIHRoZXJlIGFyZSBhY3R1YWxseSBrZXlzLgoJCQlpZiAoIGFuaW1hdGlvbktleXMubGVuZ3RoICE9PSAwICkgewoKCQkJCWNvbnN0IHRpbWVzID0gW107CgkJCQljb25zdCB2YWx1ZXMgPSBbXTsKCgkJCQlmbGF0dGVuSlNPTiggYW5pbWF0aW9uS2V5cywgdGltZXMsIHZhbHVlcywgcHJvcGVydHlOYW1lICk7CgoJCQkJLy8gZW1wdHkga2V5cyBhcmUgZmlsdGVyZWQgb3V0LCBzbyBjaGVjayBhZ2FpbgoJCQkJaWYgKCB0aW1lcy5sZW5ndGggIT09IDAgKSB7CgoJCQkJCWRlc3RUcmFja3MucHVzaCggbmV3IHRyYWNrVHlwZSggdHJhY2tOYW1lLCB0aW1lcywgdmFsdWVzICkgKTsKCgkJCQl9CgoJCQl9CgoJCX07CgoJCWNvbnN0IHRyYWNrcyA9IFtdOwoKCQljb25zdCBjbGlwTmFtZSA9IGFuaW1hdGlvbi5uYW1lIHx8ICdkZWZhdWx0JzsKCQljb25zdCBmcHMgPSBhbmltYXRpb24uZnBzIHx8IDMwOwoJCWNvbnN0IGJsZW5kTW9kZSA9IGFuaW1hdGlvbi5ibGVuZE1vZGU7CgoJCS8vIGF1dG9tYXRpYyBsZW5ndGggZGV0ZXJtaW5hdGlvbiBpbiBBbmltYXRpb25DbGlwLgoJCWxldCBkdXJhdGlvbiA9IGFuaW1hdGlvbi5sZW5ndGggfHwgLSAxOwoKCQljb25zdCBoaWVyYXJjaHlUcmFja3MgPSBhbmltYXRpb24uaGllcmFyY2h5IHx8IFtdOwoKCQlmb3IgKCBsZXQgaCA9IDA7IGggPCBoaWVyYXJjaHlUcmFja3MubGVuZ3RoOyBoICsrICkgewoKCQkJY29uc3QgYW5pbWF0aW9uS2V5cyA9IGhpZXJhcmNoeVRyYWNrc1sgaCBdLmtleXM7CgoJCQkvLyBza2lwIGVtcHR5IHRyYWNrcwoJCQlpZiAoICEgYW5pbWF0aW9uS2V5cyB8fCBhbmltYXRpb25LZXlzLmxlbmd0aCA9PT0gMCApIGNvbnRpbnVlOwoKCQkJLy8gcHJvY2VzcyBtb3JwaCB0YXJnZXRzCgkJCWlmICggYW5pbWF0aW9uS2V5c1sgMCBdLm1vcnBoVGFyZ2V0cyApIHsKCgkJCQkvLyBmaWd1cmUgb3V0IGFsbCBtb3JwaCB0YXJnZXRzIHVzZWQgaW4gdGhpcyB0cmFjawoJCQkJY29uc3QgbW9ycGhUYXJnZXROYW1lcyA9IHt9OwoKCQkJCWxldCBrOwoKCQkJCWZvciAoIGsgPSAwOyBrIDwgYW5pbWF0aW9uS2V5cy5sZW5ndGg7IGsgKysgKSB7CgoJCQkJCWlmICggYW5pbWF0aW9uS2V5c1sgayBdLm1vcnBoVGFyZ2V0cyApIHsKCgkJCQkJCWZvciAoIGxldCBtID0gMDsgbSA8IGFuaW1hdGlvbktleXNbIGsgXS5tb3JwaFRhcmdldHMubGVuZ3RoOyBtICsrICkgewoKCQkJCQkJCW1vcnBoVGFyZ2V0TmFtZXNbIGFuaW1hdGlvbktleXNbIGsgXS5tb3JwaFRhcmdldHNbIG0gXSBdID0gLSAxOwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJfQoKCQkJCS8vIGNyZWF0ZSBhIHRyYWNrIGZvciBlYWNoIG1vcnBoIHRhcmdldCB3aXRoIGFsbCB6ZXJvCgkJCQkvLyBtb3JwaFRhcmdldEluZmx1ZW5jZXMgZXhjZXB0IGZvciB0aGUga2V5cyBpbiB3aGljaAoJCQkJLy8gdGhlIG1vcnBoVGFyZ2V0IGlzIG5hbWVkLgoJCQkJZm9yICggY29uc3QgbW9ycGhUYXJnZXROYW1lIGluIG1vcnBoVGFyZ2V0TmFtZXMgKSB7CgoJCQkJCWNvbnN0IHRpbWVzID0gW107CgkJCQkJY29uc3QgdmFsdWVzID0gW107CgoJCQkJCWZvciAoIGxldCBtID0gMDsgbSAhPT0gYW5pbWF0aW9uS2V5c1sgayBdLm1vcnBoVGFyZ2V0cy5sZW5ndGg7ICsrIG0gKSB7CgoJCQkJCQljb25zdCBhbmltYXRpb25LZXkgPSBhbmltYXRpb25LZXlzWyBrIF07CgoJCQkJCQl0aW1lcy5wdXNoKCBhbmltYXRpb25LZXkudGltZSApOwoJCQkJCQl2YWx1ZXMucHVzaCggKCBhbmltYXRpb25LZXkubW9ycGhUYXJnZXQgPT09IG1vcnBoVGFyZ2V0TmFtZSApID8gMSA6IDAgKTsKCgkJCQkJfQoKCQkJCQl0cmFja3MucHVzaCggbmV3IE51bWJlcktleWZyYW1lVHJhY2soICcubW9ycGhUYXJnZXRJbmZsdWVuY2VbJyArIG1vcnBoVGFyZ2V0TmFtZSArICddJywgdGltZXMsIHZhbHVlcyApICk7CgoJCQkJfQoKCQkJCWR1cmF0aW9uID0gbW9ycGhUYXJnZXROYW1lcy5sZW5ndGggKiBmcHM7CgoJCQl9IGVsc2UgewoKCQkJCS8vIC4uLmFzc3VtZSBza2VsZXRhbCBhbmltYXRpb24KCgkJCQljb25zdCBib25lTmFtZSA9ICcuYm9uZXNbJyArIGJvbmVzWyBoIF0ubmFtZSArICddJzsKCgkJCQlhZGROb25lbXB0eVRyYWNrKAoJCQkJCVZlY3RvcktleWZyYW1lVHJhY2ssIGJvbmVOYW1lICsgJy5wb3NpdGlvbicsCgkJCQkJYW5pbWF0aW9uS2V5cywgJ3BvcycsIHRyYWNrcyApOwoKCQkJCWFkZE5vbmVtcHR5VHJhY2soCgkJCQkJUXVhdGVybmlvbktleWZyYW1lVHJhY2ssIGJvbmVOYW1lICsgJy5xdWF0ZXJuaW9uJywKCQkJCQlhbmltYXRpb25LZXlzLCAncm90JywgdHJhY2tzICk7CgoJCQkJYWRkTm9uZW1wdHlUcmFjaygKCQkJCQlWZWN0b3JLZXlmcmFtZVRyYWNrLCBib25lTmFtZSArICcuc2NhbGUnLAoJCQkJCWFuaW1hdGlvbktleXMsICdzY2wnLCB0cmFja3MgKTsKCgkJCX0KCgkJfQoKCQlpZiAoIHRyYWNrcy5sZW5ndGggPT09IDAgKSB7CgoJCQlyZXR1cm4gbnVsbDsKCgkJfQoKCQljb25zdCBjbGlwID0gbmV3IHRoaXMoIGNsaXBOYW1lLCBkdXJhdGlvbiwgdHJhY2tzLCBibGVuZE1vZGUgKTsKCgkJcmV0dXJuIGNsaXA7CgoJfQoKCXJlc2V0RHVyYXRpb24oKSB7CgoJCWNvbnN0IHRyYWNrcyA9IHRoaXMudHJhY2tzOwoJCWxldCBkdXJhdGlvbiA9IDA7CgoJCWZvciAoIGxldCBpID0gMCwgbiA9IHRyYWNrcy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQljb25zdCB0cmFjayA9IHRoaXMudHJhY2tzWyBpIF07CgoJCQlkdXJhdGlvbiA9IE1hdGgubWF4KCBkdXJhdGlvbiwgdHJhY2sudGltZXNbIHRyYWNrLnRpbWVzLmxlbmd0aCAtIDEgXSApOwoKCQl9CgoJCXRoaXMuZHVyYXRpb24gPSBkdXJhdGlvbjsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRyaW0oKSB7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMudHJhY2tzLmxlbmd0aDsgaSArKyApIHsKCgkJCXRoaXMudHJhY2tzWyBpIF0udHJpbSggMCwgdGhpcy5kdXJhdGlvbiApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgl2YWxpZGF0ZSgpIHsKCgkJbGV0IHZhbGlkID0gdHJ1ZTsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy50cmFja3MubGVuZ3RoOyBpICsrICkgewoKCQkJdmFsaWQgPSB2YWxpZCAmJiB0aGlzLnRyYWNrc1sgaSBdLnZhbGlkYXRlKCk7CgoJCX0KCgkJcmV0dXJuIHZhbGlkOwoKCX0KCglvcHRpbWl6ZSgpIHsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy50cmFja3MubGVuZ3RoOyBpICsrICkgewoKCQkJdGhpcy50cmFja3NbIGkgXS5vcHRpbWl6ZSgpOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgljbG9uZSgpIHsKCgkJY29uc3QgdHJhY2tzID0gW107CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMudHJhY2tzLmxlbmd0aDsgaSArKyApIHsKCgkJCXRyYWNrcy5wdXNoKCB0aGlzLnRyYWNrc1sgaSBdLmNsb25lKCkgKTsKCgkJfQoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoIHRoaXMubmFtZSwgdGhpcy5kdXJhdGlvbiwgdHJhY2tzLCB0aGlzLmJsZW5kTW9kZSApOwoKCX0KCgl0b0pTT04oKSB7CgoJCXJldHVybiB0aGlzLmNvbnN0cnVjdG9yLnRvSlNPTiggdGhpcyApOwoKCX0KCn0KCmZ1bmN0aW9uIGdldFRyYWNrVHlwZUZvclZhbHVlVHlwZU5hbWUoIHR5cGVOYW1lICkgewoKCXN3aXRjaCAoIHR5cGVOYW1lLnRvTG93ZXJDYXNlKCkgKSB7CgoJCWNhc2UgJ3NjYWxhcic6CgkJY2FzZSAnZG91YmxlJzoKCQljYXNlICdmbG9hdCc6CgkJY2FzZSAnbnVtYmVyJzoKCQljYXNlICdpbnRlZ2VyJzoKCgkJCXJldHVybiBOdW1iZXJLZXlmcmFtZVRyYWNrOwoKCQljYXNlICd2ZWN0b3InOgoJCWNhc2UgJ3ZlY3RvcjInOgoJCWNhc2UgJ3ZlY3RvcjMnOgoJCWNhc2UgJ3ZlY3RvcjQnOgoKCQkJcmV0dXJuIFZlY3RvcktleWZyYW1lVHJhY2s7CgoJCWNhc2UgJ2NvbG9yJzoKCgkJCXJldHVybiBDb2xvcktleWZyYW1lVHJhY2s7CgoJCWNhc2UgJ3F1YXRlcm5pb24nOgoKCQkJcmV0dXJuIFF1YXRlcm5pb25LZXlmcmFtZVRyYWNrOwoKCQljYXNlICdib29sJzoKCQljYXNlICdib29sZWFuJzoKCgkJCXJldHVybiBCb29sZWFuS2V5ZnJhbWVUcmFjazsKCgkJY2FzZSAnc3RyaW5nJzoKCgkJCXJldHVybiBTdHJpbmdLZXlmcmFtZVRyYWNrOwoKCX0KCgl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5LZXlmcmFtZVRyYWNrOiBVbnN1cHBvcnRlZCB0eXBlTmFtZTogJyArIHR5cGVOYW1lICk7Cgp9CgpmdW5jdGlvbiBwYXJzZUtleWZyYW1lVHJhY2soIGpzb24gKSB7CgoJaWYgKCBqc29uLnR5cGUgPT09IHVuZGVmaW5lZCApIHsKCgkJdGhyb3cgbmV3IEVycm9yKCAnVEhSRUUuS2V5ZnJhbWVUcmFjazogdHJhY2sgdHlwZSB1bmRlZmluZWQsIGNhbiBub3QgcGFyc2UnICk7CgoJfQoKCWNvbnN0IHRyYWNrVHlwZSA9IGdldFRyYWNrVHlwZUZvclZhbHVlVHlwZU5hbWUoIGpzb24udHlwZSApOwoKCWlmICgganNvbi50aW1lcyA9PT0gdW5kZWZpbmVkICkgewoKCQljb25zdCB0aW1lcyA9IFtdLCB2YWx1ZXMgPSBbXTsKCgkJZmxhdHRlbkpTT04oIGpzb24ua2V5cywgdGltZXMsIHZhbHVlcywgJ3ZhbHVlJyApOwoKCQlqc29uLnRpbWVzID0gdGltZXM7CgkJanNvbi52YWx1ZXMgPSB2YWx1ZXM7CgoJfQoKCS8vIGRlcml2ZWQgY2xhc3NlcyBjYW4gZGVmaW5lIGEgc3RhdGljIHBhcnNlIG1ldGhvZAoJaWYgKCB0cmFja1R5cGUucGFyc2UgIT09IHVuZGVmaW5lZCApIHsKCgkJcmV0dXJuIHRyYWNrVHlwZS5wYXJzZSgganNvbiApOwoKCX0gZWxzZSB7CgoJCS8vIGJ5IGRlZmF1bHQsIHdlIGFzc3VtZSBhIGNvbnN0cnVjdG9yIGNvbXBhdGlibGUgd2l0aCB0aGUgYmFzZQoJCXJldHVybiBuZXcgdHJhY2tUeXBlKCBqc29uLm5hbWUsIGpzb24udGltZXMsIGpzb24udmFsdWVzLCBqc29uLmludGVycG9sYXRpb24gKTsKCgl9Cgp9Cgpjb25zdCBDYWNoZSA9IHsKCgllbmFibGVkOiBmYWxzZSwKCglmaWxlczoge30sCgoJYWRkOiBmdW5jdGlvbiAoIGtleSwgZmlsZSApIHsKCgkJaWYgKCB0aGlzLmVuYWJsZWQgPT09IGZhbHNlICkgcmV0dXJuOwoKCQkvLyBjb25zb2xlLmxvZyggJ1RIUkVFLkNhY2hlJywgJ0FkZGluZyBrZXk6Jywga2V5ICk7CgoJCXRoaXMuZmlsZXNbIGtleSBdID0gZmlsZTsKCgl9LAoKCWdldDogZnVuY3Rpb24gKCBrZXkgKSB7CgoJCWlmICggdGhpcy5lbmFibGVkID09PSBmYWxzZSApIHJldHVybjsKCgkJLy8gY29uc29sZS5sb2coICdUSFJFRS5DYWNoZScsICdDaGVja2luZyBrZXk6Jywga2V5ICk7CgoJCXJldHVybiB0aGlzLmZpbGVzWyBrZXkgXTsKCgl9LAoKCXJlbW92ZTogZnVuY3Rpb24gKCBrZXkgKSB7CgoJCWRlbGV0ZSB0aGlzLmZpbGVzWyBrZXkgXTsKCgl9LAoKCWNsZWFyOiBmdW5jdGlvbiAoKSB7CgoJCXRoaXMuZmlsZXMgPSB7fTsKCgl9Cgp9OwoKY2xhc3MgTG9hZGluZ01hbmFnZXIgewoKCWNvbnN0cnVjdG9yKCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgoJCWNvbnN0IHNjb3BlID0gdGhpczsKCgkJbGV0IGlzTG9hZGluZyA9IGZhbHNlOwoJCWxldCBpdGVtc0xvYWRlZCA9IDA7CgkJbGV0IGl0ZW1zVG90YWwgPSAwOwoJCWxldCB1cmxNb2RpZmllciA9IHVuZGVmaW5lZDsKCQljb25zdCBoYW5kbGVycyA9IFtdOwoKCQkvLyBSZWZlciB0byAjNTY4OSBmb3IgdGhlIHJlYXNvbiB3aHkgd2UgZG9uJ3Qgc2V0IC5vblN0YXJ0CgkJLy8gaW4gdGhlIGNvbnN0cnVjdG9yCgoJCXRoaXMub25TdGFydCA9IHVuZGVmaW5lZDsKCQl0aGlzLm9uTG9hZCA9IG9uTG9hZDsKCQl0aGlzLm9uUHJvZ3Jlc3MgPSBvblByb2dyZXNzOwoJCXRoaXMub25FcnJvciA9IG9uRXJyb3I7CgoJCXRoaXMuaXRlbVN0YXJ0ID0gZnVuY3Rpb24gKCB1cmwgKSB7CgoJCQlpdGVtc1RvdGFsICsrOwoKCQkJaWYgKCBpc0xvYWRpbmcgPT09IGZhbHNlICkgewoKCQkJCWlmICggc2NvcGUub25TdGFydCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlzY29wZS5vblN0YXJ0KCB1cmwsIGl0ZW1zTG9hZGVkLCBpdGVtc1RvdGFsICk7CgoJCQkJfQoKCQkJfQoKCQkJaXNMb2FkaW5nID0gdHJ1ZTsKCgkJfTsKCgkJdGhpcy5pdGVtRW5kID0gZnVuY3Rpb24gKCB1cmwgKSB7CgoJCQlpdGVtc0xvYWRlZCArKzsKCgkJCWlmICggc2NvcGUub25Qcm9ncmVzcyAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXNjb3BlLm9uUHJvZ3Jlc3MoIHVybCwgaXRlbXNMb2FkZWQsIGl0ZW1zVG90YWwgKTsKCgkJCX0KCgkJCWlmICggaXRlbXNMb2FkZWQgPT09IGl0ZW1zVG90YWwgKSB7CgoJCQkJaXNMb2FkaW5nID0gZmFsc2U7CgoJCQkJaWYgKCBzY29wZS5vbkxvYWQgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJc2NvcGUub25Mb2FkKCk7CgoJCQkJfQoKCQkJfQoKCQl9OwoKCQl0aGlzLml0ZW1FcnJvciA9IGZ1bmN0aW9uICggdXJsICkgewoKCQkJaWYgKCBzY29wZS5vbkVycm9yICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJc2NvcGUub25FcnJvciggdXJsICk7CgoJCQl9CgoJCX07CgoJCXRoaXMucmVzb2x2ZVVSTCA9IGZ1bmN0aW9uICggdXJsICkgewoKCQkJaWYgKCB1cmxNb2RpZmllciApIHsKCgkJCQlyZXR1cm4gdXJsTW9kaWZpZXIoIHVybCApOwoKCQkJfQoKCQkJcmV0dXJuIHVybDsKCgkJfTsKCgkJdGhpcy5zZXRVUkxNb2RpZmllciA9IGZ1bmN0aW9uICggdHJhbnNmb3JtICkgewoKCQkJdXJsTW9kaWZpZXIgPSB0cmFuc2Zvcm07CgoJCQlyZXR1cm4gdGhpczsKCgkJfTsKCgkJdGhpcy5hZGRIYW5kbGVyID0gZnVuY3Rpb24gKCByZWdleCwgbG9hZGVyICkgewoKCQkJaGFuZGxlcnMucHVzaCggcmVnZXgsIGxvYWRlciApOwoKCQkJcmV0dXJuIHRoaXM7CgoJCX07CgoJCXRoaXMucmVtb3ZlSGFuZGxlciA9IGZ1bmN0aW9uICggcmVnZXggKSB7CgoJCQljb25zdCBpbmRleCA9IGhhbmRsZXJzLmluZGV4T2YoIHJlZ2V4ICk7CgoJCQlpZiAoIGluZGV4ICE9PSAtIDEgKSB7CgoJCQkJaGFuZGxlcnMuc3BsaWNlKCBpbmRleCwgMiApOwoKCQkJfQoKCQkJcmV0dXJuIHRoaXM7CgoJCX07CgoJCXRoaXMuZ2V0SGFuZGxlciA9IGZ1bmN0aW9uICggZmlsZSApIHsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IGhhbmRsZXJzLmxlbmd0aDsgaSA8IGw7IGkgKz0gMiApIHsKCgkJCQljb25zdCByZWdleCA9IGhhbmRsZXJzWyBpIF07CgkJCQljb25zdCBsb2FkZXIgPSBoYW5kbGVyc1sgaSArIDEgXTsKCgkJCQlpZiAoIHJlZ2V4Lmdsb2JhbCApIHJlZ2V4Lmxhc3RJbmRleCA9IDA7IC8vIHNlZSAjMTc5MjAKCgkJCQlpZiAoIHJlZ2V4LnRlc3QoIGZpbGUgKSApIHsKCgkJCQkJcmV0dXJuIGxvYWRlcjsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4gbnVsbDsKCgkJfTsKCgl9Cgp9Cgpjb25zdCBEZWZhdWx0TG9hZGluZ01hbmFnZXIgPSAvKkBfX1BVUkVfXyovIG5ldyBMb2FkaW5nTWFuYWdlcigpOwoKY2xhc3MgTG9hZGVyIHsKCgljb25zdHJ1Y3RvciggbWFuYWdlciApIHsKCgkJdGhpcy5tYW5hZ2VyID0gKCBtYW5hZ2VyICE9PSB1bmRlZmluZWQgKSA/IG1hbmFnZXIgOiBEZWZhdWx0TG9hZGluZ01hbmFnZXI7CgoJCXRoaXMuY3Jvc3NPcmlnaW4gPSAnYW5vbnltb3VzJzsKCQl0aGlzLndpdGhDcmVkZW50aWFscyA9IGZhbHNlOwoJCXRoaXMucGF0aCA9ICcnOwoJCXRoaXMucmVzb3VyY2VQYXRoID0gJyc7CgkJdGhpcy5yZXF1ZXN0SGVhZGVyID0ge307CgoJfQoKCWxvYWQoIC8qIHVybCwgb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yICovICkge30KCglsb2FkQXN5bmMoIHVybCwgb25Qcm9ncmVzcyApIHsKCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQlyZXR1cm4gbmV3IFByb21pc2UoIGZ1bmN0aW9uICggcmVzb2x2ZSwgcmVqZWN0ICkgewoKCQkJc2NvcGUubG9hZCggdXJsLCByZXNvbHZlLCBvblByb2dyZXNzLCByZWplY3QgKTsKCgkJfSApOwoKCX0KCglwYXJzZSggLyogZGF0YSAqLyApIHt9CgoJc2V0Q3Jvc3NPcmlnaW4oIGNyb3NzT3JpZ2luICkgewoKCQl0aGlzLmNyb3NzT3JpZ2luID0gY3Jvc3NPcmlnaW47CgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldFdpdGhDcmVkZW50aWFscyggdmFsdWUgKSB7CgoJCXRoaXMud2l0aENyZWRlbnRpYWxzID0gdmFsdWU7CgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldFBhdGgoIHBhdGggKSB7CgoJCXRoaXMucGF0aCA9IHBhdGg7CgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldFJlc291cmNlUGF0aCggcmVzb3VyY2VQYXRoICkgewoKCQl0aGlzLnJlc291cmNlUGF0aCA9IHJlc291cmNlUGF0aDsKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0UmVxdWVzdEhlYWRlciggcmVxdWVzdEhlYWRlciApIHsKCgkJdGhpcy5yZXF1ZXN0SGVhZGVyID0gcmVxdWVzdEhlYWRlcjsKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpMb2FkZXIuREVGQVVMVF9NQVRFUklBTF9OQU1FID0gJ19fREVGQVVMVCc7Cgpjb25zdCBsb2FkaW5nID0ge307CgpjbGFzcyBIdHRwRXJyb3IgZXh0ZW5kcyBFcnJvciB7CgoJY29uc3RydWN0b3IoIG1lc3NhZ2UsIHJlc3BvbnNlICkgewoKCQlzdXBlciggbWVzc2FnZSApOwoJCXRoaXMucmVzcG9uc2UgPSByZXNwb25zZTsKCgl9Cgp9CgpjbGFzcyBGaWxlTG9hZGVyIGV4dGVuZHMgTG9hZGVyIHsKCgljb25zdHJ1Y3RvciggbWFuYWdlciApIHsKCgkJc3VwZXIoIG1hbmFnZXIgKTsKCgl9CgoJbG9hZCggdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgoJCWlmICggdXJsID09PSB1bmRlZmluZWQgKSB1cmwgPSAnJzsKCgkJaWYgKCB0aGlzLnBhdGggIT09IHVuZGVmaW5lZCApIHVybCA9IHRoaXMucGF0aCArIHVybDsKCgkJdXJsID0gdGhpcy5tYW5hZ2VyLnJlc29sdmVVUkwoIHVybCApOwoKCQljb25zdCBjYWNoZWQgPSBDYWNoZS5nZXQoIHVybCApOwoKCQlpZiAoIGNhY2hlZCAhPT0gdW5kZWZpbmVkICkgewoKCQkJdGhpcy5tYW5hZ2VyLml0ZW1TdGFydCggdXJsICk7CgoJCQlzZXRUaW1lb3V0KCAoKSA9PiB7CgoJCQkJaWYgKCBvbkxvYWQgKSBvbkxvYWQoIGNhY2hlZCApOwoKCQkJCXRoaXMubWFuYWdlci5pdGVtRW5kKCB1cmwgKTsKCgkJCX0sIDAgKTsKCgkJCXJldHVybiBjYWNoZWQ7CgoJCX0KCgkJLy8gQ2hlY2sgaWYgcmVxdWVzdCBpcyBkdXBsaWNhdGUKCgkJaWYgKCBsb2FkaW5nWyB1cmwgXSAhPT0gdW5kZWZpbmVkICkgewoKCQkJbG9hZGluZ1sgdXJsIF0ucHVzaCggewoKCQkJCW9uTG9hZDogb25Mb2FkLAoJCQkJb25Qcm9ncmVzczogb25Qcm9ncmVzcywKCQkJCW9uRXJyb3I6IG9uRXJyb3IKCgkJCX0gKTsKCgkJCXJldHVybjsKCgkJfQoKCQkvLyBJbml0aWFsaXNlIGFycmF5IGZvciBkdXBsaWNhdGUgcmVxdWVzdHMKCQlsb2FkaW5nWyB1cmwgXSA9IFtdOwoKCQlsb2FkaW5nWyB1cmwgXS5wdXNoKCB7CgkJCW9uTG9hZDogb25Mb2FkLAoJCQlvblByb2dyZXNzOiBvblByb2dyZXNzLAoJCQlvbkVycm9yOiBvbkVycm9yLAoJCX0gKTsKCgkJLy8gY3JlYXRlIHJlcXVlc3QKCQljb25zdCByZXEgPSBuZXcgUmVxdWVzdCggdXJsLCB7CgkJCWhlYWRlcnM6IG5ldyBIZWFkZXJzKCB0aGlzLnJlcXVlc3RIZWFkZXIgKSwKCQkJY3JlZGVudGlhbHM6IHRoaXMud2l0aENyZWRlbnRpYWxzID8gJ2luY2x1ZGUnIDogJ3NhbWUtb3JpZ2luJywKCQkJLy8gQW4gYWJvcnQgY29udHJvbGxlciBjb3VsZCBiZSBhZGRlZCB3aXRoaW4gYSBmdXR1cmUgUFIKCQl9ICk7CgoJCS8vIHJlY29yZCBzdGF0ZXMgKCBhdm9pZCBkYXRhIHJhY2UgKQoJCWNvbnN0IG1pbWVUeXBlID0gdGhpcy5taW1lVHlwZTsKCQljb25zdCByZXNwb25zZVR5cGUgPSB0aGlzLnJlc3BvbnNlVHlwZTsKCgkJLy8gc3RhcnQgdGhlIGZldGNoCgkJZmV0Y2goIHJlcSApCgkJCS50aGVuKCByZXNwb25zZSA9PiB7CgoJCQkJaWYgKCByZXNwb25zZS5zdGF0dXMgPT09IDIwMCB8fCByZXNwb25zZS5zdGF0dXMgPT09IDAgKSB7CgoJCQkJCS8vIFNvbWUgYnJvd3NlcnMgcmV0dXJuIEhUVFAgU3RhdHVzIDAgd2hlbiB1c2luZyBub24taHR0cCBwcm90b2NvbAoJCQkJCS8vIGUuZy4gJ2ZpbGU6Ly8nIG9yICdkYXRhOi8vJy4gSGFuZGxlIGFzIHN1Y2Nlc3MuCgoJCQkJCWlmICggcmVzcG9uc2Uuc3RhdHVzID09PSAwICkgewoKCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuRmlsZUxvYWRlcjogSFRUUCBTdGF0dXMgMCByZWNlaXZlZC4nICk7CgoJCQkJCX0KCgkJCQkJLy8gV29ya2Fyb3VuZDogQ2hlY2tpbmcgaWYgcmVzcG9uc2UuYm9keSA9PT0gdW5kZWZpbmVkIGZvciBBbGlwYXkgYnJvd3NlciAjMjM1NDgKCgkJCQkJaWYgKCB0eXBlb2YgUmVhZGFibGVTdHJlYW0gPT09ICd1bmRlZmluZWQnIHx8IHJlc3BvbnNlLmJvZHkgPT09IHVuZGVmaW5lZCB8fCByZXNwb25zZS5ib2R5LmdldFJlYWRlciA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJcmV0dXJuIHJlc3BvbnNlOwoKCQkJCQl9CgoJCQkJCWNvbnN0IGNhbGxiYWNrcyA9IGxvYWRpbmdbIHVybCBdOwoJCQkJCWNvbnN0IHJlYWRlciA9IHJlc3BvbnNlLmJvZHkuZ2V0UmVhZGVyKCk7CgoJCQkJCS8vIE5naW54IG5lZWRzIFgtRmlsZS1TaXplIGNoZWNrCgkJCQkJLy8gaHR0cHM6Ly9zZXJ2ZXJmYXVsdC5jb20vcXVlc3Rpb25zLzQ4Mjg3NS93aHktZG9lcy1uZ2lueC1yZW1vdmUtY29udGVudC1sZW5ndGgtaGVhZGVyLWZvci1jaHVua2VkLWNvbnRlbnQKCQkJCQljb25zdCBjb250ZW50TGVuZ3RoID0gcmVzcG9uc2UuaGVhZGVycy5nZXQoICdDb250ZW50LUxlbmd0aCcgKSB8fCByZXNwb25zZS5oZWFkZXJzLmdldCggJ1gtRmlsZS1TaXplJyApOwoJCQkJCWNvbnN0IHRvdGFsID0gY29udGVudExlbmd0aCA/IHBhcnNlSW50KCBjb250ZW50TGVuZ3RoICkgOiAwOwoJCQkJCWNvbnN0IGxlbmd0aENvbXB1dGFibGUgPSB0b3RhbCAhPT0gMDsKCQkJCQlsZXQgbG9hZGVkID0gMDsKCgkJCQkJLy8gcGVyaW9kaWNhbGx5IHJlYWQgZGF0YSBpbnRvIHRoZSBuZXcgc3RyZWFtIHRyYWNraW5nIHdoaWxlIGRvd25sb2FkIHByb2dyZXNzCgkJCQkJY29uc3Qgc3RyZWFtID0gbmV3IFJlYWRhYmxlU3RyZWFtKCB7CgkJCQkJCXN0YXJ0KCBjb250cm9sbGVyICkgewoKCQkJCQkJCXJlYWREYXRhKCk7CgoJCQkJCQkJZnVuY3Rpb24gcmVhZERhdGEoKSB7CgoJCQkJCQkJCXJlYWRlci5yZWFkKCkudGhlbiggKCB7IGRvbmUsIHZhbHVlIH0gKSA9PiB7CgoJCQkJCQkJCQlpZiAoIGRvbmUgKSB7CgoJCQkJCQkJCQkJY29udHJvbGxlci5jbG9zZSgpOwoKCQkJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJCQlsb2FkZWQgKz0gdmFsdWUuYnl0ZUxlbmd0aDsKCgkJCQkJCQkJCQljb25zdCBldmVudCA9IG5ldyBQcm9ncmVzc0V2ZW50KCAncHJvZ3Jlc3MnLCB7IGxlbmd0aENvbXB1dGFibGUsIGxvYWRlZCwgdG90YWwgfSApOwoJCQkJCQkJCQkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGNhbGxiYWNrcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQkJCQkJCQkJY29uc3QgY2FsbGJhY2sgPSBjYWxsYmFja3NbIGkgXTsKCQkJCQkJCQkJCQlpZiAoIGNhbGxiYWNrLm9uUHJvZ3Jlc3MgKSBjYWxsYmFjay5vblByb2dyZXNzKCBldmVudCApOwoKCQkJCQkJCQkJCX0KCgkJCQkJCQkJCQljb250cm9sbGVyLmVucXVldWUoIHZhbHVlICk7CgkJCQkJCQkJCQlyZWFkRGF0YSgpOwoKCQkJCQkJCQkJfQoKCQkJCQkJCQl9ICk7CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9ICk7CgoJCQkJCXJldHVybiBuZXcgUmVzcG9uc2UoIHN0cmVhbSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCXRocm93IG5ldyBIdHRwRXJyb3IoIGBmZXRjaCBmb3IgIiR7cmVzcG9uc2UudXJsfSIgcmVzcG9uZGVkIHdpdGggJHtyZXNwb25zZS5zdGF0dXN9OiAke3Jlc3BvbnNlLnN0YXR1c1RleHR9YCwgcmVzcG9uc2UgKTsKCgkJCQl9CgoJCQl9ICkKCQkJLnRoZW4oIHJlc3BvbnNlID0+IHsKCgkJCQlzd2l0Y2ggKCByZXNwb25zZVR5cGUgKSB7CgoJCQkJCWNhc2UgJ2FycmF5YnVmZmVyJzoKCgkJCQkJCXJldHVybiByZXNwb25zZS5hcnJheUJ1ZmZlcigpOwoKCQkJCQljYXNlICdibG9iJzoKCgkJCQkJCXJldHVybiByZXNwb25zZS5ibG9iKCk7CgoJCQkJCWNhc2UgJ2RvY3VtZW50JzoKCgkJCQkJCXJldHVybiByZXNwb25zZS50ZXh0KCkKCQkJCQkJCS50aGVuKCB0ZXh0ID0+IHsKCgkJCQkJCQkJY29uc3QgcGFyc2VyID0gbmV3IERPTVBhcnNlcigpOwoJCQkJCQkJCXJldHVybiBwYXJzZXIucGFyc2VGcm9tU3RyaW5nKCB0ZXh0LCBtaW1lVHlwZSApOwoKCQkJCQkJCX0gKTsKCgkJCQkJY2FzZSAnanNvbic6CgoJCQkJCQlyZXR1cm4gcmVzcG9uc2UuanNvbigpOwoKCQkJCQlkZWZhdWx0OgoKCQkJCQkJaWYgKCBtaW1lVHlwZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJCXJldHVybiByZXNwb25zZS50ZXh0KCk7CgoJCQkJCQl9IGVsc2UgewoKCQkJCQkJCS8vIHNuaWZmIGVuY29kaW5nCgkJCQkJCQljb25zdCByZSA9IC9jaGFyc2V0PSI/KFteOyJcc10qKSI/L2k7CgkJCQkJCQljb25zdCBleGVjID0gcmUuZXhlYyggbWltZVR5cGUgKTsKCQkJCQkJCWNvbnN0IGxhYmVsID0gZXhlYyAmJiBleGVjWyAxIF0gPyBleGVjWyAxIF0udG9Mb3dlckNhc2UoKSA6IHVuZGVmaW5lZDsKCQkJCQkJCWNvbnN0IGRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoIGxhYmVsICk7CgkJCQkJCQlyZXR1cm4gcmVzcG9uc2UuYXJyYXlCdWZmZXIoKS50aGVuKCBhYiA9PiBkZWNvZGVyLmRlY29kZSggYWIgKSApOwoKCQkJCQkJfQoKCQkJCX0KCgkJCX0gKQoJCQkudGhlbiggZGF0YSA9PiB7CgoJCQkJLy8gQWRkIHRvIGNhY2hlIG9ubHkgb24gSFRUUCBzdWNjZXNzLCBzbyB0aGF0IHdlIGRvIG5vdCBjYWNoZQoJCQkJLy8gZXJyb3IgcmVzcG9uc2UgYm9kaWVzIGFzIHByb3BlciByZXNwb25zZXMgdG8gcmVxdWVzdHMuCgkJCQlDYWNoZS5hZGQoIHVybCwgZGF0YSApOwoKCQkJCWNvbnN0IGNhbGxiYWNrcyA9IGxvYWRpbmdbIHVybCBdOwoJCQkJZGVsZXRlIGxvYWRpbmdbIHVybCBdOwoKCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBjYWxsYmFja3MubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGNhbGxiYWNrID0gY2FsbGJhY2tzWyBpIF07CgkJCQkJaWYgKCBjYWxsYmFjay5vbkxvYWQgKSBjYWxsYmFjay5vbkxvYWQoIGRhdGEgKTsKCgkJCQl9CgoJCQl9ICkKCQkJLmNhdGNoKCBlcnIgPT4gewoKCQkJCS8vIEFib3J0IGVycm9ycyBhbmQgb3RoZXIgZXJyb3JzIGFyZSBoYW5kbGVkIHRoZSBzYW1lCgoJCQkJY29uc3QgY2FsbGJhY2tzID0gbG9hZGluZ1sgdXJsIF07CgoJCQkJaWYgKCBjYWxsYmFja3MgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJLy8gV2hlbiBvbkxvYWQgd2FzIGNhbGxlZCBhbmQgdXJsIHdhcyBkZWxldGVkIGluIGBsb2FkaW5nYAoJCQkJCXRoaXMubWFuYWdlci5pdGVtRXJyb3IoIHVybCApOwoJCQkJCXRocm93IGVycjsKCgkJCQl9CgoJCQkJZGVsZXRlIGxvYWRpbmdbIHVybCBdOwoKCQkJCWZvciAoIGxldCBpID0gMCwgaWwgPSBjYWxsYmFja3MubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGNhbGxiYWNrID0gY2FsbGJhY2tzWyBpIF07CgkJCQkJaWYgKCBjYWxsYmFjay5vbkVycm9yICkgY2FsbGJhY2sub25FcnJvciggZXJyICk7CgoJCQkJfQoKCQkJCXRoaXMubWFuYWdlci5pdGVtRXJyb3IoIHVybCApOwoKCQkJfSApCgkJCS5maW5hbGx5KCAoKSA9PiB7CgoJCQkJdGhpcy5tYW5hZ2VyLml0ZW1FbmQoIHVybCApOwoKCQkJfSApOwoKCQl0aGlzLm1hbmFnZXIuaXRlbVN0YXJ0KCB1cmwgKTsKCgl9CgoJc2V0UmVzcG9uc2VUeXBlKCB2YWx1ZSApIHsKCgkJdGhpcy5yZXNwb25zZVR5cGUgPSB2YWx1ZTsKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0TWltZVR5cGUoIHZhbHVlICkgewoKCQl0aGlzLm1pbWVUeXBlID0gdmFsdWU7CgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKY2xhc3MgQW5pbWF0aW9uTG9hZGVyIGV4dGVuZHMgTG9hZGVyIHsKCgljb25zdHJ1Y3RvciggbWFuYWdlciApIHsKCgkJc3VwZXIoIG1hbmFnZXIgKTsKCgl9CgoJbG9hZCggdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgoJCWNvbnN0IHNjb3BlID0gdGhpczsKCgkJY29uc3QgbG9hZGVyID0gbmV3IEZpbGVMb2FkZXIoIHRoaXMubWFuYWdlciApOwoJCWxvYWRlci5zZXRQYXRoKCB0aGlzLnBhdGggKTsKCQlsb2FkZXIuc2V0UmVxdWVzdEhlYWRlciggdGhpcy5yZXF1ZXN0SGVhZGVyICk7CgkJbG9hZGVyLnNldFdpdGhDcmVkZW50aWFscyggdGhpcy53aXRoQ3JlZGVudGlhbHMgKTsKCQlsb2FkZXIubG9hZCggdXJsLCBmdW5jdGlvbiAoIHRleHQgKSB7CgoJCQl0cnkgewoKCQkJCW9uTG9hZCggc2NvcGUucGFyc2UoIEpTT04ucGFyc2UoIHRleHQgKSApICk7CgoJCQl9IGNhdGNoICggZSApIHsKCgkJCQlpZiAoIG9uRXJyb3IgKSB7CgoJCQkJCW9uRXJyb3IoIGUgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQljb25zb2xlLmVycm9yKCBlICk7CgoJCQkJfQoKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVycm9yKCB1cmwgKTsKCgkJCX0KCgkJfSwgb25Qcm9ncmVzcywgb25FcnJvciApOwoKCX0KCglwYXJzZSgganNvbiApIHsKCgkJY29uc3QgYW5pbWF0aW9ucyA9IFtdOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBqc29uLmxlbmd0aDsgaSArKyApIHsKCgkJCWNvbnN0IGNsaXAgPSBBbmltYXRpb25DbGlwLnBhcnNlKCBqc29uWyBpIF0gKTsKCgkJCWFuaW1hdGlvbnMucHVzaCggY2xpcCApOwoKCQl9CgoJCXJldHVybiBhbmltYXRpb25zOwoKCX0KCn0KCi8qKgogKiBBYnN0cmFjdCBCYXNlIGNsYXNzIHRvIGJsb2NrIGJhc2VkIHRleHR1cmVzIGxvYWRlciAoZGRzLCBwdnIsIC4uLikKICoKICogU3ViIGNsYXNzZXMgaGF2ZSB0byBpbXBsZW1lbnQgdGhlIHBhcnNlKCkgbWV0aG9kIHdoaWNoIHdpbGwgYmUgdXNlZCBpbiBsb2FkKCkuCiAqLwoKY2xhc3MgQ29tcHJlc3NlZFRleHR1cmVMb2FkZXIgZXh0ZW5kcyBMb2FkZXIgewoKCWNvbnN0cnVjdG9yKCBtYW5hZ2VyICkgewoKCQlzdXBlciggbWFuYWdlciApOwoKCX0KCglsb2FkKCB1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciApIHsKCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQljb25zdCBpbWFnZXMgPSBbXTsKCgkJY29uc3QgdGV4dHVyZSA9IG5ldyBDb21wcmVzc2VkVGV4dHVyZSgpOwoKCQljb25zdCBsb2FkZXIgPSBuZXcgRmlsZUxvYWRlciggdGhpcy5tYW5hZ2VyICk7CgkJbG9hZGVyLnNldFBhdGgoIHRoaXMucGF0aCApOwoJCWxvYWRlci5zZXRSZXNwb25zZVR5cGUoICdhcnJheWJ1ZmZlcicgKTsKCQlsb2FkZXIuc2V0UmVxdWVzdEhlYWRlciggdGhpcy5yZXF1ZXN0SGVhZGVyICk7CgkJbG9hZGVyLnNldFdpdGhDcmVkZW50aWFscyggc2NvcGUud2l0aENyZWRlbnRpYWxzICk7CgoJCWxldCBsb2FkZWQgPSAwOwoKCQlmdW5jdGlvbiBsb2FkVGV4dHVyZSggaSApIHsKCgkJCWxvYWRlci5sb2FkKCB1cmxbIGkgXSwgZnVuY3Rpb24gKCBidWZmZXIgKSB7CgoJCQkJY29uc3QgdGV4RGF0YXMgPSBzY29wZS5wYXJzZSggYnVmZmVyLCB0cnVlICk7CgoJCQkJaW1hZ2VzWyBpIF0gPSB7CgkJCQkJd2lkdGg6IHRleERhdGFzLndpZHRoLAoJCQkJCWhlaWdodDogdGV4RGF0YXMuaGVpZ2h0LAoJCQkJCWZvcm1hdDogdGV4RGF0YXMuZm9ybWF0LAoJCQkJCW1pcG1hcHM6IHRleERhdGFzLm1pcG1hcHMKCQkJCX07CgoJCQkJbG9hZGVkICs9IDE7CgoJCQkJaWYgKCBsb2FkZWQgPT09IDYgKSB7CgoJCQkJCWlmICggdGV4RGF0YXMubWlwbWFwQ291bnQgPT09IDEgKSB0ZXh0dXJlLm1pbkZpbHRlciA9IExpbmVhckZpbHRlcjsKCgkJCQkJdGV4dHVyZS5pbWFnZSA9IGltYWdlczsKCQkJCQl0ZXh0dXJlLmZvcm1hdCA9IHRleERhdGFzLmZvcm1hdDsKCQkJCQl0ZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQkJaWYgKCBvbkxvYWQgKSBvbkxvYWQoIHRleHR1cmUgKTsKCgkJCQl9CgoJCQl9LCBvblByb2dyZXNzLCBvbkVycm9yICk7CgoJCX0KCgkJaWYgKCBBcnJheS5pc0FycmF5KCB1cmwgKSApIHsKCgkJCWZvciAoIGxldCBpID0gMCwgaWwgPSB1cmwubGVuZ3RoOyBpIDwgaWw7ICsrIGkgKSB7CgoJCQkJbG9hZFRleHR1cmUoIGkgKTsKCgkJCX0KCgkJfSBlbHNlIHsKCgkJCS8vIGNvbXByZXNzZWQgY3ViZW1hcCB0ZXh0dXJlIHN0b3JlZCBpbiBhIHNpbmdsZSBERFMgZmlsZQoKCQkJbG9hZGVyLmxvYWQoIHVybCwgZnVuY3Rpb24gKCBidWZmZXIgKSB7CgoJCQkJY29uc3QgdGV4RGF0YXMgPSBzY29wZS5wYXJzZSggYnVmZmVyLCB0cnVlICk7CgoJCQkJaWYgKCB0ZXhEYXRhcy5pc0N1YmVtYXAgKSB7CgoJCQkJCWNvbnN0IGZhY2VzID0gdGV4RGF0YXMubWlwbWFwcy5sZW5ndGggLyB0ZXhEYXRhcy5taXBtYXBDb3VudDsKCgkJCQkJZm9yICggbGV0IGYgPSAwOyBmIDwgZmFjZXM7IGYgKysgKSB7CgoJCQkJCQlpbWFnZXNbIGYgXSA9IHsgbWlwbWFwczogW10gfTsKCgkJCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IHRleERhdGFzLm1pcG1hcENvdW50OyBpICsrICkgewoKCQkJCQkJCWltYWdlc1sgZiBdLm1pcG1hcHMucHVzaCggdGV4RGF0YXMubWlwbWFwc1sgZiAqIHRleERhdGFzLm1pcG1hcENvdW50ICsgaSBdICk7CgkJCQkJCQlpbWFnZXNbIGYgXS5mb3JtYXQgPSB0ZXhEYXRhcy5mb3JtYXQ7CgkJCQkJCQlpbWFnZXNbIGYgXS53aWR0aCA9IHRleERhdGFzLndpZHRoOwoJCQkJCQkJaW1hZ2VzWyBmIF0uaGVpZ2h0ID0gdGV4RGF0YXMuaGVpZ2h0OwoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCXRleHR1cmUuaW1hZ2UgPSBpbWFnZXM7CgoJCQkJfSBlbHNlIHsKCgkJCQkJdGV4dHVyZS5pbWFnZS53aWR0aCA9IHRleERhdGFzLndpZHRoOwoJCQkJCXRleHR1cmUuaW1hZ2UuaGVpZ2h0ID0gdGV4RGF0YXMuaGVpZ2h0OwoJCQkJCXRleHR1cmUubWlwbWFwcyA9IHRleERhdGFzLm1pcG1hcHM7CgoJCQkJfQoKCQkJCWlmICggdGV4RGF0YXMubWlwbWFwQ291bnQgPT09IDEgKSB7CgoJCQkJCXRleHR1cmUubWluRmlsdGVyID0gTGluZWFyRmlsdGVyOwoKCQkJCX0KCgkJCQl0ZXh0dXJlLmZvcm1hdCA9IHRleERhdGFzLmZvcm1hdDsKCQkJCXRleHR1cmUubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCWlmICggb25Mb2FkICkgb25Mb2FkKCB0ZXh0dXJlICk7CgoJCQl9LCBvblByb2dyZXNzLCBvbkVycm9yICk7CgoJCX0KCgkJcmV0dXJuIHRleHR1cmU7CgoJfQoKfQoKY2xhc3MgSW1hZ2VMb2FkZXIgZXh0ZW5kcyBMb2FkZXIgewoKCWNvbnN0cnVjdG9yKCBtYW5hZ2VyICkgewoKCQlzdXBlciggbWFuYWdlciApOwoKCX0KCglsb2FkKCB1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciApIHsKCgkJaWYgKCB0aGlzLnBhdGggIT09IHVuZGVmaW5lZCApIHVybCA9IHRoaXMucGF0aCArIHVybDsKCgkJdXJsID0gdGhpcy5tYW5hZ2VyLnJlc29sdmVVUkwoIHVybCApOwoKCQljb25zdCBzY29wZSA9IHRoaXM7CgoJCWNvbnN0IGNhY2hlZCA9IENhY2hlLmdldCggdXJsICk7CgoJCWlmICggY2FjaGVkICE9PSB1bmRlZmluZWQgKSB7CgoJCQlzY29wZS5tYW5hZ2VyLml0ZW1TdGFydCggdXJsICk7CgoJCQlzZXRUaW1lb3V0KCBmdW5jdGlvbiAoKSB7CgoJCQkJaWYgKCBvbkxvYWQgKSBvbkxvYWQoIGNhY2hlZCApOwoKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVuZCggdXJsICk7CgoJCQl9LCAwICk7CgoJCQlyZXR1cm4gY2FjaGVkOwoKCQl9CgoJCWNvbnN0IGltYWdlID0gY3JlYXRlRWxlbWVudE5TKCAnaW1nJyApOwoKCQlmdW5jdGlvbiBvbkltYWdlTG9hZCgpIHsKCgkJCXJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7CgoJCQlDYWNoZS5hZGQoIHVybCwgdGhpcyApOwoKCQkJaWYgKCBvbkxvYWQgKSBvbkxvYWQoIHRoaXMgKTsKCgkJCXNjb3BlLm1hbmFnZXIuaXRlbUVuZCggdXJsICk7CgoJCX0KCgkJZnVuY3Rpb24gb25JbWFnZUVycm9yKCBldmVudCApIHsKCgkJCXJlbW92ZUV2ZW50TGlzdGVuZXJzKCk7CgoJCQlpZiAoIG9uRXJyb3IgKSBvbkVycm9yKCBldmVudCApOwoKCQkJc2NvcGUubWFuYWdlci5pdGVtRXJyb3IoIHVybCApOwoJCQlzY29wZS5tYW5hZ2VyLml0ZW1FbmQoIHVybCApOwoKCQl9CgoJCWZ1bmN0aW9uIHJlbW92ZUV2ZW50TGlzdGVuZXJzKCkgewoKCQkJaW1hZ2UucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2xvYWQnLCBvbkltYWdlTG9hZCwgZmFsc2UgKTsKCQkJaW1hZ2UucmVtb3ZlRXZlbnRMaXN0ZW5lciggJ2Vycm9yJywgb25JbWFnZUVycm9yLCBmYWxzZSApOwoKCQl9CgoJCWltYWdlLmFkZEV2ZW50TGlzdGVuZXIoICdsb2FkJywgb25JbWFnZUxvYWQsIGZhbHNlICk7CgkJaW1hZ2UuYWRkRXZlbnRMaXN0ZW5lciggJ2Vycm9yJywgb25JbWFnZUVycm9yLCBmYWxzZSApOwoKCQlpZiAoIHVybC5zbGljZSggMCwgNSApICE9PSAnZGF0YTonICkgewoKCQkJaWYgKCB0aGlzLmNyb3NzT3JpZ2luICE9PSB1bmRlZmluZWQgKSBpbWFnZS5jcm9zc09yaWdpbiA9IHRoaXMuY3Jvc3NPcmlnaW47CgoJCX0KCgkJc2NvcGUubWFuYWdlci5pdGVtU3RhcnQoIHVybCApOwoKCQlpbWFnZS5zcmMgPSB1cmw7CgoJCXJldHVybiBpbWFnZTsKCgl9Cgp9CgpjbGFzcyBDdWJlVGV4dHVyZUxvYWRlciBleHRlbmRzIExvYWRlciB7CgoJY29uc3RydWN0b3IoIG1hbmFnZXIgKSB7CgoJCXN1cGVyKCBtYW5hZ2VyICk7CgoJfQoKCWxvYWQoIHVybHMsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciApIHsKCgkJY29uc3QgdGV4dHVyZSA9IG5ldyBDdWJlVGV4dHVyZSgpOwoJCXRleHR1cmUuY29sb3JTcGFjZSA9IFNSR0JDb2xvclNwYWNlOwoKCQljb25zdCBsb2FkZXIgPSBuZXcgSW1hZ2VMb2FkZXIoIHRoaXMubWFuYWdlciApOwoJCWxvYWRlci5zZXRDcm9zc09yaWdpbiggdGhpcy5jcm9zc09yaWdpbiApOwoJCWxvYWRlci5zZXRQYXRoKCB0aGlzLnBhdGggKTsKCgkJbGV0IGxvYWRlZCA9IDA7CgoJCWZ1bmN0aW9uIGxvYWRUZXh0dXJlKCBpICkgewoKCQkJbG9hZGVyLmxvYWQoIHVybHNbIGkgXSwgZnVuY3Rpb24gKCBpbWFnZSApIHsKCgkJCQl0ZXh0dXJlLmltYWdlc1sgaSBdID0gaW1hZ2U7CgoJCQkJbG9hZGVkICsrOwoKCQkJCWlmICggbG9hZGVkID09PSA2ICkgewoKCQkJCQl0ZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJCQkJaWYgKCBvbkxvYWQgKSBvbkxvYWQoIHRleHR1cmUgKTsKCgkJCQl9CgoJCQl9LCB1bmRlZmluZWQsIG9uRXJyb3IgKTsKCgkJfQoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCB1cmxzLmxlbmd0aDsgKysgaSApIHsKCgkJCWxvYWRUZXh0dXJlKCBpICk7CgoJCX0KCgkJcmV0dXJuIHRleHR1cmU7CgoJfQoKfQoKLyoqCiAqIEFic3RyYWN0IEJhc2UgY2xhc3MgdG8gbG9hZCBnZW5lcmljIGJpbmFyeSB0ZXh0dXJlcyBmb3JtYXRzIChyZ2JlLCBoZHIsIC4uLikKICoKICogU3ViIGNsYXNzZXMgaGF2ZSB0byBpbXBsZW1lbnQgdGhlIHBhcnNlKCkgbWV0aG9kIHdoaWNoIHdpbGwgYmUgdXNlZCBpbiBsb2FkKCkuCiAqLwoKY2xhc3MgRGF0YVRleHR1cmVMb2FkZXIgZXh0ZW5kcyBMb2FkZXIgewoKCWNvbnN0cnVjdG9yKCBtYW5hZ2VyICkgewoKCQlzdXBlciggbWFuYWdlciApOwoKCX0KCglsb2FkKCB1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciApIHsKCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQljb25zdCB0ZXh0dXJlID0gbmV3IERhdGFUZXh0dXJlKCk7CgoJCWNvbnN0IGxvYWRlciA9IG5ldyBGaWxlTG9hZGVyKCB0aGlzLm1hbmFnZXIgKTsKCQlsb2FkZXIuc2V0UmVzcG9uc2VUeXBlKCAnYXJyYXlidWZmZXInICk7CgkJbG9hZGVyLnNldFJlcXVlc3RIZWFkZXIoIHRoaXMucmVxdWVzdEhlYWRlciApOwoJCWxvYWRlci5zZXRQYXRoKCB0aGlzLnBhdGggKTsKCQlsb2FkZXIuc2V0V2l0aENyZWRlbnRpYWxzKCBzY29wZS53aXRoQ3JlZGVudGlhbHMgKTsKCQlsb2FkZXIubG9hZCggdXJsLCBmdW5jdGlvbiAoIGJ1ZmZlciApIHsKCgkJCWxldCB0ZXhEYXRhOwoKCQkJdHJ5IHsKCgkJCQl0ZXhEYXRhID0gc2NvcGUucGFyc2UoIGJ1ZmZlciApOwoKCQkJfSBjYXRjaCAoIGVycm9yICkgewoKCQkJCWlmICggb25FcnJvciAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlvbkVycm9yKCBlcnJvciApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWNvbnNvbGUuZXJyb3IoIGVycm9yICk7CgkJCQkJcmV0dXJuOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggdGV4RGF0YS5pbWFnZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXRleHR1cmUuaW1hZ2UgPSB0ZXhEYXRhLmltYWdlOwoKCQkJfSBlbHNlIGlmICggdGV4RGF0YS5kYXRhICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJdGV4dHVyZS5pbWFnZS53aWR0aCA9IHRleERhdGEud2lkdGg7CgkJCQl0ZXh0dXJlLmltYWdlLmhlaWdodCA9IHRleERhdGEuaGVpZ2h0OwoJCQkJdGV4dHVyZS5pbWFnZS5kYXRhID0gdGV4RGF0YS5kYXRhOwoKCQkJfQoKCQkJdGV4dHVyZS53cmFwUyA9IHRleERhdGEud3JhcFMgIT09IHVuZGVmaW5lZCA/IHRleERhdGEud3JhcFMgOiBDbGFtcFRvRWRnZVdyYXBwaW5nOwoJCQl0ZXh0dXJlLndyYXBUID0gdGV4RGF0YS53cmFwVCAhPT0gdW5kZWZpbmVkID8gdGV4RGF0YS53cmFwVCA6IENsYW1wVG9FZGdlV3JhcHBpbmc7CgoJCQl0ZXh0dXJlLm1hZ0ZpbHRlciA9IHRleERhdGEubWFnRmlsdGVyICE9PSB1bmRlZmluZWQgPyB0ZXhEYXRhLm1hZ0ZpbHRlciA6IExpbmVhckZpbHRlcjsKCQkJdGV4dHVyZS5taW5GaWx0ZXIgPSB0ZXhEYXRhLm1pbkZpbHRlciAhPT0gdW5kZWZpbmVkID8gdGV4RGF0YS5taW5GaWx0ZXIgOiBMaW5lYXJGaWx0ZXI7CgoJCQl0ZXh0dXJlLmFuaXNvdHJvcHkgPSB0ZXhEYXRhLmFuaXNvdHJvcHkgIT09IHVuZGVmaW5lZCA/IHRleERhdGEuYW5pc290cm9weSA6IDE7CgoJCQlpZiAoIHRleERhdGEuY29sb3JTcGFjZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXRleHR1cmUuY29sb3JTcGFjZSA9IHRleERhdGEuY29sb3JTcGFjZTsKCgkJCX0gZWxzZSBpZiAoIHRleERhdGEuZW5jb2RpbmcgIT09IHVuZGVmaW5lZCApIHsgLy8gQGRlcHJlY2F0ZWQsIHIxNTIKCgkJCQl0ZXh0dXJlLmVuY29kaW5nID0gdGV4RGF0YS5lbmNvZGluZzsKCgkJCX0KCgkJCWlmICggdGV4RGF0YS5mbGlwWSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXRleHR1cmUuZmxpcFkgPSB0ZXhEYXRhLmZsaXBZOwoKCQkJfQoKCQkJaWYgKCB0ZXhEYXRhLmZvcm1hdCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXRleHR1cmUuZm9ybWF0ID0gdGV4RGF0YS5mb3JtYXQ7CgoJCQl9CgoJCQlpZiAoIHRleERhdGEudHlwZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXRleHR1cmUudHlwZSA9IHRleERhdGEudHlwZTsKCgkJCX0KCgkJCWlmICggdGV4RGF0YS5taXBtYXBzICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJdGV4dHVyZS5taXBtYXBzID0gdGV4RGF0YS5taXBtYXBzOwoJCQkJdGV4dHVyZS5taW5GaWx0ZXIgPSBMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXI7IC8vIHByZXN1bWFibHkuLi4KCgkJCX0KCgkJCWlmICggdGV4RGF0YS5taXBtYXBDb3VudCA9PT0gMSApIHsKCgkJCQl0ZXh0dXJlLm1pbkZpbHRlciA9IExpbmVhckZpbHRlcjsKCgkJCX0KCgkJCWlmICggdGV4RGF0YS5nZW5lcmF0ZU1pcG1hcHMgIT09IHVuZGVmaW5lZCApIHsKCgkJCQl0ZXh0dXJlLmdlbmVyYXRlTWlwbWFwcyA9IHRleERhdGEuZ2VuZXJhdGVNaXBtYXBzOwoKCQkJfQoKCQkJdGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQlpZiAoIG9uTG9hZCApIG9uTG9hZCggdGV4dHVyZSwgdGV4RGF0YSApOwoKCQl9LCBvblByb2dyZXNzLCBvbkVycm9yICk7CgoKCQlyZXR1cm4gdGV4dHVyZTsKCgl9Cgp9CgpjbGFzcyBUZXh0dXJlTG9hZGVyIGV4dGVuZHMgTG9hZGVyIHsKCgljb25zdHJ1Y3RvciggbWFuYWdlciApIHsKCgkJc3VwZXIoIG1hbmFnZXIgKTsKCgl9CgoJbG9hZCggdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgoJCWNvbnN0IHRleHR1cmUgPSBuZXcgVGV4dHVyZSgpOwoKCQljb25zdCBsb2FkZXIgPSBuZXcgSW1hZ2VMb2FkZXIoIHRoaXMubWFuYWdlciApOwoJCWxvYWRlci5zZXRDcm9zc09yaWdpbiggdGhpcy5jcm9zc09yaWdpbiApOwoJCWxvYWRlci5zZXRQYXRoKCB0aGlzLnBhdGggKTsKCgkJbG9hZGVyLmxvYWQoIHVybCwgZnVuY3Rpb24gKCBpbWFnZSApIHsKCgkJCXRleHR1cmUuaW1hZ2UgPSBpbWFnZTsKCQkJdGV4dHVyZS5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCQlpZiAoIG9uTG9hZCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCW9uTG9hZCggdGV4dHVyZSApOwoKCQkJfQoKCQl9LCBvblByb2dyZXNzLCBvbkVycm9yICk7CgoJCXJldHVybiB0ZXh0dXJlOwoKCX0KCn0KCmNsYXNzIExpZ2h0IGV4dGVuZHMgT2JqZWN0M0QgewoKCWNvbnN0cnVjdG9yKCBjb2xvciwgaW50ZW5zaXR5ID0gMSApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5pc0xpZ2h0ID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ0xpZ2h0JzsKCgkJdGhpcy5jb2xvciA9IG5ldyBDb2xvciggY29sb3IgKTsKCQl0aGlzLmludGVuc2l0eSA9IGludGVuc2l0eTsKCgl9CgoJZGlzcG9zZSgpIHsKCgkJLy8gRW1wdHkgaGVyZSBpbiBiYXNlIGNsYXNzOyBzb21lIHN1YmNsYXNzZXMgb3ZlcnJpZGUuCgoJfQoKCWNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApOwoKCQl0aGlzLmNvbG9yLmNvcHkoIHNvdXJjZS5jb2xvciApOwoJCXRoaXMuaW50ZW5zaXR5ID0gc291cmNlLmludGVuc2l0eTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTiggbWV0YSApIHsKCgkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTiggbWV0YSApOwoKCQlkYXRhLm9iamVjdC5jb2xvciA9IHRoaXMuY29sb3IuZ2V0SGV4KCk7CgkJZGF0YS5vYmplY3QuaW50ZW5zaXR5ID0gdGhpcy5pbnRlbnNpdHk7CgoJCWlmICggdGhpcy5ncm91bmRDb2xvciAhPT0gdW5kZWZpbmVkICkgZGF0YS5vYmplY3QuZ3JvdW5kQ29sb3IgPSB0aGlzLmdyb3VuZENvbG9yLmdldEhleCgpOwoKCQlpZiAoIHRoaXMuZGlzdGFuY2UgIT09IHVuZGVmaW5lZCApIGRhdGEub2JqZWN0LmRpc3RhbmNlID0gdGhpcy5kaXN0YW5jZTsKCQlpZiAoIHRoaXMuYW5nbGUgIT09IHVuZGVmaW5lZCApIGRhdGEub2JqZWN0LmFuZ2xlID0gdGhpcy5hbmdsZTsKCQlpZiAoIHRoaXMuZGVjYXkgIT09IHVuZGVmaW5lZCApIGRhdGEub2JqZWN0LmRlY2F5ID0gdGhpcy5kZWNheTsKCQlpZiAoIHRoaXMucGVudW1icmEgIT09IHVuZGVmaW5lZCApIGRhdGEub2JqZWN0LnBlbnVtYnJhID0gdGhpcy5wZW51bWJyYTsKCgkJaWYgKCB0aGlzLnNoYWRvdyAhPT0gdW5kZWZpbmVkICkgZGF0YS5vYmplY3Quc2hhZG93ID0gdGhpcy5zaGFkb3cudG9KU09OKCk7CgoJCXJldHVybiBkYXRhOwoKCX0KCn0KCmNsYXNzIEhlbWlzcGhlcmVMaWdodCBleHRlbmRzIExpZ2h0IHsKCgljb25zdHJ1Y3Rvciggc2t5Q29sb3IsIGdyb3VuZENvbG9yLCBpbnRlbnNpdHkgKSB7CgoJCXN1cGVyKCBza3lDb2xvciwgaW50ZW5zaXR5ICk7CgoJCXRoaXMuaXNIZW1pc3BoZXJlTGlnaHQgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnSGVtaXNwaGVyZUxpZ2h0JzsKCgkJdGhpcy5wb3NpdGlvbi5jb3B5KCBPYmplY3QzRC5ERUZBVUxUX1VQICk7CgkJdGhpcy51cGRhdGVNYXRyaXgoKTsKCgkJdGhpcy5ncm91bmRDb2xvciA9IG5ldyBDb2xvciggZ3JvdW5kQ29sb3IgKTsKCgl9CgoJY29weSggc291cmNlLCByZWN1cnNpdmUgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgoJCXRoaXMuZ3JvdW5kQ29sb3IuY29weSggc291cmNlLmdyb3VuZENvbG9yICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNvbnN0IF9wcm9qU2NyZWVuTWF0cml4JDEgPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXg0KCk7CmNvbnN0IF9saWdodFBvc2l0aW9uV29ybGQkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX2xvb2tUYXJnZXQkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNsYXNzIExpZ2h0U2hhZG93IHsKCgljb25zdHJ1Y3RvciggY2FtZXJhICkgewoKCQl0aGlzLmNhbWVyYSA9IGNhbWVyYTsKCgkJdGhpcy5iaWFzID0gMDsKCQl0aGlzLm5vcm1hbEJpYXMgPSAwOwoJCXRoaXMucmFkaXVzID0gMTsKCQl0aGlzLmJsdXJTYW1wbGVzID0gODsKCgkJdGhpcy5tYXBTaXplID0gbmV3IFZlY3RvcjIoIDUxMiwgNTEyICk7CgoJCXRoaXMubWFwID0gbnVsbDsKCQl0aGlzLm1hcFBhc3MgPSBudWxsOwoJCXRoaXMubWF0cml4ID0gbmV3IE1hdHJpeDQoKTsKCgkJdGhpcy5hdXRvVXBkYXRlID0gdHJ1ZTsKCQl0aGlzLm5lZWRzVXBkYXRlID0gZmFsc2U7CgoJCXRoaXMuX2ZydXN0dW0gPSBuZXcgRnJ1c3R1bSgpOwoJCXRoaXMuX2ZyYW1lRXh0ZW50cyA9IG5ldyBWZWN0b3IyKCAxLCAxICk7CgoJCXRoaXMuX3ZpZXdwb3J0Q291bnQgPSAxOwoKCQl0aGlzLl92aWV3cG9ydHMgPSBbCgoJCQluZXcgVmVjdG9yNCggMCwgMCwgMSwgMSApCgoJCV07CgoJfQoKCWdldFZpZXdwb3J0Q291bnQoKSB7CgoJCXJldHVybiB0aGlzLl92aWV3cG9ydENvdW50OwoKCX0KCglnZXRGcnVzdHVtKCkgewoKCQlyZXR1cm4gdGhpcy5fZnJ1c3R1bTsKCgl9CgoJdXBkYXRlTWF0cmljZXMoIGxpZ2h0ICkgewoKCQljb25zdCBzaGFkb3dDYW1lcmEgPSB0aGlzLmNhbWVyYTsKCQljb25zdCBzaGFkb3dNYXRyaXggPSB0aGlzLm1hdHJpeDsKCgkJX2xpZ2h0UG9zaXRpb25Xb3JsZCQxLnNldEZyb21NYXRyaXhQb3NpdGlvbiggbGlnaHQubWF0cml4V29ybGQgKTsKCQlzaGFkb3dDYW1lcmEucG9zaXRpb24uY29weSggX2xpZ2h0UG9zaXRpb25Xb3JsZCQxICk7CgoJCV9sb29rVGFyZ2V0JDEuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC50YXJnZXQubWF0cml4V29ybGQgKTsKCQlzaGFkb3dDYW1lcmEubG9va0F0KCBfbG9va1RhcmdldCQxICk7CgkJc2hhZG93Q2FtZXJhLnVwZGF0ZU1hdHJpeFdvcmxkKCk7CgoJCV9wcm9qU2NyZWVuTWF0cml4JDEubXVsdGlwbHlNYXRyaWNlcyggc2hhZG93Q2FtZXJhLnByb2plY3Rpb25NYXRyaXgsIHNoYWRvd0NhbWVyYS5tYXRyaXhXb3JsZEludmVyc2UgKTsKCQl0aGlzLl9mcnVzdHVtLnNldEZyb21Qcm9qZWN0aW9uTWF0cml4KCBfcHJvalNjcmVlbk1hdHJpeCQxICk7CgoJCXNoYWRvd01hdHJpeC5zZXQoCgkJCTAuNSwgMC4wLCAwLjAsIDAuNSwKCQkJMC4wLCAwLjUsIDAuMCwgMC41LAoJCQkwLjAsIDAuMCwgMC41LCAwLjUsCgkJCTAuMCwgMC4wLCAwLjAsIDEuMAoJCSk7CgoJCXNoYWRvd01hdHJpeC5tdWx0aXBseSggX3Byb2pTY3JlZW5NYXRyaXgkMSApOwoKCX0KCglnZXRWaWV3cG9ydCggdmlld3BvcnRJbmRleCApIHsKCgkJcmV0dXJuIHRoaXMuX3ZpZXdwb3J0c1sgdmlld3BvcnRJbmRleCBdOwoKCX0KCglnZXRGcmFtZUV4dGVudHMoKSB7CgoJCXJldHVybiB0aGlzLl9mcmFtZUV4dGVudHM7CgoJfQoKCWRpc3Bvc2UoKSB7CgoJCWlmICggdGhpcy5tYXAgKSB7CgoJCQl0aGlzLm1hcC5kaXNwb3NlKCk7CgoJCX0KCgkJaWYgKCB0aGlzLm1hcFBhc3MgKSB7CgoJCQl0aGlzLm1hcFBhc3MuZGlzcG9zZSgpOwoKCQl9CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJdGhpcy5jYW1lcmEgPSBzb3VyY2UuY2FtZXJhLmNsb25lKCk7CgoJCXRoaXMuYmlhcyA9IHNvdXJjZS5iaWFzOwoJCXRoaXMucmFkaXVzID0gc291cmNlLnJhZGl1czsKCgkJdGhpcy5tYXBTaXplLmNvcHkoIHNvdXJjZS5tYXBTaXplICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljbG9uZSgpIHsKCgkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCX0KCgl0b0pTT04oKSB7CgoJCWNvbnN0IG9iamVjdCA9IHt9OwoKCQlpZiAoIHRoaXMuYmlhcyAhPT0gMCApIG9iamVjdC5iaWFzID0gdGhpcy5iaWFzOwoJCWlmICggdGhpcy5ub3JtYWxCaWFzICE9PSAwICkgb2JqZWN0Lm5vcm1hbEJpYXMgPSB0aGlzLm5vcm1hbEJpYXM7CgkJaWYgKCB0aGlzLnJhZGl1cyAhPT0gMSApIG9iamVjdC5yYWRpdXMgPSB0aGlzLnJhZGl1czsKCQlpZiAoIHRoaXMubWFwU2l6ZS54ICE9PSA1MTIgfHwgdGhpcy5tYXBTaXplLnkgIT09IDUxMiApIG9iamVjdC5tYXBTaXplID0gdGhpcy5tYXBTaXplLnRvQXJyYXkoKTsKCgkJb2JqZWN0LmNhbWVyYSA9IHRoaXMuY2FtZXJhLnRvSlNPTiggZmFsc2UgKS5vYmplY3Q7CgkJZGVsZXRlIG9iamVjdC5jYW1lcmEubWF0cml4OwoKCQlyZXR1cm4gb2JqZWN0OwoKCX0KCn0KCmNsYXNzIFNwb3RMaWdodFNoYWRvdyBleHRlbmRzIExpZ2h0U2hhZG93IHsKCgljb25zdHJ1Y3RvcigpIHsKCgkJc3VwZXIoIG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSggNTAsIDEsIDAuNSwgNTAwICkgKTsKCgkJdGhpcy5pc1Nwb3RMaWdodFNoYWRvdyA9IHRydWU7CgoJCXRoaXMuZm9jdXMgPSAxOwoKCX0KCgl1cGRhdGVNYXRyaWNlcyggbGlnaHQgKSB7CgoJCWNvbnN0IGNhbWVyYSA9IHRoaXMuY2FtZXJhOwoKCQljb25zdCBmb3YgPSBSQUQyREVHICogMiAqIGxpZ2h0LmFuZ2xlICogdGhpcy5mb2N1czsKCQljb25zdCBhc3BlY3QgPSB0aGlzLm1hcFNpemUud2lkdGggLyB0aGlzLm1hcFNpemUuaGVpZ2h0OwoJCWNvbnN0IGZhciA9IGxpZ2h0LmRpc3RhbmNlIHx8IGNhbWVyYS5mYXI7CgoJCWlmICggZm92ICE9PSBjYW1lcmEuZm92IHx8IGFzcGVjdCAhPT0gY2FtZXJhLmFzcGVjdCB8fCBmYXIgIT09IGNhbWVyYS5mYXIgKSB7CgoJCQljYW1lcmEuZm92ID0gZm92OwoJCQljYW1lcmEuYXNwZWN0ID0gYXNwZWN0OwoJCQljYW1lcmEuZmFyID0gZmFyOwoJCQljYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCQl9CgoJCXN1cGVyLnVwZGF0ZU1hdHJpY2VzKCBsaWdodCApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLmZvY3VzID0gc291cmNlLmZvY3VzOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9CgpjbGFzcyBTcG90TGlnaHQgZXh0ZW5kcyBMaWdodCB7CgoJY29uc3RydWN0b3IoIGNvbG9yLCBpbnRlbnNpdHksIGRpc3RhbmNlID0gMCwgYW5nbGUgPSBNYXRoLlBJIC8gMywgcGVudW1icmEgPSAwLCBkZWNheSA9IDIgKSB7CgoJCXN1cGVyKCBjb2xvciwgaW50ZW5zaXR5ICk7CgoJCXRoaXMuaXNTcG90TGlnaHQgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnU3BvdExpZ2h0JzsKCgkJdGhpcy5wb3NpdGlvbi5jb3B5KCBPYmplY3QzRC5ERUZBVUxUX1VQICk7CgkJdGhpcy51cGRhdGVNYXRyaXgoKTsKCgkJdGhpcy50YXJnZXQgPSBuZXcgT2JqZWN0M0QoKTsKCgkJdGhpcy5kaXN0YW5jZSA9IGRpc3RhbmNlOwoJCXRoaXMuYW5nbGUgPSBhbmdsZTsKCQl0aGlzLnBlbnVtYnJhID0gcGVudW1icmE7CgkJdGhpcy5kZWNheSA9IGRlY2F5OwoKCQl0aGlzLm1hcCA9IG51bGw7CgoJCXRoaXMuc2hhZG93ID0gbmV3IFNwb3RMaWdodFNoYWRvdygpOwoKCX0KCglnZXQgcG93ZXIoKSB7CgoJCS8vIGNvbXB1dGUgdGhlIGxpZ2h0J3MgbHVtaW5vdXMgcG93ZXIgKGluIGx1bWVucykgZnJvbSBpdHMgaW50ZW5zaXR5IChpbiBjYW5kZWxhKQoJCS8vIGJ5IGNvbnZlbnRpb24gZm9yIGEgc3BvdGxpZ2h0LCBsdW1pbm91cyBwb3dlciAobG0pID0gz4AgKiBsdW1pbm91cyBpbnRlbnNpdHkgKGNkKQoJCXJldHVybiB0aGlzLmludGVuc2l0eSAqIE1hdGguUEk7CgoJfQoKCXNldCBwb3dlciggcG93ZXIgKSB7CgoJCS8vIHNldCB0aGUgbGlnaHQncyBpbnRlbnNpdHkgKGluIGNhbmRlbGEpIGZyb20gdGhlIGRlc2lyZWQgbHVtaW5vdXMgcG93ZXIgKGluIGx1bWVucykKCQl0aGlzLmludGVuc2l0eSA9IHBvd2VyIC8gTWF0aC5QSTsKCgl9CgoJZGlzcG9zZSgpIHsKCgkJdGhpcy5zaGFkb3cuZGlzcG9zZSgpOwoKCX0KCgljb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlLCByZWN1cnNpdmUgKTsKCgkJdGhpcy5kaXN0YW5jZSA9IHNvdXJjZS5kaXN0YW5jZTsKCQl0aGlzLmFuZ2xlID0gc291cmNlLmFuZ2xlOwoJCXRoaXMucGVudW1icmEgPSBzb3VyY2UucGVudW1icmE7CgkJdGhpcy5kZWNheSA9IHNvdXJjZS5kZWNheTsKCgkJdGhpcy50YXJnZXQgPSBzb3VyY2UudGFyZ2V0LmNsb25lKCk7CgoJCXRoaXMuc2hhZG93ID0gc291cmNlLnNoYWRvdy5jbG9uZSgpOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9Cgpjb25zdCBfcHJvalNjcmVlbk1hdHJpeCA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKY29uc3QgX2xpZ2h0UG9zaXRpb25Xb3JsZCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX2xvb2tUYXJnZXQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgpjbGFzcyBQb2ludExpZ2h0U2hhZG93IGV4dGVuZHMgTGlnaHRTaGFkb3cgewoKCWNvbnN0cnVjdG9yKCkgewoKCQlzdXBlciggbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCA5MCwgMSwgMC41LCA1MDAgKSApOwoKCQl0aGlzLmlzUG9pbnRMaWdodFNoYWRvdyA9IHRydWU7CgoJCXRoaXMuX2ZyYW1lRXh0ZW50cyA9IG5ldyBWZWN0b3IyKCA0LCAyICk7CgoJCXRoaXMuX3ZpZXdwb3J0Q291bnQgPSA2OwoKCQl0aGlzLl92aWV3cG9ydHMgPSBbCgkJCS8vIFRoZXNlIHZpZXdwb3J0cyBtYXAgYSBjdWJlLW1hcCBvbnRvIGEgMkQgdGV4dHVyZSB3aXRoIHRoZQoJCQkvLyBmb2xsb3dpbmcgb3JpZW50YXRpb246CgkJCS8vCgkJCS8vICB4elhaCgkJCS8vICAgeSBZCgkJCS8vCgkJCS8vIFggLSBQb3NpdGl2ZSB4IGRpcmVjdGlvbgoJCQkvLyB4IC0gTmVnYXRpdmUgeCBkaXJlY3Rpb24KCQkJLy8gWSAtIFBvc2l0aXZlIHkgZGlyZWN0aW9uCgkJCS8vIHkgLSBOZWdhdGl2ZSB5IGRpcmVjdGlvbgoJCQkvLyBaIC0gUG9zaXRpdmUgeiBkaXJlY3Rpb24KCQkJLy8geiAtIE5lZ2F0aXZlIHogZGlyZWN0aW9uCgoJCQkvLyBwb3NpdGl2ZSBYCgkJCW5ldyBWZWN0b3I0KCAyLCAxLCAxLCAxICksCgkJCS8vIG5lZ2F0aXZlIFgKCQkJbmV3IFZlY3RvcjQoIDAsIDEsIDEsIDEgKSwKCQkJLy8gcG9zaXRpdmUgWgoJCQluZXcgVmVjdG9yNCggMywgMSwgMSwgMSApLAoJCQkvLyBuZWdhdGl2ZSBaCgkJCW5ldyBWZWN0b3I0KCAxLCAxLCAxLCAxICksCgkJCS8vIHBvc2l0aXZlIFkKCQkJbmV3IFZlY3RvcjQoIDMsIDAsIDEsIDEgKSwKCQkJLy8gbmVnYXRpdmUgWQoJCQluZXcgVmVjdG9yNCggMSwgMCwgMSwgMSApCgkJXTsKCgkJdGhpcy5fY3ViZURpcmVjdGlvbnMgPSBbCgkJCW5ldyBWZWN0b3IzKCAxLCAwLCAwICksIG5ldyBWZWN0b3IzKCAtIDEsIDAsIDAgKSwgbmV3IFZlY3RvcjMoIDAsIDAsIDEgKSwKCQkJbmV3IFZlY3RvcjMoIDAsIDAsIC0gMSApLCBuZXcgVmVjdG9yMyggMCwgMSwgMCApLCBuZXcgVmVjdG9yMyggMCwgLSAxLCAwICkKCQldOwoKCQl0aGlzLl9jdWJlVXBzID0gWwoJCQluZXcgVmVjdG9yMyggMCwgMSwgMCApLCBuZXcgVmVjdG9yMyggMCwgMSwgMCApLCBuZXcgVmVjdG9yMyggMCwgMSwgMCApLAoJCQluZXcgVmVjdG9yMyggMCwgMSwgMCApLCBuZXcgVmVjdG9yMyggMCwgMCwgMSApLAluZXcgVmVjdG9yMyggMCwgMCwgLSAxICkKCQldOwoKCX0KCgl1cGRhdGVNYXRyaWNlcyggbGlnaHQsIHZpZXdwb3J0SW5kZXggPSAwICkgewoKCQljb25zdCBjYW1lcmEgPSB0aGlzLmNhbWVyYTsKCQljb25zdCBzaGFkb3dNYXRyaXggPSB0aGlzLm1hdHJpeDsKCgkJY29uc3QgZmFyID0gbGlnaHQuZGlzdGFuY2UgfHwgY2FtZXJhLmZhcjsKCgkJaWYgKCBmYXIgIT09IGNhbWVyYS5mYXIgKSB7CgoJCQljYW1lcmEuZmFyID0gZmFyOwoJCQljYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCQl9CgoJCV9saWdodFBvc2l0aW9uV29ybGQuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBsaWdodC5tYXRyaXhXb3JsZCApOwoJCWNhbWVyYS5wb3NpdGlvbi5jb3B5KCBfbGlnaHRQb3NpdGlvbldvcmxkICk7CgoJCV9sb29rVGFyZ2V0LmNvcHkoIGNhbWVyYS5wb3NpdGlvbiApOwoJCV9sb29rVGFyZ2V0LmFkZCggdGhpcy5fY3ViZURpcmVjdGlvbnNbIHZpZXdwb3J0SW5kZXggXSApOwoJCWNhbWVyYS51cC5jb3B5KCB0aGlzLl9jdWJlVXBzWyB2aWV3cG9ydEluZGV4IF0gKTsKCQljYW1lcmEubG9va0F0KCBfbG9va1RhcmdldCApOwoJCWNhbWVyYS51cGRhdGVNYXRyaXhXb3JsZCgpOwoKCQlzaGFkb3dNYXRyaXgubWFrZVRyYW5zbGF0aW9uKCAtIF9saWdodFBvc2l0aW9uV29ybGQueCwgLSBfbGlnaHRQb3NpdGlvbldvcmxkLnksIC0gX2xpZ2h0UG9zaXRpb25Xb3JsZC56ICk7CgoJCV9wcm9qU2NyZWVuTWF0cml4Lm11bHRpcGx5TWF0cmljZXMoIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4LCBjYW1lcmEubWF0cml4V29ybGRJbnZlcnNlICk7CgkJdGhpcy5fZnJ1c3R1bS5zZXRGcm9tUHJvamVjdGlvbk1hdHJpeCggX3Byb2pTY3JlZW5NYXRyaXggKTsKCgl9Cgp9CgpjbGFzcyBQb2ludExpZ2h0IGV4dGVuZHMgTGlnaHQgewoKCWNvbnN0cnVjdG9yKCBjb2xvciwgaW50ZW5zaXR5LCBkaXN0YW5jZSA9IDAsIGRlY2F5ID0gMiApIHsKCgkJc3VwZXIoIGNvbG9yLCBpbnRlbnNpdHkgKTsKCgkJdGhpcy5pc1BvaW50TGlnaHQgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnUG9pbnRMaWdodCc7CgoJCXRoaXMuZGlzdGFuY2UgPSBkaXN0YW5jZTsKCQl0aGlzLmRlY2F5ID0gZGVjYXk7CgoJCXRoaXMuc2hhZG93ID0gbmV3IFBvaW50TGlnaHRTaGFkb3coKTsKCgl9CgoJZ2V0IHBvd2VyKCkgewoKCQkvLyBjb21wdXRlIHRoZSBsaWdodCdzIGx1bWlub3VzIHBvd2VyIChpbiBsdW1lbnMpIGZyb20gaXRzIGludGVuc2l0eSAoaW4gY2FuZGVsYSkKCQkvLyBmb3IgYW4gaXNvdHJvcGljIGxpZ2h0IHNvdXJjZSwgbHVtaW5vdXMgcG93ZXIgKGxtKSA9IDQgz4AgbHVtaW5vdXMgaW50ZW5zaXR5IChjZCkKCQlyZXR1cm4gdGhpcy5pbnRlbnNpdHkgKiA0ICogTWF0aC5QSTsKCgl9CgoJc2V0IHBvd2VyKCBwb3dlciApIHsKCgkJLy8gc2V0IHRoZSBsaWdodCdzIGludGVuc2l0eSAoaW4gY2FuZGVsYSkgZnJvbSB0aGUgZGVzaXJlZCBsdW1pbm91cyBwb3dlciAoaW4gbHVtZW5zKQoJCXRoaXMuaW50ZW5zaXR5ID0gcG93ZXIgLyAoIDQgKiBNYXRoLlBJICk7CgoJfQoKCWRpc3Bvc2UoKSB7CgoJCXRoaXMuc2hhZG93LmRpc3Bvc2UoKTsKCgl9CgoJY29weSggc291cmNlLCByZWN1cnNpdmUgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICk7CgoJCXRoaXMuZGlzdGFuY2UgPSBzb3VyY2UuZGlzdGFuY2U7CgkJdGhpcy5kZWNheSA9IHNvdXJjZS5kZWNheTsKCgkJdGhpcy5zaGFkb3cgPSBzb3VyY2Uuc2hhZG93LmNsb25lKCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCn0KCmNsYXNzIERpcmVjdGlvbmFsTGlnaHRTaGFkb3cgZXh0ZW5kcyBMaWdodFNoYWRvdyB7CgoJY29uc3RydWN0b3IoKSB7CgoJCXN1cGVyKCBuZXcgT3J0aG9ncmFwaGljQ2FtZXJhKCAtIDUsIDUsIDUsIC0gNSwgMC41LCA1MDAgKSApOwoKCQl0aGlzLmlzRGlyZWN0aW9uYWxMaWdodFNoYWRvdyA9IHRydWU7CgoJfQoKfQoKY2xhc3MgRGlyZWN0aW9uYWxMaWdodCBleHRlbmRzIExpZ2h0IHsKCgljb25zdHJ1Y3RvciggY29sb3IsIGludGVuc2l0eSApIHsKCgkJc3VwZXIoIGNvbG9yLCBpbnRlbnNpdHkgKTsKCgkJdGhpcy5pc0RpcmVjdGlvbmFsTGlnaHQgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnRGlyZWN0aW9uYWxMaWdodCc7CgoJCXRoaXMucG9zaXRpb24uY29weSggT2JqZWN0M0QuREVGQVVMVF9VUCApOwoJCXRoaXMudXBkYXRlTWF0cml4KCk7CgoJCXRoaXMudGFyZ2V0ID0gbmV3IE9iamVjdDNEKCk7CgoJCXRoaXMuc2hhZG93ID0gbmV3IERpcmVjdGlvbmFsTGlnaHRTaGFkb3coKTsKCgl9CgoJZGlzcG9zZSgpIHsKCgkJdGhpcy5zaGFkb3cuZGlzcG9zZSgpOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLnRhcmdldCA9IHNvdXJjZS50YXJnZXQuY2xvbmUoKTsKCQl0aGlzLnNoYWRvdyA9IHNvdXJjZS5zaGFkb3cuY2xvbmUoKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKY2xhc3MgQW1iaWVudExpZ2h0IGV4dGVuZHMgTGlnaHQgewoKCWNvbnN0cnVjdG9yKCBjb2xvciwgaW50ZW5zaXR5ICkgewoKCQlzdXBlciggY29sb3IsIGludGVuc2l0eSApOwoKCQl0aGlzLmlzQW1iaWVudExpZ2h0ID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ0FtYmllbnRMaWdodCc7CgoJfQoKfQoKY2xhc3MgUmVjdEFyZWFMaWdodCBleHRlbmRzIExpZ2h0IHsKCgljb25zdHJ1Y3RvciggY29sb3IsIGludGVuc2l0eSwgd2lkdGggPSAxMCwgaGVpZ2h0ID0gMTAgKSB7CgoJCXN1cGVyKCBjb2xvciwgaW50ZW5zaXR5ICk7CgoJCXRoaXMuaXNSZWN0QXJlYUxpZ2h0ID0gdHJ1ZTsKCgkJdGhpcy50eXBlID0gJ1JlY3RBcmVhTGlnaHQnOwoKCQl0aGlzLndpZHRoID0gd2lkdGg7CgkJdGhpcy5oZWlnaHQgPSBoZWlnaHQ7CgoJfQoKCWdldCBwb3dlcigpIHsKCgkJLy8gY29tcHV0ZSB0aGUgbGlnaHQncyBsdW1pbm91cyBwb3dlciAoaW4gbHVtZW5zKSBmcm9tIGl0cyBpbnRlbnNpdHkgKGluIG5pdHMpCgkJcmV0dXJuIHRoaXMuaW50ZW5zaXR5ICogdGhpcy53aWR0aCAqIHRoaXMuaGVpZ2h0ICogTWF0aC5QSTsKCgl9CgoJc2V0IHBvd2VyKCBwb3dlciApIHsKCgkJLy8gc2V0IHRoZSBsaWdodCdzIGludGVuc2l0eSAoaW4gbml0cykgZnJvbSB0aGUgZGVzaXJlZCBsdW1pbm91cyBwb3dlciAoaW4gbHVtZW5zKQoJCXRoaXMuaW50ZW5zaXR5ID0gcG93ZXIgLyAoIHRoaXMud2lkdGggKiB0aGlzLmhlaWdodCAqIE1hdGguUEkgKTsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy53aWR0aCA9IHNvdXJjZS53aWR0aDsKCQl0aGlzLmhlaWdodCA9IHNvdXJjZS5oZWlnaHQ7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0b0pTT04oIG1ldGEgKSB7CgoJCWNvbnN0IGRhdGEgPSBzdXBlci50b0pTT04oIG1ldGEgKTsKCgkJZGF0YS5vYmplY3Qud2lkdGggPSB0aGlzLndpZHRoOwoJCWRhdGEub2JqZWN0LmhlaWdodCA9IHRoaXMuaGVpZ2h0OwoKCQlyZXR1cm4gZGF0YTsKCgl9Cgp9CgovKioKICogUHJpbWFyeSByZWZlcmVuY2U6CiAqICAgaHR0cHM6Ly9ncmFwaGljcy5zdGFuZm9yZC5lZHUvcGFwZXJzL2Vudm1hcC9lbnZtYXAucGRmCiAqCiAqIFNlY29uZGFyeSByZWZlcmVuY2U6CiAqICAgaHR0cHM6Ly93d3cucHBzbG9hbi5vcmcvcHVibGljYXRpb25zL1N0dXBpZFNIMzYucGRmCiAqLwoKLy8gMy1iYW5kIFNIIGRlZmluZWQgYnkgOSBjb2VmZmljaWVudHMKCmNsYXNzIFNwaGVyaWNhbEhhcm1vbmljczMgewoKCWNvbnN0cnVjdG9yKCkgewoKCQl0aGlzLmlzU3BoZXJpY2FsSGFybW9uaWNzMyA9IHRydWU7CgoJCXRoaXMuY29lZmZpY2llbnRzID0gW107CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IDk7IGkgKysgKSB7CgoJCQl0aGlzLmNvZWZmaWNpZW50cy5wdXNoKCBuZXcgVmVjdG9yMygpICk7CgoJCX0KCgl9CgoJc2V0KCBjb2VmZmljaWVudHMgKSB7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IDk7IGkgKysgKSB7CgoJCQl0aGlzLmNvZWZmaWNpZW50c1sgaSBdLmNvcHkoIGNvZWZmaWNpZW50c1sgaSBdICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXplcm8oKSB7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IDk7IGkgKysgKSB7CgoJCQl0aGlzLmNvZWZmaWNpZW50c1sgaSBdLnNldCggMCwgMCwgMCApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgkvLyBnZXQgdGhlIHJhZGlhbmNlIGluIHRoZSBkaXJlY3Rpb24gb2YgdGhlIG5vcm1hbAoJLy8gdGFyZ2V0IGlzIGEgVmVjdG9yMwoJZ2V0QXQoIG5vcm1hbCwgdGFyZ2V0ICkgewoKCQkvLyBub3JtYWwgaXMgYXNzdW1lZCB0byBiZSB1bml0IGxlbmd0aAoKCQljb25zdCB4ID0gbm9ybWFsLngsIHkgPSBub3JtYWwueSwgeiA9IG5vcm1hbC56OwoKCQljb25zdCBjb2VmZiA9IHRoaXMuY29lZmZpY2llbnRzOwoKCQkvLyBiYW5kIDAKCQl0YXJnZXQuY29weSggY29lZmZbIDAgXSApLm11bHRpcGx5U2NhbGFyKCAwLjI4MjA5NSApOwoKCQkvLyBiYW5kIDEKCQl0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKCBjb2VmZlsgMSBdLCAwLjQ4ODYwMyAqIHkgKTsKCQl0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKCBjb2VmZlsgMiBdLCAwLjQ4ODYwMyAqIHogKTsKCQl0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKCBjb2VmZlsgMyBdLCAwLjQ4ODYwMyAqIHggKTsKCgkJLy8gYmFuZCAyCgkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggY29lZmZbIDQgXSwgMS4wOTI1NDggKiAoIHggKiB5ICkgKTsKCQl0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKCBjb2VmZlsgNSBdLCAxLjA5MjU0OCAqICggeSAqIHogKSApOwoJCXRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIGNvZWZmWyA2IF0sIDAuMzE1MzkyICogKCAzLjAgKiB6ICogeiAtIDEuMCApICk7CgkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggY29lZmZbIDcgXSwgMS4wOTI1NDggKiAoIHggKiB6ICkgKTsKCQl0YXJnZXQuYWRkU2NhbGVkVmVjdG9yKCBjb2VmZlsgOCBdLCAwLjU0NjI3NCAqICggeCAqIHggLSB5ICogeSApICk7CgoJCXJldHVybiB0YXJnZXQ7CgoJfQoKCS8vIGdldCB0aGUgaXJyYWRpYW5jZSAocmFkaWFuY2UgY29udm9sdmVkIHdpdGggY29zaW5lIGxvYmUpIGluIHRoZSBkaXJlY3Rpb24gb2YgdGhlIG5vcm1hbAoJLy8gdGFyZ2V0IGlzIGEgVmVjdG9yMwoJLy8gaHR0cHM6Ly9ncmFwaGljcy5zdGFuZm9yZC5lZHUvcGFwZXJzL2Vudm1hcC9lbnZtYXAucGRmCglnZXRJcnJhZGlhbmNlQXQoIG5vcm1hbCwgdGFyZ2V0ICkgewoKCQkvLyBub3JtYWwgaXMgYXNzdW1lZCB0byBiZSB1bml0IGxlbmd0aAoKCQljb25zdCB4ID0gbm9ybWFsLngsIHkgPSBub3JtYWwueSwgeiA9IG5vcm1hbC56OwoKCQljb25zdCBjb2VmZiA9IHRoaXMuY29lZmZpY2llbnRzOwoKCQkvLyBiYW5kIDAKCQl0YXJnZXQuY29weSggY29lZmZbIDAgXSApLm11bHRpcGx5U2NhbGFyKCAwLjg4NjIyNyApOyAvLyDPgCAqIDAuMjgyMDk1CgoJCS8vIGJhbmQgMQoJCXRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIGNvZWZmWyAxIF0sIDIuMCAqIDAuNTExNjY0ICogeSApOyAvLyAoIDIgKiDPgCAvIDMgKSAqIDAuNDg4NjAzCgkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggY29lZmZbIDIgXSwgMi4wICogMC41MTE2NjQgKiB6ICk7CgkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggY29lZmZbIDMgXSwgMi4wICogMC41MTE2NjQgKiB4ICk7CgoJCS8vIGJhbmQgMgoJCXRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIGNvZWZmWyA0IF0sIDIuMCAqIDAuNDI5MDQzICogeCAqIHkgKTsgLy8gKCDPgCAvIDQgKSAqIDEuMDkyNTQ4CgkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggY29lZmZbIDUgXSwgMi4wICogMC40MjkwNDMgKiB5ICogeiApOwoJCXRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIGNvZWZmWyA2IF0sIDAuNzQzMTI1ICogeiAqIHogLSAwLjI0NzcwOCApOyAvLyAoIM+AIC8gNCApICogMC4zMTUzOTIgKiAzCgkJdGFyZ2V0LmFkZFNjYWxlZFZlY3RvciggY29lZmZbIDcgXSwgMi4wICogMC40MjkwNDMgKiB4ICogeiApOwoJCXRhcmdldC5hZGRTY2FsZWRWZWN0b3IoIGNvZWZmWyA4IF0sIDAuNDI5MDQzICogKCB4ICogeCAtIHkgKiB5ICkgKTsgLy8gKCDPgCAvIDQgKSAqIDAuNTQ2Mjc0CgoJCXJldHVybiB0YXJnZXQ7CgoJfQoKCWFkZCggc2ggKSB7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IDk7IGkgKysgKSB7CgoJCQl0aGlzLmNvZWZmaWNpZW50c1sgaSBdLmFkZCggc2guY29lZmZpY2llbnRzWyBpIF0gKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJYWRkU2NhbGVkU0goIHNoLCBzICkgewoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA5OyBpICsrICkgewoKCQkJdGhpcy5jb2VmZmljaWVudHNbIGkgXS5hZGRTY2FsZWRWZWN0b3IoIHNoLmNvZWZmaWNpZW50c1sgaSBdLCBzICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNjYWxlKCBzICkgewoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA5OyBpICsrICkgewoKCQkJdGhpcy5jb2VmZmljaWVudHNbIGkgXS5tdWx0aXBseVNjYWxhciggcyApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglsZXJwKCBzaCwgYWxwaGEgKSB7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IDk7IGkgKysgKSB7CgoJCQl0aGlzLmNvZWZmaWNpZW50c1sgaSBdLmxlcnAoIHNoLmNvZWZmaWNpZW50c1sgaSBdLCBhbHBoYSApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgllcXVhbHMoIHNoICkgewoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA5OyBpICsrICkgewoKCQkJaWYgKCAhIHRoaXMuY29lZmZpY2llbnRzWyBpIF0uZXF1YWxzKCBzaC5jb2VmZmljaWVudHNbIGkgXSApICkgewoKCQkJCXJldHVybiBmYWxzZTsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gdHJ1ZTsKCgl9CgoJY29weSggc2ggKSB7CgoJCXJldHVybiB0aGlzLnNldCggc2guY29lZmZpY2llbnRzICk7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IHRoaXMuY29uc3RydWN0b3IoKS5jb3B5KCB0aGlzICk7CgoJfQoKCWZyb21BcnJheSggYXJyYXksIG9mZnNldCA9IDAgKSB7CgoJCWNvbnN0IGNvZWZmaWNpZW50cyA9IHRoaXMuY29lZmZpY2llbnRzOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA5OyBpICsrICkgewoKCQkJY29lZmZpY2llbnRzWyBpIF0uZnJvbUFycmF5KCBhcnJheSwgb2Zmc2V0ICsgKCBpICogMyApICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvQXJyYXkoIGFycmF5ID0gW10sIG9mZnNldCA9IDAgKSB7CgoJCWNvbnN0IGNvZWZmaWNpZW50cyA9IHRoaXMuY29lZmZpY2llbnRzOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCA5OyBpICsrICkgewoKCQkJY29lZmZpY2llbnRzWyBpIF0udG9BcnJheSggYXJyYXksIG9mZnNldCArICggaSAqIDMgKSApOwoKCQl9CgoJCXJldHVybiBhcnJheTsKCgl9CgoJLy8gZXZhbHVhdGUgdGhlIGJhc2lzIGZ1bmN0aW9ucwoJLy8gc2hCYXNpcyBpcyBhbiBBcnJheVsgOSBdCglzdGF0aWMgZ2V0QmFzaXNBdCggbm9ybWFsLCBzaEJhc2lzICkgewoKCQkvLyBub3JtYWwgaXMgYXNzdW1lZCB0byBiZSB1bml0IGxlbmd0aAoKCQljb25zdCB4ID0gbm9ybWFsLngsIHkgPSBub3JtYWwueSwgeiA9IG5vcm1hbC56OwoKCQkvLyBiYW5kIDAKCQlzaEJhc2lzWyAwIF0gPSAwLjI4MjA5NTsKCgkJLy8gYmFuZCAxCgkJc2hCYXNpc1sgMSBdID0gMC40ODg2MDMgKiB5OwoJCXNoQmFzaXNbIDIgXSA9IDAuNDg4NjAzICogejsKCQlzaEJhc2lzWyAzIF0gPSAwLjQ4ODYwMyAqIHg7CgoJCS8vIGJhbmQgMgoJCXNoQmFzaXNbIDQgXSA9IDEuMDkyNTQ4ICogeCAqIHk7CgkJc2hCYXNpc1sgNSBdID0gMS4wOTI1NDggKiB5ICogejsKCQlzaEJhc2lzWyA2IF0gPSAwLjMxNTM5MiAqICggMyAqIHogKiB6IC0gMSApOwoJCXNoQmFzaXNbIDcgXSA9IDEuMDkyNTQ4ICogeCAqIHo7CgkJc2hCYXNpc1sgOCBdID0gMC41NDYyNzQgKiAoIHggKiB4IC0geSAqIHkgKTsKCgl9Cgp9CgpjbGFzcyBMaWdodFByb2JlIGV4dGVuZHMgTGlnaHQgewoKCWNvbnN0cnVjdG9yKCBzaCA9IG5ldyBTcGhlcmljYWxIYXJtb25pY3MzKCksIGludGVuc2l0eSA9IDEgKSB7CgoJCXN1cGVyKCB1bmRlZmluZWQsIGludGVuc2l0eSApOwoKCQl0aGlzLmlzTGlnaHRQcm9iZSA9IHRydWU7CgoJCXRoaXMuc2ggPSBzaDsKCgl9CgoJY29weSggc291cmNlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UgKTsKCgkJdGhpcy5zaC5jb3B5KCBzb3VyY2Uuc2ggKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWZyb21KU09OKCBqc29uICkgewoKCQl0aGlzLmludGVuc2l0eSA9IGpzb24uaW50ZW5zaXR5OyAvLyBUT0RPOiBNb3ZlIHRoaXMgYml0IHRvIExpZ2h0LmZyb21KU09OKCk7CgkJdGhpcy5zaC5mcm9tQXJyYXkoIGpzb24uc2ggKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTiggbWV0YSApIHsKCgkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTiggbWV0YSApOwoKCQlkYXRhLm9iamVjdC5zaCA9IHRoaXMuc2gudG9BcnJheSgpOwoKCQlyZXR1cm4gZGF0YTsKCgl9Cgp9CgpjbGFzcyBNYXRlcmlhbExvYWRlciBleHRlbmRzIExvYWRlciB7CgoJY29uc3RydWN0b3IoIG1hbmFnZXIgKSB7CgoJCXN1cGVyKCBtYW5hZ2VyICk7CgkJdGhpcy50ZXh0dXJlcyA9IHt9OwoKCX0KCglsb2FkKCB1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciApIHsKCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQljb25zdCBsb2FkZXIgPSBuZXcgRmlsZUxvYWRlciggc2NvcGUubWFuYWdlciApOwoJCWxvYWRlci5zZXRQYXRoKCBzY29wZS5wYXRoICk7CgkJbG9hZGVyLnNldFJlcXVlc3RIZWFkZXIoIHNjb3BlLnJlcXVlc3RIZWFkZXIgKTsKCQlsb2FkZXIuc2V0V2l0aENyZWRlbnRpYWxzKCBzY29wZS53aXRoQ3JlZGVudGlhbHMgKTsKCQlsb2FkZXIubG9hZCggdXJsLCBmdW5jdGlvbiAoIHRleHQgKSB7CgoJCQl0cnkgewoKCQkJCW9uTG9hZCggc2NvcGUucGFyc2UoIEpTT04ucGFyc2UoIHRleHQgKSApICk7CgoJCQl9IGNhdGNoICggZSApIHsKCgkJCQlpZiAoIG9uRXJyb3IgKSB7CgoJCQkJCW9uRXJyb3IoIGUgKTsKCgkJCQl9IGVsc2UgewoKCQkJCQljb25zb2xlLmVycm9yKCBlICk7CgoJCQkJfQoKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVycm9yKCB1cmwgKTsKCgkJCX0KCgkJfSwgb25Qcm9ncmVzcywgb25FcnJvciApOwoKCX0KCglwYXJzZSgganNvbiApIHsKCgkJY29uc3QgdGV4dHVyZXMgPSB0aGlzLnRleHR1cmVzOwoKCQlmdW5jdGlvbiBnZXRUZXh0dXJlKCBuYW1lICkgewoKCQkJaWYgKCB0ZXh0dXJlc1sgbmFtZSBdID09PSB1bmRlZmluZWQgKSB7CgoJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuTWF0ZXJpYWxMb2FkZXI6IFVuZGVmaW5lZCB0ZXh0dXJlJywgbmFtZSApOwoKCQkJfQoKCQkJcmV0dXJuIHRleHR1cmVzWyBuYW1lIF07CgoJCX0KCgkJY29uc3QgbWF0ZXJpYWwgPSBNYXRlcmlhbExvYWRlci5jcmVhdGVNYXRlcmlhbEZyb21UeXBlKCBqc29uLnR5cGUgKTsKCgkJaWYgKCBqc29uLnV1aWQgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnV1aWQgPSBqc29uLnV1aWQ7CgkJaWYgKCBqc29uLm5hbWUgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLm5hbWUgPSBqc29uLm5hbWU7CgkJaWYgKCBqc29uLmNvbG9yICE9PSB1bmRlZmluZWQgJiYgbWF0ZXJpYWwuY29sb3IgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmNvbG9yLnNldEhleCgganNvbi5jb2xvciApOwoJCWlmICgganNvbi5yb3VnaG5lc3MgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnJvdWdobmVzcyA9IGpzb24ucm91Z2huZXNzOwoJCWlmICgganNvbi5tZXRhbG5lc3MgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLm1ldGFsbmVzcyA9IGpzb24ubWV0YWxuZXNzOwoJCWlmICgganNvbi5zaGVlbiAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuc2hlZW4gPSBqc29uLnNoZWVuOwoJCWlmICgganNvbi5zaGVlbkNvbG9yICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5zaGVlbkNvbG9yID0gbmV3IENvbG9yKCkuc2V0SGV4KCBqc29uLnNoZWVuQ29sb3IgKTsKCQlpZiAoIGpzb24uc2hlZW5Sb3VnaG5lc3MgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnNoZWVuUm91Z2huZXNzID0ganNvbi5zaGVlblJvdWdobmVzczsKCQlpZiAoIGpzb24uZW1pc3NpdmUgIT09IHVuZGVmaW5lZCAmJiBtYXRlcmlhbC5lbWlzc2l2ZSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZW1pc3NpdmUuc2V0SGV4KCBqc29uLmVtaXNzaXZlICk7CgkJaWYgKCBqc29uLnNwZWN1bGFyICE9PSB1bmRlZmluZWQgJiYgbWF0ZXJpYWwuc3BlY3VsYXIgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnNwZWN1bGFyLnNldEhleCgganNvbi5zcGVjdWxhciApOwoJCWlmICgganNvbi5zcGVjdWxhckludGVuc2l0eSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuc3BlY3VsYXJJbnRlbnNpdHkgPSBqc29uLnNwZWN1bGFySW50ZW5zaXR5OwoJCWlmICgganNvbi5zcGVjdWxhckNvbG9yICE9PSB1bmRlZmluZWQgJiYgbWF0ZXJpYWwuc3BlY3VsYXJDb2xvciAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuc3BlY3VsYXJDb2xvci5zZXRIZXgoIGpzb24uc3BlY3VsYXJDb2xvciApOwoJCWlmICgganNvbi5zaGluaW5lc3MgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnNoaW5pbmVzcyA9IGpzb24uc2hpbmluZXNzOwoJCWlmICgganNvbi5jbGVhcmNvYXQgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmNsZWFyY29hdCA9IGpzb24uY2xlYXJjb2F0OwoJCWlmICgganNvbi5jbGVhcmNvYXRSb3VnaG5lc3MgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzcyA9IGpzb24uY2xlYXJjb2F0Um91Z2huZXNzOwoJCWlmICgganNvbi5pcmlkZXNjZW5jZSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuaXJpZGVzY2VuY2UgPSBqc29uLmlyaWRlc2NlbmNlOwoJCWlmICgganNvbi5pcmlkZXNjZW5jZUlPUiAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuaXJpZGVzY2VuY2VJT1IgPSBqc29uLmlyaWRlc2NlbmNlSU9SOwoJCWlmICgganNvbi5pcmlkZXNjZW5jZVRoaWNrbmVzc1JhbmdlICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5pcmlkZXNjZW5jZVRoaWNrbmVzc1JhbmdlID0ganNvbi5pcmlkZXNjZW5jZVRoaWNrbmVzc1JhbmdlOwoJCWlmICgganNvbi50cmFuc21pc3Npb24gIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnRyYW5zbWlzc2lvbiA9IGpzb24udHJhbnNtaXNzaW9uOwoJCWlmICgganNvbi50aGlja25lc3MgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnRoaWNrbmVzcyA9IGpzb24udGhpY2tuZXNzOwoJCWlmICgganNvbi5hdHRlbnVhdGlvbkRpc3RhbmNlICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5hdHRlbnVhdGlvbkRpc3RhbmNlID0ganNvbi5hdHRlbnVhdGlvbkRpc3RhbmNlOwoJCWlmICgganNvbi5hdHRlbnVhdGlvbkNvbG9yICE9PSB1bmRlZmluZWQgJiYgbWF0ZXJpYWwuYXR0ZW51YXRpb25Db2xvciAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuYXR0ZW51YXRpb25Db2xvci5zZXRIZXgoIGpzb24uYXR0ZW51YXRpb25Db2xvciApOwoJCWlmICgganNvbi5hbmlzb3Ryb3B5ICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5hbmlzb3Ryb3B5ID0ganNvbi5hbmlzb3Ryb3B5OwoJCWlmICgganNvbi5hbmlzb3Ryb3B5Um90YXRpb24gIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmFuaXNvdHJvcHlSb3RhdGlvbiA9IGpzb24uYW5pc290cm9weVJvdGF0aW9uOwoJCWlmICgganNvbi5mb2cgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmZvZyA9IGpzb24uZm9nOwoJCWlmICgganNvbi5mbGF0U2hhZGluZyAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZmxhdFNoYWRpbmcgPSBqc29uLmZsYXRTaGFkaW5nOwoJCWlmICgganNvbi5ibGVuZGluZyAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuYmxlbmRpbmcgPSBqc29uLmJsZW5kaW5nOwoJCWlmICgganNvbi5jb21iaW5lICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5jb21iaW5lID0ganNvbi5jb21iaW5lOwoJCWlmICgganNvbi5zaWRlICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5zaWRlID0ganNvbi5zaWRlOwoJCWlmICgganNvbi5zaGFkb3dTaWRlICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5zaGFkb3dTaWRlID0ganNvbi5zaGFkb3dTaWRlOwoJCWlmICgganNvbi5vcGFjaXR5ICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5vcGFjaXR5ID0ganNvbi5vcGFjaXR5OwoJCWlmICgganNvbi50cmFuc3BhcmVudCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwudHJhbnNwYXJlbnQgPSBqc29uLnRyYW5zcGFyZW50OwoJCWlmICgganNvbi5hbHBoYVRlc3QgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmFscGhhVGVzdCA9IGpzb24uYWxwaGFUZXN0OwoJCWlmICgganNvbi5hbHBoYUhhc2ggIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmFscGhhSGFzaCA9IGpzb24uYWxwaGFIYXNoOwoJCWlmICgganNvbi5kZXB0aFRlc3QgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmRlcHRoVGVzdCA9IGpzb24uZGVwdGhUZXN0OwoJCWlmICgganNvbi5kZXB0aFdyaXRlICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5kZXB0aFdyaXRlID0ganNvbi5kZXB0aFdyaXRlOwoJCWlmICgganNvbi5jb2xvcldyaXRlICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5jb2xvcldyaXRlID0ganNvbi5jb2xvcldyaXRlOwoKCQlpZiAoIGpzb24uc3RlbmNpbFdyaXRlICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5zdGVuY2lsV3JpdGUgPSBqc29uLnN0ZW5jaWxXcml0ZTsKCQlpZiAoIGpzb24uc3RlbmNpbFdyaXRlTWFzayAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuc3RlbmNpbFdyaXRlTWFzayA9IGpzb24uc3RlbmNpbFdyaXRlTWFzazsKCQlpZiAoIGpzb24uc3RlbmNpbEZ1bmMgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnN0ZW5jaWxGdW5jID0ganNvbi5zdGVuY2lsRnVuYzsKCQlpZiAoIGpzb24uc3RlbmNpbFJlZiAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuc3RlbmNpbFJlZiA9IGpzb24uc3RlbmNpbFJlZjsKCQlpZiAoIGpzb24uc3RlbmNpbEZ1bmNNYXNrICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5zdGVuY2lsRnVuY01hc2sgPSBqc29uLnN0ZW5jaWxGdW5jTWFzazsKCQlpZiAoIGpzb24uc3RlbmNpbEZhaWwgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnN0ZW5jaWxGYWlsID0ganNvbi5zdGVuY2lsRmFpbDsKCQlpZiAoIGpzb24uc3RlbmNpbFpGYWlsICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5zdGVuY2lsWkZhaWwgPSBqc29uLnN0ZW5jaWxaRmFpbDsKCQlpZiAoIGpzb24uc3RlbmNpbFpQYXNzICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5zdGVuY2lsWlBhc3MgPSBqc29uLnN0ZW5jaWxaUGFzczsKCgkJaWYgKCBqc29uLndpcmVmcmFtZSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwud2lyZWZyYW1lID0ganNvbi53aXJlZnJhbWU7CgkJaWYgKCBqc29uLndpcmVmcmFtZUxpbmV3aWR0aCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwud2lyZWZyYW1lTGluZXdpZHRoID0ganNvbi53aXJlZnJhbWVMaW5ld2lkdGg7CgkJaWYgKCBqc29uLndpcmVmcmFtZUxpbmVjYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLndpcmVmcmFtZUxpbmVjYXAgPSBqc29uLndpcmVmcmFtZUxpbmVjYXA7CgkJaWYgKCBqc29uLndpcmVmcmFtZUxpbmVqb2luICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC53aXJlZnJhbWVMaW5lam9pbiA9IGpzb24ud2lyZWZyYW1lTGluZWpvaW47CgoJCWlmICgganNvbi5yb3RhdGlvbiAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwucm90YXRpb24gPSBqc29uLnJvdGF0aW9uOwoKCQlpZiAoIGpzb24ubGluZXdpZHRoICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5saW5ld2lkdGggPSBqc29uLmxpbmV3aWR0aDsKCQlpZiAoIGpzb24uZGFzaFNpemUgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmRhc2hTaXplID0ganNvbi5kYXNoU2l6ZTsKCQlpZiAoIGpzb24uZ2FwU2l6ZSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZ2FwU2l6ZSA9IGpzb24uZ2FwU2l6ZTsKCQlpZiAoIGpzb24uc2NhbGUgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnNjYWxlID0ganNvbi5zY2FsZTsKCgkJaWYgKCBqc29uLnBvbHlnb25PZmZzZXQgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnBvbHlnb25PZmZzZXQgPSBqc29uLnBvbHlnb25PZmZzZXQ7CgkJaWYgKCBqc29uLnBvbHlnb25PZmZzZXRGYWN0b3IgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnBvbHlnb25PZmZzZXRGYWN0b3IgPSBqc29uLnBvbHlnb25PZmZzZXRGYWN0b3I7CgkJaWYgKCBqc29uLnBvbHlnb25PZmZzZXRVbml0cyAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwucG9seWdvbk9mZnNldFVuaXRzID0ganNvbi5wb2x5Z29uT2Zmc2V0VW5pdHM7CgoJCWlmICgganNvbi5kaXRoZXJpbmcgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmRpdGhlcmluZyA9IGpzb24uZGl0aGVyaW5nOwoKCQlpZiAoIGpzb24uYWxwaGFUb0NvdmVyYWdlICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5hbHBoYVRvQ292ZXJhZ2UgPSBqc29uLmFscGhhVG9Db3ZlcmFnZTsKCQlpZiAoIGpzb24ucHJlbXVsdGlwbGllZEFscGhhICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5wcmVtdWx0aXBsaWVkQWxwaGEgPSBqc29uLnByZW11bHRpcGxpZWRBbHBoYTsKCQlpZiAoIGpzb24uZm9yY2VTaW5nbGVQYXNzICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5mb3JjZVNpbmdsZVBhc3MgPSBqc29uLmZvcmNlU2luZ2xlUGFzczsKCgkJaWYgKCBqc29uLnZpc2libGUgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnZpc2libGUgPSBqc29uLnZpc2libGU7CgoJCWlmICgganNvbi50b25lTWFwcGVkICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC50b25lTWFwcGVkID0ganNvbi50b25lTWFwcGVkOwoKCQlpZiAoIGpzb24udXNlckRhdGEgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnVzZXJEYXRhID0ganNvbi51c2VyRGF0YTsKCgkJaWYgKCBqc29uLnZlcnRleENvbG9ycyAhPT0gdW5kZWZpbmVkICkgewoKCQkJaWYgKCB0eXBlb2YganNvbi52ZXJ0ZXhDb2xvcnMgPT09ICdudW1iZXInICkgewoKCQkJCW1hdGVyaWFsLnZlcnRleENvbG9ycyA9ICgganNvbi52ZXJ0ZXhDb2xvcnMgPiAwICkgPyB0cnVlIDogZmFsc2U7CgoJCQl9IGVsc2UgewoKCQkJCW1hdGVyaWFsLnZlcnRleENvbG9ycyA9IGpzb24udmVydGV4Q29sb3JzOwoKCQkJfQoKCQl9CgoJCS8vIFNoYWRlciBNYXRlcmlhbAoKCQlpZiAoIGpzb24udW5pZm9ybXMgIT09IHVuZGVmaW5lZCApIHsKCgkJCWZvciAoIGNvbnN0IG5hbWUgaW4ganNvbi51bmlmb3JtcyApIHsKCgkJCQljb25zdCB1bmlmb3JtID0ganNvbi51bmlmb3Jtc1sgbmFtZSBdOwoKCQkJCW1hdGVyaWFsLnVuaWZvcm1zWyBuYW1lIF0gPSB7fTsKCgkJCQlzd2l0Y2ggKCB1bmlmb3JtLnR5cGUgKSB7CgoJCQkJCWNhc2UgJ3QnOgoJCQkJCQltYXRlcmlhbC51bmlmb3Jtc1sgbmFtZSBdLnZhbHVlID0gZ2V0VGV4dHVyZSggdW5pZm9ybS52YWx1ZSApOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSAnYyc6CgkJCQkJCW1hdGVyaWFsLnVuaWZvcm1zWyBuYW1lIF0udmFsdWUgPSBuZXcgQ29sb3IoKS5zZXRIZXgoIHVuaWZvcm0udmFsdWUgKTsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgJ3YyJzoKCQkJCQkJbWF0ZXJpYWwudW5pZm9ybXNbIG5hbWUgXS52YWx1ZSA9IG5ldyBWZWN0b3IyKCkuZnJvbUFycmF5KCB1bmlmb3JtLnZhbHVlICk7CgkJCQkJCWJyZWFrOwoKCQkJCQljYXNlICd2Myc6CgkJCQkJCW1hdGVyaWFsLnVuaWZvcm1zWyBuYW1lIF0udmFsdWUgPSBuZXcgVmVjdG9yMygpLmZyb21BcnJheSggdW5pZm9ybS52YWx1ZSApOwoJCQkJCQlicmVhazsKCgkJCQkJY2FzZSAndjQnOgoJCQkJCQltYXRlcmlhbC51bmlmb3Jtc1sgbmFtZSBdLnZhbHVlID0gbmV3IFZlY3RvcjQoKS5mcm9tQXJyYXkoIHVuaWZvcm0udmFsdWUgKTsKCQkJCQkJYnJlYWs7CgoJCQkJCWNhc2UgJ20zJzoKCQkJCQkJbWF0ZXJpYWwudW5pZm9ybXNbIG5hbWUgXS52YWx1ZSA9IG5ldyBNYXRyaXgzKCkuZnJvbUFycmF5KCB1bmlmb3JtLnZhbHVlICk7CgkJCQkJCWJyZWFrOwoKCQkJCQljYXNlICdtNCc6CgkJCQkJCW1hdGVyaWFsLnVuaWZvcm1zWyBuYW1lIF0udmFsdWUgPSBuZXcgTWF0cml4NCgpLmZyb21BcnJheSggdW5pZm9ybS52YWx1ZSApOwoJCQkJCQlicmVhazsKCgkJCQkJZGVmYXVsdDoKCQkJCQkJbWF0ZXJpYWwudW5pZm9ybXNbIG5hbWUgXS52YWx1ZSA9IHVuaWZvcm0udmFsdWU7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCWlmICgganNvbi5kZWZpbmVzICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5kZWZpbmVzID0ganNvbi5kZWZpbmVzOwoJCWlmICgganNvbi52ZXJ0ZXhTaGFkZXIgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnZlcnRleFNoYWRlciA9IGpzb24udmVydGV4U2hhZGVyOwoJCWlmICgganNvbi5mcmFnbWVudFNoYWRlciAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZnJhZ21lbnRTaGFkZXIgPSBqc29uLmZyYWdtZW50U2hhZGVyOwoJCWlmICgganNvbi5nbHNsVmVyc2lvbiAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZ2xzbFZlcnNpb24gPSBqc29uLmdsc2xWZXJzaW9uOwoKCQlpZiAoIGpzb24uZXh0ZW5zaW9ucyAhPT0gdW5kZWZpbmVkICkgewoKCQkJZm9yICggY29uc3Qga2V5IGluIGpzb24uZXh0ZW5zaW9ucyApIHsKCgkJCQltYXRlcmlhbC5leHRlbnNpb25zWyBrZXkgXSA9IGpzb24uZXh0ZW5zaW9uc1sga2V5IF07CgoJCQl9CgoJCX0KCgkJaWYgKCBqc29uLmxpZ2h0cyAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwubGlnaHRzID0ganNvbi5saWdodHM7CgkJaWYgKCBqc29uLmNsaXBwaW5nICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5jbGlwcGluZyA9IGpzb24uY2xpcHBpbmc7CgoJCS8vIGZvciBQb2ludHNNYXRlcmlhbAoKCQlpZiAoIGpzb24uc2l6ZSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuc2l6ZSA9IGpzb24uc2l6ZTsKCQlpZiAoIGpzb24uc2l6ZUF0dGVudWF0aW9uICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5zaXplQXR0ZW51YXRpb24gPSBqc29uLnNpemVBdHRlbnVhdGlvbjsKCgkJLy8gbWFwcwoKCQlpZiAoIGpzb24ubWFwICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5tYXAgPSBnZXRUZXh0dXJlKCBqc29uLm1hcCApOwoJCWlmICgganNvbi5tYXRjYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLm1hdGNhcCA9IGdldFRleHR1cmUoIGpzb24ubWF0Y2FwICk7CgoJCWlmICgganNvbi5hbHBoYU1hcCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuYWxwaGFNYXAgPSBnZXRUZXh0dXJlKCBqc29uLmFscGhhTWFwICk7CgoJCWlmICgganNvbi5idW1wTWFwICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5idW1wTWFwID0gZ2V0VGV4dHVyZSgganNvbi5idW1wTWFwICk7CgkJaWYgKCBqc29uLmJ1bXBTY2FsZSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuYnVtcFNjYWxlID0ganNvbi5idW1wU2NhbGU7CgoJCWlmICgganNvbi5ub3JtYWxNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLm5vcm1hbE1hcCA9IGdldFRleHR1cmUoIGpzb24ubm9ybWFsTWFwICk7CgkJaWYgKCBqc29uLm5vcm1hbE1hcFR5cGUgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLm5vcm1hbE1hcFR5cGUgPSBqc29uLm5vcm1hbE1hcFR5cGU7CgkJaWYgKCBqc29uLm5vcm1hbFNjYWxlICE9PSB1bmRlZmluZWQgKSB7CgoJCQlsZXQgbm9ybWFsU2NhbGUgPSBqc29uLm5vcm1hbFNjYWxlOwoKCQkJaWYgKCBBcnJheS5pc0FycmF5KCBub3JtYWxTY2FsZSApID09PSBmYWxzZSApIHsKCgkJCQkvLyBCbGVuZGVyIGV4cG9ydGVyIHVzZWQgdG8gZXhwb3J0IGEgc2NhbGFyLiBTZWUgIzc0NTkKCgkJCQlub3JtYWxTY2FsZSA9IFsgbm9ybWFsU2NhbGUsIG5vcm1hbFNjYWxlIF07CgoJCQl9CgoJCQltYXRlcmlhbC5ub3JtYWxTY2FsZSA9IG5ldyBWZWN0b3IyKCkuZnJvbUFycmF5KCBub3JtYWxTY2FsZSApOwoKCQl9CgoJCWlmICgganNvbi5kaXNwbGFjZW1lbnRNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmRpc3BsYWNlbWVudE1hcCA9IGdldFRleHR1cmUoIGpzb24uZGlzcGxhY2VtZW50TWFwICk7CgkJaWYgKCBqc29uLmRpc3BsYWNlbWVudFNjYWxlICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5kaXNwbGFjZW1lbnRTY2FsZSA9IGpzb24uZGlzcGxhY2VtZW50U2NhbGU7CgkJaWYgKCBqc29uLmRpc3BsYWNlbWVudEJpYXMgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmRpc3BsYWNlbWVudEJpYXMgPSBqc29uLmRpc3BsYWNlbWVudEJpYXM7CgoJCWlmICgganNvbi5yb3VnaG5lc3NNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnJvdWdobmVzc01hcCA9IGdldFRleHR1cmUoIGpzb24ucm91Z2huZXNzTWFwICk7CgkJaWYgKCBqc29uLm1ldGFsbmVzc01hcCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwubWV0YWxuZXNzTWFwID0gZ2V0VGV4dHVyZSgganNvbi5tZXRhbG5lc3NNYXAgKTsKCgkJaWYgKCBqc29uLmVtaXNzaXZlTWFwICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5lbWlzc2l2ZU1hcCA9IGdldFRleHR1cmUoIGpzb24uZW1pc3NpdmVNYXAgKTsKCQlpZiAoIGpzb24uZW1pc3NpdmVJbnRlbnNpdHkgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmVtaXNzaXZlSW50ZW5zaXR5ID0ganNvbi5lbWlzc2l2ZUludGVuc2l0eTsKCgkJaWYgKCBqc29uLnNwZWN1bGFyTWFwICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5zcGVjdWxhck1hcCA9IGdldFRleHR1cmUoIGpzb24uc3BlY3VsYXJNYXAgKTsKCQlpZiAoIGpzb24uc3BlY3VsYXJJbnRlbnNpdHlNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnNwZWN1bGFySW50ZW5zaXR5TWFwID0gZ2V0VGV4dHVyZSgganNvbi5zcGVjdWxhckludGVuc2l0eU1hcCApOwoJCWlmICgganNvbi5zcGVjdWxhckNvbG9yTWFwICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5zcGVjdWxhckNvbG9yTWFwID0gZ2V0VGV4dHVyZSgganNvbi5zcGVjdWxhckNvbG9yTWFwICk7CgoJCWlmICgganNvbi5lbnZNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmVudk1hcCA9IGdldFRleHR1cmUoIGpzb24uZW52TWFwICk7CgkJaWYgKCBqc29uLmVudk1hcEludGVuc2l0eSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuZW52TWFwSW50ZW5zaXR5ID0ganNvbi5lbnZNYXBJbnRlbnNpdHk7CgoJCWlmICgganNvbi5yZWZsZWN0aXZpdHkgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnJlZmxlY3Rpdml0eSA9IGpzb24ucmVmbGVjdGl2aXR5OwoJCWlmICgganNvbi5yZWZyYWN0aW9uUmF0aW8gIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnJlZnJhY3Rpb25SYXRpbyA9IGpzb24ucmVmcmFjdGlvblJhdGlvOwoKCQlpZiAoIGpzb24ubGlnaHRNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmxpZ2h0TWFwID0gZ2V0VGV4dHVyZSgganNvbi5saWdodE1hcCApOwoJCWlmICgganNvbi5saWdodE1hcEludGVuc2l0eSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwubGlnaHRNYXBJbnRlbnNpdHkgPSBqc29uLmxpZ2h0TWFwSW50ZW5zaXR5OwoKCQlpZiAoIGpzb24uYW9NYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmFvTWFwID0gZ2V0VGV4dHVyZSgganNvbi5hb01hcCApOwoJCWlmICgganNvbi5hb01hcEludGVuc2l0eSAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuYW9NYXBJbnRlbnNpdHkgPSBqc29uLmFvTWFwSW50ZW5zaXR5OwoKCQlpZiAoIGpzb24uZ3JhZGllbnRNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmdyYWRpZW50TWFwID0gZ2V0VGV4dHVyZSgganNvbi5ncmFkaWVudE1hcCApOwoKCQlpZiAoIGpzb24uY2xlYXJjb2F0TWFwICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5jbGVhcmNvYXRNYXAgPSBnZXRUZXh0dXJlKCBqc29uLmNsZWFyY29hdE1hcCApOwoJCWlmICgganNvbi5jbGVhcmNvYXRSb3VnaG5lc3NNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmNsZWFyY29hdFJvdWdobmVzc01hcCA9IGdldFRleHR1cmUoIGpzb24uY2xlYXJjb2F0Um91Z2huZXNzTWFwICk7CgkJaWYgKCBqc29uLmNsZWFyY29hdE5vcm1hbE1hcCAhPT0gdW5kZWZpbmVkICkgbWF0ZXJpYWwuY2xlYXJjb2F0Tm9ybWFsTWFwID0gZ2V0VGV4dHVyZSgganNvbi5jbGVhcmNvYXROb3JtYWxNYXAgKTsKCQlpZiAoIGpzb24uY2xlYXJjb2F0Tm9ybWFsU2NhbGUgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmNsZWFyY29hdE5vcm1hbFNjYWxlID0gbmV3IFZlY3RvcjIoKS5mcm9tQXJyYXkoIGpzb24uY2xlYXJjb2F0Tm9ybWFsU2NhbGUgKTsKCgkJaWYgKCBqc29uLmlyaWRlc2NlbmNlTWFwICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5pcmlkZXNjZW5jZU1hcCA9IGdldFRleHR1cmUoIGpzb24uaXJpZGVzY2VuY2VNYXAgKTsKCQlpZiAoIGpzb24uaXJpZGVzY2VuY2VUaGlja25lc3NNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLmlyaWRlc2NlbmNlVGhpY2tuZXNzTWFwID0gZ2V0VGV4dHVyZSgganNvbi5pcmlkZXNjZW5jZVRoaWNrbmVzc01hcCApOwoKCQlpZiAoIGpzb24udHJhbnNtaXNzaW9uTWFwICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC50cmFuc21pc3Npb25NYXAgPSBnZXRUZXh0dXJlKCBqc29uLnRyYW5zbWlzc2lvbk1hcCApOwoJCWlmICgganNvbi50aGlja25lc3NNYXAgIT09IHVuZGVmaW5lZCApIG1hdGVyaWFsLnRoaWNrbmVzc01hcCA9IGdldFRleHR1cmUoIGpzb24udGhpY2tuZXNzTWFwICk7CgoJCWlmICgganNvbi5hbmlzb3Ryb3B5TWFwICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5hbmlzb3Ryb3B5TWFwID0gZ2V0VGV4dHVyZSgganNvbi5hbmlzb3Ryb3B5TWFwICk7CgoJCWlmICgganNvbi5zaGVlbkNvbG9yTWFwICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5zaGVlbkNvbG9yTWFwID0gZ2V0VGV4dHVyZSgganNvbi5zaGVlbkNvbG9yTWFwICk7CgkJaWYgKCBqc29uLnNoZWVuUm91Z2huZXNzTWFwICE9PSB1bmRlZmluZWQgKSBtYXRlcmlhbC5zaGVlblJvdWdobmVzc01hcCA9IGdldFRleHR1cmUoIGpzb24uc2hlZW5Sb3VnaG5lc3NNYXAgKTsKCgkJcmV0dXJuIG1hdGVyaWFsOwoKCX0KCglzZXRUZXh0dXJlcyggdmFsdWUgKSB7CgoJCXRoaXMudGV4dHVyZXMgPSB2YWx1ZTsKCQlyZXR1cm4gdGhpczsKCgl9CgoJc3RhdGljIGNyZWF0ZU1hdGVyaWFsRnJvbVR5cGUoIHR5cGUgKSB7CgoJCWNvbnN0IG1hdGVyaWFsTGliID0gewoJCQlTaGFkb3dNYXRlcmlhbCwKCQkJU3ByaXRlTWF0ZXJpYWwsCgkJCVJhd1NoYWRlck1hdGVyaWFsLAoJCQlTaGFkZXJNYXRlcmlhbCwKCQkJUG9pbnRzTWF0ZXJpYWwsCgkJCU1lc2hQaHlzaWNhbE1hdGVyaWFsLAoJCQlNZXNoU3RhbmRhcmRNYXRlcmlhbCwKCQkJTWVzaFBob25nTWF0ZXJpYWwsCgkJCU1lc2hUb29uTWF0ZXJpYWwsCgkJCU1lc2hOb3JtYWxNYXRlcmlhbCwKCQkJTWVzaExhbWJlcnRNYXRlcmlhbCwKCQkJTWVzaERlcHRoTWF0ZXJpYWwsCgkJCU1lc2hEaXN0YW5jZU1hdGVyaWFsLAoJCQlNZXNoQmFzaWNNYXRlcmlhbCwKCQkJTWVzaE1hdGNhcE1hdGVyaWFsLAoJCQlMaW5lRGFzaGVkTWF0ZXJpYWwsCgkJCUxpbmVCYXNpY01hdGVyaWFsLAoJCQlNYXRlcmlhbAoJCX07CgoJCXJldHVybiBuZXcgbWF0ZXJpYWxMaWJbIHR5cGUgXSgpOwoKCX0KCn0KCmNsYXNzIExvYWRlclV0aWxzIHsKCglzdGF0aWMgZGVjb2RlVGV4dCggYXJyYXkgKSB7CgoJCWlmICggdHlwZW9mIFRleHREZWNvZGVyICE9PSAndW5kZWZpbmVkJyApIHsKCgkJCXJldHVybiBuZXcgVGV4dERlY29kZXIoKS5kZWNvZGUoIGFycmF5ICk7CgoJCX0KCgkJLy8gQXZvaWQgdGhlIFN0cmluZy5mcm9tQ2hhckNvZGUuYXBwbHkobnVsbCwgYXJyYXkpIHNob3J0Y3V0LCB3aGljaAoJCS8vIHRocm93cyBhICJtYXhpbXVtIGNhbGwgc3RhY2sgc2l6ZSBleGNlZWRlZCIgZXJyb3IgZm9yIGxhcmdlIGFycmF5cy4KCgkJbGV0IHMgPSAnJzsKCgkJZm9yICggbGV0IGkgPSAwLCBpbCA9IGFycmF5Lmxlbmd0aDsgaSA8IGlsOyBpICsrICkgewoKCQkJLy8gSW1wbGljaXRseSBhc3N1bWVzIGxpdHRsZS1lbmRpYW4uCgkJCXMgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSggYXJyYXlbIGkgXSApOwoKCQl9CgoJCXRyeSB7CgoJCQkvLyBtZXJnZXMgbXVsdGktYnl0ZSB1dGYtOCBjaGFyYWN0ZXJzLgoKCQkJcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudCggZXNjYXBlKCBzICkgKTsKCgkJfSBjYXRjaCAoIGUgKSB7IC8vIHNlZSAjMTYzNTgKCgkJCXJldHVybiBzOwoKCQl9CgoJfQoKCXN0YXRpYyBleHRyYWN0VXJsQmFzZSggdXJsICkgewoKCQljb25zdCBpbmRleCA9IHVybC5sYXN0SW5kZXhPZiggJy8nICk7CgoJCWlmICggaW5kZXggPT09IC0gMSApIHJldHVybiAnLi8nOwoKCQlyZXR1cm4gdXJsLnNsaWNlKCAwLCBpbmRleCArIDEgKTsKCgl9CgoJc3RhdGljIHJlc29sdmVVUkwoIHVybCwgcGF0aCApIHsKCgkJLy8gSW52YWxpZCBVUkwKCQlpZiAoIHR5cGVvZiB1cmwgIT09ICdzdHJpbmcnIHx8IHVybCA9PT0gJycgKSByZXR1cm4gJyc7CgoJCS8vIEhvc3QgUmVsYXRpdmUgVVJMCgkJaWYgKCAvXmh0dHBzPzpcL1wvL2kudGVzdCggcGF0aCApICYmIC9eXC8vLnRlc3QoIHVybCApICkgewoKCQkJcGF0aCA9IHBhdGgucmVwbGFjZSggLyheaHR0cHM/OlwvXC9bXlwvXSspLiovaSwgJyQxJyApOwoKCQl9CgoJCS8vIEFic29sdXRlIFVSTCBodHRwOi8vLGh0dHBzOi8vLC8vCgkJaWYgKCAvXihodHRwcz86KT9cL1wvL2kudGVzdCggdXJsICkgKSByZXR1cm4gdXJsOwoKCQkvLyBEYXRhIFVSSQoJCWlmICggL15kYXRhOi4qLC4qJC9pLnRlc3QoIHVybCApICkgcmV0dXJuIHVybDsKCgkJLy8gQmxvYiBVUkwKCQlpZiAoIC9eYmxvYjouKiQvaS50ZXN0KCB1cmwgKSApIHJldHVybiB1cmw7CgoJCS8vIFJlbGF0aXZlIFVSTAoJCXJldHVybiBwYXRoICsgdXJsOwoKCX0KCn0KCmNsYXNzIEluc3RhbmNlZEJ1ZmZlckdlb21ldHJ5IGV4dGVuZHMgQnVmZmVyR2VvbWV0cnkgewoKCWNvbnN0cnVjdG9yKCkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzSW5zdGFuY2VkQnVmZmVyR2VvbWV0cnkgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnSW5zdGFuY2VkQnVmZmVyR2VvbWV0cnknOwoJCXRoaXMuaW5zdGFuY2VDb3VudCA9IEluZmluaXR5OwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSApOwoKCQl0aGlzLmluc3RhbmNlQ291bnQgPSBzb3VyY2UuaW5zdGFuY2VDb3VudDsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvSlNPTigpIHsKCgkJY29uc3QgZGF0YSA9IHN1cGVyLnRvSlNPTigpOwoKCQlkYXRhLmluc3RhbmNlQ291bnQgPSB0aGlzLmluc3RhbmNlQ291bnQ7CgoJCWRhdGEuaXNJbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSA9IHRydWU7CgoJCXJldHVybiBkYXRhOwoKCX0KCn0KCmNsYXNzIEJ1ZmZlckdlb21ldHJ5TG9hZGVyIGV4dGVuZHMgTG9hZGVyIHsKCgljb25zdHJ1Y3RvciggbWFuYWdlciApIHsKCgkJc3VwZXIoIG1hbmFnZXIgKTsKCgl9CgoJbG9hZCggdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgoJCWNvbnN0IHNjb3BlID0gdGhpczsKCgkJY29uc3QgbG9hZGVyID0gbmV3IEZpbGVMb2FkZXIoIHNjb3BlLm1hbmFnZXIgKTsKCQlsb2FkZXIuc2V0UGF0aCggc2NvcGUucGF0aCApOwoJCWxvYWRlci5zZXRSZXF1ZXN0SGVhZGVyKCBzY29wZS5yZXF1ZXN0SGVhZGVyICk7CgkJbG9hZGVyLnNldFdpdGhDcmVkZW50aWFscyggc2NvcGUud2l0aENyZWRlbnRpYWxzICk7CgkJbG9hZGVyLmxvYWQoIHVybCwgZnVuY3Rpb24gKCB0ZXh0ICkgewoKCQkJdHJ5IHsKCgkJCQlvbkxvYWQoIHNjb3BlLnBhcnNlKCBKU09OLnBhcnNlKCB0ZXh0ICkgKSApOwoKCQkJfSBjYXRjaCAoIGUgKSB7CgoJCQkJaWYgKCBvbkVycm9yICkgewoKCQkJCQlvbkVycm9yKCBlICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJY29uc29sZS5lcnJvciggZSApOwoKCQkJCX0KCgkJCQlzY29wZS5tYW5hZ2VyLml0ZW1FcnJvciggdXJsICk7CgoJCQl9CgoJCX0sIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKTsKCgl9CgoJcGFyc2UoIGpzb24gKSB7CgoJCWNvbnN0IGludGVybGVhdmVkQnVmZmVyTWFwID0ge307CgkJY29uc3QgYXJyYXlCdWZmZXJNYXAgPSB7fTsKCgkJZnVuY3Rpb24gZ2V0SW50ZXJsZWF2ZWRCdWZmZXIoIGpzb24sIHV1aWQgKSB7CgoJCQlpZiAoIGludGVybGVhdmVkQnVmZmVyTWFwWyB1dWlkIF0gIT09IHVuZGVmaW5lZCApIHJldHVybiBpbnRlcmxlYXZlZEJ1ZmZlck1hcFsgdXVpZCBdOwoKCQkJY29uc3QgaW50ZXJsZWF2ZWRCdWZmZXJzID0ganNvbi5pbnRlcmxlYXZlZEJ1ZmZlcnM7CgkJCWNvbnN0IGludGVybGVhdmVkQnVmZmVyID0gaW50ZXJsZWF2ZWRCdWZmZXJzWyB1dWlkIF07CgoJCQljb25zdCBidWZmZXIgPSBnZXRBcnJheUJ1ZmZlcigganNvbiwgaW50ZXJsZWF2ZWRCdWZmZXIuYnVmZmVyICk7CgoJCQljb25zdCBhcnJheSA9IGdldFR5cGVkQXJyYXkoIGludGVybGVhdmVkQnVmZmVyLnR5cGUsIGJ1ZmZlciApOwoJCQljb25zdCBpYiA9IG5ldyBJbnRlcmxlYXZlZEJ1ZmZlciggYXJyYXksIGludGVybGVhdmVkQnVmZmVyLnN0cmlkZSApOwoJCQlpYi51dWlkID0gaW50ZXJsZWF2ZWRCdWZmZXIudXVpZDsKCgkJCWludGVybGVhdmVkQnVmZmVyTWFwWyB1dWlkIF0gPSBpYjsKCgkJCXJldHVybiBpYjsKCgkJfQoKCQlmdW5jdGlvbiBnZXRBcnJheUJ1ZmZlcigganNvbiwgdXVpZCApIHsKCgkJCWlmICggYXJyYXlCdWZmZXJNYXBbIHV1aWQgXSAhPT0gdW5kZWZpbmVkICkgcmV0dXJuIGFycmF5QnVmZmVyTWFwWyB1dWlkIF07CgoJCQljb25zdCBhcnJheUJ1ZmZlcnMgPSBqc29uLmFycmF5QnVmZmVyczsKCQkJY29uc3QgYXJyYXlCdWZmZXIgPSBhcnJheUJ1ZmZlcnNbIHV1aWQgXTsKCgkJCWNvbnN0IGFiID0gbmV3IFVpbnQzMkFycmF5KCBhcnJheUJ1ZmZlciApLmJ1ZmZlcjsKCgkJCWFycmF5QnVmZmVyTWFwWyB1dWlkIF0gPSBhYjsKCgkJCXJldHVybiBhYjsKCgkJfQoKCQljb25zdCBnZW9tZXRyeSA9IGpzb24uaXNJbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSA/IG5ldyBJbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSgpIDogbmV3IEJ1ZmZlckdlb21ldHJ5KCk7CgoJCWNvbnN0IGluZGV4ID0ganNvbi5kYXRhLmluZGV4OwoKCQlpZiAoIGluZGV4ICE9PSB1bmRlZmluZWQgKSB7CgoJCQljb25zdCB0eXBlZEFycmF5ID0gZ2V0VHlwZWRBcnJheSggaW5kZXgudHlwZSwgaW5kZXguYXJyYXkgKTsKCQkJZ2VvbWV0cnkuc2V0SW5kZXgoIG5ldyBCdWZmZXJBdHRyaWJ1dGUoIHR5cGVkQXJyYXksIDEgKSApOwoKCQl9CgoJCWNvbnN0IGF0dHJpYnV0ZXMgPSBqc29uLmRhdGEuYXR0cmlidXRlczsKCgkJZm9yICggY29uc3Qga2V5IGluIGF0dHJpYnV0ZXMgKSB7CgoJCQljb25zdCBhdHRyaWJ1dGUgPSBhdHRyaWJ1dGVzWyBrZXkgXTsKCQkJbGV0IGJ1ZmZlckF0dHJpYnV0ZTsKCgkJCWlmICggYXR0cmlidXRlLmlzSW50ZXJsZWF2ZWRCdWZmZXJBdHRyaWJ1dGUgKSB7CgoJCQkJY29uc3QgaW50ZXJsZWF2ZWRCdWZmZXIgPSBnZXRJbnRlcmxlYXZlZEJ1ZmZlcigganNvbi5kYXRhLCBhdHRyaWJ1dGUuZGF0YSApOwoJCQkJYnVmZmVyQXR0cmlidXRlID0gbmV3IEludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlKCBpbnRlcmxlYXZlZEJ1ZmZlciwgYXR0cmlidXRlLml0ZW1TaXplLCBhdHRyaWJ1dGUub2Zmc2V0LCBhdHRyaWJ1dGUubm9ybWFsaXplZCApOwoKCQkJfSBlbHNlIHsKCgkJCQljb25zdCB0eXBlZEFycmF5ID0gZ2V0VHlwZWRBcnJheSggYXR0cmlidXRlLnR5cGUsIGF0dHJpYnV0ZS5hcnJheSApOwoJCQkJY29uc3QgYnVmZmVyQXR0cmlidXRlQ29uc3RyID0gYXR0cmlidXRlLmlzSW5zdGFuY2VkQnVmZmVyQXR0cmlidXRlID8gSW5zdGFuY2VkQnVmZmVyQXR0cmlidXRlIDogQnVmZmVyQXR0cmlidXRlOwoJCQkJYnVmZmVyQXR0cmlidXRlID0gbmV3IGJ1ZmZlckF0dHJpYnV0ZUNvbnN0ciggdHlwZWRBcnJheSwgYXR0cmlidXRlLml0ZW1TaXplLCBhdHRyaWJ1dGUubm9ybWFsaXplZCApOwoKCQkJfQoKCQkJaWYgKCBhdHRyaWJ1dGUubmFtZSAhPT0gdW5kZWZpbmVkICkgYnVmZmVyQXR0cmlidXRlLm5hbWUgPSBhdHRyaWJ1dGUubmFtZTsKCQkJaWYgKCBhdHRyaWJ1dGUudXNhZ2UgIT09IHVuZGVmaW5lZCApIGJ1ZmZlckF0dHJpYnV0ZS5zZXRVc2FnZSggYXR0cmlidXRlLnVzYWdlICk7CgoJCQlpZiAoIGF0dHJpYnV0ZS51cGRhdGVSYW5nZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWJ1ZmZlckF0dHJpYnV0ZS51cGRhdGVSYW5nZS5vZmZzZXQgPSBhdHRyaWJ1dGUudXBkYXRlUmFuZ2Uub2Zmc2V0OwoJCQkJYnVmZmVyQXR0cmlidXRlLnVwZGF0ZVJhbmdlLmNvdW50ID0gYXR0cmlidXRlLnVwZGF0ZVJhbmdlLmNvdW50OwoKCQkJfQoKCQkJZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCBrZXksIGJ1ZmZlckF0dHJpYnV0ZSApOwoKCQl9CgoJCWNvbnN0IG1vcnBoQXR0cmlidXRlcyA9IGpzb24uZGF0YS5tb3JwaEF0dHJpYnV0ZXM7CgoJCWlmICggbW9ycGhBdHRyaWJ1dGVzICkgewoKCQkJZm9yICggY29uc3Qga2V5IGluIG1vcnBoQXR0cmlidXRlcyApIHsKCgkJCQljb25zdCBhdHRyaWJ1dGVBcnJheSA9IG1vcnBoQXR0cmlidXRlc1sga2V5IF07CgoJCQkJY29uc3QgYXJyYXkgPSBbXTsKCgkJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0gYXR0cmlidXRlQXJyYXkubGVuZ3RoOyBpIDwgaWw7IGkgKysgKSB7CgoJCQkJCWNvbnN0IGF0dHJpYnV0ZSA9IGF0dHJpYnV0ZUFycmF5WyBpIF07CgkJCQkJbGV0IGJ1ZmZlckF0dHJpYnV0ZTsKCgkJCQkJaWYgKCBhdHRyaWJ1dGUuaXNJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSApIHsKCgkJCQkJCWNvbnN0IGludGVybGVhdmVkQnVmZmVyID0gZ2V0SW50ZXJsZWF2ZWRCdWZmZXIoIGpzb24uZGF0YSwgYXR0cmlidXRlLmRhdGEgKTsKCQkJCQkJYnVmZmVyQXR0cmlidXRlID0gbmV3IEludGVybGVhdmVkQnVmZmVyQXR0cmlidXRlKCBpbnRlcmxlYXZlZEJ1ZmZlciwgYXR0cmlidXRlLml0ZW1TaXplLCBhdHRyaWJ1dGUub2Zmc2V0LCBhdHRyaWJ1dGUubm9ybWFsaXplZCApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJY29uc3QgdHlwZWRBcnJheSA9IGdldFR5cGVkQXJyYXkoIGF0dHJpYnV0ZS50eXBlLCBhdHRyaWJ1dGUuYXJyYXkgKTsKCQkJCQkJYnVmZmVyQXR0cmlidXRlID0gbmV3IEJ1ZmZlckF0dHJpYnV0ZSggdHlwZWRBcnJheSwgYXR0cmlidXRlLml0ZW1TaXplLCBhdHRyaWJ1dGUubm9ybWFsaXplZCApOwoKCQkJCQl9CgoJCQkJCWlmICggYXR0cmlidXRlLm5hbWUgIT09IHVuZGVmaW5lZCApIGJ1ZmZlckF0dHJpYnV0ZS5uYW1lID0gYXR0cmlidXRlLm5hbWU7CgkJCQkJYXJyYXkucHVzaCggYnVmZmVyQXR0cmlidXRlICk7CgoJCQkJfQoKCQkJCWdlb21ldHJ5Lm1vcnBoQXR0cmlidXRlc1sga2V5IF0gPSBhcnJheTsKCgkJCX0KCgkJfQoKCQljb25zdCBtb3JwaFRhcmdldHNSZWxhdGl2ZSA9IGpzb24uZGF0YS5tb3JwaFRhcmdldHNSZWxhdGl2ZTsKCgkJaWYgKCBtb3JwaFRhcmdldHNSZWxhdGl2ZSApIHsKCgkJCWdlb21ldHJ5Lm1vcnBoVGFyZ2V0c1JlbGF0aXZlID0gdHJ1ZTsKCgkJfQoKCQljb25zdCBncm91cHMgPSBqc29uLmRhdGEuZ3JvdXBzIHx8IGpzb24uZGF0YS5kcmF3Y2FsbHMgfHwganNvbi5kYXRhLm9mZnNldHM7CgoJCWlmICggZ3JvdXBzICE9PSB1bmRlZmluZWQgKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIG4gPSBncm91cHMubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJCWNvbnN0IGdyb3VwID0gZ3JvdXBzWyBpIF07CgoJCQkJZ2VvbWV0cnkuYWRkR3JvdXAoIGdyb3VwLnN0YXJ0LCBncm91cC5jb3VudCwgZ3JvdXAubWF0ZXJpYWxJbmRleCApOwoKCQkJfQoKCQl9CgoJCWNvbnN0IGJvdW5kaW5nU3BoZXJlID0ganNvbi5kYXRhLmJvdW5kaW5nU3BoZXJlOwoKCQlpZiAoIGJvdW5kaW5nU3BoZXJlICE9PSB1bmRlZmluZWQgKSB7CgoJCQljb25zdCBjZW50ZXIgPSBuZXcgVmVjdG9yMygpOwoKCQkJaWYgKCBib3VuZGluZ1NwaGVyZS5jZW50ZXIgIT09IHVuZGVmaW5lZCApIHsKCgkJCQljZW50ZXIuZnJvbUFycmF5KCBib3VuZGluZ1NwaGVyZS5jZW50ZXIgKTsKCgkJCX0KCgkJCWdlb21ldHJ5LmJvdW5kaW5nU3BoZXJlID0gbmV3IFNwaGVyZSggY2VudGVyLCBib3VuZGluZ1NwaGVyZS5yYWRpdXMgKTsKCgkJfQoKCQlpZiAoIGpzb24ubmFtZSApIGdlb21ldHJ5Lm5hbWUgPSBqc29uLm5hbWU7CgkJaWYgKCBqc29uLnVzZXJEYXRhICkgZ2VvbWV0cnkudXNlckRhdGEgPSBqc29uLnVzZXJEYXRhOwoKCQlyZXR1cm4gZ2VvbWV0cnk7CgoJfQoKfQoKY2xhc3MgT2JqZWN0TG9hZGVyIGV4dGVuZHMgTG9hZGVyIHsKCgljb25zdHJ1Y3RvciggbWFuYWdlciApIHsKCgkJc3VwZXIoIG1hbmFnZXIgKTsKCgl9CgoJbG9hZCggdXJsLCBvbkxvYWQsIG9uUHJvZ3Jlc3MsIG9uRXJyb3IgKSB7CgoJCWNvbnN0IHNjb3BlID0gdGhpczsKCgkJY29uc3QgcGF0aCA9ICggdGhpcy5wYXRoID09PSAnJyApID8gTG9hZGVyVXRpbHMuZXh0cmFjdFVybEJhc2UoIHVybCApIDogdGhpcy5wYXRoOwoJCXRoaXMucmVzb3VyY2VQYXRoID0gdGhpcy5yZXNvdXJjZVBhdGggfHwgcGF0aDsKCgkJY29uc3QgbG9hZGVyID0gbmV3IEZpbGVMb2FkZXIoIHRoaXMubWFuYWdlciApOwoJCWxvYWRlci5zZXRQYXRoKCB0aGlzLnBhdGggKTsKCQlsb2FkZXIuc2V0UmVxdWVzdEhlYWRlciggdGhpcy5yZXF1ZXN0SGVhZGVyICk7CgkJbG9hZGVyLnNldFdpdGhDcmVkZW50aWFscyggdGhpcy53aXRoQ3JlZGVudGlhbHMgKTsKCQlsb2FkZXIubG9hZCggdXJsLCBmdW5jdGlvbiAoIHRleHQgKSB7CgoJCQlsZXQganNvbiA9IG51bGw7CgoJCQl0cnkgewoKCQkJCWpzb24gPSBKU09OLnBhcnNlKCB0ZXh0ICk7CgoJCQl9IGNhdGNoICggZXJyb3IgKSB7CgoJCQkJaWYgKCBvbkVycm9yICE9PSB1bmRlZmluZWQgKSBvbkVycm9yKCBlcnJvciApOwoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRTpPYmplY3RMb2FkZXI6IENhblwndCBwYXJzZSAnICsgdXJsICsgJy4nLCBlcnJvci5tZXNzYWdlICk7CgoJCQkJcmV0dXJuOwoKCQkJfQoKCQkJY29uc3QgbWV0YWRhdGEgPSBqc29uLm1ldGFkYXRhOwoKCQkJaWYgKCBtZXRhZGF0YSA9PT0gdW5kZWZpbmVkIHx8IG1ldGFkYXRhLnR5cGUgPT09IHVuZGVmaW5lZCB8fCBtZXRhZGF0YS50eXBlLnRvTG93ZXJDYXNlKCkgPT09ICdnZW9tZXRyeScgKSB7CgoJCQkJaWYgKCBvbkVycm9yICE9PSB1bmRlZmluZWQgKSBvbkVycm9yKCBuZXcgRXJyb3IoICdUSFJFRS5PYmplY3RMb2FkZXI6IENhblwndCBsb2FkICcgKyB1cmwgKSApOwoKCQkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5PYmplY3RMb2FkZXI6IENhblwndCBsb2FkICcgKyB1cmwgKTsKCQkJCXJldHVybjsKCgkJCX0KCgkJCXNjb3BlLnBhcnNlKCBqc29uLCBvbkxvYWQgKTsKCgkJfSwgb25Qcm9ncmVzcywgb25FcnJvciApOwoKCX0KCglhc3luYyBsb2FkQXN5bmMoIHVybCwgb25Qcm9ncmVzcyApIHsKCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQljb25zdCBwYXRoID0gKCB0aGlzLnBhdGggPT09ICcnICkgPyBMb2FkZXJVdGlscy5leHRyYWN0VXJsQmFzZSggdXJsICkgOiB0aGlzLnBhdGg7CgkJdGhpcy5yZXNvdXJjZVBhdGggPSB0aGlzLnJlc291cmNlUGF0aCB8fCBwYXRoOwoKCQljb25zdCBsb2FkZXIgPSBuZXcgRmlsZUxvYWRlciggdGhpcy5tYW5hZ2VyICk7CgkJbG9hZGVyLnNldFBhdGgoIHRoaXMucGF0aCApOwoJCWxvYWRlci5zZXRSZXF1ZXN0SGVhZGVyKCB0aGlzLnJlcXVlc3RIZWFkZXIgKTsKCQlsb2FkZXIuc2V0V2l0aENyZWRlbnRpYWxzKCB0aGlzLndpdGhDcmVkZW50aWFscyApOwoKCQljb25zdCB0ZXh0ID0gYXdhaXQgbG9hZGVyLmxvYWRBc3luYyggdXJsLCBvblByb2dyZXNzICk7CgoJCWNvbnN0IGpzb24gPSBKU09OLnBhcnNlKCB0ZXh0ICk7CgoJCWNvbnN0IG1ldGFkYXRhID0ganNvbi5tZXRhZGF0YTsKCgkJaWYgKCBtZXRhZGF0YSA9PT0gdW5kZWZpbmVkIHx8IG1ldGFkYXRhLnR5cGUgPT09IHVuZGVmaW5lZCB8fCBtZXRhZGF0YS50eXBlLnRvTG93ZXJDYXNlKCkgPT09ICdnZW9tZXRyeScgKSB7CgoJCQl0aHJvdyBuZXcgRXJyb3IoICdUSFJFRS5PYmplY3RMb2FkZXI6IENhblwndCBsb2FkICcgKyB1cmwgKTsKCgkJfQoKCQlyZXR1cm4gYXdhaXQgc2NvcGUucGFyc2VBc3luYygganNvbiApOwoKCX0KCglwYXJzZSgganNvbiwgb25Mb2FkICkgewoKCQljb25zdCBhbmltYXRpb25zID0gdGhpcy5wYXJzZUFuaW1hdGlvbnMoIGpzb24uYW5pbWF0aW9ucyApOwoJCWNvbnN0IHNoYXBlcyA9IHRoaXMucGFyc2VTaGFwZXMoIGpzb24uc2hhcGVzICk7CgkJY29uc3QgZ2VvbWV0cmllcyA9IHRoaXMucGFyc2VHZW9tZXRyaWVzKCBqc29uLmdlb21ldHJpZXMsIHNoYXBlcyApOwoKCQljb25zdCBpbWFnZXMgPSB0aGlzLnBhcnNlSW1hZ2VzKCBqc29uLmltYWdlcywgZnVuY3Rpb24gKCkgewoKCQkJaWYgKCBvbkxvYWQgIT09IHVuZGVmaW5lZCApIG9uTG9hZCggb2JqZWN0ICk7CgoJCX0gKTsKCgkJY29uc3QgdGV4dHVyZXMgPSB0aGlzLnBhcnNlVGV4dHVyZXMoIGpzb24udGV4dHVyZXMsIGltYWdlcyApOwoJCWNvbnN0IG1hdGVyaWFscyA9IHRoaXMucGFyc2VNYXRlcmlhbHMoIGpzb24ubWF0ZXJpYWxzLCB0ZXh0dXJlcyApOwoKCQljb25zdCBvYmplY3QgPSB0aGlzLnBhcnNlT2JqZWN0KCBqc29uLm9iamVjdCwgZ2VvbWV0cmllcywgbWF0ZXJpYWxzLCB0ZXh0dXJlcywgYW5pbWF0aW9ucyApOwoJCWNvbnN0IHNrZWxldG9ucyA9IHRoaXMucGFyc2VTa2VsZXRvbnMoIGpzb24uc2tlbGV0b25zLCBvYmplY3QgKTsKCgkJdGhpcy5iaW5kU2tlbGV0b25zKCBvYmplY3QsIHNrZWxldG9ucyApOwoKCQkvLwoKCQlpZiAoIG9uTG9hZCAhPT0gdW5kZWZpbmVkICkgewoKCQkJbGV0IGhhc0ltYWdlcyA9IGZhbHNlOwoKCQkJZm9yICggY29uc3QgdXVpZCBpbiBpbWFnZXMgKSB7CgoJCQkJaWYgKCBpbWFnZXNbIHV1aWQgXS5kYXRhIGluc3RhbmNlb2YgSFRNTEltYWdlRWxlbWVudCApIHsKCgkJCQkJaGFzSW1hZ2VzID0gdHJ1ZTsKCQkJCQlicmVhazsKCgkJCQl9CgoJCQl9CgoJCQlpZiAoIGhhc0ltYWdlcyA9PT0gZmFsc2UgKSBvbkxvYWQoIG9iamVjdCApOwoKCQl9CgoJCXJldHVybiBvYmplY3Q7CgoJfQoKCWFzeW5jIHBhcnNlQXN5bmMoIGpzb24gKSB7CgoJCWNvbnN0IGFuaW1hdGlvbnMgPSB0aGlzLnBhcnNlQW5pbWF0aW9ucygganNvbi5hbmltYXRpb25zICk7CgkJY29uc3Qgc2hhcGVzID0gdGhpcy5wYXJzZVNoYXBlcygganNvbi5zaGFwZXMgKTsKCQljb25zdCBnZW9tZXRyaWVzID0gdGhpcy5wYXJzZUdlb21ldHJpZXMoIGpzb24uZ2VvbWV0cmllcywgc2hhcGVzICk7CgoJCWNvbnN0IGltYWdlcyA9IGF3YWl0IHRoaXMucGFyc2VJbWFnZXNBc3luYygganNvbi5pbWFnZXMgKTsKCgkJY29uc3QgdGV4dHVyZXMgPSB0aGlzLnBhcnNlVGV4dHVyZXMoIGpzb24udGV4dHVyZXMsIGltYWdlcyApOwoJCWNvbnN0IG1hdGVyaWFscyA9IHRoaXMucGFyc2VNYXRlcmlhbHMoIGpzb24ubWF0ZXJpYWxzLCB0ZXh0dXJlcyApOwoKCQljb25zdCBvYmplY3QgPSB0aGlzLnBhcnNlT2JqZWN0KCBqc29uLm9iamVjdCwgZ2VvbWV0cmllcywgbWF0ZXJpYWxzLCB0ZXh0dXJlcywgYW5pbWF0aW9ucyApOwoJCWNvbnN0IHNrZWxldG9ucyA9IHRoaXMucGFyc2VTa2VsZXRvbnMoIGpzb24uc2tlbGV0b25zLCBvYmplY3QgKTsKCgkJdGhpcy5iaW5kU2tlbGV0b25zKCBvYmplY3QsIHNrZWxldG9ucyApOwoKCQlyZXR1cm4gb2JqZWN0OwoKCX0KCglwYXJzZVNoYXBlcygganNvbiApIHsKCgkJY29uc3Qgc2hhcGVzID0ge307CgoJCWlmICgganNvbiAhPT0gdW5kZWZpbmVkICkgewoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0ganNvbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWNvbnN0IHNoYXBlID0gbmV3IFNoYXBlKCkuZnJvbUpTT04oIGpzb25bIGkgXSApOwoKCQkJCXNoYXBlc1sgc2hhcGUudXVpZCBdID0gc2hhcGU7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHNoYXBlczsKCgl9CgoJcGFyc2VTa2VsZXRvbnMoIGpzb24sIG9iamVjdCApIHsKCgkJY29uc3Qgc2tlbGV0b25zID0ge307CgkJY29uc3QgYm9uZXMgPSB7fTsKCgkJLy8gZ2VuZXJhdGUgYm9uZSBsb29rdXAgdGFibGUKCgkJb2JqZWN0LnRyYXZlcnNlKCBmdW5jdGlvbiAoIGNoaWxkICkgewoKCQkJaWYgKCBjaGlsZC5pc0JvbmUgKSBib25lc1sgY2hpbGQudXVpZCBdID0gY2hpbGQ7CgoJCX0gKTsKCgkJLy8gY3JlYXRlIHNrZWxldG9ucwoKCQlpZiAoIGpzb24gIT09IHVuZGVmaW5lZCApIHsKCgkJCWZvciAoIGxldCBpID0gMCwgbCA9IGpzb24ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQljb25zdCBza2VsZXRvbiA9IG5ldyBTa2VsZXRvbigpLmZyb21KU09OKCBqc29uWyBpIF0sIGJvbmVzICk7CgoJCQkJc2tlbGV0b25zWyBza2VsZXRvbi51dWlkIF0gPSBza2VsZXRvbjsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gc2tlbGV0b25zOwoKCX0KCglwYXJzZUdlb21ldHJpZXMoIGpzb24sIHNoYXBlcyApIHsKCgkJY29uc3QgZ2VvbWV0cmllcyA9IHt9OwoKCQlpZiAoIGpzb24gIT09IHVuZGVmaW5lZCApIHsKCgkJCWNvbnN0IGJ1ZmZlckdlb21ldHJ5TG9hZGVyID0gbmV3IEJ1ZmZlckdlb21ldHJ5TG9hZGVyKCk7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBqc29uLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJbGV0IGdlb21ldHJ5OwoJCQkJY29uc3QgZGF0YSA9IGpzb25bIGkgXTsKCgkJCQlzd2l0Y2ggKCBkYXRhLnR5cGUgKSB7CgoJCQkJCWNhc2UgJ0J1ZmZlckdlb21ldHJ5JzoKCQkJCQljYXNlICdJbnN0YW5jZWRCdWZmZXJHZW9tZXRyeSc6CgoJCQkJCQlnZW9tZXRyeSA9IGJ1ZmZlckdlb21ldHJ5TG9hZGVyLnBhcnNlKCBkYXRhICk7CgkJCQkJCWJyZWFrOwoKCQkJCQlkZWZhdWx0OgoKCQkJCQkJaWYgKCBkYXRhLnR5cGUgaW4gR2VvbWV0cmllcyApIHsKCgkJCQkJCQlnZW9tZXRyeSA9IEdlb21ldHJpZXNbIGRhdGEudHlwZSBdLmZyb21KU09OKCBkYXRhLCBzaGFwZXMgKTsKCgkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJY29uc29sZS53YXJuKCBgVEhSRUUuT2JqZWN0TG9hZGVyOiBVbnN1cHBvcnRlZCBnZW9tZXRyeSB0eXBlICIkeyBkYXRhLnR5cGUgfSJgICk7CgoJCQkJCQl9CgoJCQkJfQoKCQkJCWdlb21ldHJ5LnV1aWQgPSBkYXRhLnV1aWQ7CgoJCQkJaWYgKCBkYXRhLm5hbWUgIT09IHVuZGVmaW5lZCApIGdlb21ldHJ5Lm5hbWUgPSBkYXRhLm5hbWU7CgkJCQlpZiAoIGRhdGEudXNlckRhdGEgIT09IHVuZGVmaW5lZCApIGdlb21ldHJ5LnVzZXJEYXRhID0gZGF0YS51c2VyRGF0YTsKCgkJCQlnZW9tZXRyaWVzWyBkYXRhLnV1aWQgXSA9IGdlb21ldHJ5OwoKCQkJfQoKCQl9CgoJCXJldHVybiBnZW9tZXRyaWVzOwoKCX0KCglwYXJzZU1hdGVyaWFscygganNvbiwgdGV4dHVyZXMgKSB7CgoJCWNvbnN0IGNhY2hlID0ge307IC8vIE11bHRpTWF0ZXJpYWwKCQljb25zdCBtYXRlcmlhbHMgPSB7fTsKCgkJaWYgKCBqc29uICE9PSB1bmRlZmluZWQgKSB7CgoJCQljb25zdCBsb2FkZXIgPSBuZXcgTWF0ZXJpYWxMb2FkZXIoKTsKCQkJbG9hZGVyLnNldFRleHR1cmVzKCB0ZXh0dXJlcyApOwoKCQkJZm9yICggbGV0IGkgPSAwLCBsID0ganNvbi5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCWNvbnN0IGRhdGEgPSBqc29uWyBpIF07CgoJCQkJaWYgKCBjYWNoZVsgZGF0YS51dWlkIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJY2FjaGVbIGRhdGEudXVpZCBdID0gbG9hZGVyLnBhcnNlKCBkYXRhICk7CgoJCQkJfQoKCQkJCW1hdGVyaWFsc1sgZGF0YS51dWlkIF0gPSBjYWNoZVsgZGF0YS51dWlkIF07CgoJCQl9CgoJCX0KCgkJcmV0dXJuIG1hdGVyaWFsczsKCgl9CgoJcGFyc2VBbmltYXRpb25zKCBqc29uICkgewoKCQljb25zdCBhbmltYXRpb25zID0ge307CgoJCWlmICgganNvbiAhPT0gdW5kZWZpbmVkICkgewoKCQkJZm9yICggbGV0IGkgPSAwOyBpIDwganNvbi5sZW5ndGg7IGkgKysgKSB7CgoJCQkJY29uc3QgZGF0YSA9IGpzb25bIGkgXTsKCgkJCQljb25zdCBjbGlwID0gQW5pbWF0aW9uQ2xpcC5wYXJzZSggZGF0YSApOwoKCQkJCWFuaW1hdGlvbnNbIGNsaXAudXVpZCBdID0gY2xpcDsKCgkJCX0KCgkJfQoKCQlyZXR1cm4gYW5pbWF0aW9uczsKCgl9CgoJcGFyc2VJbWFnZXMoIGpzb24sIG9uTG9hZCApIHsKCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoJCWNvbnN0IGltYWdlcyA9IHt9OwoKCQlsZXQgbG9hZGVyOwoKCQlmdW5jdGlvbiBsb2FkSW1hZ2UoIHVybCApIHsKCgkJCXNjb3BlLm1hbmFnZXIuaXRlbVN0YXJ0KCB1cmwgKTsKCgkJCXJldHVybiBsb2FkZXIubG9hZCggdXJsLCBmdW5jdGlvbiAoKSB7CgoJCQkJc2NvcGUubWFuYWdlci5pdGVtRW5kKCB1cmwgKTsKCgkJCX0sIHVuZGVmaW5lZCwgZnVuY3Rpb24gKCkgewoKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVycm9yKCB1cmwgKTsKCQkJCXNjb3BlLm1hbmFnZXIuaXRlbUVuZCggdXJsICk7CgoJCQl9ICk7CgoJCX0KCgkJZnVuY3Rpb24gZGVzZXJpYWxpemVJbWFnZSggaW1hZ2UgKSB7CgoJCQlpZiAoIHR5cGVvZiBpbWFnZSA9PT0gJ3N0cmluZycgKSB7CgoJCQkJY29uc3QgdXJsID0gaW1hZ2U7CgoJCQkJY29uc3QgcGF0aCA9IC9eKFwvXC8pfChbYS16XSs6KFwvXC8pPykvaS50ZXN0KCB1cmwgKSA/IHVybCA6IHNjb3BlLnJlc291cmNlUGF0aCArIHVybDsKCgkJCQlyZXR1cm4gbG9hZEltYWdlKCBwYXRoICk7CgoJCQl9IGVsc2UgewoKCQkJCWlmICggaW1hZ2UuZGF0YSApIHsKCgkJCQkJcmV0dXJuIHsKCQkJCQkJZGF0YTogZ2V0VHlwZWRBcnJheSggaW1hZ2UudHlwZSwgaW1hZ2UuZGF0YSApLAoJCQkJCQl3aWR0aDogaW1hZ2Uud2lkdGgsCgkJCQkJCWhlaWdodDogaW1hZ2UuaGVpZ2h0CgkJCQkJfTsKCgkJCQl9IGVsc2UgewoKCQkJCQlyZXR1cm4gbnVsbDsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJaWYgKCBqc29uICE9PSB1bmRlZmluZWQgJiYganNvbi5sZW5ndGggPiAwICkgewoKCQkJY29uc3QgbWFuYWdlciA9IG5ldyBMb2FkaW5nTWFuYWdlciggb25Mb2FkICk7CgoJCQlsb2FkZXIgPSBuZXcgSW1hZ2VMb2FkZXIoIG1hbmFnZXIgKTsKCQkJbG9hZGVyLnNldENyb3NzT3JpZ2luKCB0aGlzLmNyb3NzT3JpZ2luICk7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0ganNvbi5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQljb25zdCBpbWFnZSA9IGpzb25bIGkgXTsKCQkJCWNvbnN0IHVybCA9IGltYWdlLnVybDsKCgkJCQlpZiAoIEFycmF5LmlzQXJyYXkoIHVybCApICkgewoKCQkJCQkvLyBsb2FkIGFycmF5IG9mIGltYWdlcyBlLmcgQ3ViZVRleHR1cmUKCgkJCQkJY29uc3QgaW1hZ2VBcnJheSA9IFtdOwoKCQkJCQlmb3IgKCBsZXQgaiA9IDAsIGpsID0gdXJsLmxlbmd0aDsgaiA8IGpsOyBqICsrICkgewoKCQkJCQkJY29uc3QgY3VycmVudFVybCA9IHVybFsgaiBdOwoKCQkJCQkJY29uc3QgZGVzZXJpYWxpemVkSW1hZ2UgPSBkZXNlcmlhbGl6ZUltYWdlKCBjdXJyZW50VXJsICk7CgoJCQkJCQlpZiAoIGRlc2VyaWFsaXplZEltYWdlICE9PSBudWxsICkgewoKCQkJCQkJCWlmICggZGVzZXJpYWxpemVkSW1hZ2UgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50ICkgewoKCQkJCQkJCQlpbWFnZUFycmF5LnB1c2goIGRlc2VyaWFsaXplZEltYWdlICk7CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJLy8gc3BlY2lhbCBjYXNlOiBoYW5kbGUgYXJyYXkgb2YgZGF0YSB0ZXh0dXJlcyBmb3IgY3ViZSB0ZXh0dXJlcwoKCQkJCQkJCQlpbWFnZUFycmF5LnB1c2goIG5ldyBEYXRhVGV4dHVyZSggZGVzZXJpYWxpemVkSW1hZ2UuZGF0YSwgZGVzZXJpYWxpemVkSW1hZ2Uud2lkdGgsIGRlc2VyaWFsaXplZEltYWdlLmhlaWdodCApICk7CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCWltYWdlc1sgaW1hZ2UudXVpZCBdID0gbmV3IFNvdXJjZSggaW1hZ2VBcnJheSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCS8vIGxvYWQgc2luZ2xlIGltYWdlCgoJCQkJCWNvbnN0IGRlc2VyaWFsaXplZEltYWdlID0gZGVzZXJpYWxpemVJbWFnZSggaW1hZ2UudXJsICk7CgkJCQkJaW1hZ2VzWyBpbWFnZS51dWlkIF0gPSBuZXcgU291cmNlKCBkZXNlcmlhbGl6ZWRJbWFnZSApOwoKCgkJCQl9CgoJCQl9CgoJCX0KCgkJcmV0dXJuIGltYWdlczsKCgl9CgoJYXN5bmMgcGFyc2VJbWFnZXNBc3luYygganNvbiApIHsKCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoJCWNvbnN0IGltYWdlcyA9IHt9OwoKCQlsZXQgbG9hZGVyOwoKCQlhc3luYyBmdW5jdGlvbiBkZXNlcmlhbGl6ZUltYWdlKCBpbWFnZSApIHsKCgkJCWlmICggdHlwZW9mIGltYWdlID09PSAnc3RyaW5nJyApIHsKCgkJCQljb25zdCB1cmwgPSBpbWFnZTsKCgkJCQljb25zdCBwYXRoID0gL14oXC9cLyl8KFthLXpdKzooXC9cLyk/KS9pLnRlc3QoIHVybCApID8gdXJsIDogc2NvcGUucmVzb3VyY2VQYXRoICsgdXJsOwoKCQkJCXJldHVybiBhd2FpdCBsb2FkZXIubG9hZEFzeW5jKCBwYXRoICk7CgoJCQl9IGVsc2UgewoKCQkJCWlmICggaW1hZ2UuZGF0YSApIHsKCgkJCQkJcmV0dXJuIHsKCQkJCQkJZGF0YTogZ2V0VHlwZWRBcnJheSggaW1hZ2UudHlwZSwgaW1hZ2UuZGF0YSApLAoJCQkJCQl3aWR0aDogaW1hZ2Uud2lkdGgsCgkJCQkJCWhlaWdodDogaW1hZ2UuaGVpZ2h0CgkJCQkJfTsKCgkJCQl9IGVsc2UgewoKCQkJCQlyZXR1cm4gbnVsbDsKCgkJCQl9CgoJCQl9CgoJCX0KCgkJaWYgKCBqc29uICE9PSB1bmRlZmluZWQgJiYganNvbi5sZW5ndGggPiAwICkgewoKCQkJbG9hZGVyID0gbmV3IEltYWdlTG9hZGVyKCB0aGlzLm1hbmFnZXIgKTsKCQkJbG9hZGVyLnNldENyb3NzT3JpZ2luKCB0aGlzLmNyb3NzT3JpZ2luICk7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGlsID0ganNvbi5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCQljb25zdCBpbWFnZSA9IGpzb25bIGkgXTsKCQkJCWNvbnN0IHVybCA9IGltYWdlLnVybDsKCgkJCQlpZiAoIEFycmF5LmlzQXJyYXkoIHVybCApICkgewoKCQkJCQkvLyBsb2FkIGFycmF5IG9mIGltYWdlcyBlLmcgQ3ViZVRleHR1cmUKCgkJCQkJY29uc3QgaW1hZ2VBcnJheSA9IFtdOwoKCQkJCQlmb3IgKCBsZXQgaiA9IDAsIGpsID0gdXJsLmxlbmd0aDsgaiA8IGpsOyBqICsrICkgewoKCQkJCQkJY29uc3QgY3VycmVudFVybCA9IHVybFsgaiBdOwoKCQkJCQkJY29uc3QgZGVzZXJpYWxpemVkSW1hZ2UgPSBhd2FpdCBkZXNlcmlhbGl6ZUltYWdlKCBjdXJyZW50VXJsICk7CgoJCQkJCQlpZiAoIGRlc2VyaWFsaXplZEltYWdlICE9PSBudWxsICkgewoKCQkJCQkJCWlmICggZGVzZXJpYWxpemVkSW1hZ2UgaW5zdGFuY2VvZiBIVE1MSW1hZ2VFbGVtZW50ICkgewoKCQkJCQkJCQlpbWFnZUFycmF5LnB1c2goIGRlc2VyaWFsaXplZEltYWdlICk7CgoJCQkJCQkJfSBlbHNlIHsKCgkJCQkJCQkJLy8gc3BlY2lhbCBjYXNlOiBoYW5kbGUgYXJyYXkgb2YgZGF0YSB0ZXh0dXJlcyBmb3IgY3ViZSB0ZXh0dXJlcwoKCQkJCQkJCQlpbWFnZUFycmF5LnB1c2goIG5ldyBEYXRhVGV4dHVyZSggZGVzZXJpYWxpemVkSW1hZ2UuZGF0YSwgZGVzZXJpYWxpemVkSW1hZ2Uud2lkdGgsIGRlc2VyaWFsaXplZEltYWdlLmhlaWdodCApICk7CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCWltYWdlc1sgaW1hZ2UudXVpZCBdID0gbmV3IFNvdXJjZSggaW1hZ2VBcnJheSApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCS8vIGxvYWQgc2luZ2xlIGltYWdlCgoJCQkJCWNvbnN0IGRlc2VyaWFsaXplZEltYWdlID0gYXdhaXQgZGVzZXJpYWxpemVJbWFnZSggaW1hZ2UudXJsICk7CgkJCQkJaW1hZ2VzWyBpbWFnZS51dWlkIF0gPSBuZXcgU291cmNlKCBkZXNlcmlhbGl6ZWRJbWFnZSApOwoKCQkJCX0KCgkJCX0KCgkJfQoKCQlyZXR1cm4gaW1hZ2VzOwoKCX0KCglwYXJzZVRleHR1cmVzKCBqc29uLCBpbWFnZXMgKSB7CgoJCWZ1bmN0aW9uIHBhcnNlQ29uc3RhbnQoIHZhbHVlLCB0eXBlICkgewoKCQkJaWYgKCB0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInICkgcmV0dXJuIHZhbHVlOwoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuT2JqZWN0TG9hZGVyLnBhcnNlVGV4dHVyZTogQ29uc3RhbnQgc2hvdWxkIGJlIGluIG51bWVyaWMgZm9ybS4nLCB2YWx1ZSApOwoKCQkJcmV0dXJuIHR5cGVbIHZhbHVlIF07CgoJCX0KCgkJY29uc3QgdGV4dHVyZXMgPSB7fTsKCgkJaWYgKCBqc29uICE9PSB1bmRlZmluZWQgKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBqc29uLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJY29uc3QgZGF0YSA9IGpzb25bIGkgXTsKCgkJCQlpZiAoIGRhdGEuaW1hZ2UgPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuT2JqZWN0TG9hZGVyOiBObyAiaW1hZ2UiIHNwZWNpZmllZCBmb3InLCBkYXRhLnV1aWQgKTsKCgkJCQl9CgoJCQkJaWYgKCBpbWFnZXNbIGRhdGEuaW1hZ2UgXSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQljb25zb2xlLndhcm4oICdUSFJFRS5PYmplY3RMb2FkZXI6IFVuZGVmaW5lZCBpbWFnZScsIGRhdGEuaW1hZ2UgKTsKCgkJCQl9CgoJCQkJY29uc3Qgc291cmNlID0gaW1hZ2VzWyBkYXRhLmltYWdlIF07CgkJCQljb25zdCBpbWFnZSA9IHNvdXJjZS5kYXRhOwoKCQkJCWxldCB0ZXh0dXJlOwoKCQkJCWlmICggQXJyYXkuaXNBcnJheSggaW1hZ2UgKSApIHsKCgkJCQkJdGV4dHVyZSA9IG5ldyBDdWJlVGV4dHVyZSgpOwoKCQkJCQlpZiAoIGltYWdlLmxlbmd0aCA9PT0gNiApIHRleHR1cmUubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQkJCX0gZWxzZSB7CgoJCQkJCWlmICggaW1hZ2UgJiYgaW1hZ2UuZGF0YSApIHsKCgkJCQkJCXRleHR1cmUgPSBuZXcgRGF0YVRleHR1cmUoKTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCXRleHR1cmUgPSBuZXcgVGV4dHVyZSgpOwoKCQkJCQl9CgoJCQkJCWlmICggaW1hZ2UgKSB0ZXh0dXJlLm5lZWRzVXBkYXRlID0gdHJ1ZTsgLy8gdGV4dHVyZXMgY2FuIGhhdmUgdW5kZWZpbmVkIGltYWdlIGRhdGEKCgkJCQl9CgoJCQkJdGV4dHVyZS5zb3VyY2UgPSBzb3VyY2U7CgoJCQkJdGV4dHVyZS51dWlkID0gZGF0YS51dWlkOwoKCQkJCWlmICggZGF0YS5uYW1lICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLm5hbWUgPSBkYXRhLm5hbWU7CgoJCQkJaWYgKCBkYXRhLm1hcHBpbmcgIT09IHVuZGVmaW5lZCApIHRleHR1cmUubWFwcGluZyA9IHBhcnNlQ29uc3RhbnQoIGRhdGEubWFwcGluZywgVEVYVFVSRV9NQVBQSU5HICk7CgkJCQlpZiAoIGRhdGEuY2hhbm5lbCAhPT0gdW5kZWZpbmVkICkgdGV4dHVyZS5jaGFubmVsID0gZGF0YS5jaGFubmVsOwoKCQkJCWlmICggZGF0YS5vZmZzZXQgIT09IHVuZGVmaW5lZCApIHRleHR1cmUub2Zmc2V0LmZyb21BcnJheSggZGF0YS5vZmZzZXQgKTsKCQkJCWlmICggZGF0YS5yZXBlYXQgIT09IHVuZGVmaW5lZCApIHRleHR1cmUucmVwZWF0LmZyb21BcnJheSggZGF0YS5yZXBlYXQgKTsKCQkJCWlmICggZGF0YS5jZW50ZXIgIT09IHVuZGVmaW5lZCApIHRleHR1cmUuY2VudGVyLmZyb21BcnJheSggZGF0YS5jZW50ZXIgKTsKCQkJCWlmICggZGF0YS5yb3RhdGlvbiAhPT0gdW5kZWZpbmVkICkgdGV4dHVyZS5yb3RhdGlvbiA9IGRhdGEucm90YXRpb247CgoJCQkJaWYgKCBkYXRhLndyYXAgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJdGV4dHVyZS53cmFwUyA9IHBhcnNlQ29uc3RhbnQoIGRhdGEud3JhcFsgMCBdLCBURVhUVVJFX1dSQVBQSU5HICk7CgkJCQkJdGV4dHVyZS53cmFwVCA9IHBhcnNlQ29uc3RhbnQoIGRhdGEud3JhcFsgMSBdLCBURVhUVVJFX1dSQVBQSU5HICk7CgoJCQkJfQoKCQkJCWlmICggZGF0YS5mb3JtYXQgIT09IHVuZGVmaW5lZCApIHRleHR1cmUuZm9ybWF0ID0gZGF0YS5mb3JtYXQ7CgkJCQlpZiAoIGRhdGEuaW50ZXJuYWxGb3JtYXQgIT09IHVuZGVmaW5lZCApIHRleHR1cmUuaW50ZXJuYWxGb3JtYXQgPSBkYXRhLmludGVybmFsRm9ybWF0OwoJCQkJaWYgKCBkYXRhLnR5cGUgIT09IHVuZGVmaW5lZCApIHRleHR1cmUudHlwZSA9IGRhdGEudHlwZTsKCQkJCWlmICggZGF0YS5jb2xvclNwYWNlICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLmNvbG9yU3BhY2UgPSBkYXRhLmNvbG9yU3BhY2U7CgkJCQlpZiAoIGRhdGEuZW5jb2RpbmcgIT09IHVuZGVmaW5lZCApIHRleHR1cmUuZW5jb2RpbmcgPSBkYXRhLmVuY29kaW5nOyAvLyBAZGVwcmVjYXRlZCwgcjE1MgoKCQkJCWlmICggZGF0YS5taW5GaWx0ZXIgIT09IHVuZGVmaW5lZCApIHRleHR1cmUubWluRmlsdGVyID0gcGFyc2VDb25zdGFudCggZGF0YS5taW5GaWx0ZXIsIFRFWFRVUkVfRklMVEVSICk7CgkJCQlpZiAoIGRhdGEubWFnRmlsdGVyICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLm1hZ0ZpbHRlciA9IHBhcnNlQ29uc3RhbnQoIGRhdGEubWFnRmlsdGVyLCBURVhUVVJFX0ZJTFRFUiApOwoJCQkJaWYgKCBkYXRhLmFuaXNvdHJvcHkgIT09IHVuZGVmaW5lZCApIHRleHR1cmUuYW5pc290cm9weSA9IGRhdGEuYW5pc290cm9weTsKCgkJCQlpZiAoIGRhdGEuZmxpcFkgIT09IHVuZGVmaW5lZCApIHRleHR1cmUuZmxpcFkgPSBkYXRhLmZsaXBZOwoKCQkJCWlmICggZGF0YS5nZW5lcmF0ZU1pcG1hcHMgIT09IHVuZGVmaW5lZCApIHRleHR1cmUuZ2VuZXJhdGVNaXBtYXBzID0gZGF0YS5nZW5lcmF0ZU1pcG1hcHM7CgkJCQlpZiAoIGRhdGEucHJlbXVsdGlwbHlBbHBoYSAhPT0gdW5kZWZpbmVkICkgdGV4dHVyZS5wcmVtdWx0aXBseUFscGhhID0gZGF0YS5wcmVtdWx0aXBseUFscGhhOwoJCQkJaWYgKCBkYXRhLnVucGFja0FsaWdubWVudCAhPT0gdW5kZWZpbmVkICkgdGV4dHVyZS51bnBhY2tBbGlnbm1lbnQgPSBkYXRhLnVucGFja0FsaWdubWVudDsKCQkJCWlmICggZGF0YS5jb21wYXJlRnVuY3Rpb24gIT09IHVuZGVmaW5lZCApIHRleHR1cmUuY29tcGFyZUZ1bmN0aW9uID0gZGF0YS5jb21wYXJlRnVuY3Rpb247CgoJCQkJaWYgKCBkYXRhLnVzZXJEYXRhICE9PSB1bmRlZmluZWQgKSB0ZXh0dXJlLnVzZXJEYXRhID0gZGF0YS51c2VyRGF0YTsKCgkJCQl0ZXh0dXJlc1sgZGF0YS51dWlkIF0gPSB0ZXh0dXJlOwoKCQkJfQoKCQl9CgoJCXJldHVybiB0ZXh0dXJlczsKCgl9CgoJcGFyc2VPYmplY3QoIGRhdGEsIGdlb21ldHJpZXMsIG1hdGVyaWFscywgdGV4dHVyZXMsIGFuaW1hdGlvbnMgKSB7CgoJCWxldCBvYmplY3Q7CgoJCWZ1bmN0aW9uIGdldEdlb21ldHJ5KCBuYW1lICkgewoKCQkJaWYgKCBnZW9tZXRyaWVzWyBuYW1lIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5PYmplY3RMb2FkZXI6IFVuZGVmaW5lZCBnZW9tZXRyeScsIG5hbWUgKTsKCgkJCX0KCgkJCXJldHVybiBnZW9tZXRyaWVzWyBuYW1lIF07CgoJCX0KCgkJZnVuY3Rpb24gZ2V0TWF0ZXJpYWwoIG5hbWUgKSB7CgoJCQlpZiAoIG5hbWUgPT09IHVuZGVmaW5lZCApIHJldHVybiB1bmRlZmluZWQ7CgoJCQlpZiAoIEFycmF5LmlzQXJyYXkoIG5hbWUgKSApIHsKCgkJCQljb25zdCBhcnJheSA9IFtdOwoKCQkJCWZvciAoIGxldCBpID0gMCwgbCA9IG5hbWUubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCQkJY29uc3QgdXVpZCA9IG5hbWVbIGkgXTsKCgkJCQkJaWYgKCBtYXRlcmlhbHNbIHV1aWQgXSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuT2JqZWN0TG9hZGVyOiBVbmRlZmluZWQgbWF0ZXJpYWwnLCB1dWlkICk7CgoJCQkJCX0KCgkJCQkJYXJyYXkucHVzaCggbWF0ZXJpYWxzWyB1dWlkIF0gKTsKCgkJCQl9CgoJCQkJcmV0dXJuIGFycmF5OwoKCQkJfQoKCQkJaWYgKCBtYXRlcmlhbHNbIG5hbWUgXSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnNvbGUud2FybiggJ1RIUkVFLk9iamVjdExvYWRlcjogVW5kZWZpbmVkIG1hdGVyaWFsJywgbmFtZSApOwoKCQkJfQoKCQkJcmV0dXJuIG1hdGVyaWFsc1sgbmFtZSBdOwoKCQl9CgoJCWZ1bmN0aW9uIGdldFRleHR1cmUoIHV1aWQgKSB7CgoJCQlpZiAoIHRleHR1cmVzWyB1dWlkIF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQljb25zb2xlLndhcm4oICdUSFJFRS5PYmplY3RMb2FkZXI6IFVuZGVmaW5lZCB0ZXh0dXJlJywgdXVpZCApOwoKCQkJfQoKCQkJcmV0dXJuIHRleHR1cmVzWyB1dWlkIF07CgoJCX0KCgkJbGV0IGdlb21ldHJ5LCBtYXRlcmlhbDsKCgkJc3dpdGNoICggZGF0YS50eXBlICkgewoKCQkJY2FzZSAnU2NlbmUnOgoKCQkJCW9iamVjdCA9IG5ldyBTY2VuZSgpOwoKCQkJCWlmICggZGF0YS5iYWNrZ3JvdW5kICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCWlmICggTnVtYmVyLmlzSW50ZWdlciggZGF0YS5iYWNrZ3JvdW5kICkgKSB7CgoJCQkJCQlvYmplY3QuYmFja2dyb3VuZCA9IG5ldyBDb2xvciggZGF0YS5iYWNrZ3JvdW5kICk7CgoJCQkJCX0gZWxzZSB7CgoJCQkJCQlvYmplY3QuYmFja2dyb3VuZCA9IGdldFRleHR1cmUoIGRhdGEuYmFja2dyb3VuZCApOwoKCQkJCQl9CgoJCQkJfQoKCQkJCWlmICggZGF0YS5lbnZpcm9ubWVudCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCQlvYmplY3QuZW52aXJvbm1lbnQgPSBnZXRUZXh0dXJlKCBkYXRhLmVudmlyb25tZW50ICk7CgoJCQkJfQoKCQkJCWlmICggZGF0YS5mb2cgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJaWYgKCBkYXRhLmZvZy50eXBlID09PSAnRm9nJyApIHsKCgkJCQkJCW9iamVjdC5mb2cgPSBuZXcgRm9nKCBkYXRhLmZvZy5jb2xvciwgZGF0YS5mb2cubmVhciwgZGF0YS5mb2cuZmFyICk7CgoJCQkJCX0gZWxzZSBpZiAoIGRhdGEuZm9nLnR5cGUgPT09ICdGb2dFeHAyJyApIHsKCgkJCQkJCW9iamVjdC5mb2cgPSBuZXcgRm9nRXhwMiggZGF0YS5mb2cuY29sb3IsIGRhdGEuZm9nLmRlbnNpdHkgKTsKCgkJCQkJfQoKCQkJCQlpZiAoIGRhdGEuZm9nLm5hbWUgIT09ICcnICkgewoKCQkJCQkJb2JqZWN0LmZvZy5uYW1lID0gZGF0YS5mb2cubmFtZTsKCgkJCQkJfQoKCQkJCX0KCgkJCQlpZiAoIGRhdGEuYmFja2dyb3VuZEJsdXJyaW5lc3MgIT09IHVuZGVmaW5lZCApIG9iamVjdC5iYWNrZ3JvdW5kQmx1cnJpbmVzcyA9IGRhdGEuYmFja2dyb3VuZEJsdXJyaW5lc3M7CgkJCQlpZiAoIGRhdGEuYmFja2dyb3VuZEludGVuc2l0eSAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LmJhY2tncm91bmRJbnRlbnNpdHkgPSBkYXRhLmJhY2tncm91bmRJbnRlbnNpdHk7CgoJCQkJYnJlYWs7CgoJCQljYXNlICdQZXJzcGVjdGl2ZUNhbWVyYSc6CgoJCQkJb2JqZWN0ID0gbmV3IFBlcnNwZWN0aXZlQ2FtZXJhKCBkYXRhLmZvdiwgZGF0YS5hc3BlY3QsIGRhdGEubmVhciwgZGF0YS5mYXIgKTsKCgkJCQlpZiAoIGRhdGEuZm9jdXMgIT09IHVuZGVmaW5lZCApIG9iamVjdC5mb2N1cyA9IGRhdGEuZm9jdXM7CgkJCQlpZiAoIGRhdGEuem9vbSAhPT0gdW5kZWZpbmVkICkgb2JqZWN0Lnpvb20gPSBkYXRhLnpvb207CgkJCQlpZiAoIGRhdGEuZmlsbUdhdWdlICE9PSB1bmRlZmluZWQgKSBvYmplY3QuZmlsbUdhdWdlID0gZGF0YS5maWxtR2F1Z2U7CgkJCQlpZiAoIGRhdGEuZmlsbU9mZnNldCAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LmZpbG1PZmZzZXQgPSBkYXRhLmZpbG1PZmZzZXQ7CgkJCQlpZiAoIGRhdGEudmlldyAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LnZpZXcgPSBPYmplY3QuYXNzaWduKCB7fSwgZGF0YS52aWV3ICk7CgoJCQkJYnJlYWs7CgoJCQljYXNlICdPcnRob2dyYXBoaWNDYW1lcmEnOgoKCQkJCW9iamVjdCA9IG5ldyBPcnRob2dyYXBoaWNDYW1lcmEoIGRhdGEubGVmdCwgZGF0YS5yaWdodCwgZGF0YS50b3AsIGRhdGEuYm90dG9tLCBkYXRhLm5lYXIsIGRhdGEuZmFyICk7CgoJCQkJaWYgKCBkYXRhLnpvb20gIT09IHVuZGVmaW5lZCApIG9iamVjdC56b29tID0gZGF0YS56b29tOwoJCQkJaWYgKCBkYXRhLnZpZXcgIT09IHVuZGVmaW5lZCApIG9iamVjdC52aWV3ID0gT2JqZWN0LmFzc2lnbigge30sIGRhdGEudmlldyApOwoKCQkJCWJyZWFrOwoKCQkJY2FzZSAnQW1iaWVudExpZ2h0JzoKCgkJCQlvYmplY3QgPSBuZXcgQW1iaWVudExpZ2h0KCBkYXRhLmNvbG9yLCBkYXRhLmludGVuc2l0eSApOwoKCQkJCWJyZWFrOwoKCQkJY2FzZSAnRGlyZWN0aW9uYWxMaWdodCc6CgoJCQkJb2JqZWN0ID0gbmV3IERpcmVjdGlvbmFsTGlnaHQoIGRhdGEuY29sb3IsIGRhdGEuaW50ZW5zaXR5ICk7CgoJCQkJYnJlYWs7CgoJCQljYXNlICdQb2ludExpZ2h0JzoKCgkJCQlvYmplY3QgPSBuZXcgUG9pbnRMaWdodCggZGF0YS5jb2xvciwgZGF0YS5pbnRlbnNpdHksIGRhdGEuZGlzdGFuY2UsIGRhdGEuZGVjYXkgKTsKCgkJCQlicmVhazsKCgkJCWNhc2UgJ1JlY3RBcmVhTGlnaHQnOgoKCQkJCW9iamVjdCA9IG5ldyBSZWN0QXJlYUxpZ2h0KCBkYXRhLmNvbG9yLCBkYXRhLmludGVuc2l0eSwgZGF0YS53aWR0aCwgZGF0YS5oZWlnaHQgKTsKCgkJCQlicmVhazsKCgkJCWNhc2UgJ1Nwb3RMaWdodCc6CgoJCQkJb2JqZWN0ID0gbmV3IFNwb3RMaWdodCggZGF0YS5jb2xvciwgZGF0YS5pbnRlbnNpdHksIGRhdGEuZGlzdGFuY2UsIGRhdGEuYW5nbGUsIGRhdGEucGVudW1icmEsIGRhdGEuZGVjYXkgKTsKCgkJCQlicmVhazsKCgkJCWNhc2UgJ0hlbWlzcGhlcmVMaWdodCc6CgoJCQkJb2JqZWN0ID0gbmV3IEhlbWlzcGhlcmVMaWdodCggZGF0YS5jb2xvciwgZGF0YS5ncm91bmRDb2xvciwgZGF0YS5pbnRlbnNpdHkgKTsKCgkJCQlicmVhazsKCgkJCWNhc2UgJ0xpZ2h0UHJvYmUnOgoKCQkJCW9iamVjdCA9IG5ldyBMaWdodFByb2JlKCkuZnJvbUpTT04oIGRhdGEgKTsKCgkJCQlicmVhazsKCgkJCWNhc2UgJ1NraW5uZWRNZXNoJzoKCgkJCQlnZW9tZXRyeSA9IGdldEdlb21ldHJ5KCBkYXRhLmdlb21ldHJ5ICk7CgkJCSAJbWF0ZXJpYWwgPSBnZXRNYXRlcmlhbCggZGF0YS5tYXRlcmlhbCApOwoKCQkJCW9iamVjdCA9IG5ldyBTa2lubmVkTWVzaCggZ2VvbWV0cnksIG1hdGVyaWFsICk7CgoJCQkJaWYgKCBkYXRhLmJpbmRNb2RlICE9PSB1bmRlZmluZWQgKSBvYmplY3QuYmluZE1vZGUgPSBkYXRhLmJpbmRNb2RlOwoJCQkJaWYgKCBkYXRhLmJpbmRNYXRyaXggIT09IHVuZGVmaW5lZCApIG9iamVjdC5iaW5kTWF0cml4LmZyb21BcnJheSggZGF0YS5iaW5kTWF0cml4ICk7CgkJCQlpZiAoIGRhdGEuc2tlbGV0b24gIT09IHVuZGVmaW5lZCApIG9iamVjdC5za2VsZXRvbiA9IGRhdGEuc2tlbGV0b247CgoJCQkJYnJlYWs7CgoJCQljYXNlICdNZXNoJzoKCgkJCQlnZW9tZXRyeSA9IGdldEdlb21ldHJ5KCBkYXRhLmdlb21ldHJ5ICk7CgkJCQltYXRlcmlhbCA9IGdldE1hdGVyaWFsKCBkYXRhLm1hdGVyaWFsICk7CgoJCQkJb2JqZWN0ID0gbmV3IE1lc2goIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCQkJCWJyZWFrOwoKCQkJY2FzZSAnSW5zdGFuY2VkTWVzaCc6CgoJCQkJZ2VvbWV0cnkgPSBnZXRHZW9tZXRyeSggZGF0YS5nZW9tZXRyeSApOwoJCQkJbWF0ZXJpYWwgPSBnZXRNYXRlcmlhbCggZGF0YS5tYXRlcmlhbCApOwoJCQkJY29uc3QgY291bnQgPSBkYXRhLmNvdW50OwoJCQkJY29uc3QgaW5zdGFuY2VNYXRyaXggPSBkYXRhLmluc3RhbmNlTWF0cml4OwoJCQkJY29uc3QgaW5zdGFuY2VDb2xvciA9IGRhdGEuaW5zdGFuY2VDb2xvcjsKCgkJCQlvYmplY3QgPSBuZXcgSW5zdGFuY2VkTWVzaCggZ2VvbWV0cnksIG1hdGVyaWFsLCBjb3VudCApOwoJCQkJb2JqZWN0Lmluc3RhbmNlTWF0cml4ID0gbmV3IEluc3RhbmNlZEJ1ZmZlckF0dHJpYnV0ZSggbmV3IEZsb2F0MzJBcnJheSggaW5zdGFuY2VNYXRyaXguYXJyYXkgKSwgMTYgKTsKCQkJCWlmICggaW5zdGFuY2VDb2xvciAhPT0gdW5kZWZpbmVkICkgb2JqZWN0Lmluc3RhbmNlQ29sb3IgPSBuZXcgSW5zdGFuY2VkQnVmZmVyQXR0cmlidXRlKCBuZXcgRmxvYXQzMkFycmF5KCBpbnN0YW5jZUNvbG9yLmFycmF5ICksIGluc3RhbmNlQ29sb3IuaXRlbVNpemUgKTsKCgkJCQlicmVhazsKCgkJCWNhc2UgJ0xPRCc6CgoJCQkJb2JqZWN0ID0gbmV3IExPRCgpOwoKCQkJCWJyZWFrOwoKCQkJY2FzZSAnTGluZSc6CgoJCQkJb2JqZWN0ID0gbmV3IExpbmUoIGdldEdlb21ldHJ5KCBkYXRhLmdlb21ldHJ5ICksIGdldE1hdGVyaWFsKCBkYXRhLm1hdGVyaWFsICkgKTsKCgkJCQlicmVhazsKCgkJCWNhc2UgJ0xpbmVMb29wJzoKCgkJCQlvYmplY3QgPSBuZXcgTGluZUxvb3AoIGdldEdlb21ldHJ5KCBkYXRhLmdlb21ldHJ5ICksIGdldE1hdGVyaWFsKCBkYXRhLm1hdGVyaWFsICkgKTsKCgkJCQlicmVhazsKCgkJCWNhc2UgJ0xpbmVTZWdtZW50cyc6CgoJCQkJb2JqZWN0ID0gbmV3IExpbmVTZWdtZW50cyggZ2V0R2VvbWV0cnkoIGRhdGEuZ2VvbWV0cnkgKSwgZ2V0TWF0ZXJpYWwoIGRhdGEubWF0ZXJpYWwgKSApOwoKCQkJCWJyZWFrOwoKCQkJY2FzZSAnUG9pbnRDbG91ZCc6CgkJCWNhc2UgJ1BvaW50cyc6CgoJCQkJb2JqZWN0ID0gbmV3IFBvaW50cyggZ2V0R2VvbWV0cnkoIGRhdGEuZ2VvbWV0cnkgKSwgZ2V0TWF0ZXJpYWwoIGRhdGEubWF0ZXJpYWwgKSApOwoKCQkJCWJyZWFrOwoKCQkJY2FzZSAnU3ByaXRlJzoKCgkJCQlvYmplY3QgPSBuZXcgU3ByaXRlKCBnZXRNYXRlcmlhbCggZGF0YS5tYXRlcmlhbCApICk7CgoJCQkJYnJlYWs7CgoJCQljYXNlICdHcm91cCc6CgoJCQkJb2JqZWN0ID0gbmV3IEdyb3VwKCk7CgoJCQkJYnJlYWs7CgoJCQljYXNlICdCb25lJzoKCgkJCQlvYmplY3QgPSBuZXcgQm9uZSgpOwoKCQkJCWJyZWFrOwoKCQkJZGVmYXVsdDoKCgkJCQlvYmplY3QgPSBuZXcgT2JqZWN0M0QoKTsKCgkJfQoKCQlvYmplY3QudXVpZCA9IGRhdGEudXVpZDsKCgkJaWYgKCBkYXRhLm5hbWUgIT09IHVuZGVmaW5lZCApIG9iamVjdC5uYW1lID0gZGF0YS5uYW1lOwoKCQlpZiAoIGRhdGEubWF0cml4ICE9PSB1bmRlZmluZWQgKSB7CgoJCQlvYmplY3QubWF0cml4LmZyb21BcnJheSggZGF0YS5tYXRyaXggKTsKCgkJCWlmICggZGF0YS5tYXRyaXhBdXRvVXBkYXRlICE9PSB1bmRlZmluZWQgKSBvYmplY3QubWF0cml4QXV0b1VwZGF0ZSA9IGRhdGEubWF0cml4QXV0b1VwZGF0ZTsKCQkJaWYgKCBvYmplY3QubWF0cml4QXV0b1VwZGF0ZSApIG9iamVjdC5tYXRyaXguZGVjb21wb3NlKCBvYmplY3QucG9zaXRpb24sIG9iamVjdC5xdWF0ZXJuaW9uLCBvYmplY3Quc2NhbGUgKTsKCgkJfSBlbHNlIHsKCgkJCWlmICggZGF0YS5wb3NpdGlvbiAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LnBvc2l0aW9uLmZyb21BcnJheSggZGF0YS5wb3NpdGlvbiApOwoJCQlpZiAoIGRhdGEucm90YXRpb24gIT09IHVuZGVmaW5lZCApIG9iamVjdC5yb3RhdGlvbi5mcm9tQXJyYXkoIGRhdGEucm90YXRpb24gKTsKCQkJaWYgKCBkYXRhLnF1YXRlcm5pb24gIT09IHVuZGVmaW5lZCApIG9iamVjdC5xdWF0ZXJuaW9uLmZyb21BcnJheSggZGF0YS5xdWF0ZXJuaW9uICk7CgkJCWlmICggZGF0YS5zY2FsZSAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LnNjYWxlLmZyb21BcnJheSggZGF0YS5zY2FsZSApOwoKCQl9CgoJCWlmICggZGF0YS51cCAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LnVwLmZyb21BcnJheSggZGF0YS51cCApOwoKCQlpZiAoIGRhdGEuY2FzdFNoYWRvdyAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LmNhc3RTaGFkb3cgPSBkYXRhLmNhc3RTaGFkb3c7CgkJaWYgKCBkYXRhLnJlY2VpdmVTaGFkb3cgIT09IHVuZGVmaW5lZCApIG9iamVjdC5yZWNlaXZlU2hhZG93ID0gZGF0YS5yZWNlaXZlU2hhZG93OwoKCQlpZiAoIGRhdGEuc2hhZG93ICkgewoKCQkJaWYgKCBkYXRhLnNoYWRvdy5iaWFzICE9PSB1bmRlZmluZWQgKSBvYmplY3Quc2hhZG93LmJpYXMgPSBkYXRhLnNoYWRvdy5iaWFzOwoJCQlpZiAoIGRhdGEuc2hhZG93Lm5vcm1hbEJpYXMgIT09IHVuZGVmaW5lZCApIG9iamVjdC5zaGFkb3cubm9ybWFsQmlhcyA9IGRhdGEuc2hhZG93Lm5vcm1hbEJpYXM7CgkJCWlmICggZGF0YS5zaGFkb3cucmFkaXVzICE9PSB1bmRlZmluZWQgKSBvYmplY3Quc2hhZG93LnJhZGl1cyA9IGRhdGEuc2hhZG93LnJhZGl1czsKCQkJaWYgKCBkYXRhLnNoYWRvdy5tYXBTaXplICE9PSB1bmRlZmluZWQgKSBvYmplY3Quc2hhZG93Lm1hcFNpemUuZnJvbUFycmF5KCBkYXRhLnNoYWRvdy5tYXBTaXplICk7CgkJCWlmICggZGF0YS5zaGFkb3cuY2FtZXJhICE9PSB1bmRlZmluZWQgKSBvYmplY3Quc2hhZG93LmNhbWVyYSA9IHRoaXMucGFyc2VPYmplY3QoIGRhdGEuc2hhZG93LmNhbWVyYSApOwoKCQl9CgoJCWlmICggZGF0YS52aXNpYmxlICE9PSB1bmRlZmluZWQgKSBvYmplY3QudmlzaWJsZSA9IGRhdGEudmlzaWJsZTsKCQlpZiAoIGRhdGEuZnJ1c3R1bUN1bGxlZCAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LmZydXN0dW1DdWxsZWQgPSBkYXRhLmZydXN0dW1DdWxsZWQ7CgkJaWYgKCBkYXRhLnJlbmRlck9yZGVyICE9PSB1bmRlZmluZWQgKSBvYmplY3QucmVuZGVyT3JkZXIgPSBkYXRhLnJlbmRlck9yZGVyOwoJCWlmICggZGF0YS51c2VyRGF0YSAhPT0gdW5kZWZpbmVkICkgb2JqZWN0LnVzZXJEYXRhID0gZGF0YS51c2VyRGF0YTsKCQlpZiAoIGRhdGEubGF5ZXJzICE9PSB1bmRlZmluZWQgKSBvYmplY3QubGF5ZXJzLm1hc2sgPSBkYXRhLmxheWVyczsKCgkJaWYgKCBkYXRhLmNoaWxkcmVuICE9PSB1bmRlZmluZWQgKSB7CgoJCQljb25zdCBjaGlsZHJlbiA9IGRhdGEuY2hpbGRyZW47CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBjaGlsZHJlbi5sZW5ndGg7IGkgKysgKSB7CgoJCQkJb2JqZWN0LmFkZCggdGhpcy5wYXJzZU9iamVjdCggY2hpbGRyZW5bIGkgXSwgZ2VvbWV0cmllcywgbWF0ZXJpYWxzLCB0ZXh0dXJlcywgYW5pbWF0aW9ucyApICk7CgoJCQl9CgoJCX0KCgkJaWYgKCBkYXRhLmFuaW1hdGlvbnMgIT09IHVuZGVmaW5lZCApIHsKCgkJCWNvbnN0IG9iamVjdEFuaW1hdGlvbnMgPSBkYXRhLmFuaW1hdGlvbnM7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgPCBvYmplY3RBbmltYXRpb25zLmxlbmd0aDsgaSArKyApIHsKCgkJCQljb25zdCB1dWlkID0gb2JqZWN0QW5pbWF0aW9uc1sgaSBdOwoKCQkJCW9iamVjdC5hbmltYXRpb25zLnB1c2goIGFuaW1hdGlvbnNbIHV1aWQgXSApOwoKCQkJfQoKCQl9CgoJCWlmICggZGF0YS50eXBlID09PSAnTE9EJyApIHsKCgkJCWlmICggZGF0YS5hdXRvVXBkYXRlICE9PSB1bmRlZmluZWQgKSBvYmplY3QuYXV0b1VwZGF0ZSA9IGRhdGEuYXV0b1VwZGF0ZTsKCgkJCWNvbnN0IGxldmVscyA9IGRhdGEubGV2ZWxzOwoKCQkJZm9yICggbGV0IGwgPSAwOyBsIDwgbGV2ZWxzLmxlbmd0aDsgbCArKyApIHsKCgkJCQljb25zdCBsZXZlbCA9IGxldmVsc1sgbCBdOwoJCQkJY29uc3QgY2hpbGQgPSBvYmplY3QuZ2V0T2JqZWN0QnlQcm9wZXJ0eSggJ3V1aWQnLCBsZXZlbC5vYmplY3QgKTsKCgkJCQlpZiAoIGNoaWxkICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCW9iamVjdC5hZGRMZXZlbCggY2hpbGQsIGxldmVsLmRpc3RhbmNlLCBsZXZlbC5oeXN0ZXJlc2lzICk7CgoJCQkJfQoKCQkJfQoKCQl9CgoJCXJldHVybiBvYmplY3Q7CgoJfQoKCWJpbmRTa2VsZXRvbnMoIG9iamVjdCwgc2tlbGV0b25zICkgewoKCQlpZiAoIE9iamVjdC5rZXlzKCBza2VsZXRvbnMgKS5sZW5ndGggPT09IDAgKSByZXR1cm47CgoJCW9iamVjdC50cmF2ZXJzZSggZnVuY3Rpb24gKCBjaGlsZCApIHsKCgkJCWlmICggY2hpbGQuaXNTa2lubmVkTWVzaCA9PT0gdHJ1ZSAmJiBjaGlsZC5za2VsZXRvbiAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWNvbnN0IHNrZWxldG9uID0gc2tlbGV0b25zWyBjaGlsZC5za2VsZXRvbiBdOwoKCQkJCWlmICggc2tlbGV0b24gPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJY29uc29sZS53YXJuKCAnVEhSRUUuT2JqZWN0TG9hZGVyOiBObyBza2VsZXRvbiBmb3VuZCB3aXRoIFVVSUQ6JywgY2hpbGQuc2tlbGV0b24gKTsKCgkJCQl9IGVsc2UgewoKCQkJCQljaGlsZC5iaW5kKCBza2VsZXRvbiwgY2hpbGQuYmluZE1hdHJpeCApOwoKCQkJCX0KCgkJCX0KCgkJfSApOwoKCX0KCn0KCmNvbnN0IFRFWFRVUkVfTUFQUElORyA9IHsKCVVWTWFwcGluZzogVVZNYXBwaW5nLAoJQ3ViZVJlZmxlY3Rpb25NYXBwaW5nOiBDdWJlUmVmbGVjdGlvbk1hcHBpbmcsCglDdWJlUmVmcmFjdGlvbk1hcHBpbmc6IEN1YmVSZWZyYWN0aW9uTWFwcGluZywKCUVxdWlyZWN0YW5ndWxhclJlZmxlY3Rpb25NYXBwaW5nOiBFcXVpcmVjdGFuZ3VsYXJSZWZsZWN0aW9uTWFwcGluZywKCUVxdWlyZWN0YW5ndWxhclJlZnJhY3Rpb25NYXBwaW5nOiBFcXVpcmVjdGFuZ3VsYXJSZWZyYWN0aW9uTWFwcGluZywKCUN1YmVVVlJlZmxlY3Rpb25NYXBwaW5nOiBDdWJlVVZSZWZsZWN0aW9uTWFwcGluZwp9OwoKY29uc3QgVEVYVFVSRV9XUkFQUElORyA9IHsKCVJlcGVhdFdyYXBwaW5nOiBSZXBlYXRXcmFwcGluZywKCUNsYW1wVG9FZGdlV3JhcHBpbmc6IENsYW1wVG9FZGdlV3JhcHBpbmcsCglNaXJyb3JlZFJlcGVhdFdyYXBwaW5nOiBNaXJyb3JlZFJlcGVhdFdyYXBwaW5nCn07Cgpjb25zdCBURVhUVVJFX0ZJTFRFUiA9IHsKCU5lYXJlc3RGaWx0ZXI6IE5lYXJlc3RGaWx0ZXIsCglOZWFyZXN0TWlwbWFwTmVhcmVzdEZpbHRlcjogTmVhcmVzdE1pcG1hcE5lYXJlc3RGaWx0ZXIsCglOZWFyZXN0TWlwbWFwTGluZWFyRmlsdGVyOiBOZWFyZXN0TWlwbWFwTGluZWFyRmlsdGVyLAoJTGluZWFyRmlsdGVyOiBMaW5lYXJGaWx0ZXIsCglMaW5lYXJNaXBtYXBOZWFyZXN0RmlsdGVyOiBMaW5lYXJNaXBtYXBOZWFyZXN0RmlsdGVyLAoJTGluZWFyTWlwbWFwTGluZWFyRmlsdGVyOiBMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIKfTsKCmNsYXNzIEltYWdlQml0bWFwTG9hZGVyIGV4dGVuZHMgTG9hZGVyIHsKCgljb25zdHJ1Y3RvciggbWFuYWdlciApIHsKCgkJc3VwZXIoIG1hbmFnZXIgKTsKCgkJdGhpcy5pc0ltYWdlQml0bWFwTG9hZGVyID0gdHJ1ZTsKCgkJaWYgKCB0eXBlb2YgY3JlYXRlSW1hZ2VCaXRtYXAgPT09ICd1bmRlZmluZWQnICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuSW1hZ2VCaXRtYXBMb2FkZXI6IGNyZWF0ZUltYWdlQml0bWFwKCkgbm90IHN1cHBvcnRlZC4nICk7CgoJCX0KCgkJaWYgKCB0eXBlb2YgZmV0Y2ggPT09ICd1bmRlZmluZWQnICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuSW1hZ2VCaXRtYXBMb2FkZXI6IGZldGNoKCkgbm90IHN1cHBvcnRlZC4nICk7CgoJCX0KCgkJdGhpcy5vcHRpb25zID0geyBwcmVtdWx0aXBseUFscGhhOiAnbm9uZScgfTsKCgl9CgoJc2V0T3B0aW9ucyggb3B0aW9ucyApIHsKCgkJdGhpcy5vcHRpb25zID0gb3B0aW9uczsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWxvYWQoIHVybCwgb25Mb2FkLCBvblByb2dyZXNzLCBvbkVycm9yICkgewoKCQlpZiAoIHVybCA9PT0gdW5kZWZpbmVkICkgdXJsID0gJyc7CgoJCWlmICggdGhpcy5wYXRoICE9PSB1bmRlZmluZWQgKSB1cmwgPSB0aGlzLnBhdGggKyB1cmw7CgoJCXVybCA9IHRoaXMubWFuYWdlci5yZXNvbHZlVVJMKCB1cmwgKTsKCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQljb25zdCBjYWNoZWQgPSBDYWNoZS5nZXQoIHVybCApOwoKCQlpZiAoIGNhY2hlZCAhPT0gdW5kZWZpbmVkICkgewoKCQkJc2NvcGUubWFuYWdlci5pdGVtU3RhcnQoIHVybCApOwoKCQkJc2V0VGltZW91dCggZnVuY3Rpb24gKCkgewoKCQkJCWlmICggb25Mb2FkICkgb25Mb2FkKCBjYWNoZWQgKTsKCgkJCQlzY29wZS5tYW5hZ2VyLml0ZW1FbmQoIHVybCApOwoKCQkJfSwgMCApOwoKCQkJcmV0dXJuIGNhY2hlZDsKCgkJfQoKCQljb25zdCBmZXRjaE9wdGlvbnMgPSB7fTsKCQlmZXRjaE9wdGlvbnMuY3JlZGVudGlhbHMgPSAoIHRoaXMuY3Jvc3NPcmlnaW4gPT09ICdhbm9ueW1vdXMnICkgPyAnc2FtZS1vcmlnaW4nIDogJ2luY2x1ZGUnOwoJCWZldGNoT3B0aW9ucy5oZWFkZXJzID0gdGhpcy5yZXF1ZXN0SGVhZGVyOwoKCQlmZXRjaCggdXJsLCBmZXRjaE9wdGlvbnMgKS50aGVuKCBmdW5jdGlvbiAoIHJlcyApIHsKCgkJCXJldHVybiByZXMuYmxvYigpOwoKCQl9ICkudGhlbiggZnVuY3Rpb24gKCBibG9iICkgewoKCQkJcmV0dXJuIGNyZWF0ZUltYWdlQml0bWFwKCBibG9iLCBPYmplY3QuYXNzaWduKCBzY29wZS5vcHRpb25zLCB7IGNvbG9yU3BhY2VDb252ZXJzaW9uOiAnbm9uZScgfSApICk7CgoJCX0gKS50aGVuKCBmdW5jdGlvbiAoIGltYWdlQml0bWFwICkgewoKCQkJQ2FjaGUuYWRkKCB1cmwsIGltYWdlQml0bWFwICk7CgoJCQlpZiAoIG9uTG9hZCApIG9uTG9hZCggaW1hZ2VCaXRtYXAgKTsKCgkJCXNjb3BlLm1hbmFnZXIuaXRlbUVuZCggdXJsICk7CgoJCX0gKS5jYXRjaCggZnVuY3Rpb24gKCBlICkgewoKCQkJaWYgKCBvbkVycm9yICkgb25FcnJvciggZSApOwoKCQkJc2NvcGUubWFuYWdlci5pdGVtRXJyb3IoIHVybCApOwoJCQlzY29wZS5tYW5hZ2VyLml0ZW1FbmQoIHVybCApOwoKCQl9ICk7CgoJCXNjb3BlLm1hbmFnZXIuaXRlbVN0YXJ0KCB1cmwgKTsKCgl9Cgp9CgpsZXQgX2NvbnRleHQ7CgpjbGFzcyBBdWRpb0NvbnRleHQgewoKCXN0YXRpYyBnZXRDb250ZXh0KCkgewoKCQlpZiAoIF9jb250ZXh0ID09PSB1bmRlZmluZWQgKSB7CgoJCQlfY29udGV4dCA9IG5ldyAoIHdpbmRvdy5BdWRpb0NvbnRleHQgfHwgd2luZG93LndlYmtpdEF1ZGlvQ29udGV4dCApKCk7CgoJCX0KCgkJcmV0dXJuIF9jb250ZXh0OwoKCX0KCglzdGF0aWMgc2V0Q29udGV4dCggdmFsdWUgKSB7CgoJCV9jb250ZXh0ID0gdmFsdWU7CgoJfQoKfQoKY2xhc3MgQXVkaW9Mb2FkZXIgZXh0ZW5kcyBMb2FkZXIgewoKCWNvbnN0cnVjdG9yKCBtYW5hZ2VyICkgewoKCQlzdXBlciggbWFuYWdlciApOwoKCX0KCglsb2FkKCB1cmwsIG9uTG9hZCwgb25Qcm9ncmVzcywgb25FcnJvciApIHsKCgkJY29uc3Qgc2NvcGUgPSB0aGlzOwoKCQljb25zdCBsb2FkZXIgPSBuZXcgRmlsZUxvYWRlciggdGhpcy5tYW5hZ2VyICk7CgkJbG9hZGVyLnNldFJlc3BvbnNlVHlwZSggJ2FycmF5YnVmZmVyJyApOwoJCWxvYWRlci5zZXRQYXRoKCB0aGlzLnBhdGggKTsKCQlsb2FkZXIuc2V0UmVxdWVzdEhlYWRlciggdGhpcy5yZXF1ZXN0SGVhZGVyICk7CgkJbG9hZGVyLnNldFdpdGhDcmVkZW50aWFscyggdGhpcy53aXRoQ3JlZGVudGlhbHMgKTsKCQlsb2FkZXIubG9hZCggdXJsLCBmdW5jdGlvbiAoIGJ1ZmZlciApIHsKCgkJCXRyeSB7CgoJCQkJLy8gQ3JlYXRlIGEgY29weSBvZiB0aGUgYnVmZmVyLiBUaGUgYGRlY29kZUF1ZGlvRGF0YWAgbWV0aG9kCgkJCQkvLyBkZXRhY2hlcyB0aGUgYnVmZmVyIHdoZW4gY29tcGxldGUsIHByZXZlbnRpbmcgcmV1c2UuCgkJCQljb25zdCBidWZmZXJDb3B5ID0gYnVmZmVyLnNsaWNlKCAwICk7CgoJCQkJY29uc3QgY29udGV4dCA9IEF1ZGlvQ29udGV4dC5nZXRDb250ZXh0KCk7CgkJCQljb250ZXh0LmRlY29kZUF1ZGlvRGF0YSggYnVmZmVyQ29weSwgZnVuY3Rpb24gKCBhdWRpb0J1ZmZlciApIHsKCgkJCQkJb25Mb2FkKCBhdWRpb0J1ZmZlciApOwoKCQkJCX0sIGhhbmRsZUVycm9yICk7CgoJCQl9IGNhdGNoICggZSApIHsKCgkJCQloYW5kbGVFcnJvciggZSApOwoKCQkJfQoKCQl9LCBvblByb2dyZXNzLCBvbkVycm9yICk7CgoJCWZ1bmN0aW9uIGhhbmRsZUVycm9yKCBlICkgewoKCQkJaWYgKCBvbkVycm9yICkgewoKCQkJCW9uRXJyb3IoIGUgKTsKCgkJCX0gZWxzZSB7CgoJCQkJY29uc29sZS5lcnJvciggZSApOwoKCQkJfQoKCQkJc2NvcGUubWFuYWdlci5pdGVtRXJyb3IoIHVybCApOwoKCQl9CgoJfQoKfQoKY29uc3QgX2V5ZVJpZ2h0ID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwpjb25zdCBfZXllTGVmdCA9IC8qQF9fUFVSRV9fKi8gbmV3IE1hdHJpeDQoKTsKY29uc3QgX3Byb2plY3Rpb25NYXRyaXggPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXg0KCk7CgpjbGFzcyBTdGVyZW9DYW1lcmEgewoKCWNvbnN0cnVjdG9yKCkgewoKCQl0aGlzLnR5cGUgPSAnU3RlcmVvQ2FtZXJhJzsKCgkJdGhpcy5hc3BlY3QgPSAxOwoKCQl0aGlzLmV5ZVNlcCA9IDAuMDY0OwoKCQl0aGlzLmNhbWVyYUwgPSBuZXcgUGVyc3BlY3RpdmVDYW1lcmEoKTsKCQl0aGlzLmNhbWVyYUwubGF5ZXJzLmVuYWJsZSggMSApOwoJCXRoaXMuY2FtZXJhTC5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgoJCXRoaXMuY2FtZXJhUiA9IG5ldyBQZXJzcGVjdGl2ZUNhbWVyYSgpOwoJCXRoaXMuY2FtZXJhUi5sYXllcnMuZW5hYmxlKCAyICk7CgkJdGhpcy5jYW1lcmFSLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCgkJdGhpcy5fY2FjaGUgPSB7CgkJCWZvY3VzOiBudWxsLAoJCQlmb3Y6IG51bGwsCgkJCWFzcGVjdDogbnVsbCwKCQkJbmVhcjogbnVsbCwKCQkJZmFyOiBudWxsLAoJCQl6b29tOiBudWxsLAoJCQlleWVTZXA6IG51bGwKCQl9OwoKCX0KCgl1cGRhdGUoIGNhbWVyYSApIHsKCgkJY29uc3QgY2FjaGUgPSB0aGlzLl9jYWNoZTsKCgkJY29uc3QgbmVlZHNVcGRhdGUgPSBjYWNoZS5mb2N1cyAhPT0gY2FtZXJhLmZvY3VzIHx8IGNhY2hlLmZvdiAhPT0gY2FtZXJhLmZvdiB8fAoJCQljYWNoZS5hc3BlY3QgIT09IGNhbWVyYS5hc3BlY3QgKiB0aGlzLmFzcGVjdCB8fCBjYWNoZS5uZWFyICE9PSBjYW1lcmEubmVhciB8fAoJCQljYWNoZS5mYXIgIT09IGNhbWVyYS5mYXIgfHwgY2FjaGUuem9vbSAhPT0gY2FtZXJhLnpvb20gfHwgY2FjaGUuZXllU2VwICE9PSB0aGlzLmV5ZVNlcDsKCgkJaWYgKCBuZWVkc1VwZGF0ZSApIHsKCgkJCWNhY2hlLmZvY3VzID0gY2FtZXJhLmZvY3VzOwoJCQljYWNoZS5mb3YgPSBjYW1lcmEuZm92OwoJCQljYWNoZS5hc3BlY3QgPSBjYW1lcmEuYXNwZWN0ICogdGhpcy5hc3BlY3Q7CgkJCWNhY2hlLm5lYXIgPSBjYW1lcmEubmVhcjsKCQkJY2FjaGUuZmFyID0gY2FtZXJhLmZhcjsKCQkJY2FjaGUuem9vbSA9IGNhbWVyYS56b29tOwoJCQljYWNoZS5leWVTZXAgPSB0aGlzLmV5ZVNlcDsKCgkJCS8vIE9mZi1heGlzIHN0ZXJlb3Njb3BpYyBlZmZlY3QgYmFzZWQgb24KCQkJLy8gaHR0cDovL3BhdWxib3Vya2UubmV0L3N0ZXJlb2dyYXBoaWNzL3N0ZXJlb3JlbmRlci8KCgkJCV9wcm9qZWN0aW9uTWF0cml4LmNvcHkoIGNhbWVyYS5wcm9qZWN0aW9uTWF0cml4ICk7CgkJCWNvbnN0IGV5ZVNlcEhhbGYgPSBjYWNoZS5leWVTZXAgLyAyOwoJCQljb25zdCBleWVTZXBPblByb2plY3Rpb24gPSBleWVTZXBIYWxmICogY2FjaGUubmVhciAvIGNhY2hlLmZvY3VzOwoJCQljb25zdCB5bWF4ID0gKCBjYWNoZS5uZWFyICogTWF0aC50YW4oIERFRzJSQUQgKiBjYWNoZS5mb3YgKiAwLjUgKSApIC8gY2FjaGUuem9vbTsKCQkJbGV0IHhtaW4sIHhtYXg7CgoJCQkvLyB0cmFuc2xhdGUgeE9mZnNldAoKCQkJX2V5ZUxlZnQuZWxlbWVudHNbIDEyIF0gPSAtIGV5ZVNlcEhhbGY7CgkJCV9leWVSaWdodC5lbGVtZW50c1sgMTIgXSA9IGV5ZVNlcEhhbGY7CgoJCQkvLyBmb3IgbGVmdCBleWUKCgkJCXhtaW4gPSAtIHltYXggKiBjYWNoZS5hc3BlY3QgKyBleWVTZXBPblByb2plY3Rpb247CgkJCXhtYXggPSB5bWF4ICogY2FjaGUuYXNwZWN0ICsgZXllU2VwT25Qcm9qZWN0aW9uOwoKCQkJX3Byb2plY3Rpb25NYXRyaXguZWxlbWVudHNbIDAgXSA9IDIgKiBjYWNoZS5uZWFyIC8gKCB4bWF4IC0geG1pbiApOwoJCQlfcHJvamVjdGlvbk1hdHJpeC5lbGVtZW50c1sgOCBdID0gKCB4bWF4ICsgeG1pbiApIC8gKCB4bWF4IC0geG1pbiApOwoKCQkJdGhpcy5jYW1lcmFMLnByb2plY3Rpb25NYXRyaXguY29weSggX3Byb2plY3Rpb25NYXRyaXggKTsKCgkJCS8vIGZvciByaWdodCBleWUKCgkJCXhtaW4gPSAtIHltYXggKiBjYWNoZS5hc3BlY3QgLSBleWVTZXBPblByb2plY3Rpb247CgkJCXhtYXggPSB5bWF4ICogY2FjaGUuYXNwZWN0IC0gZXllU2VwT25Qcm9qZWN0aW9uOwoKCQkJX3Byb2plY3Rpb25NYXRyaXguZWxlbWVudHNbIDAgXSA9IDIgKiBjYWNoZS5uZWFyIC8gKCB4bWF4IC0geG1pbiApOwoJCQlfcHJvamVjdGlvbk1hdHJpeC5lbGVtZW50c1sgOCBdID0gKCB4bWF4ICsgeG1pbiApIC8gKCB4bWF4IC0geG1pbiApOwoKCQkJdGhpcy5jYW1lcmFSLnByb2plY3Rpb25NYXRyaXguY29weSggX3Byb2plY3Rpb25NYXRyaXggKTsKCgkJfQoKCQl0aGlzLmNhbWVyYUwubWF0cml4V29ybGQuY29weSggY2FtZXJhLm1hdHJpeFdvcmxkICkubXVsdGlwbHkoIF9leWVMZWZ0ICk7CgkJdGhpcy5jYW1lcmFSLm1hdHJpeFdvcmxkLmNvcHkoIGNhbWVyYS5tYXRyaXhXb3JsZCApLm11bHRpcGx5KCBfZXllUmlnaHQgKTsKCgl9Cgp9CgpjbGFzcyBDbG9jayB7CgoJY29uc3RydWN0b3IoIGF1dG9TdGFydCA9IHRydWUgKSB7CgoJCXRoaXMuYXV0b1N0YXJ0ID0gYXV0b1N0YXJ0OwoKCQl0aGlzLnN0YXJ0VGltZSA9IDA7CgkJdGhpcy5vbGRUaW1lID0gMDsKCQl0aGlzLmVsYXBzZWRUaW1lID0gMDsKCgkJdGhpcy5ydW5uaW5nID0gZmFsc2U7CgoJfQoKCXN0YXJ0KCkgewoKCQl0aGlzLnN0YXJ0VGltZSA9IG5vdygpOwoKCQl0aGlzLm9sZFRpbWUgPSB0aGlzLnN0YXJ0VGltZTsKCQl0aGlzLmVsYXBzZWRUaW1lID0gMDsKCQl0aGlzLnJ1bm5pbmcgPSB0cnVlOwoKCX0KCglzdG9wKCkgewoKCQl0aGlzLmdldEVsYXBzZWRUaW1lKCk7CgkJdGhpcy5ydW5uaW5nID0gZmFsc2U7CgkJdGhpcy5hdXRvU3RhcnQgPSBmYWxzZTsKCgl9CgoJZ2V0RWxhcHNlZFRpbWUoKSB7CgoJCXRoaXMuZ2V0RGVsdGEoKTsKCQlyZXR1cm4gdGhpcy5lbGFwc2VkVGltZTsKCgl9CgoJZ2V0RGVsdGEoKSB7CgoJCWxldCBkaWZmID0gMDsKCgkJaWYgKCB0aGlzLmF1dG9TdGFydCAmJiAhIHRoaXMucnVubmluZyApIHsKCgkJCXRoaXMuc3RhcnQoKTsKCQkJcmV0dXJuIDA7CgoJCX0KCgkJaWYgKCB0aGlzLnJ1bm5pbmcgKSB7CgoJCQljb25zdCBuZXdUaW1lID0gbm93KCk7CgoJCQlkaWZmID0gKCBuZXdUaW1lIC0gdGhpcy5vbGRUaW1lICkgLyAxMDAwOwoJCQl0aGlzLm9sZFRpbWUgPSBuZXdUaW1lOwoKCQkJdGhpcy5lbGFwc2VkVGltZSArPSBkaWZmOwoKCQl9CgoJCXJldHVybiBkaWZmOwoKCX0KCn0KCmZ1bmN0aW9uIG5vdygpIHsKCglyZXR1cm4gKCB0eXBlb2YgcGVyZm9ybWFuY2UgPT09ICd1bmRlZmluZWQnID8gRGF0ZSA6IHBlcmZvcm1hbmNlICkubm93KCk7IC8vIHNlZSAjMTA3MzIKCn0KCmNvbnN0IF9wb3NpdGlvbiQxID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfcXVhdGVybmlvbiQxID0gLypAX19QVVJFX18qLyBuZXcgUXVhdGVybmlvbigpOwpjb25zdCBfc2NhbGUkMSA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX29yaWVudGF0aW9uJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgpjbGFzcyBBdWRpb0xpc3RlbmVyIGV4dGVuZHMgT2JqZWN0M0QgewoKCWNvbnN0cnVjdG9yKCkgewoKCQlzdXBlcigpOwoKCQl0aGlzLnR5cGUgPSAnQXVkaW9MaXN0ZW5lcic7CgoJCXRoaXMuY29udGV4dCA9IEF1ZGlvQ29udGV4dC5nZXRDb250ZXh0KCk7CgoJCXRoaXMuZ2FpbiA9IHRoaXMuY29udGV4dC5jcmVhdGVHYWluKCk7CgkJdGhpcy5nYWluLmNvbm5lY3QoIHRoaXMuY29udGV4dC5kZXN0aW5hdGlvbiApOwoKCQl0aGlzLmZpbHRlciA9IG51bGw7CgoJCXRoaXMudGltZURlbHRhID0gMDsKCgkJLy8gcHJpdmF0ZQoKCQl0aGlzLl9jbG9jayA9IG5ldyBDbG9jaygpOwoKCX0KCglnZXRJbnB1dCgpIHsKCgkJcmV0dXJuIHRoaXMuZ2FpbjsKCgl9CgoJcmVtb3ZlRmlsdGVyKCkgewoKCQlpZiAoIHRoaXMuZmlsdGVyICE9PSBudWxsICkgewoKCQkJdGhpcy5nYWluLmRpc2Nvbm5lY3QoIHRoaXMuZmlsdGVyICk7CgkJCXRoaXMuZmlsdGVyLmRpc2Nvbm5lY3QoIHRoaXMuY29udGV4dC5kZXN0aW5hdGlvbiApOwoJCQl0aGlzLmdhaW4uY29ubmVjdCggdGhpcy5jb250ZXh0LmRlc3RpbmF0aW9uICk7CgkJCXRoaXMuZmlsdGVyID0gbnVsbDsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0RmlsdGVyKCkgewoKCQlyZXR1cm4gdGhpcy5maWx0ZXI7CgoJfQoKCXNldEZpbHRlciggdmFsdWUgKSB7CgoJCWlmICggdGhpcy5maWx0ZXIgIT09IG51bGwgKSB7CgoJCQl0aGlzLmdhaW4uZGlzY29ubmVjdCggdGhpcy5maWx0ZXIgKTsKCQkJdGhpcy5maWx0ZXIuZGlzY29ubmVjdCggdGhpcy5jb250ZXh0LmRlc3RpbmF0aW9uICk7CgoJCX0gZWxzZSB7CgoJCQl0aGlzLmdhaW4uZGlzY29ubmVjdCggdGhpcy5jb250ZXh0LmRlc3RpbmF0aW9uICk7CgoJCX0KCgkJdGhpcy5maWx0ZXIgPSB2YWx1ZTsKCQl0aGlzLmdhaW4uY29ubmVjdCggdGhpcy5maWx0ZXIgKTsKCQl0aGlzLmZpbHRlci5jb25uZWN0KCB0aGlzLmNvbnRleHQuZGVzdGluYXRpb24gKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWdldE1hc3RlclZvbHVtZSgpIHsKCgkJcmV0dXJuIHRoaXMuZ2Fpbi5nYWluLnZhbHVlOwoKCX0KCglzZXRNYXN0ZXJWb2x1bWUoIHZhbHVlICkgewoKCQl0aGlzLmdhaW4uZ2Fpbi5zZXRUYXJnZXRBdFRpbWUoIHZhbHVlLCB0aGlzLmNvbnRleHQuY3VycmVudFRpbWUsIDAuMDEgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXVwZGF0ZU1hdHJpeFdvcmxkKCBmb3JjZSApIHsKCgkJc3VwZXIudXBkYXRlTWF0cml4V29ybGQoIGZvcmNlICk7CgoJCWNvbnN0IGxpc3RlbmVyID0gdGhpcy5jb250ZXh0Lmxpc3RlbmVyOwoJCWNvbnN0IHVwID0gdGhpcy51cDsKCgkJdGhpcy50aW1lRGVsdGEgPSB0aGlzLl9jbG9jay5nZXREZWx0YSgpOwoKCQl0aGlzLm1hdHJpeFdvcmxkLmRlY29tcG9zZSggX3Bvc2l0aW9uJDEsIF9xdWF0ZXJuaW9uJDEsIF9zY2FsZSQxICk7CgoJCV9vcmllbnRhdGlvbiQxLnNldCggMCwgMCwgLSAxICkuYXBwbHlRdWF0ZXJuaW9uKCBfcXVhdGVybmlvbiQxICk7CgoJCWlmICggbGlzdGVuZXIucG9zaXRpb25YICkgewoKCQkJLy8gY29kZSBwYXRoIGZvciBDaHJvbWUgKHNlZSAjMTQzOTMpCgoJCQljb25zdCBlbmRUaW1lID0gdGhpcy5jb250ZXh0LmN1cnJlbnRUaW1lICsgdGhpcy50aW1lRGVsdGE7CgoJCQlsaXN0ZW5lci5wb3NpdGlvblgubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIF9wb3NpdGlvbiQxLngsIGVuZFRpbWUgKTsKCQkJbGlzdGVuZXIucG9zaXRpb25ZLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKCBfcG9zaXRpb24kMS55LCBlbmRUaW1lICk7CgkJCWxpc3RlbmVyLnBvc2l0aW9uWi5saW5lYXJSYW1wVG9WYWx1ZUF0VGltZSggX3Bvc2l0aW9uJDEueiwgZW5kVGltZSApOwoJCQlsaXN0ZW5lci5mb3J3YXJkWC5saW5lYXJSYW1wVG9WYWx1ZUF0VGltZSggX29yaWVudGF0aW9uJDEueCwgZW5kVGltZSApOwoJCQlsaXN0ZW5lci5mb3J3YXJkWS5saW5lYXJSYW1wVG9WYWx1ZUF0VGltZSggX29yaWVudGF0aW9uJDEueSwgZW5kVGltZSApOwoJCQlsaXN0ZW5lci5mb3J3YXJkWi5saW5lYXJSYW1wVG9WYWx1ZUF0VGltZSggX29yaWVudGF0aW9uJDEueiwgZW5kVGltZSApOwoJCQlsaXN0ZW5lci51cFgubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIHVwLngsIGVuZFRpbWUgKTsKCQkJbGlzdGVuZXIudXBZLmxpbmVhclJhbXBUb1ZhbHVlQXRUaW1lKCB1cC55LCBlbmRUaW1lICk7CgkJCWxpc3RlbmVyLnVwWi5saW5lYXJSYW1wVG9WYWx1ZUF0VGltZSggdXAueiwgZW5kVGltZSApOwoKCQl9IGVsc2UgewoKCQkJbGlzdGVuZXIuc2V0UG9zaXRpb24oIF9wb3NpdGlvbiQxLngsIF9wb3NpdGlvbiQxLnksIF9wb3NpdGlvbiQxLnogKTsKCQkJbGlzdGVuZXIuc2V0T3JpZW50YXRpb24oIF9vcmllbnRhdGlvbiQxLngsIF9vcmllbnRhdGlvbiQxLnksIF9vcmllbnRhdGlvbiQxLnosIHVwLngsIHVwLnksIHVwLnogKTsKCgkJfQoKCX0KCn0KCmNsYXNzIEF1ZGlvIGV4dGVuZHMgT2JqZWN0M0QgewoKCWNvbnN0cnVjdG9yKCBsaXN0ZW5lciApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy50eXBlID0gJ0F1ZGlvJzsKCgkJdGhpcy5saXN0ZW5lciA9IGxpc3RlbmVyOwoJCXRoaXMuY29udGV4dCA9IGxpc3RlbmVyLmNvbnRleHQ7CgoJCXRoaXMuZ2FpbiA9IHRoaXMuY29udGV4dC5jcmVhdGVHYWluKCk7CgkJdGhpcy5nYWluLmNvbm5lY3QoIGxpc3RlbmVyLmdldElucHV0KCkgKTsKCgkJdGhpcy5hdXRvcGxheSA9IGZhbHNlOwoKCQl0aGlzLmJ1ZmZlciA9IG51bGw7CgkJdGhpcy5kZXR1bmUgPSAwOwoJCXRoaXMubG9vcCA9IGZhbHNlOwoJCXRoaXMubG9vcFN0YXJ0ID0gMDsKCQl0aGlzLmxvb3BFbmQgPSAwOwoJCXRoaXMub2Zmc2V0ID0gMDsKCQl0aGlzLmR1cmF0aW9uID0gdW5kZWZpbmVkOwoJCXRoaXMucGxheWJhY2tSYXRlID0gMTsKCQl0aGlzLmlzUGxheWluZyA9IGZhbHNlOwoJCXRoaXMuaGFzUGxheWJhY2tDb250cm9sID0gdHJ1ZTsKCQl0aGlzLnNvdXJjZSA9IG51bGw7CgkJdGhpcy5zb3VyY2VUeXBlID0gJ2VtcHR5JzsKCgkJdGhpcy5fc3RhcnRlZEF0ID0gMDsKCQl0aGlzLl9wcm9ncmVzcyA9IDA7CgkJdGhpcy5fY29ubmVjdGVkID0gZmFsc2U7CgoJCXRoaXMuZmlsdGVycyA9IFtdOwoKCX0KCglnZXRPdXRwdXQoKSB7CgoJCXJldHVybiB0aGlzLmdhaW47CgoJfQoKCXNldE5vZGVTb3VyY2UoIGF1ZGlvTm9kZSApIHsKCgkJdGhpcy5oYXNQbGF5YmFja0NvbnRyb2wgPSBmYWxzZTsKCQl0aGlzLnNvdXJjZVR5cGUgPSAnYXVkaW9Ob2RlJzsKCQl0aGlzLnNvdXJjZSA9IGF1ZGlvTm9kZTsKCQl0aGlzLmNvbm5lY3QoKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldE1lZGlhRWxlbWVudFNvdXJjZSggbWVkaWFFbGVtZW50ICkgewoKCQl0aGlzLmhhc1BsYXliYWNrQ29udHJvbCA9IGZhbHNlOwoJCXRoaXMuc291cmNlVHlwZSA9ICdtZWRpYU5vZGUnOwoJCXRoaXMuc291cmNlID0gdGhpcy5jb250ZXh0LmNyZWF0ZU1lZGlhRWxlbWVudFNvdXJjZSggbWVkaWFFbGVtZW50ICk7CgkJdGhpcy5jb25uZWN0KCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRNZWRpYVN0cmVhbVNvdXJjZSggbWVkaWFTdHJlYW0gKSB7CgoJCXRoaXMuaGFzUGxheWJhY2tDb250cm9sID0gZmFsc2U7CgkJdGhpcy5zb3VyY2VUeXBlID0gJ21lZGlhU3RyZWFtTm9kZSc7CgkJdGhpcy5zb3VyY2UgPSB0aGlzLmNvbnRleHQuY3JlYXRlTWVkaWFTdHJlYW1Tb3VyY2UoIG1lZGlhU3RyZWFtICk7CgkJdGhpcy5jb25uZWN0KCk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRCdWZmZXIoIGF1ZGlvQnVmZmVyICkgewoKCQl0aGlzLmJ1ZmZlciA9IGF1ZGlvQnVmZmVyOwoJCXRoaXMuc291cmNlVHlwZSA9ICdidWZmZXInOwoKCQlpZiAoIHRoaXMuYXV0b3BsYXkgKSB0aGlzLnBsYXkoKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXBsYXkoIGRlbGF5ID0gMCApIHsKCgkJaWYgKCB0aGlzLmlzUGxheWluZyA9PT0gdHJ1ZSApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkF1ZGlvOiBBdWRpbyBpcyBhbHJlYWR5IHBsYXlpbmcuJyApOwoJCQlyZXR1cm47CgoJCX0KCgkJaWYgKCB0aGlzLmhhc1BsYXliYWNrQ29udHJvbCA9PT0gZmFsc2UgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5BdWRpbzogdGhpcyBBdWRpbyBoYXMgbm8gcGxheWJhY2sgY29udHJvbC4nICk7CgkJCXJldHVybjsKCgkJfQoKCQl0aGlzLl9zdGFydGVkQXQgPSB0aGlzLmNvbnRleHQuY3VycmVudFRpbWUgKyBkZWxheTsKCgkJY29uc3Qgc291cmNlID0gdGhpcy5jb250ZXh0LmNyZWF0ZUJ1ZmZlclNvdXJjZSgpOwoJCXNvdXJjZS5idWZmZXIgPSB0aGlzLmJ1ZmZlcjsKCQlzb3VyY2UubG9vcCA9IHRoaXMubG9vcDsKCQlzb3VyY2UubG9vcFN0YXJ0ID0gdGhpcy5sb29wU3RhcnQ7CgkJc291cmNlLmxvb3BFbmQgPSB0aGlzLmxvb3BFbmQ7CgkJc291cmNlLm9uZW5kZWQgPSB0aGlzLm9uRW5kZWQuYmluZCggdGhpcyApOwoJCXNvdXJjZS5zdGFydCggdGhpcy5fc3RhcnRlZEF0LCB0aGlzLl9wcm9ncmVzcyArIHRoaXMub2Zmc2V0LCB0aGlzLmR1cmF0aW9uICk7CgoJCXRoaXMuaXNQbGF5aW5nID0gdHJ1ZTsKCgkJdGhpcy5zb3VyY2UgPSBzb3VyY2U7CgoJCXRoaXMuc2V0RGV0dW5lKCB0aGlzLmRldHVuZSApOwoJCXRoaXMuc2V0UGxheWJhY2tSYXRlKCB0aGlzLnBsYXliYWNrUmF0ZSApOwoKCQlyZXR1cm4gdGhpcy5jb25uZWN0KCk7CgoJfQoKCXBhdXNlKCkgewoKCQlpZiAoIHRoaXMuaGFzUGxheWJhY2tDb250cm9sID09PSBmYWxzZSApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLkF1ZGlvOiB0aGlzIEF1ZGlvIGhhcyBubyBwbGF5YmFjayBjb250cm9sLicgKTsKCQkJcmV0dXJuOwoKCQl9CgoJCWlmICggdGhpcy5pc1BsYXlpbmcgPT09IHRydWUgKSB7CgoJCQkvLyB1cGRhdGUgY3VycmVudCBwcm9ncmVzcwoKCQkJdGhpcy5fcHJvZ3Jlc3MgKz0gTWF0aC5tYXgoIHRoaXMuY29udGV4dC5jdXJyZW50VGltZSAtIHRoaXMuX3N0YXJ0ZWRBdCwgMCApICogdGhpcy5wbGF5YmFja1JhdGU7CgoJCQlpZiAoIHRoaXMubG9vcCA9PT0gdHJ1ZSApIHsKCgkJCQkvLyBlbnN1cmUgX3Byb2dyZXNzIGRvZXMgbm90IGV4Y2VlZCBkdXJhdGlvbiB3aXRoIGxvb3BlZCBhdWRpb3MKCgkJCQl0aGlzLl9wcm9ncmVzcyA9IHRoaXMuX3Byb2dyZXNzICUgKCB0aGlzLmR1cmF0aW9uIHx8IHRoaXMuYnVmZmVyLmR1cmF0aW9uICk7CgoJCQl9CgoJCQl0aGlzLnNvdXJjZS5zdG9wKCk7CgkJCXRoaXMuc291cmNlLm9uZW5kZWQgPSBudWxsOwoKCQkJdGhpcy5pc1BsYXlpbmcgPSBmYWxzZTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc3RvcCgpIHsKCgkJaWYgKCB0aGlzLmhhc1BsYXliYWNrQ29udHJvbCA9PT0gZmFsc2UgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5BdWRpbzogdGhpcyBBdWRpbyBoYXMgbm8gcGxheWJhY2sgY29udHJvbC4nICk7CgkJCXJldHVybjsKCgkJfQoKCQl0aGlzLl9wcm9ncmVzcyA9IDA7CgoJCWlmICggdGhpcy5zb3VyY2UgIT09IG51bGwgKSB7CgoJCQl0aGlzLnNvdXJjZS5zdG9wKCk7CgkJCXRoaXMuc291cmNlLm9uZW5kZWQgPSBudWxsOwoKCQl9CgoJCXRoaXMuaXNQbGF5aW5nID0gZmFsc2U7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljb25uZWN0KCkgewoKCQlpZiAoIHRoaXMuZmlsdGVycy5sZW5ndGggPiAwICkgewoKCQkJdGhpcy5zb3VyY2UuY29ubmVjdCggdGhpcy5maWx0ZXJzWyAwIF0gKTsKCgkJCWZvciAoIGxldCBpID0gMSwgbCA9IHRoaXMuZmlsdGVycy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJCXRoaXMuZmlsdGVyc1sgaSAtIDEgXS5jb25uZWN0KCB0aGlzLmZpbHRlcnNbIGkgXSApOwoKCQkJfQoKCQkJdGhpcy5maWx0ZXJzWyB0aGlzLmZpbHRlcnMubGVuZ3RoIC0gMSBdLmNvbm5lY3QoIHRoaXMuZ2V0T3V0cHV0KCkgKTsKCgkJfSBlbHNlIHsKCgkJCXRoaXMuc291cmNlLmNvbm5lY3QoIHRoaXMuZ2V0T3V0cHV0KCkgKTsKCgkJfQoKCQl0aGlzLl9jb25uZWN0ZWQgPSB0cnVlOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZGlzY29ubmVjdCgpIHsKCgkJaWYgKCB0aGlzLl9jb25uZWN0ZWQgPT09IGZhbHNlICkgewoKCQkJcmV0dXJuOwoKCQl9CgoJCWlmICggdGhpcy5maWx0ZXJzLmxlbmd0aCA+IDAgKSB7CgoJCQl0aGlzLnNvdXJjZS5kaXNjb25uZWN0KCB0aGlzLmZpbHRlcnNbIDAgXSApOwoKCQkJZm9yICggbGV0IGkgPSAxLCBsID0gdGhpcy5maWx0ZXJzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJdGhpcy5maWx0ZXJzWyBpIC0gMSBdLmRpc2Nvbm5lY3QoIHRoaXMuZmlsdGVyc1sgaSBdICk7CgoJCQl9CgoJCQl0aGlzLmZpbHRlcnNbIHRoaXMuZmlsdGVycy5sZW5ndGggLSAxIF0uZGlzY29ubmVjdCggdGhpcy5nZXRPdXRwdXQoKSApOwoKCQl9IGVsc2UgewoKCQkJdGhpcy5zb3VyY2UuZGlzY29ubmVjdCggdGhpcy5nZXRPdXRwdXQoKSApOwoKCQl9CgoJCXRoaXMuX2Nvbm5lY3RlZCA9IGZhbHNlOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0RmlsdGVycygpIHsKCgkJcmV0dXJuIHRoaXMuZmlsdGVyczsKCgl9CgoJc2V0RmlsdGVycyggdmFsdWUgKSB7CgoJCWlmICggISB2YWx1ZSApIHZhbHVlID0gW107CgoJCWlmICggdGhpcy5fY29ubmVjdGVkID09PSB0cnVlICkgewoKCQkJdGhpcy5kaXNjb25uZWN0KCk7CgkJCXRoaXMuZmlsdGVycyA9IHZhbHVlLnNsaWNlKCk7CgkJCXRoaXMuY29ubmVjdCgpOwoKCQl9IGVsc2UgewoKCQkJdGhpcy5maWx0ZXJzID0gdmFsdWUuc2xpY2UoKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RGV0dW5lKCB2YWx1ZSApIHsKCgkJdGhpcy5kZXR1bmUgPSB2YWx1ZTsKCgkJaWYgKCB0aGlzLnNvdXJjZS5kZXR1bmUgPT09IHVuZGVmaW5lZCApIHJldHVybjsgLy8gb25seSBzZXQgZGV0dW5lIHdoZW4gYXZhaWxhYmxlCgoJCWlmICggdGhpcy5pc1BsYXlpbmcgPT09IHRydWUgKSB7CgoJCQl0aGlzLnNvdXJjZS5kZXR1bmUuc2V0VGFyZ2V0QXRUaW1lKCB0aGlzLmRldHVuZSwgdGhpcy5jb250ZXh0LmN1cnJlbnRUaW1lLCAwLjAxICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWdldERldHVuZSgpIHsKCgkJcmV0dXJuIHRoaXMuZGV0dW5lOwoKCX0KCglnZXRGaWx0ZXIoKSB7CgoJCXJldHVybiB0aGlzLmdldEZpbHRlcnMoKVsgMCBdOwoKCX0KCglzZXRGaWx0ZXIoIGZpbHRlciApIHsKCgkJcmV0dXJuIHRoaXMuc2V0RmlsdGVycyggZmlsdGVyID8gWyBmaWx0ZXIgXSA6IFtdICk7CgoJfQoKCXNldFBsYXliYWNrUmF0ZSggdmFsdWUgKSB7CgoJCWlmICggdGhpcy5oYXNQbGF5YmFja0NvbnRyb2wgPT09IGZhbHNlICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQXVkaW86IHRoaXMgQXVkaW8gaGFzIG5vIHBsYXliYWNrIGNvbnRyb2wuJyApOwoJCQlyZXR1cm47CgoJCX0KCgkJdGhpcy5wbGF5YmFja1JhdGUgPSB2YWx1ZTsKCgkJaWYgKCB0aGlzLmlzUGxheWluZyA9PT0gdHJ1ZSApIHsKCgkJCXRoaXMuc291cmNlLnBsYXliYWNrUmF0ZS5zZXRUYXJnZXRBdFRpbWUoIHRoaXMucGxheWJhY2tSYXRlLCB0aGlzLmNvbnRleHQuY3VycmVudFRpbWUsIDAuMDEgKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0UGxheWJhY2tSYXRlKCkgewoKCQlyZXR1cm4gdGhpcy5wbGF5YmFja1JhdGU7CgoJfQoKCW9uRW5kZWQoKSB7CgoJCXRoaXMuaXNQbGF5aW5nID0gZmFsc2U7CgoJfQoKCWdldExvb3AoKSB7CgoJCWlmICggdGhpcy5oYXNQbGF5YmFja0NvbnRyb2wgPT09IGZhbHNlICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQXVkaW86IHRoaXMgQXVkaW8gaGFzIG5vIHBsYXliYWNrIGNvbnRyb2wuJyApOwoJCQlyZXR1cm4gZmFsc2U7CgoJCX0KCgkJcmV0dXJuIHRoaXMubG9vcDsKCgl9CgoJc2V0TG9vcCggdmFsdWUgKSB7CgoJCWlmICggdGhpcy5oYXNQbGF5YmFja0NvbnRyb2wgPT09IGZhbHNlICkgewoKCQkJY29uc29sZS53YXJuKCAnVEhSRUUuQXVkaW86IHRoaXMgQXVkaW8gaGFzIG5vIHBsYXliYWNrIGNvbnRyb2wuJyApOwoJCQlyZXR1cm47CgoJCX0KCgkJdGhpcy5sb29wID0gdmFsdWU7CgoJCWlmICggdGhpcy5pc1BsYXlpbmcgPT09IHRydWUgKSB7CgoJCQl0aGlzLnNvdXJjZS5sb29wID0gdGhpcy5sb29wOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRMb29wU3RhcnQoIHZhbHVlICkgewoKCQl0aGlzLmxvb3BTdGFydCA9IHZhbHVlOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0TG9vcEVuZCggdmFsdWUgKSB7CgoJCXRoaXMubG9vcEVuZCA9IHZhbHVlOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0Vm9sdW1lKCkgewoKCQlyZXR1cm4gdGhpcy5nYWluLmdhaW4udmFsdWU7CgoJfQoKCXNldFZvbHVtZSggdmFsdWUgKSB7CgoJCXRoaXMuZ2Fpbi5nYWluLnNldFRhcmdldEF0VGltZSggdmFsdWUsIHRoaXMuY29udGV4dC5jdXJyZW50VGltZSwgMC4wMSApOwoKCQlyZXR1cm4gdGhpczsKCgl9Cgp9Cgpjb25zdCBfcG9zaXRpb24gPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF9xdWF0ZXJuaW9uID0gLypAX19QVVJFX18qLyBuZXcgUXVhdGVybmlvbigpOwpjb25zdCBfc2NhbGUgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF9vcmllbnRhdGlvbiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKCmNsYXNzIFBvc2l0aW9uYWxBdWRpbyBleHRlbmRzIEF1ZGlvIHsKCgljb25zdHJ1Y3RvciggbGlzdGVuZXIgKSB7CgoJCXN1cGVyKCBsaXN0ZW5lciApOwoKCQl0aGlzLnBhbm5lciA9IHRoaXMuY29udGV4dC5jcmVhdGVQYW5uZXIoKTsKCQl0aGlzLnBhbm5lci5wYW5uaW5nTW9kZWwgPSAnSFJURic7CgkJdGhpcy5wYW5uZXIuY29ubmVjdCggdGhpcy5nYWluICk7CgoJfQoKCWNvbm5lY3QoKSB7CgoJCXN1cGVyLmNvbm5lY3QoKTsKCgkJdGhpcy5wYW5uZXIuY29ubmVjdCggdGhpcy5nYWluICk7CgoJfQoKCWRpc2Nvbm5lY3QoKSB7CgoJCXN1cGVyLmRpc2Nvbm5lY3QoKTsKCgkJdGhpcy5wYW5uZXIuZGlzY29ubmVjdCggdGhpcy5nYWluICk7CgoJfQoKCWdldE91dHB1dCgpIHsKCgkJcmV0dXJuIHRoaXMucGFubmVyOwoKCX0KCglnZXRSZWZEaXN0YW5jZSgpIHsKCgkJcmV0dXJuIHRoaXMucGFubmVyLnJlZkRpc3RhbmNlOwoKCX0KCglzZXRSZWZEaXN0YW5jZSggdmFsdWUgKSB7CgoJCXRoaXMucGFubmVyLnJlZkRpc3RhbmNlID0gdmFsdWU7CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXRSb2xsb2ZmRmFjdG9yKCkgewoKCQlyZXR1cm4gdGhpcy5wYW5uZXIucm9sbG9mZkZhY3RvcjsKCgl9CgoJc2V0Um9sbG9mZkZhY3RvciggdmFsdWUgKSB7CgoJCXRoaXMucGFubmVyLnJvbGxvZmZGYWN0b3IgPSB2YWx1ZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWdldERpc3RhbmNlTW9kZWwoKSB7CgoJCXJldHVybiB0aGlzLnBhbm5lci5kaXN0YW5jZU1vZGVsOwoKCX0KCglzZXREaXN0YW5jZU1vZGVsKCB2YWx1ZSApIHsKCgkJdGhpcy5wYW5uZXIuZGlzdGFuY2VNb2RlbCA9IHZhbHVlOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZ2V0TWF4RGlzdGFuY2UoKSB7CgoJCXJldHVybiB0aGlzLnBhbm5lci5tYXhEaXN0YW5jZTsKCgl9CgoJc2V0TWF4RGlzdGFuY2UoIHZhbHVlICkgewoKCQl0aGlzLnBhbm5lci5tYXhEaXN0YW5jZSA9IHZhbHVlOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RGlyZWN0aW9uYWxDb25lKCBjb25lSW5uZXJBbmdsZSwgY29uZU91dGVyQW5nbGUsIGNvbmVPdXRlckdhaW4gKSB7CgoJCXRoaXMucGFubmVyLmNvbmVJbm5lckFuZ2xlID0gY29uZUlubmVyQW5nbGU7CgkJdGhpcy5wYW5uZXIuY29uZU91dGVyQW5nbGUgPSBjb25lT3V0ZXJBbmdsZTsKCQl0aGlzLnBhbm5lci5jb25lT3V0ZXJHYWluID0gY29uZU91dGVyR2FpbjsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXVwZGF0ZU1hdHJpeFdvcmxkKCBmb3JjZSApIHsKCgkJc3VwZXIudXBkYXRlTWF0cml4V29ybGQoIGZvcmNlICk7CgoJCWlmICggdGhpcy5oYXNQbGF5YmFja0NvbnRyb2wgPT09IHRydWUgJiYgdGhpcy5pc1BsYXlpbmcgPT09IGZhbHNlICkgcmV0dXJuOwoKCQl0aGlzLm1hdHJpeFdvcmxkLmRlY29tcG9zZSggX3Bvc2l0aW9uLCBfcXVhdGVybmlvbiwgX3NjYWxlICk7CgoJCV9vcmllbnRhdGlvbi5zZXQoIDAsIDAsIDEgKS5hcHBseVF1YXRlcm5pb24oIF9xdWF0ZXJuaW9uICk7CgoJCWNvbnN0IHBhbm5lciA9IHRoaXMucGFubmVyOwoKCQlpZiAoIHBhbm5lci5wb3NpdGlvblggKSB7CgoJCQkvLyBjb2RlIHBhdGggZm9yIENocm9tZSBhbmQgRmlyZWZveCAoc2VlICMxNDM5MykKCgkJCWNvbnN0IGVuZFRpbWUgPSB0aGlzLmNvbnRleHQuY3VycmVudFRpbWUgKyB0aGlzLmxpc3RlbmVyLnRpbWVEZWx0YTsKCgkJCXBhbm5lci5wb3NpdGlvblgubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIF9wb3NpdGlvbi54LCBlbmRUaW1lICk7CgkJCXBhbm5lci5wb3NpdGlvblkubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIF9wb3NpdGlvbi55LCBlbmRUaW1lICk7CgkJCXBhbm5lci5wb3NpdGlvbloubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIF9wb3NpdGlvbi56LCBlbmRUaW1lICk7CgkJCXBhbm5lci5vcmllbnRhdGlvblgubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIF9vcmllbnRhdGlvbi54LCBlbmRUaW1lICk7CgkJCXBhbm5lci5vcmllbnRhdGlvblkubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIF9vcmllbnRhdGlvbi55LCBlbmRUaW1lICk7CgkJCXBhbm5lci5vcmllbnRhdGlvbloubGluZWFyUmFtcFRvVmFsdWVBdFRpbWUoIF9vcmllbnRhdGlvbi56LCBlbmRUaW1lICk7CgoJCX0gZWxzZSB7CgoJCQlwYW5uZXIuc2V0UG9zaXRpb24oIF9wb3NpdGlvbi54LCBfcG9zaXRpb24ueSwgX3Bvc2l0aW9uLnogKTsKCQkJcGFubmVyLnNldE9yaWVudGF0aW9uKCBfb3JpZW50YXRpb24ueCwgX29yaWVudGF0aW9uLnksIF9vcmllbnRhdGlvbi56ICk7CgoJCX0KCgl9Cgp9CgpjbGFzcyBBdWRpb0FuYWx5c2VyIHsKCgljb25zdHJ1Y3RvciggYXVkaW8sIGZmdFNpemUgPSAyMDQ4ICkgewoKCQl0aGlzLmFuYWx5c2VyID0gYXVkaW8uY29udGV4dC5jcmVhdGVBbmFseXNlcigpOwoJCXRoaXMuYW5hbHlzZXIuZmZ0U2l6ZSA9IGZmdFNpemU7CgoJCXRoaXMuZGF0YSA9IG5ldyBVaW50OEFycmF5KCB0aGlzLmFuYWx5c2VyLmZyZXF1ZW5jeUJpbkNvdW50ICk7CgoJCWF1ZGlvLmdldE91dHB1dCgpLmNvbm5lY3QoIHRoaXMuYW5hbHlzZXIgKTsKCgl9CgoKCWdldEZyZXF1ZW5jeURhdGEoKSB7CgoJCXRoaXMuYW5hbHlzZXIuZ2V0Qnl0ZUZyZXF1ZW5jeURhdGEoIHRoaXMuZGF0YSApOwoKCQlyZXR1cm4gdGhpcy5kYXRhOwoKCX0KCglnZXRBdmVyYWdlRnJlcXVlbmN5KCkgewoKCQlsZXQgdmFsdWUgPSAwOwoJCWNvbnN0IGRhdGEgPSB0aGlzLmdldEZyZXF1ZW5jeURhdGEoKTsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgZGF0YS5sZW5ndGg7IGkgKysgKSB7CgoJCQl2YWx1ZSArPSBkYXRhWyBpIF07CgoJCX0KCgkJcmV0dXJuIHZhbHVlIC8gZGF0YS5sZW5ndGg7CgoJfQoKfQoKY2xhc3MgUHJvcGVydHlNaXhlciB7CgoJY29uc3RydWN0b3IoIGJpbmRpbmcsIHR5cGVOYW1lLCB2YWx1ZVNpemUgKSB7CgoJCXRoaXMuYmluZGluZyA9IGJpbmRpbmc7CgkJdGhpcy52YWx1ZVNpemUgPSB2YWx1ZVNpemU7CgoJCWxldCBtaXhGdW5jdGlvbiwKCQkJbWl4RnVuY3Rpb25BZGRpdGl2ZSwKCQkJc2V0SWRlbnRpdHk7CgoJCS8vIGJ1ZmZlciBsYXlvdXQ6IFsgaW5jb21pbmcgfCBhY2N1MCB8IGFjY3UxIHwgb3JpZyB8IGFkZEFjY3UgfCAob3B0aW9uYWwgd29yaykgXQoJCS8vCgkJLy8gaW50ZXJwb2xhdG9ycyBjYW4gdXNlIC5idWZmZXIgYXMgdGhlaXIgLnJlc3VsdAoJCS8vIHRoZSBkYXRhIHRoZW4gZ29lcyB0byAnaW5jb21pbmcnCgkJLy8KCQkvLyAnYWNjdTAnIGFuZCAnYWNjdTEnIGFyZSB1c2VkIGZyYW1lLWludGVybGVhdmVkIGZvcgoJCS8vIHRoZSBjdW11bGF0aXZlIHJlc3VsdCBhbmQgYXJlIGNvbXBhcmVkIHRvIGRldGVjdAoJCS8vIGNoYW5nZXMKCQkvLwoJCS8vICdvcmlnJyBzdG9yZXMgdGhlIG9yaWdpbmFsIHN0YXRlIG9mIHRoZSBwcm9wZXJ0eQoJCS8vCgkJLy8gJ2FkZCcgaXMgdXNlZCBmb3IgYWRkaXRpdmUgY3VtdWxhdGl2ZSByZXN1bHRzCgkJLy8KCQkvLyAnd29yaycgaXMgb3B0aW9uYWwgYW5kIGlzIG9ubHkgcHJlc2VudCBmb3IgcXVhdGVybmlvbiB0eXBlcy4gSXQgaXMgdXNlZAoJCS8vIHRvIHN0b3JlIGludGVybWVkaWF0ZSBxdWF0ZXJuaW9uIG11bHRpcGxpY2F0aW9uIHJlc3VsdHMKCgkJc3dpdGNoICggdHlwZU5hbWUgKSB7CgoJCQljYXNlICdxdWF0ZXJuaW9uJzoKCQkJCW1peEZ1bmN0aW9uID0gdGhpcy5fc2xlcnA7CgkJCQltaXhGdW5jdGlvbkFkZGl0aXZlID0gdGhpcy5fc2xlcnBBZGRpdGl2ZTsKCQkJCXNldElkZW50aXR5ID0gdGhpcy5fc2V0QWRkaXRpdmVJZGVudGl0eVF1YXRlcm5pb247CgoJCQkJdGhpcy5idWZmZXIgPSBuZXcgRmxvYXQ2NEFycmF5KCB2YWx1ZVNpemUgKiA2ICk7CgkJCQl0aGlzLl93b3JrSW5kZXggPSA1OwoJCQkJYnJlYWs7CgoJCQljYXNlICdzdHJpbmcnOgoJCQljYXNlICdib29sJzoKCQkJCW1peEZ1bmN0aW9uID0gdGhpcy5fc2VsZWN0OwoKCQkJCS8vIFVzZSB0aGUgcmVndWxhciBtaXggZnVuY3Rpb24gYW5kIGZvciBhZGRpdGl2ZSBvbiB0aGVzZSB0eXBlcywKCQkJCS8vIGFkZGl0aXZlIGlzIG5vdCByZWxldmFudCBmb3Igbm9uLW51bWVyaWMgdHlwZXMKCQkJCW1peEZ1bmN0aW9uQWRkaXRpdmUgPSB0aGlzLl9zZWxlY3Q7CgoJCQkJc2V0SWRlbnRpdHkgPSB0aGlzLl9zZXRBZGRpdGl2ZUlkZW50aXR5T3RoZXI7CgoJCQkJdGhpcy5idWZmZXIgPSBuZXcgQXJyYXkoIHZhbHVlU2l6ZSAqIDUgKTsKCQkJCWJyZWFrOwoKCQkJZGVmYXVsdDoKCQkJCW1peEZ1bmN0aW9uID0gdGhpcy5fbGVycDsKCQkJCW1peEZ1bmN0aW9uQWRkaXRpdmUgPSB0aGlzLl9sZXJwQWRkaXRpdmU7CgkJCQlzZXRJZGVudGl0eSA9IHRoaXMuX3NldEFkZGl0aXZlSWRlbnRpdHlOdW1lcmljOwoKCQkJCXRoaXMuYnVmZmVyID0gbmV3IEZsb2F0NjRBcnJheSggdmFsdWVTaXplICogNSApOwoKCQl9CgoJCXRoaXMuX21peEJ1ZmZlclJlZ2lvbiA9IG1peEZ1bmN0aW9uOwoJCXRoaXMuX21peEJ1ZmZlclJlZ2lvbkFkZGl0aXZlID0gbWl4RnVuY3Rpb25BZGRpdGl2ZTsKCQl0aGlzLl9zZXRJZGVudGl0eSA9IHNldElkZW50aXR5OwoJCXRoaXMuX29yaWdJbmRleCA9IDM7CgkJdGhpcy5fYWRkSW5kZXggPSA0OwoKCQl0aGlzLmN1bXVsYXRpdmVXZWlnaHQgPSAwOwoJCXRoaXMuY3VtdWxhdGl2ZVdlaWdodEFkZGl0aXZlID0gMDsKCgkJdGhpcy51c2VDb3VudCA9IDA7CgkJdGhpcy5yZWZlcmVuY2VDb3VudCA9IDA7CgoJfQoKCS8vIGFjY3VtdWxhdGUgZGF0YSBpbiB0aGUgJ2luY29taW5nJyByZWdpb24gaW50byAnYWNjdTxpPicKCWFjY3VtdWxhdGUoIGFjY3VJbmRleCwgd2VpZ2h0ICkgewoKCQkvLyBub3RlOiBoYXBwaWx5IGFjY3VtdWxhdGluZyBub3RoaW5nIHdoZW4gd2VpZ2h0ID0gMCwgdGhlIGNhbGxlciBrbm93cwoJCS8vIHRoZSB3ZWlnaHQgYW5kIHNob3VsZG4ndCBoYXZlIG1hZGUgdGhlIGNhbGwgaW4gdGhlIGZpcnN0IHBsYWNlCgoJCWNvbnN0IGJ1ZmZlciA9IHRoaXMuYnVmZmVyLAoJCQlzdHJpZGUgPSB0aGlzLnZhbHVlU2l6ZSwKCQkJb2Zmc2V0ID0gYWNjdUluZGV4ICogc3RyaWRlICsgc3RyaWRlOwoKCQlsZXQgY3VycmVudFdlaWdodCA9IHRoaXMuY3VtdWxhdGl2ZVdlaWdodDsKCgkJaWYgKCBjdXJyZW50V2VpZ2h0ID09PSAwICkgewoKCQkJLy8gYWNjdU4gOj0gaW5jb21pbmcgKiB3ZWlnaHQKCgkJCWZvciAoIGxldCBpID0gMDsgaSAhPT0gc3RyaWRlOyArKyBpICkgewoKCQkJCWJ1ZmZlclsgb2Zmc2V0ICsgaSBdID0gYnVmZmVyWyBpIF07CgoJCQl9CgoJCQljdXJyZW50V2VpZ2h0ID0gd2VpZ2h0OwoKCQl9IGVsc2UgewoKCQkJLy8gYWNjdU4gOj0gYWNjdU4gKyBpbmNvbWluZyAqIHdlaWdodAoKCQkJY3VycmVudFdlaWdodCArPSB3ZWlnaHQ7CgkJCWNvbnN0IG1peCA9IHdlaWdodCAvIGN1cnJlbnRXZWlnaHQ7CgkJCXRoaXMuX21peEJ1ZmZlclJlZ2lvbiggYnVmZmVyLCBvZmZzZXQsIDAsIG1peCwgc3RyaWRlICk7CgoJCX0KCgkJdGhpcy5jdW11bGF0aXZlV2VpZ2h0ID0gY3VycmVudFdlaWdodDsKCgl9CgoJLy8gYWNjdW11bGF0ZSBkYXRhIGluIHRoZSAnaW5jb21pbmcnIHJlZ2lvbiBpbnRvICdhZGQnCglhY2N1bXVsYXRlQWRkaXRpdmUoIHdlaWdodCApIHsKCgkJY29uc3QgYnVmZmVyID0gdGhpcy5idWZmZXIsCgkJCXN0cmlkZSA9IHRoaXMudmFsdWVTaXplLAoJCQlvZmZzZXQgPSBzdHJpZGUgKiB0aGlzLl9hZGRJbmRleDsKCgkJaWYgKCB0aGlzLmN1bXVsYXRpdmVXZWlnaHRBZGRpdGl2ZSA9PT0gMCApIHsKCgkJCS8vIGFkZCA9IGlkZW50aXR5CgoJCQl0aGlzLl9zZXRJZGVudGl0eSgpOwoKCQl9CgoJCS8vIGFkZCA6PSBhZGQgKyBpbmNvbWluZyAqIHdlaWdodAoKCQl0aGlzLl9taXhCdWZmZXJSZWdpb25BZGRpdGl2ZSggYnVmZmVyLCBvZmZzZXQsIDAsIHdlaWdodCwgc3RyaWRlICk7CgkJdGhpcy5jdW11bGF0aXZlV2VpZ2h0QWRkaXRpdmUgKz0gd2VpZ2h0OwoKCX0KCgkvLyBhcHBseSB0aGUgc3RhdGUgb2YgJ2FjY3U8aT4nIHRvIHRoZSBiaW5kaW5nIHdoZW4gYWNjdXMgZGlmZmVyCglhcHBseSggYWNjdUluZGV4ICkgewoKCQljb25zdCBzdHJpZGUgPSB0aGlzLnZhbHVlU2l6ZSwKCQkJYnVmZmVyID0gdGhpcy5idWZmZXIsCgkJCW9mZnNldCA9IGFjY3VJbmRleCAqIHN0cmlkZSArIHN0cmlkZSwKCgkJCXdlaWdodCA9IHRoaXMuY3VtdWxhdGl2ZVdlaWdodCwKCQkJd2VpZ2h0QWRkaXRpdmUgPSB0aGlzLmN1bXVsYXRpdmVXZWlnaHRBZGRpdGl2ZSwKCgkJCWJpbmRpbmcgPSB0aGlzLmJpbmRpbmc7CgoJCXRoaXMuY3VtdWxhdGl2ZVdlaWdodCA9IDA7CgkJdGhpcy5jdW11bGF0aXZlV2VpZ2h0QWRkaXRpdmUgPSAwOwoKCQlpZiAoIHdlaWdodCA8IDEgKSB7CgoJCQkvLyBhY2N1TiA6PSBhY2N1TiArIG9yaWdpbmFsICogKCAxIC0gY3VtdWxhdGl2ZVdlaWdodCApCgoJCQljb25zdCBvcmlnaW5hbFZhbHVlT2Zmc2V0ID0gc3RyaWRlICogdGhpcy5fb3JpZ0luZGV4OwoKCQkJdGhpcy5fbWl4QnVmZmVyUmVnaW9uKAoJCQkJYnVmZmVyLCBvZmZzZXQsIG9yaWdpbmFsVmFsdWVPZmZzZXQsIDEgLSB3ZWlnaHQsIHN0cmlkZSApOwoKCQl9CgoJCWlmICggd2VpZ2h0QWRkaXRpdmUgPiAwICkgewoKCQkJLy8gYWNjdU4gOj0gYWNjdU4gKyBhZGRpdGl2ZSBhY2N1TgoKCQkJdGhpcy5fbWl4QnVmZmVyUmVnaW9uQWRkaXRpdmUoIGJ1ZmZlciwgb2Zmc2V0LCB0aGlzLl9hZGRJbmRleCAqIHN0cmlkZSwgMSwgc3RyaWRlICk7CgoJCX0KCgkJZm9yICggbGV0IGkgPSBzdHJpZGUsIGUgPSBzdHJpZGUgKyBzdHJpZGU7IGkgIT09IGU7ICsrIGkgKSB7CgoJCQlpZiAoIGJ1ZmZlclsgaSBdICE9PSBidWZmZXJbIGkgKyBzdHJpZGUgXSApIHsKCgkJCQkvLyB2YWx1ZSBoYXMgY2hhbmdlZCAtPiB1cGRhdGUgc2NlbmUgZ3JhcGgKCgkJCQliaW5kaW5nLnNldFZhbHVlKCBidWZmZXIsIG9mZnNldCApOwoJCQkJYnJlYWs7CgoJCQl9CgoJCX0KCgl9CgoJLy8gcmVtZW1iZXIgdGhlIHN0YXRlIG9mIHRoZSBib3VuZCBwcm9wZXJ0eSBhbmQgY29weSBpdCB0byBib3RoIGFjY3VzCglzYXZlT3JpZ2luYWxTdGF0ZSgpIHsKCgkJY29uc3QgYmluZGluZyA9IHRoaXMuYmluZGluZzsKCgkJY29uc3QgYnVmZmVyID0gdGhpcy5idWZmZXIsCgkJCXN0cmlkZSA9IHRoaXMudmFsdWVTaXplLAoKCQkJb3JpZ2luYWxWYWx1ZU9mZnNldCA9IHN0cmlkZSAqIHRoaXMuX29yaWdJbmRleDsKCgkJYmluZGluZy5nZXRWYWx1ZSggYnVmZmVyLCBvcmlnaW5hbFZhbHVlT2Zmc2V0ICk7CgoJCS8vIGFjY3VbMC4uMV0gOj0gb3JpZyAtLSBpbml0aWFsbHkgZGV0ZWN0IGNoYW5nZXMgYWdhaW5zdCB0aGUgb3JpZ2luYWwKCQlmb3IgKCBsZXQgaSA9IHN0cmlkZSwgZSA9IG9yaWdpbmFsVmFsdWVPZmZzZXQ7IGkgIT09IGU7ICsrIGkgKSB7CgoJCQlidWZmZXJbIGkgXSA9IGJ1ZmZlclsgb3JpZ2luYWxWYWx1ZU9mZnNldCArICggaSAlIHN0cmlkZSApIF07CgoJCX0KCgkJLy8gQWRkIHRvIGlkZW50aXR5IGZvciBhZGRpdGl2ZQoJCXRoaXMuX3NldElkZW50aXR5KCk7CgoJCXRoaXMuY3VtdWxhdGl2ZVdlaWdodCA9IDA7CgkJdGhpcy5jdW11bGF0aXZlV2VpZ2h0QWRkaXRpdmUgPSAwOwoKCX0KCgkvLyBhcHBseSB0aGUgc3RhdGUgcHJldmlvdXNseSB0YWtlbiB2aWEgJ3NhdmVPcmlnaW5hbFN0YXRlJyB0byB0aGUgYmluZGluZwoJcmVzdG9yZU9yaWdpbmFsU3RhdGUoKSB7CgoJCWNvbnN0IG9yaWdpbmFsVmFsdWVPZmZzZXQgPSB0aGlzLnZhbHVlU2l6ZSAqIDM7CgkJdGhpcy5iaW5kaW5nLnNldFZhbHVlKCB0aGlzLmJ1ZmZlciwgb3JpZ2luYWxWYWx1ZU9mZnNldCApOwoKCX0KCglfc2V0QWRkaXRpdmVJZGVudGl0eU51bWVyaWMoKSB7CgoJCWNvbnN0IHN0YXJ0SW5kZXggPSB0aGlzLl9hZGRJbmRleCAqIHRoaXMudmFsdWVTaXplOwoJCWNvbnN0IGVuZEluZGV4ID0gc3RhcnRJbmRleCArIHRoaXMudmFsdWVTaXplOwoKCQlmb3IgKCBsZXQgaSA9IHN0YXJ0SW5kZXg7IGkgPCBlbmRJbmRleDsgaSArKyApIHsKCgkJCXRoaXMuYnVmZmVyWyBpIF0gPSAwOwoKCQl9CgoJfQoKCV9zZXRBZGRpdGl2ZUlkZW50aXR5UXVhdGVybmlvbigpIHsKCgkJdGhpcy5fc2V0QWRkaXRpdmVJZGVudGl0eU51bWVyaWMoKTsKCQl0aGlzLmJ1ZmZlclsgdGhpcy5fYWRkSW5kZXggKiB0aGlzLnZhbHVlU2l6ZSArIDMgXSA9IDE7CgoJfQoKCV9zZXRBZGRpdGl2ZUlkZW50aXR5T3RoZXIoKSB7CgoJCWNvbnN0IHN0YXJ0SW5kZXggPSB0aGlzLl9vcmlnSW5kZXggKiB0aGlzLnZhbHVlU2l6ZTsKCQljb25zdCB0YXJnZXRJbmRleCA9IHRoaXMuX2FkZEluZGV4ICogdGhpcy52YWx1ZVNpemU7CgoJCWZvciAoIGxldCBpID0gMDsgaSA8IHRoaXMudmFsdWVTaXplOyBpICsrICkgewoKCQkJdGhpcy5idWZmZXJbIHRhcmdldEluZGV4ICsgaSBdID0gdGhpcy5idWZmZXJbIHN0YXJ0SW5kZXggKyBpIF07CgoJCX0KCgl9CgoKCS8vIG1peCBmdW5jdGlvbnMKCglfc2VsZWN0KCBidWZmZXIsIGRzdE9mZnNldCwgc3JjT2Zmc2V0LCB0LCBzdHJpZGUgKSB7CgoJCWlmICggdCA+PSAwLjUgKSB7CgoJCQlmb3IgKCBsZXQgaSA9IDA7IGkgIT09IHN0cmlkZTsgKysgaSApIHsKCgkJCQlidWZmZXJbIGRzdE9mZnNldCArIGkgXSA9IGJ1ZmZlclsgc3JjT2Zmc2V0ICsgaSBdOwoKCQkJfQoKCQl9CgoJfQoKCV9zbGVycCggYnVmZmVyLCBkc3RPZmZzZXQsIHNyY09mZnNldCwgdCApIHsKCgkJUXVhdGVybmlvbi5zbGVycEZsYXQoIGJ1ZmZlciwgZHN0T2Zmc2V0LCBidWZmZXIsIGRzdE9mZnNldCwgYnVmZmVyLCBzcmNPZmZzZXQsIHQgKTsKCgl9CgoJX3NsZXJwQWRkaXRpdmUoIGJ1ZmZlciwgZHN0T2Zmc2V0LCBzcmNPZmZzZXQsIHQsIHN0cmlkZSApIHsKCgkJY29uc3Qgd29ya09mZnNldCA9IHRoaXMuX3dvcmtJbmRleCAqIHN0cmlkZTsKCgkJLy8gU3RvcmUgcmVzdWx0IGluIGludGVybWVkaWF0ZSBidWZmZXIgb2Zmc2V0CgkJUXVhdGVybmlvbi5tdWx0aXBseVF1YXRlcm5pb25zRmxhdCggYnVmZmVyLCB3b3JrT2Zmc2V0LCBidWZmZXIsIGRzdE9mZnNldCwgYnVmZmVyLCBzcmNPZmZzZXQgKTsKCgkJLy8gU2xlcnAgdG8gdGhlIGludGVybWVkaWF0ZSByZXN1bHQKCQlRdWF0ZXJuaW9uLnNsZXJwRmxhdCggYnVmZmVyLCBkc3RPZmZzZXQsIGJ1ZmZlciwgZHN0T2Zmc2V0LCBidWZmZXIsIHdvcmtPZmZzZXQsIHQgKTsKCgl9CgoJX2xlcnAoIGJ1ZmZlciwgZHN0T2Zmc2V0LCBzcmNPZmZzZXQsIHQsIHN0cmlkZSApIHsKCgkJY29uc3QgcyA9IDEgLSB0OwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgIT09IHN0cmlkZTsgKysgaSApIHsKCgkJCWNvbnN0IGogPSBkc3RPZmZzZXQgKyBpOwoKCQkJYnVmZmVyWyBqIF0gPSBidWZmZXJbIGogXSAqIHMgKyBidWZmZXJbIHNyY09mZnNldCArIGkgXSAqIHQ7CgoJCX0KCgl9CgoJX2xlcnBBZGRpdGl2ZSggYnVmZmVyLCBkc3RPZmZzZXQsIHNyY09mZnNldCwgdCwgc3RyaWRlICkgewoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgIT09IHN0cmlkZTsgKysgaSApIHsKCgkJCWNvbnN0IGogPSBkc3RPZmZzZXQgKyBpOwoKCQkJYnVmZmVyWyBqIF0gPSBidWZmZXJbIGogXSArIGJ1ZmZlclsgc3JjT2Zmc2V0ICsgaSBdICogdDsKCgkJfQoKCX0KCn0KCi8vIENoYXJhY3RlcnMgW10uOi8gYXJlIHJlc2VydmVkIGZvciB0cmFjayBiaW5kaW5nIHN5bnRheC4KY29uc3QgX1JFU0VSVkVEX0NIQVJTX1JFID0gJ1xcW1xcXVxcLjpcXC8nOwpjb25zdCBfcmVzZXJ2ZWRSZSA9IG5ldyBSZWdFeHAoICdbJyArIF9SRVNFUlZFRF9DSEFSU19SRSArICddJywgJ2cnICk7CgovLyBBdHRlbXB0cyB0byBhbGxvdyBub2RlIG5hbWVzIGZyb20gYW55IGxhbmd1YWdlLiBFUzUncyBgXHdgIHJlZ2V4cCBtYXRjaGVzCi8vIG9ubHkgbGF0aW4gY2hhcmFjdGVycywgYW5kIHRoZSB1bmljb2RlIFxwe0x9IGlzIG5vdCB5ZXQgc3VwcG9ydGVkLiBTbwovLyBpbnN0ZWFkLCB3ZSBleGNsdWRlIHJlc2VydmVkIGNoYXJhY3RlcnMgYW5kIG1hdGNoIGV2ZXJ5dGhpbmcgZWxzZS4KY29uc3QgX3dvcmRDaGFyID0gJ1teJyArIF9SRVNFUlZFRF9DSEFSU19SRSArICddJzsKY29uc3QgX3dvcmRDaGFyT3JEb3QgPSAnW14nICsgX1JFU0VSVkVEX0NIQVJTX1JFLnJlcGxhY2UoICdcXC4nLCAnJyApICsgJ10nOwoKLy8gUGFyZW50IGRpcmVjdG9yaWVzLCBkZWxpbWl0ZWQgYnkgJy8nIG9yICc6Jy4gQ3VycmVudGx5IHVudXNlZCwgYnV0IG11c3QKLy8gYmUgbWF0Y2hlZCB0byBwYXJzZSB0aGUgcmVzdCBvZiB0aGUgdHJhY2sgbmFtZS4KY29uc3QgX2RpcmVjdG9yeVJlID0gLypAX19QVVJFX18qLyAvKCg/OldDK1tcLzpdKSopLy5zb3VyY2UucmVwbGFjZSggJ1dDJywgX3dvcmRDaGFyICk7CgovLyBUYXJnZXQgbm9kZS4gTWF5IGNvbnRhaW4gd29yZCBjaGFyYWN0ZXJzIChhLXpBLVowLTlfKSBhbmQgJy4nIG9yICctJy4KY29uc3QgX25vZGVSZSA9IC8qQF9fUFVSRV9fKi8gLyhXQ09EKyk/Ly5zb3VyY2UucmVwbGFjZSggJ1dDT0QnLCBfd29yZENoYXJPckRvdCApOwoKLy8gT2JqZWN0IG9uIHRhcmdldCBub2RlLCBhbmQgYWNjZXNzb3IuIE1heSBub3QgY29udGFpbiByZXNlcnZlZAovLyBjaGFyYWN0ZXJzLiBBY2Nlc3NvciBtYXkgY29udGFpbiBhbnkgY2hhcmFjdGVyIGV4Y2VwdCBjbG9zaW5nIGJyYWNrZXQuCmNvbnN0IF9vYmplY3RSZSA9IC8qQF9fUFVSRV9fKi8gLyg/OlwuKFdDKykoPzpcWyguKylcXSk/KT8vLnNvdXJjZS5yZXBsYWNlKCAnV0MnLCBfd29yZENoYXIgKTsKCi8vIFByb3BlcnR5IGFuZCBhY2Nlc3Nvci4gTWF5IG5vdCBjb250YWluIHJlc2VydmVkIGNoYXJhY3RlcnMuIEFjY2Vzc29yIG1heQovLyBjb250YWluIGFueSBub24tYnJhY2tldCBjaGFyYWN0ZXJzLgpjb25zdCBfcHJvcGVydHlSZSA9IC8qQF9fUFVSRV9fKi8gL1wuKFdDKykoPzpcWyguKylcXSk/Ly5zb3VyY2UucmVwbGFjZSggJ1dDJywgX3dvcmRDaGFyICk7Cgpjb25zdCBfdHJhY2tSZSA9IG5ldyBSZWdFeHAoICcnCgkrICdeJwoJKyBfZGlyZWN0b3J5UmUKCSsgX25vZGVSZQoJKyBfb2JqZWN0UmUKCSsgX3Byb3BlcnR5UmUKCSsgJyQnCik7Cgpjb25zdCBfc3VwcG9ydGVkT2JqZWN0TmFtZXMgPSBbICdtYXRlcmlhbCcsICdtYXRlcmlhbHMnLCAnYm9uZXMnLCAnbWFwJyBdOwoKY2xhc3MgQ29tcG9zaXRlIHsKCgljb25zdHJ1Y3RvciggdGFyZ2V0R3JvdXAsIHBhdGgsIG9wdGlvbmFsUGFyc2VkUGF0aCApIHsKCgkJY29uc3QgcGFyc2VkUGF0aCA9IG9wdGlvbmFsUGFyc2VkUGF0aCB8fCBQcm9wZXJ0eUJpbmRpbmcucGFyc2VUcmFja05hbWUoIHBhdGggKTsKCgkJdGhpcy5fdGFyZ2V0R3JvdXAgPSB0YXJnZXRHcm91cDsKCQl0aGlzLl9iaW5kaW5ncyA9IHRhcmdldEdyb3VwLnN1YnNjcmliZV8oIHBhdGgsIHBhcnNlZFBhdGggKTsKCgl9CgoJZ2V0VmFsdWUoIGFycmF5LCBvZmZzZXQgKSB7CgoJCXRoaXMuYmluZCgpOyAvLyBiaW5kIGFsbCBiaW5kaW5nCgoJCWNvbnN0IGZpcnN0VmFsaWRJbmRleCA9IHRoaXMuX3RhcmdldEdyb3VwLm5DYWNoZWRPYmplY3RzXywKCQkJYmluZGluZyA9IHRoaXMuX2JpbmRpbmdzWyBmaXJzdFZhbGlkSW5kZXggXTsKCgkJLy8gYW5kIG9ubHkgY2FsbCAuZ2V0VmFsdWUgb24gdGhlIGZpcnN0CgkJaWYgKCBiaW5kaW5nICE9PSB1bmRlZmluZWQgKSBiaW5kaW5nLmdldFZhbHVlKCBhcnJheSwgb2Zmc2V0ICk7CgoJfQoKCXNldFZhbHVlKCBhcnJheSwgb2Zmc2V0ICkgewoKCQljb25zdCBiaW5kaW5ncyA9IHRoaXMuX2JpbmRpbmdzOwoKCQlmb3IgKCBsZXQgaSA9IHRoaXMuX3RhcmdldEdyb3VwLm5DYWNoZWRPYmplY3RzXywgbiA9IGJpbmRpbmdzLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCWJpbmRpbmdzWyBpIF0uc2V0VmFsdWUoIGFycmF5LCBvZmZzZXQgKTsKCgkJfQoKCX0KCgliaW5kKCkgewoKCQljb25zdCBiaW5kaW5ncyA9IHRoaXMuX2JpbmRpbmdzOwoKCQlmb3IgKCBsZXQgaSA9IHRoaXMuX3RhcmdldEdyb3VwLm5DYWNoZWRPYmplY3RzXywgbiA9IGJpbmRpbmdzLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCWJpbmRpbmdzWyBpIF0uYmluZCgpOwoKCQl9CgoJfQoKCXVuYmluZCgpIHsKCgkJY29uc3QgYmluZGluZ3MgPSB0aGlzLl9iaW5kaW5nczsKCgkJZm9yICggbGV0IGkgPSB0aGlzLl90YXJnZXRHcm91cC5uQ2FjaGVkT2JqZWN0c18sIG4gPSBiaW5kaW5ncy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQliaW5kaW5nc1sgaSBdLnVuYmluZCgpOwoKCQl9CgoJfQoKfQoKLy8gTm90ZTogVGhpcyBjbGFzcyB1c2VzIGEgU3RhdGUgcGF0dGVybiBvbiBhIHBlci1tZXRob2QgYmFzaXM6Ci8vICdiaW5kJyBzZXRzICd0aGlzLmdldFZhbHVlJyAvICdzZXRWYWx1ZScgYW5kIHNoYWRvd3MgdGhlCi8vIHByb3RvdHlwZSB2ZXJzaW9uIG9mIHRoZXNlIG1ldGhvZHMgd2l0aCBvbmUgdGhhdCByZXByZXNlbnRzCi8vIHRoZSBib3VuZCBzdGF0ZS4gV2hlbiB0aGUgcHJvcGVydHkgaXMgbm90IGZvdW5kLCB0aGUgbWV0aG9kcwovLyBiZWNvbWUgbm8tb3BzLgpjbGFzcyBQcm9wZXJ0eUJpbmRpbmcgewoKCWNvbnN0cnVjdG9yKCByb290Tm9kZSwgcGF0aCwgcGFyc2VkUGF0aCApIHsKCgkJdGhpcy5wYXRoID0gcGF0aDsKCQl0aGlzLnBhcnNlZFBhdGggPSBwYXJzZWRQYXRoIHx8IFByb3BlcnR5QmluZGluZy5wYXJzZVRyYWNrTmFtZSggcGF0aCApOwoKCQl0aGlzLm5vZGUgPSBQcm9wZXJ0eUJpbmRpbmcuZmluZE5vZGUoIHJvb3ROb2RlLCB0aGlzLnBhcnNlZFBhdGgubm9kZU5hbWUgKTsKCgkJdGhpcy5yb290Tm9kZSA9IHJvb3ROb2RlOwoKCQkvLyBpbml0aWFsIHN0YXRlIG9mIHRoZXNlIG1ldGhvZHMgdGhhdCBjYWxscyAnYmluZCcKCQl0aGlzLmdldFZhbHVlID0gdGhpcy5fZ2V0VmFsdWVfdW5ib3VuZDsKCQl0aGlzLnNldFZhbHVlID0gdGhpcy5fc2V0VmFsdWVfdW5ib3VuZDsKCgl9CgoKCXN0YXRpYyBjcmVhdGUoIHJvb3QsIHBhdGgsIHBhcnNlZFBhdGggKSB7CgoJCWlmICggISAoIHJvb3QgJiYgcm9vdC5pc0FuaW1hdGlvbk9iamVjdEdyb3VwICkgKSB7CgoJCQlyZXR1cm4gbmV3IFByb3BlcnR5QmluZGluZyggcm9vdCwgcGF0aCwgcGFyc2VkUGF0aCApOwoKCQl9IGVsc2UgewoKCQkJcmV0dXJuIG5ldyBQcm9wZXJ0eUJpbmRpbmcuQ29tcG9zaXRlKCByb290LCBwYXRoLCBwYXJzZWRQYXRoICk7CgoJCX0KCgl9CgoJLyoqCgkgKiBSZXBsYWNlcyBzcGFjZXMgd2l0aCB1bmRlcnNjb3JlcyBhbmQgcmVtb3ZlcyB1bnN1cHBvcnRlZCBjaGFyYWN0ZXJzIGZyb20KCSAqIG5vZGUgbmFtZXMsIHRvIGVuc3VyZSBjb21wYXRpYmlsaXR5IHdpdGggcGFyc2VUcmFja05hbWUoKS4KCSAqCgkgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSBOb2RlIG5hbWUgdG8gYmUgc2FuaXRpemVkLgoJICogQHJldHVybiB7c3RyaW5nfQoJICovCglzdGF0aWMgc2FuaXRpemVOb2RlTmFtZSggbmFtZSApIHsKCgkJcmV0dXJuIG5hbWUucmVwbGFjZSggL1xzL2csICdfJyApLnJlcGxhY2UoIF9yZXNlcnZlZFJlLCAnJyApOwoKCX0KCglzdGF0aWMgcGFyc2VUcmFja05hbWUoIHRyYWNrTmFtZSApIHsKCgkJY29uc3QgbWF0Y2hlcyA9IF90cmFja1JlLmV4ZWMoIHRyYWNrTmFtZSApOwoKCQlpZiAoIG1hdGNoZXMgPT09IG51bGwgKSB7CgoJCQl0aHJvdyBuZXcgRXJyb3IoICdQcm9wZXJ0eUJpbmRpbmc6IENhbm5vdCBwYXJzZSB0cmFja05hbWU6ICcgKyB0cmFja05hbWUgKTsKCgkJfQoKCQljb25zdCByZXN1bHRzID0gewoJCQkvLyBkaXJlY3RvcnlOYW1lOiBtYXRjaGVzWyAxIF0sIC8vICh0c2NodykgY3VycmVudGx5IHVudXNlZAoJCQlub2RlTmFtZTogbWF0Y2hlc1sgMiBdLAoJCQlvYmplY3ROYW1lOiBtYXRjaGVzWyAzIF0sCgkJCW9iamVjdEluZGV4OiBtYXRjaGVzWyA0IF0sCgkJCXByb3BlcnR5TmFtZTogbWF0Y2hlc1sgNSBdLCAvLyByZXF1aXJlZAoJCQlwcm9wZXJ0eUluZGV4OiBtYXRjaGVzWyA2IF0KCQl9OwoKCQljb25zdCBsYXN0RG90ID0gcmVzdWx0cy5ub2RlTmFtZSAmJiByZXN1bHRzLm5vZGVOYW1lLmxhc3RJbmRleE9mKCAnLicgKTsKCgkJaWYgKCBsYXN0RG90ICE9PSB1bmRlZmluZWQgJiYgbGFzdERvdCAhPT0gLSAxICkgewoKCQkJY29uc3Qgb2JqZWN0TmFtZSA9IHJlc3VsdHMubm9kZU5hbWUuc3Vic3RyaW5nKCBsYXN0RG90ICsgMSApOwoKCQkJLy8gT2JqZWN0IG5hbWVzIG11c3QgYmUgY2hlY2tlZCBhZ2FpbnN0IGFuIGFsbG93bGlzdC4gT3RoZXJ3aXNlLCB0aGVyZQoJCQkvLyBpcyBubyB3YXkgdG8gcGFyc2UgJ2Zvby5iYXIuYmF6JzogJ2JheicgbXVzdCBiZSBhIHByb3BlcnR5LCBidXQKCQkJLy8gJ2JhcicgY291bGQgYmUgdGhlIG9iamVjdE5hbWUsIG9yIHBhcnQgb2YgYSBub2RlTmFtZSAod2hpY2ggY2FuCgkJCS8vIGluY2x1ZGUgJy4nIGNoYXJhY3RlcnMpLgoJCQlpZiAoIF9zdXBwb3J0ZWRPYmplY3ROYW1lcy5pbmRleE9mKCBvYmplY3ROYW1lICkgIT09IC0gMSApIHsKCgkJCQlyZXN1bHRzLm5vZGVOYW1lID0gcmVzdWx0cy5ub2RlTmFtZS5zdWJzdHJpbmcoIDAsIGxhc3REb3QgKTsKCQkJCXJlc3VsdHMub2JqZWN0TmFtZSA9IG9iamVjdE5hbWU7CgoJCQl9CgoJCX0KCgkJaWYgKCByZXN1bHRzLnByb3BlcnR5TmFtZSA9PT0gbnVsbCB8fCByZXN1bHRzLnByb3BlcnR5TmFtZS5sZW5ndGggPT09IDAgKSB7CgoJCQl0aHJvdyBuZXcgRXJyb3IoICdQcm9wZXJ0eUJpbmRpbmc6IGNhbiBub3QgcGFyc2UgcHJvcGVydHlOYW1lIGZyb20gdHJhY2tOYW1lOiAnICsgdHJhY2tOYW1lICk7CgoJCX0KCgkJcmV0dXJuIHJlc3VsdHM7CgoJfQoKCXN0YXRpYyBmaW5kTm9kZSggcm9vdCwgbm9kZU5hbWUgKSB7CgoJCWlmICggbm9kZU5hbWUgPT09IHVuZGVmaW5lZCB8fCBub2RlTmFtZSA9PT0gJycgfHwgbm9kZU5hbWUgPT09ICcuJyB8fCBub2RlTmFtZSA9PT0gLSAxIHx8IG5vZGVOYW1lID09PSByb290Lm5hbWUgfHwgbm9kZU5hbWUgPT09IHJvb3QudXVpZCApIHsKCgkJCXJldHVybiByb290OwoKCQl9CgoJCS8vIHNlYXJjaCBpbnRvIHNrZWxldG9uIGJvbmVzLgoJCWlmICggcm9vdC5za2VsZXRvbiApIHsKCgkJCWNvbnN0IGJvbmUgPSByb290LnNrZWxldG9uLmdldEJvbmVCeU5hbWUoIG5vZGVOYW1lICk7CgoJCQlpZiAoIGJvbmUgIT09IHVuZGVmaW5lZCApIHsKCgkJCQlyZXR1cm4gYm9uZTsKCgkJCX0KCgkJfQoKCQkvLyBzZWFyY2ggaW50byBub2RlIHN1YnRyZWUuCgkJaWYgKCByb290LmNoaWxkcmVuICkgewoKCQkJY29uc3Qgc2VhcmNoTm9kZVN1YnRyZWUgPSBmdW5jdGlvbiAoIGNoaWxkcmVuICkgewoKCQkJCWZvciAoIGxldCBpID0gMDsgaSA8IGNoaWxkcmVuLmxlbmd0aDsgaSArKyApIHsKCgkJCQkJY29uc3QgY2hpbGROb2RlID0gY2hpbGRyZW5bIGkgXTsKCgkJCQkJaWYgKCBjaGlsZE5vZGUubmFtZSA9PT0gbm9kZU5hbWUgfHwgY2hpbGROb2RlLnV1aWQgPT09IG5vZGVOYW1lICkgewoKCQkJCQkJcmV0dXJuIGNoaWxkTm9kZTsKCgkJCQkJfQoKCQkJCQljb25zdCByZXN1bHQgPSBzZWFyY2hOb2RlU3VidHJlZSggY2hpbGROb2RlLmNoaWxkcmVuICk7CgoJCQkJCWlmICggcmVzdWx0ICkgcmV0dXJuIHJlc3VsdDsKCgkJCQl9CgoJCQkJcmV0dXJuIG51bGw7CgoJCQl9OwoKCQkJY29uc3Qgc3ViVHJlZU5vZGUgPSBzZWFyY2hOb2RlU3VidHJlZSggcm9vdC5jaGlsZHJlbiApOwoKCQkJaWYgKCBzdWJUcmVlTm9kZSApIHsKCgkJCQlyZXR1cm4gc3ViVHJlZU5vZGU7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIG51bGw7CgoJfQoKCS8vIHRoZXNlIGFyZSB1c2VkIHRvICJiaW5kIiBhIG5vbmV4aXN0ZW50IHByb3BlcnR5CglfZ2V0VmFsdWVfdW5hdmFpbGFibGUoKSB7fQoJX3NldFZhbHVlX3VuYXZhaWxhYmxlKCkge30KCgkvLyBHZXR0ZXJzCgoJX2dldFZhbHVlX2RpcmVjdCggYnVmZmVyLCBvZmZzZXQgKSB7CgoJCWJ1ZmZlclsgb2Zmc2V0IF0gPSB0aGlzLnRhcmdldE9iamVjdFsgdGhpcy5wcm9wZXJ0eU5hbWUgXTsKCgl9CgoJX2dldFZhbHVlX2FycmF5KCBidWZmZXIsIG9mZnNldCApIHsKCgkJY29uc3Qgc291cmNlID0gdGhpcy5yZXNvbHZlZFByb3BlcnR5OwoKCQlmb3IgKCBsZXQgaSA9IDAsIG4gPSBzb3VyY2UubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJYnVmZmVyWyBvZmZzZXQgKysgXSA9IHNvdXJjZVsgaSBdOwoKCQl9CgoJfQoKCV9nZXRWYWx1ZV9hcnJheUVsZW1lbnQoIGJ1ZmZlciwgb2Zmc2V0ICkgewoKCQlidWZmZXJbIG9mZnNldCBdID0gdGhpcy5yZXNvbHZlZFByb3BlcnR5WyB0aGlzLnByb3BlcnR5SW5kZXggXTsKCgl9CgoJX2dldFZhbHVlX3RvQXJyYXkoIGJ1ZmZlciwgb2Zmc2V0ICkgewoKCQl0aGlzLnJlc29sdmVkUHJvcGVydHkudG9BcnJheSggYnVmZmVyLCBvZmZzZXQgKTsKCgl9CgoJLy8gRGlyZWN0CgoJX3NldFZhbHVlX2RpcmVjdCggYnVmZmVyLCBvZmZzZXQgKSB7CgoJCXRoaXMudGFyZ2V0T2JqZWN0WyB0aGlzLnByb3BlcnR5TmFtZSBdID0gYnVmZmVyWyBvZmZzZXQgXTsKCgl9CgoJX3NldFZhbHVlX2RpcmVjdF9zZXROZWVkc1VwZGF0ZSggYnVmZmVyLCBvZmZzZXQgKSB7CgoJCXRoaXMudGFyZ2V0T2JqZWN0WyB0aGlzLnByb3BlcnR5TmFtZSBdID0gYnVmZmVyWyBvZmZzZXQgXTsKCQl0aGlzLnRhcmdldE9iamVjdC5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJfQoKCV9zZXRWYWx1ZV9kaXJlY3Rfc2V0TWF0cml4V29ybGROZWVkc1VwZGF0ZSggYnVmZmVyLCBvZmZzZXQgKSB7CgoJCXRoaXMudGFyZ2V0T2JqZWN0WyB0aGlzLnByb3BlcnR5TmFtZSBdID0gYnVmZmVyWyBvZmZzZXQgXTsKCQl0aGlzLnRhcmdldE9iamVjdC5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlID0gdHJ1ZTsKCgl9CgoJLy8gRW50aXJlQXJyYXkKCglfc2V0VmFsdWVfYXJyYXkoIGJ1ZmZlciwgb2Zmc2V0ICkgewoKCQljb25zdCBkZXN0ID0gdGhpcy5yZXNvbHZlZFByb3BlcnR5OwoKCQlmb3IgKCBsZXQgaSA9IDAsIG4gPSBkZXN0Lmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCWRlc3RbIGkgXSA9IGJ1ZmZlclsgb2Zmc2V0ICsrIF07CgoJCX0KCgl9CgoJX3NldFZhbHVlX2FycmF5X3NldE5lZWRzVXBkYXRlKCBidWZmZXIsIG9mZnNldCApIHsKCgkJY29uc3QgZGVzdCA9IHRoaXMucmVzb2x2ZWRQcm9wZXJ0eTsKCgkJZm9yICggbGV0IGkgPSAwLCBuID0gZGVzdC5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQlkZXN0WyBpIF0gPSBidWZmZXJbIG9mZnNldCArKyBdOwoKCQl9CgoJCXRoaXMudGFyZ2V0T2JqZWN0Lm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgl9CgoJX3NldFZhbHVlX2FycmF5X3NldE1hdHJpeFdvcmxkTmVlZHNVcGRhdGUoIGJ1ZmZlciwgb2Zmc2V0ICkgewoKCQljb25zdCBkZXN0ID0gdGhpcy5yZXNvbHZlZFByb3BlcnR5OwoKCQlmb3IgKCBsZXQgaSA9IDAsIG4gPSBkZXN0Lmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCWRlc3RbIGkgXSA9IGJ1ZmZlclsgb2Zmc2V0ICsrIF07CgoJCX0KCgkJdGhpcy50YXJnZXRPYmplY3QubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IHRydWU7CgoJfQoKCS8vIEFycmF5RWxlbWVudAoKCV9zZXRWYWx1ZV9hcnJheUVsZW1lbnQoIGJ1ZmZlciwgb2Zmc2V0ICkgewoKCQl0aGlzLnJlc29sdmVkUHJvcGVydHlbIHRoaXMucHJvcGVydHlJbmRleCBdID0gYnVmZmVyWyBvZmZzZXQgXTsKCgl9CgoJX3NldFZhbHVlX2FycmF5RWxlbWVudF9zZXROZWVkc1VwZGF0ZSggYnVmZmVyLCBvZmZzZXQgKSB7CgoJCXRoaXMucmVzb2x2ZWRQcm9wZXJ0eVsgdGhpcy5wcm9wZXJ0eUluZGV4IF0gPSBidWZmZXJbIG9mZnNldCBdOwoJCXRoaXMudGFyZ2V0T2JqZWN0Lm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgl9CgoJX3NldFZhbHVlX2FycmF5RWxlbWVudF9zZXRNYXRyaXhXb3JsZE5lZWRzVXBkYXRlKCBidWZmZXIsIG9mZnNldCApIHsKCgkJdGhpcy5yZXNvbHZlZFByb3BlcnR5WyB0aGlzLnByb3BlcnR5SW5kZXggXSA9IGJ1ZmZlclsgb2Zmc2V0IF07CgkJdGhpcy50YXJnZXRPYmplY3QubWF0cml4V29ybGROZWVkc1VwZGF0ZSA9IHRydWU7CgoJfQoKCS8vIEhhc1RvRnJvbUFycmF5CgoJX3NldFZhbHVlX2Zyb21BcnJheSggYnVmZmVyLCBvZmZzZXQgKSB7CgoJCXRoaXMucmVzb2x2ZWRQcm9wZXJ0eS5mcm9tQXJyYXkoIGJ1ZmZlciwgb2Zmc2V0ICk7CgoJfQoKCV9zZXRWYWx1ZV9mcm9tQXJyYXlfc2V0TmVlZHNVcGRhdGUoIGJ1ZmZlciwgb2Zmc2V0ICkgewoKCQl0aGlzLnJlc29sdmVkUHJvcGVydHkuZnJvbUFycmF5KCBidWZmZXIsIG9mZnNldCApOwoJCXRoaXMudGFyZ2V0T2JqZWN0Lm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgl9CgoJX3NldFZhbHVlX2Zyb21BcnJheV9zZXRNYXRyaXhXb3JsZE5lZWRzVXBkYXRlKCBidWZmZXIsIG9mZnNldCApIHsKCgkJdGhpcy5yZXNvbHZlZFByb3BlcnR5LmZyb21BcnJheSggYnVmZmVyLCBvZmZzZXQgKTsKCQl0aGlzLnRhcmdldE9iamVjdC5tYXRyaXhXb3JsZE5lZWRzVXBkYXRlID0gdHJ1ZTsKCgl9CgoJX2dldFZhbHVlX3VuYm91bmQoIHRhcmdldEFycmF5LCBvZmZzZXQgKSB7CgoJCXRoaXMuYmluZCgpOwoJCXRoaXMuZ2V0VmFsdWUoIHRhcmdldEFycmF5LCBvZmZzZXQgKTsKCgl9CgoJX3NldFZhbHVlX3VuYm91bmQoIHNvdXJjZUFycmF5LCBvZmZzZXQgKSB7CgoJCXRoaXMuYmluZCgpOwoJCXRoaXMuc2V0VmFsdWUoIHNvdXJjZUFycmF5LCBvZmZzZXQgKTsKCgl9CgoJLy8gY3JlYXRlIGdldHRlciAvIHNldHRlciBwYWlyIGZvciBhIHByb3BlcnR5IGluIHRoZSBzY2VuZSBncmFwaAoJYmluZCgpIHsKCgkJbGV0IHRhcmdldE9iamVjdCA9IHRoaXMubm9kZTsKCQljb25zdCBwYXJzZWRQYXRoID0gdGhpcy5wYXJzZWRQYXRoOwoKCQljb25zdCBvYmplY3ROYW1lID0gcGFyc2VkUGF0aC5vYmplY3ROYW1lOwoJCWNvbnN0IHByb3BlcnR5TmFtZSA9IHBhcnNlZFBhdGgucHJvcGVydHlOYW1lOwoJCWxldCBwcm9wZXJ0eUluZGV4ID0gcGFyc2VkUGF0aC5wcm9wZXJ0eUluZGV4OwoKCQlpZiAoICEgdGFyZ2V0T2JqZWN0ICkgewoKCQkJdGFyZ2V0T2JqZWN0ID0gUHJvcGVydHlCaW5kaW5nLmZpbmROb2RlKCB0aGlzLnJvb3ROb2RlLCBwYXJzZWRQYXRoLm5vZGVOYW1lICk7CgoJCQl0aGlzLm5vZGUgPSB0YXJnZXRPYmplY3Q7CgoJCX0KCgkJLy8gc2V0IGZhaWwgc3RhdGUgc28gd2UgY2FuIGp1c3QgJ3JldHVybicgb24gZXJyb3IKCQl0aGlzLmdldFZhbHVlID0gdGhpcy5fZ2V0VmFsdWVfdW5hdmFpbGFibGU7CgkJdGhpcy5zZXRWYWx1ZSA9IHRoaXMuX3NldFZhbHVlX3VuYXZhaWxhYmxlOwoKCQkvLyBlbnN1cmUgdGhlcmUgaXMgYSB2YWx1ZSBub2RlCgkJaWYgKCAhIHRhcmdldE9iamVjdCApIHsKCgkJCWNvbnNvbGUud2FybiggJ1RIUkVFLlByb3BlcnR5QmluZGluZzogTm8gdGFyZ2V0IG5vZGUgZm91bmQgZm9yIHRyYWNrOiAnICsgdGhpcy5wYXRoICsgJy4nICk7CgkJCXJldHVybjsKCgkJfQoKCQlpZiAoIG9iamVjdE5hbWUgKSB7CgoJCQlsZXQgb2JqZWN0SW5kZXggPSBwYXJzZWRQYXRoLm9iamVjdEluZGV4OwoKCQkJLy8gc3BlY2lhbCBjYXNlcyB3ZXJlIHdlIG5lZWQgdG8gcmVhY2ggZGVlcGVyIGludG8gdGhlIGhpZXJhcmNoeSB0byBnZXQgdGhlIGZhY2UgbWF0ZXJpYWxzLi4uLgoJCQlzd2l0Y2ggKCBvYmplY3ROYW1lICkgewoKCQkJCWNhc2UgJ21hdGVyaWFscyc6CgoJCQkJCWlmICggISB0YXJnZXRPYmplY3QubWF0ZXJpYWwgKSB7CgoJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuUHJvcGVydHlCaW5kaW5nOiBDYW4gbm90IGJpbmQgdG8gbWF0ZXJpYWwgYXMgbm9kZSBkb2VzIG5vdCBoYXZlIGEgbWF0ZXJpYWwuJywgdGhpcyApOwoJCQkJCQlyZXR1cm47CgoJCQkJCX0KCgkJCQkJaWYgKCAhIHRhcmdldE9iamVjdC5tYXRlcmlhbC5tYXRlcmlhbHMgKSB7CgoJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuUHJvcGVydHlCaW5kaW5nOiBDYW4gbm90IGJpbmQgdG8gbWF0ZXJpYWwubWF0ZXJpYWxzIGFzIG5vZGUubWF0ZXJpYWwgZG9lcyBub3QgaGF2ZSBhIG1hdGVyaWFscyBhcnJheS4nLCB0aGlzICk7CgkJCQkJCXJldHVybjsKCgkJCQkJfQoKCQkJCQl0YXJnZXRPYmplY3QgPSB0YXJnZXRPYmplY3QubWF0ZXJpYWwubWF0ZXJpYWxzOwoKCQkJCQlicmVhazsKCgkJCQljYXNlICdib25lcyc6CgoJCQkJCWlmICggISB0YXJnZXRPYmplY3Quc2tlbGV0b24gKSB7CgoJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuUHJvcGVydHlCaW5kaW5nOiBDYW4gbm90IGJpbmQgdG8gYm9uZXMgYXMgbm9kZSBkb2VzIG5vdCBoYXZlIGEgc2tlbGV0b24uJywgdGhpcyApOwoJCQkJCQlyZXR1cm47CgoJCQkJCX0KCgkJCQkJLy8gcG90ZW50aWFsIGZ1dHVyZSBvcHRpbWl6YXRpb246IHNraXAgdGhpcyBpZiBwcm9wZXJ0eUluZGV4IGlzIGFscmVhZHkgYW4gaW50ZWdlcgoJCQkJCS8vIGFuZCBjb252ZXJ0IHRoZSBpbnRlZ2VyIHN0cmluZyB0byBhIHRydWUgaW50ZWdlci4KCgkJCQkJdGFyZ2V0T2JqZWN0ID0gdGFyZ2V0T2JqZWN0LnNrZWxldG9uLmJvbmVzOwoKCQkJCQkvLyBzdXBwb3J0IHJlc29sdmluZyBtb3JwaFRhcmdldCBuYW1lcyBpbnRvIGluZGljZXMuCgkJCQkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGFyZ2V0T2JqZWN0Lmxlbmd0aDsgaSArKyApIHsKCgkJCQkJCWlmICggdGFyZ2V0T2JqZWN0WyBpIF0ubmFtZSA9PT0gb2JqZWN0SW5kZXggKSB7CgoJCQkJCQkJb2JqZWN0SW5kZXggPSBpOwoJCQkJCQkJYnJlYWs7CgoJCQkJCQl9CgoJCQkJCX0KCgkJCQkJYnJlYWs7CgoJCQkJY2FzZSAnbWFwJzoKCgkJCQkJaWYgKCAnbWFwJyBpbiB0YXJnZXRPYmplY3QgKSB7CgoJCQkJCQl0YXJnZXRPYmplY3QgPSB0YXJnZXRPYmplY3QubWFwOwoJCQkJCQlicmVhazsKCgkJCQkJfQoKCQkJCQlpZiAoICEgdGFyZ2V0T2JqZWN0Lm1hdGVyaWFsICkgewoKCQkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLlByb3BlcnR5QmluZGluZzogQ2FuIG5vdCBiaW5kIHRvIG1hdGVyaWFsIGFzIG5vZGUgZG9lcyBub3QgaGF2ZSBhIG1hdGVyaWFsLicsIHRoaXMgKTsKCQkJCQkJcmV0dXJuOwoKCQkJCQl9CgoJCQkJCWlmICggISB0YXJnZXRPYmplY3QubWF0ZXJpYWwubWFwICkgewoKCQkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLlByb3BlcnR5QmluZGluZzogQ2FuIG5vdCBiaW5kIHRvIG1hdGVyaWFsLm1hcCBhcyBub2RlLm1hdGVyaWFsIGRvZXMgbm90IGhhdmUgYSBtYXAuJywgdGhpcyApOwoJCQkJCQlyZXR1cm47CgoJCQkJCX0KCgkJCQkJdGFyZ2V0T2JqZWN0ID0gdGFyZ2V0T2JqZWN0Lm1hdGVyaWFsLm1hcDsKCQkJCQlicmVhazsKCgkJCQlkZWZhdWx0OgoKCQkJCQlpZiAoIHRhcmdldE9iamVjdFsgb2JqZWN0TmFtZSBdID09PSB1bmRlZmluZWQgKSB7CgoJCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuUHJvcGVydHlCaW5kaW5nOiBDYW4gbm90IGJpbmQgdG8gb2JqZWN0TmFtZSBvZiBub2RlIHVuZGVmaW5lZC4nLCB0aGlzICk7CgkJCQkJCXJldHVybjsKCgkJCQkJfQoKCQkJCQl0YXJnZXRPYmplY3QgPSB0YXJnZXRPYmplY3RbIG9iamVjdE5hbWUgXTsKCgkJCX0KCgoJCQlpZiAoIG9iamVjdEluZGV4ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJaWYgKCB0YXJnZXRPYmplY3RbIG9iamVjdEluZGV4IF0gPT09IHVuZGVmaW5lZCApIHsKCgkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLlByb3BlcnR5QmluZGluZzogVHJ5aW5nIHRvIGJpbmQgdG8gb2JqZWN0SW5kZXggb2Ygb2JqZWN0TmFtZSwgYnV0IGlzIHVuZGVmaW5lZC4nLCB0aGlzLCB0YXJnZXRPYmplY3QgKTsKCQkJCQlyZXR1cm47CgoJCQkJfQoKCQkJCXRhcmdldE9iamVjdCA9IHRhcmdldE9iamVjdFsgb2JqZWN0SW5kZXggXTsKCgkJCX0KCgkJfQoKCQkvLyByZXNvbHZlIHByb3BlcnR5CgkJY29uc3Qgbm9kZVByb3BlcnR5ID0gdGFyZ2V0T2JqZWN0WyBwcm9wZXJ0eU5hbWUgXTsKCgkJaWYgKCBub2RlUHJvcGVydHkgPT09IHVuZGVmaW5lZCApIHsKCgkJCWNvbnN0IG5vZGVOYW1lID0gcGFyc2VkUGF0aC5ub2RlTmFtZTsKCgkJCWNvbnNvbGUuZXJyb3IoICdUSFJFRS5Qcm9wZXJ0eUJpbmRpbmc6IFRyeWluZyB0byB1cGRhdGUgcHJvcGVydHkgZm9yIHRyYWNrOiAnICsgbm9kZU5hbWUgKwoJCQkJJy4nICsgcHJvcGVydHlOYW1lICsgJyBidXQgaXQgd2FzblwndCBmb3VuZC4nLCB0YXJnZXRPYmplY3QgKTsKCQkJcmV0dXJuOwoKCQl9CgoJCS8vIGRldGVybWluZSB2ZXJzaW9uaW5nIHNjaGVtZQoJCWxldCB2ZXJzaW9uaW5nID0gdGhpcy5WZXJzaW9uaW5nLk5vbmU7CgoJCXRoaXMudGFyZ2V0T2JqZWN0ID0gdGFyZ2V0T2JqZWN0OwoKCQlpZiAoIHRhcmdldE9iamVjdC5uZWVkc1VwZGF0ZSAhPT0gdW5kZWZpbmVkICkgeyAvLyBtYXRlcmlhbAoKCQkJdmVyc2lvbmluZyA9IHRoaXMuVmVyc2lvbmluZy5OZWVkc1VwZGF0ZTsKCgkJfSBlbHNlIGlmICggdGFyZ2V0T2JqZWN0Lm1hdHJpeFdvcmxkTmVlZHNVcGRhdGUgIT09IHVuZGVmaW5lZCApIHsgLy8gbm9kZSB0cmFuc2Zvcm0KCgkJCXZlcnNpb25pbmcgPSB0aGlzLlZlcnNpb25pbmcuTWF0cml4V29ybGROZWVkc1VwZGF0ZTsKCgkJfQoKCQkvLyBkZXRlcm1pbmUgaG93IHRoZSBwcm9wZXJ0eSBnZXRzIGJvdW5kCgkJbGV0IGJpbmRpbmdUeXBlID0gdGhpcy5CaW5kaW5nVHlwZS5EaXJlY3Q7CgoJCWlmICggcHJvcGVydHlJbmRleCAhPT0gdW5kZWZpbmVkICkgewoKCQkJLy8gYWNjZXNzIGEgc3ViIGVsZW1lbnQgb2YgdGhlIHByb3BlcnR5IGFycmF5IChvbmx5IHByaW1pdGl2ZXMgYXJlIHN1cHBvcnRlZCByaWdodCBub3cpCgoJCQlpZiAoIHByb3BlcnR5TmFtZSA9PT0gJ21vcnBoVGFyZ2V0SW5mbHVlbmNlcycgKSB7CgoJCQkJLy8gcG90ZW50aWFsIG9wdGltaXphdGlvbiwgc2tpcCB0aGlzIGlmIHByb3BlcnR5SW5kZXggaXMgYWxyZWFkeSBhbiBpbnRlZ2VyLCBhbmQgY29udmVydCB0aGUgaW50ZWdlciBzdHJpbmcgdG8gYSB0cnVlIGludGVnZXIuCgoJCQkJLy8gc3VwcG9ydCByZXNvbHZpbmcgbW9ycGhUYXJnZXQgbmFtZXMgaW50byBpbmRpY2VzLgoJCQkJaWYgKCAhIHRhcmdldE9iamVjdC5nZW9tZXRyeSApIHsKCgkJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLlByb3BlcnR5QmluZGluZzogQ2FuIG5vdCBiaW5kIHRvIG1vcnBoVGFyZ2V0SW5mbHVlbmNlcyBiZWNhdXNlIG5vZGUgZG9lcyBub3QgaGF2ZSBhIGdlb21ldHJ5LicsIHRoaXMgKTsKCQkJCQlyZXR1cm47CgoJCQkJfQoKCQkJCWlmICggISB0YXJnZXRPYmplY3QuZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzICkgewoKCQkJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuUHJvcGVydHlCaW5kaW5nOiBDYW4gbm90IGJpbmQgdG8gbW9ycGhUYXJnZXRJbmZsdWVuY2VzIGJlY2F1c2Ugbm9kZSBkb2VzIG5vdCBoYXZlIGEgZ2VvbWV0cnkubW9ycGhBdHRyaWJ1dGVzLicsIHRoaXMgKTsKCQkJCQlyZXR1cm47CgoJCQkJfQoKCQkJCWlmICggdGFyZ2V0T2JqZWN0Lm1vcnBoVGFyZ2V0RGljdGlvbmFyeVsgcHJvcGVydHlJbmRleCBdICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJCXByb3BlcnR5SW5kZXggPSB0YXJnZXRPYmplY3QubW9ycGhUYXJnZXREaWN0aW9uYXJ5WyBwcm9wZXJ0eUluZGV4IF07CgoJCQkJfQoKCQkJfQoKCQkJYmluZGluZ1R5cGUgPSB0aGlzLkJpbmRpbmdUeXBlLkFycmF5RWxlbWVudDsKCgkJCXRoaXMucmVzb2x2ZWRQcm9wZXJ0eSA9IG5vZGVQcm9wZXJ0eTsKCQkJdGhpcy5wcm9wZXJ0eUluZGV4ID0gcHJvcGVydHlJbmRleDsKCgkJfSBlbHNlIGlmICggbm9kZVByb3BlcnR5LmZyb21BcnJheSAhPT0gdW5kZWZpbmVkICYmIG5vZGVQcm9wZXJ0eS50b0FycmF5ICE9PSB1bmRlZmluZWQgKSB7CgoJCQkvLyBtdXN0IHVzZSBjb3B5IGZvciBPYmplY3QzRC5FdWxlci9RdWF0ZXJuaW9uCgoJCQliaW5kaW5nVHlwZSA9IHRoaXMuQmluZGluZ1R5cGUuSGFzRnJvbVRvQXJyYXk7CgoJCQl0aGlzLnJlc29sdmVkUHJvcGVydHkgPSBub2RlUHJvcGVydHk7CgoJCX0gZWxzZSBpZiAoIEFycmF5LmlzQXJyYXkoIG5vZGVQcm9wZXJ0eSApICkgewoKCQkJYmluZGluZ1R5cGUgPSB0aGlzLkJpbmRpbmdUeXBlLkVudGlyZUFycmF5OwoKCQkJdGhpcy5yZXNvbHZlZFByb3BlcnR5ID0gbm9kZVByb3BlcnR5OwoKCQl9IGVsc2UgewoKCQkJdGhpcy5wcm9wZXJ0eU5hbWUgPSBwcm9wZXJ0eU5hbWU7CgoJCX0KCgkJLy8gc2VsZWN0IGdldHRlciAvIHNldHRlcgoJCXRoaXMuZ2V0VmFsdWUgPSB0aGlzLkdldHRlckJ5QmluZGluZ1R5cGVbIGJpbmRpbmdUeXBlIF07CgkJdGhpcy5zZXRWYWx1ZSA9IHRoaXMuU2V0dGVyQnlCaW5kaW5nVHlwZUFuZFZlcnNpb25pbmdbIGJpbmRpbmdUeXBlIF1bIHZlcnNpb25pbmcgXTsKCgl9CgoJdW5iaW5kKCkgewoKCQl0aGlzLm5vZGUgPSBudWxsOwoKCQkvLyBiYWNrIHRvIHRoZSBwcm90b3R5cGUgdmVyc2lvbiBvZiBnZXRWYWx1ZSAvIHNldFZhbHVlCgkJLy8gbm90ZTogYXZvaWRpbmcgdG8gbXV0YXRlIHRoZSBzaGFwZSBvZiAndGhpcycgdmlhICdkZWxldGUnCgkJdGhpcy5nZXRWYWx1ZSA9IHRoaXMuX2dldFZhbHVlX3VuYm91bmQ7CgkJdGhpcy5zZXRWYWx1ZSA9IHRoaXMuX3NldFZhbHVlX3VuYm91bmQ7CgoJfQoKfQoKUHJvcGVydHlCaW5kaW5nLkNvbXBvc2l0ZSA9IENvbXBvc2l0ZTsKClByb3BlcnR5QmluZGluZy5wcm90b3R5cGUuQmluZGluZ1R5cGUgPSB7CglEaXJlY3Q6IDAsCglFbnRpcmVBcnJheTogMSwKCUFycmF5RWxlbWVudDogMiwKCUhhc0Zyb21Ub0FycmF5OiAzCn07CgpQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLlZlcnNpb25pbmcgPSB7CglOb25lOiAwLAoJTmVlZHNVcGRhdGU6IDEsCglNYXRyaXhXb3JsZE5lZWRzVXBkYXRlOiAyCn07CgpQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLkdldHRlckJ5QmluZGluZ1R5cGUgPSBbCgoJUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZS5fZ2V0VmFsdWVfZGlyZWN0LAoJUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZS5fZ2V0VmFsdWVfYXJyYXksCglQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLl9nZXRWYWx1ZV9hcnJheUVsZW1lbnQsCglQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLl9nZXRWYWx1ZV90b0FycmF5LAoKXTsKClByb3BlcnR5QmluZGluZy5wcm90b3R5cGUuU2V0dGVyQnlCaW5kaW5nVHlwZUFuZFZlcnNpb25pbmcgPSBbCgoJWwoJCS8vIERpcmVjdAoJCVByb3BlcnR5QmluZGluZy5wcm90b3R5cGUuX3NldFZhbHVlX2RpcmVjdCwKCQlQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLl9zZXRWYWx1ZV9kaXJlY3Rfc2V0TmVlZHNVcGRhdGUsCgkJUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZS5fc2V0VmFsdWVfZGlyZWN0X3NldE1hdHJpeFdvcmxkTmVlZHNVcGRhdGUsCgoJXSwgWwoKCQkvLyBFbnRpcmVBcnJheQoKCQlQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLl9zZXRWYWx1ZV9hcnJheSwKCQlQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLl9zZXRWYWx1ZV9hcnJheV9zZXROZWVkc1VwZGF0ZSwKCQlQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLl9zZXRWYWx1ZV9hcnJheV9zZXRNYXRyaXhXb3JsZE5lZWRzVXBkYXRlLAoKCV0sIFsKCgkJLy8gQXJyYXlFbGVtZW50CgkJUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZS5fc2V0VmFsdWVfYXJyYXlFbGVtZW50LAoJCVByb3BlcnR5QmluZGluZy5wcm90b3R5cGUuX3NldFZhbHVlX2FycmF5RWxlbWVudF9zZXROZWVkc1VwZGF0ZSwKCQlQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLl9zZXRWYWx1ZV9hcnJheUVsZW1lbnRfc2V0TWF0cml4V29ybGROZWVkc1VwZGF0ZSwKCgldLCBbCgoJCS8vIEhhc1RvRnJvbUFycmF5CgkJUHJvcGVydHlCaW5kaW5nLnByb3RvdHlwZS5fc2V0VmFsdWVfZnJvbUFycmF5LAoJCVByb3BlcnR5QmluZGluZy5wcm90b3R5cGUuX3NldFZhbHVlX2Zyb21BcnJheV9zZXROZWVkc1VwZGF0ZSwKCQlQcm9wZXJ0eUJpbmRpbmcucHJvdG90eXBlLl9zZXRWYWx1ZV9mcm9tQXJyYXlfc2V0TWF0cml4V29ybGROZWVkc1VwZGF0ZSwKCgldCgpdOwoKLyoqCiAqCiAqIEEgZ3JvdXAgb2Ygb2JqZWN0cyB0aGF0IHJlY2VpdmVzIGEgc2hhcmVkIGFuaW1hdGlvbiBzdGF0ZS4KICoKICogVXNhZ2U6CiAqCiAqICAtIEFkZCBvYmplY3RzIHlvdSB3b3VsZCBvdGhlcndpc2UgcGFzcyBhcyAncm9vdCcgdG8gdGhlCiAqICAgIGNvbnN0cnVjdG9yIG9yIHRoZSAuY2xpcEFjdGlvbiBtZXRob2Qgb2YgQW5pbWF0aW9uTWl4ZXIuCiAqCiAqICAtIEluc3RlYWQgcGFzcyB0aGlzIG9iamVjdCBhcyAncm9vdCcuCiAqCiAqICAtIFlvdSBjYW4gYWxzbyBhZGQgYW5kIHJlbW92ZSBvYmplY3RzIGxhdGVyIHdoZW4gdGhlIG1peGVyCiAqICAgIGlzIHJ1bm5pbmcuCiAqCiAqIE5vdGU6CiAqCiAqICAgIE9iamVjdHMgb2YgdGhpcyBjbGFzcyBhcHBlYXIgYXMgb25lIG9iamVjdCB0byB0aGUgbWl4ZXIsCiAqICAgIHNvIGNhY2hlIGNvbnRyb2wgb2YgdGhlIGluZGl2aWR1YWwgb2JqZWN0cyBtdXN0IGJlIGRvbmUKICogICAgb24gdGhlIGdyb3VwLgogKgogKiBMaW1pdGF0aW9uOgogKgogKiAgLSBUaGUgYW5pbWF0ZWQgcHJvcGVydGllcyBtdXN0IGJlIGNvbXBhdGlibGUgYW1vbmcgdGhlCiAqICAgIGFsbCBvYmplY3RzIGluIHRoZSBncm91cC4KICoKICogIC0gQSBzaW5nbGUgcHJvcGVydHkgY2FuIGVpdGhlciBiZSBjb250cm9sbGVkIHRocm91Z2ggYQogKiAgICB0YXJnZXQgZ3JvdXAgb3IgZGlyZWN0bHksIGJ1dCBub3QgYm90aC4KICovCgpjbGFzcyBBbmltYXRpb25PYmplY3RHcm91cCB7CgoJY29uc3RydWN0b3IoKSB7CgoJCXRoaXMuaXNBbmltYXRpb25PYmplY3RHcm91cCA9IHRydWU7CgoJCXRoaXMudXVpZCA9IGdlbmVyYXRlVVVJRCgpOwoKCQkvLyBjYWNoZWQgb2JqZWN0cyBmb2xsb3dlZCBieSB0aGUgYWN0aXZlIG9uZXMKCQl0aGlzLl9vYmplY3RzID0gQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoIGFyZ3VtZW50cyApOwoKCQl0aGlzLm5DYWNoZWRPYmplY3RzXyA9IDA7IC8vIHRocmVzaG9sZAoJCS8vIG5vdGU6IHJlYWQgYnkgUHJvcGVydHlCaW5kaW5nLkNvbXBvc2l0ZQoKCQljb25zdCBpbmRpY2VzID0ge307CgkJdGhpcy5faW5kaWNlc0J5VVVJRCA9IGluZGljZXM7IC8vIGZvciBib29ra2VlcGluZwoKCQlmb3IgKCBsZXQgaSA9IDAsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJaW5kaWNlc1sgYXJndW1lbnRzWyBpIF0udXVpZCBdID0gaTsKCgkJfQoKCQl0aGlzLl9wYXRocyA9IFtdOyAvLyBpbnNpZGU6IHN0cmluZwoJCXRoaXMuX3BhcnNlZFBhdGhzID0gW107IC8vIGluc2lkZTogeyB3ZSBkb24ndCBjYXJlLCBoZXJlIH0KCQl0aGlzLl9iaW5kaW5ncyA9IFtdOyAvLyBpbnNpZGU6IEFycmF5PCBQcm9wZXJ0eUJpbmRpbmcgPgoJCXRoaXMuX2JpbmRpbmdzSW5kaWNlc0J5UGF0aCA9IHt9OyAvLyBpbnNpZGU6IGluZGljZXMgaW4gdGhlc2UgYXJyYXlzCgoJCWNvbnN0IHNjb3BlID0gdGhpczsKCgkJdGhpcy5zdGF0cyA9IHsKCgkJCW9iamVjdHM6IHsKCQkJCWdldCB0b3RhbCgpIHsKCgkJCQkJcmV0dXJuIHNjb3BlLl9vYmplY3RzLmxlbmd0aDsKCgkJCQl9LAoJCQkJZ2V0IGluVXNlKCkgewoKCQkJCQlyZXR1cm4gdGhpcy50b3RhbCAtIHNjb3BlLm5DYWNoZWRPYmplY3RzXzsKCgkJCQl9CgkJCX0sCgkJCWdldCBiaW5kaW5nc1Blck9iamVjdCgpIHsKCgkJCQlyZXR1cm4gc2NvcGUuX2JpbmRpbmdzLmxlbmd0aDsKCgkJCX0KCgkJfTsKCgl9CgoJYWRkKCkgewoKCQljb25zdCBvYmplY3RzID0gdGhpcy5fb2JqZWN0cywKCQkJaW5kaWNlc0J5VVVJRCA9IHRoaXMuX2luZGljZXNCeVVVSUQsCgkJCXBhdGhzID0gdGhpcy5fcGF0aHMsCgkJCXBhcnNlZFBhdGhzID0gdGhpcy5fcGFyc2VkUGF0aHMsCgkJCWJpbmRpbmdzID0gdGhpcy5fYmluZGluZ3MsCgkJCW5CaW5kaW5ncyA9IGJpbmRpbmdzLmxlbmd0aDsKCgkJbGV0IGtub3duT2JqZWN0ID0gdW5kZWZpbmVkLAoJCQluT2JqZWN0cyA9IG9iamVjdHMubGVuZ3RoLAoJCQluQ2FjaGVkT2JqZWN0cyA9IHRoaXMubkNhY2hlZE9iamVjdHNfOwoKCQlmb3IgKCBsZXQgaSA9IDAsIG4gPSBhcmd1bWVudHMubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJY29uc3Qgb2JqZWN0ID0gYXJndW1lbnRzWyBpIF0sCgkJCQl1dWlkID0gb2JqZWN0LnV1aWQ7CgkJCWxldCBpbmRleCA9IGluZGljZXNCeVVVSURbIHV1aWQgXTsKCgkJCWlmICggaW5kZXggPT09IHVuZGVmaW5lZCApIHsKCgkJCQkvLyB1bmtub3duIG9iamVjdCAtPiBhZGQgaXQgdG8gdGhlIEFDVElWRSByZWdpb24KCgkJCQlpbmRleCA9IG5PYmplY3RzICsrOwoJCQkJaW5kaWNlc0J5VVVJRFsgdXVpZCBdID0gaW5kZXg7CgkJCQlvYmplY3RzLnB1c2goIG9iamVjdCApOwoKCQkJCS8vIGFjY291bnRpbmcgaXMgZG9uZSwgbm93IGRvIHRoZSBzYW1lIGZvciBhbGwgYmluZGluZ3MKCgkJCQlmb3IgKCBsZXQgaiA9IDAsIG0gPSBuQmluZGluZ3M7IGogIT09IG07ICsrIGogKSB7CgoJCQkJCWJpbmRpbmdzWyBqIF0ucHVzaCggbmV3IFByb3BlcnR5QmluZGluZyggb2JqZWN0LCBwYXRoc1sgaiBdLCBwYXJzZWRQYXRoc1sgaiBdICkgKTsKCgkJCQl9CgoJCQl9IGVsc2UgaWYgKCBpbmRleCA8IG5DYWNoZWRPYmplY3RzICkgewoKCQkJCWtub3duT2JqZWN0ID0gb2JqZWN0c1sgaW5kZXggXTsKCgkJCQkvLyBtb3ZlIGV4aXN0aW5nIG9iamVjdCB0byB0aGUgQUNUSVZFIHJlZ2lvbgoKCQkJCWNvbnN0IGZpcnN0QWN0aXZlSW5kZXggPSAtLSBuQ2FjaGVkT2JqZWN0cywKCQkJCQlsYXN0Q2FjaGVkT2JqZWN0ID0gb2JqZWN0c1sgZmlyc3RBY3RpdmVJbmRleCBdOwoKCQkJCWluZGljZXNCeVVVSURbIGxhc3RDYWNoZWRPYmplY3QudXVpZCBdID0gaW5kZXg7CgkJCQlvYmplY3RzWyBpbmRleCBdID0gbGFzdENhY2hlZE9iamVjdDsKCgkJCQlpbmRpY2VzQnlVVUlEWyB1dWlkIF0gPSBmaXJzdEFjdGl2ZUluZGV4OwoJCQkJb2JqZWN0c1sgZmlyc3RBY3RpdmVJbmRleCBdID0gb2JqZWN0OwoKCQkJCS8vIGFjY291bnRpbmcgaXMgZG9uZSwgbm93IGRvIHRoZSBzYW1lIGZvciBhbGwgYmluZGluZ3MKCgkJCQlmb3IgKCBsZXQgaiA9IDAsIG0gPSBuQmluZGluZ3M7IGogIT09IG07ICsrIGogKSB7CgoJCQkJCWNvbnN0IGJpbmRpbmdzRm9yUGF0aCA9IGJpbmRpbmdzWyBqIF0sCgkJCQkJCWxhc3RDYWNoZWQgPSBiaW5kaW5nc0ZvclBhdGhbIGZpcnN0QWN0aXZlSW5kZXggXTsKCgkJCQkJbGV0IGJpbmRpbmcgPSBiaW5kaW5nc0ZvclBhdGhbIGluZGV4IF07CgoJCQkJCWJpbmRpbmdzRm9yUGF0aFsgaW5kZXggXSA9IGxhc3RDYWNoZWQ7CgoJCQkJCWlmICggYmluZGluZyA9PT0gdW5kZWZpbmVkICkgewoKCQkJCQkJLy8gc2luY2Ugd2UgZG8gbm90IGJvdGhlciB0byBjcmVhdGUgbmV3IGJpbmRpbmdzCgkJCQkJCS8vIGZvciBvYmplY3RzIHRoYXQgYXJlIGNhY2hlZCwgdGhlIGJpbmRpbmcgbWF5CgkJCQkJCS8vIG9yIG1heSBub3QgZXhpc3QKCgkJCQkJCWJpbmRpbmcgPSBuZXcgUHJvcGVydHlCaW5kaW5nKCBvYmplY3QsIHBhdGhzWyBqIF0sIHBhcnNlZFBhdGhzWyBqIF0gKTsKCgkJCQkJfQoKCQkJCQliaW5kaW5nc0ZvclBhdGhbIGZpcnN0QWN0aXZlSW5kZXggXSA9IGJpbmRpbmc7CgoJCQkJfQoKCQkJfSBlbHNlIGlmICggb2JqZWN0c1sgaW5kZXggXSAhPT0ga25vd25PYmplY3QgKSB7CgoJCQkJY29uc29sZS5lcnJvciggJ1RIUkVFLkFuaW1hdGlvbk9iamVjdEdyb3VwOiBEaWZmZXJlbnQgb2JqZWN0cyB3aXRoIHRoZSBzYW1lIFVVSUQgJyArCgkJCQkJJ2RldGVjdGVkLiBDbGVhbiB0aGUgY2FjaGVzIG9yIHJlY3JlYXRlIHlvdXIgaW5mcmFzdHJ1Y3R1cmUgd2hlbiByZWxvYWRpbmcgc2NlbmVzLicgKTsKCgkJCX0gLy8gZWxzZSB0aGUgb2JqZWN0IGlzIGFscmVhZHkgd2hlcmUgd2Ugd2FudCBpdCB0byBiZQoKCQl9IC8vIGZvciBhcmd1bWVudHMKCgkJdGhpcy5uQ2FjaGVkT2JqZWN0c18gPSBuQ2FjaGVkT2JqZWN0czsKCgl9CgoJcmVtb3ZlKCkgewoKCQljb25zdCBvYmplY3RzID0gdGhpcy5fb2JqZWN0cywKCQkJaW5kaWNlc0J5VVVJRCA9IHRoaXMuX2luZGljZXNCeVVVSUQsCgkJCWJpbmRpbmdzID0gdGhpcy5fYmluZGluZ3MsCgkJCW5CaW5kaW5ncyA9IGJpbmRpbmdzLmxlbmd0aDsKCgkJbGV0IG5DYWNoZWRPYmplY3RzID0gdGhpcy5uQ2FjaGVkT2JqZWN0c187CgoJCWZvciAoIGxldCBpID0gMCwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQljb25zdCBvYmplY3QgPSBhcmd1bWVudHNbIGkgXSwKCQkJCXV1aWQgPSBvYmplY3QudXVpZCwKCQkJCWluZGV4ID0gaW5kaWNlc0J5VVVJRFsgdXVpZCBdOwoKCQkJaWYgKCBpbmRleCAhPT0gdW5kZWZpbmVkICYmIGluZGV4ID49IG5DYWNoZWRPYmplY3RzICkgewoKCQkJCS8vIG1vdmUgZXhpc3Rpbmcgb2JqZWN0IGludG8gdGhlIENBQ0hFRCByZWdpb24KCgkJCQljb25zdCBsYXN0Q2FjaGVkSW5kZXggPSBuQ2FjaGVkT2JqZWN0cyArKywKCQkJCQlmaXJzdEFjdGl2ZU9iamVjdCA9IG9iamVjdHNbIGxhc3RDYWNoZWRJbmRleCBdOwoKCQkJCWluZGljZXNCeVVVSURbIGZpcnN0QWN0aXZlT2JqZWN0LnV1aWQgXSA9IGluZGV4OwoJCQkJb2JqZWN0c1sgaW5kZXggXSA9IGZpcnN0QWN0aXZlT2JqZWN0OwoKCQkJCWluZGljZXNCeVVVSURbIHV1aWQgXSA9IGxhc3RDYWNoZWRJbmRleDsKCQkJCW9iamVjdHNbIGxhc3RDYWNoZWRJbmRleCBdID0gb2JqZWN0OwoKCQkJCS8vIGFjY291bnRpbmcgaXMgZG9uZSwgbm93IGRvIHRoZSBzYW1lIGZvciBhbGwgYmluZGluZ3MKCgkJCQlmb3IgKCBsZXQgaiA9IDAsIG0gPSBuQmluZGluZ3M7IGogIT09IG07ICsrIGogKSB7CgoJCQkJCWNvbnN0IGJpbmRpbmdzRm9yUGF0aCA9IGJpbmRpbmdzWyBqIF0sCgkJCQkJCWZpcnN0QWN0aXZlID0gYmluZGluZ3NGb3JQYXRoWyBsYXN0Q2FjaGVkSW5kZXggXSwKCQkJCQkJYmluZGluZyA9IGJpbmRpbmdzRm9yUGF0aFsgaW5kZXggXTsKCgkJCQkJYmluZGluZ3NGb3JQYXRoWyBpbmRleCBdID0gZmlyc3RBY3RpdmU7CgkJCQkJYmluZGluZ3NGb3JQYXRoWyBsYXN0Q2FjaGVkSW5kZXggXSA9IGJpbmRpbmc7CgoJCQkJfQoKCQkJfQoKCQl9IC8vIGZvciBhcmd1bWVudHMKCgkJdGhpcy5uQ2FjaGVkT2JqZWN0c18gPSBuQ2FjaGVkT2JqZWN0czsKCgl9CgoJLy8gcmVtb3ZlICYgZm9yZ2V0Cgl1bmNhY2hlKCkgewoKCQljb25zdCBvYmplY3RzID0gdGhpcy5fb2JqZWN0cywKCQkJaW5kaWNlc0J5VVVJRCA9IHRoaXMuX2luZGljZXNCeVVVSUQsCgkJCWJpbmRpbmdzID0gdGhpcy5fYmluZGluZ3MsCgkJCW5CaW5kaW5ncyA9IGJpbmRpbmdzLmxlbmd0aDsKCgkJbGV0IG5DYWNoZWRPYmplY3RzID0gdGhpcy5uQ2FjaGVkT2JqZWN0c18sCgkJCW5PYmplY3RzID0gb2JqZWN0cy5sZW5ndGg7CgoJCWZvciAoIGxldCBpID0gMCwgbiA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQljb25zdCBvYmplY3QgPSBhcmd1bWVudHNbIGkgXSwKCQkJCXV1aWQgPSBvYmplY3QudXVpZCwKCQkJCWluZGV4ID0gaW5kaWNlc0J5VVVJRFsgdXVpZCBdOwoKCQkJaWYgKCBpbmRleCAhPT0gdW5kZWZpbmVkICkgewoKCQkJCWRlbGV0ZSBpbmRpY2VzQnlVVUlEWyB1dWlkIF07CgoJCQkJaWYgKCBpbmRleCA8IG5DYWNoZWRPYmplY3RzICkgewoKCQkJCQkvLyBvYmplY3QgaXMgY2FjaGVkLCBzaHJpbmsgdGhlIENBQ0hFRCByZWdpb24KCgkJCQkJY29uc3QgZmlyc3RBY3RpdmVJbmRleCA9IC0tIG5DYWNoZWRPYmplY3RzLAoJCQkJCQlsYXN0Q2FjaGVkT2JqZWN0ID0gb2JqZWN0c1sgZmlyc3RBY3RpdmVJbmRleCBdLAoJCQkJCQlsYXN0SW5kZXggPSAtLSBuT2JqZWN0cywKCQkJCQkJbGFzdE9iamVjdCA9IG9iamVjdHNbIGxhc3RJbmRleCBdOwoKCQkJCQkvLyBsYXN0IGNhY2hlZCBvYmplY3QgdGFrZXMgdGhpcyBvYmplY3QncyBwbGFjZQoJCQkJCWluZGljZXNCeVVVSURbIGxhc3RDYWNoZWRPYmplY3QudXVpZCBdID0gaW5kZXg7CgkJCQkJb2JqZWN0c1sgaW5kZXggXSA9IGxhc3RDYWNoZWRPYmplY3Q7CgoJCQkJCS8vIGxhc3Qgb2JqZWN0IGdvZXMgdG8gdGhlIGFjdGl2YXRlZCBzbG90IGFuZCBwb3AKCQkJCQlpbmRpY2VzQnlVVUlEWyBsYXN0T2JqZWN0LnV1aWQgXSA9IGZpcnN0QWN0aXZlSW5kZXg7CgkJCQkJb2JqZWN0c1sgZmlyc3RBY3RpdmVJbmRleCBdID0gbGFzdE9iamVjdDsKCQkJCQlvYmplY3RzLnBvcCgpOwoKCQkJCQkvLyBhY2NvdW50aW5nIGlzIGRvbmUsIG5vdyBkbyB0aGUgc2FtZSBmb3IgYWxsIGJpbmRpbmdzCgoJCQkJCWZvciAoIGxldCBqID0gMCwgbSA9IG5CaW5kaW5nczsgaiAhPT0gbTsgKysgaiApIHsKCgkJCQkJCWNvbnN0IGJpbmRpbmdzRm9yUGF0aCA9IGJpbmRpbmdzWyBqIF0sCgkJCQkJCQlsYXN0Q2FjaGVkID0gYmluZGluZ3NGb3JQYXRoWyBmaXJzdEFjdGl2ZUluZGV4IF0sCgkJCQkJCQlsYXN0ID0gYmluZGluZ3NGb3JQYXRoWyBsYXN0SW5kZXggXTsKCgkJCQkJCWJpbmRpbmdzRm9yUGF0aFsgaW5kZXggXSA9IGxhc3RDYWNoZWQ7CgkJCQkJCWJpbmRpbmdzRm9yUGF0aFsgZmlyc3RBY3RpdmVJbmRleCBdID0gbGFzdDsKCQkJCQkJYmluZGluZ3NGb3JQYXRoLnBvcCgpOwoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gb2JqZWN0IGlzIGFjdGl2ZSwganVzdCBzd2FwIHdpdGggdGhlIGxhc3QgYW5kIHBvcAoKCQkJCQljb25zdCBsYXN0SW5kZXggPSAtLSBuT2JqZWN0cywKCQkJCQkJbGFzdE9iamVjdCA9IG9iamVjdHNbIGxhc3RJbmRleCBdOwoKCQkJCQlpZiAoIGxhc3RJbmRleCA+IDAgKSB7CgoJCQkJCQlpbmRpY2VzQnlVVUlEWyBsYXN0T2JqZWN0LnV1aWQgXSA9IGluZGV4OwoKCQkJCQl9CgoJCQkJCW9iamVjdHNbIGluZGV4IF0gPSBsYXN0T2JqZWN0OwoJCQkJCW9iamVjdHMucG9wKCk7CgoJCQkJCS8vIGFjY291bnRpbmcgaXMgZG9uZSwgbm93IGRvIHRoZSBzYW1lIGZvciBhbGwgYmluZGluZ3MKCgkJCQkJZm9yICggbGV0IGogPSAwLCBtID0gbkJpbmRpbmdzOyBqICE9PSBtOyArKyBqICkgewoKCQkJCQkJY29uc3QgYmluZGluZ3NGb3JQYXRoID0gYmluZGluZ3NbIGogXTsKCgkJCQkJCWJpbmRpbmdzRm9yUGF0aFsgaW5kZXggXSA9IGJpbmRpbmdzRm9yUGF0aFsgbGFzdEluZGV4IF07CgkJCQkJCWJpbmRpbmdzRm9yUGF0aC5wb3AoKTsKCgkJCQkJfQoKCQkJCX0gLy8gY2FjaGVkIG9yIGFjdGl2ZQoKCQkJfSAvLyBpZiBvYmplY3QgaXMga25vd24KCgkJfSAvLyBmb3IgYXJndW1lbnRzCgoJCXRoaXMubkNhY2hlZE9iamVjdHNfID0gbkNhY2hlZE9iamVjdHM7CgoJfQoKCS8vIEludGVybmFsIGludGVyZmFjZSB1c2VkIGJ5IGJlZnJpZW5kZWQgUHJvcGVydHlCaW5kaW5nLkNvbXBvc2l0ZToKCglzdWJzY3JpYmVfKCBwYXRoLCBwYXJzZWRQYXRoICkgewoKCQkvLyByZXR1cm5zIGFuIGFycmF5IG9mIGJpbmRpbmdzIGZvciB0aGUgZ2l2ZW4gcGF0aCB0aGF0IGlzIGNoYW5nZWQKCQkvLyBhY2NvcmRpbmcgdG8gdGhlIGNvbnRhaW5lZCBvYmplY3RzIGluIHRoZSBncm91cAoKCQljb25zdCBpbmRpY2VzQnlQYXRoID0gdGhpcy5fYmluZGluZ3NJbmRpY2VzQnlQYXRoOwoJCWxldCBpbmRleCA9IGluZGljZXNCeVBhdGhbIHBhdGggXTsKCQljb25zdCBiaW5kaW5ncyA9IHRoaXMuX2JpbmRpbmdzOwoKCQlpZiAoIGluZGV4ICE9PSB1bmRlZmluZWQgKSByZXR1cm4gYmluZGluZ3NbIGluZGV4IF07CgoJCWNvbnN0IHBhdGhzID0gdGhpcy5fcGF0aHMsCgkJCXBhcnNlZFBhdGhzID0gdGhpcy5fcGFyc2VkUGF0aHMsCgkJCW9iamVjdHMgPSB0aGlzLl9vYmplY3RzLAoJCQluT2JqZWN0cyA9IG9iamVjdHMubGVuZ3RoLAoJCQluQ2FjaGVkT2JqZWN0cyA9IHRoaXMubkNhY2hlZE9iamVjdHNfLAoJCQliaW5kaW5nc0ZvclBhdGggPSBuZXcgQXJyYXkoIG5PYmplY3RzICk7CgoJCWluZGV4ID0gYmluZGluZ3MubGVuZ3RoOwoKCQlpbmRpY2VzQnlQYXRoWyBwYXRoIF0gPSBpbmRleDsKCgkJcGF0aHMucHVzaCggcGF0aCApOwoJCXBhcnNlZFBhdGhzLnB1c2goIHBhcnNlZFBhdGggKTsKCQliaW5kaW5ncy5wdXNoKCBiaW5kaW5nc0ZvclBhdGggKTsKCgkJZm9yICggbGV0IGkgPSBuQ2FjaGVkT2JqZWN0cywgbiA9IG9iamVjdHMubGVuZ3RoOyBpICE9PSBuOyArKyBpICkgewoKCQkJY29uc3Qgb2JqZWN0ID0gb2JqZWN0c1sgaSBdOwoJCQliaW5kaW5nc0ZvclBhdGhbIGkgXSA9IG5ldyBQcm9wZXJ0eUJpbmRpbmcoIG9iamVjdCwgcGF0aCwgcGFyc2VkUGF0aCApOwoKCQl9CgoJCXJldHVybiBiaW5kaW5nc0ZvclBhdGg7CgoJfQoKCXVuc3Vic2NyaWJlXyggcGF0aCApIHsKCgkJLy8gdGVsbHMgdGhlIGdyb3VwIHRvIGZvcmdldCBhYm91dCBhIHByb3BlcnR5IHBhdGggYW5kIG5vIGxvbmdlcgoJCS8vIHVwZGF0ZSB0aGUgYXJyYXkgcHJldmlvdXNseSBvYnRhaW5lZCB3aXRoICdzdWJzY3JpYmVfJwoKCQljb25zdCBpbmRpY2VzQnlQYXRoID0gdGhpcy5fYmluZGluZ3NJbmRpY2VzQnlQYXRoLAoJCQlpbmRleCA9IGluZGljZXNCeVBhdGhbIHBhdGggXTsKCgkJaWYgKCBpbmRleCAhPT0gdW5kZWZpbmVkICkgewoKCQkJY29uc3QgcGF0aHMgPSB0aGlzLl9wYXRocywKCQkJCXBhcnNlZFBhdGhzID0gdGhpcy5fcGFyc2VkUGF0aHMsCgkJCQliaW5kaW5ncyA9IHRoaXMuX2JpbmRpbmdzLAoJCQkJbGFzdEJpbmRpbmdzSW5kZXggPSBiaW5kaW5ncy5sZW5ndGggLSAxLAoJCQkJbGFzdEJpbmRpbmdzID0gYmluZGluZ3NbIGxhc3RCaW5kaW5nc0luZGV4IF0sCgkJCQlsYXN0QmluZGluZ3NQYXRoID0gcGF0aFsgbGFzdEJpbmRpbmdzSW5kZXggXTsKCgkJCWluZGljZXNCeVBhdGhbIGxhc3RCaW5kaW5nc1BhdGggXSA9IGluZGV4OwoKCQkJYmluZGluZ3NbIGluZGV4IF0gPSBsYXN0QmluZGluZ3M7CgkJCWJpbmRpbmdzLnBvcCgpOwoKCQkJcGFyc2VkUGF0aHNbIGluZGV4IF0gPSBwYXJzZWRQYXRoc1sgbGFzdEJpbmRpbmdzSW5kZXggXTsKCQkJcGFyc2VkUGF0aHMucG9wKCk7CgoJCQlwYXRoc1sgaW5kZXggXSA9IHBhdGhzWyBsYXN0QmluZGluZ3NJbmRleCBdOwoJCQlwYXRocy5wb3AoKTsKCgkJfQoKCX0KCn0KCmNsYXNzIEFuaW1hdGlvbkFjdGlvbiB7CgoJY29uc3RydWN0b3IoIG1peGVyLCBjbGlwLCBsb2NhbFJvb3QgPSBudWxsLCBibGVuZE1vZGUgPSBjbGlwLmJsZW5kTW9kZSApIHsKCgkJdGhpcy5fbWl4ZXIgPSBtaXhlcjsKCQl0aGlzLl9jbGlwID0gY2xpcDsKCQl0aGlzLl9sb2NhbFJvb3QgPSBsb2NhbFJvb3Q7CgkJdGhpcy5ibGVuZE1vZGUgPSBibGVuZE1vZGU7CgoJCWNvbnN0IHRyYWNrcyA9IGNsaXAudHJhY2tzLAoJCQluVHJhY2tzID0gdHJhY2tzLmxlbmd0aCwKCQkJaW50ZXJwb2xhbnRzID0gbmV3IEFycmF5KCBuVHJhY2tzICk7CgoJCWNvbnN0IGludGVycG9sYW50U2V0dGluZ3MgPSB7CgkJCWVuZGluZ1N0YXJ0OiBaZXJvQ3VydmF0dXJlRW5kaW5nLAoJCQllbmRpbmdFbmQ6IFplcm9DdXJ2YXR1cmVFbmRpbmcKCQl9OwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgIT09IG5UcmFja3M7ICsrIGkgKSB7CgoJCQljb25zdCBpbnRlcnBvbGFudCA9IHRyYWNrc1sgaSBdLmNyZWF0ZUludGVycG9sYW50KCBudWxsICk7CgkJCWludGVycG9sYW50c1sgaSBdID0gaW50ZXJwb2xhbnQ7CgkJCWludGVycG9sYW50LnNldHRpbmdzID0gaW50ZXJwb2xhbnRTZXR0aW5nczsKCgkJfQoKCQl0aGlzLl9pbnRlcnBvbGFudFNldHRpbmdzID0gaW50ZXJwb2xhbnRTZXR0aW5nczsKCgkJdGhpcy5faW50ZXJwb2xhbnRzID0gaW50ZXJwb2xhbnRzOyAvLyBib3VuZCBieSB0aGUgbWl4ZXIKCgkJLy8gaW5zaWRlOiBQcm9wZXJ0eU1peGVyIChtYW5hZ2VkIGJ5IHRoZSBtaXhlcikKCQl0aGlzLl9wcm9wZXJ0eUJpbmRpbmdzID0gbmV3IEFycmF5KCBuVHJhY2tzICk7CgoJCXRoaXMuX2NhY2hlSW5kZXggPSBudWxsOyAvLyBmb3IgdGhlIG1lbW9yeSBtYW5hZ2VyCgkJdGhpcy5fYnlDbGlwQ2FjaGVJbmRleCA9IG51bGw7IC8vIGZvciB0aGUgbWVtb3J5IG1hbmFnZXIKCgkJdGhpcy5fdGltZVNjYWxlSW50ZXJwb2xhbnQgPSBudWxsOwoJCXRoaXMuX3dlaWdodEludGVycG9sYW50ID0gbnVsbDsKCgkJdGhpcy5sb29wID0gTG9vcFJlcGVhdDsKCQl0aGlzLl9sb29wQ291bnQgPSAtIDE7CgoJCS8vIGdsb2JhbCBtaXhlciB0aW1lIHdoZW4gdGhlIGFjdGlvbiBpcyB0byBiZSBzdGFydGVkCgkJLy8gaXQncyBzZXQgYmFjayB0byAnbnVsbCcgdXBvbiBzdGFydCBvZiB0aGUgYWN0aW9uCgkJdGhpcy5fc3RhcnRUaW1lID0gbnVsbDsKCgkJLy8gc2NhbGVkIGxvY2FsIHRpbWUgb2YgdGhlIGFjdGlvbgoJCS8vIGdldHMgY2xhbXBlZCBvciB3cmFwcGVkIHRvIDAuLmNsaXAuZHVyYXRpb24gYWNjb3JkaW5nIHRvIGxvb3AKCQl0aGlzLnRpbWUgPSAwOwoKCQl0aGlzLnRpbWVTY2FsZSA9IDE7CgkJdGhpcy5fZWZmZWN0aXZlVGltZVNjYWxlID0gMTsKCgkJdGhpcy53ZWlnaHQgPSAxOwoJCXRoaXMuX2VmZmVjdGl2ZVdlaWdodCA9IDE7CgoJCXRoaXMucmVwZXRpdGlvbnMgPSBJbmZpbml0eTsgLy8gbm8uIG9mIHJlcGV0aXRpb25zIHdoZW4gbG9vcGluZwoKCQl0aGlzLnBhdXNlZCA9IGZhbHNlOyAvLyB0cnVlIC0+IHplcm8gZWZmZWN0aXZlIHRpbWUgc2NhbGUKCQl0aGlzLmVuYWJsZWQgPSB0cnVlOyAvLyBmYWxzZSAtPiB6ZXJvIGVmZmVjdGl2ZSB3ZWlnaHQKCgkJdGhpcy5jbGFtcFdoZW5GaW5pc2hlZCA9IGZhbHNlOy8vIGtlZXAgZmVlZGluZyB0aGUgbGFzdCBmcmFtZT8KCgkJdGhpcy56ZXJvU2xvcGVBdFN0YXJ0ID0gdHJ1ZTsvLyBmb3Igc21vb3RoIGludGVycG9sYXRpb24gdy9vIHNlcGFyYXRlCgkJdGhpcy56ZXJvU2xvcGVBdEVuZCA9IHRydWU7Ly8gY2xpcHMgZm9yIHN0YXJ0LCBsb29wIGFuZCBlbmQKCgl9CgoJLy8gU3RhdGUgJiBTY2hlZHVsaW5nCgoJcGxheSgpIHsKCgkJdGhpcy5fbWl4ZXIuX2FjdGl2YXRlQWN0aW9uKCB0aGlzICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzdG9wKCkgewoKCQl0aGlzLl9taXhlci5fZGVhY3RpdmF0ZUFjdGlvbiggdGhpcyApOwoKCQlyZXR1cm4gdGhpcy5yZXNldCgpOwoKCX0KCglyZXNldCgpIHsKCgkJdGhpcy5wYXVzZWQgPSBmYWxzZTsKCQl0aGlzLmVuYWJsZWQgPSB0cnVlOwoKCQl0aGlzLnRpbWUgPSAwOyAvLyByZXN0YXJ0IGNsaXAKCQl0aGlzLl9sb29wQ291bnQgPSAtIDE7Ly8gZm9yZ2V0IHByZXZpb3VzIGxvb3BzCgkJdGhpcy5fc3RhcnRUaW1lID0gbnVsbDsvLyBmb3JnZXQgc2NoZWR1bGluZwoKCQlyZXR1cm4gdGhpcy5zdG9wRmFkaW5nKCkuc3RvcFdhcnBpbmcoKTsKCgl9CgoJaXNSdW5uaW5nKCkgewoKCQlyZXR1cm4gdGhpcy5lbmFibGVkICYmICEgdGhpcy5wYXVzZWQgJiYgdGhpcy50aW1lU2NhbGUgIT09IDAgJiYKCQkJdGhpcy5fc3RhcnRUaW1lID09PSBudWxsICYmIHRoaXMuX21peGVyLl9pc0FjdGl2ZUFjdGlvbiggdGhpcyApOwoKCX0KCgkvLyByZXR1cm4gdHJ1ZSB3aGVuIHBsYXkgaGFzIGJlZW4gY2FsbGVkCglpc1NjaGVkdWxlZCgpIHsKCgkJcmV0dXJuIHRoaXMuX21peGVyLl9pc0FjdGl2ZUFjdGlvbiggdGhpcyApOwoKCX0KCglzdGFydEF0KCB0aW1lICkgewoKCQl0aGlzLl9zdGFydFRpbWUgPSB0aW1lOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0TG9vcCggbW9kZSwgcmVwZXRpdGlvbnMgKSB7CgoJCXRoaXMubG9vcCA9IG1vZGU7CgkJdGhpcy5yZXBldGl0aW9ucyA9IHJlcGV0aXRpb25zOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJLy8gV2VpZ2h0CgoJLy8gc2V0IHRoZSB3ZWlnaHQgc3RvcHBpbmcgYW55IHNjaGVkdWxlZCBmYWRpbmcKCS8vIGFsdGhvdWdoIC5lbmFibGVkID0gZmFsc2UgeWllbGRzIGFuIGVmZmVjdGl2ZSB3ZWlnaHQgb2YgemVybywgdGhpcwoJLy8gbWV0aG9kIGRvZXMgKm5vdCogY2hhbmdlIC5lbmFibGVkLCBiZWNhdXNlIGl0IHdvdWxkIGJlIGNvbmZ1c2luZwoJc2V0RWZmZWN0aXZlV2VpZ2h0KCB3ZWlnaHQgKSB7CgoJCXRoaXMud2VpZ2h0ID0gd2VpZ2h0OwoKCQkvLyBub3RlOiBzYW1lIGxvZ2ljIGFzIHdoZW4gdXBkYXRlZCBhdCBydW50aW1lCgkJdGhpcy5fZWZmZWN0aXZlV2VpZ2h0ID0gdGhpcy5lbmFibGVkID8gd2VpZ2h0IDogMDsKCgkJcmV0dXJuIHRoaXMuc3RvcEZhZGluZygpOwoKCX0KCgkvLyByZXR1cm4gdGhlIHdlaWdodCBjb25zaWRlcmluZyBmYWRpbmcgYW5kIC5lbmFibGVkCglnZXRFZmZlY3RpdmVXZWlnaHQoKSB7CgoJCXJldHVybiB0aGlzLl9lZmZlY3RpdmVXZWlnaHQ7CgoJfQoKCWZhZGVJbiggZHVyYXRpb24gKSB7CgoJCXJldHVybiB0aGlzLl9zY2hlZHVsZUZhZGluZyggZHVyYXRpb24sIDAsIDEgKTsKCgl9CgoJZmFkZU91dCggZHVyYXRpb24gKSB7CgoJCXJldHVybiB0aGlzLl9zY2hlZHVsZUZhZGluZyggZHVyYXRpb24sIDEsIDAgKTsKCgl9CgoJY3Jvc3NGYWRlRnJvbSggZmFkZU91dEFjdGlvbiwgZHVyYXRpb24sIHdhcnAgKSB7CgoJCWZhZGVPdXRBY3Rpb24uZmFkZU91dCggZHVyYXRpb24gKTsKCQl0aGlzLmZhZGVJbiggZHVyYXRpb24gKTsKCgkJaWYgKCB3YXJwICkgewoKCQkJY29uc3QgZmFkZUluRHVyYXRpb24gPSB0aGlzLl9jbGlwLmR1cmF0aW9uLAoJCQkJZmFkZU91dER1cmF0aW9uID0gZmFkZU91dEFjdGlvbi5fY2xpcC5kdXJhdGlvbiwKCgkJCQlzdGFydEVuZFJhdGlvID0gZmFkZU91dER1cmF0aW9uIC8gZmFkZUluRHVyYXRpb24sCgkJCQllbmRTdGFydFJhdGlvID0gZmFkZUluRHVyYXRpb24gLyBmYWRlT3V0RHVyYXRpb247CgoJCQlmYWRlT3V0QWN0aW9uLndhcnAoIDEuMCwgc3RhcnRFbmRSYXRpbywgZHVyYXRpb24gKTsKCQkJdGhpcy53YXJwKCBlbmRTdGFydFJhdGlvLCAxLjAsIGR1cmF0aW9uICk7CgoJCX0KCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNyb3NzRmFkZVRvKCBmYWRlSW5BY3Rpb24sIGR1cmF0aW9uLCB3YXJwICkgewoKCQlyZXR1cm4gZmFkZUluQWN0aW9uLmNyb3NzRmFkZUZyb20oIHRoaXMsIGR1cmF0aW9uLCB3YXJwICk7CgoJfQoKCXN0b3BGYWRpbmcoKSB7CgoJCWNvbnN0IHdlaWdodEludGVycG9sYW50ID0gdGhpcy5fd2VpZ2h0SW50ZXJwb2xhbnQ7CgoJCWlmICggd2VpZ2h0SW50ZXJwb2xhbnQgIT09IG51bGwgKSB7CgoJCQl0aGlzLl93ZWlnaHRJbnRlcnBvbGFudCA9IG51bGw7CgkJCXRoaXMuX21peGVyLl90YWtlQmFja0NvbnRyb2xJbnRlcnBvbGFudCggd2VpZ2h0SW50ZXJwb2xhbnQgKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJLy8gVGltZSBTY2FsZSBDb250cm9sCgoJLy8gc2V0IHRoZSB0aW1lIHNjYWxlIHN0b3BwaW5nIGFueSBzY2hlZHVsZWQgd2FycGluZwoJLy8gYWx0aG91Z2ggLnBhdXNlZCA9IHRydWUgeWllbGRzIGFuIGVmZmVjdGl2ZSB0aW1lIHNjYWxlIG9mIHplcm8sIHRoaXMKCS8vIG1ldGhvZCBkb2VzICpub3QqIGNoYW5nZSAucGF1c2VkLCBiZWNhdXNlIGl0IHdvdWxkIGJlIGNvbmZ1c2luZwoJc2V0RWZmZWN0aXZlVGltZVNjYWxlKCB0aW1lU2NhbGUgKSB7CgoJCXRoaXMudGltZVNjYWxlID0gdGltZVNjYWxlOwoJCXRoaXMuX2VmZmVjdGl2ZVRpbWVTY2FsZSA9IHRoaXMucGF1c2VkID8gMCA6IHRpbWVTY2FsZTsKCgkJcmV0dXJuIHRoaXMuc3RvcFdhcnBpbmcoKTsKCgl9CgoJLy8gcmV0dXJuIHRoZSB0aW1lIHNjYWxlIGNvbnNpZGVyaW5nIHdhcnBpbmcgYW5kIC5wYXVzZWQKCWdldEVmZmVjdGl2ZVRpbWVTY2FsZSgpIHsKCgkJcmV0dXJuIHRoaXMuX2VmZmVjdGl2ZVRpbWVTY2FsZTsKCgl9CgoJc2V0RHVyYXRpb24oIGR1cmF0aW9uICkgewoKCQl0aGlzLnRpbWVTY2FsZSA9IHRoaXMuX2NsaXAuZHVyYXRpb24gLyBkdXJhdGlvbjsKCgkJcmV0dXJuIHRoaXMuc3RvcFdhcnBpbmcoKTsKCgl9CgoJc3luY1dpdGgoIGFjdGlvbiApIHsKCgkJdGhpcy50aW1lID0gYWN0aW9uLnRpbWU7CgkJdGhpcy50aW1lU2NhbGUgPSBhY3Rpb24udGltZVNjYWxlOwoKCQlyZXR1cm4gdGhpcy5zdG9wV2FycGluZygpOwoKCX0KCgloYWx0KCBkdXJhdGlvbiApIHsKCgkJcmV0dXJuIHRoaXMud2FycCggdGhpcy5fZWZmZWN0aXZlVGltZVNjYWxlLCAwLCBkdXJhdGlvbiApOwoKCX0KCgl3YXJwKCBzdGFydFRpbWVTY2FsZSwgZW5kVGltZVNjYWxlLCBkdXJhdGlvbiApIHsKCgkJY29uc3QgbWl4ZXIgPSB0aGlzLl9taXhlciwKCQkJbm93ID0gbWl4ZXIudGltZSwKCQkJdGltZVNjYWxlID0gdGhpcy50aW1lU2NhbGU7CgoJCWxldCBpbnRlcnBvbGFudCA9IHRoaXMuX3RpbWVTY2FsZUludGVycG9sYW50OwoKCQlpZiAoIGludGVycG9sYW50ID09PSBudWxsICkgewoKCQkJaW50ZXJwb2xhbnQgPSBtaXhlci5fbGVuZENvbnRyb2xJbnRlcnBvbGFudCgpOwoJCQl0aGlzLl90aW1lU2NhbGVJbnRlcnBvbGFudCA9IGludGVycG9sYW50OwoKCQl9CgoJCWNvbnN0IHRpbWVzID0gaW50ZXJwb2xhbnQucGFyYW1ldGVyUG9zaXRpb25zLAoJCQl2YWx1ZXMgPSBpbnRlcnBvbGFudC5zYW1wbGVWYWx1ZXM7CgoJCXRpbWVzWyAwIF0gPSBub3c7CgkJdGltZXNbIDEgXSA9IG5vdyArIGR1cmF0aW9uOwoKCQl2YWx1ZXNbIDAgXSA9IHN0YXJ0VGltZVNjYWxlIC8gdGltZVNjYWxlOwoJCXZhbHVlc1sgMSBdID0gZW5kVGltZVNjYWxlIC8gdGltZVNjYWxlOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc3RvcFdhcnBpbmcoKSB7CgoJCWNvbnN0IHRpbWVTY2FsZUludGVycG9sYW50ID0gdGhpcy5fdGltZVNjYWxlSW50ZXJwb2xhbnQ7CgoJCWlmICggdGltZVNjYWxlSW50ZXJwb2xhbnQgIT09IG51bGwgKSB7CgoJCQl0aGlzLl90aW1lU2NhbGVJbnRlcnBvbGFudCA9IG51bGw7CgkJCXRoaXMuX21peGVyLl90YWtlQmFja0NvbnRyb2xJbnRlcnBvbGFudCggdGltZVNjYWxlSW50ZXJwb2xhbnQgKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJLy8gT2JqZWN0IEFjY2Vzc29ycwoKCWdldE1peGVyKCkgewoKCQlyZXR1cm4gdGhpcy5fbWl4ZXI7CgoJfQoKCWdldENsaXAoKSB7CgoJCXJldHVybiB0aGlzLl9jbGlwOwoKCX0KCglnZXRSb290KCkgewoKCQlyZXR1cm4gdGhpcy5fbG9jYWxSb290IHx8IHRoaXMuX21peGVyLl9yb290OwoKCX0KCgkvLyBJbnRlcm5hCgoJX3VwZGF0ZSggdGltZSwgZGVsdGFUaW1lLCB0aW1lRGlyZWN0aW9uLCBhY2N1SW5kZXggKSB7CgoJCS8vIGNhbGxlZCBieSB0aGUgbWl4ZXIKCgkJaWYgKCAhIHRoaXMuZW5hYmxlZCApIHsKCgkJCS8vIGNhbGwgLl91cGRhdGVXZWlnaHQoKSB0byB1cGRhdGUgLl9lZmZlY3RpdmVXZWlnaHQKCgkJCXRoaXMuX3VwZGF0ZVdlaWdodCggdGltZSApOwoJCQlyZXR1cm47CgoJCX0KCgkJY29uc3Qgc3RhcnRUaW1lID0gdGhpcy5fc3RhcnRUaW1lOwoKCQlpZiAoIHN0YXJ0VGltZSAhPT0gbnVsbCApIHsKCgkJCS8vIGNoZWNrIGZvciBzY2hlZHVsZWQgc3RhcnQgb2YgYWN0aW9uCgoJCQljb25zdCB0aW1lUnVubmluZyA9ICggdGltZSAtIHN0YXJ0VGltZSApICogdGltZURpcmVjdGlvbjsKCQkJaWYgKCB0aW1lUnVubmluZyA8IDAgfHwgdGltZURpcmVjdGlvbiA9PT0gMCApIHsKCgkJCQlkZWx0YVRpbWUgPSAwOwoKCQkJfSBlbHNlIHsKCgoJCQkJdGhpcy5fc3RhcnRUaW1lID0gbnVsbDsgLy8gdW5zY2hlZHVsZQoJCQkJZGVsdGFUaW1lID0gdGltZURpcmVjdGlvbiAqIHRpbWVSdW5uaW5nOwoKCQkJfQoKCQl9CgoJCS8vIGFwcGx5IHRpbWUgc2NhbGUgYW5kIGFkdmFuY2UgdGltZQoKCQlkZWx0YVRpbWUgKj0gdGhpcy5fdXBkYXRlVGltZVNjYWxlKCB0aW1lICk7CgkJY29uc3QgY2xpcFRpbWUgPSB0aGlzLl91cGRhdGVUaW1lKCBkZWx0YVRpbWUgKTsKCgkJLy8gbm90ZTogX3VwZGF0ZVRpbWUgbWF5IGRpc2FibGUgdGhlIGFjdGlvbiByZXN1bHRpbmcgaW4KCQkvLyBhbiBlZmZlY3RpdmUgd2VpZ2h0IG9mIDAKCgkJY29uc3Qgd2VpZ2h0ID0gdGhpcy5fdXBkYXRlV2VpZ2h0KCB0aW1lICk7CgoJCWlmICggd2VpZ2h0ID4gMCApIHsKCgkJCWNvbnN0IGludGVycG9sYW50cyA9IHRoaXMuX2ludGVycG9sYW50czsKCQkJY29uc3QgcHJvcGVydHlNaXhlcnMgPSB0aGlzLl9wcm9wZXJ0eUJpbmRpbmdzOwoKCQkJc3dpdGNoICggdGhpcy5ibGVuZE1vZGUgKSB7CgoJCQkJY2FzZSBBZGRpdGl2ZUFuaW1hdGlvbkJsZW5kTW9kZToKCgkJCQkJZm9yICggbGV0IGogPSAwLCBtID0gaW50ZXJwb2xhbnRzLmxlbmd0aDsgaiAhPT0gbTsgKysgaiApIHsKCgkJCQkJCWludGVycG9sYW50c1sgaiBdLmV2YWx1YXRlKCBjbGlwVGltZSApOwoJCQkJCQlwcm9wZXJ0eU1peGVyc1sgaiBdLmFjY3VtdWxhdGVBZGRpdGl2ZSggd2VpZ2h0ICk7CgoJCQkJCX0KCgkJCQkJYnJlYWs7CgoJCQkJY2FzZSBOb3JtYWxBbmltYXRpb25CbGVuZE1vZGU6CgkJCQlkZWZhdWx0OgoKCQkJCQlmb3IgKCBsZXQgaiA9IDAsIG0gPSBpbnRlcnBvbGFudHMubGVuZ3RoOyBqICE9PSBtOyArKyBqICkgewoKCQkJCQkJaW50ZXJwb2xhbnRzWyBqIF0uZXZhbHVhdGUoIGNsaXBUaW1lICk7CgkJCQkJCXByb3BlcnR5TWl4ZXJzWyBqIF0uYWNjdW11bGF0ZSggYWNjdUluZGV4LCB3ZWlnaHQgKTsKCgkJCQkJfQoKCQkJfQoKCQl9CgoJfQoKCV91cGRhdGVXZWlnaHQoIHRpbWUgKSB7CgoJCWxldCB3ZWlnaHQgPSAwOwoKCQlpZiAoIHRoaXMuZW5hYmxlZCApIHsKCgkJCXdlaWdodCA9IHRoaXMud2VpZ2h0OwoJCQljb25zdCBpbnRlcnBvbGFudCA9IHRoaXMuX3dlaWdodEludGVycG9sYW50OwoKCQkJaWYgKCBpbnRlcnBvbGFudCAhPT0gbnVsbCApIHsKCgkJCQljb25zdCBpbnRlcnBvbGFudFZhbHVlID0gaW50ZXJwb2xhbnQuZXZhbHVhdGUoIHRpbWUgKVsgMCBdOwoKCQkJCXdlaWdodCAqPSBpbnRlcnBvbGFudFZhbHVlOwoKCQkJCWlmICggdGltZSA+IGludGVycG9sYW50LnBhcmFtZXRlclBvc2l0aW9uc1sgMSBdICkgewoKCQkJCQl0aGlzLnN0b3BGYWRpbmcoKTsKCgkJCQkJaWYgKCBpbnRlcnBvbGFudFZhbHVlID09PSAwICkgewoKCQkJCQkJLy8gZmFkZWQgb3V0LCBkaXNhYmxlCgkJCQkJCXRoaXMuZW5hYmxlZCA9IGZhbHNlOwoKCQkJCQl9CgoJCQkJfQoKCQkJfQoKCQl9CgoJCXRoaXMuX2VmZmVjdGl2ZVdlaWdodCA9IHdlaWdodDsKCQlyZXR1cm4gd2VpZ2h0OwoKCX0KCglfdXBkYXRlVGltZVNjYWxlKCB0aW1lICkgewoKCQlsZXQgdGltZVNjYWxlID0gMDsKCgkJaWYgKCAhIHRoaXMucGF1c2VkICkgewoKCQkJdGltZVNjYWxlID0gdGhpcy50aW1lU2NhbGU7CgoJCQljb25zdCBpbnRlcnBvbGFudCA9IHRoaXMuX3RpbWVTY2FsZUludGVycG9sYW50OwoKCQkJaWYgKCBpbnRlcnBvbGFudCAhPT0gbnVsbCApIHsKCgkJCQljb25zdCBpbnRlcnBvbGFudFZhbHVlID0gaW50ZXJwb2xhbnQuZXZhbHVhdGUoIHRpbWUgKVsgMCBdOwoKCQkJCXRpbWVTY2FsZSAqPSBpbnRlcnBvbGFudFZhbHVlOwoKCQkJCWlmICggdGltZSA+IGludGVycG9sYW50LnBhcmFtZXRlclBvc2l0aW9uc1sgMSBdICkgewoKCQkJCQl0aGlzLnN0b3BXYXJwaW5nKCk7CgoJCQkJCWlmICggdGltZVNjYWxlID09PSAwICkgewoKCQkJCQkJLy8gbW90aW9uIGhhcyBoYWx0ZWQsIHBhdXNlCgkJCQkJCXRoaXMucGF1c2VkID0gdHJ1ZTsKCgkJCQkJfSBlbHNlIHsKCgkJCQkJCS8vIHdhcnAgZG9uZSAtIGFwcGx5IGZpbmFsIHRpbWUgc2NhbGUKCQkJCQkJdGhpcy50aW1lU2NhbGUgPSB0aW1lU2NhbGU7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCX0KCgkJdGhpcy5fZWZmZWN0aXZlVGltZVNjYWxlID0gdGltZVNjYWxlOwoJCXJldHVybiB0aW1lU2NhbGU7CgoJfQoKCV91cGRhdGVUaW1lKCBkZWx0YVRpbWUgKSB7CgoJCWNvbnN0IGR1cmF0aW9uID0gdGhpcy5fY2xpcC5kdXJhdGlvbjsKCQljb25zdCBsb29wID0gdGhpcy5sb29wOwoKCQlsZXQgdGltZSA9IHRoaXMudGltZSArIGRlbHRhVGltZTsKCQlsZXQgbG9vcENvdW50ID0gdGhpcy5fbG9vcENvdW50OwoKCQljb25zdCBwaW5nUG9uZyA9ICggbG9vcCA9PT0gTG9vcFBpbmdQb25nICk7CgoJCWlmICggZGVsdGFUaW1lID09PSAwICkgewoKCQkJaWYgKCBsb29wQ291bnQgPT09IC0gMSApIHJldHVybiB0aW1lOwoKCQkJcmV0dXJuICggcGluZ1BvbmcgJiYgKCBsb29wQ291bnQgJiAxICkgPT09IDEgKSA/IGR1cmF0aW9uIC0gdGltZSA6IHRpbWU7CgoJCX0KCgkJaWYgKCBsb29wID09PSBMb29wT25jZSApIHsKCgkJCWlmICggbG9vcENvdW50ID09PSAtIDEgKSB7CgoJCQkJLy8ganVzdCBzdGFydGVkCgoJCQkJdGhpcy5fbG9vcENvdW50ID0gMDsKCQkJCXRoaXMuX3NldEVuZGluZ3MoIHRydWUsIHRydWUsIGZhbHNlICk7CgoJCQl9CgoJCQloYW5kbGVfc3RvcDogewoKCQkJCWlmICggdGltZSA+PSBkdXJhdGlvbiApIHsKCgkJCQkJdGltZSA9IGR1cmF0aW9uOwoKCQkJCX0gZWxzZSBpZiAoIHRpbWUgPCAwICkgewoKCQkJCQl0aW1lID0gMDsKCgkJCQl9IGVsc2UgewoKCQkJCQl0aGlzLnRpbWUgPSB0aW1lOwoKCQkJCQlicmVhayBoYW5kbGVfc3RvcDsKCgkJCQl9CgoJCQkJaWYgKCB0aGlzLmNsYW1wV2hlbkZpbmlzaGVkICkgdGhpcy5wYXVzZWQgPSB0cnVlOwoJCQkJZWxzZSB0aGlzLmVuYWJsZWQgPSBmYWxzZTsKCgkJCQl0aGlzLnRpbWUgPSB0aW1lOwoKCQkJCXRoaXMuX21peGVyLmRpc3BhdGNoRXZlbnQoIHsKCQkJCQl0eXBlOiAnZmluaXNoZWQnLCBhY3Rpb246IHRoaXMsCgkJCQkJZGlyZWN0aW9uOiBkZWx0YVRpbWUgPCAwID8gLSAxIDogMQoJCQkJfSApOwoKCQkJfQoKCQl9IGVsc2UgeyAvLyByZXBldGl0aXZlIFJlcGVhdCBvciBQaW5nUG9uZwoKCQkJaWYgKCBsb29wQ291bnQgPT09IC0gMSApIHsKCgkJCQkvLyBqdXN0IHN0YXJ0ZWQKCgkJCQlpZiAoIGRlbHRhVGltZSA+PSAwICkgewoKCQkJCQlsb29wQ291bnQgPSAwOwoKCQkJCQl0aGlzLl9zZXRFbmRpbmdzKCB0cnVlLCB0aGlzLnJlcGV0aXRpb25zID09PSAwLCBwaW5nUG9uZyApOwoKCQkJCX0gZWxzZSB7CgoJCQkJCS8vIHdoZW4gbG9vcGluZyBpbiByZXZlcnNlIGRpcmVjdGlvbiwgdGhlIGluaXRpYWwKCQkJCQkvLyB0cmFuc2l0aW9uIHRocm91Z2ggemVybyBjb3VudHMgYXMgYSByZXBldGl0aW9uLAoJCQkJCS8vIHNvIGxlYXZlIGxvb3BDb3VudCBhdCAtMQoKCQkJCQl0aGlzLl9zZXRFbmRpbmdzKCB0aGlzLnJlcGV0aXRpb25zID09PSAwLCB0cnVlLCBwaW5nUG9uZyApOwoKCQkJCX0KCgkJCX0KCgkJCWlmICggdGltZSA+PSBkdXJhdGlvbiB8fCB0aW1lIDwgMCApIHsKCgkJCQkvLyB3cmFwIGFyb3VuZAoKCQkJCWNvbnN0IGxvb3BEZWx0YSA9IE1hdGguZmxvb3IoIHRpbWUgLyBkdXJhdGlvbiApOyAvLyBzaWduZWQKCQkJCXRpbWUgLT0gZHVyYXRpb24gKiBsb29wRGVsdGE7CgoJCQkJbG9vcENvdW50ICs9IE1hdGguYWJzKCBsb29wRGVsdGEgKTsKCgkJCQljb25zdCBwZW5kaW5nID0gdGhpcy5yZXBldGl0aW9ucyAtIGxvb3BDb3VudDsKCgkJCQlpZiAoIHBlbmRpbmcgPD0gMCApIHsKCgkJCQkJLy8gaGF2ZSB0byBzdG9wIChzd2l0Y2ggc3RhdGUsIGNsYW1wIHRpbWUsIGZpcmUgZXZlbnQpCgoJCQkJCWlmICggdGhpcy5jbGFtcFdoZW5GaW5pc2hlZCApIHRoaXMucGF1c2VkID0gdHJ1ZTsKCQkJCQllbHNlIHRoaXMuZW5hYmxlZCA9IGZhbHNlOwoKCQkJCQl0aW1lID0gZGVsdGFUaW1lID4gMCA/IGR1cmF0aW9uIDogMDsKCgkJCQkJdGhpcy50aW1lID0gdGltZTsKCgkJCQkJdGhpcy5fbWl4ZXIuZGlzcGF0Y2hFdmVudCggewoJCQkJCQl0eXBlOiAnZmluaXNoZWQnLCBhY3Rpb246IHRoaXMsCgkJCQkJCWRpcmVjdGlvbjogZGVsdGFUaW1lID4gMCA/IDEgOiAtIDEKCQkJCQl9ICk7CgoJCQkJfSBlbHNlIHsKCgkJCQkJLy8ga2VlcCBydW5uaW5nCgoJCQkJCWlmICggcGVuZGluZyA9PT0gMSApIHsKCgkJCQkJCS8vIGVudGVyaW5nIHRoZSBsYXN0IHJvdW5kCgoJCQkJCQljb25zdCBhdFN0YXJ0ID0gZGVsdGFUaW1lIDwgMDsKCQkJCQkJdGhpcy5fc2V0RW5kaW5ncyggYXRTdGFydCwgISBhdFN0YXJ0LCBwaW5nUG9uZyApOwoKCQkJCQl9IGVsc2UgewoKCQkJCQkJdGhpcy5fc2V0RW5kaW5ncyggZmFsc2UsIGZhbHNlLCBwaW5nUG9uZyApOwoKCQkJCQl9CgoJCQkJCXRoaXMuX2xvb3BDb3VudCA9IGxvb3BDb3VudDsKCgkJCQkJdGhpcy50aW1lID0gdGltZTsKCgkJCQkJdGhpcy5fbWl4ZXIuZGlzcGF0Y2hFdmVudCggewoJCQkJCQl0eXBlOiAnbG9vcCcsIGFjdGlvbjogdGhpcywgbG9vcERlbHRhOiBsb29wRGVsdGEKCQkJCQl9ICk7CgoJCQkJfQoKCQkJfSBlbHNlIHsKCgkJCQl0aGlzLnRpbWUgPSB0aW1lOwoKCQkJfQoKCQkJaWYgKCBwaW5nUG9uZyAmJiAoIGxvb3BDb3VudCAmIDEgKSA9PT0gMSApIHsKCgkJCQkvLyBpbnZlcnQgdGltZSBmb3IgdGhlICJwb25nIHJvdW5kIgoKCQkJCXJldHVybiBkdXJhdGlvbiAtIHRpbWU7CgoJCQl9CgoJCX0KCgkJcmV0dXJuIHRpbWU7CgoJfQoKCV9zZXRFbmRpbmdzKCBhdFN0YXJ0LCBhdEVuZCwgcGluZ1BvbmcgKSB7CgoJCWNvbnN0IHNldHRpbmdzID0gdGhpcy5faW50ZXJwb2xhbnRTZXR0aW5nczsKCgkJaWYgKCBwaW5nUG9uZyApIHsKCgkJCXNldHRpbmdzLmVuZGluZ1N0YXJ0ID0gWmVyb1Nsb3BlRW5kaW5nOwoJCQlzZXR0aW5ncy5lbmRpbmdFbmQgPSBaZXJvU2xvcGVFbmRpbmc7CgoJCX0gZWxzZSB7CgoJCQkvLyBhc3N1bWluZyBmb3IgTG9vcE9uY2UgYXRTdGFydCA9PSBhdEVuZCA9PSB0cnVlCgoJCQlpZiAoIGF0U3RhcnQgKSB7CgoJCQkJc2V0dGluZ3MuZW5kaW5nU3RhcnQgPSB0aGlzLnplcm9TbG9wZUF0U3RhcnQgPyBaZXJvU2xvcGVFbmRpbmcgOiBaZXJvQ3VydmF0dXJlRW5kaW5nOwoKCQkJfSBlbHNlIHsKCgkJCQlzZXR0aW5ncy5lbmRpbmdTdGFydCA9IFdyYXBBcm91bmRFbmRpbmc7CgoJCQl9CgoJCQlpZiAoIGF0RW5kICkgewoKCQkJCXNldHRpbmdzLmVuZGluZ0VuZCA9IHRoaXMuemVyb1Nsb3BlQXRFbmQgPyBaZXJvU2xvcGVFbmRpbmcgOiBaZXJvQ3VydmF0dXJlRW5kaW5nOwoKCQkJfSBlbHNlIHsKCgkJCQlzZXR0aW5ncy5lbmRpbmdFbmQgCSA9IFdyYXBBcm91bmRFbmRpbmc7CgoJCQl9CgoJCX0KCgl9CgoJX3NjaGVkdWxlRmFkaW5nKCBkdXJhdGlvbiwgd2VpZ2h0Tm93LCB3ZWlnaHRUaGVuICkgewoKCQljb25zdCBtaXhlciA9IHRoaXMuX21peGVyLCBub3cgPSBtaXhlci50aW1lOwoJCWxldCBpbnRlcnBvbGFudCA9IHRoaXMuX3dlaWdodEludGVycG9sYW50OwoKCQlpZiAoIGludGVycG9sYW50ID09PSBudWxsICkgewoKCQkJaW50ZXJwb2xhbnQgPSBtaXhlci5fbGVuZENvbnRyb2xJbnRlcnBvbGFudCgpOwoJCQl0aGlzLl93ZWlnaHRJbnRlcnBvbGFudCA9IGludGVycG9sYW50OwoKCQl9CgoJCWNvbnN0IHRpbWVzID0gaW50ZXJwb2xhbnQucGFyYW1ldGVyUG9zaXRpb25zLAoJCQl2YWx1ZXMgPSBpbnRlcnBvbGFudC5zYW1wbGVWYWx1ZXM7CgoJCXRpbWVzWyAwIF0gPSBub3c7CgkJdmFsdWVzWyAwIF0gPSB3ZWlnaHROb3c7CgkJdGltZXNbIDEgXSA9IG5vdyArIGR1cmF0aW9uOwoJCXZhbHVlc1sgMSBdID0gd2VpZ2h0VGhlbjsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKY29uc3QgX2NvbnRyb2xJbnRlcnBvbGFudHNSZXN1bHRCdWZmZXIgPSBuZXcgRmxvYXQzMkFycmF5KCAxICk7CgoKY2xhc3MgQW5pbWF0aW9uTWl4ZXIgZXh0ZW5kcyBFdmVudERpc3BhdGNoZXIgewoKCWNvbnN0cnVjdG9yKCByb290ICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLl9yb290ID0gcm9vdDsKCQl0aGlzLl9pbml0TWVtb3J5TWFuYWdlcigpOwoJCXRoaXMuX2FjY3VJbmRleCA9IDA7CgkJdGhpcy50aW1lID0gMDsKCQl0aGlzLnRpbWVTY2FsZSA9IDEuMDsKCgl9CgoJX2JpbmRBY3Rpb24oIGFjdGlvbiwgcHJvdG90eXBlQWN0aW9uICkgewoKCQljb25zdCByb290ID0gYWN0aW9uLl9sb2NhbFJvb3QgfHwgdGhpcy5fcm9vdCwKCQkJdHJhY2tzID0gYWN0aW9uLl9jbGlwLnRyYWNrcywKCQkJblRyYWNrcyA9IHRyYWNrcy5sZW5ndGgsCgkJCWJpbmRpbmdzID0gYWN0aW9uLl9wcm9wZXJ0eUJpbmRpbmdzLAoJCQlpbnRlcnBvbGFudHMgPSBhY3Rpb24uX2ludGVycG9sYW50cywKCQkJcm9vdFV1aWQgPSByb290LnV1aWQsCgkJCWJpbmRpbmdzQnlSb290ID0gdGhpcy5fYmluZGluZ3NCeVJvb3RBbmROYW1lOwoKCQlsZXQgYmluZGluZ3NCeU5hbWUgPSBiaW5kaW5nc0J5Um9vdFsgcm9vdFV1aWQgXTsKCgkJaWYgKCBiaW5kaW5nc0J5TmFtZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJYmluZGluZ3NCeU5hbWUgPSB7fTsKCQkJYmluZGluZ3NCeVJvb3RbIHJvb3RVdWlkIF0gPSBiaW5kaW5nc0J5TmFtZTsKCgkJfQoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgIT09IG5UcmFja3M7ICsrIGkgKSB7CgoJCQljb25zdCB0cmFjayA9IHRyYWNrc1sgaSBdLAoJCQkJdHJhY2tOYW1lID0gdHJhY2submFtZTsKCgkJCWxldCBiaW5kaW5nID0gYmluZGluZ3NCeU5hbWVbIHRyYWNrTmFtZSBdOwoKCQkJaWYgKCBiaW5kaW5nICE9PSB1bmRlZmluZWQgKSB7CgoJCQkJKysgYmluZGluZy5yZWZlcmVuY2VDb3VudDsKCQkJCWJpbmRpbmdzWyBpIF0gPSBiaW5kaW5nOwoKCQkJfSBlbHNlIHsKCgkJCQliaW5kaW5nID0gYmluZGluZ3NbIGkgXTsKCgkJCQlpZiAoIGJpbmRpbmcgIT09IHVuZGVmaW5lZCApIHsKCgkJCQkJLy8gZXhpc3RpbmcgYmluZGluZywgbWFrZSBzdXJlIHRoZSBjYWNoZSBrbm93cwoKCQkJCQlpZiAoIGJpbmRpbmcuX2NhY2hlSW5kZXggPT09IG51bGwgKSB7CgoJCQkJCQkrKyBiaW5kaW5nLnJlZmVyZW5jZUNvdW50OwoJCQkJCQl0aGlzLl9hZGRJbmFjdGl2ZUJpbmRpbmcoIGJpbmRpbmcsIHJvb3RVdWlkLCB0cmFja05hbWUgKTsKCgkJCQkJfQoKCQkJCQljb250aW51ZTsKCgkJCQl9CgoJCQkJY29uc3QgcGF0aCA9IHByb3RvdHlwZUFjdGlvbiAmJiBwcm90b3R5cGVBY3Rpb24uCgkJCQkJX3Byb3BlcnR5QmluZGluZ3NbIGkgXS5iaW5kaW5nLnBhcnNlZFBhdGg7CgoJCQkJYmluZGluZyA9IG5ldyBQcm9wZXJ0eU1peGVyKAoJCQkJCVByb3BlcnR5QmluZGluZy5jcmVhdGUoIHJvb3QsIHRyYWNrTmFtZSwgcGF0aCApLAoJCQkJCXRyYWNrLlZhbHVlVHlwZU5hbWUsIHRyYWNrLmdldFZhbHVlU2l6ZSgpICk7CgoJCQkJKysgYmluZGluZy5yZWZlcmVuY2VDb3VudDsKCQkJCXRoaXMuX2FkZEluYWN0aXZlQmluZGluZyggYmluZGluZywgcm9vdFV1aWQsIHRyYWNrTmFtZSApOwoKCQkJCWJpbmRpbmdzWyBpIF0gPSBiaW5kaW5nOwoKCQkJfQoKCQkJaW50ZXJwb2xhbnRzWyBpIF0ucmVzdWx0QnVmZmVyID0gYmluZGluZy5idWZmZXI7CgoJCX0KCgl9CgoJX2FjdGl2YXRlQWN0aW9uKCBhY3Rpb24gKSB7CgoJCWlmICggISB0aGlzLl9pc0FjdGl2ZUFjdGlvbiggYWN0aW9uICkgKSB7CgoJCQlpZiAoIGFjdGlvbi5fY2FjaGVJbmRleCA9PT0gbnVsbCApIHsKCgkJCQkvLyB0aGlzIGFjdGlvbiBoYXMgYmVlbiBmb3Jnb3R0ZW4gYnkgdGhlIGNhY2hlLCBidXQgdGhlIHVzZXIKCQkJCS8vIGFwcGVhcnMgdG8gYmUgc3RpbGwgdXNpbmcgaXQgLT4gcmViaW5kCgoJCQkJY29uc3Qgcm9vdFV1aWQgPSAoIGFjdGlvbi5fbG9jYWxSb290IHx8IHRoaXMuX3Jvb3QgKS51dWlkLAoJCQkJCWNsaXBVdWlkID0gYWN0aW9uLl9jbGlwLnV1aWQsCgkJCQkJYWN0aW9uc0ZvckNsaXAgPSB0aGlzLl9hY3Rpb25zQnlDbGlwWyBjbGlwVXVpZCBdOwoKCQkJCXRoaXMuX2JpbmRBY3Rpb24oIGFjdGlvbiwKCQkJCQlhY3Rpb25zRm9yQ2xpcCAmJiBhY3Rpb25zRm9yQ2xpcC5rbm93bkFjdGlvbnNbIDAgXSApOwoKCQkJCXRoaXMuX2FkZEluYWN0aXZlQWN0aW9uKCBhY3Rpb24sIGNsaXBVdWlkLCByb290VXVpZCApOwoKCQkJfQoKCQkJY29uc3QgYmluZGluZ3MgPSBhY3Rpb24uX3Byb3BlcnR5QmluZGluZ3M7CgoJCQkvLyBpbmNyZW1lbnQgcmVmZXJlbmNlIGNvdW50cyAvIHNvcnQgb3V0IHN0YXRlCgkJCWZvciAoIGxldCBpID0gMCwgbiA9IGJpbmRpbmdzLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCQljb25zdCBiaW5kaW5nID0gYmluZGluZ3NbIGkgXTsKCgkJCQlpZiAoIGJpbmRpbmcudXNlQ291bnQgKysgPT09IDAgKSB7CgoJCQkJCXRoaXMuX2xlbmRCaW5kaW5nKCBiaW5kaW5nICk7CgkJCQkJYmluZGluZy5zYXZlT3JpZ2luYWxTdGF0ZSgpOwoKCQkJCX0KCgkJCX0KCgkJCXRoaXMuX2xlbmRBY3Rpb24oIGFjdGlvbiApOwoKCQl9CgoJfQoKCV9kZWFjdGl2YXRlQWN0aW9uKCBhY3Rpb24gKSB7CgoJCWlmICggdGhpcy5faXNBY3RpdmVBY3Rpb24oIGFjdGlvbiApICkgewoKCQkJY29uc3QgYmluZGluZ3MgPSBhY3Rpb24uX3Byb3BlcnR5QmluZGluZ3M7CgoJCQkvLyBkZWNyZW1lbnQgcmVmZXJlbmNlIGNvdW50cyAvIHNvcnQgb3V0IHN0YXRlCgkJCWZvciAoIGxldCBpID0gMCwgbiA9IGJpbmRpbmdzLmxlbmd0aDsgaSAhPT0gbjsgKysgaSApIHsKCgkJCQljb25zdCBiaW5kaW5nID0gYmluZGluZ3NbIGkgXTsKCgkJCQlpZiAoIC0tIGJpbmRpbmcudXNlQ291bnQgPT09IDAgKSB7CgoJCQkJCWJpbmRpbmcucmVzdG9yZU9yaWdpbmFsU3RhdGUoKTsKCQkJCQl0aGlzLl90YWtlQmFja0JpbmRpbmcoIGJpbmRpbmcgKTsKCgkJCQl9CgoJCQl9CgoJCQl0aGlzLl90YWtlQmFja0FjdGlvbiggYWN0aW9uICk7CgoJCX0KCgl9CgoJLy8gTWVtb3J5IG1hbmFnZXIKCglfaW5pdE1lbW9yeU1hbmFnZXIoKSB7CgoJCXRoaXMuX2FjdGlvbnMgPSBbXTsgLy8gJ25BY3RpdmVBY3Rpb25zJyBmb2xsb3dlZCBieSBpbmFjdGl2ZSBvbmVzCgkJdGhpcy5fbkFjdGl2ZUFjdGlvbnMgPSAwOwoKCQl0aGlzLl9hY3Rpb25zQnlDbGlwID0ge307CgkJLy8gaW5zaWRlOgoJCS8vIHsKCQkvLyAJa25vd25BY3Rpb25zOiBBcnJheTwgQW5pbWF0aW9uQWN0aW9uID4gLSB1c2VkIGFzIHByb3RvdHlwZXMKCQkvLyAJYWN0aW9uQnlSb290OiBBbmltYXRpb25BY3Rpb24gLSBsb29rdXAKCQkvLyB9CgoKCQl0aGlzLl9iaW5kaW5ncyA9IFtdOyAvLyAnbkFjdGl2ZUJpbmRpbmdzJyBmb2xsb3dlZCBieSBpbmFjdGl2ZSBvbmVzCgkJdGhpcy5fbkFjdGl2ZUJpbmRpbmdzID0gMDsKCgkJdGhpcy5fYmluZGluZ3NCeVJvb3RBbmROYW1lID0ge307IC8vIGluc2lkZTogTWFwPCBuYW1lLCBQcm9wZXJ0eU1peGVyID4KCgoJCXRoaXMuX2NvbnRyb2xJbnRlcnBvbGFudHMgPSBbXTsgLy8gc2FtZSBnYW1lIGFzIGFib3ZlCgkJdGhpcy5fbkFjdGl2ZUNvbnRyb2xJbnRlcnBvbGFudHMgPSAwOwoKCQljb25zdCBzY29wZSA9IHRoaXM7CgoJCXRoaXMuc3RhdHMgPSB7CgoJCQlhY3Rpb25zOiB7CgkJCQlnZXQgdG90YWwoKSB7CgoJCQkJCXJldHVybiBzY29wZS5fYWN0aW9ucy5sZW5ndGg7CgoJCQkJfSwKCQkJCWdldCBpblVzZSgpIHsKCgkJCQkJcmV0dXJuIHNjb3BlLl9uQWN0aXZlQWN0aW9uczsKCgkJCQl9CgkJCX0sCgkJCWJpbmRpbmdzOiB7CgkJCQlnZXQgdG90YWwoKSB7CgoJCQkJCXJldHVybiBzY29wZS5fYmluZGluZ3MubGVuZ3RoOwoKCQkJCX0sCgkJCQlnZXQgaW5Vc2UoKSB7CgoJCQkJCXJldHVybiBzY29wZS5fbkFjdGl2ZUJpbmRpbmdzOwoKCQkJCX0KCQkJfSwKCQkJY29udHJvbEludGVycG9sYW50czogewoJCQkJZ2V0IHRvdGFsKCkgewoKCQkJCQlyZXR1cm4gc2NvcGUuX2NvbnRyb2xJbnRlcnBvbGFudHMubGVuZ3RoOwoKCQkJCX0sCgkJCQlnZXQgaW5Vc2UoKSB7CgoJCQkJCXJldHVybiBzY29wZS5fbkFjdGl2ZUNvbnRyb2xJbnRlcnBvbGFudHM7CgoJCQkJfQoJCQl9CgoJCX07CgoJfQoKCS8vIE1lbW9yeSBtYW5hZ2VtZW50IGZvciBBbmltYXRpb25BY3Rpb24gb2JqZWN0cwoKCV9pc0FjdGl2ZUFjdGlvbiggYWN0aW9uICkgewoKCQljb25zdCBpbmRleCA9IGFjdGlvbi5fY2FjaGVJbmRleDsKCQlyZXR1cm4gaW5kZXggIT09IG51bGwgJiYgaW5kZXggPCB0aGlzLl9uQWN0aXZlQWN0aW9uczsKCgl9CgoJX2FkZEluYWN0aXZlQWN0aW9uKCBhY3Rpb24sIGNsaXBVdWlkLCByb290VXVpZCApIHsKCgkJY29uc3QgYWN0aW9ucyA9IHRoaXMuX2FjdGlvbnMsCgkJCWFjdGlvbnNCeUNsaXAgPSB0aGlzLl9hY3Rpb25zQnlDbGlwOwoKCQlsZXQgYWN0aW9uc0ZvckNsaXAgPSBhY3Rpb25zQnlDbGlwWyBjbGlwVXVpZCBdOwoKCQlpZiAoIGFjdGlvbnNGb3JDbGlwID09PSB1bmRlZmluZWQgKSB7CgoJCQlhY3Rpb25zRm9yQ2xpcCA9IHsKCgkJCQlrbm93bkFjdGlvbnM6IFsgYWN0aW9uIF0sCgkJCQlhY3Rpb25CeVJvb3Q6IHt9CgoJCQl9OwoKCQkJYWN0aW9uLl9ieUNsaXBDYWNoZUluZGV4ID0gMDsKCgkJCWFjdGlvbnNCeUNsaXBbIGNsaXBVdWlkIF0gPSBhY3Rpb25zRm9yQ2xpcDsKCgkJfSBlbHNlIHsKCgkJCWNvbnN0IGtub3duQWN0aW9ucyA9IGFjdGlvbnNGb3JDbGlwLmtub3duQWN0aW9uczsKCgkJCWFjdGlvbi5fYnlDbGlwQ2FjaGVJbmRleCA9IGtub3duQWN0aW9ucy5sZW5ndGg7CgkJCWtub3duQWN0aW9ucy5wdXNoKCBhY3Rpb24gKTsKCgkJfQoKCQlhY3Rpb24uX2NhY2hlSW5kZXggPSBhY3Rpb25zLmxlbmd0aDsKCQlhY3Rpb25zLnB1c2goIGFjdGlvbiApOwoKCQlhY3Rpb25zRm9yQ2xpcC5hY3Rpb25CeVJvb3RbIHJvb3RVdWlkIF0gPSBhY3Rpb247CgoJfQoKCV9yZW1vdmVJbmFjdGl2ZUFjdGlvbiggYWN0aW9uICkgewoKCQljb25zdCBhY3Rpb25zID0gdGhpcy5fYWN0aW9ucywKCQkJbGFzdEluYWN0aXZlQWN0aW9uID0gYWN0aW9uc1sgYWN0aW9ucy5sZW5ndGggLSAxIF0sCgkJCWNhY2hlSW5kZXggPSBhY3Rpb24uX2NhY2hlSW5kZXg7CgoJCWxhc3RJbmFjdGl2ZUFjdGlvbi5fY2FjaGVJbmRleCA9IGNhY2hlSW5kZXg7CgkJYWN0aW9uc1sgY2FjaGVJbmRleCBdID0gbGFzdEluYWN0aXZlQWN0aW9uOwoJCWFjdGlvbnMucG9wKCk7CgoJCWFjdGlvbi5fY2FjaGVJbmRleCA9IG51bGw7CgoKCQljb25zdCBjbGlwVXVpZCA9IGFjdGlvbi5fY2xpcC51dWlkLAoJCQlhY3Rpb25zQnlDbGlwID0gdGhpcy5fYWN0aW9uc0J5Q2xpcCwKCQkJYWN0aW9uc0ZvckNsaXAgPSBhY3Rpb25zQnlDbGlwWyBjbGlwVXVpZCBdLAoJCQlrbm93bkFjdGlvbnNGb3JDbGlwID0gYWN0aW9uc0ZvckNsaXAua25vd25BY3Rpb25zLAoKCQkJbGFzdEtub3duQWN0aW9uID0KCQkJCWtub3duQWN0aW9uc0ZvckNsaXBbIGtub3duQWN0aW9uc0ZvckNsaXAubGVuZ3RoIC0gMSBdLAoKCQkJYnlDbGlwQ2FjaGVJbmRleCA9IGFjdGlvbi5fYnlDbGlwQ2FjaGVJbmRleDsKCgkJbGFzdEtub3duQWN0aW9uLl9ieUNsaXBDYWNoZUluZGV4ID0gYnlDbGlwQ2FjaGVJbmRleDsKCQlrbm93bkFjdGlvbnNGb3JDbGlwWyBieUNsaXBDYWNoZUluZGV4IF0gPSBsYXN0S25vd25BY3Rpb247CgkJa25vd25BY3Rpb25zRm9yQ2xpcC5wb3AoKTsKCgkJYWN0aW9uLl9ieUNsaXBDYWNoZUluZGV4ID0gbnVsbDsKCgoJCWNvbnN0IGFjdGlvbkJ5Um9vdCA9IGFjdGlvbnNGb3JDbGlwLmFjdGlvbkJ5Um9vdCwKCQkJcm9vdFV1aWQgPSAoIGFjdGlvbi5fbG9jYWxSb290IHx8IHRoaXMuX3Jvb3QgKS51dWlkOwoKCQlkZWxldGUgYWN0aW9uQnlSb290WyByb290VXVpZCBdOwoKCQlpZiAoIGtub3duQWN0aW9uc0ZvckNsaXAubGVuZ3RoID09PSAwICkgewoKCQkJZGVsZXRlIGFjdGlvbnNCeUNsaXBbIGNsaXBVdWlkIF07CgoJCX0KCgkJdGhpcy5fcmVtb3ZlSW5hY3RpdmVCaW5kaW5nc0ZvckFjdGlvbiggYWN0aW9uICk7CgoJfQoKCV9yZW1vdmVJbmFjdGl2ZUJpbmRpbmdzRm9yQWN0aW9uKCBhY3Rpb24gKSB7CgoJCWNvbnN0IGJpbmRpbmdzID0gYWN0aW9uLl9wcm9wZXJ0eUJpbmRpbmdzOwoKCQlmb3IgKCBsZXQgaSA9IDAsIG4gPSBiaW5kaW5ncy5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQljb25zdCBiaW5kaW5nID0gYmluZGluZ3NbIGkgXTsKCgkJCWlmICggLS0gYmluZGluZy5yZWZlcmVuY2VDb3VudCA9PT0gMCApIHsKCgkJCQl0aGlzLl9yZW1vdmVJbmFjdGl2ZUJpbmRpbmcoIGJpbmRpbmcgKTsKCgkJCX0KCgkJfQoKCX0KCglfbGVuZEFjdGlvbiggYWN0aW9uICkgewoKCQkvLyBbIGFjdGl2ZSBhY3Rpb25zIHwgIGluYWN0aXZlIGFjdGlvbnMgIF0KCQkvLyBbICBhY3RpdmUgYWN0aW9ucyA+fCBpbmFjdGl2ZSBhY3Rpb25zIF0KCQkvLyAgICAgICAgICAgICAgICAgcyAgICAgICAgYQoJCS8vICAgICAgICAgICAgICAgICAgPC1zd2FwLT4KCQkvLyAgICAgICAgICAgICAgICAgYSAgICAgICAgcwoKCQljb25zdCBhY3Rpb25zID0gdGhpcy5fYWN0aW9ucywKCQkJcHJldkluZGV4ID0gYWN0aW9uLl9jYWNoZUluZGV4LAoKCQkJbGFzdEFjdGl2ZUluZGV4ID0gdGhpcy5fbkFjdGl2ZUFjdGlvbnMgKyssCgoJCQlmaXJzdEluYWN0aXZlQWN0aW9uID0gYWN0aW9uc1sgbGFzdEFjdGl2ZUluZGV4IF07CgoJCWFjdGlvbi5fY2FjaGVJbmRleCA9IGxhc3RBY3RpdmVJbmRleDsKCQlhY3Rpb25zWyBsYXN0QWN0aXZlSW5kZXggXSA9IGFjdGlvbjsKCgkJZmlyc3RJbmFjdGl2ZUFjdGlvbi5fY2FjaGVJbmRleCA9IHByZXZJbmRleDsKCQlhY3Rpb25zWyBwcmV2SW5kZXggXSA9IGZpcnN0SW5hY3RpdmVBY3Rpb247CgoJfQoKCV90YWtlQmFja0FjdGlvbiggYWN0aW9uICkgewoKCQkvLyBbICBhY3RpdmUgYWN0aW9ucyAgfCBpbmFjdGl2ZSBhY3Rpb25zIF0KCQkvLyBbIGFjdGl2ZSBhY3Rpb25zIHw8IGluYWN0aXZlIGFjdGlvbnMgIF0KCQkvLyAgICAgICAgYSAgICAgICAgcwoJCS8vICAgICAgICAgPC1zd2FwLT4KCQkvLyAgICAgICAgcyAgICAgICAgYQoKCQljb25zdCBhY3Rpb25zID0gdGhpcy5fYWN0aW9ucywKCQkJcHJldkluZGV4ID0gYWN0aW9uLl9jYWNoZUluZGV4LAoKCQkJZmlyc3RJbmFjdGl2ZUluZGV4ID0gLS0gdGhpcy5fbkFjdGl2ZUFjdGlvbnMsCgoJCQlsYXN0QWN0aXZlQWN0aW9uID0gYWN0aW9uc1sgZmlyc3RJbmFjdGl2ZUluZGV4IF07CgoJCWFjdGlvbi5fY2FjaGVJbmRleCA9IGZpcnN0SW5hY3RpdmVJbmRleDsKCQlhY3Rpb25zWyBmaXJzdEluYWN0aXZlSW5kZXggXSA9IGFjdGlvbjsKCgkJbGFzdEFjdGl2ZUFjdGlvbi5fY2FjaGVJbmRleCA9IHByZXZJbmRleDsKCQlhY3Rpb25zWyBwcmV2SW5kZXggXSA9IGxhc3RBY3RpdmVBY3Rpb247CgoJfQoKCS8vIE1lbW9yeSBtYW5hZ2VtZW50IGZvciBQcm9wZXJ0eU1peGVyIG9iamVjdHMKCglfYWRkSW5hY3RpdmVCaW5kaW5nKCBiaW5kaW5nLCByb290VXVpZCwgdHJhY2tOYW1lICkgewoKCQljb25zdCBiaW5kaW5nc0J5Um9vdCA9IHRoaXMuX2JpbmRpbmdzQnlSb290QW5kTmFtZSwKCQkJYmluZGluZ3MgPSB0aGlzLl9iaW5kaW5nczsKCgkJbGV0IGJpbmRpbmdCeU5hbWUgPSBiaW5kaW5nc0J5Um9vdFsgcm9vdFV1aWQgXTsKCgkJaWYgKCBiaW5kaW5nQnlOYW1lID09PSB1bmRlZmluZWQgKSB7CgoJCQliaW5kaW5nQnlOYW1lID0ge307CgkJCWJpbmRpbmdzQnlSb290WyByb290VXVpZCBdID0gYmluZGluZ0J5TmFtZTsKCgkJfQoKCQliaW5kaW5nQnlOYW1lWyB0cmFja05hbWUgXSA9IGJpbmRpbmc7CgoJCWJpbmRpbmcuX2NhY2hlSW5kZXggPSBiaW5kaW5ncy5sZW5ndGg7CgkJYmluZGluZ3MucHVzaCggYmluZGluZyApOwoKCX0KCglfcmVtb3ZlSW5hY3RpdmVCaW5kaW5nKCBiaW5kaW5nICkgewoKCQljb25zdCBiaW5kaW5ncyA9IHRoaXMuX2JpbmRpbmdzLAoJCQlwcm9wQmluZGluZyA9IGJpbmRpbmcuYmluZGluZywKCQkJcm9vdFV1aWQgPSBwcm9wQmluZGluZy5yb290Tm9kZS51dWlkLAoJCQl0cmFja05hbWUgPSBwcm9wQmluZGluZy5wYXRoLAoJCQliaW5kaW5nc0J5Um9vdCA9IHRoaXMuX2JpbmRpbmdzQnlSb290QW5kTmFtZSwKCQkJYmluZGluZ0J5TmFtZSA9IGJpbmRpbmdzQnlSb290WyByb290VXVpZCBdLAoKCQkJbGFzdEluYWN0aXZlQmluZGluZyA9IGJpbmRpbmdzWyBiaW5kaW5ncy5sZW5ndGggLSAxIF0sCgkJCWNhY2hlSW5kZXggPSBiaW5kaW5nLl9jYWNoZUluZGV4OwoKCQlsYXN0SW5hY3RpdmVCaW5kaW5nLl9jYWNoZUluZGV4ID0gY2FjaGVJbmRleDsKCQliaW5kaW5nc1sgY2FjaGVJbmRleCBdID0gbGFzdEluYWN0aXZlQmluZGluZzsKCQliaW5kaW5ncy5wb3AoKTsKCgkJZGVsZXRlIGJpbmRpbmdCeU5hbWVbIHRyYWNrTmFtZSBdOwoKCQlpZiAoIE9iamVjdC5rZXlzKCBiaW5kaW5nQnlOYW1lICkubGVuZ3RoID09PSAwICkgewoKCQkJZGVsZXRlIGJpbmRpbmdzQnlSb290WyByb290VXVpZCBdOwoKCQl9CgoJfQoKCV9sZW5kQmluZGluZyggYmluZGluZyApIHsKCgkJY29uc3QgYmluZGluZ3MgPSB0aGlzLl9iaW5kaW5ncywKCQkJcHJldkluZGV4ID0gYmluZGluZy5fY2FjaGVJbmRleCwKCgkJCWxhc3RBY3RpdmVJbmRleCA9IHRoaXMuX25BY3RpdmVCaW5kaW5ncyArKywKCgkJCWZpcnN0SW5hY3RpdmVCaW5kaW5nID0gYmluZGluZ3NbIGxhc3RBY3RpdmVJbmRleCBdOwoKCQliaW5kaW5nLl9jYWNoZUluZGV4ID0gbGFzdEFjdGl2ZUluZGV4OwoJCWJpbmRpbmdzWyBsYXN0QWN0aXZlSW5kZXggXSA9IGJpbmRpbmc7CgoJCWZpcnN0SW5hY3RpdmVCaW5kaW5nLl9jYWNoZUluZGV4ID0gcHJldkluZGV4OwoJCWJpbmRpbmdzWyBwcmV2SW5kZXggXSA9IGZpcnN0SW5hY3RpdmVCaW5kaW5nOwoKCX0KCglfdGFrZUJhY2tCaW5kaW5nKCBiaW5kaW5nICkgewoKCQljb25zdCBiaW5kaW5ncyA9IHRoaXMuX2JpbmRpbmdzLAoJCQlwcmV2SW5kZXggPSBiaW5kaW5nLl9jYWNoZUluZGV4LAoKCQkJZmlyc3RJbmFjdGl2ZUluZGV4ID0gLS0gdGhpcy5fbkFjdGl2ZUJpbmRpbmdzLAoKCQkJbGFzdEFjdGl2ZUJpbmRpbmcgPSBiaW5kaW5nc1sgZmlyc3RJbmFjdGl2ZUluZGV4IF07CgoJCWJpbmRpbmcuX2NhY2hlSW5kZXggPSBmaXJzdEluYWN0aXZlSW5kZXg7CgkJYmluZGluZ3NbIGZpcnN0SW5hY3RpdmVJbmRleCBdID0gYmluZGluZzsKCgkJbGFzdEFjdGl2ZUJpbmRpbmcuX2NhY2hlSW5kZXggPSBwcmV2SW5kZXg7CgkJYmluZGluZ3NbIHByZXZJbmRleCBdID0gbGFzdEFjdGl2ZUJpbmRpbmc7CgoJfQoKCgkvLyBNZW1vcnkgbWFuYWdlbWVudCBvZiBJbnRlcnBvbGFudHMgZm9yIHdlaWdodCBhbmQgdGltZSBzY2FsZQoKCV9sZW5kQ29udHJvbEludGVycG9sYW50KCkgewoKCQljb25zdCBpbnRlcnBvbGFudHMgPSB0aGlzLl9jb250cm9sSW50ZXJwb2xhbnRzLAoJCQlsYXN0QWN0aXZlSW5kZXggPSB0aGlzLl9uQWN0aXZlQ29udHJvbEludGVycG9sYW50cyArKzsKCgkJbGV0IGludGVycG9sYW50ID0gaW50ZXJwb2xhbnRzWyBsYXN0QWN0aXZlSW5kZXggXTsKCgkJaWYgKCBpbnRlcnBvbGFudCA9PT0gdW5kZWZpbmVkICkgewoKCQkJaW50ZXJwb2xhbnQgPSBuZXcgTGluZWFySW50ZXJwb2xhbnQoCgkJCQluZXcgRmxvYXQzMkFycmF5KCAyICksIG5ldyBGbG9hdDMyQXJyYXkoIDIgKSwKCQkJCTEsIF9jb250cm9sSW50ZXJwb2xhbnRzUmVzdWx0QnVmZmVyICk7CgoJCQlpbnRlcnBvbGFudC5fX2NhY2hlSW5kZXggPSBsYXN0QWN0aXZlSW5kZXg7CgkJCWludGVycG9sYW50c1sgbGFzdEFjdGl2ZUluZGV4IF0gPSBpbnRlcnBvbGFudDsKCgkJfQoKCQlyZXR1cm4gaW50ZXJwb2xhbnQ7CgoJfQoKCV90YWtlQmFja0NvbnRyb2xJbnRlcnBvbGFudCggaW50ZXJwb2xhbnQgKSB7CgoJCWNvbnN0IGludGVycG9sYW50cyA9IHRoaXMuX2NvbnRyb2xJbnRlcnBvbGFudHMsCgkJCXByZXZJbmRleCA9IGludGVycG9sYW50Ll9fY2FjaGVJbmRleCwKCgkJCWZpcnN0SW5hY3RpdmVJbmRleCA9IC0tIHRoaXMuX25BY3RpdmVDb250cm9sSW50ZXJwb2xhbnRzLAoKCQkJbGFzdEFjdGl2ZUludGVycG9sYW50ID0gaW50ZXJwb2xhbnRzWyBmaXJzdEluYWN0aXZlSW5kZXggXTsKCgkJaW50ZXJwb2xhbnQuX19jYWNoZUluZGV4ID0gZmlyc3RJbmFjdGl2ZUluZGV4OwoJCWludGVycG9sYW50c1sgZmlyc3RJbmFjdGl2ZUluZGV4IF0gPSBpbnRlcnBvbGFudDsKCgkJbGFzdEFjdGl2ZUludGVycG9sYW50Ll9fY2FjaGVJbmRleCA9IHByZXZJbmRleDsKCQlpbnRlcnBvbGFudHNbIHByZXZJbmRleCBdID0gbGFzdEFjdGl2ZUludGVycG9sYW50OwoKCX0KCgkvLyByZXR1cm4gYW4gYWN0aW9uIGZvciBhIGNsaXAgb3B0aW9uYWxseSB1c2luZyBhIGN1c3RvbSByb290IHRhcmdldAoJLy8gb2JqZWN0ICh0aGlzIG1ldGhvZCBhbGxvY2F0ZXMgYSBsb3Qgb2YgZHluYW1pYyBtZW1vcnkgaW4gY2FzZSBhCgkvLyBwcmV2aW91c2x5IHVua25vd24gY2xpcC9yb290IGNvbWJpbmF0aW9uIGlzIHNwZWNpZmllZCkKCWNsaXBBY3Rpb24oIGNsaXAsIG9wdGlvbmFsUm9vdCwgYmxlbmRNb2RlICkgewoKCQljb25zdCByb290ID0gb3B0aW9uYWxSb290IHx8IHRoaXMuX3Jvb3QsCgkJCXJvb3RVdWlkID0gcm9vdC51dWlkOwoKCQlsZXQgY2xpcE9iamVjdCA9IHR5cGVvZiBjbGlwID09PSAnc3RyaW5nJyA/IEFuaW1hdGlvbkNsaXAuZmluZEJ5TmFtZSggcm9vdCwgY2xpcCApIDogY2xpcDsKCgkJY29uc3QgY2xpcFV1aWQgPSBjbGlwT2JqZWN0ICE9PSBudWxsID8gY2xpcE9iamVjdC51dWlkIDogY2xpcDsKCgkJY29uc3QgYWN0aW9uc0ZvckNsaXAgPSB0aGlzLl9hY3Rpb25zQnlDbGlwWyBjbGlwVXVpZCBdOwoJCWxldCBwcm90b3R5cGVBY3Rpb24gPSBudWxsOwoKCQlpZiAoIGJsZW5kTW9kZSA9PT0gdW5kZWZpbmVkICkgewoKCQkJaWYgKCBjbGlwT2JqZWN0ICE9PSBudWxsICkgewoKCQkJCWJsZW5kTW9kZSA9IGNsaXBPYmplY3QuYmxlbmRNb2RlOwoKCQkJfSBlbHNlIHsKCgkJCQlibGVuZE1vZGUgPSBOb3JtYWxBbmltYXRpb25CbGVuZE1vZGU7CgoJCQl9CgoJCX0KCgkJaWYgKCBhY3Rpb25zRm9yQ2xpcCAhPT0gdW5kZWZpbmVkICkgewoKCQkJY29uc3QgZXhpc3RpbmdBY3Rpb24gPSBhY3Rpb25zRm9yQ2xpcC5hY3Rpb25CeVJvb3RbIHJvb3RVdWlkIF07CgoJCQlpZiAoIGV4aXN0aW5nQWN0aW9uICE9PSB1bmRlZmluZWQgJiYgZXhpc3RpbmdBY3Rpb24uYmxlbmRNb2RlID09PSBibGVuZE1vZGUgKSB7CgoJCQkJcmV0dXJuIGV4aXN0aW5nQWN0aW9uOwoKCQkJfQoKCQkJLy8gd2Uga25vdyB0aGUgY2xpcCwgc28gd2UgZG9uJ3QgaGF2ZSB0byBwYXJzZSBhbGwKCQkJLy8gdGhlIGJpbmRpbmdzIGFnYWluIGJ1dCBjYW4ganVzdCBjb3B5CgkJCXByb3RvdHlwZUFjdGlvbiA9IGFjdGlvbnNGb3JDbGlwLmtub3duQWN0aW9uc1sgMCBdOwoKCQkJLy8gYWxzbywgdGFrZSB0aGUgY2xpcCBmcm9tIHRoZSBwcm90b3R5cGUgYWN0aW9uCgkJCWlmICggY2xpcE9iamVjdCA9PT0gbnVsbCApCgkJCQljbGlwT2JqZWN0ID0gcHJvdG90eXBlQWN0aW9uLl9jbGlwOwoKCQl9CgoJCS8vIGNsaXAgbXVzdCBiZSBrbm93biB3aGVuIHNwZWNpZmllZCB2aWEgc3RyaW5nCgkJaWYgKCBjbGlwT2JqZWN0ID09PSBudWxsICkgcmV0dXJuIG51bGw7CgoJCS8vIGFsbG9jYXRlIGFsbCByZXNvdXJjZXMgcmVxdWlyZWQgdG8gcnVuIGl0CgkJY29uc3QgbmV3QWN0aW9uID0gbmV3IEFuaW1hdGlvbkFjdGlvbiggdGhpcywgY2xpcE9iamVjdCwgb3B0aW9uYWxSb290LCBibGVuZE1vZGUgKTsKCgkJdGhpcy5fYmluZEFjdGlvbiggbmV3QWN0aW9uLCBwcm90b3R5cGVBY3Rpb24gKTsKCgkJLy8gYW5kIG1ha2UgdGhlIGFjdGlvbiBrbm93biB0byB0aGUgbWVtb3J5IG1hbmFnZXIKCQl0aGlzLl9hZGRJbmFjdGl2ZUFjdGlvbiggbmV3QWN0aW9uLCBjbGlwVXVpZCwgcm9vdFV1aWQgKTsKCgkJcmV0dXJuIG5ld0FjdGlvbjsKCgl9CgoJLy8gZ2V0IGFuIGV4aXN0aW5nIGFjdGlvbgoJZXhpc3RpbmdBY3Rpb24oIGNsaXAsIG9wdGlvbmFsUm9vdCApIHsKCgkJY29uc3Qgcm9vdCA9IG9wdGlvbmFsUm9vdCB8fCB0aGlzLl9yb290LAoJCQlyb290VXVpZCA9IHJvb3QudXVpZCwKCgkJCWNsaXBPYmplY3QgPSB0eXBlb2YgY2xpcCA9PT0gJ3N0cmluZycgPwoJCQkJQW5pbWF0aW9uQ2xpcC5maW5kQnlOYW1lKCByb290LCBjbGlwICkgOiBjbGlwLAoKCQkJY2xpcFV1aWQgPSBjbGlwT2JqZWN0ID8gY2xpcE9iamVjdC51dWlkIDogY2xpcCwKCgkJCWFjdGlvbnNGb3JDbGlwID0gdGhpcy5fYWN0aW9uc0J5Q2xpcFsgY2xpcFV1aWQgXTsKCgkJaWYgKCBhY3Rpb25zRm9yQ2xpcCAhPT0gdW5kZWZpbmVkICkgewoKCQkJcmV0dXJuIGFjdGlvbnNGb3JDbGlwLmFjdGlvbkJ5Um9vdFsgcm9vdFV1aWQgXSB8fCBudWxsOwoKCQl9CgoJCXJldHVybiBudWxsOwoKCX0KCgkvLyBkZWFjdGl2YXRlcyBhbGwgcHJldmlvdXNseSBzY2hlZHVsZWQgYWN0aW9ucwoJc3RvcEFsbEFjdGlvbigpIHsKCgkJY29uc3QgYWN0aW9ucyA9IHRoaXMuX2FjdGlvbnMsCgkJCW5BY3Rpb25zID0gdGhpcy5fbkFjdGl2ZUFjdGlvbnM7CgoJCWZvciAoIGxldCBpID0gbkFjdGlvbnMgLSAxOyBpID49IDA7IC0tIGkgKSB7CgoJCQlhY3Rpb25zWyBpIF0uc3RvcCgpOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgkvLyBhZHZhbmNlIHRoZSB0aW1lIGFuZCB1cGRhdGUgYXBwbHkgdGhlIGFuaW1hdGlvbgoJdXBkYXRlKCBkZWx0YVRpbWUgKSB7CgoJCWRlbHRhVGltZSAqPSB0aGlzLnRpbWVTY2FsZTsKCgkJY29uc3QgYWN0aW9ucyA9IHRoaXMuX2FjdGlvbnMsCgkJCW5BY3Rpb25zID0gdGhpcy5fbkFjdGl2ZUFjdGlvbnMsCgoJCQl0aW1lID0gdGhpcy50aW1lICs9IGRlbHRhVGltZSwKCQkJdGltZURpcmVjdGlvbiA9IE1hdGguc2lnbiggZGVsdGFUaW1lICksCgoJCQlhY2N1SW5kZXggPSB0aGlzLl9hY2N1SW5kZXggXj0gMTsKCgkJLy8gcnVuIGFjdGl2ZSBhY3Rpb25zCgoJCWZvciAoIGxldCBpID0gMDsgaSAhPT0gbkFjdGlvbnM7ICsrIGkgKSB7CgoJCQljb25zdCBhY3Rpb24gPSBhY3Rpb25zWyBpIF07CgoJCQlhY3Rpb24uX3VwZGF0ZSggdGltZSwgZGVsdGFUaW1lLCB0aW1lRGlyZWN0aW9uLCBhY2N1SW5kZXggKTsKCgkJfQoKCQkvLyB1cGRhdGUgc2NlbmUgZ3JhcGgKCgkJY29uc3QgYmluZGluZ3MgPSB0aGlzLl9iaW5kaW5ncywKCQkJbkJpbmRpbmdzID0gdGhpcy5fbkFjdGl2ZUJpbmRpbmdzOwoKCQlmb3IgKCBsZXQgaSA9IDA7IGkgIT09IG5CaW5kaW5nczsgKysgaSApIHsKCgkJCWJpbmRpbmdzWyBpIF0uYXBwbHkoIGFjY3VJbmRleCApOwoKCQl9CgoJCXJldHVybiB0aGlzOwoKCX0KCgkvLyBBbGxvd3MgeW91IHRvIHNlZWsgdG8gYSBzcGVjaWZpYyB0aW1lIGluIGFuIGFuaW1hdGlvbi4KCXNldFRpbWUoIHRpbWVJblNlY29uZHMgKSB7CgoJCXRoaXMudGltZSA9IDA7IC8vIFplcm8gb3V0IHRpbWUgYXR0cmlidXRlIGZvciBBbmltYXRpb25NaXhlciBvYmplY3Q7CgkJZm9yICggbGV0IGkgPSAwOyBpIDwgdGhpcy5fYWN0aW9ucy5sZW5ndGg7IGkgKysgKSB7CgoJCQl0aGlzLl9hY3Rpb25zWyBpIF0udGltZSA9IDA7IC8vIFplcm8gb3V0IHRpbWUgYXR0cmlidXRlIGZvciBhbGwgYXNzb2NpYXRlZCBBbmltYXRpb25BY3Rpb24gb2JqZWN0cy4KCgkJfQoKCQlyZXR1cm4gdGhpcy51cGRhdGUoIHRpbWVJblNlY29uZHMgKTsgLy8gVXBkYXRlIHVzZWQgdG8gc2V0IGV4YWN0IHRpbWUuIFJldHVybnMgInRoaXMiIEFuaW1hdGlvbk1peGVyIG9iamVjdC4KCgl9CgoJLy8gcmV0dXJuIHRoaXMgbWl4ZXIncyByb290IHRhcmdldCBvYmplY3QKCWdldFJvb3QoKSB7CgoJCXJldHVybiB0aGlzLl9yb290OwoKCX0KCgkvLyBmcmVlIGFsbCByZXNvdXJjZXMgc3BlY2lmaWMgdG8gYSBwYXJ0aWN1bGFyIGNsaXAKCXVuY2FjaGVDbGlwKCBjbGlwICkgewoKCQljb25zdCBhY3Rpb25zID0gdGhpcy5fYWN0aW9ucywKCQkJY2xpcFV1aWQgPSBjbGlwLnV1aWQsCgkJCWFjdGlvbnNCeUNsaXAgPSB0aGlzLl9hY3Rpb25zQnlDbGlwLAoJCQlhY3Rpb25zRm9yQ2xpcCA9IGFjdGlvbnNCeUNsaXBbIGNsaXBVdWlkIF07CgoJCWlmICggYWN0aW9uc0ZvckNsaXAgIT09IHVuZGVmaW5lZCApIHsKCgkJCS8vIG5vdGU6IGp1c3QgY2FsbGluZyBfcmVtb3ZlSW5hY3RpdmVBY3Rpb24gd291bGQgbWVzcyB1cCB0aGUKCQkJLy8gaXRlcmF0aW9uIHN0YXRlIGFuZCBhbHNvIHJlcXVpcmUgdXBkYXRpbmcgdGhlIHN0YXRlIHdlIGNhbgoJCQkvLyBqdXN0IHRocm93IGF3YXkKCgkJCWNvbnN0IGFjdGlvbnNUb1JlbW92ZSA9IGFjdGlvbnNGb3JDbGlwLmtub3duQWN0aW9uczsKCgkJCWZvciAoIGxldCBpID0gMCwgbiA9IGFjdGlvbnNUb1JlbW92ZS5sZW5ndGg7IGkgIT09IG47ICsrIGkgKSB7CgoJCQkJY29uc3QgYWN0aW9uID0gYWN0aW9uc1RvUmVtb3ZlWyBpIF07CgoJCQkJdGhpcy5fZGVhY3RpdmF0ZUFjdGlvbiggYWN0aW9uICk7CgoJCQkJY29uc3QgY2FjaGVJbmRleCA9IGFjdGlvbi5fY2FjaGVJbmRleCwKCQkJCQlsYXN0SW5hY3RpdmVBY3Rpb24gPSBhY3Rpb25zWyBhY3Rpb25zLmxlbmd0aCAtIDEgXTsKCgkJCQlhY3Rpb24uX2NhY2hlSW5kZXggPSBudWxsOwoJCQkJYWN0aW9uLl9ieUNsaXBDYWNoZUluZGV4ID0gbnVsbDsKCgkJCQlsYXN0SW5hY3RpdmVBY3Rpb24uX2NhY2hlSW5kZXggPSBjYWNoZUluZGV4OwoJCQkJYWN0aW9uc1sgY2FjaGVJbmRleCBdID0gbGFzdEluYWN0aXZlQWN0aW9uOwoJCQkJYWN0aW9ucy5wb3AoKTsKCgkJCQl0aGlzLl9yZW1vdmVJbmFjdGl2ZUJpbmRpbmdzRm9yQWN0aW9uKCBhY3Rpb24gKTsKCgkJCX0KCgkJCWRlbGV0ZSBhY3Rpb25zQnlDbGlwWyBjbGlwVXVpZCBdOwoKCQl9CgoJfQoKCS8vIGZyZWUgYWxsIHJlc291cmNlcyBzcGVjaWZpYyB0byBhIHBhcnRpY3VsYXIgcm9vdCB0YXJnZXQgb2JqZWN0Cgl1bmNhY2hlUm9vdCggcm9vdCApIHsKCgkJY29uc3Qgcm9vdFV1aWQgPSByb290LnV1aWQsCgkJCWFjdGlvbnNCeUNsaXAgPSB0aGlzLl9hY3Rpb25zQnlDbGlwOwoKCQlmb3IgKCBjb25zdCBjbGlwVXVpZCBpbiBhY3Rpb25zQnlDbGlwICkgewoKCQkJY29uc3QgYWN0aW9uQnlSb290ID0gYWN0aW9uc0J5Q2xpcFsgY2xpcFV1aWQgXS5hY3Rpb25CeVJvb3QsCgkJCQlhY3Rpb24gPSBhY3Rpb25CeVJvb3RbIHJvb3RVdWlkIF07CgoJCQlpZiAoIGFjdGlvbiAhPT0gdW5kZWZpbmVkICkgewoKCQkJCXRoaXMuX2RlYWN0aXZhdGVBY3Rpb24oIGFjdGlvbiApOwoJCQkJdGhpcy5fcmVtb3ZlSW5hY3RpdmVBY3Rpb24oIGFjdGlvbiApOwoKCQkJfQoKCQl9CgoJCWNvbnN0IGJpbmRpbmdzQnlSb290ID0gdGhpcy5fYmluZGluZ3NCeVJvb3RBbmROYW1lLAoJCQliaW5kaW5nQnlOYW1lID0gYmluZGluZ3NCeVJvb3RbIHJvb3RVdWlkIF07CgoJCWlmICggYmluZGluZ0J5TmFtZSAhPT0gdW5kZWZpbmVkICkgewoKCQkJZm9yICggY29uc3QgdHJhY2tOYW1lIGluIGJpbmRpbmdCeU5hbWUgKSB7CgoJCQkJY29uc3QgYmluZGluZyA9IGJpbmRpbmdCeU5hbWVbIHRyYWNrTmFtZSBdOwoJCQkJYmluZGluZy5yZXN0b3JlT3JpZ2luYWxTdGF0ZSgpOwoJCQkJdGhpcy5fcmVtb3ZlSW5hY3RpdmVCaW5kaW5nKCBiaW5kaW5nICk7CgoJCQl9CgoJCX0KCgl9CgoJLy8gcmVtb3ZlIGEgdGFyZ2V0ZWQgY2xpcCBmcm9tIHRoZSBjYWNoZQoJdW5jYWNoZUFjdGlvbiggY2xpcCwgb3B0aW9uYWxSb290ICkgewoKCQljb25zdCBhY3Rpb24gPSB0aGlzLmV4aXN0aW5nQWN0aW9uKCBjbGlwLCBvcHRpb25hbFJvb3QgKTsKCgkJaWYgKCBhY3Rpb24gIT09IG51bGwgKSB7CgoJCQl0aGlzLl9kZWFjdGl2YXRlQWN0aW9uKCBhY3Rpb24gKTsKCQkJdGhpcy5fcmVtb3ZlSW5hY3RpdmVBY3Rpb24oIGFjdGlvbiApOwoKCQl9CgoJfQoKfQoKY2xhc3MgVW5pZm9ybSB7CgoJY29uc3RydWN0b3IoIHZhbHVlICkgewoKCQl0aGlzLnZhbHVlID0gdmFsdWU7CgoJfQoKCWNsb25lKCkgewoKCQlyZXR1cm4gbmV3IFVuaWZvcm0oIHRoaXMudmFsdWUuY2xvbmUgPT09IHVuZGVmaW5lZCA/IHRoaXMudmFsdWUgOiB0aGlzLnZhbHVlLmNsb25lKCkgKTsKCgl9Cgp9CgpsZXQgX2lkID0gMDsKCmNsYXNzIFVuaWZvcm1zR3JvdXAgZXh0ZW5kcyBFdmVudERpc3BhdGNoZXIgewoKCWNvbnN0cnVjdG9yKCkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmlzVW5pZm9ybXNHcm91cCA9IHRydWU7CgoJCU9iamVjdC5kZWZpbmVQcm9wZXJ0eSggdGhpcywgJ2lkJywgeyB2YWx1ZTogX2lkICsrIH0gKTsKCgkJdGhpcy5uYW1lID0gJyc7CgoJCXRoaXMudXNhZ2UgPSBTdGF0aWNEcmF3VXNhZ2U7CgkJdGhpcy51bmlmb3JtcyA9IFtdOwoKCX0KCglhZGQoIHVuaWZvcm0gKSB7CgoJCXRoaXMudW5pZm9ybXMucHVzaCggdW5pZm9ybSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJcmVtb3ZlKCB1bmlmb3JtICkgewoKCQljb25zdCBpbmRleCA9IHRoaXMudW5pZm9ybXMuaW5kZXhPZiggdW5pZm9ybSApOwoKCQlpZiAoIGluZGV4ICE9PSAtIDEgKSB0aGlzLnVuaWZvcm1zLnNwbGljZSggaW5kZXgsIDEgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldE5hbWUoIG5hbWUgKSB7CgoJCXRoaXMubmFtZSA9IG5hbWU7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRVc2FnZSggdmFsdWUgKSB7CgoJCXRoaXMudXNhZ2UgPSB2YWx1ZTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWRpc3Bvc2UoKSB7CgoJCXRoaXMuZGlzcGF0Y2hFdmVudCggeyB0eXBlOiAnZGlzcG9zZScgfSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY29weSggc291cmNlICkgewoKCQl0aGlzLm5hbWUgPSBzb3VyY2UubmFtZTsKCQl0aGlzLnVzYWdlID0gc291cmNlLnVzYWdlOwoKCQljb25zdCB1bmlmb3Jtc1NvdXJjZSA9IHNvdXJjZS51bmlmb3JtczsKCgkJdGhpcy51bmlmb3Jtcy5sZW5ndGggPSAwOwoKCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSB1bmlmb3Jtc1NvdXJjZS5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJdGhpcy51bmlmb3Jtcy5wdXNoKCB1bmlmb3Jtc1NvdXJjZVsgaSBdLmNsb25lKCkgKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY2xvbmUoKSB7CgoJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCgl9Cgp9CgpjbGFzcyBJbnN0YW5jZWRJbnRlcmxlYXZlZEJ1ZmZlciBleHRlbmRzIEludGVybGVhdmVkQnVmZmVyIHsKCgljb25zdHJ1Y3RvciggYXJyYXksIHN0cmlkZSwgbWVzaFBlckF0dHJpYnV0ZSA9IDEgKSB7CgoJCXN1cGVyKCBhcnJheSwgc3RyaWRlICk7CgoJCXRoaXMuaXNJbnN0YW5jZWRJbnRlcmxlYXZlZEJ1ZmZlciA9IHRydWU7CgoJCXRoaXMubWVzaFBlckF0dHJpYnV0ZSA9IG1lc2hQZXJBdHRyaWJ1dGU7CgoJfQoKCWNvcHkoIHNvdXJjZSApIHsKCgkJc3VwZXIuY29weSggc291cmNlICk7CgoJCXRoaXMubWVzaFBlckF0dHJpYnV0ZSA9IHNvdXJjZS5tZXNoUGVyQXR0cmlidXRlOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY2xvbmUoIGRhdGEgKSB7CgoJCWNvbnN0IGliID0gc3VwZXIuY2xvbmUoIGRhdGEgKTsKCgkJaWIubWVzaFBlckF0dHJpYnV0ZSA9IHRoaXMubWVzaFBlckF0dHJpYnV0ZTsKCgkJcmV0dXJuIGliOwoKCX0KCgl0b0pTT04oIGRhdGEgKSB7CgoJCWNvbnN0IGpzb24gPSBzdXBlci50b0pTT04oIGRhdGEgKTsKCgkJanNvbi5pc0luc3RhbmNlZEludGVybGVhdmVkQnVmZmVyID0gdHJ1ZTsKCQlqc29uLm1lc2hQZXJBdHRyaWJ1dGUgPSB0aGlzLm1lc2hQZXJBdHRyaWJ1dGU7CgoJCXJldHVybiBqc29uOwoKCX0KCn0KCmNsYXNzIEdMQnVmZmVyQXR0cmlidXRlIHsKCgljb25zdHJ1Y3RvciggYnVmZmVyLCB0eXBlLCBpdGVtU2l6ZSwgZWxlbWVudFNpemUsIGNvdW50ICkgewoKCQl0aGlzLmlzR0xCdWZmZXJBdHRyaWJ1dGUgPSB0cnVlOwoKCQl0aGlzLm5hbWUgPSAnJzsKCgkJdGhpcy5idWZmZXIgPSBidWZmZXI7CgkJdGhpcy50eXBlID0gdHlwZTsKCQl0aGlzLml0ZW1TaXplID0gaXRlbVNpemU7CgkJdGhpcy5lbGVtZW50U2l6ZSA9IGVsZW1lbnRTaXplOwoJCXRoaXMuY291bnQgPSBjb3VudDsKCgkJdGhpcy52ZXJzaW9uID0gMDsKCgl9CgoJc2V0IG5lZWRzVXBkYXRlKCB2YWx1ZSApIHsKCgkJaWYgKCB2YWx1ZSA9PT0gdHJ1ZSApIHRoaXMudmVyc2lvbiArKzsKCgl9CgoJc2V0QnVmZmVyKCBidWZmZXIgKSB7CgoJCXRoaXMuYnVmZmVyID0gYnVmZmVyOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0VHlwZSggdHlwZSwgZWxlbWVudFNpemUgKSB7CgoJCXRoaXMudHlwZSA9IHR5cGU7CgkJdGhpcy5lbGVtZW50U2l6ZSA9IGVsZW1lbnRTaXplOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0SXRlbVNpemUoIGl0ZW1TaXplICkgewoKCQl0aGlzLml0ZW1TaXplID0gaXRlbVNpemU7CgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXRDb3VudCggY291bnQgKSB7CgoJCXRoaXMuY291bnQgPSBjb3VudDsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKfQoKY2xhc3MgUmF5Y2FzdGVyIHsKCgljb25zdHJ1Y3Rvciggb3JpZ2luLCBkaXJlY3Rpb24sIG5lYXIgPSAwLCBmYXIgPSBJbmZpbml0eSApIHsKCgkJdGhpcy5yYXkgPSBuZXcgUmF5KCBvcmlnaW4sIGRpcmVjdGlvbiApOwoJCS8vIGRpcmVjdGlvbiBpcyBhc3N1bWVkIHRvIGJlIG5vcm1hbGl6ZWQgKGZvciBhY2N1cmF0ZSBkaXN0YW5jZSBjYWxjdWxhdGlvbnMpCgoJCXRoaXMubmVhciA9IG5lYXI7CgkJdGhpcy5mYXIgPSBmYXI7CgkJdGhpcy5jYW1lcmEgPSBudWxsOwoJCXRoaXMubGF5ZXJzID0gbmV3IExheWVycygpOwoKCQl0aGlzLnBhcmFtcyA9IHsKCQkJTWVzaDoge30sCgkJCUxpbmU6IHsgdGhyZXNob2xkOiAxIH0sCgkJCUxPRDoge30sCgkJCVBvaW50czogeyB0aHJlc2hvbGQ6IDEgfSwKCQkJU3ByaXRlOiB7fQoJCX07CgoJfQoKCXNldCggb3JpZ2luLCBkaXJlY3Rpb24gKSB7CgoJCS8vIGRpcmVjdGlvbiBpcyBhc3N1bWVkIHRvIGJlIG5vcm1hbGl6ZWQgKGZvciBhY2N1cmF0ZSBkaXN0YW5jZSBjYWxjdWxhdGlvbnMpCgoJCXRoaXMucmF5LnNldCggb3JpZ2luLCBkaXJlY3Rpb24gKTsKCgl9CgoJc2V0RnJvbUNhbWVyYSggY29vcmRzLCBjYW1lcmEgKSB7CgoJCWlmICggY2FtZXJhLmlzUGVyc3BlY3RpdmVDYW1lcmEgKSB7CgoJCQl0aGlzLnJheS5vcmlnaW4uc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCBjYW1lcmEubWF0cml4V29ybGQgKTsKCQkJdGhpcy5yYXkuZGlyZWN0aW9uLnNldCggY29vcmRzLngsIGNvb3Jkcy55LCAwLjUgKS51bnByb2plY3QoIGNhbWVyYSApLnN1YiggdGhpcy5yYXkub3JpZ2luICkubm9ybWFsaXplKCk7CgkJCXRoaXMuY2FtZXJhID0gY2FtZXJhOwoKCQl9IGVsc2UgaWYgKCBjYW1lcmEuaXNPcnRob2dyYXBoaWNDYW1lcmEgKSB7CgoJCQl0aGlzLnJheS5vcmlnaW4uc2V0KCBjb29yZHMueCwgY29vcmRzLnksICggY2FtZXJhLm5lYXIgKyBjYW1lcmEuZmFyICkgLyAoIGNhbWVyYS5uZWFyIC0gY2FtZXJhLmZhciApICkudW5wcm9qZWN0KCBjYW1lcmEgKTsgLy8gc2V0IG9yaWdpbiBpbiBwbGFuZSBvZiBjYW1lcmEKCQkJdGhpcy5yYXkuZGlyZWN0aW9uLnNldCggMCwgMCwgLSAxICkudHJhbnNmb3JtRGlyZWN0aW9uKCBjYW1lcmEubWF0cml4V29ybGQgKTsKCQkJdGhpcy5jYW1lcmEgPSBjYW1lcmE7CgoJCX0gZWxzZSB7CgoJCQljb25zb2xlLmVycm9yKCAnVEhSRUUuUmF5Y2FzdGVyOiBVbnN1cHBvcnRlZCBjYW1lcmEgdHlwZTogJyArIGNhbWVyYS50eXBlICk7CgoJCX0KCgl9CgoJaW50ZXJzZWN0T2JqZWN0KCBvYmplY3QsIHJlY3Vyc2l2ZSA9IHRydWUsIGludGVyc2VjdHMgPSBbXSApIHsKCgkJaW50ZXJzZWN0T2JqZWN0KCBvYmplY3QsIHRoaXMsIGludGVyc2VjdHMsIHJlY3Vyc2l2ZSApOwoKCQlpbnRlcnNlY3RzLnNvcnQoIGFzY1NvcnQgKTsKCgkJcmV0dXJuIGludGVyc2VjdHM7CgoJfQoKCWludGVyc2VjdE9iamVjdHMoIG9iamVjdHMsIHJlY3Vyc2l2ZSA9IHRydWUsIGludGVyc2VjdHMgPSBbXSApIHsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gb2JqZWN0cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJaW50ZXJzZWN0T2JqZWN0KCBvYmplY3RzWyBpIF0sIHRoaXMsIGludGVyc2VjdHMsIHJlY3Vyc2l2ZSApOwoKCQl9CgoJCWludGVyc2VjdHMuc29ydCggYXNjU29ydCApOwoKCQlyZXR1cm4gaW50ZXJzZWN0czsKCgl9Cgp9CgpmdW5jdGlvbiBhc2NTb3J0KCBhLCBiICkgewoKCXJldHVybiBhLmRpc3RhbmNlIC0gYi5kaXN0YW5jZTsKCn0KCmZ1bmN0aW9uIGludGVyc2VjdE9iamVjdCggb2JqZWN0LCByYXljYXN0ZXIsIGludGVyc2VjdHMsIHJlY3Vyc2l2ZSApIHsKCglpZiAoIG9iamVjdC5sYXllcnMudGVzdCggcmF5Y2FzdGVyLmxheWVycyApICkgewoKCQlvYmplY3QucmF5Y2FzdCggcmF5Y2FzdGVyLCBpbnRlcnNlY3RzICk7CgoJfQoKCWlmICggcmVjdXJzaXZlID09PSB0cnVlICkgewoKCQljb25zdCBjaGlsZHJlbiA9IG9iamVjdC5jaGlsZHJlbjsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gY2hpbGRyZW4ubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCWludGVyc2VjdE9iamVjdCggY2hpbGRyZW5bIGkgXSwgcmF5Y2FzdGVyLCBpbnRlcnNlY3RzLCB0cnVlICk7CgoJCX0KCgl9Cgp9CgovKioKICogUmVmOiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9TcGhlcmljYWxfY29vcmRpbmF0ZV9zeXN0ZW0KICoKICogVGhlIHBvbGFyIGFuZ2xlIChwaGkpIGlzIG1lYXN1cmVkIGZyb20gdGhlIHBvc2l0aXZlIHktYXhpcy4gVGhlIHBvc2l0aXZlIHktYXhpcyBpcyB1cC4KICogVGhlIGF6aW11dGhhbCBhbmdsZSAodGhldGEpIGlzIG1lYXN1cmVkIGZyb20gdGhlIHBvc2l0aXZlIHotYXhpcy4KICovCgoKY2xhc3MgU3BoZXJpY2FsIHsKCgljb25zdHJ1Y3RvciggcmFkaXVzID0gMSwgcGhpID0gMCwgdGhldGEgPSAwICkgewoKCQl0aGlzLnJhZGl1cyA9IHJhZGl1czsKCQl0aGlzLnBoaSA9IHBoaTsgLy8gcG9sYXIgYW5nbGUKCQl0aGlzLnRoZXRhID0gdGhldGE7IC8vIGF6aW11dGhhbCBhbmdsZQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0KCByYWRpdXMsIHBoaSwgdGhldGEgKSB7CgoJCXRoaXMucmFkaXVzID0gcmFkaXVzOwoJCXRoaXMucGhpID0gcGhpOwoJCXRoaXMudGhldGEgPSB0aGV0YTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvcHkoIG90aGVyICkgewoKCQl0aGlzLnJhZGl1cyA9IG90aGVyLnJhZGl1czsKCQl0aGlzLnBoaSA9IG90aGVyLnBoaTsKCQl0aGlzLnRoZXRhID0gb3RoZXIudGhldGE7CgoJCXJldHVybiB0aGlzOwoKCX0KCgkvLyByZXN0cmljdCBwaGkgdG8gYmUgYmV0d2VlbiBFUFMgYW5kIFBJLUVQUwoJbWFrZVNhZmUoKSB7CgoJCWNvbnN0IEVQUyA9IDAuMDAwMDAxOwoJCXRoaXMucGhpID0gTWF0aC5tYXgoIEVQUywgTWF0aC5taW4oIE1hdGguUEkgLSBFUFMsIHRoaXMucGhpICkgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldEZyb21WZWN0b3IzKCB2ICkgewoKCQlyZXR1cm4gdGhpcy5zZXRGcm9tQ2FydGVzaWFuQ29vcmRzKCB2LngsIHYueSwgdi56ICk7CgoJfQoKCXNldEZyb21DYXJ0ZXNpYW5Db29yZHMoIHgsIHksIHogKSB7CgoJCXRoaXMucmFkaXVzID0gTWF0aC5zcXJ0KCB4ICogeCArIHkgKiB5ICsgeiAqIHogKTsKCgkJaWYgKCB0aGlzLnJhZGl1cyA9PT0gMCApIHsKCgkJCXRoaXMudGhldGEgPSAwOwoJCQl0aGlzLnBoaSA9IDA7CgoJCX0gZWxzZSB7CgoJCQl0aGlzLnRoZXRhID0gTWF0aC5hdGFuMiggeCwgeiApOwoJCQl0aGlzLnBoaSA9IE1hdGguYWNvcyggY2xhbXAoIHkgLyB0aGlzLnJhZGl1cywgLSAxLCAxICkgKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY2xvbmUoKSB7CgoJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCgl9Cgp9CgovKioKICogUmVmOiBodHRwczovL2VuLndpa2lwZWRpYS5vcmcvd2lraS9DeWxpbmRyaWNhbF9jb29yZGluYXRlX3N5c3RlbQogKi8KCmNsYXNzIEN5bGluZHJpY2FsIHsKCgljb25zdHJ1Y3RvciggcmFkaXVzID0gMSwgdGhldGEgPSAwLCB5ID0gMCApIHsKCgkJdGhpcy5yYWRpdXMgPSByYWRpdXM7IC8vIGRpc3RhbmNlIGZyb20gdGhlIG9yaWdpbiB0byBhIHBvaW50IGluIHRoZSB4LXogcGxhbmUKCQl0aGlzLnRoZXRhID0gdGhldGE7IC8vIGNvdW50ZXJjbG9ja3dpc2UgYW5nbGUgaW4gdGhlIHgteiBwbGFuZSBtZWFzdXJlZCBpbiByYWRpYW5zIGZyb20gdGhlIHBvc2l0aXZlIHotYXhpcwoJCXRoaXMueSA9IHk7IC8vIGhlaWdodCBhYm92ZSB0aGUgeC16IHBsYW5lCgoJCXJldHVybiB0aGlzOwoKCX0KCglzZXQoIHJhZGl1cywgdGhldGEsIHkgKSB7CgoJCXRoaXMucmFkaXVzID0gcmFkaXVzOwoJCXRoaXMudGhldGEgPSB0aGV0YTsKCQl0aGlzLnkgPSB5OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY29weSggb3RoZXIgKSB7CgoJCXRoaXMucmFkaXVzID0gb3RoZXIucmFkaXVzOwoJCXRoaXMudGhldGEgPSBvdGhlci50aGV0YTsKCQl0aGlzLnkgPSBvdGhlci55OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RnJvbVZlY3RvcjMoIHYgKSB7CgoJCXJldHVybiB0aGlzLnNldEZyb21DYXJ0ZXNpYW5Db29yZHMoIHYueCwgdi55LCB2LnogKTsKCgl9CgoJc2V0RnJvbUNhcnRlc2lhbkNvb3JkcyggeCwgeSwgeiApIHsKCgkJdGhpcy5yYWRpdXMgPSBNYXRoLnNxcnQoIHggKiB4ICsgeiAqIHogKTsKCQl0aGlzLnRoZXRhID0gTWF0aC5hdGFuMiggeCwgeiApOwoJCXRoaXMueSA9IHk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgljbG9uZSgpIHsKCgkJcmV0dXJuIG5ldyB0aGlzLmNvbnN0cnVjdG9yKCkuY29weSggdGhpcyApOwoKCX0KCn0KCmNvbnN0IF92ZWN0b3IkNCA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjIoKTsKCmNsYXNzIEJveDIgewoKCWNvbnN0cnVjdG9yKCBtaW4gPSBuZXcgVmVjdG9yMiggKyBJbmZpbml0eSwgKyBJbmZpbml0eSApLCBtYXggPSBuZXcgVmVjdG9yMiggLSBJbmZpbml0eSwgLSBJbmZpbml0eSApICkgewoKCQl0aGlzLmlzQm94MiA9IHRydWU7CgoJCXRoaXMubWluID0gbWluOwoJCXRoaXMubWF4ID0gbWF4OwoKCX0KCglzZXQoIG1pbiwgbWF4ICkgewoKCQl0aGlzLm1pbi5jb3B5KCBtaW4gKTsKCQl0aGlzLm1heC5jb3B5KCBtYXggKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNldEZyb21Qb2ludHMoIHBvaW50cyApIHsKCgkJdGhpcy5tYWtlRW1wdHkoKTsKCgkJZm9yICggbGV0IGkgPSAwLCBpbCA9IHBvaW50cy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCXRoaXMuZXhwYW5kQnlQb2ludCggcG9pbnRzWyBpIF0gKTsKCgkJfQoKCQlyZXR1cm4gdGhpczsKCgl9CgoJc2V0RnJvbUNlbnRlckFuZFNpemUoIGNlbnRlciwgc2l6ZSApIHsKCgkJY29uc3QgaGFsZlNpemUgPSBfdmVjdG9yJDQuY29weSggc2l6ZSApLm11bHRpcGx5U2NhbGFyKCAwLjUgKTsKCQl0aGlzLm1pbi5jb3B5KCBjZW50ZXIgKS5zdWIoIGhhbGZTaXplICk7CgkJdGhpcy5tYXguY29weSggY2VudGVyICkuYWRkKCBoYWxmU2l6ZSApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJY2xvbmUoKSB7CgoJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCgl9CgoJY29weSggYm94ICkgewoKCQl0aGlzLm1pbi5jb3B5KCBib3gubWluICk7CgkJdGhpcy5tYXguY29weSggYm94Lm1heCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJbWFrZUVtcHR5KCkgewoKCQl0aGlzLm1pbi54ID0gdGhpcy5taW4ueSA9ICsgSW5maW5pdHk7CgkJdGhpcy5tYXgueCA9IHRoaXMubWF4LnkgPSAtIEluZmluaXR5OwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJaXNFbXB0eSgpIHsKCgkJLy8gdGhpcyBpcyBhIG1vcmUgcm9idXN0IGNoZWNrIGZvciBlbXB0eSB0aGFuICggdm9sdW1lIDw9IDAgKSBiZWNhdXNlIHZvbHVtZSBjYW4gZ2V0IHBvc2l0aXZlIHdpdGggdHdvIG5lZ2F0aXZlIGF4ZXMKCgkJcmV0dXJuICggdGhpcy5tYXgueCA8IHRoaXMubWluLnggKSB8fCAoIHRoaXMubWF4LnkgPCB0aGlzLm1pbi55ICk7CgoJfQoKCWdldENlbnRlciggdGFyZ2V0ICkgewoKCQlyZXR1cm4gdGhpcy5pc0VtcHR5KCkgPyB0YXJnZXQuc2V0KCAwLCAwICkgOiB0YXJnZXQuYWRkVmVjdG9ycyggdGhpcy5taW4sIHRoaXMubWF4ICkubXVsdGlwbHlTY2FsYXIoIDAuNSApOwoKCX0KCglnZXRTaXplKCB0YXJnZXQgKSB7CgoJCXJldHVybiB0aGlzLmlzRW1wdHkoKSA/IHRhcmdldC5zZXQoIDAsIDAgKSA6IHRhcmdldC5zdWJWZWN0b3JzKCB0aGlzLm1heCwgdGhpcy5taW4gKTsKCgl9CgoJZXhwYW5kQnlQb2ludCggcG9pbnQgKSB7CgoJCXRoaXMubWluLm1pbiggcG9pbnQgKTsKCQl0aGlzLm1heC5tYXgoIHBvaW50ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglleHBhbmRCeVZlY3RvciggdmVjdG9yICkgewoKCQl0aGlzLm1pbi5zdWIoIHZlY3RvciApOwoJCXRoaXMubWF4LmFkZCggdmVjdG9yICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglleHBhbmRCeVNjYWxhciggc2NhbGFyICkgewoKCQl0aGlzLm1pbi5hZGRTY2FsYXIoIC0gc2NhbGFyICk7CgkJdGhpcy5tYXguYWRkU2NhbGFyKCBzY2FsYXIgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvbnRhaW5zUG9pbnQoIHBvaW50ICkgewoKCQlyZXR1cm4gcG9pbnQueCA8IHRoaXMubWluLnggfHwgcG9pbnQueCA+IHRoaXMubWF4LnggfHwKCQkJcG9pbnQueSA8IHRoaXMubWluLnkgfHwgcG9pbnQueSA+IHRoaXMubWF4LnkgPyBmYWxzZSA6IHRydWU7CgoJfQoKCWNvbnRhaW5zQm94KCBib3ggKSB7CgoJCXJldHVybiB0aGlzLm1pbi54IDw9IGJveC5taW4ueCAmJiBib3gubWF4LnggPD0gdGhpcy5tYXgueCAmJgoJCQl0aGlzLm1pbi55IDw9IGJveC5taW4ueSAmJiBib3gubWF4LnkgPD0gdGhpcy5tYXgueTsKCgl9CgoJZ2V0UGFyYW1ldGVyKCBwb2ludCwgdGFyZ2V0ICkgewoKCQkvLyBUaGlzIGNhbiBwb3RlbnRpYWxseSBoYXZlIGEgZGl2aWRlIGJ5IHplcm8gaWYgdGhlIGJveAoJCS8vIGhhcyBhIHNpemUgZGltZW5zaW9uIG9mIDAuCgoJCXJldHVybiB0YXJnZXQuc2V0KAoJCQkoIHBvaW50LnggLSB0aGlzLm1pbi54ICkgLyAoIHRoaXMubWF4LnggLSB0aGlzLm1pbi54ICksCgkJCSggcG9pbnQueSAtIHRoaXMubWluLnkgKSAvICggdGhpcy5tYXgueSAtIHRoaXMubWluLnkgKQoJCSk7CgoJfQoKCWludGVyc2VjdHNCb3goIGJveCApIHsKCgkJLy8gdXNpbmcgNCBzcGxpdHRpbmcgcGxhbmVzIHRvIHJ1bGUgb3V0IGludGVyc2VjdGlvbnMKCgkJcmV0dXJuIGJveC5tYXgueCA8IHRoaXMubWluLnggfHwgYm94Lm1pbi54ID4gdGhpcy5tYXgueCB8fAoJCQlib3gubWF4LnkgPCB0aGlzLm1pbi55IHx8IGJveC5taW4ueSA+IHRoaXMubWF4LnkgPyBmYWxzZSA6IHRydWU7CgoJfQoKCWNsYW1wUG9pbnQoIHBvaW50LCB0YXJnZXQgKSB7CgoJCXJldHVybiB0YXJnZXQuY29weSggcG9pbnQgKS5jbGFtcCggdGhpcy5taW4sIHRoaXMubWF4ICk7CgoJfQoKCWRpc3RhbmNlVG9Qb2ludCggcG9pbnQgKSB7CgoJCXJldHVybiB0aGlzLmNsYW1wUG9pbnQoIHBvaW50LCBfdmVjdG9yJDQgKS5kaXN0YW5jZVRvKCBwb2ludCApOwoKCX0KCglpbnRlcnNlY3QoIGJveCApIHsKCgkJdGhpcy5taW4ubWF4KCBib3gubWluICk7CgkJdGhpcy5tYXgubWluKCBib3gubWF4ICk7CgoJCWlmICggdGhpcy5pc0VtcHR5KCkgKSB0aGlzLm1ha2VFbXB0eSgpOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJdW5pb24oIGJveCApIHsKCgkJdGhpcy5taW4ubWluKCBib3gubWluICk7CgkJdGhpcy5tYXgubWF4KCBib3gubWF4ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgl0cmFuc2xhdGUoIG9mZnNldCApIHsKCgkJdGhpcy5taW4uYWRkKCBvZmZzZXQgKTsKCQl0aGlzLm1heC5hZGQoIG9mZnNldCApOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZXF1YWxzKCBib3ggKSB7CgoJCXJldHVybiBib3gubWluLmVxdWFscyggdGhpcy5taW4gKSAmJiBib3gubWF4LmVxdWFscyggdGhpcy5tYXggKTsKCgl9Cgp9Cgpjb25zdCBfc3RhcnRQID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfc3RhcnRFbmQgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgpjbGFzcyBMaW5lMyB7CgoJY29uc3RydWN0b3IoIHN0YXJ0ID0gbmV3IFZlY3RvcjMoKSwgZW5kID0gbmV3IFZlY3RvcjMoKSApIHsKCgkJdGhpcy5zdGFydCA9IHN0YXJ0OwoJCXRoaXMuZW5kID0gZW5kOwoKCX0KCglzZXQoIHN0YXJ0LCBlbmQgKSB7CgoJCXRoaXMuc3RhcnQuY29weSggc3RhcnQgKTsKCQl0aGlzLmVuZC5jb3B5KCBlbmQgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvcHkoIGxpbmUgKSB7CgoJCXRoaXMuc3RhcnQuY29weSggbGluZS5zdGFydCApOwoJCXRoaXMuZW5kLmNvcHkoIGxpbmUuZW5kICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglnZXRDZW50ZXIoIHRhcmdldCApIHsKCgkJcmV0dXJuIHRhcmdldC5hZGRWZWN0b3JzKCB0aGlzLnN0YXJ0LCB0aGlzLmVuZCApLm11bHRpcGx5U2NhbGFyKCAwLjUgKTsKCgl9CgoJZGVsdGEoIHRhcmdldCApIHsKCgkJcmV0dXJuIHRhcmdldC5zdWJWZWN0b3JzKCB0aGlzLmVuZCwgdGhpcy5zdGFydCApOwoKCX0KCglkaXN0YW5jZVNxKCkgewoKCQlyZXR1cm4gdGhpcy5zdGFydC5kaXN0YW5jZVRvU3F1YXJlZCggdGhpcy5lbmQgKTsKCgl9CgoJZGlzdGFuY2UoKSB7CgoJCXJldHVybiB0aGlzLnN0YXJ0LmRpc3RhbmNlVG8oIHRoaXMuZW5kICk7CgoJfQoKCWF0KCB0LCB0YXJnZXQgKSB7CgoJCXJldHVybiB0aGlzLmRlbHRhKCB0YXJnZXQgKS5tdWx0aXBseVNjYWxhciggdCApLmFkZCggdGhpcy5zdGFydCApOwoKCX0KCgljbG9zZXN0UG9pbnRUb1BvaW50UGFyYW1ldGVyKCBwb2ludCwgY2xhbXBUb0xpbmUgKSB7CgoJCV9zdGFydFAuc3ViVmVjdG9ycyggcG9pbnQsIHRoaXMuc3RhcnQgKTsKCQlfc3RhcnRFbmQuc3ViVmVjdG9ycyggdGhpcy5lbmQsIHRoaXMuc3RhcnQgKTsKCgkJY29uc3Qgc3RhcnRFbmQyID0gX3N0YXJ0RW5kLmRvdCggX3N0YXJ0RW5kICk7CgkJY29uc3Qgc3RhcnRFbmRfc3RhcnRQID0gX3N0YXJ0RW5kLmRvdCggX3N0YXJ0UCApOwoKCQlsZXQgdCA9IHN0YXJ0RW5kX3N0YXJ0UCAvIHN0YXJ0RW5kMjsKCgkJaWYgKCBjbGFtcFRvTGluZSApIHsKCgkJCXQgPSBjbGFtcCggdCwgMCwgMSApOwoKCQl9CgoJCXJldHVybiB0OwoKCX0KCgljbG9zZXN0UG9pbnRUb1BvaW50KCBwb2ludCwgY2xhbXBUb0xpbmUsIHRhcmdldCApIHsKCgkJY29uc3QgdCA9IHRoaXMuY2xvc2VzdFBvaW50VG9Qb2ludFBhcmFtZXRlciggcG9pbnQsIGNsYW1wVG9MaW5lICk7CgoJCXJldHVybiB0aGlzLmRlbHRhKCB0YXJnZXQgKS5tdWx0aXBseVNjYWxhciggdCApLmFkZCggdGhpcy5zdGFydCApOwoKCX0KCglhcHBseU1hdHJpeDQoIG1hdHJpeCApIHsKCgkJdGhpcy5zdGFydC5hcHBseU1hdHJpeDQoIG1hdHJpeCApOwoJCXRoaXMuZW5kLmFwcGx5TWF0cml4NCggbWF0cml4ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgllcXVhbHMoIGxpbmUgKSB7CgoJCXJldHVybiBsaW5lLnN0YXJ0LmVxdWFscyggdGhpcy5zdGFydCApICYmIGxpbmUuZW5kLmVxdWFscyggdGhpcy5lbmQgKTsKCgl9CgoJY2xvbmUoKSB7CgoJCXJldHVybiBuZXcgdGhpcy5jb25zdHJ1Y3RvcigpLmNvcHkoIHRoaXMgKTsKCgl9Cgp9Cgpjb25zdCBfdmVjdG9yJDMgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CgpjbGFzcyBTcG90TGlnaHRIZWxwZXIgZXh0ZW5kcyBPYmplY3QzRCB7CgoJY29uc3RydWN0b3IoIGxpZ2h0LCBjb2xvciApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy5saWdodCA9IGxpZ2h0OwoKCQl0aGlzLm1hdHJpeCA9IGxpZ2h0Lm1hdHJpeFdvcmxkOwoJCXRoaXMubWF0cml4QXV0b1VwZGF0ZSA9IGZhbHNlOwoKCQl0aGlzLmNvbG9yID0gY29sb3I7CgoJCXRoaXMudHlwZSA9ICdTcG90TGlnaHRIZWxwZXInOwoKCQljb25zdCBnZW9tZXRyeSA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoKCQljb25zdCBwb3NpdGlvbnMgPSBbCgkJCTAsIDAsIDAsIAkwLCAwLCAxLAoJCQkwLCAwLCAwLCAJMSwgMCwgMSwKCQkJMCwgMCwgMCwJLSAxLCAwLCAxLAoJCQkwLCAwLCAwLCAJMCwgMSwgMSwKCQkJMCwgMCwgMCwgCTAsIC0gMSwgMQoJCV07CgoJCWZvciAoIGxldCBpID0gMCwgaiA9IDEsIGwgPSAzMjsgaSA8IGw7IGkgKyssIGogKysgKSB7CgoJCQljb25zdCBwMSA9ICggaSAvIGwgKSAqIE1hdGguUEkgKiAyOwoJCQljb25zdCBwMiA9ICggaiAvIGwgKSAqIE1hdGguUEkgKiAyOwoKCQkJcG9zaXRpb25zLnB1c2goCgkJCQlNYXRoLmNvcyggcDEgKSwgTWF0aC5zaW4oIHAxICksIDEsCgkJCQlNYXRoLmNvcyggcDIgKSwgTWF0aC5zaW4oIHAyICksIDEKCQkJKTsKCgkJfQoKCQlnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbnMsIDMgKSApOwoKCQljb25zdCBtYXRlcmlhbCA9IG5ldyBMaW5lQmFzaWNNYXRlcmlhbCggeyBmb2c6IGZhbHNlLCB0b25lTWFwcGVkOiBmYWxzZSB9ICk7CgoJCXRoaXMuY29uZSA9IG5ldyBMaW5lU2VnbWVudHMoIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoJCXRoaXMuYWRkKCB0aGlzLmNvbmUgKTsKCgkJdGhpcy51cGRhdGUoKTsKCgl9CgoJZGlzcG9zZSgpIHsKCgkJdGhpcy5jb25lLmdlb21ldHJ5LmRpc3Bvc2UoKTsKCQl0aGlzLmNvbmUubWF0ZXJpYWwuZGlzcG9zZSgpOwoKCX0KCgl1cGRhdGUoKSB7CgoJCXRoaXMubGlnaHQudXBkYXRlV29ybGRNYXRyaXgoIHRydWUsIGZhbHNlICk7CgkJdGhpcy5saWdodC50YXJnZXQudXBkYXRlV29ybGRNYXRyaXgoIHRydWUsIGZhbHNlICk7CgoJCWNvbnN0IGNvbmVMZW5ndGggPSB0aGlzLmxpZ2h0LmRpc3RhbmNlID8gdGhpcy5saWdodC5kaXN0YW5jZSA6IDEwMDA7CgkJY29uc3QgY29uZVdpZHRoID0gY29uZUxlbmd0aCAqIE1hdGgudGFuKCB0aGlzLmxpZ2h0LmFuZ2xlICk7CgoJCXRoaXMuY29uZS5zY2FsZS5zZXQoIGNvbmVXaWR0aCwgY29uZVdpZHRoLCBjb25lTGVuZ3RoICk7CgoJCV92ZWN0b3IkMy5zZXRGcm9tTWF0cml4UG9zaXRpb24oIHRoaXMubGlnaHQudGFyZ2V0Lm1hdHJpeFdvcmxkICk7CgoJCXRoaXMuY29uZS5sb29rQXQoIF92ZWN0b3IkMyApOwoKCQlpZiAoIHRoaXMuY29sb3IgIT09IHVuZGVmaW5lZCApIHsKCgkJCXRoaXMuY29uZS5tYXRlcmlhbC5jb2xvci5zZXQoIHRoaXMuY29sb3IgKTsKCgkJfSBlbHNlIHsKCgkJCXRoaXMuY29uZS5tYXRlcmlhbC5jb2xvci5jb3B5KCB0aGlzLmxpZ2h0LmNvbG9yICk7CgoJCX0KCgl9Cgp9Cgpjb25zdCBfdmVjdG9yJDIgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF9ib25lTWF0cml4ID0gLypAX19QVVJFX18qLyBuZXcgTWF0cml4NCgpOwpjb25zdCBfbWF0cml4V29ybGRJbnYgPSAvKkBfX1BVUkVfXyovIG5ldyBNYXRyaXg0KCk7CgoKY2xhc3MgU2tlbGV0b25IZWxwZXIgZXh0ZW5kcyBMaW5lU2VnbWVudHMgewoKCWNvbnN0cnVjdG9yKCBvYmplY3QgKSB7CgoJCWNvbnN0IGJvbmVzID0gZ2V0Qm9uZUxpc3QoIG9iamVjdCApOwoKCQljb25zdCBnZW9tZXRyeSA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoKCQljb25zdCB2ZXJ0aWNlcyA9IFtdOwoJCWNvbnN0IGNvbG9ycyA9IFtdOwoKCQljb25zdCBjb2xvcjEgPSBuZXcgQ29sb3IoIDAsIDAsIDEgKTsKCQljb25zdCBjb2xvcjIgPSBuZXcgQ29sb3IoIDAsIDEsIDAgKTsKCgkJZm9yICggbGV0IGkgPSAwOyBpIDwgYm9uZXMubGVuZ3RoOyBpICsrICkgewoKCQkJY29uc3QgYm9uZSA9IGJvbmVzWyBpIF07CgoJCQlpZiAoIGJvbmUucGFyZW50ICYmIGJvbmUucGFyZW50LmlzQm9uZSApIHsKCgkJCQl2ZXJ0aWNlcy5wdXNoKCAwLCAwLCAwICk7CgkJCQl2ZXJ0aWNlcy5wdXNoKCAwLCAwLCAwICk7CgkJCQljb2xvcnMucHVzaCggY29sb3IxLnIsIGNvbG9yMS5nLCBjb2xvcjEuYiApOwoJCQkJY29sb3JzLnB1c2goIGNvbG9yMi5yLCBjb2xvcjIuZywgY29sb3IyLmIgKTsKCgkJCX0KCgkJfQoKCQlnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlcywgMyApICk7CgkJZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCAnY29sb3InLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggY29sb3JzLCAzICkgKTsKCgkJY29uc3QgbWF0ZXJpYWwgPSBuZXcgTGluZUJhc2ljTWF0ZXJpYWwoIHsgdmVydGV4Q29sb3JzOiB0cnVlLCBkZXB0aFRlc3Q6IGZhbHNlLCBkZXB0aFdyaXRlOiBmYWxzZSwgdG9uZU1hcHBlZDogZmFsc2UsIHRyYW5zcGFyZW50OiB0cnVlIH0gKTsKCgkJc3VwZXIoIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCQl0aGlzLmlzU2tlbGV0b25IZWxwZXIgPSB0cnVlOwoKCQl0aGlzLnR5cGUgPSAnU2tlbGV0b25IZWxwZXInOwoKCQl0aGlzLnJvb3QgPSBvYmplY3Q7CgkJdGhpcy5ib25lcyA9IGJvbmVzOwoKCQl0aGlzLm1hdHJpeCA9IG9iamVjdC5tYXRyaXhXb3JsZDsKCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCgl9CgoJdXBkYXRlTWF0cml4V29ybGQoIGZvcmNlICkgewoKCQljb25zdCBib25lcyA9IHRoaXMuYm9uZXM7CgoJCWNvbnN0IGdlb21ldHJ5ID0gdGhpcy5nZW9tZXRyeTsKCQljb25zdCBwb3NpdGlvbiA9IGdlb21ldHJ5LmdldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJyApOwoKCQlfbWF0cml4V29ybGRJbnYuY29weSggdGhpcy5yb290Lm1hdHJpeFdvcmxkICkuaW52ZXJ0KCk7CgoJCWZvciAoIGxldCBpID0gMCwgaiA9IDA7IGkgPCBib25lcy5sZW5ndGg7IGkgKysgKSB7CgoJCQljb25zdCBib25lID0gYm9uZXNbIGkgXTsKCgkJCWlmICggYm9uZS5wYXJlbnQgJiYgYm9uZS5wYXJlbnQuaXNCb25lICkgewoKCQkJCV9ib25lTWF0cml4Lm11bHRpcGx5TWF0cmljZXMoIF9tYXRyaXhXb3JsZEludiwgYm9uZS5tYXRyaXhXb3JsZCApOwoJCQkJX3ZlY3RvciQyLnNldEZyb21NYXRyaXhQb3NpdGlvbiggX2JvbmVNYXRyaXggKTsKCQkJCXBvc2l0aW9uLnNldFhZWiggaiwgX3ZlY3RvciQyLngsIF92ZWN0b3IkMi55LCBfdmVjdG9yJDIueiApOwoKCQkJCV9ib25lTWF0cml4Lm11bHRpcGx5TWF0cmljZXMoIF9tYXRyaXhXb3JsZEludiwgYm9uZS5wYXJlbnQubWF0cml4V29ybGQgKTsKCQkJCV92ZWN0b3IkMi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIF9ib25lTWF0cml4ICk7CgkJCQlwb3NpdGlvbi5zZXRYWVooIGogKyAxLCBfdmVjdG9yJDIueCwgX3ZlY3RvciQyLnksIF92ZWN0b3IkMi56ICk7CgoJCQkJaiArPSAyOwoKCQkJfQoKCQl9CgoJCWdlb21ldHJ5LmdldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJyApLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgkJc3VwZXIudXBkYXRlTWF0cml4V29ybGQoIGZvcmNlICk7CgoJfQoKCWRpc3Bvc2UoKSB7CgoJCXRoaXMuZ2VvbWV0cnkuZGlzcG9zZSgpOwoJCXRoaXMubWF0ZXJpYWwuZGlzcG9zZSgpOwoKCX0KCn0KCgpmdW5jdGlvbiBnZXRCb25lTGlzdCggb2JqZWN0ICkgewoKCWNvbnN0IGJvbmVMaXN0ID0gW107CgoJaWYgKCBvYmplY3QuaXNCb25lID09PSB0cnVlICkgewoKCQlib25lTGlzdC5wdXNoKCBvYmplY3QgKTsKCgl9CgoJZm9yICggbGV0IGkgPSAwOyBpIDwgb2JqZWN0LmNoaWxkcmVuLmxlbmd0aDsgaSArKyApIHsKCgkJYm9uZUxpc3QucHVzaC5hcHBseSggYm9uZUxpc3QsIGdldEJvbmVMaXN0KCBvYmplY3QuY2hpbGRyZW5bIGkgXSApICk7CgoJfQoKCXJldHVybiBib25lTGlzdDsKCn0KCmNsYXNzIFBvaW50TGlnaHRIZWxwZXIgZXh0ZW5kcyBNZXNoIHsKCgljb25zdHJ1Y3RvciggbGlnaHQsIHNwaGVyZVNpemUsIGNvbG9yICkgewoKCQljb25zdCBnZW9tZXRyeSA9IG5ldyBTcGhlcmVHZW9tZXRyeSggc3BoZXJlU2l6ZSwgNCwgMiApOwoJCWNvbnN0IG1hdGVyaWFsID0gbmV3IE1lc2hCYXNpY01hdGVyaWFsKCB7IHdpcmVmcmFtZTogdHJ1ZSwgZm9nOiBmYWxzZSwgdG9uZU1hcHBlZDogZmFsc2UgfSApOwoKCQlzdXBlciggZ2VvbWV0cnksIG1hdGVyaWFsICk7CgoJCXRoaXMubGlnaHQgPSBsaWdodDsKCgkJdGhpcy5jb2xvciA9IGNvbG9yOwoKCQl0aGlzLnR5cGUgPSAnUG9pbnRMaWdodEhlbHBlcic7CgoJCXRoaXMubWF0cml4ID0gdGhpcy5saWdodC5tYXRyaXhXb3JsZDsKCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCgkJdGhpcy51cGRhdGUoKTsKCgoJCS8qCgkvLyBUT0RPOiBkZWxldGUgdGhpcyBjb21tZW50PwoJY29uc3QgZGlzdGFuY2VHZW9tZXRyeSA9IG5ldyBUSFJFRS5JY29zYWhlZHJvbkdlb21ldHJ5KCAxLCAyICk7Cgljb25zdCBkaXN0YW5jZU1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hCYXNpY01hdGVyaWFsKCB7IGNvbG9yOiBoZXhDb2xvciwgZm9nOiBmYWxzZSwgd2lyZWZyYW1lOiB0cnVlLCBvcGFjaXR5OiAwLjEsIHRyYW5zcGFyZW50OiB0cnVlIH0gKTsKCgl0aGlzLmxpZ2h0U3BoZXJlID0gbmV3IFRIUkVFLk1lc2goIGJ1bGJHZW9tZXRyeSwgYnVsYk1hdGVyaWFsICk7Cgl0aGlzLmxpZ2h0RGlzdGFuY2UgPSBuZXcgVEhSRUUuTWVzaCggZGlzdGFuY2VHZW9tZXRyeSwgZGlzdGFuY2VNYXRlcmlhbCApOwoKCWNvbnN0IGQgPSBsaWdodC5kaXN0YW5jZTsKCglpZiAoIGQgPT09IDAuMCApIHsKCgkJdGhpcy5saWdodERpc3RhbmNlLnZpc2libGUgPSBmYWxzZTsKCgl9IGVsc2UgewoKCQl0aGlzLmxpZ2h0RGlzdGFuY2Uuc2NhbGUuc2V0KCBkLCBkLCBkICk7CgoJfQoKCXRoaXMuYWRkKCB0aGlzLmxpZ2h0RGlzdGFuY2UgKTsKCSovCgoJfQoKCWRpc3Bvc2UoKSB7CgoJCXRoaXMuZ2VvbWV0cnkuZGlzcG9zZSgpOwoJCXRoaXMubWF0ZXJpYWwuZGlzcG9zZSgpOwoKCX0KCgl1cGRhdGUoKSB7CgoJCXRoaXMubGlnaHQudXBkYXRlV29ybGRNYXRyaXgoIHRydWUsIGZhbHNlICk7CgoJCWlmICggdGhpcy5jb2xvciAhPT0gdW5kZWZpbmVkICkgewoKCQkJdGhpcy5tYXRlcmlhbC5jb2xvci5zZXQoIHRoaXMuY29sb3IgKTsKCgkJfSBlbHNlIHsKCgkJCXRoaXMubWF0ZXJpYWwuY29sb3IuY29weSggdGhpcy5saWdodC5jb2xvciApOwoKCQl9CgoJCS8qCgkJY29uc3QgZCA9IHRoaXMubGlnaHQuZGlzdGFuY2U7CgoJCWlmICggZCA9PT0gMC4wICkgewoKCQkJdGhpcy5saWdodERpc3RhbmNlLnZpc2libGUgPSBmYWxzZTsKCgkJfSBlbHNlIHsKCgkJCXRoaXMubGlnaHREaXN0YW5jZS52aXNpYmxlID0gdHJ1ZTsKCQkJdGhpcy5saWdodERpc3RhbmNlLnNjYWxlLnNldCggZCwgZCwgZCApOwoKCQl9CgkJKi8KCgl9Cgp9Cgpjb25zdCBfdmVjdG9yJDEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF9jb2xvcjEgPSAvKkBfX1BVUkVfXyovIG5ldyBDb2xvcigpOwpjb25zdCBfY29sb3IyID0gLypAX19QVVJFX18qLyBuZXcgQ29sb3IoKTsKCmNsYXNzIEhlbWlzcGhlcmVMaWdodEhlbHBlciBleHRlbmRzIE9iamVjdDNEIHsKCgljb25zdHJ1Y3RvciggbGlnaHQsIHNpemUsIGNvbG9yICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmxpZ2h0ID0gbGlnaHQ7CgoJCXRoaXMubWF0cml4ID0gbGlnaHQubWF0cml4V29ybGQ7CgkJdGhpcy5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgoJCXRoaXMuY29sb3IgPSBjb2xvcjsKCgkJdGhpcy50eXBlID0gJ0hlbWlzcGhlcmVMaWdodEhlbHBlcic7CgoJCWNvbnN0IGdlb21ldHJ5ID0gbmV3IE9jdGFoZWRyb25HZW9tZXRyeSggc2l6ZSApOwoJCWdlb21ldHJ5LnJvdGF0ZVkoIE1hdGguUEkgKiAwLjUgKTsKCgkJdGhpcy5tYXRlcmlhbCA9IG5ldyBNZXNoQmFzaWNNYXRlcmlhbCggeyB3aXJlZnJhbWU6IHRydWUsIGZvZzogZmFsc2UsIHRvbmVNYXBwZWQ6IGZhbHNlIH0gKTsKCQlpZiAoIHRoaXMuY29sb3IgPT09IHVuZGVmaW5lZCApIHRoaXMubWF0ZXJpYWwudmVydGV4Q29sb3JzID0gdHJ1ZTsKCgkJY29uc3QgcG9zaXRpb24gPSBnZW9tZXRyeS5nZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicgKTsKCQljb25zdCBjb2xvcnMgPSBuZXcgRmxvYXQzMkFycmF5KCBwb3NpdGlvbi5jb3VudCAqIDMgKTsKCgkJZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCAnY29sb3InLCBuZXcgQnVmZmVyQXR0cmlidXRlKCBjb2xvcnMsIDMgKSApOwoKCQl0aGlzLmFkZCggbmV3IE1lc2goIGdlb21ldHJ5LCB0aGlzLm1hdGVyaWFsICkgKTsKCgkJdGhpcy51cGRhdGUoKTsKCgl9CgoJZGlzcG9zZSgpIHsKCgkJdGhpcy5jaGlsZHJlblsgMCBdLmdlb21ldHJ5LmRpc3Bvc2UoKTsKCQl0aGlzLmNoaWxkcmVuWyAwIF0ubWF0ZXJpYWwuZGlzcG9zZSgpOwoKCX0KCgl1cGRhdGUoKSB7CgoJCWNvbnN0IG1lc2ggPSB0aGlzLmNoaWxkcmVuWyAwIF07CgoJCWlmICggdGhpcy5jb2xvciAhPT0gdW5kZWZpbmVkICkgewoKCQkJdGhpcy5tYXRlcmlhbC5jb2xvci5zZXQoIHRoaXMuY29sb3IgKTsKCgkJfSBlbHNlIHsKCgkJCWNvbnN0IGNvbG9ycyA9IG1lc2guZ2VvbWV0cnkuZ2V0QXR0cmlidXRlKCAnY29sb3InICk7CgoJCQlfY29sb3IxLmNvcHkoIHRoaXMubGlnaHQuY29sb3IgKTsKCQkJX2NvbG9yMi5jb3B5KCB0aGlzLmxpZ2h0Lmdyb3VuZENvbG9yICk7CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBjb2xvcnMuY291bnQ7IGkgPCBsOyBpICsrICkgewoKCQkJCWNvbnN0IGNvbG9yID0gKCBpIDwgKCBsIC8gMiApICkgPyBfY29sb3IxIDogX2NvbG9yMjsKCgkJCQljb2xvcnMuc2V0WFlaKCBpLCBjb2xvci5yLCBjb2xvci5nLCBjb2xvci5iICk7CgoJCQl9CgoJCQljb2xvcnMubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQl9CgoJCXRoaXMubGlnaHQudXBkYXRlV29ybGRNYXRyaXgoIHRydWUsIGZhbHNlICk7CgoJCW1lc2gubG9va0F0KCBfdmVjdG9yJDEuc2V0RnJvbU1hdHJpeFBvc2l0aW9uKCB0aGlzLmxpZ2h0Lm1hdHJpeFdvcmxkICkubmVnYXRlKCkgKTsKCgl9Cgp9CgpjbGFzcyBHcmlkSGVscGVyIGV4dGVuZHMgTGluZVNlZ21lbnRzIHsKCgljb25zdHJ1Y3Rvciggc2l6ZSA9IDEwLCBkaXZpc2lvbnMgPSAxMCwgY29sb3IxID0gMHg0NDQ0NDQsIGNvbG9yMiA9IDB4ODg4ODg4ICkgewoKCQljb2xvcjEgPSBuZXcgQ29sb3IoIGNvbG9yMSApOwoJCWNvbG9yMiA9IG5ldyBDb2xvciggY29sb3IyICk7CgoJCWNvbnN0IGNlbnRlciA9IGRpdmlzaW9ucyAvIDI7CgkJY29uc3Qgc3RlcCA9IHNpemUgLyBkaXZpc2lvbnM7CgkJY29uc3QgaGFsZlNpemUgPSBzaXplIC8gMjsKCgkJY29uc3QgdmVydGljZXMgPSBbXSwgY29sb3JzID0gW107CgoJCWZvciAoIGxldCBpID0gMCwgaiA9IDAsIGsgPSAtIGhhbGZTaXplOyBpIDw9IGRpdmlzaW9uczsgaSArKywgayArPSBzdGVwICkgewoKCQkJdmVydGljZXMucHVzaCggLSBoYWxmU2l6ZSwgMCwgaywgaGFsZlNpemUsIDAsIGsgKTsKCQkJdmVydGljZXMucHVzaCggaywgMCwgLSBoYWxmU2l6ZSwgaywgMCwgaGFsZlNpemUgKTsKCgkJCWNvbnN0IGNvbG9yID0gaSA9PT0gY2VudGVyID8gY29sb3IxIDogY29sb3IyOwoKCQkJY29sb3IudG9BcnJheSggY29sb3JzLCBqICk7IGogKz0gMzsKCQkJY29sb3IudG9BcnJheSggY29sb3JzLCBqICk7IGogKz0gMzsKCQkJY29sb3IudG9BcnJheSggY29sb3JzLCBqICk7IGogKz0gMzsKCQkJY29sb3IudG9BcnJheSggY29sb3JzLCBqICk7IGogKz0gMzsKCgkJfQoKCQljb25zdCBnZW9tZXRyeSA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoJCWdlb21ldHJ5LnNldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzLCAzICkgKTsKCQlnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoICdjb2xvcicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBjb2xvcnMsIDMgKSApOwoKCQljb25zdCBtYXRlcmlhbCA9IG5ldyBMaW5lQmFzaWNNYXRlcmlhbCggeyB2ZXJ0ZXhDb2xvcnM6IHRydWUsIHRvbmVNYXBwZWQ6IGZhbHNlIH0gKTsKCgkJc3VwZXIoIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCQl0aGlzLnR5cGUgPSAnR3JpZEhlbHBlcic7CgoJfQoKCWRpc3Bvc2UoKSB7CgoJCXRoaXMuZ2VvbWV0cnkuZGlzcG9zZSgpOwoJCXRoaXMubWF0ZXJpYWwuZGlzcG9zZSgpOwoKCX0KCn0KCmNsYXNzIFBvbGFyR3JpZEhlbHBlciBleHRlbmRzIExpbmVTZWdtZW50cyB7CgoJY29uc3RydWN0b3IoIHJhZGl1cyA9IDEwLCBzZWN0b3JzID0gMTYsIHJpbmdzID0gOCwgZGl2aXNpb25zID0gNjQsIGNvbG9yMSA9IDB4NDQ0NDQ0LCBjb2xvcjIgPSAweDg4ODg4OCApIHsKCgkJY29sb3IxID0gbmV3IENvbG9yKCBjb2xvcjEgKTsKCQljb2xvcjIgPSBuZXcgQ29sb3IoIGNvbG9yMiApOwoKCQljb25zdCB2ZXJ0aWNlcyA9IFtdOwoJCWNvbnN0IGNvbG9ycyA9IFtdOwoKCQkvLyBjcmVhdGUgdGhlIHNlY3RvcnMKCgkJaWYgKCBzZWN0b3JzID4gMSApIHsKCgkJCWZvciAoIGxldCBpID0gMDsgaSA8IHNlY3RvcnM7IGkgKysgKSB7CgoJCQkJY29uc3QgdiA9ICggaSAvIHNlY3RvcnMgKSAqICggTWF0aC5QSSAqIDIgKTsKCgkJCQljb25zdCB4ID0gTWF0aC5zaW4oIHYgKSAqIHJhZGl1czsKCQkJCWNvbnN0IHogPSBNYXRoLmNvcyggdiApICogcmFkaXVzOwoKCQkJCXZlcnRpY2VzLnB1c2goIDAsIDAsIDAgKTsKCQkJCXZlcnRpY2VzLnB1c2goIHgsIDAsIHogKTsKCgkJCQljb25zdCBjb2xvciA9ICggaSAmIDEgKSA/IGNvbG9yMSA6IGNvbG9yMjsKCgkJCQljb2xvcnMucHVzaCggY29sb3IuciwgY29sb3IuZywgY29sb3IuYiApOwoJCQkJY29sb3JzLnB1c2goIGNvbG9yLnIsIGNvbG9yLmcsIGNvbG9yLmIgKTsKCgkJCX0KCgkJfQoKCQkvLyBjcmVhdGUgdGhlIHJpbmdzCgoJCWZvciAoIGxldCBpID0gMDsgaSA8IHJpbmdzOyBpICsrICkgewoKCQkJY29uc3QgY29sb3IgPSAoIGkgJiAxICkgPyBjb2xvcjEgOiBjb2xvcjI7CgoJCQljb25zdCByID0gcmFkaXVzIC0gKCByYWRpdXMgLyByaW5ncyAqIGkgKTsKCgkJCWZvciAoIGxldCBqID0gMDsgaiA8IGRpdmlzaW9uczsgaiArKyApIHsKCgkJCQkvLyBmaXJzdCB2ZXJ0ZXgKCgkJCQlsZXQgdiA9ICggaiAvIGRpdmlzaW9ucyApICogKCBNYXRoLlBJICogMiApOwoKCQkJCWxldCB4ID0gTWF0aC5zaW4oIHYgKSAqIHI7CgkJCQlsZXQgeiA9IE1hdGguY29zKCB2ICkgKiByOwoKCQkJCXZlcnRpY2VzLnB1c2goIHgsIDAsIHogKTsKCQkJCWNvbG9ycy5wdXNoKCBjb2xvci5yLCBjb2xvci5nLCBjb2xvci5iICk7CgoJCQkJLy8gc2Vjb25kIHZlcnRleAoKCQkJCXYgPSAoICggaiArIDEgKSAvIGRpdmlzaW9ucyApICogKCBNYXRoLlBJICogMiApOwoKCQkJCXggPSBNYXRoLnNpbiggdiApICogcjsKCQkJCXogPSBNYXRoLmNvcyggdiApICogcjsKCgkJCQl2ZXJ0aWNlcy5wdXNoKCB4LCAwLCB6ICk7CgkJCQljb2xvcnMucHVzaCggY29sb3IuciwgY29sb3IuZywgY29sb3IuYiApOwoKCQkJfQoKCQl9CgoJCWNvbnN0IGdlb21ldHJ5ID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCk7CgkJZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggdmVydGljZXMsIDMgKSApOwoJCWdlb21ldHJ5LnNldEF0dHJpYnV0ZSggJ2NvbG9yJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIGNvbG9ycywgMyApICk7CgoJCWNvbnN0IG1hdGVyaWFsID0gbmV3IExpbmVCYXNpY01hdGVyaWFsKCB7IHZlcnRleENvbG9yczogdHJ1ZSwgdG9uZU1hcHBlZDogZmFsc2UgfSApOwoKCQlzdXBlciggZ2VvbWV0cnksIG1hdGVyaWFsICk7CgoJCXRoaXMudHlwZSA9ICdQb2xhckdyaWRIZWxwZXInOwoKCX0KCglkaXNwb3NlKCkgewoKCQl0aGlzLmdlb21ldHJ5LmRpc3Bvc2UoKTsKCQl0aGlzLm1hdGVyaWFsLmRpc3Bvc2UoKTsKCgl9Cgp9Cgpjb25zdCBfdjEgPSAvKkBfX1BVUkVfXyovIG5ldyBWZWN0b3IzKCk7CmNvbnN0IF92MiA9IC8qQF9fUFVSRV9fKi8gbmV3IFZlY3RvcjMoKTsKY29uc3QgX3YzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwoKY2xhc3MgRGlyZWN0aW9uYWxMaWdodEhlbHBlciBleHRlbmRzIE9iamVjdDNEIHsKCgljb25zdHJ1Y3RvciggbGlnaHQsIHNpemUsIGNvbG9yICkgewoKCQlzdXBlcigpOwoKCQl0aGlzLmxpZ2h0ID0gbGlnaHQ7CgoJCXRoaXMubWF0cml4ID0gbGlnaHQubWF0cml4V29ybGQ7CgkJdGhpcy5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgoJCXRoaXMuY29sb3IgPSBjb2xvcjsKCgkJdGhpcy50eXBlID0gJ0RpcmVjdGlvbmFsTGlnaHRIZWxwZXInOwoKCQlpZiAoIHNpemUgPT09IHVuZGVmaW5lZCApIHNpemUgPSAxOwoKCQlsZXQgZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCQlnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBbCgkJCS0gc2l6ZSwgc2l6ZSwgMCwKCQkJc2l6ZSwgc2l6ZSwgMCwKCQkJc2l6ZSwgLSBzaXplLCAwLAoJCQktIHNpemUsIC0gc2l6ZSwgMCwKCQkJLSBzaXplLCBzaXplLCAwCgkJXSwgMyApICk7CgoJCWNvbnN0IG1hdGVyaWFsID0gbmV3IExpbmVCYXNpY01hdGVyaWFsKCB7IGZvZzogZmFsc2UsIHRvbmVNYXBwZWQ6IGZhbHNlIH0gKTsKCgkJdGhpcy5saWdodFBsYW5lID0gbmV3IExpbmUoIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoJCXRoaXMuYWRkKCB0aGlzLmxpZ2h0UGxhbmUgKTsKCgkJZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCQlnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBbIDAsIDAsIDAsIDAsIDAsIDEgXSwgMyApICk7CgoJCXRoaXMudGFyZ2V0TGluZSA9IG5ldyBMaW5lKCBnZW9tZXRyeSwgbWF0ZXJpYWwgKTsKCQl0aGlzLmFkZCggdGhpcy50YXJnZXRMaW5lICk7CgoJCXRoaXMudXBkYXRlKCk7CgoJfQoKCWRpc3Bvc2UoKSB7CgoJCXRoaXMubGlnaHRQbGFuZS5nZW9tZXRyeS5kaXNwb3NlKCk7CgkJdGhpcy5saWdodFBsYW5lLm1hdGVyaWFsLmRpc3Bvc2UoKTsKCQl0aGlzLnRhcmdldExpbmUuZ2VvbWV0cnkuZGlzcG9zZSgpOwoJCXRoaXMudGFyZ2V0TGluZS5tYXRlcmlhbC5kaXNwb3NlKCk7CgoJfQoKCXVwZGF0ZSgpIHsKCgkJdGhpcy5saWdodC51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCQl0aGlzLmxpZ2h0LnRhcmdldC51cGRhdGVXb3JsZE1hdHJpeCggdHJ1ZSwgZmFsc2UgKTsKCgkJX3YxLnNldEZyb21NYXRyaXhQb3NpdGlvbiggdGhpcy5saWdodC5tYXRyaXhXb3JsZCApOwoJCV92Mi5zZXRGcm9tTWF0cml4UG9zaXRpb24oIHRoaXMubGlnaHQudGFyZ2V0Lm1hdHJpeFdvcmxkICk7CgkJX3YzLnN1YlZlY3RvcnMoIF92MiwgX3YxICk7CgoJCXRoaXMubGlnaHRQbGFuZS5sb29rQXQoIF92MiApOwoKCQlpZiAoIHRoaXMuY29sb3IgIT09IHVuZGVmaW5lZCApIHsKCgkJCXRoaXMubGlnaHRQbGFuZS5tYXRlcmlhbC5jb2xvci5zZXQoIHRoaXMuY29sb3IgKTsKCQkJdGhpcy50YXJnZXRMaW5lLm1hdGVyaWFsLmNvbG9yLnNldCggdGhpcy5jb2xvciApOwoKCQl9IGVsc2UgewoKCQkJdGhpcy5saWdodFBsYW5lLm1hdGVyaWFsLmNvbG9yLmNvcHkoIHRoaXMubGlnaHQuY29sb3IgKTsKCQkJdGhpcy50YXJnZXRMaW5lLm1hdGVyaWFsLmNvbG9yLmNvcHkoIHRoaXMubGlnaHQuY29sb3IgKTsKCgkJfQoKCQl0aGlzLnRhcmdldExpbmUubG9va0F0KCBfdjIgKTsKCQl0aGlzLnRhcmdldExpbmUuc2NhbGUueiA9IF92My5sZW5ndGgoKTsKCgl9Cgp9Cgpjb25zdCBfdmVjdG9yID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpjb25zdCBfY2FtZXJhID0gLypAX19QVVJFX18qLyBuZXcgQ2FtZXJhKCk7CgovKioKICoJLSBzaG93cyBmcnVzdHVtLCBsaW5lIG9mIHNpZ2h0IGFuZCB1cCBvZiB0aGUgY2FtZXJhCiAqCS0gc3VpdGFibGUgZm9yIGZhc3QgdXBkYXRlcwogKiAJLSBiYXNlZCBvbiBmcnVzdHVtIHZpc3VhbGl6YXRpb24gaW4gbGlnaHRnbC5qcyBzaGFkb3dtYXAgZXhhbXBsZQogKgkJaHR0cHM6Ly9naXRodWIuY29tL2V2YW53L2xpZ2h0Z2wuanMvYmxvYi9tYXN0ZXIvdGVzdHMvc2hhZG93bWFwLmh0bWwKICovCgpjbGFzcyBDYW1lcmFIZWxwZXIgZXh0ZW5kcyBMaW5lU2VnbWVudHMgewoKCWNvbnN0cnVjdG9yKCBjYW1lcmEgKSB7CgoJCWNvbnN0IGdlb21ldHJ5ID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCk7CgkJY29uc3QgbWF0ZXJpYWwgPSBuZXcgTGluZUJhc2ljTWF0ZXJpYWwoIHsgY29sb3I6IDB4ZmZmZmZmLCB2ZXJ0ZXhDb2xvcnM6IHRydWUsIHRvbmVNYXBwZWQ6IGZhbHNlIH0gKTsKCgkJY29uc3QgdmVydGljZXMgPSBbXTsKCQljb25zdCBjb2xvcnMgPSBbXTsKCgkJY29uc3QgcG9pbnRNYXAgPSB7fTsKCgkJLy8gbmVhcgoKCQlhZGRMaW5lKCAnbjEnLCAnbjInICk7CgkJYWRkTGluZSggJ24yJywgJ240JyApOwoJCWFkZExpbmUoICduNCcsICduMycgKTsKCQlhZGRMaW5lKCAnbjMnLCAnbjEnICk7CgoJCS8vIGZhcgoKCQlhZGRMaW5lKCAnZjEnLCAnZjInICk7CgkJYWRkTGluZSggJ2YyJywgJ2Y0JyApOwoJCWFkZExpbmUoICdmNCcsICdmMycgKTsKCQlhZGRMaW5lKCAnZjMnLCAnZjEnICk7CgoJCS8vIHNpZGVzCgoJCWFkZExpbmUoICduMScsICdmMScgKTsKCQlhZGRMaW5lKCAnbjInLCAnZjInICk7CgkJYWRkTGluZSggJ24zJywgJ2YzJyApOwoJCWFkZExpbmUoICduNCcsICdmNCcgKTsKCgkJLy8gY29uZQoKCQlhZGRMaW5lKCAncCcsICduMScgKTsKCQlhZGRMaW5lKCAncCcsICduMicgKTsKCQlhZGRMaW5lKCAncCcsICduMycgKTsKCQlhZGRMaW5lKCAncCcsICduNCcgKTsKCgkJLy8gdXAKCgkJYWRkTGluZSggJ3UxJywgJ3UyJyApOwoJCWFkZExpbmUoICd1MicsICd1MycgKTsKCQlhZGRMaW5lKCAndTMnLCAndTEnICk7CgoJCS8vIHRhcmdldAoKCQlhZGRMaW5lKCAnYycsICd0JyApOwoJCWFkZExpbmUoICdwJywgJ2MnICk7CgoJCS8vIGNyb3NzCgoJCWFkZExpbmUoICdjbjEnLCAnY24yJyApOwoJCWFkZExpbmUoICdjbjMnLCAnY240JyApOwoKCQlhZGRMaW5lKCAnY2YxJywgJ2NmMicgKTsKCQlhZGRMaW5lKCAnY2YzJywgJ2NmNCcgKTsKCgkJZnVuY3Rpb24gYWRkTGluZSggYSwgYiApIHsKCgkJCWFkZFBvaW50KCBhICk7CgkJCWFkZFBvaW50KCBiICk7CgoJCX0KCgkJZnVuY3Rpb24gYWRkUG9pbnQoIGlkICkgewoKCQkJdmVydGljZXMucHVzaCggMCwgMCwgMCApOwoJCQljb2xvcnMucHVzaCggMCwgMCwgMCApOwoKCQkJaWYgKCBwb2ludE1hcFsgaWQgXSA9PT0gdW5kZWZpbmVkICkgewoKCQkJCXBvaW50TWFwWyBpZCBdID0gW107CgoJCQl9CgoJCQlwb2ludE1hcFsgaWQgXS5wdXNoKCAoIHZlcnRpY2VzLmxlbmd0aCAvIDMgKSAtIDEgKTsKCgkJfQoKCQlnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCB2ZXJ0aWNlcywgMyApICk7CgkJZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCAnY29sb3InLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggY29sb3JzLCAzICkgKTsKCgkJc3VwZXIoIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCQl0aGlzLnR5cGUgPSAnQ2FtZXJhSGVscGVyJzsKCgkJdGhpcy5jYW1lcmEgPSBjYW1lcmE7CgkJaWYgKCB0aGlzLmNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4ICkgdGhpcy5jYW1lcmEudXBkYXRlUHJvamVjdGlvbk1hdHJpeCgpOwoKCQl0aGlzLm1hdHJpeCA9IGNhbWVyYS5tYXRyaXhXb3JsZDsKCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCgkJdGhpcy5wb2ludE1hcCA9IHBvaW50TWFwOwoKCQl0aGlzLnVwZGF0ZSgpOwoKCQkvLyBjb2xvcnMKCgkJY29uc3QgY29sb3JGcnVzdHVtID0gbmV3IENvbG9yKCAweGZmYWEwMCApOwoJCWNvbnN0IGNvbG9yQ29uZSA9IG5ldyBDb2xvciggMHhmZjAwMDAgKTsKCQljb25zdCBjb2xvclVwID0gbmV3IENvbG9yKCAweDAwYWFmZiApOwoJCWNvbnN0IGNvbG9yVGFyZ2V0ID0gbmV3IENvbG9yKCAweGZmZmZmZiApOwoJCWNvbnN0IGNvbG9yQ3Jvc3MgPSBuZXcgQ29sb3IoIDB4MzMzMzMzICk7CgoJCXRoaXMuc2V0Q29sb3JzKCBjb2xvckZydXN0dW0sIGNvbG9yQ29uZSwgY29sb3JVcCwgY29sb3JUYXJnZXQsIGNvbG9yQ3Jvc3MgKTsKCgl9CgoJc2V0Q29sb3JzKCBmcnVzdHVtLCBjb25lLCB1cCwgdGFyZ2V0LCBjcm9zcyApIHsKCgkJY29uc3QgZ2VvbWV0cnkgPSB0aGlzLmdlb21ldHJ5OwoKCQljb25zdCBjb2xvckF0dHJpYnV0ZSA9IGdlb21ldHJ5LmdldEF0dHJpYnV0ZSggJ2NvbG9yJyApOwoKCQkvLyBuZWFyCgoJCWNvbG9yQXR0cmlidXRlLnNldFhZWiggMCwgZnJ1c3R1bS5yLCBmcnVzdHVtLmcsIGZydXN0dW0uYiApOyBjb2xvckF0dHJpYnV0ZS5zZXRYWVooIDEsIGZydXN0dW0uciwgZnJ1c3R1bS5nLCBmcnVzdHVtLmIgKTsgLy8gbjEsIG4yCgkJY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAyLCBmcnVzdHVtLnIsIGZydXN0dW0uZywgZnJ1c3R1bS5iICk7IGNvbG9yQXR0cmlidXRlLnNldFhZWiggMywgZnJ1c3R1bS5yLCBmcnVzdHVtLmcsIGZydXN0dW0uYiApOyAvLyBuMiwgbjQKCQljb2xvckF0dHJpYnV0ZS5zZXRYWVooIDQsIGZydXN0dW0uciwgZnJ1c3R1bS5nLCBmcnVzdHVtLmIgKTsgY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCA1LCBmcnVzdHVtLnIsIGZydXN0dW0uZywgZnJ1c3R1bS5iICk7IC8vIG40LCBuMwoJCWNvbG9yQXR0cmlidXRlLnNldFhZWiggNiwgZnJ1c3R1bS5yLCBmcnVzdHVtLmcsIGZydXN0dW0uYiApOyBjb2xvckF0dHJpYnV0ZS5zZXRYWVooIDcsIGZydXN0dW0uciwgZnJ1c3R1bS5nLCBmcnVzdHVtLmIgKTsgLy8gbjMsIG4xCgoJCS8vIGZhcgoKCQljb2xvckF0dHJpYnV0ZS5zZXRYWVooIDgsIGZydXN0dW0uciwgZnJ1c3R1bS5nLCBmcnVzdHVtLmIgKTsgY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCA5LCBmcnVzdHVtLnIsIGZydXN0dW0uZywgZnJ1c3R1bS5iICk7IC8vIGYxLCBmMgoJCWNvbG9yQXR0cmlidXRlLnNldFhZWiggMTAsIGZydXN0dW0uciwgZnJ1c3R1bS5nLCBmcnVzdHVtLmIgKTsgY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAxMSwgZnJ1c3R1bS5yLCBmcnVzdHVtLmcsIGZydXN0dW0uYiApOyAvLyBmMiwgZjQKCQljb2xvckF0dHJpYnV0ZS5zZXRYWVooIDEyLCBmcnVzdHVtLnIsIGZydXN0dW0uZywgZnJ1c3R1bS5iICk7IGNvbG9yQXR0cmlidXRlLnNldFhZWiggMTMsIGZydXN0dW0uciwgZnJ1c3R1bS5nLCBmcnVzdHVtLmIgKTsgLy8gZjQsIGYzCgkJY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAxNCwgZnJ1c3R1bS5yLCBmcnVzdHVtLmcsIGZydXN0dW0uYiApOyBjb2xvckF0dHJpYnV0ZS5zZXRYWVooIDE1LCBmcnVzdHVtLnIsIGZydXN0dW0uZywgZnJ1c3R1bS5iICk7IC8vIGYzLCBmMQoKCQkvLyBzaWRlcwoKCQljb2xvckF0dHJpYnV0ZS5zZXRYWVooIDE2LCBmcnVzdHVtLnIsIGZydXN0dW0uZywgZnJ1c3R1bS5iICk7IGNvbG9yQXR0cmlidXRlLnNldFhZWiggMTcsIGZydXN0dW0uciwgZnJ1c3R1bS5nLCBmcnVzdHVtLmIgKTsgLy8gbjEsIGYxCgkJY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAxOCwgZnJ1c3R1bS5yLCBmcnVzdHVtLmcsIGZydXN0dW0uYiApOyBjb2xvckF0dHJpYnV0ZS5zZXRYWVooIDE5LCBmcnVzdHVtLnIsIGZydXN0dW0uZywgZnJ1c3R1bS5iICk7IC8vIG4yLCBmMgoJCWNvbG9yQXR0cmlidXRlLnNldFhZWiggMjAsIGZydXN0dW0uciwgZnJ1c3R1bS5nLCBmcnVzdHVtLmIgKTsgY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAyMSwgZnJ1c3R1bS5yLCBmcnVzdHVtLmcsIGZydXN0dW0uYiApOyAvLyBuMywgZjMKCQljb2xvckF0dHJpYnV0ZS5zZXRYWVooIDIyLCBmcnVzdHVtLnIsIGZydXN0dW0uZywgZnJ1c3R1bS5iICk7IGNvbG9yQXR0cmlidXRlLnNldFhZWiggMjMsIGZydXN0dW0uciwgZnJ1c3R1bS5nLCBmcnVzdHVtLmIgKTsgLy8gbjQsIGY0CgoJCS8vIGNvbmUKCgkJY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAyNCwgY29uZS5yLCBjb25lLmcsIGNvbmUuYiApOyBjb2xvckF0dHJpYnV0ZS5zZXRYWVooIDI1LCBjb25lLnIsIGNvbmUuZywgY29uZS5iICk7IC8vIHAsIG4xCgkJY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAyNiwgY29uZS5yLCBjb25lLmcsIGNvbmUuYiApOyBjb2xvckF0dHJpYnV0ZS5zZXRYWVooIDI3LCBjb25lLnIsIGNvbmUuZywgY29uZS5iICk7IC8vIHAsIG4yCgkJY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAyOCwgY29uZS5yLCBjb25lLmcsIGNvbmUuYiApOyBjb2xvckF0dHJpYnV0ZS5zZXRYWVooIDI5LCBjb25lLnIsIGNvbmUuZywgY29uZS5iICk7IC8vIHAsIG4zCgkJY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAzMCwgY29uZS5yLCBjb25lLmcsIGNvbmUuYiApOyBjb2xvckF0dHJpYnV0ZS5zZXRYWVooIDMxLCBjb25lLnIsIGNvbmUuZywgY29uZS5iICk7IC8vIHAsIG40CgoJCS8vIHVwCgoJCWNvbG9yQXR0cmlidXRlLnNldFhZWiggMzIsIHVwLnIsIHVwLmcsIHVwLmIgKTsgY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAzMywgdXAuciwgdXAuZywgdXAuYiApOyAvLyB1MSwgdTIKCQljb2xvckF0dHJpYnV0ZS5zZXRYWVooIDM0LCB1cC5yLCB1cC5nLCB1cC5iICk7IGNvbG9yQXR0cmlidXRlLnNldFhZWiggMzUsIHVwLnIsIHVwLmcsIHVwLmIgKTsgLy8gdTIsIHUzCgkJY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAzNiwgdXAuciwgdXAuZywgdXAuYiApOyBjb2xvckF0dHJpYnV0ZS5zZXRYWVooIDM3LCB1cC5yLCB1cC5nLCB1cC5iICk7IC8vIHUzLCB1MQoKCQkvLyB0YXJnZXQKCgkJY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCAzOCwgdGFyZ2V0LnIsIHRhcmdldC5nLCB0YXJnZXQuYiApOyBjb2xvckF0dHJpYnV0ZS5zZXRYWVooIDM5LCB0YXJnZXQuciwgdGFyZ2V0LmcsIHRhcmdldC5iICk7IC8vIGMsIHQKCQljb2xvckF0dHJpYnV0ZS5zZXRYWVooIDQwLCBjcm9zcy5yLCBjcm9zcy5nLCBjcm9zcy5iICk7IGNvbG9yQXR0cmlidXRlLnNldFhZWiggNDEsIGNyb3NzLnIsIGNyb3NzLmcsIGNyb3NzLmIgKTsgLy8gcCwgYwoKCQkvLyBjcm9zcwoKCQljb2xvckF0dHJpYnV0ZS5zZXRYWVooIDQyLCBjcm9zcy5yLCBjcm9zcy5nLCBjcm9zcy5iICk7IGNvbG9yQXR0cmlidXRlLnNldFhZWiggNDMsIGNyb3NzLnIsIGNyb3NzLmcsIGNyb3NzLmIgKTsgLy8gY24xLCBjbjIKCQljb2xvckF0dHJpYnV0ZS5zZXRYWVooIDQ0LCBjcm9zcy5yLCBjcm9zcy5nLCBjcm9zcy5iICk7IGNvbG9yQXR0cmlidXRlLnNldFhZWiggNDUsIGNyb3NzLnIsIGNyb3NzLmcsIGNyb3NzLmIgKTsgLy8gY24zLCBjbjQKCgkJY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCA0NiwgY3Jvc3MuciwgY3Jvc3MuZywgY3Jvc3MuYiApOyBjb2xvckF0dHJpYnV0ZS5zZXRYWVooIDQ3LCBjcm9zcy5yLCBjcm9zcy5nLCBjcm9zcy5iICk7IC8vIGNmMSwgY2YyCgkJY29sb3JBdHRyaWJ1dGUuc2V0WFlaKCA0OCwgY3Jvc3MuciwgY3Jvc3MuZywgY3Jvc3MuYiApOyBjb2xvckF0dHJpYnV0ZS5zZXRYWVooIDQ5LCBjcm9zcy5yLCBjcm9zcy5nLCBjcm9zcy5iICk7IC8vIGNmMywgY2Y0CgoJCWNvbG9yQXR0cmlidXRlLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgl9CgoJdXBkYXRlKCkgewoKCQljb25zdCBnZW9tZXRyeSA9IHRoaXMuZ2VvbWV0cnk7CgkJY29uc3QgcG9pbnRNYXAgPSB0aGlzLnBvaW50TWFwOwoKCQljb25zdCB3ID0gMSwgaCA9IDE7CgoJCS8vIHdlIG5lZWQganVzdCBjYW1lcmEgcHJvamVjdGlvbiBtYXRyaXggaW52ZXJzZQoJCS8vIHdvcmxkIG1hdHJpeCBtdXN0IGJlIGlkZW50aXR5CgoJCV9jYW1lcmEucHJvamVjdGlvbk1hdHJpeEludmVyc2UuY29weSggdGhpcy5jYW1lcmEucHJvamVjdGlvbk1hdHJpeEludmVyc2UgKTsKCgkJLy8gY2VudGVyIC8gdGFyZ2V0CgoJCXNldFBvaW50KCAnYycsIHBvaW50TWFwLCBnZW9tZXRyeSwgX2NhbWVyYSwgMCwgMCwgLSAxICk7CgkJc2V0UG9pbnQoICd0JywgcG9pbnRNYXAsIGdlb21ldHJ5LCBfY2FtZXJhLCAwLCAwLCAxICk7CgoJCS8vIG5lYXIKCgkJc2V0UG9pbnQoICduMScsIHBvaW50TWFwLCBnZW9tZXRyeSwgX2NhbWVyYSwgLSB3LCAtIGgsIC0gMSApOwoJCXNldFBvaW50KCAnbjInLCBwb2ludE1hcCwgZ2VvbWV0cnksIF9jYW1lcmEsIHcsIC0gaCwgLSAxICk7CgkJc2V0UG9pbnQoICduMycsIHBvaW50TWFwLCBnZW9tZXRyeSwgX2NhbWVyYSwgLSB3LCBoLCAtIDEgKTsKCQlzZXRQb2ludCggJ240JywgcG9pbnRNYXAsIGdlb21ldHJ5LCBfY2FtZXJhLCB3LCBoLCAtIDEgKTsKCgkJLy8gZmFyCgoJCXNldFBvaW50KCAnZjEnLCBwb2ludE1hcCwgZ2VvbWV0cnksIF9jYW1lcmEsIC0gdywgLSBoLCAxICk7CgkJc2V0UG9pbnQoICdmMicsIHBvaW50TWFwLCBnZW9tZXRyeSwgX2NhbWVyYSwgdywgLSBoLCAxICk7CgkJc2V0UG9pbnQoICdmMycsIHBvaW50TWFwLCBnZW9tZXRyeSwgX2NhbWVyYSwgLSB3LCBoLCAxICk7CgkJc2V0UG9pbnQoICdmNCcsIHBvaW50TWFwLCBnZW9tZXRyeSwgX2NhbWVyYSwgdywgaCwgMSApOwoKCQkvLyB1cAoKCQlzZXRQb2ludCggJ3UxJywgcG9pbnRNYXAsIGdlb21ldHJ5LCBfY2FtZXJhLCB3ICogMC43LCBoICogMS4xLCAtIDEgKTsKCQlzZXRQb2ludCggJ3UyJywgcG9pbnRNYXAsIGdlb21ldHJ5LCBfY2FtZXJhLCAtIHcgKiAwLjcsIGggKiAxLjEsIC0gMSApOwoJCXNldFBvaW50KCAndTMnLCBwb2ludE1hcCwgZ2VvbWV0cnksIF9jYW1lcmEsIDAsIGggKiAyLCAtIDEgKTsKCgkJLy8gY3Jvc3MKCgkJc2V0UG9pbnQoICdjZjEnLCBwb2ludE1hcCwgZ2VvbWV0cnksIF9jYW1lcmEsIC0gdywgMCwgMSApOwoJCXNldFBvaW50KCAnY2YyJywgcG9pbnRNYXAsIGdlb21ldHJ5LCBfY2FtZXJhLCB3LCAwLCAxICk7CgkJc2V0UG9pbnQoICdjZjMnLCBwb2ludE1hcCwgZ2VvbWV0cnksIF9jYW1lcmEsIDAsIC0gaCwgMSApOwoJCXNldFBvaW50KCAnY2Y0JywgcG9pbnRNYXAsIGdlb21ldHJ5LCBfY2FtZXJhLCAwLCBoLCAxICk7CgoJCXNldFBvaW50KCAnY24xJywgcG9pbnRNYXAsIGdlb21ldHJ5LCBfY2FtZXJhLCAtIHcsIDAsIC0gMSApOwoJCXNldFBvaW50KCAnY24yJywgcG9pbnRNYXAsIGdlb21ldHJ5LCBfY2FtZXJhLCB3LCAwLCAtIDEgKTsKCQlzZXRQb2ludCggJ2NuMycsIHBvaW50TWFwLCBnZW9tZXRyeSwgX2NhbWVyYSwgMCwgLSBoLCAtIDEgKTsKCQlzZXRQb2ludCggJ2NuNCcsIHBvaW50TWFwLCBnZW9tZXRyeSwgX2NhbWVyYSwgMCwgaCwgLSAxICk7CgoJCWdlb21ldHJ5LmdldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJyApLm5lZWRzVXBkYXRlID0gdHJ1ZTsKCgl9CgoJZGlzcG9zZSgpIHsKCgkJdGhpcy5nZW9tZXRyeS5kaXNwb3NlKCk7CgkJdGhpcy5tYXRlcmlhbC5kaXNwb3NlKCk7CgoJfQoKfQoKCmZ1bmN0aW9uIHNldFBvaW50KCBwb2ludCwgcG9pbnRNYXAsIGdlb21ldHJ5LCBjYW1lcmEsIHgsIHksIHogKSB7CgoJX3ZlY3Rvci5zZXQoIHgsIHksIHogKS51bnByb2plY3QoIGNhbWVyYSApOwoKCWNvbnN0IHBvaW50cyA9IHBvaW50TWFwWyBwb2ludCBdOwoKCWlmICggcG9pbnRzICE9PSB1bmRlZmluZWQgKSB7CgoJCWNvbnN0IHBvc2l0aW9uID0gZ2VvbWV0cnkuZ2V0QXR0cmlidXRlKCAncG9zaXRpb24nICk7CgoJCWZvciAoIGxldCBpID0gMCwgbCA9IHBvaW50cy5sZW5ndGg7IGkgPCBsOyBpICsrICkgewoKCQkJcG9zaXRpb24uc2V0WFlaKCBwb2ludHNbIGkgXSwgX3ZlY3Rvci54LCBfdmVjdG9yLnksIF92ZWN0b3IueiApOwoKCQl9CgoJfQoKfQoKY29uc3QgX2JveCA9IC8qQF9fUFVSRV9fKi8gbmV3IEJveDMoKTsKCmNsYXNzIEJveEhlbHBlciBleHRlbmRzIExpbmVTZWdtZW50cyB7CgoJY29uc3RydWN0b3IoIG9iamVjdCwgY29sb3IgPSAweGZmZmYwMCApIHsKCgkJY29uc3QgaW5kaWNlcyA9IG5ldyBVaW50MTZBcnJheSggWyAwLCAxLCAxLCAyLCAyLCAzLCAzLCAwLCA0LCA1LCA1LCA2LCA2LCA3LCA3LCA0LCAwLCA0LCAxLCA1LCAyLCA2LCAzLCA3IF0gKTsKCQljb25zdCBwb3NpdGlvbnMgPSBuZXcgRmxvYXQzMkFycmF5KCA4ICogMyApOwoKCQljb25zdCBnZW9tZXRyeSA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoJCWdlb21ldHJ5LnNldEluZGV4KCBuZXcgQnVmZmVyQXR0cmlidXRlKCBpbmRpY2VzLCAxICkgKTsKCQlnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBCdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9ucywgMyApICk7CgoJCXN1cGVyKCBnZW9tZXRyeSwgbmV3IExpbmVCYXNpY01hdGVyaWFsKCB7IGNvbG9yOiBjb2xvciwgdG9uZU1hcHBlZDogZmFsc2UgfSApICk7CgoJCXRoaXMub2JqZWN0ID0gb2JqZWN0OwoJCXRoaXMudHlwZSA9ICdCb3hIZWxwZXInOwoKCQl0aGlzLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCgkJdGhpcy51cGRhdGUoKTsKCgl9CgoJdXBkYXRlKCBvYmplY3QgKSB7CgoJCWlmICggb2JqZWN0ICE9PSB1bmRlZmluZWQgKSB7CgoJCQljb25zb2xlLndhcm4oICdUSFJFRS5Cb3hIZWxwZXI6IC51cGRhdGUoKSBoYXMgbm8gbG9uZ2VyIGFyZ3VtZW50cy4nICk7CgoJCX0KCgkJaWYgKCB0aGlzLm9iamVjdCAhPT0gdW5kZWZpbmVkICkgewoKCQkJX2JveC5zZXRGcm9tT2JqZWN0KCB0aGlzLm9iamVjdCApOwoKCQl9CgoJCWlmICggX2JveC5pc0VtcHR5KCkgKSByZXR1cm47CgoJCWNvbnN0IG1pbiA9IF9ib3gubWluOwoJCWNvbnN0IG1heCA9IF9ib3gubWF4OwoKCQkvKgoJCQk1X19fXzQKCQkxL19fXzAvfAoJCXwgNl9ffF83CgkJMi9fX18zLwoKCQkwOiBtYXgueCwgbWF4LnksIG1heC56CgkJMTogbWluLngsIG1heC55LCBtYXguegoJCTI6IG1pbi54LCBtaW4ueSwgbWF4LnoKCQkzOiBtYXgueCwgbWluLnksIG1heC56CgkJNDogbWF4LngsIG1heC55LCBtaW4uegoJCTU6IG1pbi54LCBtYXgueSwgbWluLnoKCQk2OiBtaW4ueCwgbWluLnksIG1pbi56CgkJNzogbWF4LngsIG1pbi55LCBtaW4uegoJCSovCgoJCWNvbnN0IHBvc2l0aW9uID0gdGhpcy5nZW9tZXRyeS5hdHRyaWJ1dGVzLnBvc2l0aW9uOwoJCWNvbnN0IGFycmF5ID0gcG9zaXRpb24uYXJyYXk7CgoJCWFycmF5WyAwIF0gPSBtYXgueDsgYXJyYXlbIDEgXSA9IG1heC55OyBhcnJheVsgMiBdID0gbWF4Lno7CgkJYXJyYXlbIDMgXSA9IG1pbi54OyBhcnJheVsgNCBdID0gbWF4Lnk7IGFycmF5WyA1IF0gPSBtYXguejsKCQlhcnJheVsgNiBdID0gbWluLng7IGFycmF5WyA3IF0gPSBtaW4ueTsgYXJyYXlbIDggXSA9IG1heC56OwoJCWFycmF5WyA5IF0gPSBtYXgueDsgYXJyYXlbIDEwIF0gPSBtaW4ueTsgYXJyYXlbIDExIF0gPSBtYXguejsKCQlhcnJheVsgMTIgXSA9IG1heC54OyBhcnJheVsgMTMgXSA9IG1heC55OyBhcnJheVsgMTQgXSA9IG1pbi56OwoJCWFycmF5WyAxNSBdID0gbWluLng7IGFycmF5WyAxNiBdID0gbWF4Lnk7IGFycmF5WyAxNyBdID0gbWluLno7CgkJYXJyYXlbIDE4IF0gPSBtaW4ueDsgYXJyYXlbIDE5IF0gPSBtaW4ueTsgYXJyYXlbIDIwIF0gPSBtaW4uejsKCQlhcnJheVsgMjEgXSA9IG1heC54OyBhcnJheVsgMjIgXSA9IG1pbi55OyBhcnJheVsgMjMgXSA9IG1pbi56OwoKCQlwb3NpdGlvbi5uZWVkc1VwZGF0ZSA9IHRydWU7CgoJCXRoaXMuZ2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgoJfQoKCXNldEZyb21PYmplY3QoIG9iamVjdCApIHsKCgkJdGhpcy5vYmplY3QgPSBvYmplY3Q7CgkJdGhpcy51cGRhdGUoKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCWNvcHkoIHNvdXJjZSwgcmVjdXJzaXZlICkgewoKCQlzdXBlci5jb3B5KCBzb3VyY2UsIHJlY3Vyc2l2ZSApOwoKCQl0aGlzLm9iamVjdCA9IHNvdXJjZS5vYmplY3Q7CgoJCXJldHVybiB0aGlzOwoKCX0KCglkaXNwb3NlKCkgewoKCQl0aGlzLmdlb21ldHJ5LmRpc3Bvc2UoKTsKCQl0aGlzLm1hdGVyaWFsLmRpc3Bvc2UoKTsKCgl9Cgp9CgpjbGFzcyBCb3gzSGVscGVyIGV4dGVuZHMgTGluZVNlZ21lbnRzIHsKCgljb25zdHJ1Y3RvciggYm94LCBjb2xvciA9IDB4ZmZmZjAwICkgewoKCQljb25zdCBpbmRpY2VzID0gbmV3IFVpbnQxNkFycmF5KCBbIDAsIDEsIDEsIDIsIDIsIDMsIDMsIDAsIDQsIDUsIDUsIDYsIDYsIDcsIDcsIDQsIDAsIDQsIDEsIDUsIDIsIDYsIDMsIDcgXSApOwoKCQljb25zdCBwb3NpdGlvbnMgPSBbIDEsIDEsIDEsIC0gMSwgMSwgMSwgLSAxLCAtIDEsIDEsIDEsIC0gMSwgMSwgMSwgMSwgLSAxLCAtIDEsIDEsIC0gMSwgLSAxLCAtIDEsIC0gMSwgMSwgLSAxLCAtIDEgXTsKCgkJY29uc3QgZ2VvbWV0cnkgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCgkJZ2VvbWV0cnkuc2V0SW5kZXgoIG5ldyBCdWZmZXJBdHRyaWJ1dGUoIGluZGljZXMsIDEgKSApOwoKCQlnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoICdwb3NpdGlvbicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBwb3NpdGlvbnMsIDMgKSApOwoKCQlzdXBlciggZ2VvbWV0cnksIG5ldyBMaW5lQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogY29sb3IsIHRvbmVNYXBwZWQ6IGZhbHNlIH0gKSApOwoKCQl0aGlzLmJveCA9IGJveDsKCgkJdGhpcy50eXBlID0gJ0JveDNIZWxwZXInOwoKCQl0aGlzLmdlb21ldHJ5LmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoKCX0KCgl1cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKSB7CgoJCWNvbnN0IGJveCA9IHRoaXMuYm94OwoKCQlpZiAoIGJveC5pc0VtcHR5KCkgKSByZXR1cm47CgoJCWJveC5nZXRDZW50ZXIoIHRoaXMucG9zaXRpb24gKTsKCgkJYm94LmdldFNpemUoIHRoaXMuc2NhbGUgKTsKCgkJdGhpcy5zY2FsZS5tdWx0aXBseVNjYWxhciggMC41ICk7CgoJCXN1cGVyLnVwZGF0ZU1hdHJpeFdvcmxkKCBmb3JjZSApOwoKCX0KCglkaXNwb3NlKCkgewoKCQl0aGlzLmdlb21ldHJ5LmRpc3Bvc2UoKTsKCQl0aGlzLm1hdGVyaWFsLmRpc3Bvc2UoKTsKCgl9Cgp9CgpjbGFzcyBQbGFuZUhlbHBlciBleHRlbmRzIExpbmUgewoKCWNvbnN0cnVjdG9yKCBwbGFuZSwgc2l6ZSA9IDEsIGhleCA9IDB4ZmZmZjAwICkgewoKCQljb25zdCBjb2xvciA9IGhleDsKCgkJY29uc3QgcG9zaXRpb25zID0gWyAxLCAtIDEsIDAsIC0gMSwgMSwgMCwgLSAxLCAtIDEsIDAsIDEsIDEsIDAsIC0gMSwgMSwgMCwgLSAxLCAtIDEsIDAsIDEsIC0gMSwgMCwgMSwgMSwgMCBdOwoKCQljb25zdCBnZW9tZXRyeSA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoJCWdlb21ldHJ5LnNldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHBvc2l0aW9ucywgMyApICk7CgkJZ2VvbWV0cnkuY29tcHV0ZUJvdW5kaW5nU3BoZXJlKCk7CgoJCXN1cGVyKCBnZW9tZXRyeSwgbmV3IExpbmVCYXNpY01hdGVyaWFsKCB7IGNvbG9yOiBjb2xvciwgdG9uZU1hcHBlZDogZmFsc2UgfSApICk7CgoJCXRoaXMudHlwZSA9ICdQbGFuZUhlbHBlcic7CgoJCXRoaXMucGxhbmUgPSBwbGFuZTsKCgkJdGhpcy5zaXplID0gc2l6ZTsKCgkJY29uc3QgcG9zaXRpb25zMiA9IFsgMSwgMSwgMCwgLSAxLCAxLCAwLCAtIDEsIC0gMSwgMCwgMSwgMSwgMCwgLSAxLCAtIDEsIDAsIDEsIC0gMSwgMCBdOwoKCQljb25zdCBnZW9tZXRyeTIgPSBuZXcgQnVmZmVyR2VvbWV0cnkoKTsKCQlnZW9tZXRyeTIuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggcG9zaXRpb25zMiwgMyApICk7CgkJZ2VvbWV0cnkyLmNvbXB1dGVCb3VuZGluZ1NwaGVyZSgpOwoKCQl0aGlzLmFkZCggbmV3IE1lc2goIGdlb21ldHJ5MiwgbmV3IE1lc2hCYXNpY01hdGVyaWFsKCB7IGNvbG9yOiBjb2xvciwgb3BhY2l0eTogMC4yLCB0cmFuc3BhcmVudDogdHJ1ZSwgZGVwdGhXcml0ZTogZmFsc2UsIHRvbmVNYXBwZWQ6IGZhbHNlIH0gKSApICk7CgoJfQoKCXVwZGF0ZU1hdHJpeFdvcmxkKCBmb3JjZSApIHsKCgkJdGhpcy5wb3NpdGlvbi5zZXQoIDAsIDAsIDAgKTsKCgkJdGhpcy5zY2FsZS5zZXQoIDAuNSAqIHRoaXMuc2l6ZSwgMC41ICogdGhpcy5zaXplLCAxICk7CgoJCXRoaXMubG9va0F0KCB0aGlzLnBsYW5lLm5vcm1hbCApOwoKCQl0aGlzLnRyYW5zbGF0ZVooIC0gdGhpcy5wbGFuZS5jb25zdGFudCApOwoKCQlzdXBlci51cGRhdGVNYXRyaXhXb3JsZCggZm9yY2UgKTsKCgl9CgoJZGlzcG9zZSgpIHsKCgkJdGhpcy5nZW9tZXRyeS5kaXNwb3NlKCk7CgkJdGhpcy5tYXRlcmlhbC5kaXNwb3NlKCk7CgkJdGhpcy5jaGlsZHJlblsgMCBdLmdlb21ldHJ5LmRpc3Bvc2UoKTsKCQl0aGlzLmNoaWxkcmVuWyAwIF0ubWF0ZXJpYWwuZGlzcG9zZSgpOwoKCX0KCn0KCmNvbnN0IF9heGlzID0gLypAX19QVVJFX18qLyBuZXcgVmVjdG9yMygpOwpsZXQgX2xpbmVHZW9tZXRyeSwgX2NvbmVHZW9tZXRyeTsKCmNsYXNzIEFycm93SGVscGVyIGV4dGVuZHMgT2JqZWN0M0QgewoKCS8vIGRpciBpcyBhc3N1bWVkIHRvIGJlIG5vcm1hbGl6ZWQKCgljb25zdHJ1Y3RvciggZGlyID0gbmV3IFZlY3RvcjMoIDAsIDAsIDEgKSwgb3JpZ2luID0gbmV3IFZlY3RvcjMoIDAsIDAsIDAgKSwgbGVuZ3RoID0gMSwgY29sb3IgPSAweGZmZmYwMCwgaGVhZExlbmd0aCA9IGxlbmd0aCAqIDAuMiwgaGVhZFdpZHRoID0gaGVhZExlbmd0aCAqIDAuMiApIHsKCgkJc3VwZXIoKTsKCgkJdGhpcy50eXBlID0gJ0Fycm93SGVscGVyJzsKCgkJaWYgKCBfbGluZUdlb21ldHJ5ID09PSB1bmRlZmluZWQgKSB7CgoJCQlfbGluZUdlb21ldHJ5ID0gbmV3IEJ1ZmZlckdlb21ldHJ5KCk7CgkJCV9saW5lR2VvbWV0cnkuc2V0QXR0cmlidXRlKCAncG9zaXRpb24nLCBuZXcgRmxvYXQzMkJ1ZmZlckF0dHJpYnV0ZSggWyAwLCAwLCAwLCAwLCAxLCAwIF0sIDMgKSApOwoKCQkJX2NvbmVHZW9tZXRyeSA9IG5ldyBDeWxpbmRlckdlb21ldHJ5KCAwLCAwLjUsIDEsIDUsIDEgKTsKCQkJX2NvbmVHZW9tZXRyeS50cmFuc2xhdGUoIDAsIC0gMC41LCAwICk7CgoJCX0KCgkJdGhpcy5wb3NpdGlvbi5jb3B5KCBvcmlnaW4gKTsKCgkJdGhpcy5saW5lID0gbmV3IExpbmUoIF9saW5lR2VvbWV0cnksIG5ldyBMaW5lQmFzaWNNYXRlcmlhbCggeyBjb2xvcjogY29sb3IsIHRvbmVNYXBwZWQ6IGZhbHNlIH0gKSApOwoJCXRoaXMubGluZS5tYXRyaXhBdXRvVXBkYXRlID0gZmFsc2U7CgkJdGhpcy5hZGQoIHRoaXMubGluZSApOwoKCQl0aGlzLmNvbmUgPSBuZXcgTWVzaCggX2NvbmVHZW9tZXRyeSwgbmV3IE1lc2hCYXNpY01hdGVyaWFsKCB7IGNvbG9yOiBjb2xvciwgdG9uZU1hcHBlZDogZmFsc2UgfSApICk7CgkJdGhpcy5jb25lLm1hdHJpeEF1dG9VcGRhdGUgPSBmYWxzZTsKCQl0aGlzLmFkZCggdGhpcy5jb25lICk7CgoJCXRoaXMuc2V0RGlyZWN0aW9uKCBkaXIgKTsKCQl0aGlzLnNldExlbmd0aCggbGVuZ3RoLCBoZWFkTGVuZ3RoLCBoZWFkV2lkdGggKTsKCgl9CgoJc2V0RGlyZWN0aW9uKCBkaXIgKSB7CgoJCS8vIGRpciBpcyBhc3N1bWVkIHRvIGJlIG5vcm1hbGl6ZWQKCgkJaWYgKCBkaXIueSA+IDAuOTk5OTkgKSB7CgoJCQl0aGlzLnF1YXRlcm5pb24uc2V0KCAwLCAwLCAwLCAxICk7CgoJCX0gZWxzZSBpZiAoIGRpci55IDwgLSAwLjk5OTk5ICkgewoKCQkJdGhpcy5xdWF0ZXJuaW9uLnNldCggMSwgMCwgMCwgMCApOwoKCQl9IGVsc2UgewoKCQkJX2F4aXMuc2V0KCBkaXIueiwgMCwgLSBkaXIueCApLm5vcm1hbGl6ZSgpOwoKCQkJY29uc3QgcmFkaWFucyA9IE1hdGguYWNvcyggZGlyLnkgKTsKCgkJCXRoaXMucXVhdGVybmlvbi5zZXRGcm9tQXhpc0FuZ2xlKCBfYXhpcywgcmFkaWFucyApOwoKCQl9CgoJfQoKCXNldExlbmd0aCggbGVuZ3RoLCBoZWFkTGVuZ3RoID0gbGVuZ3RoICogMC4yLCBoZWFkV2lkdGggPSBoZWFkTGVuZ3RoICogMC4yICkgewoKCQl0aGlzLmxpbmUuc2NhbGUuc2V0KCAxLCBNYXRoLm1heCggMC4wMDAxLCBsZW5ndGggLSBoZWFkTGVuZ3RoICksIDEgKTsgLy8gc2VlICMxNzQ1OAoJCXRoaXMubGluZS51cGRhdGVNYXRyaXgoKTsKCgkJdGhpcy5jb25lLnNjYWxlLnNldCggaGVhZFdpZHRoLCBoZWFkTGVuZ3RoLCBoZWFkV2lkdGggKTsKCQl0aGlzLmNvbmUucG9zaXRpb24ueSA9IGxlbmd0aDsKCQl0aGlzLmNvbmUudXBkYXRlTWF0cml4KCk7CgoJfQoKCXNldENvbG9yKCBjb2xvciApIHsKCgkJdGhpcy5saW5lLm1hdGVyaWFsLmNvbG9yLnNldCggY29sb3IgKTsKCQl0aGlzLmNvbmUubWF0ZXJpYWwuY29sb3Iuc2V0KCBjb2xvciApOwoKCX0KCgljb3B5KCBzb3VyY2UgKSB7CgoJCXN1cGVyLmNvcHkoIHNvdXJjZSwgZmFsc2UgKTsKCgkJdGhpcy5saW5lLmNvcHkoIHNvdXJjZS5saW5lICk7CgkJdGhpcy5jb25lLmNvcHkoIHNvdXJjZS5jb25lICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglkaXNwb3NlKCkgewoKCQl0aGlzLmxpbmUuZ2VvbWV0cnkuZGlzcG9zZSgpOwoJCXRoaXMubGluZS5tYXRlcmlhbC5kaXNwb3NlKCk7CgkJdGhpcy5jb25lLmdlb21ldHJ5LmRpc3Bvc2UoKTsKCQl0aGlzLmNvbmUubWF0ZXJpYWwuZGlzcG9zZSgpOwoKCX0KCn0KCmNsYXNzIEF4ZXNIZWxwZXIgZXh0ZW5kcyBMaW5lU2VnbWVudHMgewoKCWNvbnN0cnVjdG9yKCBzaXplID0gMSApIHsKCgkJY29uc3QgdmVydGljZXMgPSBbCgkJCTAsIDAsIDAsCXNpemUsIDAsIDAsCgkJCTAsIDAsIDAsCTAsIHNpemUsIDAsCgkJCTAsIDAsIDAsCTAsIDAsIHNpemUKCQldOwoKCQljb25zdCBjb2xvcnMgPSBbCgkJCTEsIDAsIDAsCTEsIDAuNiwgMCwKCQkJMCwgMSwgMCwJMC42LCAxLCAwLAoJCQkwLCAwLCAxLAkwLCAwLjYsIDEKCQldOwoKCQljb25zdCBnZW9tZXRyeSA9IG5ldyBCdWZmZXJHZW9tZXRyeSgpOwoJCWdlb21ldHJ5LnNldEF0dHJpYnV0ZSggJ3Bvc2l0aW9uJywgbmV3IEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUoIHZlcnRpY2VzLCAzICkgKTsKCQlnZW9tZXRyeS5zZXRBdHRyaWJ1dGUoICdjb2xvcicsIG5ldyBGbG9hdDMyQnVmZmVyQXR0cmlidXRlKCBjb2xvcnMsIDMgKSApOwoKCQljb25zdCBtYXRlcmlhbCA9IG5ldyBMaW5lQmFzaWNNYXRlcmlhbCggeyB2ZXJ0ZXhDb2xvcnM6IHRydWUsIHRvbmVNYXBwZWQ6IGZhbHNlIH0gKTsKCgkJc3VwZXIoIGdlb21ldHJ5LCBtYXRlcmlhbCApOwoKCQl0aGlzLnR5cGUgPSAnQXhlc0hlbHBlcic7CgoJfQoKCXNldENvbG9ycyggeEF4aXNDb2xvciwgeUF4aXNDb2xvciwgekF4aXNDb2xvciApIHsKCgkJY29uc3QgY29sb3IgPSBuZXcgQ29sb3IoKTsKCQljb25zdCBhcnJheSA9IHRoaXMuZ2VvbWV0cnkuYXR0cmlidXRlcy5jb2xvci5hcnJheTsKCgkJY29sb3Iuc2V0KCB4QXhpc0NvbG9yICk7CgkJY29sb3IudG9BcnJheSggYXJyYXksIDAgKTsKCQljb2xvci50b0FycmF5KCBhcnJheSwgMyApOwoKCQljb2xvci5zZXQoIHlBeGlzQ29sb3IgKTsKCQljb2xvci50b0FycmF5KCBhcnJheSwgNiApOwoJCWNvbG9yLnRvQXJyYXkoIGFycmF5LCA5ICk7CgoJCWNvbG9yLnNldCggekF4aXNDb2xvciApOwoJCWNvbG9yLnRvQXJyYXkoIGFycmF5LCAxMiApOwoJCWNvbG9yLnRvQXJyYXkoIGFycmF5LCAxNSApOwoKCQl0aGlzLmdlb21ldHJ5LmF0dHJpYnV0ZXMuY29sb3IubmVlZHNVcGRhdGUgPSB0cnVlOwoKCQlyZXR1cm4gdGhpczsKCgl9CgoJZGlzcG9zZSgpIHsKCgkJdGhpcy5nZW9tZXRyeS5kaXNwb3NlKCk7CgkJdGhpcy5tYXRlcmlhbC5kaXNwb3NlKCk7CgoJfQoKfQoKY2xhc3MgU2hhcGVQYXRoIHsKCgljb25zdHJ1Y3RvcigpIHsKCgkJdGhpcy50eXBlID0gJ1NoYXBlUGF0aCc7CgoJCXRoaXMuY29sb3IgPSBuZXcgQ29sb3IoKTsKCgkJdGhpcy5zdWJQYXRocyA9IFtdOwoJCXRoaXMuY3VycmVudFBhdGggPSBudWxsOwoKCX0KCgltb3ZlVG8oIHgsIHkgKSB7CgoJCXRoaXMuY3VycmVudFBhdGggPSBuZXcgUGF0aCgpOwoJCXRoaXMuc3ViUGF0aHMucHVzaCggdGhpcy5jdXJyZW50UGF0aCApOwoJCXRoaXMuY3VycmVudFBhdGgubW92ZVRvKCB4LCB5ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglsaW5lVG8oIHgsIHkgKSB7CgoJCXRoaXMuY3VycmVudFBhdGgubGluZVRvKCB4LCB5ICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCglxdWFkcmF0aWNDdXJ2ZVRvKCBhQ1B4LCBhQ1B5LCBhWCwgYVkgKSB7CgoJCXRoaXMuY3VycmVudFBhdGgucXVhZHJhdGljQ3VydmVUbyggYUNQeCwgYUNQeSwgYVgsIGFZICk7CgoJCXJldHVybiB0aGlzOwoKCX0KCgliZXppZXJDdXJ2ZVRvKCBhQ1AxeCwgYUNQMXksIGFDUDJ4LCBhQ1AyeSwgYVgsIGFZICkgewoKCQl0aGlzLmN1cnJlbnRQYXRoLmJlemllckN1cnZlVG8oIGFDUDF4LCBhQ1AxeSwgYUNQMngsIGFDUDJ5LCBhWCwgYVkgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXNwbGluZVRocnUoIHB0cyApIHsKCgkJdGhpcy5jdXJyZW50UGF0aC5zcGxpbmVUaHJ1KCBwdHMgKTsKCgkJcmV0dXJuIHRoaXM7CgoJfQoKCXRvU2hhcGVzKCBpc0NDVyApIHsKCgkJZnVuY3Rpb24gdG9TaGFwZXNOb0hvbGVzKCBpblN1YnBhdGhzICkgewoKCQkJY29uc3Qgc2hhcGVzID0gW107CgoJCQlmb3IgKCBsZXQgaSA9IDAsIGwgPSBpblN1YnBhdGhzLmxlbmd0aDsgaSA8IGw7IGkgKysgKSB7CgoJCQkJY29uc3QgdG1wUGF0aCA9IGluU3VicGF0aHNbIGkgXTsKCgkJCQljb25zdCB0bXBTaGFwZSA9IG5ldyBTaGFwZSgpOwoJCQkJdG1wU2hhcGUuY3VydmVzID0gdG1wUGF0aC5jdXJ2ZXM7CgoJCQkJc2hhcGVzLnB1c2goIHRtcFNoYXBlICk7CgoJCQl9CgoJCQlyZXR1cm4gc2hhcGVzOwoKCQl9CgoJCWZ1bmN0aW9uIGlzUG9pbnRJbnNpZGVQb2x5Z29uKCBpblB0LCBpblBvbHlnb24gKSB7CgoJCQljb25zdCBwb2x5TGVuID0gaW5Qb2x5Z29uLmxlbmd0aDsKCgkJCS8vIGluUHQgb24gcG9seWdvbiBjb250b3VyID0+IGltbWVkaWF0ZSBzdWNjZXNzICAgIG9yCgkJCS8vIHRvZ2dsaW5nIG9mIGluc2lkZS9vdXRzaWRlIGF0IGV2ZXJ5IHNpbmdsZSEgaW50ZXJzZWN0aW9uIHBvaW50IG9mIGFuIGVkZ2UKCQkJLy8gIHdpdGggdGhlIGhvcml6b250YWwgbGluZSB0aHJvdWdoIGluUHQsIGxlZnQgb2YgaW5QdAoJCQkvLyAgbm90IGNvdW50aW5nIGxvd2VyWSBlbmRwb2ludHMgb2YgZWRnZXMgYW5kIHdob2xlIGVkZ2VzIG9uIHRoYXQgbGluZQoJCQlsZXQgaW5zaWRlID0gZmFsc2U7CgkJCWZvciAoIGxldCBwID0gcG9seUxlbiAtIDEsIHEgPSAwOyBxIDwgcG9seUxlbjsgcCA9IHEgKysgKSB7CgoJCQkJbGV0IGVkZ2VMb3dQdCA9IGluUG9seWdvblsgcCBdOwoJCQkJbGV0IGVkZ2VIaWdoUHQgPSBpblBvbHlnb25bIHEgXTsKCgkJCQlsZXQgZWRnZUR4ID0gZWRnZUhpZ2hQdC54IC0gZWRnZUxvd1B0Lng7CgkJCQlsZXQgZWRnZUR5ID0gZWRnZUhpZ2hQdC55IC0gZWRnZUxvd1B0Lnk7CgoJCQkJaWYgKCBNYXRoLmFicyggZWRnZUR5ICkgPiBOdW1iZXIuRVBTSUxPTiApIHsKCgkJCQkJLy8gbm90IHBhcmFsbGVsCgkJCQkJaWYgKCBlZGdlRHkgPCAwICkgewoKCQkJCQkJZWRnZUxvd1B0ID0gaW5Qb2x5Z29uWyBxIF07IGVkZ2VEeCA9IC0gZWRnZUR4OwoJCQkJCQllZGdlSGlnaFB0ID0gaW5Qb2x5Z29uWyBwIF07IGVkZ2VEeSA9IC0gZWRnZUR5OwoKCQkJCQl9CgoJCQkJCWlmICggKCBpblB0LnkgPCBlZGdlTG93UHQueSApIHx8ICggaW5QdC55ID4gZWRnZUhpZ2hQdC55ICkgKSAJCWNvbnRpbnVlOwoKCQkJCQlpZiAoIGluUHQueSA9PT0gZWRnZUxvd1B0LnkgKSB7CgoJCQkJCQlpZiAoIGluUHQueCA9PT0gZWRnZUxvd1B0LnggKQkJcmV0dXJuCXRydWU7CQkvLyBpblB0IGlzIG9uIGNvbnRvdXIgPwoJCQkJCQkvLyBjb250aW51ZTsJCQkJLy8gbm8gaW50ZXJzZWN0aW9uIG9yIGVkZ2VMb3dQdCA9PiBkb2Vzbid0IGNvdW50ICEhIQoKCQkJCQl9IGVsc2UgewoKCQkJCQkJY29uc3QgcGVycEVkZ2UgPSBlZGdlRHkgKiAoIGluUHQueCAtIGVkZ2VMb3dQdC54ICkgLSBlZGdlRHggKiAoIGluUHQueSAtIGVkZ2VMb3dQdC55ICk7CgkJCQkJCWlmICggcGVycEVkZ2UgPT09IDAgKQkJCQlyZXR1cm4JdHJ1ZTsJCS8vIGluUHQgaXMgb24gY29udG91ciA/CgkJCQkJCWlmICggcGVycEVkZ2UgPCAwICkgCQkJCWNvbnRpbnVlOwoJCQkJCQlpbnNpZGUgPSAhIGluc2lkZTsJCS8vIHRydWUgaW50ZXJzZWN0aW9uIGxlZnQgb2YgaW5QdAoKCQkJCQl9CgoJCQkJfSBlbHNlIHsKCgkJCQkJLy8gcGFyYWxsZWwgb3IgY29sbGluZWFyCgkJCQkJaWYgKCBpblB0LnkgIT09IGVkZ2VMb3dQdC55ICkgCQljb250aW51ZTsJCQkvLyBwYXJhbGxlbAoJCQkJCS8vIGVkZ2UgbGllcyBvbiB0aGUgc2FtZSBob3Jpem9udGFsIGxpbmUgYXMgaW5QdAoJCQkJCWlmICggKCAoIGVkZ2VIaWdoUHQueCA8PSBpblB0LnggKSAmJiAoIGluUHQueCA8PSBlZGdlTG93UHQueCApICkgfHwKCQkJCQkJICggKCBlZGdlTG93UHQueCA8PSBpblB0LnggKSAmJiAoIGluUHQueCA8PSBlZGdlSGlnaFB0LnggKSApICkJCXJldHVybgl0cnVlOwkvLyBpblB0OiBQb2ludCBvbiBjb250b3VyICEKCQkJCQkvLyBjb250aW51ZTsKCgkJCQl9CgoJCQl9CgoJCQlyZXR1cm4JaW5zaWRlOwoKCQl9CgoJCWNvbnN0IGlzQ2xvY2tXaXNlID0gU2hhcGVVdGlscy5pc0Nsb2NrV2lzZTsKCgkJY29uc3Qgc3ViUGF0aHMgPSB0aGlzLnN1YlBhdGhzOwoJCWlmICggc3ViUGF0aHMubGVuZ3RoID09PSAwICkgcmV0dXJuIFtdOwoKCQlsZXQgc29saWQsIHRtcFBhdGgsIHRtcFNoYXBlOwoJCWNvbnN0IHNoYXBlcyA9IFtdOwoKCQlpZiAoIHN1YlBhdGhzLmxlbmd0aCA9PT0gMSApIHsKCgkJCXRtcFBhdGggPSBzdWJQYXRoc1sgMCBdOwoJCQl0bXBTaGFwZSA9IG5ldyBTaGFwZSgpOwoJCQl0bXBTaGFwZS5jdXJ2ZXMgPSB0bXBQYXRoLmN1cnZlczsKCQkJc2hhcGVzLnB1c2goIHRtcFNoYXBlICk7CgkJCXJldHVybiBzaGFwZXM7CgoJCX0KCgkJbGV0IGhvbGVzRmlyc3QgPSAhIGlzQ2xvY2tXaXNlKCBzdWJQYXRoc1sgMCBdLmdldFBvaW50cygpICk7CgkJaG9sZXNGaXJzdCA9IGlzQ0NXID8gISBob2xlc0ZpcnN0IDogaG9sZXNGaXJzdDsKCgkJLy8gY29uc29sZS5sb2coIkhvbGVzIGZpcnN0IiwgaG9sZXNGaXJzdCk7CgoJCWNvbnN0IGJldHRlclNoYXBlSG9sZXMgPSBbXTsKCQljb25zdCBuZXdTaGFwZXMgPSBbXTsKCQlsZXQgbmV3U2hhcGVIb2xlcyA9IFtdOwoJCWxldCBtYWluSWR4ID0gMDsKCQlsZXQgdG1wUG9pbnRzOwoKCQluZXdTaGFwZXNbIG1haW5JZHggXSA9IHVuZGVmaW5lZDsKCQluZXdTaGFwZUhvbGVzWyBtYWluSWR4IF0gPSBbXTsKCgkJZm9yICggbGV0IGkgPSAwLCBsID0gc3ViUGF0aHMubGVuZ3RoOyBpIDwgbDsgaSArKyApIHsKCgkJCXRtcFBhdGggPSBzdWJQYXRoc1sgaSBdOwoJCQl0bXBQb2ludHMgPSB0bXBQYXRoLmdldFBvaW50cygpOwoJCQlzb2xpZCA9IGlzQ2xvY2tXaXNlKCB0bXBQb2ludHMgKTsKCQkJc29saWQgPSBpc0NDVyA/ICEgc29saWQgOiBzb2xpZDsKCgkJCWlmICggc29saWQgKSB7CgoJCQkJaWYgKCAoICEgaG9sZXNGaXJzdCApICYmICggbmV3U2hhcGVzWyBtYWluSWR4IF0gKSApCW1haW5JZHggKys7CgoJCQkJbmV3U2hhcGVzWyBtYWluSWR4IF0gPSB7IHM6IG5ldyBTaGFwZSgpLCBwOiB0bXBQb2ludHMgfTsKCQkJCW5ld1NoYXBlc1sgbWFpbklkeCBdLnMuY3VydmVzID0gdG1wUGF0aC5jdXJ2ZXM7CgoJCQkJaWYgKCBob2xlc0ZpcnN0ICkJbWFpbklkeCArKzsKCQkJCW5ld1NoYXBlSG9sZXNbIG1haW5JZHggXSA9IFtdOwoKCQkJCS8vY29uc29sZS5sb2coJ2N3JywgaSk7CgoJCQl9IGVsc2UgewoKCQkJCW5ld1NoYXBlSG9sZXNbIG1haW5JZHggXS5wdXNoKCB7IGg6IHRtcFBhdGgsIHA6IHRtcFBvaW50c1sgMCBdIH0gKTsKCgkJCQkvL2NvbnNvbGUubG9nKCdjY3cnLCBpKTsKCgkJCX0KCgkJfQoKCQkvLyBvbmx5IEhvbGVzPyAtPiBwcm9iYWJseSBhbGwgU2hhcGVzIHdpdGggd3Jvbmcgb3JpZW50YXRpb24KCQlpZiAoICEgbmV3U2hhcGVzWyAwIF0gKQlyZXR1cm4JdG9TaGFwZXNOb0hvbGVzKCBzdWJQYXRocyApOwoKCgkJaWYgKCBuZXdTaGFwZXMubGVuZ3RoID4gMSApIHsKCgkJCWxldCBhbWJpZ3VvdXMgPSBmYWxzZTsKCQkJbGV0IHRvQ2hhbmdlID0gMDsKCgkJCWZvciAoIGxldCBzSWR4ID0gMCwgc0xlbiA9IG5ld1NoYXBlcy5sZW5ndGg7IHNJZHggPCBzTGVuOyBzSWR4ICsrICkgewoKCQkJCWJldHRlclNoYXBlSG9sZXNbIHNJZHggXSA9IFtdOwoKCQkJfQoKCQkJZm9yICggbGV0IHNJZHggPSAwLCBzTGVuID0gbmV3U2hhcGVzLmxlbmd0aDsgc0lkeCA8IHNMZW47IHNJZHggKysgKSB7CgoJCQkJY29uc3Qgc2hvID0gbmV3U2hhcGVIb2xlc1sgc0lkeCBdOwoKCQkJCWZvciAoIGxldCBoSWR4ID0gMDsgaElkeCA8IHNoby5sZW5ndGg7IGhJZHggKysgKSB7CgoJCQkJCWNvbnN0IGhvID0gc2hvWyBoSWR4IF07CgkJCQkJbGV0IGhvbGVfdW5hc3NpZ25lZCA9IHRydWU7CgoJCQkJCWZvciAoIGxldCBzMklkeCA9IDA7IHMySWR4IDwgbmV3U2hhcGVzLmxlbmd0aDsgczJJZHggKysgKSB7CgoJCQkJCQlpZiAoIGlzUG9pbnRJbnNpZGVQb2x5Z29uKCBoby5wLCBuZXdTaGFwZXNbIHMySWR4IF0ucCApICkgewoKCQkJCQkJCWlmICggc0lkeCAhPT0gczJJZHggKQl0b0NoYW5nZSArKzsKCgkJCQkJCQlpZiAoIGhvbGVfdW5hc3NpZ25lZCApIHsKCgkJCQkJCQkJaG9sZV91bmFzc2lnbmVkID0gZmFsc2U7CgkJCQkJCQkJYmV0dGVyU2hhcGVIb2xlc1sgczJJZHggXS5wdXNoKCBobyApOwoKCQkJCQkJCX0gZWxzZSB7CgoJCQkJCQkJCWFtYmlndW91cyA9IHRydWU7CgoJCQkJCQkJfQoKCQkJCQkJfQoKCQkJCQl9CgoJCQkJCWlmICggaG9sZV91bmFzc2lnbmVkICkgewoKCQkJCQkJYmV0dGVyU2hhcGVIb2xlc1sgc0lkeCBdLnB1c2goIGhvICk7CgoJCQkJCX0KCgkJCQl9CgoJCQl9CgoJCQlpZiAoIHRvQ2hhbmdlID4gMCAmJiBhbWJpZ3VvdXMgPT09IGZhbHNlICkgewoKCQkJCW5ld1NoYXBlSG9sZXMgPSBiZXR0ZXJTaGFwZUhvbGVzOwoKCQkJfQoKCQl9CgoJCWxldCB0bXBIb2xlczsKCgkJZm9yICggbGV0IGkgPSAwLCBpbCA9IG5ld1NoYXBlcy5sZW5ndGg7IGkgPCBpbDsgaSArKyApIHsKCgkJCXRtcFNoYXBlID0gbmV3U2hhcGVzWyBpIF0uczsKCQkJc2hhcGVzLnB1c2goIHRtcFNoYXBlICk7CgkJCXRtcEhvbGVzID0gbmV3U2hhcGVIb2xlc1sgaSBdOwoKCQkJZm9yICggbGV0IGogPSAwLCBqbCA9IHRtcEhvbGVzLmxlbmd0aDsgaiA8IGpsOyBqICsrICkgewoKCQkJCXRtcFNoYXBlLmhvbGVzLnB1c2goIHRtcEhvbGVzWyBqIF0uaCApOwoKCQkJfQoKCQl9CgoJCS8vY29uc29sZS5sb2coInNoYXBlIiwgc2hhcGVzKTsKCgkJcmV0dXJuIHNoYXBlczsKCgl9Cgp9CgppZiAoIHR5cGVvZiBfX1RIUkVFX0RFVlRPT0xTX18gIT09ICd1bmRlZmluZWQnICkgewoKCV9fVEhSRUVfREVWVE9PTFNfXy5kaXNwYXRjaEV2ZW50KCBuZXcgQ3VzdG9tRXZlbnQoICdyZWdpc3RlcicsIHsgZGV0YWlsOiB7CgkJcmV2aXNpb246IFJFVklTSU9OLAoJfSB9ICkgKTsKCn0KCmlmICggdHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgKSB7CgoJaWYgKCB3aW5kb3cuX19USFJFRV9fICkgewoKCQljb25zb2xlLndhcm4oICdXQVJOSU5HOiBNdWx0aXBsZSBpbnN0YW5jZXMgb2YgVGhyZWUuanMgYmVpbmcgaW1wb3J0ZWQuJyApOwoKCX0gZWxzZSB7CgoJCXdpbmRvdy5fX1RIUkVFX18gPSBSRVZJU0lPTjsKCgl9Cgp9CgpleHBvcnQgeyBBQ0VTRmlsbWljVG9uZU1hcHBpbmcsIEFkZEVxdWF0aW9uLCBBZGRPcGVyYXRpb24sIEFkZGl0aXZlQW5pbWF0aW9uQmxlbmRNb2RlLCBBZGRpdGl2ZUJsZW5kaW5nLCBBbHBoYUZvcm1hdCwgQWx3YXlzQ29tcGFyZSwgQWx3YXlzRGVwdGgsIEFsd2F5c1N0ZW5jaWxGdW5jLCBBbWJpZW50TGlnaHQsIEFuaW1hdGlvbkFjdGlvbiwgQW5pbWF0aW9uQ2xpcCwgQW5pbWF0aW9uTG9hZGVyLCBBbmltYXRpb25NaXhlciwgQW5pbWF0aW9uT2JqZWN0R3JvdXAsIEFuaW1hdGlvblV0aWxzLCBBcmNDdXJ2ZSwgQXJyYXlDYW1lcmEsIEFycm93SGVscGVyLCBBdWRpbywgQXVkaW9BbmFseXNlciwgQXVkaW9Db250ZXh0LCBBdWRpb0xpc3RlbmVyLCBBdWRpb0xvYWRlciwgQXhlc0hlbHBlciwgQmFja1NpZGUsIEJhc2ljRGVwdGhQYWNraW5nLCBCYXNpY1NoYWRvd01hcCwgQm9uZSwgQm9vbGVhbktleWZyYW1lVHJhY2ssIEJveDIsIEJveDMsIEJveDNIZWxwZXIsIEJveEdlb21ldHJ5LCBCb3hIZWxwZXIsIEJ1ZmZlckF0dHJpYnV0ZSwgQnVmZmVyR2VvbWV0cnksIEJ1ZmZlckdlb21ldHJ5TG9hZGVyLCBCeXRlVHlwZSwgQ2FjaGUsIENhbWVyYSwgQ2FtZXJhSGVscGVyLCBDYW52YXNUZXh0dXJlLCBDYXBzdWxlR2VvbWV0cnksIENhdG11bGxSb21DdXJ2ZTMsIENpbmVvblRvbmVNYXBwaW5nLCBDaXJjbGVHZW9tZXRyeSwgQ2xhbXBUb0VkZ2VXcmFwcGluZywgQ2xvY2ssIENvbG9yLCBDb2xvcktleWZyYW1lVHJhY2ssIENvbG9yTWFuYWdlbWVudCwgQ29tcHJlc3NlZEFycmF5VGV4dHVyZSwgQ29tcHJlc3NlZEN1YmVUZXh0dXJlLCBDb21wcmVzc2VkVGV4dHVyZSwgQ29tcHJlc3NlZFRleHR1cmVMb2FkZXIsIENvbmVHZW9tZXRyeSwgQ3ViZUNhbWVyYSwgQ3ViZVJlZmxlY3Rpb25NYXBwaW5nLCBDdWJlUmVmcmFjdGlvbk1hcHBpbmcsIEN1YmVUZXh0dXJlLCBDdWJlVGV4dHVyZUxvYWRlciwgQ3ViZVVWUmVmbGVjdGlvbk1hcHBpbmcsIEN1YmljQmV6aWVyQ3VydmUsIEN1YmljQmV6aWVyQ3VydmUzLCBDdWJpY0ludGVycG9sYW50LCBDdWxsRmFjZUJhY2ssIEN1bGxGYWNlRnJvbnQsIEN1bGxGYWNlRnJvbnRCYWNrLCBDdWxsRmFjZU5vbmUsIEN1cnZlLCBDdXJ2ZVBhdGgsIEN1c3RvbUJsZW5kaW5nLCBDdXN0b21Ub25lTWFwcGluZywgQ3lsaW5kZXJHZW9tZXRyeSwgQ3lsaW5kcmljYWwsIERhdGEzRFRleHR1cmUsIERhdGFBcnJheVRleHR1cmUsIERhdGFUZXh0dXJlLCBEYXRhVGV4dHVyZUxvYWRlciwgRGF0YVV0aWxzLCBEZWNyZW1lbnRTdGVuY2lsT3AsIERlY3JlbWVudFdyYXBTdGVuY2lsT3AsIERlZmF1bHRMb2FkaW5nTWFuYWdlciwgRGVwdGhGb3JtYXQsIERlcHRoU3RlbmNpbEZvcm1hdCwgRGVwdGhUZXh0dXJlLCBEaXJlY3Rpb25hbExpZ2h0LCBEaXJlY3Rpb25hbExpZ2h0SGVscGVyLCBEaXNjcmV0ZUludGVycG9sYW50LCBEaXNwbGF5UDNDb2xvclNwYWNlLCBEb2RlY2FoZWRyb25HZW9tZXRyeSwgRG91YmxlU2lkZSwgRHN0QWxwaGFGYWN0b3IsIERzdENvbG9yRmFjdG9yLCBEeW5hbWljQ29weVVzYWdlLCBEeW5hbWljRHJhd1VzYWdlLCBEeW5hbWljUmVhZFVzYWdlLCBFZGdlc0dlb21ldHJ5LCBFbGxpcHNlQ3VydmUsIEVxdWFsQ29tcGFyZSwgRXF1YWxEZXB0aCwgRXF1YWxTdGVuY2lsRnVuYywgRXF1aXJlY3Rhbmd1bGFyUmVmbGVjdGlvbk1hcHBpbmcsIEVxdWlyZWN0YW5ndWxhclJlZnJhY3Rpb25NYXBwaW5nLCBFdWxlciwgRXZlbnREaXNwYXRjaGVyLCBFeHRydWRlR2VvbWV0cnksIEZpbGVMb2FkZXIsIEZsb2F0MTZCdWZmZXJBdHRyaWJ1dGUsIEZsb2F0MzJCdWZmZXJBdHRyaWJ1dGUsIEZsb2F0NjRCdWZmZXJBdHRyaWJ1dGUsIEZsb2F0VHlwZSwgRm9nLCBGb2dFeHAyLCBGcmFtZWJ1ZmZlclRleHR1cmUsIEZyb250U2lkZSwgRnJ1c3R1bSwgR0xCdWZmZXJBdHRyaWJ1dGUsIEdMU0wxLCBHTFNMMywgR3JlYXRlckNvbXBhcmUsIEdyZWF0ZXJEZXB0aCwgR3JlYXRlckVxdWFsQ29tcGFyZSwgR3JlYXRlckVxdWFsRGVwdGgsIEdyZWF0ZXJFcXVhbFN0ZW5jaWxGdW5jLCBHcmVhdGVyU3RlbmNpbEZ1bmMsIEdyaWRIZWxwZXIsIEdyb3VwLCBIYWxmRmxvYXRUeXBlLCBIZW1pc3BoZXJlTGlnaHQsIEhlbWlzcGhlcmVMaWdodEhlbHBlciwgSWNvc2FoZWRyb25HZW9tZXRyeSwgSW1hZ2VCaXRtYXBMb2FkZXIsIEltYWdlTG9hZGVyLCBJbWFnZVV0aWxzLCBJbmNyZW1lbnRTdGVuY2lsT3AsIEluY3JlbWVudFdyYXBTdGVuY2lsT3AsIEluc3RhbmNlZEJ1ZmZlckF0dHJpYnV0ZSwgSW5zdGFuY2VkQnVmZmVyR2VvbWV0cnksIEluc3RhbmNlZEludGVybGVhdmVkQnVmZmVyLCBJbnN0YW5jZWRNZXNoLCBJbnQxNkJ1ZmZlckF0dHJpYnV0ZSwgSW50MzJCdWZmZXJBdHRyaWJ1dGUsIEludDhCdWZmZXJBdHRyaWJ1dGUsIEludFR5cGUsIEludGVybGVhdmVkQnVmZmVyLCBJbnRlcmxlYXZlZEJ1ZmZlckF0dHJpYnV0ZSwgSW50ZXJwb2xhbnQsIEludGVycG9sYXRlRGlzY3JldGUsIEludGVycG9sYXRlTGluZWFyLCBJbnRlcnBvbGF0ZVNtb290aCwgSW52ZXJ0U3RlbmNpbE9wLCBLZWVwU3RlbmNpbE9wLCBLZXlmcmFtZVRyYWNrLCBMT0QsIExhdGhlR2VvbWV0cnksIExheWVycywgTGVzc0NvbXBhcmUsIExlc3NEZXB0aCwgTGVzc0VxdWFsQ29tcGFyZSwgTGVzc0VxdWFsRGVwdGgsIExlc3NFcXVhbFN0ZW5jaWxGdW5jLCBMZXNzU3RlbmNpbEZ1bmMsIExpZ2h0LCBMaWdodFByb2JlLCBMaW5lLCBMaW5lMywgTGluZUJhc2ljTWF0ZXJpYWwsIExpbmVDdXJ2ZSwgTGluZUN1cnZlMywgTGluZURhc2hlZE1hdGVyaWFsLCBMaW5lTG9vcCwgTGluZVNlZ21lbnRzLCBMaW5lYXJEaXNwbGF5UDNDb2xvclNwYWNlLCBMaW5lYXJFbmNvZGluZywgTGluZWFyRmlsdGVyLCBMaW5lYXJJbnRlcnBvbGFudCwgTGluZWFyTWlwTWFwTGluZWFyRmlsdGVyLCBMaW5lYXJNaXBNYXBOZWFyZXN0RmlsdGVyLCBMaW5lYXJNaXBtYXBMaW5lYXJGaWx0ZXIsIExpbmVhck1pcG1hcE5lYXJlc3RGaWx0ZXIsIExpbmVhclNSR0JDb2xvclNwYWNlLCBMaW5lYXJUb25lTWFwcGluZywgTGluZWFyVHJhbnNmZXIsIExvYWRlciwgTG9hZGVyVXRpbHMsIExvYWRpbmdNYW5hZ2VyLCBMb29wT25jZSwgTG9vcFBpbmdQb25nLCBMb29wUmVwZWF0LCBMdW1pbmFuY2VBbHBoYUZvcm1hdCwgTHVtaW5hbmNlRm9ybWF0LCBNT1VTRSwgTWF0ZXJpYWwsIE1hdGVyaWFsTG9hZGVyLCBNYXRoVXRpbHMsIE1hdHJpeDMsIE1hdHJpeDQsIE1heEVxdWF0aW9uLCBNZXNoLCBNZXNoQmFzaWNNYXRlcmlhbCwgTWVzaERlcHRoTWF0ZXJpYWwsIE1lc2hEaXN0YW5jZU1hdGVyaWFsLCBNZXNoTGFtYmVydE1hdGVyaWFsLCBNZXNoTWF0Y2FwTWF0ZXJpYWwsIE1lc2hOb3JtYWxNYXRlcmlhbCwgTWVzaFBob25nTWF0ZXJpYWwsIE1lc2hQaHlzaWNhbE1hdGVyaWFsLCBNZXNoU3RhbmRhcmRNYXRlcmlhbCwgTWVzaFRvb25NYXRlcmlhbCwgTWluRXF1YXRpb24sIE1pcnJvcmVkUmVwZWF0V3JhcHBpbmcsIE1peE9wZXJhdGlvbiwgTXVsdGlwbHlCbGVuZGluZywgTXVsdGlwbHlPcGVyYXRpb24sIE5lYXJlc3RGaWx0ZXIsIE5lYXJlc3RNaXBNYXBMaW5lYXJGaWx0ZXIsIE5lYXJlc3RNaXBNYXBOZWFyZXN0RmlsdGVyLCBOZWFyZXN0TWlwbWFwTGluZWFyRmlsdGVyLCBOZWFyZXN0TWlwbWFwTmVhcmVzdEZpbHRlciwgTmV2ZXJDb21wYXJlLCBOZXZlckRlcHRoLCBOZXZlclN0ZW5jaWxGdW5jLCBOb0JsZW5kaW5nLCBOb0NvbG9yU3BhY2UsIE5vVG9uZU1hcHBpbmcsIE5vcm1hbEFuaW1hdGlvbkJsZW5kTW9kZSwgTm9ybWFsQmxlbmRpbmcsIE5vdEVxdWFsQ29tcGFyZSwgTm90RXF1YWxEZXB0aCwgTm90RXF1YWxTdGVuY2lsRnVuYywgTnVtYmVyS2V5ZnJhbWVUcmFjaywgT2JqZWN0M0QsIE9iamVjdExvYWRlciwgT2JqZWN0U3BhY2VOb3JtYWxNYXAsIE9jdGFoZWRyb25HZW9tZXRyeSwgT25lRmFjdG9yLCBPbmVNaW51c0RzdEFscGhhRmFjdG9yLCBPbmVNaW51c0RzdENvbG9yRmFjdG9yLCBPbmVNaW51c1NyY0FscGhhRmFjdG9yLCBPbmVNaW51c1NyY0NvbG9yRmFjdG9yLCBPcnRob2dyYXBoaWNDYW1lcmEsIFAzUHJpbWFyaWVzLCBQQ0ZTaGFkb3dNYXAsIFBDRlNvZnRTaGFkb3dNYXAsIFBNUkVNR2VuZXJhdG9yLCBQYXRoLCBQZXJzcGVjdGl2ZUNhbWVyYSwgUGxhbmUsIFBsYW5lR2VvbWV0cnksIFBsYW5lSGVscGVyLCBQb2ludExpZ2h0LCBQb2ludExpZ2h0SGVscGVyLCBQb2ludHMsIFBvaW50c01hdGVyaWFsLCBQb2xhckdyaWRIZWxwZXIsIFBvbHloZWRyb25HZW9tZXRyeSwgUG9zaXRpb25hbEF1ZGlvLCBQcm9wZXJ0eUJpbmRpbmcsIFByb3BlcnR5TWl4ZXIsIFF1YWRyYXRpY0JlemllckN1cnZlLCBRdWFkcmF0aWNCZXppZXJDdXJ2ZTMsIFF1YXRlcm5pb24sIFF1YXRlcm5pb25LZXlmcmFtZVRyYWNrLCBRdWF0ZXJuaW9uTGluZWFySW50ZXJwb2xhbnQsIFJFRF9HUkVFTl9SR1RDMl9Gb3JtYXQsIFJFRF9SR1RDMV9Gb3JtYXQsIFJFVklTSU9OLCBSR0JBRGVwdGhQYWNraW5nLCBSR0JBRm9ybWF0LCBSR0JBSW50ZWdlckZvcm1hdCwgUkdCQV9BU1RDXzEweDEwX0Zvcm1hdCwgUkdCQV9BU1RDXzEweDVfRm9ybWF0LCBSR0JBX0FTVENfMTB4Nl9Gb3JtYXQsIFJHQkFfQVNUQ18xMHg4X0Zvcm1hdCwgUkdCQV9BU1RDXzEyeDEwX0Zvcm1hdCwgUkdCQV9BU1RDXzEyeDEyX0Zvcm1hdCwgUkdCQV9BU1RDXzR4NF9Gb3JtYXQsIFJHQkFfQVNUQ181eDRfRm9ybWF0LCBSR0JBX0FTVENfNXg1X0Zvcm1hdCwgUkdCQV9BU1RDXzZ4NV9Gb3JtYXQsIFJHQkFfQVNUQ182eDZfRm9ybWF0LCBSR0JBX0FTVENfOHg1X0Zvcm1hdCwgUkdCQV9BU1RDXzh4Nl9Gb3JtYXQsIFJHQkFfQVNUQ184eDhfRm9ybWF0LCBSR0JBX0JQVENfRm9ybWF0LCBSR0JBX0VUQzJfRUFDX0Zvcm1hdCwgUkdCQV9QVlJUQ18yQlBQVjFfRm9ybWF0LCBSR0JBX1BWUlRDXzRCUFBWMV9Gb3JtYXQsIFJHQkFfUzNUQ19EWFQxX0Zvcm1hdCwgUkdCQV9TM1RDX0RYVDNfRm9ybWF0LCBSR0JBX1MzVENfRFhUNV9Gb3JtYXQsIFJHQl9CUFRDX1NJR05FRF9Gb3JtYXQsIFJHQl9CUFRDX1VOU0lHTkVEX0Zvcm1hdCwgUkdCX0VUQzFfRm9ybWF0LCBSR0JfRVRDMl9Gb3JtYXQsIFJHQl9QVlJUQ18yQlBQVjFfRm9ybWF0LCBSR0JfUFZSVENfNEJQUFYxX0Zvcm1hdCwgUkdCX1MzVENfRFhUMV9Gb3JtYXQsIFJHRm9ybWF0LCBSR0ludGVnZXJGb3JtYXQsIFJhd1NoYWRlck1hdGVyaWFsLCBSYXksIFJheWNhc3RlciwgUmVjNzA5UHJpbWFyaWVzLCBSZWN0QXJlYUxpZ2h0LCBSZWRGb3JtYXQsIFJlZEludGVnZXJGb3JtYXQsIFJlaW5oYXJkVG9uZU1hcHBpbmcsIFJlbmRlclRhcmdldCwgUmVwZWF0V3JhcHBpbmcsIFJlcGxhY2VTdGVuY2lsT3AsIFJldmVyc2VTdWJ0cmFjdEVxdWF0aW9uLCBSaW5nR2VvbWV0cnksIFNJR05FRF9SRURfR1JFRU5fUkdUQzJfRm9ybWF0LCBTSUdORURfUkVEX1JHVEMxX0Zvcm1hdCwgU1JHQkNvbG9yU3BhY2UsIFNSR0JUcmFuc2ZlciwgU2NlbmUsIFNoYWRlckNodW5rLCBTaGFkZXJMaWIsIFNoYWRlck1hdGVyaWFsLCBTaGFkb3dNYXRlcmlhbCwgU2hhcGUsIFNoYXBlR2VvbWV0cnksIFNoYXBlUGF0aCwgU2hhcGVVdGlscywgU2hvcnRUeXBlLCBTa2VsZXRvbiwgU2tlbGV0b25IZWxwZXIsIFNraW5uZWRNZXNoLCBTb3VyY2UsIFNwaGVyZSwgU3BoZXJlR2VvbWV0cnksIFNwaGVyaWNhbCwgU3BoZXJpY2FsSGFybW9uaWNzMywgU3BsaW5lQ3VydmUsIFNwb3RMaWdodCwgU3BvdExpZ2h0SGVscGVyLCBTcHJpdGUsIFNwcml0ZU1hdGVyaWFsLCBTcmNBbHBoYUZhY3RvciwgU3JjQWxwaGFTYXR1cmF0ZUZhY3RvciwgU3JjQ29sb3JGYWN0b3IsIFN0YXRpY0NvcHlVc2FnZSwgU3RhdGljRHJhd1VzYWdlLCBTdGF0aWNSZWFkVXNhZ2UsIFN0ZXJlb0NhbWVyYSwgU3RyZWFtQ29weVVzYWdlLCBTdHJlYW1EcmF3VXNhZ2UsIFN0cmVhbVJlYWRVc2FnZSwgU3RyaW5nS2V5ZnJhbWVUcmFjaywgU3VidHJhY3RFcXVhdGlvbiwgU3VidHJhY3RpdmVCbGVuZGluZywgVE9VQ0gsIFRhbmdlbnRTcGFjZU5vcm1hbE1hcCwgVGV0cmFoZWRyb25HZW9tZXRyeSwgVGV4dHVyZSwgVGV4dHVyZUxvYWRlciwgVG9ydXNHZW9tZXRyeSwgVG9ydXNLbm90R2VvbWV0cnksIFRyaWFuZ2xlLCBUcmlhbmdsZUZhbkRyYXdNb2RlLCBUcmlhbmdsZVN0cmlwRHJhd01vZGUsIFRyaWFuZ2xlc0RyYXdNb2RlLCBUdWJlR2VvbWV0cnksIFR3b1Bhc3NEb3VibGVTaWRlLCBVVk1hcHBpbmcsIFVpbnQxNkJ1ZmZlckF0dHJpYnV0ZSwgVWludDMyQnVmZmVyQXR0cmlidXRlLCBVaW50OEJ1ZmZlckF0dHJpYnV0ZSwgVWludDhDbGFtcGVkQnVmZmVyQXR0cmlidXRlLCBVbmlmb3JtLCBVbmlmb3Jtc0dyb3VwLCBVbmlmb3Jtc0xpYiwgVW5pZm9ybXNVdGlscywgVW5zaWduZWRCeXRlVHlwZSwgVW5zaWduZWRJbnQyNDhUeXBlLCBVbnNpZ25lZEludFR5cGUsIFVuc2lnbmVkU2hvcnQ0NDQ0VHlwZSwgVW5zaWduZWRTaG9ydDU1NTFUeXBlLCBVbnNpZ25lZFNob3J0VHlwZSwgVlNNU2hhZG93TWFwLCBWZWN0b3IyLCBWZWN0b3IzLCBWZWN0b3I0LCBWZWN0b3JLZXlmcmFtZVRyYWNrLCBWaWRlb1RleHR1cmUsIFdlYkdMMVJlbmRlcmVyLCBXZWJHTDNEUmVuZGVyVGFyZ2V0LCBXZWJHTEFycmF5UmVuZGVyVGFyZ2V0LCBXZWJHTENvb3JkaW5hdGVTeXN0ZW0sIFdlYkdMQ3ViZVJlbmRlclRhcmdldCwgV2ViR0xNdWx0aXBsZVJlbmRlclRhcmdldHMsIFdlYkdMUmVuZGVyVGFyZ2V0LCBXZWJHTFJlbmRlcmVyLCBXZWJHTFV0aWxzLCBXZWJHUFVDb29yZGluYXRlU3lzdGVtLCBXaXJlZnJhbWVHZW9tZXRyeSwgV3JhcEFyb3VuZEVuZGluZywgWmVyb0N1cnZhdHVyZUVuZGluZywgWmVyb0ZhY3RvciwgWmVyb1Nsb3BlRW5kaW5nLCBaZXJvU3RlbmNpbE9wLCBfU1JHQkFGb3JtYXQsIGNyZWF0ZUNhbnZhc0VsZW1lbnQsIHNSR0JFbmNvZGluZyB9Owo=",
    "base64": true
  },
  {
    "key": "main.js",
    "value": "aW1wb3J0ICogYXMgVEhSRUUgZnJvbSAnLi9qcy90aHJlZS5tb2R1bGUuanMnOwppbXBvcnQgeyBPcmJpdENvbnRyb2xzIH0gZnJvbSAnLi9qcy9PcmJpdENvbnRyb2xzLmpzJzsKCi8vIEhTTCBhbmQgUkdCIGNvbnZlcnNpb24gZnVuY3Rpb25zIChjb3BpZWQgZnJvbSBzcmMvcnNtdi91dGlscy50cykKZnVuY3Rpb24gSFNMMlJHQmZsb2F0KGhzbCkgewogICAgdmFyIGggPSBoc2xbMF07CiAgICB2YXIgcyA9IGhzbFsxXTsKICAgIHZhciBsID0gaHNsWzJdOwogICAgdmFyIHIsIGcsIGI7CgogICAgaWYgKHMgPT0gMCkgewogICAgICAgIHIgPSBnID0gYiA9IGw7IC8vIGFjaHJvbWF0aWMKICAgIH0KICAgIGVsc2UgewogICAgICAgIHZhciBodWUycmdiID0gZnVuY3Rpb24gaHVlMnJnYihwLCBxLCB0KSB7CiAgICAgICAgICAgIGlmICh0IDwgMCkgdCArPSAxOwogICAgICAgICAgICBpZiAodCA+IDEpIHQgLT0gMTsKICAgICAgICAgICAgaWYgKHQgPCAxIC8gNikgcmV0dXJuIHAgKyAocSAtIHApICogNiAqIHQ7CiAgICAgICAgICAgIGlmICh0IDwgMSAvIDIpIHJldHVybiBxOwogICAgICAgICAgICBpZiAodCA8IDIgLyAzKSByZXR1cm4gcCArIChxIC0gcCkgKiAoMiAvIDMgLSB0KSAqIDY7CiAgICAgICAgICAgIHJldHVybiBwOwogICAgICAgIH0KCiAgICAgICAgdmFyIHEgPSBsIDwgMC41ID8gbCAqICgxICsgcykgOiBsICsgcyAtIGwgKiBzOwogICAgICAgIHZhciBwID0gMiAqIGwgLSBxOwogICAgICAgIHIgPSBodWUycmdiKHAsIHEsIGggKyAxIC8gMyk7CiAgICAgICAgZyA9IGh1ZTJyZ2IocCwgcSwgaCk7CiAgICAgICAgYiA9IGh1ZTJyZ2IocCwgcSwgaCAtIDEgLyAzKTsKICAgIH0KCiAgICByZXR1cm4gW3IsIGcsIGJdOwp9CgpmdW5jdGlvbiBIU0wyUkdCKGhzbCkgewogICAgbGV0IHJnYiA9IEhTTDJSR0JmbG9hdChoc2wpOwogICAgcmV0dXJuIFtNYXRoLnJvdW5kKHJnYlswXSAqIDI1NSksIE1hdGgucm91bmQocmdiWzFdICogMjU1KSwgTWF0aC5yb3VuZChyZ2JbMl0gKiAyNTUpXTsKfQoKZnVuY3Rpb24gUkdCMkhTTChyLCBnLCBiKSB7CiAgICByIC89IDI1NSwgZyAvPSAyNTUsIGIgLz0gMjU1OwogICAgdmFyIG1heCA9IE1hdGgubWF4KHIsIGcsIGIpLCBtaW4gPSBNYXRoLm1pbihyLCBnLCBiKTsKICAgIHZhciBoID0gMDsKICAgIHZhciBzID0gMDsKICAgIGxldCBsID0gKG1heCArIG1pbikgLyAyOwoKICAgIGlmIChtYXggIT0gbWluKSB7CiAgICAgICAgdmFyIGQgPSBtYXggLSBtaW47CiAgICAgICAgcyA9IGwgPiAwLjUgPyBkIC8gKDIgLSBtYXggLSBtaW4pIDogZCAvIChtYXggKyBtaW4pOwogICAgICAgIHN3aXRjaCAobWF4KSB7CiAgICAgICAgICAgIGNhc2UgcjogaCA9IChnIC0gYikgLyBkICsgKGcgPCBiID8gNiA6IDApOyBicmVhazsKICAgICAgICAgICAgY2FzZSBnOiBoID0gKGIgLSByKSAvIGQgKyAyOyBicmVhazsKICAgICAgICAgICAgY2FzZSBiOiBoID0gKHIgLSBnKSAvIGQgKyA0OyBicmVhazsKICAgICAgICB9CiAgICAgICAgaCAvPSA2OwogICAgfQogICAgcmV0dXJuIFtoLCBzLCBsXTsKfQoKZnVuY3Rpb24gSFNMMnBhY2tIU0woaCwgcywgbCkgewogICAgaWYgKGggPCAwKSB7IGggKz0gMTsgfQogICAgcmV0dXJuIChNYXRoLnJvdW5kKGggKiA2MykgPDwgMTApIHwgKE1hdGgucm91bmQocyAqIDcpIDw8IDcpIHwgKE1hdGgucm91bmQobCAqIDEyNykpOwp9CgpmdW5jdGlvbiBwYWNrZWRIU0wySFNMKGhzbCkgewogICAgdmFyIGggPSAoKGhzbCA+PiAxMCkgJiAweDNGKSAvIDYzLjA7CiAgICB2YXIgcyA9ICgoaHNsID4+IDcpICYgMHg3KSAvIDcuMDsKICAgIHZhciBsID0gKGhzbCAmIDB4N0YpIC8gMTI3LjA7CiAgICBpZiAoaCA+IDAuNSkKICAgICAgICBoID0gaCAtIDEuMDsKICAgIHJldHVybiBbaCwgcywgbF07Cn0KCi8vIDEuIFNjZW5lIFNldHVwCmNvbnN0IHNjZW5lID0gbmV3IFRIUkVFLlNjZW5lKCk7CnNjZW5lLmJhY2tncm91bmQgPSBuZXcgVEhSRUUuQ29sb3IoMHhjY2NjY2MpOwoKLy8gQWRkIEdyaWRIZWxwZXIKY29uc3QgZ3JpZEhlbHBlciA9IG5ldyBUSFJFRS5HcmlkSGVscGVyKDEwLCAxMCk7CnNjZW5lLmFkZChncmlkSGVscGVyKTsKCi8vIEFkZCBBeGVzSGVscGVyCmNvbnN0IGF4ZXNIZWxwZXIgPSBuZXcgVEhSRUUuQXhlc0hlbHBlcig1KTsKc2NlbmUuYWRkKGF4ZXNIZWxwZXIpOwoKLy8gMi4gQ2FtZXJhIFNldHVwCmNvbnN0IGNhbWVyYSA9IG5ldyBUSFJFRS5QZXJzcGVjdGl2ZUNhbWVyYSg3NSwgd2luZG93LmlubmVyV2lkdGggLyB3aW5kb3cuaW5uZXJIZWlnaHQsIDAuMSwgMTAwMCk7CmNhbWVyYS5wb3NpdGlvbi56ID0gNTsKCi8vIDMuIFJlbmRlcmVyIFNldHVwCmNvbnN0IHZpZXdlckNvbnRhaW5lciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2aWV3ZXItY29udGFpbmVyJyk7CmNvbnN0IGNhbnZhcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJyNyZW5kZXJlci1jYW52YXMnKTsKY29uc3QgcmVuZGVyZXIgPSBuZXcgVEhSRUUuV2ViR0xSZW5kZXJlcih7IGFudGlhbGlhczogdHJ1ZSwgY2FudmFzIH0pOwpyZW5kZXJlci5zZXRTaXplKHZpZXdlckNvbnRhaW5lci5jbGllbnRXaWR0aCwgdmlld2VyQ29udGFpbmVyLmNsaWVudEhlaWdodCk7CgovLyA0LiBDYW1lcmEgQ29udHJvbHMKY29uc3QgY29udHJvbHMgPSBuZXcgT3JiaXRDb250cm9scyhjYW1lcmEsIHJlbmRlcmVyLmRvbUVsZW1lbnQpOwpjb250cm9scy5lbmFibGVEYW1waW5nID0gdHJ1ZTsgLy8gYW4gYW5pbWF0aW9uIGxvb3AgaXMgcmVxdWlyZWQgd2hlbiBkYW1waW5nIGlzIGVuYWJsZWQKY29udHJvbHMuZGFtcGluZ0ZhY3RvciA9IDAuMjU7CmNvbnRyb2xzLnNjcmVlblNwYWNlUGFubmluZyA9IGZhbHNlOwpjb250cm9scy5tYXhQb2xhckFuZ2xlID0gTWF0aC5QSSAvIDI7CgpsZXQgY3VycmVudE1vZGVsID0gbnVsbDsKCi8vIFJ1bmVTY2FwZSBtb2RlbCBsb2FkaW5nCmZ1bmN0aW9uIGxvYWRSdW5lU2NhcGVNb2RlbChtb2RlbERhdGEpIHsKICAgIGlmIChjdXJyZW50TW9kZWwpIHsKICAgICAgICBzY2VuZS5yZW1vdmUoY3VycmVudE1vZGVsKTsKICAgICAgICAvLyBEaXNwb3NlIG9mIHByZXZpb3VzIG1vZGVsJ3MgZ2VvbWV0cnkgYW5kIG1hdGVyaWFsCiAgICAgICAgY3VycmVudE1vZGVsLnRyYXZlcnNlKG9iamVjdCA9PiB7CiAgICAgICAgICAgIGlmIChvYmplY3QuaXNNZXNoKSB7CiAgICAgICAgICAgICAgICBvYmplY3QuZ2VvbWV0cnkuZGlzcG9zZSgpOwogICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkob2JqZWN0Lm1hdGVyaWFsKSkgewogICAgICAgICAgICAgICAgICAgIG9iamVjdC5tYXRlcmlhbC5mb3JFYWNoKG1hdGVyaWFsID0+IG1hdGVyaWFsLmRpc3Bvc2UoKSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICAgICAgICAgIG9iamVjdC5tYXRlcmlhbC5kaXNwb3NlKCk7CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICB9KTsKICAgIH0KCiAgICBjb25zdCBtb2RlbEdyb3VwID0gbmV3IFRIUkVFLkdyb3VwKCk7CgogICAgbW9kZWxEYXRhLm1lc2hlcy5mb3JFYWNoKG1lc2hEYXRhID0+IHsKICAgICAgICBjb25zdCBnZW9tZXRyeSA9IG5ldyBUSFJFRS5CdWZmZXJHZW9tZXRyeSgpOwoKICAgICAgICAvLyBTZXQgYXR0cmlidXRlcwogICAgICAgIGdlb21ldHJ5LnNldEF0dHJpYnV0ZSgncG9zaXRpb24nLCBtZXNoRGF0YS5hdHRyaWJ1dGVzLnBvcyk7CiAgICAgICAgaWYgKG1lc2hEYXRhLmF0dHJpYnV0ZXMuY29sb3IpIHsKICAgICAgICAgICAgZ2VvbWV0cnkuc2V0QXR0cmlidXRlKCdjb2xvcicsIG1lc2hEYXRhLmF0dHJpYnV0ZXMuY29sb3IpOwogICAgICAgIH0KICAgICAgICBpZiAobWVzaERhdGEuYXR0cmlidXRlcy5ub3JtYWxzKSB7CiAgICAgICAgICAgIGdlb21ldHJ5LnNldEF0dHJpYnV0ZSgnbm9ybWFsJywgbWVzaERhdGEuYXR0cmlidXRlcy5ub3JtYWxzKTsKICAgICAgICB9CiAgICAgICAgaWYgKG1lc2hEYXRhLmF0dHJpYnV0ZXMudGV4dXZzKSB7CiAgICAgICAgICAgIGdlb21ldHJ5LnNldEF0dHJpYnV0ZSgndXYnLCBtZXNoRGF0YS5hdHRyaWJ1dGVzLnRleHV2cyk7CiAgICAgICAgfQogICAgICAgIC8vIEFkZCBvdGhlciBhdHRyaWJ1dGVzIGFzIG5lZWRlZCAoZS5nLiwgc2tpbmlkcywgc2tpbndlaWdodHMsIGJvbmVpZHMsIGJvbmV3ZWlnaHRzKQoKICAgICAgICAvLyBTZXQgaW5kZXgKICAgICAgICBnZW9tZXRyeS5zZXRJbmRleChtZXNoRGF0YS5pbmRpY2VzKTsKCiAgICAgICAgLy8gQ3JlYXRlIG1hdGVyaWFsCiAgICAgICAgbGV0IG1hdGVyaWFsOwogICAgICAgIGlmIChtZXNoRGF0YS5hdHRyaWJ1dGVzLmNvbG9yKSB7CiAgICAgICAgICAgIG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hQaG9uZ01hdGVyaWFsKHsgdmVydGV4Q29sb3JzOiB0cnVlIH0pOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIG1hdGVyaWFsID0gbmV3IFRIUkVFLk1lc2hQaG9uZ01hdGVyaWFsKHsgY29sb3I6IDB4YWFhYWFhIH0pOyAvLyBEZWZhdWx0IGNvbG9yIGlmIG5vIHZlcnRleCBjb2xvcnMKICAgICAgICB9CgogICAgICAgIGNvbnN0IG1lc2ggPSBuZXcgVEhSRUUuTWVzaChnZW9tZXRyeSwgbWF0ZXJpYWwpOwogICAgICAgIG1vZGVsR3JvdXAuYWRkKG1lc2gpOwogICAgfSk7CgogICAgY3VycmVudE1vZGVsID0gbW9kZWxHcm91cDsKICAgIHNjZW5lLmFkZChjdXJyZW50TW9kZWwpOwogICAgY29uc29sZS5sb2coJ1J1bmVTY2FwZSBtb2RlbCBsb2FkZWQgYW5kIGFkZGVkIHRvIHNjZW5lLicsIGN1cnJlbnRNb2RlbCk7CgogICAgLy8gQ2VudGVyIHRoZSBjYW1lcmEgb24gdGhlIG5ldyBtb2RlbAogICAgY29uc3QgYm94ID0gbmV3IFRIUkVFLkJveDMoKS5zZXRGcm9tT2JqZWN0KGN1cnJlbnRNb2RlbCk7CiAgICBjb25zdCBjZW50ZXIgPSBib3guZ2V0Q2VudGVyKG5ldyBUSFJFRS5WZWN0b3IzKCkpOwogICAgY29uc3Qgc2l6ZSA9IGJveC5nZXRTaXplKG5ldyBUSFJFRS5WZWN0b3IzKCkpOwogICAgY29uc3QgbWF4RGltID0gTWF0aC5tYXgoc2l6ZS54LCBzaXplLnksIHNpemUueik7CiAgICBjb25zdCBmb3YgPSBjYW1lcmEuZm92ICogKE1hdGguUEkgLyAxODApOwogICAgbGV0IGNhbWVyYVogPSBNYXRoLmFicyhtYXhEaW0gLyAyIC8gTWF0aC50YW4oZm92IC8gMikpOwogICAgY2FtZXJhWiAqPSAxLjU7IC8vIEFkZCBzb21lIHBhZGRpbmcKCiAgICBjYW1lcmEucG9zaXRpb24uc2V0KGNlbnRlci54LCBjZW50ZXIueSwgY2VudGVyLnogKyBjYW1lcmFaKTsKICAgIGNvbnRyb2xzLnRhcmdldC5zZXQoY2VudGVyLngsIGNlbnRlci55LCBjZW50ZXIueik7CiAgICBjb250cm9scy51cGRhdGUoKTsKfQoKLy8gQ29sb3IgY2hhbmdpbmcgbG9naWMKY29uc3QgY29sb3JJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtb2RlbC1jb2xvcicpOwpjb2xvcklucHV0LmFkZEV2ZW50TGlzdGVuZXIoJ2lucHV0JywgKGV2ZW50KSA9PiB7CiAgICBjb25zdCBoZXhDb2xvciA9IGV2ZW50LnRhcmdldC52YWx1ZTsKICAgIGNvbnN0IHIgPSBwYXJzZUludChoZXhDb2xvci5zdWJzdHJpbmcoMSwgMyksIDE2KTsKICAgIGNvbnN0IGcgPSBwYXJzZUludChoZXhDb2xvci5zdWJzdHJpbmcoMywgNSksIDE2KTsKICAgIGNvbnN0IGIgPSBwYXJzZUludChoZXhDb2xvci5zdWJzdHJpbmcoNSwgNyksIDE2KTsKCiAgICBpZiAoY3VycmVudE1vZGVsKSB7CiAgICAgICAgY3VycmVudE1vZGVsLnRyYXZlcnNlKG9iamVjdCA9PiB7CiAgICAgICAgICAgIGlmIChvYmplY3QuaXNNZXNoICYmIG9iamVjdC5nZW9tZXRyeS5hdHRyaWJ1dGVzLmNvbG9yKSB7CiAgICAgICAgICAgICAgICBjb25zdCBjb2xvcnMgPSBvYmplY3QuZ2VvbWV0cnkuYXR0cmlidXRlcy5jb2xvci5hcnJheTsKICAgICAgICAgICAgICAgIGNvbnN0IFtoLCBzLCBsXSA9IFJHQjJIU0wociwgZywgYik7CiAgICAgICAgICAgICAgICBjb25zdCBwYWNrZWRIU0wgPSBIU0wycGFja0hTTChoLCBzLCBsKTsKICAgICAgICAgICAgICAgIGNvbnN0IFtuZXdSLCBuZXdHLCBuZXdCXSA9IEhTTDJSR0IocGFja2VkSFNMMkhTTChwYWNrZWRIU0wpKTsKCiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGNvbG9ycy5sZW5ndGg7IGkgKz0gNCkgewogICAgICAgICAgICAgICAgICAgIGNvbG9yc1tpXSA9IG5ld1I7CiAgICAgICAgICAgICAgICAgICAgY29sb3JzW2kgKyAxXSA9IG5ld0c7CiAgICAgICAgICAgICAgICAgICAgY29sb3JzW2kgKyAyXSA9IG5ld0I7CiAgICAgICAgICAgICAgICAgICAgLy8gQWxwaGEgcmVtYWlucyB1bmNoYW5nZWQKICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgIG9iamVjdC5nZW9tZXRyeS5hdHRyaWJ1dGVzLmNvbG9yLm5lZWRzVXBkYXRlID0gdHJ1ZTsKICAgICAgICAgICAgfSBlbHNlIGlmIChvYmplY3QuaXNNZXNoICYmIG9iamVjdC5tYXRlcmlhbCkgewogICAgICAgICAgICAgICAgLy8gSWYgbm8gdmVydGV4IGNvbG9ycywgdHJ5IHRvIHVwZGF0ZSBtYXRlcmlhbCBjb2xvcgogICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkob2JqZWN0Lm1hdGVyaWFsKSkgewogICAgICAgICAgICAgICAgICAgIG9iamVjdC5tYXRlcmlhbC5mb3JFYWNoKG1hdGVyaWFsID0+IHsKICAgICAgICAgICAgICAgICAgICAgICAgaWYgKG1hdGVyaWFsLmNvbG9yKSB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRlcmlhbC5jb2xvci5zZXQoaGV4Q29sb3IpOwogICAgICAgICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgICAgfSk7CiAgICAgICAgICAgICAgICB9IGVsc2UgaWYgKG9iamVjdC5tYXRlcmlhbC5jb2xvcikgewogICAgICAgICAgICAgICAgICAgIG9iamVjdC5tYXRlcmlhbC5jb2xvci5zZXQoaGV4Q29sb3IpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICB9CiAgICAgICAgfSk7CiAgICB9Cn0pOwoKLy8gU2F2ZSBmdW5jdGlvbmFsaXR5CmNvbnN0IHNhdmVCdXR0b24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F2ZS1tb2RlbCcpOwpzYXZlQnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4gewogICAgaWYgKCFjdXJyZW50TW9kZWwpIHsKICAgICAgICBjb25zb2xlLndhcm4oJ05vIG1vZGVsIGxvYWRlZCB0byBzYXZlLicpOwogICAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBDYXB0dXJlIGltYWdlCiAgICBjb25zdCBpbWFnZURhdGEgPSByZW5kZXJlci5kb21FbGVtZW50LnRvRGF0YVVSTCgnaW1hZ2UvcG5nJyk7CgogICAgLy8gQ2FwdHVyZSBtZXRhZGF0YQogICAgY29uc3QgbW9kZWxJZCA9ICcxMjMnOyAvLyBQbGFjZWhvbGRlciwgaWRlYWxseSBmcm9tIGxvYWRlZCBtb2RlbAogICAgY29uc3QgY3VycmVudENvbG9yID0gY29sb3JJbnB1dC52YWx1ZTsKICAgIGNvbnN0IG1ldGFkYXRhID0gewogICAgICAgIG1vZGVsSWQ6IG1vZGVsSWQsCiAgICAgICAgY29sb3I6IGN1cnJlbnRDb2xvciwKICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKSwKICAgICAgICAvLyBBZGQgb3RoZXIgcmVsZXZhbnQgbWV0YWRhdGEgaGVyZQogICAgfTsKCiAgICB0cnkgewogICAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2goJy9hcGkvbW9kZWwvc2F2ZScsIHsKICAgICAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgICAgICdDb250ZW50LVR5cGUnOiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgICAgIH0sCiAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgaW1hZ2VEYXRhLCBtZXRhZGF0YSB9KSwKICAgICAgICB9KTsKCiAgICAgICAgaWYgKHJlc3BvbnNlLm9rKSB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdNb2RlbCBzYXZlZCBzdWNjZXNzZnVsbHkhJyk7CiAgICAgICAgICAgIGFsZXJ0KCdNb2RlbCBzYXZlZCBzdWNjZXNzZnVsbHkhJyk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHNhdmUgbW9kZWw6JywgcmVzcG9uc2Uuc3RhdHVzVGV4dCk7CiAgICAgICAgICAgIGFsZXJ0KCdGYWlsZWQgdG8gc2F2ZSBtb2RlbC4nKTsKICAgICAgICB9CiAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIHNhdmluZyBtb2RlbDonLCBlcnJvcik7CiAgICAgICAgYWxlcnQoJ0Vycm9yIHNhdmluZyBtb2RlbC4nKTsKICAgIH0KfSk7CgpmZXRjaCgnL2FwaS9tb2RlbC8xMjMnKSAvLyBVc2luZyBhIHBsYWNlaG9sZGVyIElEIGZvciBub3cKICAgIC50aGVuKHJlc3BvbnNlID0+IHJlc3BvbnNlLmpzb24oKSkKICAgIC50aGVuKG1vZGVsRGF0YSA9PiB7CiAgICAgICAgbG9hZFJ1bmVTY2FwZU1vZGVsKG1vZGVsRGF0YSk7CiAgICB9KQogICAgLmNhdGNoKGVycm9yID0+IGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGZldGNoaW5nIG1vZGVsOicsIGVycm9yKSk7CgovLyA2LiBBbmltYXRpb24gTG9vcApmdW5jdGlvbiBhbmltYXRlKCkgewoJcmVxdWVzdEFuaW1hdGlvbkZyYW1lKGFuaW1hdGUpOwoKCWNvbnRyb2xzLnVwZGF0ZSgpOyAvLyBvbmx5IHJlcXVpcmVkIGlmIGNvbnRyb2xzLmVuYWJsZURhbXBpbmcgaXMgc2V0IHRvIHRydWUKCglyZW5kZXJlci5yZW5kZXIoc2NlbmUsIGNhbWVyYSk7Cn0KYW5pbWF0ZSgpOwoKLy8gSGFuZGxlIHdpbmRvdyByZXNpemUKd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsICgpID0+IHsKICAgIGNvbnN0IHdpZHRoID0gdmlld2VyQ29udGFpbmVyLmNsaWVudFdpZHRoOwogICAgY29uc3QgaGVpZ2h0ID0gdmlld2VyQ29udGFpbmVyLmNsaWVudEhlaWdodDsKCWNhbWVyYS5hc3BlY3QgPSB3aWR0aCAvIGhlaWdodDsKCWNhbWVyYS51cGRhdGVQcm9qZWN0aW9uTWF0cml4KCk7CglyZW5kZXJlci5zZXRTaXplKHdpZHRoLCBoZWlnaHQpOwp9KTsKCi8vIENoYXQgSW50ZXJmYWNlIExvZ2ljCmNvbnN0IGNoYXRGb3JtID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2NoYXQtZm9ybScpOwpjb25zdCBjaGF0SW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY2hhdC1pbnB1dCcpOwpjb25zdCBtZXNzYWdlc0RpdiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdtZXNzYWdlcycpOwoKY2hhdEZvcm0uYWRkRXZlbnRMaXN0ZW5lcignc3VibWl0JywgYXN5bmMgKGV2ZW50KSA9PiB7CglldmVudC5wcmV2ZW50RGVmYXVsdCgpOwoJY29uc3QgbWVzc2FnZSA9IGNoYXRJbnB1dC52YWx1ZS50cmltKCk7CglpZiAobWVzc2FnZSkgewoJCWFkZE1lc3NhZ2UobWVzc2FnZSwgJ3VzZXInKTsKCQljaGF0SW5wdXQudmFsdWUgPSAnJzsKCQl0cnkgewoJCQljb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKCcvYXBpL2NoYXQnLCB7CgkJCQltZXRob2Q6ICdQT1NUJywKCQkJCWhlYWRlcnM6IHsKCQkJCQknQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nLAoJCQkJfSwKCQkJCWJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbWVzc2FnZSB9KSwKCQkJfSk7CgkJCWNvbnN0IGRhdGEgPSBhd2FpdCByZXNwb25zZS5qc29uKCk7CgkJCWFkZE1lc3NhZ2UoZGF0YS5yZXNwb25zZSwgJ2FpJyk7CgkJfSBjYXRjaCAoZXJyb3IpIHsKCQkJY29uc29sZS5lcnJvcignRXJyb3Igc2VuZGluZyBtZXNzYWdlIHRvIEFJOicsIGVycm9yKTsKCQkJYWRkTWVzc2FnZSgnRXJyb3I6IENvdWxkIG5vdCBjb25uZWN0IHRvIEFJLicsICdhaScpOwoJCX0KCX0KfSk7CgpmdW5jdGlvbiBhZGRNZXNzYWdlKHRleHQsIHNlbmRlcikgewoJY29uc3QgbWVzc2FnZUVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTsKCW1lc3NhZ2VFbGVtZW50LmNsYXNzTGlzdC5hZGQoJ21lc3NhZ2UnLCBzZW5kZXIpOwoJbWVzc2FnZUVsZW1lbnQudGV4dENvbnRlbnQgPSB0ZXh0OwoJbWVzc2FnZXNEaXYuYXBwZW5kQ2hpbGQobWVzc2FnZUVsZW1lbnQpOwoJbWVzc2FnZXNEaXYuc2Nyb2xsVG9wID0gbWVzc2FnZXNEaXYuc2Nyb2xsSGVpZ2h0Owp9CgppbXBvcnQgJy4vYW5pbWF0aW9uL2FuaW1hdGlvbkRlbW8uanMnOwoKZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignRE9NQ29udGVudExvYWRlZCcsICgpID0+IHsKICAgIGNvbnN0IGFwcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhcHAnKTsKICAgIAogICAgLy8gQWRkIHZlcnNpb24gaW5mbwogICAgY29uc3QgdmVyc2lvbiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3AnKTsKICAgIHZlcnNpb24udGV4dENvbnRlbnQgPSBgVmVyc2lvbjogJHtuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCl9YDsKICAgIHZlcnNpb24uc3R5bGUuY29sb3IgPSAnIzY2Nic7CiAgICB2ZXJzaW9uLnN0eWxlLmZvbnRTaXplID0gJzAuOGVtJzsKICAgIGFwcC5hcHBlbmRDaGlsZCh2ZXJzaW9uKTsKCiAgICAvLyBUZXN0IEtWIGNvbm5lY3Rpb24KICAgIGZldGNoKCcvdGVzdC1rdicpCiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gcmVzcG9uc2UuanNvbigpKQogICAgICAgIC50aGVuKGRhdGEgPT4gewogICAgICAgICAgICBjb25zdCBzdGF0dXMgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdwcmUnKTsKICAgICAgICAgICAgc3RhdHVzLnRleHRDb250ZW50ID0gSlNPTi5zdHJpbmdpZnkoZGF0YSwgbnVsbCwgMik7CiAgICAgICAgICAgIGFwcC5hcHBlbmRDaGlsZChzdGF0dXMpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKGVycm9yID0+IGNvbnNvbGUuZXJyb3IoJ0Vycm9yOicsIGVycm9yKSk7Cn0pOwo=",
    "base64": true
  },
  {
    "key": "models/123.ob3",
    "value": "",
    "base64": true
  },
  {
    "key": "models.json",
    "value": "WyJzdHJ1Y3QiLFsiZm9ybWF0IiwidWJ5dGUiXSxbInZlcnNpb24iLCJ1Ynl0ZSJdLFsiYWx3YXlzXzBmIiwidWJ5dGUiXSxbIm1lc2hDb3VudCIsInVieXRlIl0sWyJ1bmtDb3VudDAiLCJ1Ynl0ZSJdLFsidW5rQ291bnQxIiwidWJ5dGUiXSxbInVua0NvdW50MiIsInVieXRlIl0sWyJ1bmtDb3VudDMiLCJ1Ynl0ZSJdLFsidW5rQ291bnQ0IixbIm1hdGNoIix7InZlcnNpb24+PTUiOiJ1Ynl0ZSIsIm90aGVyIjowfV1dLFsibWVzaGVzIixbIm9wdCIsInZlcnNpb248PTMiLFsiYXJyYXkiLFsicmVmIiwibWVzaENvdW50Il0sWyJzdHJ1Y3QiLFsiJGdyb3VwRmxhZ3MiLCJ1Ynl0ZSJdLFsidW5raW50IiwidWludCJdLFsibWF0ZXJpYWxBcmd1bWVudCIsInVzaG9ydCBsZSJdLFsiZmFjZUNvdW50IiwidXNob3J0IGxlIl0sWyJoYXNWZXJ0aWNlcyIsWyJyZWYiLCIkZ3JvdXBGbGFncyIsWzAsMV1dXSxbImhhc1ZlcnRleEFscGhhIixbInJlZiIsIiRncm91cEZsYWdzIixbMSwxXV1dLFsiaGFzRmFjZUJvbmVzIixbInJlZiIsIiRncm91cEZsYWdzIixbMiwxXV1dLFsiaGFzQm9uZUlkcyIsWyJyZWYiLCIkZ3JvdXBGbGFncyIsWzMsMV1dXSxbImlzSGlkZGVuIixbInJlZiIsIiRncm91cEZsYWdzIixbNCwxXV1dLFsiaGFzU2tpbiIsWyJyZWYiLCIkZ3JvdXBGbGFncyIsWzUsMV1dXSxbImNvbG91ckJ1ZmZlciIsWyJvcHQiLFsiaGFzVmVydGljZXMiLDFdLFsiYnVmZmVyIixbInJlZiIsImZhY2VDb3VudCJdLCJ1c2hvcnQiXV1dLFsiYWxwaGFCdWZmZXIiLFsib3B0IixbImhhc1ZlcnRleEFscGhhIiwxXSxbImJ1ZmZlciIsWyJyZWYiLCJmYWNlQ291bnQiXSwidWJ5dGUiXV1dLFsiZmFjZWJvbmVpZEJ1ZmZlciIsWyJvcHQiLFsiaGFzRmFjZUJvbmVzIiwxXSxbImJ1ZmZlciIsWyJyZWYiLCJmYWNlQ291bnQiXSwidXNob3J0Il1dXSxbImluZGV4QnVmZmVycyIsWyJhcnJheSIsInVieXRlIixbImJ1ZmZlciIsInVzaG9ydCBsZSIsInVzaG9ydCJdXV0sWyJ2ZXJ0ZXhDb3VudCIsWyJtYXRjaCIsWyJyZWYiLCJoYXNWZXJ0aWNlcyJdLHsiPTEiOiJ1c2hvcnQgbGUiLCI9MCI6MH1dXSxbInBvc2l0aW9uQnVmZmVyIixbIm9wdCIsWyJoYXNWZXJ0aWNlcyIsMV0sWyJidWZmZXIiLFsicmVmIiwidmVydGV4Q291bnQiXSwic2hvcnQiLDNdXV0sWyJub3JtYWxCdWZmZXIiLFsib3B0IixbImhhc1ZlcnRpY2VzIiwxXSxbIm1hdGNoIiwiYnVpbGRuciIseyI+PTg4NyI6WyJidWZmZXIiLFsicmVmIiwidmVydGV4Q291bnQiXSwiYnl0ZSIsM10sIj49MCI6WyJidWZmZXIiLFsicmVmIiwidmVydGV4Q291bnQiXSwic2hvcnQiLDNdfV1dXSxbInRhZ2VudEJ1ZmZlciIsWyJvcHQiLFsiaGFzVmVydGljZXMiLDFdLFsibWF0Y2giLCJidWlsZG5yIix7Ij49OTA2IjpbImJ1ZmZlciIsWyJyZWYiLCJ2ZXJ0ZXhDb3VudCJdLCJzaG9ydCIsMl0sIj49MCI6Im51bGwifV1dXSxbInV2QnVmZmVyIixbIm9wdCIsWyJoYXNWZXJ0aWNlcyIsMV0sWyJtYXRjaCIsImJ1aWxkbnIiLHsiPj04ODciOlsiYnVmZmVyIixbInJlZiIsInZlcnRleENvdW50Il0sInVzaG9ydCIsMl0sIj49MCI6WyJidWZmZXIiLFsicmVmIiwidmVydGV4Q291bnQiXSwiZmxvYXQiLDJdfV1dXSxbImJvbmVpZEJ1ZmZlciIsWyJvcHQiLFsiaGFzQm9uZUlkcyIsMV0sWyJidWZmZXIiLFsicmVmIiwidmVydGV4Q291bnQiXSwidXNob3J0Il1dXSxbInNraW4iLFsib3B0IixbImhhc1NraW4iLDFdLFsic3RydWN0IixbInNraW5XZWlnaHRDb3VudCIsInVpbnQgbGUiXSxbInNraW5Cb25lQnVmZmVyIixbImJ1ZmZlciIsWyJyZWYiLCJza2luV2VpZ2h0Q291bnQiXSwidXNob3J0IiwxXV0sWyJza2luV2VpZ2h0QnVmZmVyIixbImJ1ZmZlciIsWyJyZWYiLCJza2luV2VpZ2h0Q291bnQiXSwidWJ5dGUiLDFdXV1dXV1dXV0sWyJtZXNoZGF0YSIsWyJvcHQiLCJ2ZXJzaW9uPjMiLFsic3RydWN0IixbIiRncm91cEZsYWdzIiwidWJ5dGUiXSxbInVua2ludCIsInVieXRlIl0sWyJmYWNlQ291bnQiLCJ1c2hvcnQgbGUiXSxbImhhc1ZlcnRpY2VzIixbInJlZiIsIiRncm91cEZsYWdzIixbMCwxXV1dLFsiaGFzVmVydGV4QWxwaGEiLFsicmVmIiwiJGdyb3VwRmxhZ3MiLFsxLDFdXV0sWyJoYXNGYWNlQm9uZXMiLFsicmVmIiwiJGdyb3VwRmxhZ3MiLFsyLDFdXV0sWyJoYXNCb25lSWRzIixbInJlZiIsIiRncm91cEZsYWdzIixbMywxXV1dLFsiaXNIaWRkZW4iLFsicmVmIiwiJGdyb3VwRmxhZ3MiLFs0LDFdXV0sWyJoYXNTa2luIixbInJlZiIsIiRncm91cEZsYWdzIixbNSwxXV1dLFsidmVydGV4Q291bnQiLCJ1aW50IGxlIl0sWyJwb3NpdGlvbkJ1ZmZlciIsWyJvcHQiLFsiaGFzVmVydGljZXMiLDFdLFsiYnVmZmVyIixbInJlZiIsInZlcnRleENvdW50Il0sInNob3J0IiwzXV1dLFsibm9ybWFsQnVmZmVyIixbIm9wdCIsWyJoYXNWZXJ0aWNlcyIsMV0sWyJidWZmZXIiLFsicmVmIiwidmVydGV4Q291bnQiXSwiYnl0ZSIsM11dXSxbInRhZ2VudEJ1ZmZlciIsWyJvcHQiLFsiaGFzVmVydGljZXMiLDFdLFsiYnVmZmVyIixbInJlZiIsInZlcnRleENvdW50Il0sInNob3J0IiwyXV1dLFsidXZCdWZmZXIiLFsib3B0IixbImhhc1ZlcnRpY2VzIiwxXSxbImJ1ZmZlciIsWyJyZWYiLCJ2ZXJ0ZXhDb3VudCJdLCJ1c2hvcnQiLDJdXV0sWyJib25laWRCdWZmZXIiLFsib3B0IixbImhhc0JvbmVJZHMiLDFdLFsiYnVmZmVyIixbInJlZiIsInZlcnRleENvdW50Il0sInVzaG9ydCJdXV0sWyJza2luIixbIm9wdCIsImhhc1NraW49PTEiLFsiYXJyYXkiLFsicmVmIiwidmVydGV4Q291bnQiXSxbInN0cnVjdCIsWyJpZHMiLFsiYXJyYXkiLCJ1c2hvcnQgbGUiLCJ1c2hvcnQgbGUiXV0sWyJ3ZWlnaHRzIixbImFycmF5IiwidXNob3J0IGxlIiwidWJ5dGUiXV1dXV1dLFsidmVydGV4Q29sb3VycyIsWyJvcHQiLCJoYXNWZXJ0aWNlcz09MSIsWyJidWZmZXIiLFsicmVmIiwidmVydGV4Q291bnQiXSwidXNob3J0Il1dXSxbInZlcnRleEFscGhhIixbIm9wdCIsImhhc1ZlcnRpY2VzPT0xIixbImJ1ZmZlciIsWyJyZWYiLCJ2ZXJ0ZXhDb3VudCJdLCJ1Ynl0ZSJdXV0sWyJ2ZXJ0ZXhGYWNlYm9uZXMiLFsib3B0IiwiaGFzRmFjZUJvbmVzPT0xIixbImJ1ZmZlciIsWyJyZWYiLCJ2ZXJ0ZXhDb3VudCJdLCJ1c2hvcnQiXV1dLFsicmVuZGVycyIsWyJhcnJheSIsWyJyZWYiLCJtZXNoQ291bnQiXSxbInN0cnVjdCIsWyIkZ3JvdXBGbGFncyIsInVieXRlIl0sWyJoYXNWZXJ0aWNlcyIsWyJyZWYiLCIkZ3JvdXBGbGFncyIsWzAsMV1dXSxbImhhc1ZlcnRleEFscGhhIixbInJlZiIsIiRncm91cEZsYWdzIixbMSwxXV1dLFsiaGFzRmFjZUJvbmVzIixbInJlZiIsIiRncm91cEZsYWdzIixbMiwxXV1dLFsiaGFzQm9uZUlkcyIsWyJyZWYiLCIkZ3JvdXBGbGFncyIsWzMsMV1dXSxbImlzSGlkZGVuIixbInJlZiIsIiRncm91cEZsYWdzIixbNCwxXV1dLFsiaGFzU2tpbiIsWyJyZWYiLCIkZ3JvdXBGbGFncyIsWzUsMV1dXSxbInVua2ludCIsInVpbnQiXSxbIm1hdGVyaWFsQXJndW1lbnQiLCJ1c2hvcnQgbGUiXSxbInVua2J5dGUyIiwidWJ5dGUiXSxbImJ1ZiIsWyJtYXRjaCIseyJ2ZXJ0ZXhDb3VudDw9MHhmZmZmIjpbImJ1ZmZlciIsInVzaG9ydCBsZSIsInVzaG9ydCJdLCJvdGhlciI6WyJidWZmZXIiLCJ1c2hvcnQgbGUiLCJ1aW50Il19XV1dXV1dXV0sWyJ1bmsxQnVmZmVyIixbImFycmF5IixbInJlZiIsInVua0NvdW50MSJdLFsiYnVmZmVyIixbIm1hdGNoIiwiYnVpbGRuciIseyI+PTkyMyI6MzksIj49MCI6Mzd9XSwiaGV4Il1dXSxbInVuazJCdWZmZXIiLFsiYXJyYXkiLFsicmVmIiwidW5rQ291bnQyIl0sWyJidWZmZXIiLFsibWF0Y2giLCJidWlsZG5yIix7Ij49OTIzIjo1MCwiPj0wIjo0NH1dLCJoZXgiXV1dLFsidW5rM0J1ZmZlciIsWyJhcnJheSIsWyJyZWYiLCJ1bmtDb3VudDMiXSxbImJ1ZmZlciIsWyJtYXRjaCIsImJ1aWxkbnIiLHsiPj05MjMiOjE4LCI+PTAiOjE2fV0sImhleCJdXV0sWyJ1bms0QnVmZmVyIixbImFycmF5IixbInJlZiIsInVua0NvdW50NCJdLFsiYnVmZmVyIiwwXV1dXQ==",
    "base64": true
  },
  {
    "key": "style.css",
    "value": "Ym9keSB7CiAgICBtYXJnaW46IDA7CiAgICBmb250LWZhbWlseTogQXJpYWwsIHNhbnMtc2VyaWY7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgIGhlaWdodDogMTAwdmg7CiAgICBvdmVyZmxvdzogaGlkZGVuOwp9CgojYXBwIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgZmxleC1ncm93OiAxOwp9CgpoMSB7CiAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICBwYWRkaW5nOiAxMHB4OwogICAgbWFyZ2luOiAwOwogICAgYmFja2dyb3VuZC1jb2xvcjogI2YwZjBmMDsKICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAjY2NjOwp9Cgojdmlld2VyLWNvbnRhaW5lciB7CiAgICBmbGV4LWdyb3c6IDE7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgcG9zaXRpb246IHJlbGF0aXZlOwp9CgojcmVuZGVyZXItY2FudmFzIHsKICAgIHdpZHRoOiAxMDAlOwogICAgaGVpZ2h0OiAxMDAlOwogICAgZGlzcGxheTogYmxvY2s7Cn0KCiNjb250cm9scyB7CiAgICBwb3NpdGlvbjogYWJzb2x1dGU7CiAgICB0b3A6IDEwcHg7CiAgICByaWdodDogMTBweDsKICAgIGJhY2tncm91bmQtY29sb3I6IHJnYmEoMjU1LCAyNTUsIDI1NSwgMC44KTsKICAgIHBhZGRpbmc6IDEwcHg7CiAgICBib3JkZXItcmFkaXVzOiA1cHg7CiAgICBkaXNwbGF5OiBmbGV4OwogICAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjsKICAgIGdhcDogMTBweDsKfQoKI2NvbnRyb2xzIGxhYmVsIHsKICAgIGZvbnQtd2VpZ2h0OiBib2xkOwp9CgojY29udHJvbHMgaW5wdXRbdHlwZT0iY29sb3IiXSB7CiAgICB3aWR0aDogNTBweDsKICAgIGhlaWdodDogMzBweDsKICAgIGJvcmRlcjogbm9uZTsKICAgIHBhZGRpbmc6IDA7CiAgICBjdXJzb3I6IHBvaW50ZXI7Cn0KCi8qIENoYXQgSW50ZXJmYWNlIFN0eWxlcyAoZXhpc3RpbmcsIGtlZXAgZm9yIG5vdykgKi8KI21lc3NhZ2VzIHsKICAgIGZsZXgtZ3JvdzogMTsKICAgIG92ZXJmbG93LXk6IGF1dG87CiAgICBwYWRkaW5nOiAxMHB4OwogICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNlZWU7Cn0KCi5tZXNzYWdlIHsKICAgIG1hcmdpbi1ib3R0b206IDVweDsKfQoKLm1lc3NhZ2UudXNlciB7CiAgICB0ZXh0LWFsaWduOiByaWdodDsKICAgIGNvbG9yOiBibHVlOwp9CgoubWVzc2FnZS5haSB7CiAgICB0ZXh0LWFsaWduOiBsZWZ0OwogICAgY29sb3I6IGdyZWVuOwp9CgojY2hhdC1mb3JtIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBwYWRkaW5nOiAxMHB4OwogICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICNlZWU7Cn0KCiNjaGF0LWlucHV0IHsKICAgIGZsZXgtZ3JvdzogMTsKICAgIHBhZGRpbmc6IDhweDsKICAgIGJvcmRlcjogMXB4IHNvbGlkICNjY2M7CiAgICBib3JkZXItcmFkaXVzOiAzcHg7Cn0KCiNjaGF0LWZvcm0gYnV0dG9uIHsKICAgIG1hcmdpbi1sZWZ0OiAxMHB4OwogICAgcGFkZGluZzogOHB4IDE1cHg7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDA3YmZmOwogICAgY29sb3I6IHdoaXRlOwogICAgYm9yZGVyOiBub25lOwogICAgYm9yZGVyLXJhZGl1czogM3B4OwogICAgY3Vyc29yOiBwb2ludGVyOwp9CgojY2hhdC1mb3JtIGJ1dHRvbjpob3ZlciB7CiAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDA1NmIzOwp9CgpwcmUgewogICAgYmFja2dyb3VuZC1jb2xvcjogI2Y0ZjRmNDsKICAgIGJvcmRlcjogMXB4IHNvbGlkICNkZGQ7CiAgICBwYWRkaW5nOiAxMHB4OwogICAgb3ZlcmZsb3cteDogYXV0bzsKfQo=",
    "base64": true
  },
  {
    "key": "typedef.json",
    "value": "eyIwIjowLCIxIjoxLCJ2YXJpYWJsZSB1bnNpZ25lZCBsb25nIjoidmFydWludCIsInZhcmlhYmxlIHVuc2lnbmVkIGludCI6InZhcnVpbnQiLCJ2YXJpYWJsZSB1bnNpZ25lZCBzaG9ydCI6InZhcnVzaG9ydCIsInVuc2lnbmVkIHZhcmlhYmxlIGxvbmciOiJ2YXJ1aW50IiwidW5zaWduZWQgdmFyaWFibGUgaW50IjoidmFydWludCIsInVuc2lnbmVkIHZhcmlhYmxlIHNob3J0IjoidmFydXNob3J0IiwidmFyaWFibGUgbG9uZyI6InZhcmludCIsInZhcmlhYmxlIGludCI6InZhcmludCIsInZhcmlhYmxlIHNob3J0IjoidmFyc2hvcnQiLCJ1bnNpZ25lZCBsb25nIjoidWludCIsInVuc2lnbmVkIGludCI6InVpbnQiLCJ1bnNpZ25lZCBzaG9ydCI6InVzaG9ydCIsInVuc2lnbmVkIGJ5dGUiOiJ1Ynl0ZSIsImxvbmciOiJpbnQiLCJ1c2hvcnQgbGUiOiJ1c2hvcnRfbGUiLCJ1aW50IGxlIjoidWludF9sZSIsInBsYXllcml0ZW0iOlsicGxheWVyaXRlbSJdLCJwbGF5ZXJpdGVtZWRpdCI6WyJzdHJ1Y3QiLFsiJHR5cGUiLCJ1Ynl0ZSJdLFsibW9kZWwiLFsib3B0IixbIiR0eXBlIiwwLCJiaXRmbGFnIl0sWyJhcnJheSIsWyJpdGVtdmFyIiwibW9kZWxjb3VudCJdLCJ2YXJ1aW50Il1dXSxbImZsYWcyIixbIm9wdCIsWyIkdHlwZSIsMSwiYml0ZmxhZyJdLCJ0cnVlIl1dLFsiY29sb3IiLFsib3B0IixbIiR0eXBlIiwyLCJiaXRmbGFnIl0sWyJzdHJ1Y3QiLFsiJGNvbHR5cGUiLCJ1c2hvcnQiXSxbImNvbDIiLFsib3B0IixbIiRjb2x0eXBlIiwxMjgxNl0sWyJhcnJheSIsWyJpdGVtdmFyIiwiY29sb3Jjb3VudCJdLCJ1c2hvcnQiXV1dLFsiY29sNCIsWyJvcHQiLFsiJGNvbHR5cGUiLDg3MTldLFsiYXJyYXkiLDQsWyJ0dXBsZSIsInVzaG9ydCIsInVzaG9ydCJdXV1dXV1dLFsibWF0ZXJpYWwiLFsib3B0IixbIiR0eXBlIiwzLCJiaXRmbGFnIl0sWyJzdHJ1Y3QiLFsiaGVhZGVyIiwidWJ5dGUiXSxbIm1hdGVyaWFscyIsWyJhcnJheSIsWyJpdGVtdmFyIiwibWF0Y291bnQiXSwidXNob3J0Il1dXV1dXSwidWJ5dGUiOiJ1bnNpZ25lZCBieXRlIiwidXNob3J0IjoidW5zaWduZWQgc2hvcnQiLCJ1aW50IjoidW5zaWduZWQgaW50IiwidmFydXNob3J0IjoidmFyaWFibGUgdW5zaWduZWQgc2hvcnQiLCJ2YXJ1aW50IjoidmFyaWFibGUgdW5zaWduZWQgaW50IiwidmFyc2hvcnQiOiJ2YXJpYWJsZSBzaG9ydCIsInZhcmludCI6InZhcmlhYmxlIGludCIsInVuc2lnbmVkIHRyaWJ5dGUiOiJ1dHJpYnl0ZSIsInRhaWxlZCB1bnNpZ25lZCBzaG9ydCI6WyJ0YWlsZWQgdmFydXNob3J0Il0sImJvb2xlYW4iOiJib29sIiwidHJ1ZSI6dHJ1ZSwiZmFsc2UiOmZhbHNlLCItMSI6LTEsIm51bGwiOm51bGwsImV4dHJhc21hcCI6WyJhcnJheSIsInVieXRlIixbInN0cnVjdCIsWyIkdHlwZSIsInVuc2lnbmVkIGJ5dGUiXSxbInByb3AiLCJ1bnNpZ25lZCB0cmlieXRlIl0sWyJpbnR2YWx1ZSIsWyJvcHQiLFsiJHR5cGUiLDBdLCJpbnQiXV0sWyJzdHJpbmd2YWx1ZSIsWyJvcHQiLFsiJHR5cGUiLDFdLCJzdHJpbmciXV1dXSwiYnVpbGRuciI6WyJidWlsZG5yIl0sIml0ZW1fbW9kZWxpZCI6WyJtYXRjaCIsImJ1aWxkbnIiLHsiPj02NzAiOiJ2YXJ1aW50IiwiPj0wIjoidXNob3J0In1dLCJhbmltaWQiOlsibWF0Y2giLCJidWlsZG5yIix7Ij49NjcwIjoidmFybnVsbGludCIsIj49MCI6InVzaG9ydCJ9XSwidWl2YWx1ZXMiOlsiYXJyYXkiLCJ1Ynl0ZSIsWyJtYXRjaCIsInVieXRlIix7IjAiOiJpbnQiLCIxIjoic3RyaW5nIn1dXSwidWl2YWx1ZXNpbnQiOlsiYXJyYXkiLCJ1Ynl0ZSIsImludCJdfQ==",
    "base64": true
  }
]